(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
(function (global){(function (){
var $jscomp={scope:{},getGlobal:function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global?global:d}};$jscomp.global=$jscomp.getGlobal(this);$jscomp.initSymbol=function(){$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol);$jscomp.initSymbol=function(){}};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(d){return"jscomp_symbol_"+d+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();$jscomp.global.Symbol.iterator||($jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));$jscomp.initSymbolIterator=function(){}};$jscomp.makeIterator=function(d){$jscomp.initSymbolIterator();if(d[$jscomp.global.Symbol.iterator])return d[$jscomp.global.Symbol.iterator]();var e=0;return{next:function(){return e==d.length?{done:!0}:{done:!1,value:d[e++]}}}};
$jscomp.arrayFromIterator=function(d){for(var e,k=[];!(e=d.next()).done;)k.push(e.value);return k};$jscomp.arrayFromIterable=function(d){return d instanceof Array?d:$jscomp.arrayFromIterator($jscomp.makeIterator(d))};
$jscomp.inherits=function(d,e){function k(){}k.prototype=e.prototype;d.prototype=new k;d.prototype.constructor=d;for(var b in e)if($jscomp.global.Object.defineProperties){var a=$jscomp.global.Object.getOwnPropertyDescriptor(e,b);a&&$jscomp.global.Object.defineProperty(d,b,a)}else d[b]=e[b]};$jscomp.array=$jscomp.array||{};$jscomp.array.done_=function(){return{done:!0,value:void 0}};
$jscomp.array.arrayIterator_=function(d,e){d instanceof String&&(d=String(d));var k=0;$jscomp.initSymbol();$jscomp.initSymbolIterator();var b={},a=(b.next=function(){if(k<d.length){var b=k++;return{value:e(b,d[b]),done:!1}}a.next=$jscomp.array.done_;return $jscomp.array.done_()},b[Symbol.iterator]=function(){return a},b);return a};
$jscomp.array.findInternal_=function(d,e,k){d instanceof String&&(d=String(d));for(var b=d.length,a=0;a<b;a++){var c=d[a];if(e.call(k,c,a,d))return{i:a,v:c}}return{i:-1,v:void 0}};
$jscomp.array.from=function(d,e,k){e=void 0===e?function(a){return a}:e;var b=[];$jscomp.initSymbol();$jscomp.initSymbolIterator();if(d[Symbol.iterator]){$jscomp.initSymbol();$jscomp.initSymbolIterator();d=d[Symbol.iterator]();for(var a;!(a=d.next()).done;)b.push(e.call(k,a.value))}else{a=d.length;for(var c=0;c<a;c++)b.push(e.call(k,d[c]))}return b};$jscomp.array.of=function(d){for(var e=[],k=0;k<arguments.length;++k)e[k-0]=arguments[k];return $jscomp.array.from(e)};
$jscomp.array.entries=function(){return $jscomp.array.arrayIterator_(this,function(d,e){return[d,e]})};$jscomp.array.entries$install=function(){Array.prototype.entries||(Array.prototype.entries=$jscomp.array.entries)};$jscomp.array.keys=function(){return $jscomp.array.arrayIterator_(this,function(d){return d})};$jscomp.array.keys$install=function(){Array.prototype.keys||(Array.prototype.keys=$jscomp.array.keys)};$jscomp.array.values=function(){return $jscomp.array.arrayIterator_(this,function(d,e){return e})};
$jscomp.array.values$install=function(){Array.prototype.values||(Array.prototype.values=$jscomp.array.values)};$jscomp.array.copyWithin=function(d,e,k){var b=this.length;d=Number(d);e=Number(e);k=Number(null!=k?k:b);if(d<e)for(k=Math.min(k,b);e<k;)e in this?this[d++]=this[e++]:(delete this[d++],e++);else for(k=Math.min(k,b+e-d),d+=k-e;k>e;)--k in this?this[--d]=this[k]:delete this[d];return this};$jscomp.array.copyWithin$install=function(){Array.prototype.copyWithin||(Array.prototype.copyWithin=$jscomp.array.copyWithin)};
$jscomp.array.fill=function(d,e,k){null!=k&&d.length||(k=this.length||0);k=Number(k);for(e=Number((void 0===e?0:e)||0);e<k;e++)this[e]=d;return this};$jscomp.array.fill$install=function(){Array.prototype.fill||(Array.prototype.fill=$jscomp.array.fill)};$jscomp.array.find=function(d,e){return $jscomp.array.findInternal_(this,d,e).v};$jscomp.array.find$install=function(){Array.prototype.find||(Array.prototype.find=$jscomp.array.find)};
$jscomp.array.findIndex=function(d,e){return $jscomp.array.findInternal_(this,d,e).i};$jscomp.array.findIndex$install=function(){Array.prototype.findIndex||(Array.prototype.findIndex=$jscomp.array.findIndex)};$jscomp.Map=function(d){d=void 0===d?[]:d;this.data_={};this.head_=$jscomp.Map.createHead_();this.size=0;if(d){d=$jscomp.makeIterator(d);for(var e=d.next();!e.done;e=d.next())e=e.value,this.set(e[0],e[1])}};
$jscomp.Map.checkBrowserConformance_=function(){var d=$jscomp.global.Map;if(!d||!d.prototype.entries||!Object.seal)return!1;try{var e=Object.seal({x:4}),k=new d($jscomp.makeIterator([[e,"s"]]));if("s"!=k.get(e)||1!=k.size||k.get({x:4})||k.set({x:4},"t")!=k||2!=k.size)return!1;var b=k.entries(),a=b.next();if(a.done||a.value[0]!=e||"s"!=a.value[1])return!1;a=b.next();return a.done||4!=a.value[0].x||"t"!=a.value[1]||!b.next().done?!1:!0}catch(c){return!1}};
$jscomp.Map.createHead_=function(){var d={};return d.previous=d.next=d.head=d};$jscomp.Map.getId_=function(d){if(!(d instanceof Object))return String(d);$jscomp.Map.key_ in d||d instanceof Object&&Object.isExtensible&&Object.isExtensible(d)&&$jscomp.Map.defineProperty_(d,$jscomp.Map.key_,++$jscomp.Map.index_);return $jscomp.Map.key_ in d?d[$jscomp.Map.key_]:" "+d};
$jscomp.Map.prototype.set=function(d,e){var k=this.maybeGetEntry_(d),b=k.id,a=k.list,k=k.entry;a||(a=this.data_[b]=[]);k?k.value=e:(k={next:this.head_,previous:this.head_.previous,head:this.head_,key:d,value:e},a.push(k),this.head_.previous.next=k,this.head_.previous=k,this.size++);return this};
$jscomp.Map.prototype["delete"]=function(d){var e=this.maybeGetEntry_(d);d=e.id;var k=e.list,b=e.index;return(e=e.entry)&&k?(k.splice(b,1),k.length||delete this.data_[d],e.previous.next=e.next,e.next.previous=e.previous,e.head=null,this.size--,!0):!1};$jscomp.Map.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=$jscomp.Map.createHead_();this.size=0};$jscomp.Map.prototype.has=function(d){return!!this.maybeGetEntry_(d).entry};
$jscomp.Map.prototype.get=function(d){return(d=this.maybeGetEntry_(d).entry)&&d.value};$jscomp.Map.prototype.maybeGetEntry_=function(d){var e=$jscomp.Map.getId_(d),k=this.data_[e];if(k)for(var b=0;b<k.length;b++){var a=k[b];if(d!==d&&a.key!==a.key||d===a.key)return{id:e,list:k,index:b,entry:a}}return{id:e,list:k,index:-1,entry:void 0}};$jscomp.Map.prototype.entries=function(){return this.iter_(function(d){return[d.key,d.value]})};$jscomp.Map.prototype.keys=function(){return this.iter_(function(d){return d.key})};
$jscomp.Map.prototype.values=function(){return this.iter_(function(d){return d.value})};$jscomp.Map.prototype.forEach=function(d,e){for(var k=$jscomp.makeIterator(this.entries()),b=k.next();!b.done;b=k.next())b=b.value,d.call(e,b[1],b[0],this)};
$jscomp.Map.prototype.iter_=function(d){var e=this,k=this.head_;$jscomp.initSymbol();$jscomp.initSymbolIterator();var b={};return b.next=function(){if(k){for(;k.head!=e.head_;)k=k.previous;for(;k.next!=k.head;)return k=k.next,{done:!1,value:d(k)};k=null}return{done:!0,value:void 0}},b[Symbol.iterator]=function(){return this},b};$jscomp.Map.index_=0;$jscomp.Map.defineProperty_=Object.defineProperty?function(d,e,k){Object.defineProperty(d,e,{value:String(k)})}:function(d,e,k){d[e]=String(k)};
$jscomp.Map.Entry_=function(){};$jscomp.Map.ASSUME_NO_NATIVE=!1;$jscomp.Map$install=function(){$jscomp.initSymbol();$jscomp.initSymbolIterator();!$jscomp.Map.ASSUME_NO_NATIVE&&$jscomp.Map.checkBrowserConformance_()?$jscomp.Map=$jscomp.global.Map:($jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Map.prototype[Symbol.iterator]=$jscomp.Map.prototype.entries,$jscomp.initSymbol(),$jscomp.Map.key_=Symbol("map-id-key"));$jscomp.Map$install=function(){}};$jscomp.math=$jscomp.math||{};
$jscomp.math.clz32=function(d){d=Number(d)>>>0;if(0===d)return 32;var e=0;0===(d&4294901760)&&(d<<=16,e+=16);0===(d&4278190080)&&(d<<=8,e+=8);0===(d&4026531840)&&(d<<=4,e+=4);0===(d&3221225472)&&(d<<=2,e+=2);0===(d&2147483648)&&e++;return e};$jscomp.math.imul=function(d,e){d=Number(d);e=Number(e);var k=d&65535,b=e&65535;return k*b+((d>>>16&65535)*b+k*(e>>>16&65535)<<16>>>0)|0};$jscomp.math.sign=function(d){d=Number(d);return 0===d||isNaN(d)?d:0<d?1:-1};
$jscomp.math.log10=function(d){return Math.log(d)/Math.LN10};$jscomp.math.log2=function(d){return Math.log(d)/Math.LN2};$jscomp.math.log1p=function(d){d=Number(d);if(.25>d&&-.25<d){for(var e=d,k=1,b=d,a=0,c=1;a!=b;)e*=d,c*=-1,b=(a=b)+c*e/++k;return b}return Math.log(1+d)};$jscomp.math.expm1=function(d){d=Number(d);if(.25>d&&-.25<d){for(var e=d,k=1,b=d,a=0;a!=b;)e*=d/++k,b=(a=b)+e;return b}return Math.exp(d)-1};$jscomp.math.cosh=function(d){d=Number(d);return(Math.exp(d)+Math.exp(-d))/2};
$jscomp.math.sinh=function(d){d=Number(d);return 0===d?d:(Math.exp(d)-Math.exp(-d))/2};$jscomp.math.tanh=function(d){d=Number(d);if(0===d)return d;var e=Math.exp(2*-Math.abs(d)),e=(1-e)/(1+e);return 0>d?-e:e};$jscomp.math.acosh=function(d){d=Number(d);return Math.log(d+Math.sqrt(d*d-1))};$jscomp.math.asinh=function(d){d=Number(d);if(0===d)return d;var e=Math.log(Math.abs(d)+Math.sqrt(d*d+1));return 0>d?-e:e};
$jscomp.math.atanh=function(d){d=Number(d);return($jscomp.math.log1p(d)-$jscomp.math.log1p(-d))/2};
$jscomp.math.hypot=function(d,e,k){for(var b=[],a=2;a<arguments.length;++a)b[a-2]=arguments[a];d=Number(d);e=Number(e);for(var c=Math.max(Math.abs(d),Math.abs(e)),G=$jscomp.makeIterator(b),a=G.next();!a.done;a=G.next())c=Math.max(c,Math.abs(a.value));if(1E100<c||1E-100>c){d/=c;e/=c;G=d*d+e*e;b=$jscomp.makeIterator(b);for(a=b.next();!a.done;a=b.next())a=a.value,a=Number(a)/c,G+=a*a;return Math.sqrt(G)*c}c=d*d+e*e;b=$jscomp.makeIterator(b);for(a=b.next();!a.done;a=b.next())a=a.value,a=Number(a),c+=
a*a;return Math.sqrt(c)};$jscomp.math.trunc=function(d){d=Number(d);if(isNaN(d)||Infinity===d||-Infinity===d||0===d)return d;var e=Math.floor(Math.abs(d));return 0>d?-e:e};$jscomp.math.cbrt=function(d){if(0===d)return d;d=Number(d);var e=Math.pow(Math.abs(d),1/3);return 0>d?-e:e};$jscomp.number=$jscomp.number||{};$jscomp.number.isFinite=function(d){return"number"!==typeof d?!1:!isNaN(d)&&Infinity!==d&&-Infinity!==d};
$jscomp.number.isInteger=function(d){return $jscomp.number.isFinite(d)?d===Math.floor(d):!1};$jscomp.number.isNaN=function(d){return"number"===typeof d&&isNaN(d)};$jscomp.number.isSafeInteger=function(d){return $jscomp.number.isInteger(d)&&Math.abs(d)<=$jscomp.number.MAX_SAFE_INTEGER};$jscomp.number.EPSILON=Math.pow(2,-52);$jscomp.number.MAX_SAFE_INTEGER=9007199254740991;$jscomp.number.MIN_SAFE_INTEGER=-9007199254740991;$jscomp.object=$jscomp.object||{};
$jscomp.object.assign=function(d,e){for(var k=[],b=1;b<arguments.length;++b)k[b-1]=arguments[b];k=$jscomp.makeIterator(k);for(b=k.next();!b.done;b=k.next())if(b=b.value)for(var a in b)Object.prototype.hasOwnProperty.call(b,a)&&(d[a]=b[a]);return d};$jscomp.object.is=function(d,e){return d===e?0!==d||1/d===1/e:d!==d&&e!==e};$jscomp.Set=function(d){d=void 0===d?[]:d;this.map_=new $jscomp.Map;if(d){d=$jscomp.makeIterator(d);for(var e=d.next();!e.done;e=d.next())this.add(e.value)}this.size=this.map_.size};
$jscomp.Set.checkBrowserConformance_=function(){var d=$jscomp.global.Set;if(!d||!d.prototype.entries||!Object.seal)return!1;var e=Object.seal({x:4}),d=new d($jscomp.makeIterator([e]));if(d.has(e)||1!=d.size||d.add(e)!=d||1!=d.size||d.add({x:4})!=d||2!=d.size)return!1;var d=d.entries(),k=d.next();if(k.done||k.value[0]!=e||k.value[1]!=e)return!1;k=d.next();return k.done||k.value[0]==e||4!=k.value[0].x||k.value[1]!=k.value[0]?!1:d.next().done};
$jscomp.Set.prototype.add=function(d){this.map_.set(d,d);this.size=this.map_.size;return this};$jscomp.Set.prototype["delete"]=function(d){d=this.map_["delete"](d);this.size=this.map_.size;return d};$jscomp.Set.prototype.clear=function(){this.map_.clear();this.size=0};$jscomp.Set.prototype.has=function(d){return this.map_.has(d)};$jscomp.Set.prototype.entries=function(){return this.map_.entries()};$jscomp.Set.prototype.values=function(){return this.map_.values()};
$jscomp.Set.prototype.forEach=function(d,e){var k=this;this.map_.forEach(function(b){return d.call(e,b,b,k)})};$jscomp.Set.ASSUME_NO_NATIVE=!1;$jscomp.Set$install=function(){!$jscomp.Set.ASSUME_NO_NATIVE&&$jscomp.Set.checkBrowserConformance_()?$jscomp.Set=$jscomp.global.Set:($jscomp.Map$install(),$jscomp.initSymbol(),$jscomp.initSymbolIterator(),$jscomp.Set.prototype[Symbol.iterator]=$jscomp.Set.prototype.values);$jscomp.Set$install=function(){}};$jscomp.string=$jscomp.string||{};
$jscomp.string.noRegExp_=function(d,e){if(d instanceof RegExp)throw new TypeError("First argument to String.prototype."+e+" must not be a regular expression");};
$jscomp.string.fromCodePoint=function(d){for(var e=[],k=0;k<arguments.length;++k)e[k-0]=arguments[k];for(var k="",e=$jscomp.makeIterator(e),b=e.next();!b.done;b=e.next()){b=b.value;b=+b;if(0>b||1114111<b||b!==Math.floor(b))throw new RangeError("invalid_code_point "+b);65535>=b?k+=String.fromCharCode(b):(b-=65536,k+=String.fromCharCode(b>>>10&1023|55296),k+=String.fromCharCode(b&1023|56320))}return k};
$jscomp.string.repeat=function(d){var e=this.toString();if(0>d||1342177279<d)throw new RangeError("Invalid count value");d|=0;for(var k="";d;)if(d&1&&(k+=e),d>>>=1)e+=e;return k};$jscomp.string.repeat$install=function(){String.prototype.repeat||(String.prototype.repeat=$jscomp.string.repeat)};
$jscomp.string.codePointAt=function(d){var e=this.toString(),k=e.length;d=Number(d)||0;if(0<=d&&d<k){d|=0;var b=e.charCodeAt(d);if(55296>b||56319<b||d+1===k)return b;d=e.charCodeAt(d+1);return 56320>d||57343<d?b:1024*(b-55296)+d+9216}};$jscomp.string.codePointAt$install=function(){String.prototype.codePointAt||(String.prototype.codePointAt=$jscomp.string.codePointAt)};
$jscomp.string.includes=function(d,e){e=void 0===e?0:e;$jscomp.string.noRegExp_(d,"includes");return-1!==this.toString().indexOf(d,e)};$jscomp.string.includes$install=function(){String.prototype.includes||(String.prototype.includes=$jscomp.string.includes)};
$jscomp.string.startsWith=function(d,e){e=void 0===e?0:e;$jscomp.string.noRegExp_(d,"startsWith");var k=this.toString();d+="";for(var b=k.length,a=d.length,c=Math.max(0,Math.min(e|0,k.length)),G=0;G<a&&c<b;)if(k[c++]!=d[G++])return!1;return G>=a};$jscomp.string.startsWith$install=function(){String.prototype.startsWith||(String.prototype.startsWith=$jscomp.string.startsWith)};
$jscomp.string.endsWith=function(d,e){$jscomp.string.noRegExp_(d,"endsWith");var k=this.toString();d+="";void 0===e&&(e=k.length);for(var b=Math.max(0,Math.min(e|0,k.length)),a=d.length;0<a&&0<b;)if(k[--b]!=d[--a])return!1;return 0>=a};$jscomp.string.endsWith$install=function(){String.prototype.endsWith||(String.prototype.endsWith=$jscomp.string.endsWith)};
(function(d,e){"object"===typeof exports&&"object"===typeof module?module.exports=e():"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports.CitrixWebRTC=e():d.CitrixWebRTC=e()})(self,function(){return function(){function d(b){var a=k[b];if(void 0!==a)return a.exports;a=k[b]={exports:{}};e[b].call(a.exports,a,a.exports,d);return a.exports}var e={945:function(b,a,c){var d=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof
Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return a(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c);b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(a,"__esModule",{value:!0});var v=c(658),r=c(550),n=c(851),g=c(946);b=function(a){function b(){var c=a.call(this,null,r.class_id_t.AudioElement,0,v.ProxyMode.Local)||this;c.sinkId_="";c.srcObject_=null;return c}d(b,a);b.prototype.setSinkId=
function(a){var b=this;n.logger.log(this.user_friendly_id()+".setSinkId: set sinkId to "+a);return new Promise(function(c,d){b.waitUntilConnected("AudioElement.sinkId").then(function(){var d=b.remoteInvoke(!0,r.method_id_AudioElement_t.sinkId,a);g.getRedirector().getFeatureValue(r.FEATURE_ms_teams_pstn)||(b.sinkId_=a,c());return d}).then(function(){n.logger.log(b.user_friendly_id()+".setSinkId: success! resolving...");b.sinkId_=a;c()})["catch"](function(a){a=b.logRemoteInvokeError(a,".sinkId setter: failed to connect!");
d(a)})})};Object.defineProperty(b.prototype,"sinkId",{get:function(){return this.sinkId_},set:function(a){this.setSinkId(a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"srcObject",{get:function(){return this.srcObject_},set:function(a){var b=this;n.logger.log(this.user_friendly_id()+".srcObject: set srcObject to "+JSON.stringify(a));if(a!==this.srcObject_){this.srcObject_=a;var c=null!==a&&void 0!==a?a.id:"null";this.waitUntilConnected("AudioElement.srcObject").then(function(){return b.remoteInvoke(!0,
r.method_id_AudioElement_t.srcObject,c)}).then(function(){n.logger.log(b.user_friendly_id()+".srcObject setter: remote success!")})["catch"](function(a){b.logRemoteInvokeError(a,".srcObject setter: failed to connect!")})}},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"src",{get:function(){return this.src_},set:function(a){var b=this;n.logger.log(this.user_friendly_id()+".src: set src to "+a);this.src_=a;this.waitUntilConnected("AudioElement.src").then(function(){b.remoteInvoke(!0,
r.method_id_AudioElement_t.src,a)})["catch"](function(a){b.logRemoteInvokeError(a,".src setter: failed to connect!")})},enumerable:!0,configurable:!0});b.prototype.play=function(){var a=this;n.logger.log(this.user_friendly_id()+".play() called.");return new Promise(function(b,c){a.toggleAudio(!0);a.waitUntilConnected("AudioElement.play").then(function(){a.remoteInvoke(!1,r.method_id_AudioElement_t.play,[]).then(function(){b()})["catch"](function(b){a.logRemoteInvokeError(b,".play: failed to remote!");
c()})})["catch"](function(b){a.logRemoteInvokeError(b,".play: failed to connect!");c()})})};b.prototype.pause=function(){var a=this;n.logger.log(this.user_friendly_id()+".pause() called.");return new Promise(function(b,c){a.toggleAudio(!1);a.waitUntilConnected("AudioElement.pause").then(function(){a.remoteInvoke(!1,r.method_id_AudioElement_t.pause,[]).then(function(){b()})["catch"](function(b){a.logRemoteInvokeError(b,".pause: failed to remote!");c()})})["catch"](function(b){a.logRemoteInvokeError(b,
".pause: failed to connect!");c()})})};b.prototype.toggleAudio=function(a){this.srcObject_&&(n.logger.log(this.user_friendly_id()+".toggleAudio() toggle audio tracks:"+a),this.srcObject_.toggleAudio(a))};b.prototype.dispose=function(){n.logger.log(this.user_friendly_id()+".dispose()");this.src_=this.sinkId_="";this.srcObject_=null;this.release()};return b}(v.ProxyObject);a.AudioElement=b},9:function(b,a,c){var d=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof
Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return a(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c);b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(a,"__esModule",{value:!0});var v=c(550),r=c(946),n=c(658),g=c(851);(function(a){a[a.Webrpc=0]="Webrpc";a[a.WebrtcCodecs=1]="WebrtcCodecs";a[a.Receiver=2]="Receiver";a[a.Vda=3]="Vda";a[a.Endpoint=4]="Endpoint";a[a.TypeScript=5]="TypeScript";
a[a.Max=6]="Max"})(a.VersionType||(a.VersionType={}));b=function(a){function b(){return a.call(this,null,v.class_id_t.EngineControl,0,n.ProxyMode.Local)||this}d(b,a);b.prototype.bind=function(){g.logger.log(this.user_friendly_id()+".bind() called.");this.reconstructor(null,v.class_id_t.EngineControl,0)};b.prototype.syncBarrier=function(){var a=this;g.logger.log(this.user_friendly_id()+".syncBarrier() called.");return new Promise(function(b,c){a.waitUntilConnected("EngineControl.syncBarrier").then(function(){return Promise.all([a.remoteInvoke(!1,
v.method_id_EngineControl_t.version,{major:0,minor:0,revision:0,build:0}),a.remoteInvoke(!1,v.method_id_EngineControl_t.feature_flags,[])])}).then(function(b){g.logger.log(a.user_friendly_id()+"received webrpc version and supported feature list.");b=b.map(function(b){return a.param0(b)});a.version_=b[0];a.features_=b[1];r.getRedirector().setFeatures(a.features_);b=[];for(var c=0,t=a.features_;c<t.length;c++){var h=t[c];"ms_teams_desktop_sharing"===h.name&&h.value?b.push(a.remoteInvoke(!1,v.method_id_EngineControl_t.version_info,
[])):"ms_teams_osinfo"===h.name&&h.value?b.push(a.remoteInvoke(!1,v.method_id_EngineControl_t.osinfo,{family:"",version:"",architecture:"",distro:"",edition:""})):"ms_teams_endpoint_id"===h.name&&h.value&&b.push(a.remoteInvoke(!1,v.method_id_EngineControl_t.endpoint_id,{machine_id:"",user_id:""}))}if(0<b.length)return Promise.all(b)}).then(function(c){if(void 0===c)g.logger.log(a.user_friendly_id()+"release-1905 client.");else{g.logger.log(a.user_friendly_id()+"release-1906 or later client: received detailed client version list.");
for(var d=0;d<c.length;d++){var t=c[d];t.hdr.proc.iid==v.class_id_t.EngineControl&&t.hdr.proc.methodid==v.method_id_EngineControl_t.version_info?a.versions_=a.param0(t):t.hdr.proc.iid==v.class_id_t.EngineControl&&t.hdr.proc.methodid==v.method_id_EngineControl_t.osinfo?a.osinfo_=a.param0(t):t.hdr.proc.iid==v.class_id_t.EngineControl&&t.hdr.proc.methodid==v.method_id_EngineControl_t.endpoint_id&&(a.endpointid_=a.param0(t))}}b(a)})["catch"](function(b){b=a.logRemoteInvokeError(b,"failure to retrieve version/feature related client info.");
c(b)})})};return b}(n.ProxyObject);a.EngineControl=b},368:function(b,a,c){Object.defineProperty(a,"__esModule",{value:!0});var d=c(851),v=c(946);b=function(){function a(){var b=this;this.running_=!1;this.elements_=[];this.clipRects=new Set;this.wheelEventHandler=function(a){setTimeout(function(){b.updateAll()},10)};this.keyupEventHandler=function(a){"Tab"!=a.code&&"ArrowUp"!=a.code&&"ArrowDown"!=a.code&&"ArrowLeft"!=a.code&&"ArrowRight"!=a.code&&"PageUp"!=a.code&&"PageDown"!=a.code&&"Home"!=a.code&&
"End"!=a.code||b.updateAll()};a.sendOverlayInfo();this.observer_=new MutationObserver(function(a){b.updateAll()})}a.sendOverlayInfo=function(){var a=window.getWindowHandleAsHex;if(void 0===a||null===a)d.logger.log("FrameTracker.sendOverlayInfo: getWindowHandle method is undefined or null");else{var b=v.getRedirector();Promise.all([a(),b.startRedirection(!1,"sendOverlayInfo")]).then(function(a){d.logger.log("FrameTracker.sendOverlayInfo: set window handle: "+a[0]);b.WSSendObject({v:"overlay",command:"window",
windowHandle:a[0]})})}};a.prototype.rectanglesIntersect=function(a,b){return a.x<b.x+b.width&&a.x+a.width>b.x&&a.y<b.y+b.height&&a.y+a.height>b.y?!0:!1};a.prototype.intersectingRect=function(a,b){var c=Math.max(a.left,b.left),d=Math.max(a.top,b.top);return new DOMRect(c,d,Math.min(a.right,b.right)-c,Math.min(a.bottom,b.bottom)-d)};a.prototype.pedigreeCount=function(a,b){for(var c=0,d=a.parentElement;null!=d&&d!=b;)c++,d=d.parentElement;return{isAncestor:null!=d,pedigree:c}};a.prototype.selectTopmost=
function(a,b){var c=a.getBoundingClientRect(),d=b.getBoundingClientRect(),c=this.intersectingRect(c,d),d=document.elementFromPoint(c.left+c.width/2,c.top+c.height/2);if(d==a)return a;if(d==b)return b;c=this.pedigreeCount(a,d);d=this.pedigreeCount(b,d);if(c.isAncestor&&d.isAncestor){if(c.pedigree<d.pedigree)return a;if(d.pedigree<c.pedigree)return b}else{if(c.isAncestor)return a;if(d.isAncestor)return b}};a.prototype.checkOverlappingVideos=function(a){var b=this,c=a.target.getBoundingClientRect();
a.overlaps.forEach(function(b){a.target.remoteVideoElement.removeClipRect(b.rect)});a.overlaps=[];this.elements_.forEach(function(d){if(d!=a){var r=d.overlaps.map(function(a){return a.element}).indexOf(a.target);-1!=r&&(r=d.overlaps.splice(r,1)[0],d.target.remoteVideoElement.removeClipRect(r.rect));r=d.target.getBoundingClientRect();if(b.rectanglesIntersect(c,r)){var x=b.selectTopmost(a.target,d.target);x==a.target?(d.overlaps.push({element:a.target,rect:c}),d.target.remoteVideoElement.addClipRect(c)):
x==d.target&&(a.overlaps.push({element:d.target,rect:r}),a.target.remoteVideoElement.addClipRect(r))}}})};a.prototype.updateAll=function(){var a=this;this.elements_.forEach(function(b){var c=b.target.getBoundingClientRect();if(void 0!==c){var d=b.clientRect;if(void 0===d||d.x!==c.x||d.y!==c.y||d.width!==c.width||d.height!==c.height)b.clientRect=c,b.callback(c),a.checkOverlappingVideos(b)}})};a.prototype.track=function(a,b){var c=this,f=a.getBoundingClientRect();d.logger.log("Track element frame",
a,JSON.stringify(f));console.log(a);this.elements_.push({target:a,clientRect:void 0,callback:b,overlaps:[]});try{d.logger.log("[HdxWebRTC.js] Initializing occlusion for new videoElement"),this.clipRects.forEach(function(b){c.applyOcclusion(a,JSON.parse(b))})}catch(r){d.logger.log("[HdxWebRTC.js] addOcclusionInit failed! "+r)}this.running_||(d.logger.log("Start FrameTracker observer..."),this.observer_.observe(document.body,{attributes:!0,childList:!0,subtree:!0}),window.addEventListener("wheel",this.wheelEventHandler),
window.addEventListener("keyup",this.keyupEventHandler),this.running_=!0);this.updateAll()};a.prototype.untrack=function(a){d.logger.log("Untrack element frame",a);var b=-1;this.elements_.forEach(function(c,d){c.target===a&&(b=d)});0<=b&&(this.elements_.splice(b,1),0===this.elements_.length&&(d.logger.log("Stop FrameTracker observer..."),this.observer_.disconnect(),window.removeEventListener("wheel",this.wheelEventHandler),window.removeEventListener("keyup",this.keyupEventHandler),this.running_=!1))};
a.prototype.applyOcclusion=function(a,b){var c=a.getBoundingClientRect();this.rectanglesIntersect(b,c)&&void 0!==a.remoteVideoElement&&a.remoteVideoElement.addClipRect(b)};a.prototype.addOcclusion=function(a){var b=this;d.logger.log("[HdxWebRTC.js] Adding occlusion "+JSON.stringify(a));d.logger.log("[HdxWebRTC.js] Tracking '"+this.elements_.length+"' elements.");this.clipRects.add(JSON.stringify(a));this.elements_.forEach(function(c){b.applyOcclusion(c.target,a)})};a.prototype.removeOcclusion=function(a){d.logger.log("[HdxWebRTC.js] Removing occlusion "+
JSON.stringify(a));d.logger.log("[HdxWebRTC.js] Tracking '"+this.elements_.length+"' elements.");this.clipRects["delete"](JSON.stringify(a));this.elements_.forEach(function(b){void 0!==b.target.remoteVideoElement&&b.target.remoteVideoElement.removeClipRect(a)})};return a}();a.FrameTracker=b},247:function(b,a){Object.defineProperty(a,"__esModule",{value:!0});var c=function(){function a(b){this.parent_=this.object_=null;this.children_=[];this.object_=b}a.prototype.addChild=function(a){a.parent_!=this&&
(a.parent_=this,this.children_.push(a))};a.prototype.removeChild=function(a){var b=this.children_.indexOf(a);this.children_.splice(b,1);a.parent_=null};return a}(),d=function(){function a(){this.root_=new c(null)}a.prototype.trackObject=function(a,b){void 0===b&&(b=null);if(null===this.findNode(a,this.root_)){var d=this.findNode(b,this.root_),p=new c(a);d?d.addChild(p):this.root_.addChild(p)}};a.prototype.releaseObject=function(a){a=this.findNode(a,this.root_);if(null===a||a===this.root_)return!1;
this.destroyNodeObjectRecurse(a);a.parent_.removeChild(a);return!0};a.prototype.destroyNodeObjectRecurse=function(a){for(var b=0,c=a.children_;b<c.length;b++)this.destroyNodeObjectRecurse(c[b]);a.object_.destroy()};a.prototype.setParent=function(a,b){var c=this.findNode(a,this.root_);if(null===c)return!1;var d=this.findNode(b,this.root_);if(null===d)return!1;if(c.parent_===d)return!0;c.parent_.removeChild(c);d.addChild(c);return!0};a.prototype.reset=function(){this.root_.children_=[]};a.prototype.findNode=
function(a,b){if(b.object_===a)return b;for(var c=null,d=0,f=b.children_;d<f.length&&(c=this.findNode(a,f[d]),null===c);d++);return c};return a}();a.GC=d;a.gc=new d},946:function(b,a,c){Object.defineProperty(a,"__esModule",{value:!0});var d=c(658),v=c(851),r=c(550),n=c(545),g=c(394),p=c(509),f=function(){return function(a,b,c,d,m,f,g){this.resolve=a;this.reject=b;this.iid=c;this.oid=d;this.cbid=m;this.oneShot=f;this.mid=g}}(),e;(function(a){a[a.rpc_status_success=0]="rpc_status_success";a[a.rpc_status_unspecified_error=
1]="rpc_status_unspecified_error";a[a.rpc_status_unexpected=2]="rpc_status_unexpected";a[a.rpc_status_index_out_of_bounds=3]="rpc_status_index_out_of_bounds";a[a.rpc_status_missing_parameter=4]="rpc_status_missing_parameter";a[a.rpc_status_missing_return_value=5]="rpc_status_missing_return_value";a[a.rpc_status_invalid_object=6]="rpc_status_invalid_object";a[a.rpc_status_user_exception=7]="rpc_status_user_exception";a[a.rpc_status_system_error=8]="rpc_status_system_error"})(e=a.WebrpcStatusCode||
(a.WebrpcStatusCode={}));var x;(function(a){a[a.NotRedirected=0]="NotRedirected";a[a.Connecting=1]="Connecting";a[a.Binding=2]="Binding";a[a.Redirected=3]="Redirected"})(x=a.RedirectionStatus||(a.RedirectionStatus={}));b=function(){function a(){this.pingactive=!1;this.status=x.NotRedirected;this.reqs=[];this.cbs=[];this.deferredActions=[];this.telemetry_=new g.Telemetry;this.screenshare_=new p.ScreenShareUtil;this.stateChangeNotifcations=[];this.vdafeatures_=[]}Object.defineProperty(a.prototype,"telemetry",
{get:function(){return this.telemetry_},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"screenshare",{get:function(){return this.screenshare_},enumerable:!0,configurable:!0});a.prototype.stopAppshare=function(){var a=window.stopAppshare;a&&a()};a.prototype.setRemoteSessionInfoCb=function(a){this.remoteSessionInfoCb=a};a.prototype.setFeatures=function(a){this.features=a;this.screenshare.onInitComplete()};a.prototype.getFeatureValue=function(a){var b=this.features.find(function(b){return b.name===
a});return void 0!==b?b.value:!1};a.prototype.onRedirectionComplete=function(){for(;this.deferredActions&&0<this.deferredActions.length;)this.deferredActions.shift().post(this.status==x.Redirected)};a.prototype.connectToService=function(){v.logger.log("Redirection status: Connecting...");this.status=x.Connecting;return new Promise(function(a,b){var c=new WebSocket("wss://127.0.0.1:9002");c.onopen=function(){a(c)};c.onerror=function(a){v.logger.log("websocket connection error: "+a.type);b(a)}})};a.prototype.waitUntilRedirected=
function(a){var b=this;return new Promise(function(c,d){b.status==x.Redirected?c():0>=a?d():setTimeout(function(){v.logger.log("waitUntilRedirected() timeout. count="+a);b.status!=x.Redirected?b.waitUntilRedirected(--a).then(function(){c()})["catch"](function(){d()}):c()},2E3)})};a.prototype.handleRemoteSessionInfo=function(){var a=this;v.logger.log("handleRemoteSessionInfo called.");var b=this;b.remoteSessionInfoCb?b.remoteSessionInfoCb().then(function(c){v.logger.log("remoteSessionInfo success! info:"+
JSON.stringify(c));v.logger.log("Redirection status: Redirected");b.status=x.Redirected;b.pingConnectionEnd();(0,window.onVdiClientConnected)();a.telemetry.SendTelemetryInit();b.onRedirectionComplete()})["catch"](function(){v.logger.log("remoteSessionInfo failure!");b.suspendRedirection(!0);b.onRedirectionComplete()}):(v.logger.log("remoteSessionInfoCb is invalid!"),b.suspendRedirection(!0),b.onRedirectionComplete())};a.prototype.startRedirection=function(a,b){var c=this,m=window.onVdiClientDisconnected;
return new Promise(function(f,g){c.status!=x.Redirected?(v.logger.log("Attempting to start redirection: "+b),!1===a?c.deferredActions.push(new d.deferred_action(f,g,b)):c.connectToService().then(function(a){v.logger.log("Redirection status: Binding...");c.status=x.Binding;c.websocket=a;c.websocket.onmessage=function(a){c.onWSMessage(a)};c.websocket.onclose=function(a){c.onWSClose(a)};f();c.handleRemoteSessionInfo()})["catch"](function(a){v.logger.log("Unable to connect to websocket service!");g();
c.suspendRedirection(!0);c.onRedirectionComplete();m(!0)})):(v.logger.log("Redirection already started."),f())})};a.prototype.suspendRedirection=function(a){var b=this;v.logger.log("Suspending redirection.");(0,window.onVdiClientDisconnected)(!1);var c=!1;a=window.getCitrixMSTeamsRedir;var d=window.getCitrixWebrtcRedir,m;a?m=a:d&&(m=d);m&&m().then(function(a){v.logger.log("sucesss on disconnect"+a);"1"==a&&(c=!0,v.logger.log("Reg key exists while disconnecting"));b.status===x.Redirected&&1==c&&(v.logger.log("Calling ping not normal disconnect"),
b.pingConnectionBegin(!1));v.logger.log("Redirection status: NotRedirected");b.status=x.NotRedirected})["catch"](function(){v.logger.log("Failure to Read MS Teams redir Reg Key, not retrying...")});this.dispatchStateChangeNotifications()};a.prototype.onWSOpen=function(){};a.prototype.onWSClose=function(a){v.logger.log("disconnected from websocket service.");try{this.suspendRedirection(!0)}catch(b){v.logger.log("suspendRedirection(): exception closing WebSocket: "+b.message)}};a.prototype.onWSError=
function(){try{this.suspendRedirection(!0)}catch(a){v.logger.log("suspendRedirection(): exception on WebSocket error: "+a.message)}};a.prototype.WSSendObjectWrapper=function(a,b,c,d){var m=!0;b!=r.class_id_t.EngineControl||c!=r.method_id_EngineControl_t.ctor&&c!=r.method_id_EngineControl_t.version&&c!=r.method_id_EngineControl_t.feature_flags||(m=!1);var f=!0;if(m&&(f=!1,void 0!=this.features))for(var m=0,u=this.features;m<u.length;m++){var q=u[m];if(!0===q.value&&q.name==a){f=!0;break}}return 1==
f?this.WSSendObject(d):Promise.reject("Cannot invoke method that is not supported by webrpc: iid("+b+") mid("+c+")")};a.prototype.WSSendObject=function(a){var b=this;return new Promise(function(c,d){if("webrtc"==a.v){var m=a.hdr.proc.iid,g=a.hdr.proc.methodid,u=a.objref.oid;a.hdr.destroy||(m=new f(c,d,m,u,0,!0,g),b.reqs.push(m));m=JSON.stringify(a);v.logger.trace("WSSendObject: >>> "+r.WebrpcClassLibInfoUtil.composeClassInfoData(a)+" "+m);try{b.websocket.send(m)}catch(q){v.logger.log("WSSendObject(): exception: "+
q.message),d(q.message)}}else if("overlay"==a.v){m=JSON.stringify(a);v.logger.log("HDXMS: SendOverlayData: >>> "+m+"'");try{b.websocket.send(m)}catch(q){v.logger.log("WSSendObject(): exception: "+q.message),d(q.message)}}else if("telemetry"==a.v){m=JSON.stringify(a);v.logger.log("HDXMS: SendTelemetryData: >>> "+m+"'");try{b.websocket.send(m)}catch(q){v.logger.log("WSSendObject(): exception: "+q.message),d(q.message)}}else if("appsharing"==a.v){m=JSON.stringify(a);v.logger.log("HDXMS: SendScreenSharingData: >>> "+
m+"'");try{b.websocket.send(m)}catch(q){v.logger.log("WSSendObject(): exception: "+q.message),d(q.message)}}else v.logger.log("HDXMS: Unknown protocol: '"+JSON.stringify(a)+"'")})};a.prototype.webrpcStatusCodeToName=function(a){switch(a){case e.rpc_status_success:a="rpc_status_success";break;case e.rpc_status_unspecified_error:a="rpc_status_unspecified_error";break;case e.rpc_status_unexpected:a="rpc_status_unexpected";break;case e.rpc_status_index_out_of_bounds:a="rpc_status_index_out_of_bounds";
break;case e.rpc_status_missing_parameter:a="rpc_status_missing_parameter";break;case e.rpc_status_missing_return_value:a="rpc_status_missing_return_value";break;case e.rpc_status_invalid_object:a="rpc_status_invalid_object";break;case e.rpc_status_user_exception:a="rpc_status_user_exception";break;case e.rpc_status_system_error:a="rpc_status_system_error";break;default:a="unknown"}return a};a.prototype.parceWebrpcError=function(a,b){void 0===a&&(a=b&&0<b.length?b[0].category||b[0].code||b[0].message?
e.rpc_status_system_error:e.rpc_status_user_exception:e.rpc_status_unspecified_error);var c;switch(a){case e.rpc_status_unspecified_error:case e.rpc_status_unexpected:case e.rpc_status_index_out_of_bounds:case e.rpc_status_missing_parameter:case e.rpc_status_missing_return_value:case e.rpc_status_invalid_object:c=new DOMException(this.webrpcStatusCodeToName(a),this.webrpcStatusCodeToName(a));break;case e.rpc_status_user_exception:c=b&&0<b.length?new DOMException(b[0],this.webrpcStatusCodeToName(a)):
new DOMException(this.webrpcStatusCodeToName(a),this.webrpcStatusCodeToName(a));break;case e.rpc_status_system_error:if(b&&0<b.length){c=Object.create(DOMException);var d={value:null,writable:!0,enumerable:!1,Configurable:!0};d.value=b[0].category;Object.defineProperty(c,"name",d);d.value=b[0].code;Object.defineProperty(c,"code",d);d.value=b[0].message;Object.defineProperty(c,"message",d)}else c=new DOMException(this.webrpcStatusCodeToName(a),this.webrpcStatusCodeToName(a))}return c};a.prototype.onWSMessage=
function(a){var b=a.data,c;try{c=JSON.parse(b)}catch(q){console.log("invalid JSON!!!");console.log(q);console.log(b);return}if("webrtc"==c.v){v.logger.trace("onWSMessage: <<< "+r.WebrpcClassLibInfoUtil.composeClassInfoData(c)+" "+b);var d=c.hdr.proc.iid,m=c.hdr.proc.methodid,f=c.objref.oid;a=c.status;if(c.hdr.msg_type==n.WsJsonUtil.getMsgType(n.ws_msg_type_t.reply))b=this.reqs.findIndex(function(a){return a.iid==d&&a.oid==f&&a.mid==m}),0<=b?0==a?this.reqs.splice(b,1).shift().resolve(c):(c=this.parceWebrpcError(a,
c.params),this.reqs.splice(b,1).shift().reject(c)):(v.logger.log("HDXMS didnt find this one. (reqs)"),v.logger.log(this.reqs));else if(c.hdr.msg_type==n.WsJsonUtil.getMsgType(n.ws_msg_type_t.event_req)){var u=c.func.id,b=this.cbs.findIndex(function(a){return a.iid==d&&a.oid==f&&a.cbid==u>>16});0<=b?(0==(u&65535)?this.cbs[b].resolve(c):(c=this.parceWebrpcError(a,c.params),this.cbs[b].reject(c)),1==this.cbs[b].oneShot&&this.cbs.splice(b,1)):(v.logger.log("HDXMS didnt find this one. (cbs)"),v.logger.log(this.cbs))}else v.logger.log("HDXMS Received bogus message: "+
b+"'")}else if("telemetry"==c.v)0==c.status&&(a=c.hdr.command,2==(a&2147483647)&&(b=c.hdr.id,this.telemetry.onInitialized(b),v.logger.log("Telemetry init response received")));else if("features"==c.v){a=c.features;if("feature-support"==c.command)for(v.logger.log("features capabilities received, features:"+a),this.vdafeatures_=a,b=0;b<a.length;b++)if(a[b]===r.FEATURE_vda_app_sharing)this.screenshare.onInitialized(!0);this.clientViewportMode_=c.client_viewport_mode;v.logger.log("features client_viewport_mode value: "+
this.clientViewportMode_)}else"appsharing"==c.v?(a=c.status,0==a?(a=c.hdr.command,b=c.hdr.id,(a&2147483647)==p.sshare_cmd.GetSources?(v.logger.log("appsharing GetSources response received"),this.screenshare.onGetSources(b,c.data)):(a&2147483647)==p.sshare_cmd.SetActive?(v.logger.log("appsharing SetActive response received"),this.screenshare.onSetActive(b,c.data)):(a&2147483647)==p.sshare_cmd.TopologyChanged?(v.logger.log("appsharing Window topology changed cmd received"),this.screenshare.onToplogyChanged()):
(v.logger.log("invalid command reply:"+a),this.screenshare.onError(b))):(v.logger.log("invalid status reply:"+a),b=c.hdr.id,this.screenshare.onError(b))):v.logger.log("HDXMS: Unknown protocol: "+b+"'")};a.prototype.clearReqs=function(){v.logger.log("clearReqs()");this.reqs.forEach(function(a,b){a.reject()});this.reqs=[]};a.prototype.registerHandler=function(a,b,c){a=new f(c.resolve.bind(c),c.reject.bind(c),a,b,c.id,c.oneShot,0);this.cbs.push(a)};a.prototype.unregisterHandler=function(a,b,c){var d=
this.cbs.findIndex(function(d){return d.iid==a&&d.oid==b&&d.cbid==c});0<=d?this.cbs.splice(d,1):(v.logger.log("HDXMS Didnt find this callback in the list!"),console.log(this.cbs))};a.prototype.isRedirected=function(){return this.status===x.Redirected||this.status===x.Binding||this.status===x.Connecting};a.prototype.isConnected=function(){return this.status==x.Redirected};a.prototype.isPingActive=function(){return this.pingactive};a.prototype.pingConnectionBegin=function(a){v.logger.log("Started timer");
this.pingactive=!0;var b=window.onVdiClientDisconnectedTimer;1==a?(v.logger.log("checking if we are connected..."),b()):this.conntimer=setTimeout(function(){v.logger.log("checking if we are connected...");b()},15E3)};a.prototype.pingConnectionEnd=function(){this.pingactive=!1;clearTimeout(this.conntimer)};a.prototype.SendTelemetryData_Speaker=function(a){this.telemetry.SendTelemetryData(g.tel_cmd.Data,g.tel_key_SpeakerDeviceUsed,a,0)};a.prototype.registerStateChangeNotification=function(a){this.stateChangeNotifcations.push(a)};
a.prototype.unregisterStateChangeNotification=function(a){this.stateChangeNotifcations=this.stateChangeNotifcations.filter(function(b){return b!=a})};a.prototype.dispatchStateChangeNotifications=function(){this.stateChangeNotifcations.forEach(function(a){a()})};a.prototype.vdabufferNoLimit=function(){for(var a=!1,b=0,c=this.vdafeatures_;b<c.length;b++)if(c[b]===r.FEATURE_vda_service_no_buffer_limit){a=!0;break}return a};Object.defineProperty(a.prototype,"clientViewportMode",{get:function(){return this.clientViewportMode_||
"unknown"},enumerable:!0,configurable:!0});return a}();a.HdxMediaStream=b;var m=new b;a.getRedirector=function(){return m}},985:function(b,a,c){var d=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return a(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c);b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),
e=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var a=Array(a),d=0,b=0;b<c;b++)for(var m=arguments[b],g=0,n=m.length;g<n;g++,d++)a[d]=m[g];return a};Object.defineProperty(a,"__esModule",{value:!0});var r=c(658),n=c(550),g=c(851);b=function(a){function b(c,d,m){for(var g=[],f=3;f<arguments.length;f++)g[f-3]=arguments[f];return a.apply(this,e([c,n.class_id_t.RTCIceCandidate,d,m,null],g))||this}d(b,a);Object.defineProperty(b.prototype,"candidate",
{get:function(){return this.candidate_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"sdpMid",{get:function(){return this.sdpMid_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"sdpMLineIndex",{get:function(){return this.sdpMLineIndex_},enumerable:!0,configurable:!0});b.prototype.syncBarrier=function(){var a=this;g.logger.log(this.user_friendly_id()+".syncBarrier() called.");return new Promise(function(b,c){a.waitUntilConnected("IceCandidate.syncBarrier").then(function(){return Promise.all([a.remoteInvoke(!1,
n.method_id_RTCIceCandidate_t.candidate,""),a.remoteInvoke(!1,n.method_id_RTCIceCandidate_t.sdpMid,""),a.remoteInvoke(!1,n.method_id_RTCIceCandidate_t.sdpMLineIndex,0)])}).then(function(c){c=c.map(function(b){return a.param0(b)});a.candidate_=c[0];a.sdpMid_=c[1];a.sdpMLineIndex_=c[2];b(a)})["catch"](function(b){b=a.logRemoteInvokeError(b,".syncBarrier failed!");c(b)})})};return b}(r.ProxyObject);a.IceCandidate=b;b=function(a){function b(c,d){return a.call(this,c,n.class_id_t.RTCIceCandidatePair,d,
r.ProxyMode.Remote)||this}d(b,a);Object.defineProperty(b.prototype,"local",{get:function(){return this.local_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"remote",{get:function(){return this.remote_},enumerable:!0,configurable:!0});b.prototype.syncBarrier=function(){var a=this;g.logger.log(this.user_friendly_id()+".syncBarrier() called.");return new Promise(function(b,c){a.waitUntilConnected("IceCandidatePair.syncBarrier").then(function(){return Promise.all([a.remoteInvoke(!1,
n.method_id_RTCIceCandidatePair_t.local,{}),a.remoteInvoke(!1,n.method_id_RTCIceCandidatePair_t.remote,{})])}).then(function(c){c=c.map(function(b){return a.param0(b)});a.local_=c[0];a.remote_=c[1];b(a)})["catch"](function(b){b=a.logRemoteInvokeError(b,".syncBarrier failed!");c(b)})})};return b}(r.ProxyObject);a.IceCandidatePair=b},851:function(b,a){Object.defineProperty(a,"__esModule",{value:!0});var c=function(){function a(b){this.tracing=!1;this.mslogger_=void 0;this.tag=b;this.enabled=!0}a.prototype.setMSLogger=
function(a){this.mslogger_=a};a.prototype.log=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this.enabled&&(void 0!=this.mslogger_?this.mslogger_.info(this.tag+" "+a):console.log(this.tag+" "+a))};a.prototype.trace=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this.tracing&&this.log.apply(this,a)};return a}();a.Logger=c;a.logger=new c("[HdxWebRTC.js]");a.logger.enabled=!0},360:function(b,a,c){var d=this&&this.__extends||function(){var a=function(b,c){a=
Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var l in b)b.hasOwnProperty(l)&&(a[l]=b[l])};return a(b,c)};return function(b,c){function q(){this.constructor=b}a(b,c);b.prototype=null===c?Object.create(c):(q.prototype=c.prototype,new q)}}(),e=this&&this.__awaiter||function(a,b,c,q){function d(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,H){function w(a){try{m(q.next(a))}catch(b){H(b)}}function h(a){try{m(q["throw"](a))}catch(b){H(b)}}
function m(a){a.done?c(a.value):d(a.value).then(w,h)}m((q=q.apply(a,b||[])).next())})},r=this&&this.__generator||function(a,b){function c(a){return function(b){return q([a,b])}}function q(c){if(w)throw new TypeError("Generator is already executing.");for(;d;)try{if(w=1,h&&(m=c[0]&2?h["return"]:c[0]?h["throw"]||((m=h["return"])&&m.call(h),0):h.next)&&!(m=m.call(h,c[1])).done)return m;if(h=0,m)c=[c[0]&2,m.value];switch(c[0]){case 0:case 1:m=c;break;case 4:return d.label++,{value:c[1],done:!1};case 5:d.label++;
h=c[1];c=[0];continue;case 7:c=d.ops.pop();d.trys.pop();continue;default:if(!(m=d.trys,m=0<m.length&&m[m.length-1])&&(6===c[0]||2===c[0])){d=0;continue}if(3===c[0]&&(!m||c[1]>m[0]&&c[1]<m[3]))d.label=c[1];else if(6===c[0]&&d.label<m[1])d.label=m[1],m=c;else if(m&&d.label<m[2])d.label=m[2],d.ops.push(c);else{m[2]&&d.ops.pop();d.trys.pop();continue}}c=b.call(a,d)}catch(K){c=[6,K],h=0}finally{w=m=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var d={label:0,sent:function(){if(m[0]&1)throw m[1];
return m[1]},trys:[],ops:[]},w,h,m,u;$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbolIterator();return u={next:c(0),"throw":c(1),"return":c(2)},"function"===typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u},n=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var a=Array(a),q=0,b=0;b<c;b++)for(var d=arguments[b],w=0,h=d.length;w<h;w++,q++)a[q]=d[w];return a};Object.defineProperty(a,"__esModule",{value:!0});var g=c(946),
p=c(144),f=c(589),k=c(658),x=c(985),m=c(377),D=c(650),B=c(24),t=c(550),h=c(851),A=c(517),y=c(394),E=function(a){function b(c,q,d){c=a.call(this,c,t.class_id_t.RTCIceCandidateEvent,q,k.ProxyMode.Remote)||this;c.target=d;c.type="icecandidate";return c}d(b,a);Object.defineProperty(b.prototype,"candidate",{get:function(){return this.candidate_},enumerable:!0,configurable:!0});b.prototype.syncBarrier=function(){var a=this;h.logger.log(this.user_friendly_id()+".syncBarrier() called.");return new Promise(function(b,
c){a.waitUntilConnected(a.user_friendly_id()+".syncBarrier").then(function(){return a.remoteInvoke(!1,t.method_id_RTCIceCandidateEvent_t.candidate,{oid:0})}).then(function(b){b=a.param0(b);return!1===b.is_null?(new x.IceCandidate(a,b.oid,k.ProxyMode.Remote)).syncBarrier():Promise.resolve(null)}).then(function(c){h.logger.log(a.user_friendly_id()+".onicecandidate: icecandidate available!");a.candidate_=c;b(a)})["catch"](function(b){b=a.logRemoteInvokeError(b,".onicecandidate() failed!");c(b)})})};
return b}(k.ProxyObject);a.IceCandidateEvent=E;var u=function(){function a(b){this.state_="new";this.candidates_=[];this.pc_=b}a.prototype.pushState=function(a){h.logger.log(this.pc_.user_friendly_id()+".onicegatheringstatechange: new state is "+a);this.state_=a;"gathering"==this.state_?(this.candidates_=[],this.postUpdate()):this.processRemaining()};a.prototype.addIceCandidate=function(a){var b=this;this.candidates_.push(a);a.syncBarrier().then(function(a){h.logger.log(b.pc_.user_friendly_id()+".onicecandidate: icecandidate available!");
return Promise.all([b.pc_.updateSdpDescription(!0),Promise.resolve(a)])}).then(function(a){b.postIceCandidate(a[1])})};a.prototype.postIceCandidate=function(a){h.logger.log(this.pc_.user_friendly_id()+".onicecandidate: posting ice candidate now!");if(null!=this.pc_.onicecandidate)this.pc_.onicecandidate(a);else h.logger.log(this.pc_.user_friendly_id()+"onicecandidate is NULL!!!");this.candidates_.shift();this.processRemaining()};a.prototype.postUpdate=function(){h.logger.log(this.pc_.user_friendly_id()+
".onicegatheringstatechange: posting event now!");var a=new z("onicegatheringstatechange",this.pc_);this.pc_.onicegatheringstatechange(a)};a.prototype.processRemaining=function(){0==this.candidates_.length&&"complete"==this.state_?(this.pc_.onicecandidate({candidate:null,target:this}),this.postUpdate()):h.logger.log(this.pc_.user_friendly_id()+".onicecandidate: candidates remaining=["+this.candidates_.map(function(a){return a.object_id()})+"], state="+this.state_)};return a}(),q=function(){return function(a,
b){this.sdp=b;this.type=a}}();a.SessionDescriptionInit=q;var w=function(a){function b(c,q,d){for(var w=[],h=3;h<arguments.length;h++)w[h-3]=arguments[h];return a.apply(this,n([c,t.class_id_t.RTCSessionDescription,q,d,null],w))||this}d(b,a);b.prototype.toJSON=function(){return{type:this.type_,sdp:this.sdp_}};Object.defineProperty(b.prototype,"sdp",{get:function(){return this.sdp_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"type",{get:function(){return this.type_},enumerable:!0,
configurable:!0});b.prototype.syncBarrier=function(){var a=this;h.logger.log(this.user_friendly_id()+".syncBarrier() called.");return new Promise(function(b,c){a.waitUntilConnected(a.user_friendly_id()+".syncBarrier").then(function(){return Promise.all([a.remoteInvoke(!1,t.method_id_RTCSessionDescription_t.type,0),a.remoteInvoke(!1,t.method_id_RTCSessionDescription_t.sdp,"")])}).then(function(c){a.type_=a.convertType(a.param0(c[0]));a.sdp_=a.param0(c[1]);b(a)})["catch"](function(b){b=a.logRemoteInvokeError(b,
".syncBarrier() failed!");c(b)})})};b.prototype.convertType=function(a){return 0==a?"offer":1==a?"pranswer":2==a?"answer":"rollback"};b.convertC2H=function(a){return"offer"==a?0:"pranswer"==a?1:"answer"==a?2:3};return b}(k.ProxyObject);a.SessionDescription=w;var z=function(){return function(a,b){this.type=a;this.target=b}}(),C=function(){return function(){}}(),F=function(){function a(b,c){this.local=b;this.remote=c}Object.defineProperty(a.prototype,"active",{get:function(){var a=!1;if(1==this.local||
1==this.remote)a=!0;return a},enumerable:!0,configurable:!0});return a}();b=function(a){function b(c){var q=a.call(this,null,t.class_id_t.RTCPeerConnection,0,k.ProxyMode.Local,null,void 0!=c?c:{},{})||this;q.timeerstarted_=!1;q.firsttimeremoteoffer_=!1;q.firststable_=!1;q.firsttimelocaloffer_=!1;q.audiocall_=new F(!1,!1);q.videocall_=new F(!1,!1);q.screensharingcall_=new F(!1,!1);q.conferencecall_=!1;q.incomingcall_=!1;q.outgoingcall_=!1;c&&c.sdpSemantics&&(q.sdpSemantics_=c.sdpSemantics);h.logger.log(q.user_friendly_id()+
".constructor sdpSemantics="+q.sdpSemantics_);if(!t.BUILD_TYPE_SDK&&q.isUnified()&&!g.getRedirector().getFeatureValue(t.FEATURE_ms_teams_webrtc_1dot0))throw new DOMException("CWA client does not support unified sdpSemantic","createPeerConnection");q.pendingtransceiver_=!1;q.deferredOfferAnswers=[];q.localStreams=[];q.remoteStreams=[];q.onaddstream_=null;q.signalingState_="stable";q.iceConnectionState_="new";q.iceGatheringState_="new";q.iceQ_=new u(q);q.receivers_=[];q.senders_=[];q.transceivers_=
[];q.registerStateChangeNotification(q.onStateChange);q.localdatachannel_=null;q.remotedatachannel_=null;return q}d(b,a);b.prototype.dumpSdp=function(a){h.logger.log(this.user_friendly_id()+".dumpSdp");a&&(h.logger.log(this.user_friendly_id()+"  -- type: "+a.type),h.logger.log(this.user_friendly_id()+"  -- sdp: "+a.sdp))};Object.defineProperty(b.prototype,"localDescription",{get:function(){h.logger.log(this.user_friendly_id()+".get_localDescription() called.");return this.localDescription_},set:function(a){h.logger.log(this.user_friendly_id()+
".set_localDescription() called.");this.localDescription_=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"remoteDescription",{get:function(){h.logger.log(this.user_friendly_id()+".get_remoteDescription() called.");return this.remoteDescription_},set:function(a){h.logger.log(this.user_friendly_id()+".get_remoteDescription() called.");this.remoteDescription_=a},enumerable:!0,configurable:!0});b.prototype.isUnified=function(){return"unified"==this.sdpSemantics_||"unified-plan"==
this.sdpSemantics_};b.prototype.onStateChange=function(){var a=new z("iceconnectionstatechange",this);if(this.oniceconnectionstatechange_)this.oniceconnectionstatechange_(a)};b.prototype.addIceCandidate=function(a){var b=this;h.logger.log(this.user_friendly_id()+".addIceCandidate() called.");this.waitUntilConnected(this.user_friendly_id()+".addIceCandidate").then(function(){var c={candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex};if(void 0==c.candidate||null==c.candidate)c.candidate=
"";void 0==c.sdpMid&&(c.sdpMid=null);void 0==c.sdpMLineIndex&&(c.sdpMLineIndex=null);return(new x.IceCandidate(b,0,k.ProxyMode.Local,c)).syncBarrier()}).then(function(a){return b.remoteInvoke(!1,t.method_id_RTCPeerConnection_t.addIceCandidate,{oid:a.object_id()},{})}).then(function(){h.logger.log(b.user_friendly_id()+".addIceCandidate() success.");return b.updateSdpDescription(!1)}).then(function(){h.logger.log(b.user_friendly_id()+".addIceCandidate() - sync remote sdp success.")})["catch"](function(a){b.logRemoteInvokeError(a,
".addIceCandidate() failed!")})};Object.defineProperty(b.prototype,"onicecandidate",{get:function(){return this.onicecandidate_},set:function(a){var b=this;h.logger.log(this.user_friendly_id()+".set_onicecandidate() called.");this.onicecandidate_=a;this.waitUntilConnected(this.user_friendly_id()+".onicecandidate").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),t.method_id_RTCPeerConnection_t.onicecandidate);c.then(function(a){h.logger.log(b.user_friendly_id()+".onicecandidate callback received!!!");
a=new E(b,b.param0(a).oid,b);null!=b.iceQ_&&b.iceQ_.addIceCandidate(a)});return b.remoteInvoke(!0,t.method_id_RTCPeerConnection_t.onicecandidate,c.success)})["catch"](function(a){b.logRemoteInvokeError(a,".set_onicecandidate() failed!")})},enumerable:!0,configurable:!0});b.prototype.convertIceConnectionState=function(a){return 0==a?"new":1==a?"checking":2==a?"connected":3==a?"completed":4==a?"failed":5==a?"disconnected":"closed"};b.prototype.convertConnectionState=function(a){if(0!=a){if(1==a)return"connecting";
if(2==a)return"connected";if(3==a)return"disconnected";if(4==a)return"failed";if(5==a)return"closed"}return"new"};Object.defineProperty(b.prototype,"onconnectionstatechange",{get:function(){return this.onconnectionstatechange_},set:function(a){var b=this;h.logger.log(this.user_friendly_id()+".set_onconnectionstatechange() called.");this.onconnectionstatechange_=a;this.waitUntilConnected(this.user_friendly_id()+".onconnectionstatechange").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),
t.method_id_RTCPeerConnection_t.onconnectionstatechange);c.then(function(a){h.logger.log(b.user_friendly_id()+".onconnectionstatechange(): success callback received!!!");b.connectionState_=b.convertConnectionState(b.param0(a));h.logger.log(b.user_friendly_id()+" connectionState=:"+b.connectionState_);a=new z("connectionstatechange",b);b.onconnectionstatechange_(a)});return b.remoteInvoke(!0,t.method_id_RTCPeerConnection_t.onconnectionstatechange,c.success)})["catch"](function(a){b.logRemoteInvokeError(a,
".set_onconnectionstatechange() failed!")})},enumerable:!0,configurable:!0});b.prototype.get_connectionState=function(){h.logger.log(this.user_friendly_id()+".get_connectionState() called, value = "+this.connectionState_);return this.isRedirected()?this.connectionState_:"failed"};Object.defineProperty(b.prototype,"oniceconnectionstatechange",{get:function(){return this.oniceconnectionstatechange_},set:function(a){var b=this;h.logger.log(this.user_friendly_id()+".set_oniceconnectionstatechange() called.");
this.oniceconnectionstatechange_=a;this.waitUntilConnected(this.user_friendly_id()+".oniceconnectionstatechange").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),t.method_id_RTCPeerConnection_t.oniceconnectionstatechange);c.then(function(a){h.logger.log(b.user_friendly_id()+".oniceconnectionstatechange(): success callback received!!!");b.iceConnectionState_=b.convertIceConnectionState(b.param0(a));a=new z("iceconnectionstatechange",b);b.oniceconnectionstatechange_(a)});return b.remoteInvoke(!0,
t.method_id_RTCPeerConnection_t.oniceconnectionstatechange,c.success)})["catch"](function(a){b.logRemoteInvokeError(a,".set_oniceconnectionstatechange() failed!")})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"iceConnectionState",{get:function(){h.logger.log(this.user_friendly_id()+".get_iceConnectionState() called, value = "+this.iceConnectionState_);return this.isRedirected()?this.iceConnectionState_:"failed"},enumerable:!0,configurable:!0});b.prototype.convertIceGatheringState=
function(a){return 0==a?"new":1==a?"gathering":"complete"};Object.defineProperty(b.prototype,"onicegatheringstatechange",{get:function(){return this.onicegatheringstatechange_},set:function(a){var b=this;h.logger.log(this.user_friendly_id()+".set_onicegatheringstatechange() called.");this.onicegatheringstatechange_=a;this.waitUntilConnected(this.user_friendly_id()+".onicegatheringstatechange").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),t.method_id_RTCPeerConnection_t.onicegatheringstatechange);
c.then(function(a){h.logger.log(b.user_friendly_id()+".onicegatheringstatechange(): callback received!!!");b.iceGatheringState_=b.convertIceGatheringState(b.param0(a));null!=b.iceQ_&&b.iceQ_.pushState(b.iceGatheringState_)});return b.remoteInvoke(!0,t.method_id_RTCPeerConnection_t.onicegatheringstatechange,c.success)})["catch"](function(a){b.logRemoteInvokeError(a,".set_onicegatheringstatechange() failed!")})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"iceGatheringState",{get:function(){h.logger.log(this.user_friendly_id()+
".get_iceGatheringState() called, value = "+this.iceGatheringState_);return this.iceGatheringState_},enumerable:!0,configurable:!0});b.prototype.convertSignalState=function(a){return 0==a?"stable":1==a?"have-local-offer":2==a?"have-local-pranswer":3==a?"have-remote-offer":4==a?"have-remote-pranswer":"closed"};b.prototype.TelemtryReadings_=function(){"have-local-offer"==this.signalingState_&&0==this.firsttimelocaloffer_&&0==this.firsttimeremoteoffer_&&(this.outgoingcallstart_=(new Date).getTime(),
0==this.outgoingcall_&&(this.SendTelemetryData(y.tel_key_PerfCallState,y.tel_CallState.active,1),this.SendTelemetryData(y.tel_key_PerfCallDirection,y.tel_CallDirection.outgoing,1),this.outgoingcall_=!0),this.firsttimelocaloffer_=!0);"have-remote-offer"==this.signalingState_&&0==this.firsttimeremoteoffer_&&0==this.firsttimelocaloffer_&&(this.incomingcallstart_=(new Date).getTime(),0==this.incomingcall_&&(this.SendTelemetryData(y.tel_key_PerfCallState,y.tel_CallState.active,1),this.SendTelemetryData(y.tel_key_PerfCallDirection,
y.tel_CallDirection.incoming,1),this.incomingcall_=!0),this.firsttimeremoteoffer_=!0);"stable"==this.signalingState_&&0==this.firststable_&&(this.callstartTime_=(new Date).getTime(),this.firststable_=this.timeerstarted_=!0);if("stable"==this.signalingState_){for(var a=0,b=this.localStreams;a<b.length;a++){var c=b[a];1<=c.getAudioTracks().length&&0==this.audiocall_.local&&(this.SendTelemetryData(y.tel_key_PerfCallType,y.tel_CallType.audio,1),this.audiocall_.local=!0);c=c.getVideoTracks();if(1<=c.length)for(var l=
0,q=c;l<q.length;l++)c=q[l],1==c.getSettings().deviceId.includes("display")?0==this.screensharingcall_.local&&(this.SendTelemetryData(y.tel_key_PerfCallType,y.tel_CallType.dshare,1),this.screensharingcall_.local=!0):0==this.videocall_.local&&(this.SendTelemetryData(y.tel_key_PerfCallType,y.tel_CallType.video,1),this.videocall_.local=!0)}a=0;for(b=this.remoteStreams;a<b.length;a++)if(c=b[a],1<=c.getAudioTracks().length&&0==this.audiocall_.remote&&(this.SendTelemetryData(y.tel_key_PerfCallType,y.tel_CallType.audio,
1),this.audiocall_.remote=!0),l=c.getVideoTracks(),1<=l.length)for(c=0;c<l.length;c++)1==l[c].id.includes("applicationsharingVideo")?0==this.screensharingcall_.remote&&(this.SendTelemetryData(y.tel_key_PerfCallType,y.tel_CallType.dshare,1),this.screensharingcall_.remote=!0):0==this.videocall_.remote&&(this.SendTelemetryData(y.tel_key_PerfCallType,y.tel_CallType.video,1),this.videocall_.remote=!0);2<this.getReceivers().length&&0==this.conferencecall_&&(this.SendTelemetryData(y.tel_key_PerfCallType,
y.tel_CallType.multi,1),this.conferencecall_=!0)}};Object.defineProperty(b.prototype,"onsignalingstatechange",{set:function(a){var b=this;h.logger.log(this.user_friendly_id()+".set_onsignalingstatechange() called.");this.onsignalingstatechange_=a;this.waitUntilConnected(this.user_friendly_id()+".onsignalingstatechanged").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),t.method_id_RTCPeerConnection_t.onsignalingstatechange);c.then(function(a){h.logger.log(b.user_friendly_id()+".onsignalingstatechange(): callback received!!!");
b.signalingState_=b.convertSignalState(b.param0(a));a=new z("onsignalingstatechange",b);b.onsignalingstatechange_(a);b.TelemtryReadings_()});return b.remoteInvoke(!0,t.method_id_RTCPeerConnection_t.onsignalingstatechange,c.success)})["catch"](function(a){b.logRemoteInvokeError(a,".set_onsignalingstatechange() failed!")})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"onsignalingstatechanged",{get:function(){return this.onsignalingstatechange_},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"ontrack",{get:function(){return this.ontrack_},set:function(a){var b=this;h.logger.log(this.user_friendly_id()+".set_ontrack() called.");this.ontrack_=a;this.waitUntilConnected(this.user_friendly_id()+".ontrack").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),t.method_id_RTCPeerConnection_t.ontrack);c.then(function(a){return e(b,void 0,void 0,function(){var b,c,l,q,d,w,K,H,u,t,z,g=this;return r(this,function(n){h.logger.log(this.user_friendly_id()+
".ontrack(): callback received!!!");b=new C;c=[];l=this.param0(a);void 0!=l.track&&!1===l.track.is_null&&(h.logger.log(this.user_friendly_id()+" adding a RemoteMediaTrack with oid:"+l.track.oid),q=new p.RemoteMediaTrack(this,l.track.oid),c.push(q.syncBarrier()));b.track=q;void 0!=l.receiver&&!1===l.receiver.is_null&&(d=this.receivers_.find(function(a){return a.object_id()===l.receiver.oid}),void 0===d&&(h.logger.log(this.user_friendly_id()+" adding a RtpReceiver with oid:"+l.receiver.oid),d=new f.RtpReceiver(this,
l.receiver.oid,k.ProxyMode.Remote,this.isUnified(),q)),c.push(d.syncBarrier()));b.receiver=d;D.RemoteSession.isFeatureWebrtc1dot0Supported()&&void 0!=l.transceiver&&!1===l.transceiver.is_null&&(w=this.transceivers_.find(function(a){return a.object_id()===l.transceiver.oid}),void 0===w&&(h.logger.log(this.user_friendly_id()+" adding a RtpTransceiver with oid:"+l.transceiver.oid),w=new m.RtpTransceiver(this,l.transceiver.oid,k.ProxyMode.Remote,this.isUnified(),"inactive",d),this.transceivers_.push(w)),
c.push(w.syncBarrier()));b.transceiver=w;b.streams=[];if(void 0!=l.streams)for(K=function(a){var l=H.remoteStreams.find(function(b){return!1===a.is_null&&b.object_id()===a.oid});void 0===l&&(h.logger.log(H.user_friendly_id()+" adding a RemoteStream with oid:"+a.oid),l=new p.RemoteStream(H,a.oid,k.ProxyMode.Remote),H.remoteStreams.push(l));c.push(l.syncBarrier());b.streams.push(l)},H=this,u=0,t=l.streams;u<t.length;u++)z=t[u],K(z);h.logger.log(this.user_friendly_id()+".ontrack(): .prop.syncBarrier start");
Promise.all(c).then(function(){h.logger.log(g.user_friendly_id()+".ontrack(): notified!!! with evt: "+b);for(var a=0,c=b.streams;a<c.length;a++)c[a].toggleAudio(!1);g.ontrack_(b)})["catch"](function(a){g.logRemoteInvokeError(a,".ontrack(): .prop.syncBarrier failed.")});return[2]})})});return b.remoteInvoke(!0,t.method_id_RTCPeerConnection_t.ontrack,c.success)})["catch"](function(a){b.logRemoteInvokeError(a,".set_ontrack(): failed.")})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"signalingState",{get:function(){h.logger.log(this.user_friendly_id()+".get_signalingState() called, value = "+this.signalingState_);return this.signalingState_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"onnegotiationneeded",{get:function(){return this.onnegotiationneeded_},set:function(a){var b=this;h.logger.log(this.user_friendly_id()+".set_onnegotiationneeded() called.");this.onnegotiationneeded_=a;this.waitUntilConnected(this.user_friendly_id()+".onnegotiationneeded").then(function(){var c=
b.registerCallbacks(!1,b.isNullCallback(a),t.method_id_RTCPeerConnection_t.onnegotiationneeded);c.then(function(){h.logger.log(b.user_friendly_id()+".onnegotiationneeded(): callback received!!!");var a=new z("negotiationneeded",b);b.onnegotiationneeded_(a)});return b.remoteInvoke(!0,t.method_id_RTCPeerConnection_t.onnegotiationneeded,c.success)})["catch"](function(a){b.logRemoteInvokeError(a,".set_onnegotiationneeded(): failed.")})},enumerable:!0,configurable:!0});b.prototype.dumpConstraints=function(a){h.logger.log(this.user_friendly_id()+
"constraints: "+a);void 0!==a&&0!==Object.keys(a).length||h.logger.log(this.user_friendly_id()+"constraints either undefined or empty!");a&&(h.logger.log(this.user_friendly_id()+"  -- video: "+a.offerToReceiveVideo),h.logger.log(this.user_friendly_id()+"  -- audio: "+a.offerToReceiveAudio),h.logger.log(this.user_friendly_id()+"  -- iceRestart: "+a.iceRestart),h.logger.log(this.user_friendly_id()+"  -- voiceActivityDetection: "+a.voiceActivityDetection))};b.prototype.fix_constraints=function(a){this.dumpConstraints(a);
var b={};this.isUnified()||(b={audio:!0,video:!0});a&&(void 0!==a.video&&(b.video=a.offerToReceiveVideo),void 0!==a.audio&&(b.audio=a.offerToReceiveAudio),void 0!==a.iceRestart&&(b.iceRestart=a.iceRestart),void 0!==a.voiceActivityDetection&&(b.voiceActivityDetection=a.voiceActivityDetection));return b};b.prototype.createOffer=function(a,b,c){h.logger.log(this.user_friendly_id()+".createOffer() called.",JSON.stringify(a));return this.isUnified()?void 0==a?this.createOffer_v2():a?this.createOffer_v2(a):
this.createOffer_v1(a,b,c):this.createOffer_v1(a,b,c)};b.prototype.createOffer_v2=function(a){var b=this;h.logger.log(this.user_friendly_id()+".createOffer_v2() called.",JSON.stringify(a));return new Promise(function(c,l){b.createOffer_v1(function(a){h.logger.log(b.user_friendly_id()+".createOffer_v2(): got sdp!!!");a=new q(a.type,a.sdp);c(a)},function(a){void 0!=a&&(a=b.logRemoteInvokeError(a,".createOffer_v2() failed."),l(a))},a)})};b.prototype.createOffer_v1=function(a,b,c){var l=this;h.logger.log(this.user_friendly_id()+
".createOffer_v1().",JSON.stringify(c));var q=[this.waitUntilConnected(this.user_friendly_id()+".createOffer_v1"),this.waitTransceiverReady(this.user_friendly_id()+".createOffer_v1")];Promise.all(q).then(function(){var a=l.registerCallbacks(!0,!1,t.method_id_RTCPeerConnection_t.createOffer);l.remoteInvoke(!1,t.method_id_RTCPeerConnection_t.createOffer,a.success,a.fail,l.fix_constraints(c));return a.prom()}).then(function(a){h.logger.log(l.user_friendly_id()+".createOffer_v1(): success callback received!!!");
return(new w(l,l.param0(a).oid,k.ProxyMode.Remote)).syncBarrier()}).then(function(b){a&&a(b)})["catch"](function(a){void 0!=a&&(a=l.logRemoteInvokeError(a,".createOffer_v1() failed."),b&&b(a))})};b.prototype.createAnswer=function(a,b,c){h.logger.log(this.user_friendly_id()+".createAnswer() called.",JSON.stringify(a));return this.isUnified()?void 0==a?this.createAnswer_v2():a?this.createAnswer_v2(a):this.createAnswer_v1(a,b,c):this.createAnswer_v1(a,b,c)};b.prototype.createAnswer_v2=function(a){var b=
this;h.logger.log(this.user_friendly_id()+".createAnswer_v2() called.",JSON.stringify(a));return new Promise(function(c,l){b.createAnswer_v1(function(a){h.logger.log(b.user_friendly_id()+".createAnswer_v2(): got sdp!!!");a=new q(a.type,a.sdp);c(a)},function(a){void 0!=a&&(a=b.logRemoteInvokeError(a,".createAnswer_v2() failed."),l(a))},a)})};b.prototype.createAnswer_v1=function(a,b,c){var l=this;h.logger.log(this.user_friendly_id()+".createAnswer_v1() called.",JSON.stringify(c));var q=[this.waitUntilConnected(this.user_friendly_id()+
".createAnswer_v1"),this.waitTransceiverReady(this.user_friendly_id()+".createAnswer_v1")];Promise.all(q).then(function(){var a=l.registerCallbacks(!0,!1,t.method_id_RTCPeerConnection_t.createAnswer);l.remoteInvoke(!1,t.method_id_RTCPeerConnection_t.createAnswer,a.success,a.fail,l.fix_constraints(c),{});return a.prom()}).then(function(a){h.logger.log(l.user_friendly_id()+".createAnswer_v1(): success callback received!!!");return(new w(l,l.param0(a).oid,k.ProxyMode.Remote)).syncBarrier()}).then(function(b){a&&
a(b)})["catch"](function(a){a=l.logRemoteInvokeError(a,".createAnswer_v1() failed.");b&&b(a.message)})};b.prototype.updateSdpDescription=function(a){return e(this,void 0,void 0,function(){var b,c,l,q=this;return r(this,function(d){switch(d.label){case 0:return h.logger.log(this.user_friendly_id()+".updateSdpDescription() called."),1!=a?[3,2]:[4,this.remoteInvoke(!1,t.method_id_RTCPeerConnection_t.localDescription,{oid:this.object_id()})];case 1:return b=d.sent(),[3,4];case 2:return[4,this.remoteInvoke(!1,
t.method_id_RTCPeerConnection_t.remoteDescription,{oid:this.object_id()})];case 3:b=d.sent(),d.label=4;case 4:return c=new w(this,this.param0(b).oid,k.ProxyMode.Remote),[4,c.syncBarrier()["catch"](function(a){q.logRemoteInvokeError(a,"sdp.syncBarrier() failed!");return null})];case 5:return l=d.sent(),1==a?this.localDescription_=l:this.remoteDescription_=l,[2]}})})};b.prototype.setLocalDescription=function(a,b,c){h.logger.log(this.user_friendly_id()+".setLocalDescription() called.",JSON.stringify(a));
if(a instanceof q)return this.setLocalDescription_v2(a);if(a instanceof RTCSessionDescription&&b)return this.setLocalDescription_v1(a,b,c);b=void 0;a?b=new q(a.type,a.sdp):(h.logger.log(this.user_friendly_id()+".setLocalDescription() empty param1, setting sdp type to rollback"),a=void 0,a="have-remote-offer"==this.signalingState_?"answer":"have-local-pranswer"==this.signalingState_||"have-remote-pranswer"==this.signalingState_?"pranswer":"offer",b=new q(a,""));return this.setLocalDescription_v2(b)};
b.prototype.setLocalDescription_v2=function(a){var b=this;h.logger.log(this.user_friendly_id()+".setLocalDescription_v2() called.",JSON.stringify(a));return new Promise(function(c,l){b.waitUntilConnected(b.user_friendly_id()+".setLocalDescription_v2").then(function(){return(new w(b,0,k.ProxyMode.Local,{type:w.convertC2H(a.type),sdp:a.sdp})).syncBarrier()}).then(function(q){var d=b.registerCallbacks(!0,!1,t.method_id_RTCPeerConnection_t.setLocalDescription_v2),m={type:w.convertC2H(a.type),sdp:a.sdp};
b.remoteInvoke(!1,t.method_id_RTCPeerConnection_t.setLocalDescription_v2,m,d.success,d.fail);d.prom().then(function(){h.logger.log(b.user_friendly_id()+".setLocalDescription_v2(): success callback received!!!");b.localDescription_=q;h.logger.log(b.user_friendly_id()+".setLocalDescription_v2(): updated localDescription_");b.isUnified();Promise.all([]).then(function(){h.logger.log(b.user_friendly_id()+".setLocalDescription_v2() success.");c()})["catch"](function(a){a=b.logRemoteInvokeError(a,".prop.setLocalDescription_v2() failed!");
l(a)})})["catch"](function(a){a=b.logRemoteInvokeError(a,"setLocalDescription_v2() error callback received!");l(a)})})["catch"](function(a){a=b.logRemoteInvokeError(a,".setLocalDescription_v2() failed.");l(a)})})};b.prototype.setLocalDescription_v1=function(a,b,c){var l=this;h.logger.log(this.user_friendly_id()+".setLocalDescription_v1() called.");this.waitUntilConnected(this.user_friendly_id()+".setLocalDescription_v1").then(function(){return(new w(l,0,k.ProxyMode.Local,{type:w.convertC2H(a.type),
sdp:a.sdp})).syncBarrier()}).then(function(a){var q=l.registerCallbacks(!0,!1,t.method_id_RTCPeerConnection_t.setLocalDescription);l.remoteInvoke(!1,t.method_id_RTCPeerConnection_t.setLocalDescription,{oid:a.object_id()},q.success,q.fail);q.prom().then(function(){h.logger.log(l.user_friendly_id()+".setLocalDescription_v1(): success callback received!!!");l.localDescription_=a;h.logger.log(l.user_friendly_id()+".setLocalDescription_v1(): updated localDescription_");l.isUnified();Promise.all([]).then(function(){h.logger.log(l.user_friendly_id()+
".setLocalDescription_v1() success.");b&&b()})["catch"](function(a){a=l.logRemoteInvokeError(a,".prop.setLocalDescription_v1() failed.");c&&c(a.message)})})["catch"](function(a){a=l.logRemoteInvokeError(a,".setLocalDescription_v1() error callback received.");c&&c(a.message)})})["catch"](function(a){a=l.logRemoteInvokeError(a,".setLocalDescription_v1() failed.");c&&c(a.message)})};b.prototype.setRemoteDescription=function(a,b,c){h.logger.log(this.user_friendly_id()+".setRemoteDescription() called.",
JSON.stringify(a));if(a instanceof q)return this.setRemoteDescription_v2(a);if(a instanceof RTCSessionDescription&&b)return this.setRemoteDescription_v1(a,b,c);b=void 0;a?b=new q(a.type,a.sdp):(h.logger.log(this.user_friendly_id()+".setRemoteDescription() empty param1, setting sdp type to rollback"),a=void 0,a="have-remote-offer"==this.signalingState_?"answer":"have-local-pranswer"==this.signalingState_||"have-remote-pranswer"==this.signalingState_?"pranswer":"offer",b=new q(a,""));return this.setRemoteDescription_v2(b)};
b.prototype.setRemoteDescription_v2=function(a){var b=this;h.logger.log(this.user_friendly_id()+".setRemoteDescription_v2() called.",JSON.stringify(a));return new Promise(function(c,l){b.waitUntilConnected(b.user_friendly_id()+".setRemoteDescription_v2").then(function(){return(new w(b,0,k.ProxyMode.Local,{type:w.convertC2H(a.type),sdp:a.sdp})).syncBarrier()}).then(function(q){var d=b.registerCallbacks(!0,!1,t.method_id_RTCPeerConnection_t.setRemoteDescription_v2),m={type:w.convertC2H(a.type),sdp:a.sdp};
b.remoteInvoke(!1,t.method_id_RTCPeerConnection_t.setRemoteDescription_v2,m,d.success,d.fail);d.prom().then(function(){h.logger.log(b.user_friendly_id()+".setRemoteDescription_v2(): success callback received!!!");b.remoteDescription_=q;h.logger.log(b.user_friendly_id()+".setRemoteDescription_v2(): updated remoteDescription_");var a=[];b.isUnified()?a.push(b.getTransceiversAsync()):a.push(b.getSendersAsync());Promise.all(a).then(function(){h.logger.log(b.user_friendly_id()+".setRemoteDescription_v2(): success.");
c()})["catch"](function(a){a=b.logRemoteInvokeError(a,".prop.setRemoteDescription_v2() failed.");l(a)})})["catch"](function(a){a=b.logRemoteInvokeError(a,".setRemoteDescription_v2() error callback received.");l(a)})})["catch"](function(a){a=b.logRemoteInvokeError(a,".setRemoteDescription_v2() failed.");l(a)})})};b.prototype.setRemoteDescription_v1=function(a,b,c){var l=this;h.logger.log(this.user_friendly_id()+".setRemoteDescription_v1() called.");this.waitUntilConnected(this.user_friendly_id()+".setRemoteDescription_v1").then(function(){return(new w(l,
0,k.ProxyMode.Local,{type:w.convertC2H(a.type),sdp:a.sdp})).syncBarrier()}).then(function(a){var q=l.registerCallbacks(!0,!1,t.method_id_RTCPeerConnection_t.setRemoteDescription);l.remoteInvoke(!1,t.method_id_RTCPeerConnection_t.setRemoteDescription,{oid:a.object_id()},q.success,q.fail);q.prom().then(function(){h.logger.log(l.user_friendly_id()+".setRemoteDescription_v1(): success callback received!!!");l.remoteDescription_=a;h.logger.log(l.user_friendly_id()+".setRemoteDescription_v1(): updated remoteDescription_");
var q=[];l.isUnified()?q.push(l.getTransceiversAsync()):q.push(l.getSendersAsync());Promise.all(q).then(function(){h.logger.log(l.user_friendly_id()+".setRemoteDescription_v1(): success.");b&&b()})["catch"](function(a){a=l.logRemoteInvokeError(a,".prop.setRemoteDescription_v1() failed.");c&&c(a.message)})})})["catch"](function(a){a=l.logRemoteInvokeError(a,".setRemoteDescription_v1() failed.");c&&c(a.message)})};b.prototype.getLocalStreams=function(){h.logger.log("PeerConnection.getLocalStreams() called. [oid="+
this.object_id()+"]");for(var a=0,b=this.localStreams;a<b.length;a++)h.logger.log(JSON.stringify(b[a]));return this.localStreams};b.prototype.getRemoteStreams=function(){h.logger.log(this.user_friendly_id()+".getRemoteStreams() called.");for(var a=0,b=this.remoteStreams;a<b.length;a++)h.logger.log(JSON.stringify(b[a]));return this.remoteStreams};b.prototype.addTrack=function(a,b){var c=this;h.logger.log(this.user_friendly_id()+".addTrack() called: "+JSON.stringify(b));var l=[];if(b instanceof p.RemoteStream)l.push(b.id),
this.localStreams.push(b);else for(var q=0;q<b.length;q++)l.push(b[q].id),this.localStreams.push(b[q]);var d=new f.RtpSender(this,0,k.ProxyMode.Pseudo,this.isUnified());this.senders_.push(d);this.waitUntilConnected(this.user_friendly_id()+".addTrack").then(function(){return c.remoteInvoke(!1,t.method_id_RTCPeerConnection_t.addTrack,{oid:a.object_id()},l)}).then(function(a){h.logger.log(c.user_friendly_id()+".addTrack() success with oid: "+c.param0(a).oid);d.bind(c,c.param0(a).oid);d.syncBarrier().then(function(){h.logger.log(c.user_friendly_id()+
"sender.syncBarrier(): success");c.isUnified()&&c.getTransceiversAsync()})["catch"](function(a){c.logRemoteInvokeError(a,"sender.syncBarrier() failed!")})})["catch"](function(a){c.logRemoteInvokeError(a,"addTrack() failed!")});h.logger.log(this.user_friendly_id()+".addTrack() returning: "+d);return d};b.prototype.removeTrack=function(a){var b=this;h.logger.log(this.user_friendly_id()+".removeTrack() called.");for(var c=0;c<this.senders_.length;c++)this.senders_[c]==a&&this.senders_.splice(c,1);this.waitUntilConnected(this.user_friendly_id()+
".removeTrack").then(function(){return b.remoteInvoke(!1,t.method_id_RTCPeerConnection_t.removeTrack,{oid:a.object_id()})}).then(function(){h.logger.log(b.user_friendly_id()+".removeTrack() success.");b.isUnified()&&b.getTransceiversAsync()})["catch"](function(a){b.logRemoteInvokeError(a,"removeTrack() failed!")})};b.prototype.addStream=function(a){var b=this;h.logger.log(this.user_friendly_id()+".addStream() called: "+JSON.stringify(a));this.localStreams.push(a);this.waitUntilConnected(this.user_friendly_id()+
".addStream").then(function(){return b.remoteInvoke(!1,t.method_id_RTCPeerConnection_t.addStream,{oid:a.object_id()},{})}).then(function(){h.logger.log(b.user_friendly_id()+".addStream() success.")})["catch"](function(a){b.logRemoteInvokeError(a,"addStream() failed.")})};b.prototype.removeStream=function(a){var b=this;h.logger.log(this.user_friendly_id()+".removeStream() called: "+JSON.stringify(a));for(var c=0;c<this.localStreams.length;c++)this.localStreams[c]==a&&this.localStreams.splice(c,1);
this.waitUntilConnected(this.user_friendly_id()+".removeStream").then(function(){return b.remoteInvoke(!1,t.method_id_RTCPeerConnection_t.removeStream,{oid:a.object_id()})}).then(function(){h.logger.log(b.user_friendly_id()+".removeStream() success.")})["catch"](function(a){b.logRemoteInvokeError(a,"removeStream() failed.")})};Object.defineProperty(b.prototype,"onaddstream",{get:function(){return this.onaddstream_},set:function(a){var b=this;h.logger.log(this.user_friendly_id()+".set_onaddstream() called.");
this.onaddstream_=a;this.waitUntilConnected(this.user_friendly_id()+".onaddstream").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),t.method_id_RTCPeerConnection_t.onaddstream);c.then(function(a){(new p.RemoteStreamEvent(b,b.param0(a).oid)).syncBarrier().then(function(a){h.logger.log(b.user_friendly_id()+".onaddstream callback received!");void 0===b.remoteStreams.find(function(b){return void 0!=a.stream&&b.object_id()===a.stream.object_id()})&&b.remoteStreams.push(a.stream);void 0!=
b.onaddstream_&&(h.logger.log(b.user_friendly_id()+".onaddstream notified!!! "+a.stream.id),b.onaddstream_(a))})});return b.remoteInvoke(!0,t.method_id_RTCPeerConnection_t.onaddstream,c.success)})["catch"](function(a){b.logRemoteInvokeError(a,"set_onaddstream() failed!")})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"onremovestream",{get:function(){return this.onremovestream_},set:function(a){var b=this;h.logger.log(this.user_friendly_id()+".set_onremovestream() called.");this.onremovestream_=
a;this.waitUntilConnected(this.user_friendly_id()+".onremovestream").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),t.method_id_RTCPeerConnection_t.onremovestream);c.then(function(a){(new p.RemoteStreamEvent(b,b.param0(a).oid)).syncBarrier().then(function(a){h.logger.log(b.user_friendly_id()+".onremovestream callback received! "+a.stream.id);var c=b.remoteStreams.findIndex(function(b){return b.id==a.stream.id});0<=c&&b.remoteStreams.splice(c,1);b.onremovestream_(a)})});return b.remoteInvoke(!0,
t.method_id_RTCPeerConnection_t.onremovestream,c.success)})["catch"](function(a){b.logRemoteInvokeError(a,"set_onremovestream() failed!")})},enumerable:!0,configurable:!0});b.prototype.getStats=function(a){var b=this;return new Promise(function(c,l){var q=this;b.isRedirected()?b.waitUntilConnected(b.user_friendly_id()+".getStats").then(function(){var l=b.registerCallbacks(!0,!1,t.method_id_RTCPeerConnection_t.getStats);l.then(function(b){void 0!==b.params&&0!==b.params.length&&(a?(a(A.StatsReport.fromJSON(JSON.parse(b.params[0]))),
c()):c(A.StatsReport.toRTCStatsReport(JSON.parse(b.params[0]))))});return a?b.remoteInvoke(!1,t.method_id_RTCPeerConnection_t.getStats,l.success):b.remoteInvoke(!1,t.method_id_RTCPeerConnection_t.getStats_v2,l.success)})["catch"](function(a){q&&(a=q.logRemoteInvokeError(a,".getStats() failed!"),l(a))}):(a({}),c())})};b.prototype.SendTelemetryData=function(a,b,c){g.getRedirector().telemetry.SendTelemetryData(y.tel_cmd.Data,a,b,c)};b.prototype.MillisecondstoDisplayformat_=function(a){var b,c;c=Math.floor(a/
1E3);b=Math.floor(c/60);a=Math.floor(b/60);h.logger.log(Math.floor(a/24)+":"+a%24+":"+b%60+":"+c%60)};b.prototype.CalculateCallDurationandType_=function(){if(1==this.timeerstarted_){this.timeerstarted_=!1;this.callendTime_=(new Date).getTime();var a=this.callendTime_-this.callstartTime_;this.MillisecondstoDisplayformat_(a);a=Math.round(a/1E3);h.logger.log("Call Duration "+a);1==this.conferencecall_?this.SendTelemetryData(y.tel_key_ConferenceCallDuration,a,1):(1==this.audiocall_.active&&this.SendTelemetryData(y.tel_key_AudioCallDuration,
a,1),1==this.videocall_.active&&this.SendTelemetryData(y.tel_key_VideoCallDuration,a,1),1==this.screensharingcall_.active&&this.SendTelemetryData(y.tel_key_ScreensharingCallDuration,a,1));var b;1==this.firsttimelocaloffer_&&(b=this.callstartTime_-this.outgoingcallstart_);1==this.firsttimeremoteoffer_&&(b=this.callstartTime_-this.incomingcallstart_);this.MillisecondstoDisplayformat_(b);b=Math.round(b/1E3);h.logger.log("Call Establish Time "+b);1==this.incomingcall_?this.SendTelemetryData(y.tel_key_CallEstIncoming,
b,1):1==this.outgoingcall_&&this.SendTelemetryData(y.tel_key_CallEstOutgoing,b,1);this.SendTelemetryData(y.tel_key_PerfCallState,y.tel_CallState.idle,1)}};b.prototype.close=function(){var a=this;h.logger.log(this.user_friendly_id()+".close() called.");this.CalculateCallDurationandType_();this.unregisterStateChangeNotification(this.onStateChange);this.onnegotiationneeded=this.onsignalingstatechange=this.onicegatheringstatechange=this.oniceconnectionstatechange=this.onicecandidate=this.onaddstream=
null;this.waitUntilConnected(this.user_friendly_id()+".close").then(function(){return a.remoteInvoke(!1,t.method_id_RTCPeerConnection_t.close)}).then(function(){a.iceQ_=null;a.release();h.logger.log(a.user_friendly_id()+".close() success.")})["catch"](function(b){a.logRemoteInvokeError(b,".close() failed.");a.iceQ_=null;a.release()})};b.prototype.createDTMFSender=function(a){h.logger.log(this.user_friendly_id()+".createDTMFSender() called.");var b,c=this.senders_;if(void 0===c||0===c.length)c=this.getSenders();
void 0!=c&&(c=c.find(function(b){return b.track.id===a.id}),void 0!=c&&(h.logger.log(this.user_friendly_id()+" returning RtpSender with oid:"+c.object_id()),b=c.dtmf));return b};b.prototype.getSenders=function(){var a=this;h.logger.log(this.user_friendly_id()+".getSenders() called. ");if(this.isUnified()){for(var b=[],c=0,l=this.transceivers_;c<l.length;c++)b.push(l[c].sender);this.senders_=b}else this.getSendersAsync().then(function(){h.logger.log(a.user_friendly_id()+".getSenders() success.")})["catch"](function(b){a.logRemoteInvokeError(b,
".getSenders() failed!")});h.logger.log(this.user_friendly_id()+".getSenders() returning:"+this.senders_.length+" items");return this.senders_};b.prototype.getSendersAsync=function(){var a=this;h.logger.log(this.user_friendly_id()+".getSendersAsync() called. "+this.senders_);return new Promise(function(b,c){a.waitUntilConnected(a.user_friendly_id()+".getSendersAsync").then(function(){h.logger.log(a.user_friendly_id()+".getSendersAsync invoking remote");return a.remoteInvoke(!1,t.method_id_RTCPeerConnection_t.getSenders,
[])}).then(function(c){h.logger.log(a.user_friendly_id()+".getSendersAsync remote success");var l=[],q=[];c.params[0].forEach(function(b){var c=a.senders_.find(function(a){return a.object_id()===b.oid});void 0===c&&(h.logger.log(a.user_friendly_id()+" adding a RtpSender with oid:"+b.oid),c=new f.RtpSender(a,b.oid,k.ProxyMode.Remote,a.isUnified()),q.push(c.syncBarrier()));l.push(c)});Promise.all(q).then(function(){a.senders_=l;h.logger.log(a.user_friendly_id()+".getSendersAsync: returning senders with ids ["+
a.senders_.map(function(a){return a.object_id()})+"]");b(a.senders_)})["catch"](function(c){a.logRemoteInvokeError(c,".prop.getSendersAsync() failed.");a.senders_=[];b(a.senders_)})})["catch"](function(c){a.logRemoteInvokeError(c,".getSendersAsync() failed.");a.senders_=[];b(a.senders_)})})};b.prototype.getReceivers=function(){var a=this;h.logger.log(this.user_friendly_id()+".getReceivers() called. ");if(this.isUnified()){for(var b=[],c=0,l=this.transceivers_;c<l.length;c++)b.push(l[c].receiver);
this.receivers_=b}else this.getReceiversAsync().then(function(){h.logger.log(a.user_friendly_id()+".getReceivers() success.")})["catch"](function(b){a.logRemoteInvokeError(b,".getReceivers() failed!")});h.logger.log(this.user_friendly_id()+".getReceivers() returning:"+this.receivers_.length+" items");return this.receivers_};b.prototype.getReceiversAsync=function(){var a=this;h.logger.log(this.user_friendly_id()+".getReceiversAsync() called. "+this.receivers_);return new Promise(function(b,c){a.waitUntilConnected(a.user_friendly_id()+
".getReceiversAsync").then(function(){return a.remoteInvoke(!1,t.method_id_RTCPeerConnection_t.getReceivers,[])}).then(function(c){h.logger.log(a.user_friendly_id()+".getReceiversAsync: remote success.");var l=[],q=[];c.params[0].forEach(function(b){var c=a.receivers_.find(function(a){return a.object_id()===b.oid});void 0===c&&(h.logger.log(a.user_friendly_id()+" adding a RtpReceiver with oid:"+b.oid),c=new f.RtpReceiver(a,b.oid,k.ProxyMode.Remote,a.isUnified()),q.push(c.syncBarrier()));l.push(c)});
Promise.all(q).then(function(){a.receivers_=l;h.logger.log(a.user_friendly_id()+".getReceiversAsync: returning receiver with ids ["+a.receivers_.map(function(a){return a.object_id()})+"]");b(a.receivers_)})["catch"](function(c){a.logRemoteInvokeError(c,".prop.getReceiversAsync() failed!");a.receivers_=[];b(a.receivers_)})})["catch"](function(c){a.logRemoteInvokeError(c,".getReceiversAsync() failed!");a.receivers_=[];b(a.receivers_)})})};b.prototype.addTransceiver=function(a,b){var c=this;h.logger.log(this.user_friendly_id()+
".addTransceiver() called: "+JSON.stringify(a)+" init="+JSON.stringify(b));this.pendingtransceiver_=!0;var l="sendrecv";b&&b.direction&&(l=b.direction);var q=new m.RtpTransceiver(this,0,k.ProxyMode.Pseudo,this.isUnified(),l);this.transceivers_.push(q);this.waitUntilConnected(this.user_friendly_id()+".addTransceiver").then(function(){return"string"===typeof a?c.remoteInvoke(!1,t.method_id_RTCPeerConnection_t.addTransceiverWithKind,a,b):c.remoteInvoke(!1,t.method_id_RTCPeerConnection_t.addTransceiverWithTrack,
{oid:a.object_id()},b)}).then(function(a){h.logger.log(c.user_friendly_id()+".addTransceiver() success with oid: "+c.param0(a).oid);q.bind(c,c.param0(a).oid);q.syncBarrier().then(function(){h.logger.log(c.user_friendly_id()+".addTransceiver(): success");c.pendingtransceiver_=!1})["catch"](function(a){c.logRemoteInvokeError(a,".prop.addTransceiver() failed!");c.pendingtransceiver_=!1})})["catch"](function(a){c.logRemoteInvokeError(a,"addTransceiver() failed!");c.pendingtransceiver_=!1});h.logger.log(this.user_friendly_id()+
".addTransceiver() returning:");return q};b.prototype.waitTransceiverReady=function(a){var b=this;return new Promise(function(c,l){h.logger.trace(b.user_friendly_id()+".waitTransceiverReady(): pendingtransceiver_="+b.pendingtransceiver_);if(0==b.pendingtransceiver_){for(;b.deferredOfferAnswers&&0<b.deferredOfferAnswers.length;)b.deferredOfferAnswers.shift().post(!0);c()}else b.deferredOfferAnswers.push(new k.deferred_action(c,l,a)),b.checkTransceiver(15,1E3)})};b.prototype.checkTransceiver=function(a,
b){var c=this;if(0>=a)for(h.logger.log(".checkTransceiver() timeout waiting for transceiver ready!");this.deferredOfferAnswers&&0<this.deferredOfferAnswers.length;)this.deferredOfferAnswers.shift().post(!1);else setTimeout(function(){if(0==c.pendingtransceiver_)for(;c.deferredOfferAnswers&&0<c.deferredOfferAnswers.length;)c.deferredOfferAnswers.shift().post(!0);else h.logger.log('.checkTransceiver(): count= "'+a),c.checkTransceiver(--a,b)},b)};b.prototype.getTransceivers=function(){h.logger.log(this.user_friendly_id()+
".getTransceivers() called. ");h.logger.log(this.user_friendly_id()+".getTransceivers() returning:"+this.transceivers_.length+" items");return this.transceivers_};b.prototype.getTransceiversAsync=function(){var a=this;h.logger.log(this.user_friendly_id()+".getTransceiversAsync() called. ");return new Promise(function(b,c){a.waitUntilConnected(a.user_friendly_id()+".getTransceiversAsync").then(function(){return a.remoteInvoke(!1,t.method_id_RTCPeerConnection_t.getTransceivers,[])}).then(function(c){h.logger.log(a.user_friendly_id()+
".getTransceiversAsync() remote success.");var l=[],q=[];c.params[0].forEach(function(b){var c=a.transceivers_.find(function(a){return a.object_id()===b.oid});void 0===c&&(h.logger.log(a.user_friendly_id()+" adding a RtpTransceiver with oid:"+b.oid),c=new m.RtpTransceiver(a,b.oid,k.ProxyMode.Remote,a.isUnified()),q.push(c.syncBarrier()));l.push(c)});Promise.all(q).then(function(){a.transceivers_=l;h.logger.log(a.user_friendly_id()+".prop.getTransceiversAsync: returning transceiver with ids ["+a.transceivers_.map(function(a){return a.object_id()})+
"]");b(a.transceivers_)})["catch"](function(c){a.logRemoteInvokeError(c,".prop.getTransceiversAsync() failed!");a.transceivers_=[];b(a.transceivers_)})})["catch"](function(c){a.logRemoteInvokeError(c,".getTransceiversAsync() failed!");a.transceivers_=[];b(a.transceivers_)})})};Object.defineProperty(b.prototype,"sctp",{get:function(){return this.sctp_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"ondatachannel",{get:function(){return this.ondatachannel_},set:function(a){var b=
this;h.logger.log(this.user_friendly_id()+".set_ondatachannel() called.");this.ondatachannel_=a;this.waitUntilConnected(this.user_friendly_id()+".ondatachannel").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),t.method_id_RTCPeerConnection_t.ondatachannel);c.then(function(a){h.logger.log(b.user_friendly_id()+".ondatachannel callback received!!!");if(null===b.remotedatachannel_||b.remotedatachannel_.object_id()!=b.param0(a).oid)b.remotedatachannel_=new B.RtcDataChannel(b,b.param0(a).oid,
k.ProxyMode.Remote),b.remotedatachannel_.syncBarrier().then(function(){h.logger.log(b.user_friendly_id()+"remotedatachannel_.syncBarrier(): success");var a=new Event("ondatachannel");a.channel=b.remotedatachannel_;if(b.localdatachannel_&&!b.localdatachannel_.isdestroyed())b.localdatachannel_.syncBarrier().then(function(){h.logger.log(b.user_friendly_id()+"ondatachannel(): notifying...");if(b.ondatachannel_)b.ondatachannel_(a)})["catch"](function(){h.logger.log(b.user_friendly_id()+"localdatachannel_.syncBarrier(): failed!")});
else if(h.logger.log(b.user_friendly_id()+"ondatachannel(): notifying..."),b.ondatachannel_)b.ondatachannel_(a)})["catch"](function(){h.logger.log(b.user_friendly_id()+"remotedatachannel_.syncBarrier(): failed!")})});return b.remoteInvoke(!0,t.method_id_RTCPeerConnection_t.ondatachannel,c.success)})["catch"](function(){h.logger.log(b.user_friendly_id()+".ondatachannel() failed.")})},enumerable:!0,configurable:!0});b.prototype.fixDataChannelConfig=function(a){h.logger.log(this.user_friendly_id()+".fixDataChannelConfig() called: "+
a);void 0==a&&(a={});void 0==a.negotiated&&void 0==a.id&&(a.negotiated=!1,a.id=-1);return a};b.prototype.createDataChannel=function(a,b){var c=this;h.logger.log(this.user_friendly_id()+".createDataChannel() called. label:"+a);this.localdatachannel_=new B.RtcDataChannel(this,0,k.ProxyMode.Pseudo);this.waitUntilConnected(this.user_friendly_id()+".createDataChannel").then(function(){return c.remoteInvoke(!1,t.method_id_RTCPeerConnection_t.createDataChannel,a,c.fixDataChannelConfig(b))}).then(function(a){h.logger.log(c.user_friendly_id()+
".createDataChannel() success with oid: "+c.param0(a).oid);c.localdatachannel_.bind(c,c.param0(a).oid);c.localdatachannel_.syncBarrier().then(function(){h.logger.log(c.user_friendly_id()+"channel.syncBarrier(): success")})["catch"](function(){h.logger.log(c.user_friendly_id()+"channel.syncBarrier(): failed!")})})["catch"](function(a){a=c.param0(a);h.logger.log(c.user_friendly_id()+".createDataChannel() failed with error: "+a)});h.logger.log(this.user_friendly_id()+".createDataChannel() returning: "+
this.localdatachannel_);return this.localdatachannel_};return b}(k.ProxyObject);a.PeerConnection=b},658:function(b,a,c){var d=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var a=Array(a),d=0,b=0;b<c;b++)for(var m=arguments[b],g=0,u=m.length;g<u;g++,d++)a[d]=m[g];return a};Object.defineProperty(a,"__esModule",{value:!0});var e=c(946),r=c(851),n=c(545),g=c(247),p=c(550),f=function(){function a(b,c,d){this.resolve=b;this.reject=c;this.name_=
d}Object.defineProperty(a.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0});a.prototype.post=function(a){1==a?(r.logger.log('deferred_action.post(): resolving "'+this.name_+'"'),this.resolve()):(r.logger.log('deferred_action.post(): rejecting "'+this.name_+'"'),this.reject())};a.prototype.postWithResult=function(a,b){1==a?(r.logger.log('deferred_action.post(): resolving "'+this.name_+'"'),this.resolve(b)):(r.logger.log('deferred_action.post(): rejecting "'+this.name_+
'"'),this.reject())};return a}();a.deferred_action=f;var k=function(){return function(a,b){this.id=a;this.is_null=b}}();a.rpc_callback=k;var x=function(){function a(b,c,d){this.success=new k(b<<16,c);this.fail=new k(b<<16|1,c);this.id=b;this.oneShot=d}a.prototype.resolve=function(a){r.logger.trace("callback.resolve() called. [id="+this.id+"]");null!=this.handler&&this.handler(a)};a.prototype.reject=function(a){null!=this.err_handler&&this.err_handler(a)};a.prototype.then=function(a){this.handler=
a};a.prototype.prom=function(){var a=this;return new Promise(function(b,c){a.handler=b;a.err_handler=c})};return a}();a.callback=x;var m;(function(a){a[a.NotConfigured=0]="NotConfigured";a[a.Configured=1]="Configured";a[a.Error=2]="Error";a[a.Destroyed=3]="Destroyed"})(m||(m={}));var D;(function(a){a[a.Local=0]="Local";a[a.Remote=1]="Remote";a[a.Pseudo=2]="Pseudo"})(D=a.ProxyMode||(a.ProxyMode={}));b=function(){function a(b,c,f,x,k){var u=this;void 0===k&&(k=null);for(var q=[],w=5;w<arguments.length;w++)q[w-
5]=arguments[w];this.hdxms=e.getRedirector();this.iid=c;this.oid=f;this.mode=x;this.proxystate=m.NotConfigured;this.deferredActions=[];this.cbs=new Map;x===D.Local?(w=!1,this.iid===p.class_id_t.EngineControl&&(w=!0),this.hdxms.startRedirection(w,this.user_friendly_id()).then(function(){u.oid=a.nextId++;r.logger.log(u.user_friendly_id()+" assigned local oid:"+u.oid);var b=p.WebrpcClassLibInfoUtil.getMethodFeatureByid(c,0);return u.hdxms.WSSendObjectWrapper(b,c,0,n.WsJsonUtil.createMessageByid.apply(n.WsJsonUtil,
d([!1,!1,n.ws_msg_type_t.req,c,0,u.oid],q)))}).then(function(a){r.logger.trace("ProxyObject: setting state to configured. (iid: "+u.iid+" oid: "+u.oid+")");var c=u.oid;u.proxystate=m.Configured;u.oid=u.param0(a);r.logger.log(u.user_friendly_id()+" assigned remote oid for local oid:"+c);u.onConnected();k&&k();g.gc.trackObject(u,b)})["catch"](function(){u.proxystate=m.Error;u.onConnected()})):x===D.Remote&&(this.proxystate=m.Configured,g.gc.trackObject(this,b))}a.prototype.bind=function(a,b){r.logger.trace("ProxyObject: binding object. (iid: "+
this.iid+" oid: "+b+" mode: "+this.mode+")");if(this.mode===D.Pseudo){this.proxystate=m.Configured;var c=this.oid;this.oid=b;r.logger.log(this.user_friendly_id()+" assigned remote oid for local oid:"+c);this.onConnected();g.gc.trackObject(this,a);this.mode=D.Remote}else this.mode===D.Remote?r.logger.log("ProxyObject: binding already complete."):r.logger.log("ProxyObject: binding failure. incorrect mode!")};a.prototype.reconstructor=function(a,b,c){for(var f=this,e=[],u=3;u<arguments.length;u++)e[u-
3]=arguments[u];this.proxystate=m.NotConfigured;this.deferredActions=[];u=p.WebrpcClassLibInfoUtil.getMethodFeatureByid(b,0);this.hdxms.WSSendObjectWrapper(u,b,0,n.WsJsonUtil.createMessageByid.apply(n.WsJsonUtil,d([!1,!1,n.ws_msg_type_t.req,b,0,this.oid],e))).then(function(b){r.logger.trace("ProxyObject: setting state to configured. (iid: "+f.iid+" oid: "+f.oid+")");var c=f.oid;f.proxystate=m.Configured;f.oid=f.param0(b);r.logger.log(f.user_friendly_id()+" assigned remote oid for local oid:"+c);f.onConnected();
g.gc.trackObject(f,a)})["catch"](function(){f.proxystate=m.Error;f.onConnected()})};a.prototype.setParent=function(a){g.gc.setParent(this,a)};a.prototype.release=function(){r.logger.log(this.user_friendly_id()+".release() called.");g.gc.releaseObject(this)};a.prototype.destroy=function(){r.logger.log(this.user_friendly_id()+".destroy() called.");this.proxystate=m.Destroyed;var a=p.WebrpcClassLibInfoUtil.getMethodFeatureByid(this.iid,0);this.hdxms.WSSendObjectWrapper(a,this.iid,0,n.WsJsonUtil.createMessageByid(!1,
!0,n.ws_msg_type_t.req,this.iid,0,this.oid))};a.prototype.isdestroyed=function(){return this.proxystate==m.Destroyed};a.prototype.onConnected=function(){for(;this.deferredActions&&0<this.deferredActions.length;)this.deferredActions.shift().post(this.proxystate==m.Configured)};a.prototype.isPseudo=function(){return this.mode==D.Pseudo};a.prototype.checkState=function(a,b){var c=this;0>=a?(r.logger.log("ProxyObject.checkState() timeout waiting for connection response! failed. (iid: "+c.iid+" oid: "+
c.oid+")"),c.onConnected()):setTimeout(function(){if(c.proxystate==m.Configured)c.onConnected();else if(c.proxystate==m.Error)c.onConnected();else if(c.proxystate==m.Destroyed)c.onConnected();else r.logger.log('ProxyObject.checkState(): count= "'+a+'". (iid: '+c.iid+" oid: "+c.oid+")"),c.checkState(--a,b)},b)};a.prototype.waitUntilConnected=function(a){var b=this;return new Promise(function(c,d){b?(r.logger.trace("ProxyObject.waitUntilConnected(): readyState="+b.proxystate+". (iid: "+b.iid+" oid: "+
b.oid+")"),b.proxystate==m.Destroyed?(b.onConnected(),r.logger.trace("rejecting already destroyed Object:"+b.user_friendly_id()),d("Object already destroyed :"+b.user_friendly_id())):b.proxystate==m.Configured?(b.onConnected(),c()):b.proxystate==m.Error?(r.logger.trace("ProxyObject.waitUntilConnected(): readyState="+b.proxystate+". (iid: "+b.iid+" oid: "+b.oid+")"),b.onConnected(),d()):(r.logger.log('ProxyObject.waitUntilConnected(): deferring action "'+a+'". (iid: '+b.iid+" oid: "+b.oid+")"),b.deferredActions.push(new f(c,
d,a)),b.checkState(15,1E3))):d("Invalid Object")})};a.prototype.remoteInvoke=function(a,b){for(var c=[],g=2;g<arguments.length;g++)c[g-2]=arguments[g];if(this.proxystate==m.Destroyed)return r.logger.trace("rejecting already destroyed Object:"+this.user_friendly_id()),Promise.reject("Cannot invoke destroyed object :"+this.user_friendly_id());if(this.proxystate==m.Error)return r.logger.trace("rejecting already error state Object:"+this.user_friendly_id()),Promise.reject("Cannot invoke object in Error state:"+
this.user_friendly_id());g=p.WebrpcClassLibInfoUtil.getMethodFeatureByid(this.iid,b);return this.hdxms.WSSendObjectWrapper(g,this.iid,b,n.WsJsonUtil.createMessageByid.apply(n.WsJsonUtil,d([a,!1,n.ws_msg_type_t.req,this.iid,b,this.oid],c)))};a.prototype.logRemoteInvokeError=function(a,b){var c=a;c?r.logger.log(this.user_friendly_id()+b+" with error: "+c.message):this.param0?(r.logger.log(this.user_friendly_id()+b+" with error: "+this.param0(a)),c=new DOMException(b+" with error: "+this.param0(a),this.user_friendly_id())):
(r.logger.log(this.user_friendly_id()+b),c=new DOMException(b,this.user_friendly_id()));return c};a.prototype.registerCallbacks=function(b,c,d){this.unregisterCallbacks(d);var m=a.nextcbid++,g=new x(m,c,b);c||(b||this.cbs.set(d,m),this.hdxms.registerHandler(this.iid,this.oid,g));return g};a.prototype.unregisterCallbacks=function(a){this.cbs.has(a)?(this.hdxms.unregisterHandler(this.iid,this.oid,this.cbs.get(a)),this.cbs["delete"](a)):r.logger.trace(this.cbs)};a.prototype.object_id=function(){return this.oid};
a.prototype.param0=function(a){var b={};a&&a.params&&(b=a.params[0]);return b};a.prototype.isNullCallback=function(a){return void 0==a||null==a};a.prototype.user_friendly_id=function(){return this.constructor.name+"["+this.oid+"]"};a.prototype.isRedirected=function(){return this.hdxms.isRedirected()};a.prototype.isValid=function(){return!(this.proxystate===m.Error||this.proxystate===m.Destroyed)};a.prototype.registerStateChangeNotification=function(a){this.hdxms.registerStateChangeNotification(a)};
a.prototype.unregisterStateChangeNotification=function(a){this.hdxms.unregisterStateChangeNotification(a)};a.nextId=0;a.nextcbid=0;return a}();a.ProxyObject=b},144:function(b,a,c){function d(a){for(var b=[],c=0;c<a.length;c++)b.push({oid:a[c].object_id()});return b}var e=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return a(b,c)};return function(b,
c){function d(){this.constructor=b}a(b,c);b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),r=this&&this.__awaiter||function(a,b,c,d){function m(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,q){function l(a){try{g(d.next(a))}catch(b){q(b)}}function h(a){try{g(d["throw"](a))}catch(b){q(b)}}function g(a){a.done?c(a.value):m(a.value).then(l,h)}g((d=d.apply(a,b||[])).next())})},n=this&&this.__generator||function(a,b){function c(a){return function(b){return d([a,
b])}}function d(c){if(h)throw new TypeError("Generator is already executing.");for(;m;)try{if(h=1,g&&(l=c[0]&2?g["return"]:c[0]?g["throw"]||((l=g["return"])&&l.call(g),0):g.next)&&!(l=l.call(g,c[1])).done)return l;if(g=0,l)c=[c[0]&2,l.value];switch(c[0]){case 0:case 1:l=c;break;case 4:return m.label++,{value:c[1],done:!1};case 5:m.label++;g=c[1];c=[0];continue;case 7:c=m.ops.pop();m.trys.pop();continue;default:if(!(l=m.trys,l=0<l.length&&l[l.length-1])&&(6===c[0]||2===c[0])){m=0;continue}if(3===c[0]&&
(!l||c[1]>l[0]&&c[1]<l[3]))m.label=c[1];else if(6===c[0]&&m.label<l[1])m.label=l[1],l=c;else if(l&&m.label<l[2])m.label=l[2],m.ops.push(c);else{l[2]&&m.ops.pop();m.trys.pop();continue}}c=b.call(a,m)}catch(q){c=[6,q],g=0}finally{h=l=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var m={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},h,g,l,f;$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbolIterator();return f={next:c(0),"throw":c(1),"return":c(2)},
"function"===typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f};Object.defineProperty(a,"__esModule",{value:!0});var g=c(550),p=c(658),f=c(851),k=c(946),x=c(394),m;a.enumerateddecices=m;var D=function(){return function(a,b){this.type=a;this.target=b}}(),B=function(){function a(){this.is_local_clone=!1;this.clone_id=this.clone_count=0}a.prototype.clone=function(){this.clone_count++;var b=new a;b.is_local_clone=!0;b.clone_id=this.clone_count;return b};a.prototype.synchronize=function(a){return r(this,
void 0,void 0,function(){return n(this,function(b){return this.is_local_clone?[2,a.asyncClone()]:[2,a]})})};return a}(),t=function(a){function b(c,d){var m=a.call(this,c,g.class_id_t.MediaStreamTrack,d,p.ProxyMode.Remote)||this;m.refCount_=0;m.refCount_++;m.clone_state=new B;return m}e(b,a);b.prototype.dumpInfo=function(){f.logger.log(this.user_friendly_id()+".dumpInfo() [id="+this.id+"] kind="+this.kind+" label="+this.label+" refcount="+this.refcount)};Object.defineProperty(b.prototype,"refcount",
{get:function(){return this.refCount_},enumerable:!0,configurable:!0});b.prototype.addRef=function(){this.refCount_++;f.logger.log(this.user_friendly_id()+".addRef() called. [id="+this.id+"] refcount="+this.refCount_)};Object.defineProperty(b.prototype,"onended",{get:function(){f.logger.log(this.user_friendly_id()+".get_onended() called. [id="+this.id+"]");return this.onended_},set:function(a){var b=this;f.logger.log(this.user_friendly_id()+".set_onended() called. [id="+this.id+"]");this.onended_=
a;this.waitUntilConnected("MediaStreamTrack.onended").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),g.method_id_MediaStreamTrack_t.onended);c.then(function(a){f.logger.log(b.user_friendly_id()+"onended event received!!!");a=new D("ended",b);b.readyState_="ended";b.onended_(a)});return b.remoteInvoke(!0,g.method_id_MediaStreamTrack_t.onended,c.success)})["catch"](function(a){b.logRemoteInvokeError(a,".onended failed!")})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"onmute",{get:function(){f.logger.log(this.user_friendly_id()+".get_onmute() called. [id="+this.id+"]");return this.onmute_},set:function(a){var b=this;f.logger.log(this.user_friendly_id()+".set_onmute() called. [id="+this.id+"]");this.onmute_=a;this.waitUntilConnected("MediaStreamTrack.onmute").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),g.method_id_MediaStreamTrack_t.onmute);c.then(function(a){f.logger.log(b.user_friendly_id()+"onmute event received!!!");a=new D("mute",b);b.muted=
!0;b.onmute_(a)});return b.remoteInvoke(!0,g.method_id_MediaStreamTrack_t.onmute,c.success)})["catch"](function(a){b.logRemoteInvokeError(a,".onmute failed!")})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"onunmute",{get:function(){f.logger.log(this.user_friendly_id()+".get_onunmute() called. [id="+this.id+"]");return this.onunmute_},set:function(a){var b=this;f.logger.log(this.user_friendly_id()+".set_onunmute() called. [id="+this.id+"]");this.onunmute_=a;this.waitUntilConnected("MediaStreamTrack.onunmute").then(function(){var c=
b.registerCallbacks(!1,b.isNullCallback(a),g.method_id_MediaStreamTrack_t.onunmute);c.then(function(a){f.logger.log("onunmute event received!!!");a=new D("unmute",b);b.muted=!1;b.onunmute_(a)});return b.remoteInvoke(!0,g.method_id_MediaStreamTrack_t.onunmute,c.success)})["catch"](function(a){b.logRemoteInvokeError(a,".onunmute failed!")})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"onstop",{set:function(a){this.onstop_=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"enabled",{get:function(){f.logger.log(this.user_friendly_id()+".get_enabled() called. [id="+this.id+", value="+this.enabled_+"]");return this.enabled_},set:function(a){f.logger.log(this.user_friendly_id()+".set_enabled() called. [id="+this.id+", value="+a+"]");this.enabled_=a;this.remoteInvoke(!0,g.method_id_MediaStreamTrack_t.enabled,a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"readyState",{get:function(){f.logger.log(this.user_friendly_id()+".get_readyState() called. [id="+
this.id+"]");return this.readyState_},enumerable:!0,configurable:!0});b.prototype.asyncClone=function(){return r(this,void 0,void 0,function(){var a,c,d;return n(this,function(m){switch(m.label){case 0:return[4,this.waitUntilConnected("RemoteMediaTrack.asyncClone")];case 1:return m.sent(),[4,this.remoteInvoke(!1,g.method_id_MediaStreamTrack_t.clone,[])];case 2:return a=m.sent(),c=this.param0(a),d=new b(this,c.oid),[2,d.syncBarrier()]}})})};b.prototype.clone=function(){f.logger.log(this.user_friendly_id()+
".clone() called. [id="+this.id+"]");var a=this.clone_state.clone(),c=new b(this,this.object_id());c.id=this.id+"."+a.clone_id.toString();c.label=this.label;c.kind=this.kind;c.enabled_=this.enabled_;c.muted=this.muted;c.readyState_=this.readyState_;c.trackSettings_=this.trackSettings_;c.clone_state=a;c.constraints_=this.constraints_;c.capabilities_=this.capabilities_;return c};b.prototype.stop=function(){var a=this;f.logger.log(this.user_friendly_id()+".stop() called. [id="+this.id+"] refcount="+
this.refCount_);this.readyState_="ended";if(0<this.refCount_&&(this.refCount_--,0===this.refCount_&&(f.logger.log(this.user_friendly_id()+".stop() called. [id="+this.id+"] remote invoking..."),this.remoteInvoke(!1,g.method_id_MediaStreamTrack_t.stop)["catch"](function(b){a.logRemoteInvokeError(b,".stop failed!")}),"video"==this.kind&&"remoteapp-track"==this.label&&k.getRedirector().stopAppshare(),null!==this.onstop_&&void 0!=this.onstop_)))this.onstop_()};b.prototype.getCapabilities=function(){return this.capabilities_};
b.prototype.getConstraints=function(){return this.constraints_};b.prototype.getSettings=function(){return"audio"==this.kind?function(a){return{deviceId:a.deviceId,echoCancellation:a.echoCancellation}}(this.trackSettings_):function(a){return{aspectRatio:a.aspectRatio,deviceId:a.deviceId,frameRate:a.frameRate,height:a.height,width:a.width}}(this.trackSettings_)};b.prototype.applyConstraints=function(a){var b=this;f.logger.log(this.user_friendly_id()+".applyConstraints() called.");return new Promise(function(c,
d){b.waitUntilConnected("MediaStreamTrack.applyConstraints").then(function(){return Promise.all([b.remoteInvoke(!1,g.method_id_MediaStreamTrack_t.applyConstraints,a),b.syncBarrier()])})["catch"](function(){d({name:"OverconstrainedError",message:"Failed to apply constraints."})}).then(function(){b.constraints_=a;return b.remoteInvoke(!1,g.method_id_MediaStreamTrack_t.getConstraints)}).then(function(a){b.constraints_=b.param0(a)})["catch"](function(a){b.logRemoteInvokeError(a,".syncBarrier() remote client does not support getConstraints method. Ignore it")}).then(function(){return c()})})};
b.convertReadyState=function(a){return 0==a?"live":"ended"};b.prototype.syncBarrier=function(){var a=this;f.logger.log(this.user_friendly_id()+".syncBarrier() called.");return new Promise(function(c,d){a.waitUntilConnected("MediaStreamTrack.syncBarrier").then(function(){return Promise.all([a.remoteInvoke(!1,g.method_id_MediaStreamTrack_t.kind,""),a.remoteInvoke(!1,g.method_id_MediaStreamTrack_t.id,""),a.remoteInvoke(!1,g.method_id_MediaStreamTrack_t.label,""),a.remoteInvoke(!1,g.method_id_MediaStreamTrack_t.enabled,
!1),a.remoteInvoke(!1,g.method_id_MediaStreamTrack_t.muted,!1),a.remoteInvoke(!1,g.method_id_MediaStreamTrack_t.readyState,0),a.remoteInvoke(!1,g.method_id_MediaStreamTrack_t.getSettings),a.remoteInvoke(!1,g.method_id_MediaStreamTrack_t.getCapabilities)])}).then(function(d){var m=0;d=d.map(function(b){return a.param0(b)});a.kind=d[0];a.id=d[1];a.label=d[2];a.enabled_=d[3];a.muted=d[4];m=d[5];a.trackSettings_=d[6];a.capabilities_=d[7];a.readyState_=b.convertReadyState(m);c(a)})["catch"](function(b){b=
a.logRemoteInvokeError(b,".syncBarrier() failed!");d(b)})})};return b}(p.ProxyObject);a.RemoteMediaTrack=t;var h=function(){return function(){}}(),A=function(a){function b(c,m,h,f){void 0===h&&(h=p.ProxyMode.Local);void 0===f&&(f=[]);c=a.call(this,c,g.class_id_t.MediaStream,m,h,null,d(f))||this;c.clone_state=new B;c.tracks_=f;return c}e(b,a);b.prototype.dumpInfo=function(){f.logger.log(this.user_friendly_id()+".dumpInfo() [id="+this.id+"] active="+this.active_+" num tracks="+this.tracks_.length);
for(var a=0,b=this.tracks_;a<b.length;a++){var c=b[a];c&&c.dumpInfo()}};b.prototype.toggleAudio=function(a){f.logger.log(this.user_friendly_id()+".toggleAudio() called: "+a);for(var b=0,c=this.getAudioTracks();b<c.length;b++)c[b].enabled=a};b.prototype.toJSON=function(){var a=new h;a.id=this.id;a.active=this.active_;a.oid=this.object_id();return"RemoteStream:"+JSON.stringify(a)};Object.defineProperty(b.prototype,"active",{get:function(){f.logger.log(this.user_friendly_id()+".get active() called. [id="+
this.id+"] active="+this.active_);return this.active_},enumerable:!0,configurable:!0});b.prototype.getAudioTracks=function(){f.logger.log(this.user_friendly_id()+".getAudioTracks() called. [id="+this.id+"]");for(var a=[],b=0,c=this.tracks_;b<c.length;b++){var d=c[b];"audio"==d.kind&&a.push(d)}return a};b.prototype.getVideoTracks=function(){f.logger.log(this.user_friendly_id()+".getVideoTracks() called. [id="+this.id+"]");for(var a=[],b=0,c=this.tracks_;b<c.length;b++){var d=c[b];"video"==d.kind&&
a.push(d)}return a};b.prototype.getTracks=function(){f.logger.log(this.user_friendly_id()+".getTracks() called. [id="+this.id+"]");return this.tracks_};b.prototype.getTrackById=function(a){f.logger.log(this.user_friendly_id()+".getTrackById() called. [id="+this.id+"]");for(var b=0,c=this.tracks_;b<c.length;b++){var d=c[b];if(d.id==a)return d}};b.prototype.addTrack=function(a){var b=this;f.logger.log(this.user_friendly_id()+".addTrack() called. [id="+this.id+"]");this.tracks_.push(a);a&&a.dumpInfo();
var c=this;this.waitUntilConnected("MediaStream.addTrack").then(function(){f.logger.log(c.user_friendly_id()+".addTrack remote invoking");return c.remoteInvoke(!1,g.method_id_MediaStream_t.addTrack,{oid:a.object_id()})}).then(function(){f.logger.log(c.user_friendly_id()+".addTrack success")})["catch"](function(a){b.logRemoteInvokeError(a,".addTrack failed!")})};b.prototype.removeTrack=function(a){var b=this;f.logger.log(this.user_friendly_id()+".removeTrack() called. [id="+this.id+"]");var c=this.tracks_.indexOf(a);
this.tracks_.splice(c,1);var d=this;this.waitUntilConnected("MediaStream.removeTrack").then(function(){f.logger.log(d.user_friendly_id()+".removeTrack remote invoking");return d.remoteInvoke(!1,g.method_id_MediaStream_t.removeTrack,{oid:a.object_id()})}).then(function(){f.logger.log(d.user_friendly_id()+".removeTrack success")})["catch"](function(a){b.logRemoteInvokeError(a,".removeTrack failed!")})};b.prototype.asyncClone=function(){return r(this,void 0,void 0,function(){var a,c,d;return n(this,
function(m){switch(m.label){case 0:return f.logger.log(this.user_friendly_id()+".asyncClone() called. [id="+this.id+"]"),[4,this.waitUntilConnected("asyncClone")];case 1:return m.sent(),[4,this.remoteInvoke(!1,g.method_id_MediaStream_t.clone,[])];case 2:return a=m.sent(),console.log(a),c=this.param0(a),d=new b(this,c.oid,p.ProxyMode.Remote),[2,d.syncBarrier()]}})})};b.prototype.clone=function(){f.logger.log(this.user_friendly_id()+".clone() called. [id="+this.id+"]");var a=this.clone_state.clone(),
c=new b(this,this.object_id(),p.ProxyMode.Remote);c.id=this.id+"."+a.clone_id.toString();this.tracks_.forEach(function(a){a.addRef()});c.tracks_=this.tracks_;c.clone_state=a;return c};b.prototype.syncBarrier=function(){var a=this;f.logger.log(this.user_friendly_id()+".syncBarrier() called. [id="+this.id+"]");return new Promise(function(b,c){a.waitUntilConnected("MediaStream.syncBarrier").then(function(){return Promise.all([a.remoteInvoke(!1,g.method_id_MediaStream_t.id,""),a.remoteInvoke(!1,g.method_id_MediaStream_t.active,
!1),a.remoteInvoke(!1,g.method_id_MediaStream_t.getTracks,[])])}).then(function(b){f.logger.log(a.user_friendly_id()+".syncBarrier() remote success");b=b.map(function(b){return a.param0(b)});a.id=b[0];a.active_=b[1];b=b[2];for(var c=[],l=function(b){var l=a.tracks_.find(function(a){return a.object_id()===b.oid});void 0===l&&(f.logger.log(a.user_friendly_id()+" adding a RemoteMediaTrack with oid:"+b.oid),l=new t(a,b.oid));c.push(l.syncBarrier())},d=0;d<b.length;d++)l(b[d]);return Promise.all(c)}).then(function(c){a.tracks_=
[];c.forEach(function(b){b.onstop=function(){var b=!0;a.tracks_.forEach(function(a){"ended"!=a.readyState&&(b=!1)});b&&a.release()};a.tracks_.push(b)});b(a)})["catch"](function(b){a.logRemoteInvokeError(b,".syncBarrier failed!");c()})})};return b}(p.ProxyObject);a.RemoteStream=A;b=function(a){function b(c,d){return a.call(this,c,g.class_id_t.MediaStreamEvent,d,p.ProxyMode.Remote)||this}e(b,a);b.prototype.syncBarrier=function(){var a=this;f.logger.log(this.user_friendly_id()+".syncBarrier() called.");
return new Promise(function(b,c){a.waitUntilConnected("MediaStreamEvent.syncBarrier").then(function(){return a.remoteInvoke(!1,g.method_id_MediaStreamEvent_t.stream,{oid:0})}).then(function(b){return(new A(a,b.params[0].oid,p.ProxyMode.Remote)).syncBarrier()}).then(function(c){a.stream=c;b(a)})["catch"](function(b){b=a.logRemoteInvokeError(b,".syncBarrier() failed!");c(b)})})};return b}(p.ProxyObject);a.RemoteStreamEvent=b;var y=function(a){function b(c){return a.call(this,null,g.class_id_t.MediaDeviceInfo,
c,p.ProxyMode.Remote)||this}e(b,a);b.prototype.convertKind=function(a){return 0==a?"audioinput":1==a?"audiooutput":"videoinput"};b.prototype.syncBarrier=function(){var a=this;f.logger.log(this.user_friendly_id()+".syncBarrier() called.");return new Promise(function(b,c){a.waitUntilConnected("RemoteDeviceInfo.syncBarrier").then(function(){return Promise.all([a.remoteInvoke(!1,g.method_id_MediaDeviceInfo_t.deviceId,""),a.remoteInvoke(!1,g.method_id_MediaDeviceInfo_t.kind,0),a.remoteInvoke(!1,g.method_id_MediaDeviceInfo_t.label,
""),a.remoteInvoke(!1,g.method_id_MediaDeviceInfo_t.groupId,"")])}).then(function(c){a.kind=a.convertKind(a.param0(c.splice(1,1)[0]));c=c.map(function(b){return a.param0(b)});a.deviceId=c[0];a.label=c[1];a.groupId=c[2];b(a)})["catch"](function(b){b=a.logRemoteInvokeError(b,".syncBarrier() failed!");c(b)})})};return b}(p.ProxyObject);a.RemoteDeviceInfo=y;b=function(b){function c(){var a=b.call(this,null,g.class_id_t.MediaDevices,0,p.ProxyMode.Local,function(){a.setDeviceChangeCallback()})||this;a.devices_=
[];a.pendingEnumerateDevice_=[];return a}e(c,b);Object.defineProperty(c.prototype,"panelid",{set:function(a){this.panelid_=a},enumerable:!0,configurable:!0});c.prototype.clearPanelId=function(){this.panelid_=-1};c.prototype.enumerateDevices=function(){var a=this;return 0<this.devices_.length&&0==this.pendingEnumerateDevice_.length?new Promise(function(b,c){f.logger.log(a.user_friendly_id()+".enumerateDevices: returning cached devices with ids ["+a.devices_.map(function(a){return a.object_id()})+"]");
b(a.devices_)}):this.enumerateDevicesPrivate(!1)};c.prototype.postEnumerateDevicesResult=function(){for(var a=!0,b=0,c=0,d=this.pendingEnumerateDevice_;c<d.length;c++){var m=d[c];if(0==a&&"enumerateDevicesPrivate-remote"==m.name)break;m.postWithResult(!0,this.devices_);b++;a=!1}0<b&&this.pendingEnumerateDevice_.splice(0,b)};c.prototype.enumerateDevicesPrivate=function(b){var c=this;f.logger.log(this.user_friendly_id()+".enumerateDevicesPrivate() called. refresh:"+b+" pending:"+this.pendingEnumerateDevice_.length);
return new Promise(function(d,h){1==b||0==c.pendingEnumerateDevice_.length?(c.pendingEnumerateDevice_.push(new p.deferred_action(d,h,"enumerateDevicesPrivate-remote")),c.waitUntilConnected("RemoteDevices.enumerateDevicesPrivate").then(function(){f.logger.log(c.user_friendly_id()+".enumerateDevicesPrivate() remote invoking...");return c.remoteInvoke(!1,g.method_id_MediaDevices_t.enumerateDevices,[])}).then(function(a){var b=[];a.params[0].forEach(function(a){var d=c.devices_.find(function(b){return b.object_id()===
a.oid});void 0===d?(d=new y(a.oid),b.push(d.syncBarrier())):b.push(d)});return Promise.all(b)}).then(function(b){c.devices_.forEach(function(a){for(var c=!0,d=0;d<b.length;d++){var q=b[d];if(a.object_id()===q.object_id()){c=!1;break}}c&&a.release()});c.devices_=b;a.enumerateddecices=m=b;f.logger.log(c.user_friendly_id()+".enumerateDevicesPrivate: resolving enumerated devices with ids ["+b.map(function(a){return a.object_id()})+"]");c.postEnumerateDevicesResult()})["catch"](function(b){c.devices_=
[];a.enumerateddecices=m=[];c.logRemoteInvokeError(b,".enumerateDevicesPrivate() failed, resolving with empty list.");c.postEnumerateDevicesResult()})):(c.pendingEnumerateDevice_.push(new p.deferred_action(d,h,"enumerateDevicesPrivate")),f.logger.log(c.user_friendly_id()+".enumerateDevicesPrivate() not remoting this call..."))})};c.prototype.getDisplayMedia=function(a){var b=this;return new Promise(function(c,d){b.waitUntilConnected("RemoteDevices.getDisplayMedia").then(function(){return b.IsPanelIdValid()}).then(function(){void 0!==
a.video&&null!==a.video&&void 0!==b.panelid_&&(a.video.deviceId=b.panelid_);var c=b.prepareDisplayConstraints(a);return b.remoteInvoke(!1,g.method_id_MediaDevices_t.getDisplayMedia,c)}).then(function(a){return(new A(null,a.params[0].oid,p.ProxyMode.Remote)).syncBarrier()}).then(function(a){c(a)})["catch"](function(a){a=b.logRemoteInvokeError(a,".getDisplayMedia() failed!");d(a)})})};c.prototype.setDeviceChangeCallback=function(){var a=this;f.logger.log(this.user_friendly_id()+".set_DeviceChangeCallback() called.");
this.waitUntilConnected("MediaDevices.ondevicechange").then(function(){var b=a.registerCallbacks(!1,!1,g.method_id_MediaDevices_t.ondevicechange);b.then(function(){f.logger.log(a.user_friendly_id()+".ondevicechange(): callback received!!!");a.enumerateDevicesPrivate(!0).then(function(){navigator.mediaDevices.dispatchEvent(new CustomEvent("devicechange"))})["catch"](function(){navigator.mediaDevices.dispatchEvent(new CustomEvent("devicechange"))})});return a.remoteInvoke(!0,g.method_id_MediaDevices_t.ondevicechange,
b.success)})["catch"](function(b){a.logRemoteInvokeError(b,".set_ondevicechange() failed!")})};c.prototype.prepareDisplayConstraints=function(a){if(k.getRedirector().getFeatureValue(g.FEATURE_ms_teams_common_media_constraints))return a;var b={frameRate:15,width:{max:1920},height:{max:1080}};void 0!==a.video&&null!==a.video&&(a=a.video,void 0!==a.frameRate&&void 0!==a.width&&void 0!==a.height&&(b.frameRate=a.frameRate,b.width.max=a.width.max||a.width,b.height.max=a.height.max||a.height));return{video:b}};
c.prototype.IsPanelIdValid=function(){var a=this;return new Promise(function(b,c){if(-1!==a.panelid_)f.logger.log(a.user_friendly_id()+".IsPanelIdValid() resolving with panelid_:"+a.panelid_),b();else var d=0,m=setInterval(function(){f.logger.log(a.user_friendly_id()+".IsPanelIdValid() waiting panelid_:"+a.panelid_);50<=d?(c(),clearInterval(m),f.logger.log(a.user_friendly_id()+".IsPanelIdValid(): PanelId is invalid.")):(++d,-1!=a.panelid_&&(b(),clearInterval(m),f.logger.log(a.user_friendly_id()+".IsPanelIdValid(): PanelId is valid.")))},
10)})};return c}(p.ProxyObject);a.RemoteDevices=b;b=function(a){function b(){return a.call(this,null,g.class_id_t.NavigatorUserMedia,0,p.ProxyMode.Local)||this}e(b,a);b.getCapabilities=function(a){f.logger.log(this.constructor.name+".getCapabilities() called:"+a+" caps:"+b.caps_);return b.caps_[a]};b.resetcaps=function(){b.caps_={}};b.prototype.getCapabilities=function(){var a=this;f.logger.log(this.user_friendly_id()+".getCapabilities() called: ");return new Promise(function(c,d){a.waitUntilConnected(a.user_friendly_id()+
".getCapabilities").then(function(){return Promise.all([a.remoteInvoke(!1,g.method_id_NavigatorUserMedia_t.getCapabilities,"audio"),a.remoteInvoke(!1,g.method_id_NavigatorUserMedia_t.getCapabilities,"video")])}).then(function(d){b.caps_.audio=a.param0(d[0]);b.caps_.video=a.param0(d[1]);c(b.caps_)})["catch"](function(b){b=a.logRemoteInvokeError(b,".getCapabilities() failed!");d(b)})})};b.prototype.setCodecCapabilities=function(a){var b=this;f.logger.log(this.user_friendly_id()+".setCodecCapabilities : set codecCapabilities to "+
JSON.stringify(a));return new Promise(function(c,d){b.waitUntilConnected("NavigatorUserMedia.setCodecCapabilities").then(function(){return b.remoteInvoke(!1,g.method_id_NavigatorUserMedia_t.setCodecCapabilities,a)}).then(function(){f.logger.log(b.user_friendly_id()+".setCodecCapabilities() success.");c(!0);b.getCapabilities()})["catch"](function(a){a=b.logRemoteInvokeError(a,".setCodecCapabilities() failed!");d(a)})})};b.prototype.webkitGetUserMedia=function(a,b,c){return this.getUserMedia(a,b,c)};
b.prototype.LogTelemetryDevice_=function(a){try{if("undefined"!==typeof a.audio){var b=a.audio.deviceId,c;m.forEach(function(a){b==a.deviceId&&(c=a.label)});f.logger.log(c);this.SendTelemetryData(x.tel_key_AudioDeviceUsed,c,0)}if("undefined"!==typeof a.video){var d=a.video.mandatory.sourceId,h;m.forEach(function(a){d==a.deviceId&&(h=a.label)});f.logger.log(h);this.SendTelemetryData(x.tel_key_VideoDeviceUsed,h,0)}}catch(l){f.logger.log(l)}};b.prototype.getUserMedia=function(a,b,c){f.logger.log(this.user_friendly_id()+
".getUserMedia() called: "+JSON.stringify(a));return b&&c?this.getUserMedia_v1(a,b,c):this.getUserMedia_v2(a)};b.prototype.getUserMedia_v2=function(a){var b=this;f.logger.log(this.user_friendly_id()+".getUserMedia_v2() called: "+JSON.stringify(a));return new Promise(function(c,d){b.getUserMediaPrivate(a,function(a){f.logger.log(b.user_friendly_id()+"getUserMedia_v2: resolving stream");c(a)},function(a){f.logger.log(b.user_friendly_id()+"getUserMedia_v2: rejecting stream");d(a)})})};b.prototype.getUserMedia_v1=
function(a,b,c){f.logger.log(this.user_friendly_id()+".getUserMedia_v1() called: "+JSON.stringify(a));return this.getUserMediaPrivate(a,b,c)};b.prototype.getUserMediaPrivate=function(a,b,c){var d=this;this.waitUntilConnected("NavigatorUserMedia.getUserMediaPrivate").then(function(){var b=d.registerCallbacks(!0,!1,g.method_id_NavigatorUserMedia_t.getUserMedia);a&&"undefined"!==typeof a.audio&&0==Object.keys(a.audio).length&&(a.audio={dummy:1});if(a&&"undefined"!==typeof a.video){var c=a.video;void 0==
c.mandatory.maxFrameRate&&(c.mandatory.maxFrameRate=30);void 0==c.mandatory.minWidth&&(c.mandatory.minWidth=360);void 0==c.mandatory.maxWidth&&(c.mandatory.maxWidth=1920);void 0==c.mandatory.minHeight&&(c.mandatory.minHeight=180);void 0==c.mandatory.maxHeight&&(c.mandatory.maxHeight=1080)}d.remoteInvoke(!1,g.method_id_NavigatorUserMedia_t.getUserMedia,a,b.success,b.fail);return b.prom()}).then(function(a){f.logger.log(d.user_friendly_id()+".getUserMediaPrivate: received success callback!");return(new A(null,
d.param0(a).oid,p.ProxyMode.Remote)).syncBarrier()}).then(function(m){f.logger.log(d.user_friendly_id()+".getUserMediaPrivate: MediaStream ready to deliver",JSON.stringify(m));0==m.getTracks().length?(f.logger.log(d.user_friendly_id()+".getUserMediaPrivate: reporting no tracks as error."),c({constraintName:"",name:"OverconstrainedError",message:""})):(d.LogTelemetryDevice_(a),b(m))})["catch"](function(a){d.logRemoteInvokeError(a,".getUserMediaPrivate() failed!");k.getRedirector().getFeatureValue(g.FEATURE_ms_teams_1912)?
d.param0&&a?c(d.param0(a)):c({constraintName:"",name:"OverconstrainedError",message:""}):c({constraintName:"",name:"OverconstrainedError",message:""})})};b.prototype.SendTelemetryData=function(a,b,c){k.getRedirector().telemetry.SendTelemetryData(x.tel_cmd.Data,a,b,c)};b.caps_={};return b}(p.ProxyObject);a.NavigatorUserMedia=b},650:function(b,a,c){Object.defineProperty(a,"__esModule",{value:!0});var d=c(946),e=c(550),r=c(9),n=c(851),g=c(550),p=c(394),f;(function(a){a[a.Unknown=0]="Unknown";a[a.Windows=
1]="Windows";a[a.Linux=2]="Linux"})(f=a.RemoteType||(a.RemoteType={}));var k=function(){return function(){}}();a.SessionInfo=k;b=function(){function a(){var b=this;this.isremote_=!1;this.isremote_=!0;this.type_=f.Windows;this.address_="0.0.0.0";this.sessioninfo_=null;d.getRedirector().setRemoteSessionInfoCb(function(){return b.remoteSessionInfo()});this.enginecontrol_=new r.EngineControl}a.prototype.release=function(){d.getRedirector().setRemoteSessionInfoCb(null)};a.prototype.user_friendly_id=function(){return"[RemoteSession]"};
a.prototype.getFeatureFlags=function(){var a={};null!==this.enginecontrol_&&null!==this.enginecontrol_.features_&&void 0!==this.enginecontrol_.features_&&this.enginecontrol_.features_.forEach(function(b){a[b.name]=b.value});return a};a.prototype.isFeatureSupported=function(a){if("video"===a)return!0;if(!(a in g.featureNameMap))return!1;a=g.featureNameMap[a];for(var b=this.getFeatureFlags(),c=0;c<a.length;c++)if(!(a[c]in b)||!0!==b[a[c]])return!1;return!0};a.isFeaturePstnSupported=function(){return a.pstn_};
a.isFeatureDtmfSupported=function(){return a.dtmfswitch_};a.isFeaturAppshareSupported=function(){return a.appshare_};a.isFeatureWebrtc1dot0Supported=function(){return a.webrtc1dot0_};a.isFeatureDataChannelSupported=function(){return a.datachannel_};a.isFeatureVdNoBufferLimitSupported=function(){return a.vdnobuflimit_};a.prototype.getSessionInfo=function(){n.logger.log(this.user_friendly_id()+".getSessionInfo() called.");return null!=this.sessioninfo_?Promise.resolve(this.sessioninfo_):Promise.reject()};
a.prototype.remoteSessionInfo=function(){var b=this,c=this;n.logger.log(c.user_friendly_id()+".remoteSessionInfo() called.");return new Promise(function(g,f){c.enginecontrol_.syncBarrier().then(function(d){n.logger.log(c.user_friendly_id()+"enginecontrol info received!");c.sessioninfo_=new k;c.sessioninfo_.type_script=e.HDXMS_VERSION;c.sessioninfo_.webrpc=d.version_.major.toString()+"."+d.version_.minor.toString()+"."+d.version_.revision.toString()+"."+d.version_.build.toString();if(void 0!=d.versions_&&
null!=d.versions_){c.SendTelemetryData(p.tel_key_VerTypeScript,e.HDXMS_VERSION,0);for(var f=0,t=0,E=d.versions_;t<E.length;t++){var u=E[t],u=u.major.toString()+"."+u.minor.toString()+"."+u.revision.toString()+"."+u.build.toString();switch(f){case r.VersionType.Webrpc:c.sessioninfo_.webrpc=u;c.SendTelemetryData(p.tel_key_VerWebrpc,u,0);break;case r.VersionType.WebrtcCodecs:c.sessioninfo_.webrtc_codecs=u;c.SendTelemetryData(p.tel_key_VerWebrtcCodecs,u,0);break;case r.VersionType.Receiver:c.sessioninfo_.receiver=
u;c.SendTelemetryData(p.tel_key_VerReceiver,u,0);break;case r.VersionType.Vda:c.sessioninfo_.vda=u;c.SendTelemetryData(p.tel_key_VerVda,u,0);break;case r.VersionType.Endpoint:c.sessioninfo_.endpoint=u;c.SendTelemetryData(p.tel_key_VerEndpoint,u,0);break;default:n.logger.log(c.user_friendly_id()+"Unknown version type!")}f++}}void 0!=d.osinfo_&&null!=d.osinfo_&&(c.sessioninfo_.osinfo=d.osinfo_,d.osinfo_.family.includes("Darwin")&&d.osinfo_.edition.includes("Mac")?c.sessioninfo_.clientPlatform="Mac":
c.sessioninfo_.clientPlatform=d.osinfo_.family,c.SendTelemetryData(p.tel_key_OSFamily,d.osinfo_.family,0),c.SendTelemetryData(p.tel_key_OSVersion,d.osinfo_.version,0),c.SendTelemetryData(p.tel_key_OSArchitecture,d.osinfo_.architecture,0),c.SendTelemetryData(p.tel_key_OSDistro,d.osinfo_.distro,0),c.SendTelemetryData(p.tel_key_OSEdition,d.osinfo_.edition,0));void 0!=d.endpointid_&&null!=d.endpointid_&&(c.sessioninfo_.endpointId=d.endpointid_.machine_id);a.pstn_=b.isFeatureSupported(e.Features.FEATURE_public_pstn);
a.dtmfswitch_=b.isFeatureSupported(e.Features.FEATURE_public_dtmf);a.appshare_=b.isFeatureSupported(e.Features.FEATURE_public_app_sharing);a.webrtc1dot0_=b.isFeatureSupported(e.Features.FEATURE_public_webrtc1dot0);a.datachannel_=b.isFeatureSupported(e.Features.FEATURE_public_data_channel);a.vdnobuflimit_=b.isFeatureSupported(e.Features.FEATURE_public_vdnobuflimit);g(c.sessioninfo_);c.enginecontrol_.release()})["catch"](function(){d.getRedirector().isPingActive()?c.retrySessionInfo():(f(),c.enginecontrol_.release(),
c.enginecontrol_=null)})})};a.prototype.retrySessionInfo=function(){var a=this;setTimeout(function(){n.logger.log("checking if we are connected...");a.enginecontrol_.bind();d.getRedirector().handleRemoteSessionInfo()},15E3)};a.prototype.SendTelemetryData=function(a,b,c){d.getRedirector().telemetry.SendTelemetryData(p.tel_cmd.Data,a,b,c)};a.pstn_=!1;a.dtmfswitch_=!1;a.appshare_=!1;a.webrtc1dot0_=!1;a.datachannel_=!1;a.vdnobuflimit_=!1;return a}();a.RemoteSession=b},24:function(b,a,c){var d=this&&this.__extends||
function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return a(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c);b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(a,"__esModule",{value:!0});var e=c(658),r=c(550),n=c(851),g=c(589),p;(function(a){a[a["new"]=0]="new";a[a.connecting=1]="connecting";a[a.connected=2]=
"connected";a[a.closed=3]="closed";a[a.max=4]="max"})(p||(p={}));b=function(a){function b(c,d){var g=a.call(this,c,r.class_id_t.RTCSctpTransport,d,e.ProxyMode.Remote)||this;n.logger.log(g.user_friendly_id()+".constructor");return g}d(b,a);b.prototype.syncBarrier=function(){var a=this;n.logger.log(this.user_friendly_id()+".syncBarrier() called.");return new Promise(function(b,c){a.waitUntilConnected("RTCSctpTransport.syncBarrier").then(function(){n.logger.log(a.user_friendly_id()+".syncBarrierBase success.");
return Promise.all([a.remoteInvoke(!1,r.method_id_RTCSctpTransport_t.transport,{}),a.remoteInvoke(!1,r.method_id_RTCSctpTransport_t.state,""),a.remoteInvoke(!1,r.method_id_RTCSctpTransport_t.maxMessageSize,0),a.remoteInvoke(!1,r.method_id_RTCSctpTransport_t.maxChannels,0)])}).then(function(c){var d;d=c.map(function(b){return a.param0(b)});c=d[0];a.sctpstate_=d[1];a.maxMessageSize_=d[2];a.maxChannels_=d[3];d=a.transport_;void 0==c||!1!==c.is_null||null!==a.transport_&&a.transport_.object_id()==c.oid||
(d=new g.DtlsTransport(a,c.oid));d.syncBarrier().then(function(c){n.logger.log(a.user_friendly_id()+"transport.syncBarrier(): success");a.transport_=c;b(a)})["catch"](function(){n.logger.log(a.user_friendly_id()+"transport.syncBarrier(): failed!");a.transport_=null;b(a)})})["catch"](function(b){b=a.logRemoteInvokeError(b,".syncBarrier() failed!");c(b)})})};Object.defineProperty(b.prototype,"transport",{get:function(){n.logger.log(this.user_friendly_id()+".get_transport() called: "+this.transport_);
return this.transport_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"state",{get:function(){n.logger.log(this.user_friendly_id()+".get_state() called: "+this.sctpstate_);return this.sctpstate_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maxMessageSize",{get:function(){n.logger.log(this.user_friendly_id()+".get_maxMessageSize() called: "+this.maxMessageSize_);return this.maxMessageSize_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"maxChannels",{get:function(){n.logger.log(this.user_friendly_id()+".get_maxChannels() called: "+this.maxChannels_);return this.maxChannels_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"onstatechange",{get:function(){n.logger.log(this.user_friendly_id()+".get_onstatechange() called: "+this.onstatechange_);return this.onstatechange_},set:function(a){var c=this;n.logger.log(this.user_friendly_id()+".set_onstatechange() called.");this.onstatechange_=a;this.waitUntilConnected(this.user_friendly_id()+
".onstatechange").then(function(){var d=c.registerCallbacks(!1,c.isNullCallback(a),r.method_id_RTCSctpTransport_t.onstatechange);d.then(function(a){n.logger.log(c.user_friendly_id()+".onstatechange callback received!!!");c.sctpstate_=b.convertState(c.param0(a));n.logger.log(c.user_friendly_id()+"sctpstate_: "+c.sctpstate_);a=new Event("onstatechange");c.onstatechange_(a)});return c.remoteInvoke(!0,r.method_id_RTCSctpTransport_t.onstatechange,d.success)})["catch"](function(){n.logger.log(c.user_friendly_id()+
".onstatechange() failed.")})},enumerable:!0,configurable:!0});b.convertState=function(a){return a==p["new"]?"closed":a==p.connecting?"connecting":a==p.connected?"connected":"closed"};return b}(e.ProxyObject);a.RTCSctpTransport=b;var f;(function(a){a[a.connecting=0]="connecting";a[a.open=1]="open";a[a.closing=2]="closing";a[a.closed=3]="closed"})(f||(f={}));b=function(a){function b(c,d,g){c=a.call(this,c,r.class_id_t.RTCDataChannel,d,g)||this;c.binaryType_="blob";n.logger.log(c.user_friendly_id()+
".constructor");return c}d(b,a);b.prototype.syncBarrier=function(){var a=this;n.logger.log(this.user_friendly_id()+".syncBarrier() called.");return new Promise(function(b,c){a.waitUntilConnected("RtcDataChannel.syncBarrier").then(function(){n.logger.log(a.user_friendly_id()+".syncBarrier remote invoking.");return Promise.all([a.remoteInvoke(!1,r.method_id_RTCDataChannel_t.label,""),a.remoteInvoke(!1,r.method_id_RTCDataChannel_t.ordered,!0),a.remoteInvoke(!1,r.method_id_RTCDataChannel_t.maxPacketLifeTime,
0),a.remoteInvoke(!1,r.method_id_RTCDataChannel_t.maxRetransmits,0),a.remoteInvoke(!1,r.method_id_RTCDataChannel_t.protocol,""),a.remoteInvoke(!1,r.method_id_RTCDataChannel_t.negotiated,!1),a.remoteInvoke(!1,r.method_id_RTCDataChannel_t.id,0),a.remoteInvoke(!1,r.method_id_RTCDataChannel_t.readyState,""),a.remoteInvoke(!1,r.method_id_RTCDataChannel_t.bufferedAmount,0),a.remoteInvoke(!1,r.method_id_RTCDataChannel_t.bufferedAmountLowThreshold,0)])}).then(function(c){n.logger.log(a.user_friendly_id()+
".syncBarrier success.");var d;c=c.map(function(b){return a.param0(b)});a.label_=c[0];a.ordered_=c[1];a.maxPacketLifeTime_=c[2];a.maxRetransmits_=c[3];a.protocol_=c[4];a.negotiated_=c[5];a.id_=c[6];d=c[7];a.bufferedAmount_=c[8];a.bufferedAmountLowThreshold_=c[9];a.readyState_=a.toRTCDataChannelState(d);b(a)})["catch"](function(b){b=a.logRemoteInvokeError(b,".syncBarrier() failed!");c(b)})})};Object.defineProperty(b.prototype,"label",{get:function(){n.logger.log(this.user_friendly_id()+".get_label() called: "+
this.label_);return this.label_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"ordered",{get:function(){n.logger.log(this.user_friendly_id()+".get_ordered() called: "+this.ordered_);return this.ordered_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maxPacketLifeTime",{get:function(){n.logger.log(this.user_friendly_id()+".get_maxPacketLifeTime() called: "+this.maxPacketLifeTime_);return this.maxPacketLifeTime_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"maxRetransmits",{get:function(){n.logger.log(this.user_friendly_id()+".get_maxRetransmits() called: "+this.maxRetransmits_);return this.maxRetransmits_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"protocol",{get:function(){n.logger.log(this.user_friendly_id()+".get_protocol() called: "+this.protocol_);return this.protocol_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"negotiated",{get:function(){n.logger.log(this.user_friendly_id()+".get_negotiated() called: "+
this.negotiated_);return this.negotiated_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"id",{get:function(){n.logger.log(this.user_friendly_id()+".get_id() called: "+this.id_);return this.id_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"readyState",{get:function(){n.logger.log(this.user_friendly_id()+".get_readyState() called: "+this.readyState_);return this.readyState_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"bufferedAmount",
{get:function(){n.logger.log(this.user_friendly_id()+".get_bufferedAmount() called: "+this.bufferedAmount_);return this.bufferedAmount_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"bufferedAmountLowThreshold",{get:function(){n.logger.log(this.user_friendly_id()+".get_bufferedAmountLowThreshold() called: "+this.bufferedAmountLowThreshold_);return this.bufferedAmountLowThreshold_},set:function(a){n.logger.log(this.user_friendly_id()+".get_bufferedAmountLowThreshold() called: "+
a);this.bufferedAmountLowThreshold_=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"binaryType",{get:function(){n.logger.log(this.user_friendly_id()+".get_binaryType() called: "+this.binaryType_);return this.binaryType_},set:function(a){n.logger.log(this.user_friendly_id()+".set_binaryType() called: "+a);this.binaryType_="blob"==a||"arraybuffer"==a?a:"blob"},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"onopen",{get:function(){n.logger.log(this.user_friendly_id()+
".get_onopen() called.");return this.onopen_},set:function(a){var b=this;n.logger.log(this.user_friendly_id()+".set_onopen() called.");this.onopen_=a;this.waitUntilConnected(this.user_friendly_id()+".onopen").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),r.method_id_RTCDataChannel_t.onopen);c.then(function(a){n.logger.log(b.user_friendly_id()+".onopen callback received!!!");b.syncBarrier().then(function(){n.logger.log(b.user_friendly_id()+".onopen notifying...");var a=new Event("open",
{});Object.defineProperty(a,"target",{writable:!1,value:b});b.onopen_(a)})["catch"](function(){n.logger.log(b.user_friendly_id()+".syncBarrier(): failed!")})});return b.remoteInvoke(!0,r.method_id_RTCDataChannel_t.onopen,c.success)})["catch"](function(){n.logger.log(b.user_friendly_id()+".onopen() failed.")})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"onbufferedamountlow",{get:function(){n.logger.log(this.user_friendly_id()+".get_onbufferedamountlow() called.");return this.onbufferedamountlow_},
set:function(a){var b=this;n.logger.log(this.user_friendly_id()+".set_onbufferedamountlow() called.");this.onbufferedamountlow_=a;this.waitUntilConnected(this.user_friendly_id()+".onbufferedamountlow").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),r.method_id_RTCDataChannel_t.onbufferedamountlow);c.then(function(a){n.logger.log(b.user_friendly_id()+".onbufferedamountlow callback received!!!");a=new Event("onbufferedamountlow");Object.defineProperty(a,"target",{writable:!1,value:b});
b.onbufferedamountlow_(a)});return b.remoteInvoke(!0,r.method_id_RTCDataChannel_t.onbufferedamountlow,c.success)})["catch"](function(){n.logger.log(b.user_friendly_id()+".onbufferedamountlows() failed.")})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"onerror",{get:function(){n.logger.log(this.user_friendly_id()+".get_onerror() called.");return this.onerror_},set:function(a){var b=this;n.logger.log(this.user_friendly_id()+".set_onerror() called.");this.onerror_=a;this.waitUntilConnected(this.user_friendly_id()+
".onerror").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),r.method_id_RTCDataChannel_t.onerror);c.then(function(a){n.logger.log(b.user_friendly_id()+".onerror callback received!");a=b.param0(a);n.logger.log(b.user_friendly_id()+"error: "+a);a=new Event("onerror");Object.defineProperty(a,"target",{writable:!1,value:b});b.onerror_(a)});return b.remoteInvoke(!0,r.method_id_RTCDataChannel_t.onerror,c.success)})["catch"](function(){n.logger.log(b.user_friendly_id()+".onerror() failed.")})},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"onclosing",{get:function(){n.logger.log(this.user_friendly_id()+".get_onclosing() called.");return this.onclosing_},set:function(a){var b=this;n.logger.log(this.user_friendly_id()+".set_onclosing() called.");this.onclosing_=a;this.waitUntilConnected(this.user_friendly_id()+".onclosing").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),r.method_id_RTCDataChannel_t.onclosing);c.then(function(a){n.logger.log(b.user_friendly_id()+
".onclosing callback received!!!");a=new Event("onclosing");Object.defineProperty(a,"target",{writable:!1,value:b});b.onclosing_(a)});return b.remoteInvoke(!0,r.method_id_RTCDataChannel_t.onclosing,c.success)})["catch"](function(){n.logger.log(b.user_friendly_id()+".onclosing() failed.")})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"onclose",{get:function(){n.logger.log(this.user_friendly_id()+".get_onclose() called.");return this.onclose_},set:function(a){var b=this;n.logger.log(this.user_friendly_id()+
".set_onclose() called.");this.onclose_=a;this.waitUntilConnected(this.user_friendly_id()+".onclose").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),r.method_id_RTCDataChannel_t.onclose);c.then(function(a){n.logger.log(b.user_friendly_id()+".onclose callback received!!!");a=new Event("onclose");Object.defineProperty(a,"target",{writable:!1,value:b});b.onclose_(a)});return b.remoteInvoke(!0,r.method_id_RTCDataChannel_t.onclose,c.success)})["catch"](function(){n.logger.log(b.user_friendly_id()+
".onclose() failed.")})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"onmessage",{get:function(){n.logger.log(this.user_friendly_id()+".get_onmessage() called.");return this.onmessage_},set:function(a){var b=this;n.logger.log(this.user_friendly_id()+".set_onmessage() called.");this.onmessage_=a;this.waitUntilConnected(this.user_friendly_id()+".onmessage").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),r.method_id_RTCDataChannel_t.onmessage);c.then(function(a){n.logger.log(b.user_friendly_id()+
".onmessage callback received!!!");var c=b.param0(a);a=new Event("onmessage");c.binary?a.data=c.data_ab:(c=atob(c.data_sz),a.data=c);b.onmessage_(a)});return b.remoteInvoke(!0,r.method_id_RTCDataChannel_t.onmessage,c.success)})["catch"](function(){n.logger.log(b.user_friendly_id()+".onmessage() failed.")})},enumerable:!0,configurable:!0});b.prototype.close=function(){var a=this;n.logger.log(this.user_friendly_id()+".close() called.");this.waitUntilConnected("RTCDataChannel.close").then(function(){return a.remoteInvoke(!1,
r.method_id_RTCDataChannel_t.close)}).then(function(){n.logger.log(a.user_friendly_id()+".close: success.")})["catch"](function(){n.logger.log(a.user_friendly_id()+".close: failed.")})};b.prototype.toByteArray=function(a){var b=[];a=new Uint8Array(a instanceof ArrayBuffer?a:a.buffer);for(var c in a)b.push(a[c]);return b};b.prototype.send=function(a){var b=this;n.logger.log(this.user_friendly_id()+".send() called.");this.waitUntilConnected("RTCDataChannel.send").then(function(){if("string"===typeof a)return n.logger.log(b.user_friendly_id()+
"data(string): "+a),b.remoteInvoke(!1,r.method_id_RTCDataChannel_t.send_text,a);if(a instanceof Blob)a.arrayBuffer().then(function(a){a=b.toByteArray(a);return b.remoteInvoke(!1,r.method_id_RTCDataChannel_t.send_binary,a)})["catch"](function(){n.logger.log(b.user_friendly_id()+".arrayBuffer(): failed.")});else{var c=b.toByteArray(a);return b.remoteInvoke(!1,r.method_id_RTCDataChannel_t.send_binary,c)}}).then(function(){n.logger.log(b.user_friendly_id()+".send: success.")})["catch"](function(){n.logger.log(b.user_friendly_id()+
".send: failed.")})};b.prototype.toRTCDataChannelState=function(a){var b="closed";a==f.connecting?b="connecting":a==f.open?b="open":a==f.closing?b="closing":a==f.closed&&(b="closed");return b};return b}(e.ProxyObject);a.RtcDataChannel=b},589:function(b,a,c){var d=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return a(b,c)};return function(b,c){function d(){this.constructor=
b}a(b,c);b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__awaiter||function(a,b,c,d){function g(a){return a instanceof c?a:new c(function(b){b(a)})}return new (c||(c=Promise))(function(c,q){function l(a){try{f(d.next(a))}catch(b){q(b)}}function h(a){try{f(d["throw"](a))}catch(b){q(b)}}function f(a){a.done?c(a.value):g(a.value).then(l,h)}f((d=d.apply(a,b||[])).next())})},r=this&&this.__generator||function(a,b){function c(a){return function(b){return d([a,b])}}
function d(c){if(h)throw new TypeError("Generator is already executing.");for(;g;)try{if(h=1,f&&(l=c[0]&2?f["return"]:c[0]?f["throw"]||((l=f["return"])&&l.call(f),0):f.next)&&!(l=l.call(f,c[1])).done)return l;if(f=0,l)c=[c[0]&2,l.value];switch(c[0]){case 0:case 1:l=c;break;case 4:return g.label++,{value:c[1],done:!1};case 5:g.label++;f=c[1];c=[0];continue;case 7:c=g.ops.pop();g.trys.pop();continue;default:if(!(l=g.trys,l=0<l.length&&l[l.length-1])&&(6===c[0]||2===c[0])){g=0;continue}if(3===c[0]&&
(!l||c[1]>l[0]&&c[1]<l[3]))g.label=c[1];else if(6===c[0]&&g.label<l[1])g.label=l[1],l=c;else if(l&&g.label<l[2])g.label=l[2],g.ops.push(c);else{l[2]&&g.ops.pop();g.trys.pop();continue}}c=b.call(a,g)}catch(q){c=[6,q],f=0}finally{h=l=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}var g={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},h,f,l,e;$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbolIterator();return e={next:c(0),"throw":c(1),"return":c(2)},
"function"===typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e};Object.defineProperty(a,"__esModule",{value:!0});var n=c(658),g=c(550),p=c(851),f=c(144),k=c(517),x=c(650),m=function(a){function b(c,d){var f=a.call(this,c,g.class_id_t.RTCDTMFToneChangeEvent,d,n.ProxyMode.Remote)||this;p.logger.log(f.user_friendly_id()+".constructor");return f}d(b,a);b.prototype.syncBarrier=function(){return e(this,void 0,void 0,function(){var a,b,c=this;return r(this,function(d){switch(d.label){case 0:return p.logger.log(this.user_friendly_id()+
".syncBarrier() called."),[4,this.waitUntilConnected("DTMFToneChangeEvent.syncBarrier")];case 1:return d.sent(),[4,Promise.all([this.remoteInvoke(!1,g.method_id_RTCDTMFToneChangeEvent_t.tone,""),this.remoteInvoke(!1,g.method_id_RTCDTMFToneChangeEvent_t.tone_buffer,"")])];case 2:return a=d.sent(),b=a.map(function(a){return c.param0(a)}),this.tone=b[0],this.tone_buffer_=b[1],[2,this]}})})};Object.defineProperty(b.prototype,"tone_buffer",{get:function(){return this.tone_buffer_},enumerable:!0,configurable:!0});
return b}(n.ProxyObject);a.DTMFToneChangeEvent=m;var D=function(a){function b(c,d){var f=a.call(this,c,g.class_id_t.RTCDTMFSender,d,n.ProxyMode.Remote)||this;p.logger.log(f.user_friendly_id()+".constructor");f.canInsertDTMF=!0;f.toneBuffer_="";return f}d(b,a);b.prototype.insertDTMF=function(a,b,c){var d=this;void 0===b&&(b=100);void 0===c&&(c=70);p.logger.log(this.user_friendly_id()+".insertDTMF() called, tones: "+a);this.waitUntilConnected("DtmfSender.insertDTMF").then(function(){return d.remoteInvoke(!1,
g.method_id_RTCDTMFSender_t.insertDTMF,a,b,c)}).then(function(){p.logger.log(d.user_friendly_id()+".insertDTMF() success, tones: "+a)})["catch"](function(a){d.logRemoteInvokeError(a,".insertDTMF() failed!")})};Object.defineProperty(b.prototype,"ontonechange",{get:function(){return this.ontonechange_},set:function(a){var b=this;p.logger.log(this.user_friendly_id()+".set_ontonechange() called.");this.ontonechange_=a;this.waitUntilConnected("DtmfSender.ontonechange").then(function(){var c=b.registerCallbacks(!1,
b.isNullCallback(a),g.method_id_RTCDTMFSender_t.ontonechange);c.then(function(a){p.logger.log(b.user_friendly_id()+".ontonechange callback received!");(new m(b,b.param0(a).oid)).syncBarrier().then(function(a){p.logger.log(b.user_friendly_id()+"tone: "+a.tone+" tone_buffer: "+a.tone_buffer);b.toneBuffer_=a.tone_buffer;b.ontonechange_(a)})["catch"](function(a){b.logRemoteInvokeError(a,".toneEvt.syncBarrier() failed!")})});return b.remoteInvoke(!0,g.method_id_RTCDTMFSender_t.ontonechange,c.success)})["catch"](function(a){b.logRemoteInvokeError(a,
".set_ontonechange() failed!")})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"toneBuffer",{get:function(){p.logger.log(this.user_friendly_id()+".toneBuffer() called.");return this.toneBuffer_},enumerable:!0,configurable:!0});return b}(n.ProxyObject);a.DtmfSender=D;var B=function(a){function b(c,d){var f=a.call(this,c,g.class_id_t.RTCIceTransport,d,n.ProxyMode.Remote)||this;p.logger.log(f.user_friendly_id()+".constructor");f.selectedPair=null;f.localCandidates_=[];f.remoteCandidates_=
[];return f}d(b,a);b.prototype.syncBarrier=function(){var a=this;p.logger.log(this.user_friendly_id()+".syncBarrier() called.");return new Promise(function(c,d){a.waitUntilConnected("IceTransport.syncBarrier").then(function(){return Promise.all([a.remoteInvoke(!1,g.method_id_RTCIceTransport_t.role,0),a.remoteInvoke(!1,g.method_id_RTCIceTransport_t.component,0),a.remoteInvoke(!1,g.method_id_RTCIceTransport_t.state,0),a.remoteInvoke(!1,g.method_id_RTCIceTransport_t.gatheringState,0)])}).then(function(d){p.logger.log(a.user_friendly_id()+
".syncBarrier success.");var g=0,l=0;d=d.map(function(b){return a.param0(b)});a.role_=d[0];a.component_=d[1];g=d[2];l=d[3];a.state_=b.convertState(g);a.gatheringState_=b.convertGatheringState(l);c(a)})["catch"](function(b){b=a.logRemoteInvokeError(b,".syncBarrier() failed!");d(b)})})};b.prototype.syncCandidates=function(){var a=this;p.logger.log(this.user_friendly_id()+".syncCandidates() called.");return new Promise(function(b,c){a.waitUntilConnected("IceTransport.syncCandidates").then(function(){return Promise.all([a.remoteInvoke(!1,
g.method_id_RTCIceTransport_t.localcandidates,[]),a.remoteInvoke(!1,g.method_id_RTCIceTransport_t.remotecandidates,[])])}).then(function(c){p.logger.log(a.user_friendly_id()+".syncCandidates success.");c=c.map(function(b){return a.param0(b)});a.localCandidates_=c[0];a.remoteCandidates_=c[1];b(a)})["catch"](function(b){b=a.logRemoteInvokeError(b,".syncCandidates() failed!");c(b)})})};Object.defineProperty(b.prototype,"role",{get:function(){return this.role_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"component",{get:function(){return this.component_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"State",{get:function(){return this.state_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"gatheringState",{get:function(){return this.gatheringState_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"onstatechange",{get:function(){return this.onstatechange_},set:function(a){var c=this;p.logger.log(this.user_friendly_id()+".set_onstatechange() called.");
this.onstatechange_=a;this.waitUntilConnected("IceTransport.onstatechange").then(function(){var d=c.registerCallbacks(!1,c.isNullCallback(a),g.method_id_RTCIceTransport_t.onstatechange);d.then(function(a){p.logger.log(c.user_friendly_id()+".onstatechange callback received!");c.syncCandidates().then(function(a){p.logger.log(c.user_friendly_id()+"received updated ice candidates!")});c.state_=b.convertState(c.param0(a));p.logger.log(c.user_friendly_id()+"state: "+c.state_);c.onstatechange_()});return c.remoteInvoke(!0,
g.method_id_RTCIceTransport_t.onstatechange,d.success)})["catch"](function(a){c.logRemoteInvokeError(a,".set_onstatechange failed!")})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"ongatheringstatechange",{get:function(){return this.ongatheringstatechange_},set:function(a){var c=this;p.logger.log(this.user_friendly_id()+".set_ongatheringstatechange() called.");this.ongatheringstatechange_=a;this.waitUntilConnected("IceTransport.ongatheringstatechange").then(function(){var d=
c.registerCallbacks(!1,c.isNullCallback(a),g.method_id_RTCIceTransport_t.ongatheringstatechange);d.then(function(a){p.logger.log(c.user_friendly_id()+".ongatheringstatechange callback received!");c.syncCandidates().then(function(a){p.logger.log(c.user_friendly_id()+"received updated ice candidates!")});c.gatheringState_=b.convertGatheringState(c.param0(a));p.logger.log(c.user_friendly_id()+"gatheringState: "+c.gatheringState_);c.ongatheringstatechange_()});return c.remoteInvoke(!0,g.method_id_RTCIceTransport_t.ongatheringstatechange,
d.success)})["catch"](function(a){c.logRemoteInvokeError(a,".set_ongatheringstatechange failed!")})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"onselectedcandidatepairchange",{get:function(){return this.onselectedcandidatepairchange_},set:function(a){var b=this;p.logger.log(this.user_friendly_id()+".set_onselectedcandidatepairchange() called.");this.onselectedcandidatepairchange_=a;this.waitUntilConnected("IceTransport.onselectedcandidatepairchange").then(function(){var c=
b.registerCallbacks(!1,b.isNullCallback(a),g.method_id_RTCIceTransport_t.onselectedcandidatepairchange);c.then(function(a){p.logger.log(b.user_friendly_id()+".onselectedcandidatepairchange callback received!");b.syncCandidates().then(function(a){p.logger.log(b.user_friendly_id()+"received updated ice candidates!")});b.selectedPair=b.param0(a);p.logger.log(b.user_friendly_id()+"selectedPair: "+b.selectedPair);b.onselectedcandidatepairchange_()});return b.remoteInvoke(!0,g.method_id_RTCIceTransport_t.onselectedcandidatepairchange,
c.success)})["catch"](function(a){b.logRemoteInvokeError(a,".set_onselectedcandidatepairchange failed!")})},enumerable:!0,configurable:!0});b.prototype.getLocalCandidates=function(){return this.localCandidates_};b.prototype.getRemoteCandidates=function(){return this.remoteCandidates_};b.prototype.getLocalParameters=function(){return null};b.prototype.getRemoteParameters=function(){return null};b.prototype.getSelectedCandidatePair=function(){return this.selectedPair};b.convertState=function(a){return 0==
a?"new":1==a?"checking":2==a?"connected":3==a?"completed":4==a?"failed":5==a?"disconnected":"closed"};b.convertGatheringState=function(a){return 0==a?"new":1==a?"gathering":"complete"};return b}(n.ProxyObject);a.IceTransport=B;var t;(function(a){a[a["new"]=0]="new";a[a.connecting=1]="connecting";a[a.connected=2]="connected";a[a.closed=3]="closed";a[a.failed=4]="failed";a[a.max=5]="max"})(t||(t={}));var h=function(a){function b(c,d){var f=a.call(this,c,g.class_id_t.RTCDtlsTransport,d,n.ProxyMode.Remote)||
this;p.logger.log(f.user_friendly_id()+".constructor");f.state_="new";f.transport_=null;f.remoteCertificates_=[];return f}d(b,a);b.prototype.dumpInfo=function(){p.logger.log("DtlsTransport["+this.object_id()+"].dumpInfo():");p.logger.log("    - state:"+this.state_);p.logger.log("    - transport:"+this.transport_)};b.prototype.syncBarrier=function(){var a=this;p.logger.log(this.user_friendly_id()+".syncBarrier() called.");return new Promise(function(c,d){a.waitUntilConnected("DtlsTransport.syncBarrier").then(function(){return Promise.all([a.remoteInvoke(!1,
g.method_id_RTCDtlsTransport_t.transport,{}),a.remoteInvoke(!1,g.method_id_RTCDtlsTransport_t.state,0),a.remoteInvoke(!1,g.method_id_RTCDtlsTransport_t.getRemoteCertificates,[])])}).then(function(g){var f;p.logger.log(a.user_friendly_id()+".syncBarrier remote success.");var l;f=g.map(function(b){return a.param0(b)});g=f[0];l=f[1];a.remoteCertificates_=f[2];a.state_=b.convertState(l);f=[];void 0==g||0!=g.is_null||null!==a.transport_&&a.transport_.object_id()==g.oid||(a.transport_=new B(a,g.oid),f.push(a.transport_.syncBarrier()));
Promise.all(f).then(function(){p.logger.log(a.user_friendly_id()+".syncBarrier success");c(a)})["catch"](function(b){b=a.logRemoteInvokeError(b,".prop.syncBarrier failed!");d(b)})})["catch"](function(b){b=a.logRemoteInvokeError(b,".syncBarrier failed!");d(b)})})};Object.defineProperty(b.prototype,"transport",{get:function(){return this.transport_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"state",{get:function(){p.logger.log(this.user_friendly_id()+".get_state() called: "+
this.state_);return this.state_},enumerable:!0,configurable:!0});b.prototype.getRemoteCertificates=function(){return this.remoteCertificates_};Object.defineProperty(b.prototype,"onstatechange",{get:function(){return this.onstatechange_},set:function(a){var c=this;p.logger.log(this.user_friendly_id()+".set_onstatechange() called.");this.onstatechange_=a;this.waitUntilConnected("DtlsTransport.onstatechange").then(function(){var d=c.registerCallbacks(!1,c.isNullCallback(a),g.method_id_RTCDtlsTransport_t.onstatechange);
d.then(function(a){p.logger.log(c.user_friendly_id()+".onstatechange callback received!");c.state_=b.convertState(c.param0(a));p.logger.log(c.user_friendly_id()+"state_: "+c.state_);c.onstatechange_()});return c.remoteInvoke(!0,g.method_id_RTCDtlsTransport_t.onstatechange,d.success)})["catch"](function(a){c.logRemoteInvokeError(a,".set_onstatechange failed!")})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"onerror",{get:function(){return this.onerror_},set:function(a){var b=
this;p.logger.log(this.user_friendly_id()+".set_onerror() called.");this.onerror_=a;this.waitUntilConnected("DtlsTransport.onerror").then(function(){var c=b.registerCallbacks(!1,b.isNullCallback(a),g.method_id_RTCDtlsTransport_t.onerror);c.then(function(a){p.logger.log(b.user_friendly_id()+".onerror callback received!");a=b.param0(a);p.logger.log(b.user_friendly_id()+"error: "+a);b.onerror_(a)});return b.remoteInvoke(!0,g.method_id_RTCDtlsTransport_t.onerror,c.success)})["catch"](function(a){b.logRemoteInvokeError(a,
".set_onerror failed!")})},enumerable:!0,configurable:!0});b.convertState=function(a){return a==t["new"]?"new":a==t.connecting?"connecting":a==t.connected?"connected":a==t.closed?"closed":"failed"};return b}(n.ProxyObject);a.DtlsTransport=h;b=function(a){function b(c,d,g,f){c=a.call(this,c,d,g,f)||this;p.logger.log(c.user_friendly_id()+".constructor base");c.track_=null;c.transport_=null;c.rtcpTransport_=null;return c}d(b,a);b.prototype.syncBarrierBase=function(){var a=this;p.logger.log(this.user_friendly_id()+
".syncBarrierBase() called.");return new Promise(function(b,c){var d,e,l;a instanceof A?(d=g.method_id_RTCRtpSender_t.track,e=g.method_id_RTCRtpSender_t.transport,l=g.method_id_RTCRtpSender_t.rtcpTransport):a instanceof y&&(d=g.method_id_RTCRtpReceiver_t.track,e=g.method_id_RTCRtpReceiver_t.transport,l=g.method_id_RTCRtpReceiver_t.rtcpTransport);a.waitUntilConnected("RtpSenderReceiver.syncBarrierBase").then(function(){return x.RemoteSession.isFeaturePstnSupported()&&x.RemoteSession.isFeatureDtmfSupported()?
Promise.all([a.remoteInvoke(!1,d,{oid:a.object_id()}),a.remoteInvoke(!1,e,{oid:a.object_id()}),a.remoteInvoke(!1,l,{oid:a.object_id()})]):Promise.all([a.remoteInvoke(!1,d,{oid:a.object_id()})])}).then(function(d){var l;p.logger.log(a.user_friendly_id()+".syncBarrierBase remote success.");var g;l=d.map(function(b){return a.param0(b)});d=l[0];g=l[1];l=l[2];var e=[];void 0!=d&&!1===d.is_null&&(null===a.track_||a.track_.object_id()!=d.oid?a.track_=new f.RemoteMediaTrack(a,d.oid):a.track_.bind(a,d.oid),
e.push(a.track.syncBarrier()));void 0==g||!1!==g.is_null||null!==a.transport_&&a.transport_.object_id()==g.oid||(a.transport_=new h(a,g.oid),e.push(a.transport_.syncBarrier()));void 0==l||!1!==l.is_null||null!==a.rtcpTransport_&&a.rtcpTransport_.object_id()==l.oid||(a.rtcpTransport_=new h(a,l.oid),e.push(a.rtcpTransport_.syncBarrier()));Promise.all(e).then(function(){p.logger.log(a.user_friendly_id()+".prop.syncBarrierBase success");b(a)})["catch"](function(b){b=a.logRemoteInvokeError(b,".prop.syncBarrierBase failed!");
c(b)})})["catch"](function(b){b=a.logRemoteInvokeError(b,".syncBarrierBase() failed!");c(b)})})};Object.defineProperty(b.prototype,"transport",{get:function(){p.logger.log(this.user_friendly_id()+".get transport() called.");return this.transport_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"rtcpTransport",{get:function(){p.logger.log(this.user_friendly_id()+".get rtcpTransport() called.");return this.rtcpTransport_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"track",{get:function(){return this.track_},enumerable:!0,configurable:!0});b.prototype.reinitTrack=function(a){this.track_=a};b.prototype.getStats=function(){p.logger.log(this.user_friendly_id()+".getStats() called.");var a=this;return new Promise(function(b,c){var d=this;a.isRedirected()?a.waitUntilConnected("RtpReceiver.getStats").then(function(){var c;d instanceof A?c=g.method_id_RTCRtpSender_t.getStats:d instanceof y&&(c=g.method_id_RTCRtpReceiver_t.getStats);var l=a.registerCallbacks(!0,!1,
c);l.then(function(a){void 0!==a.params&&0!==a.params.length&&b(k.StatsReport.fromJSON(JSON.parse(a.params[0])))});return a.remoteInvoke(!1,c,l.success)})["catch"](function(a){a=d.logRemoteInvokeError(a,".getStats() failed!");c(a)}):(p.logger.log(a.user_friendly_id()+".getStats(): not in active redirection!"),b())})};return b}(n.ProxyObject);a.RtpSenderReceiver=b;var A=function(a){function b(c,d,f,h){c=a.call(this,c,g.class_id_t.RTCRtpSender,d,f)||this;p.logger.log(c.user_friendly_id()+".constructor");
c.dtmf_=null;c.params_=null;c.unified_=h;return c}d(b,a);b.prototype.dumpInfo=function(){p.logger.log("RtpSender["+this.object_id()+"].dumpInfo():");this.track&&this.track.dumpInfo()};b.prototype.syncBarrier=function(){var b=this;p.logger.log(this.user_friendly_id()+".syncBarrier() called.");return new Promise(function(c,d){b.waitUntilConnected("RtpSender.syncBarrier").then(function(){return a.prototype.syncBarrierBase.call(b)}).then(function(){p.logger.log(b.user_friendly_id()+".syncBarrierBase success.");
return x.RemoteSession.isFeaturePstnSupported()&&x.RemoteSession.isFeatureDtmfSupported()?Promise.all([b.remoteInvoke(!1,g.method_id_RTCRtpSender_t.dtmf,{oid:b.object_id()}),b.remoteInvoke(!1,g.method_id_RTCRtpSender_t.getParameters,{oid:b.object_id()})]):Promise.all([])}).then(function(a){p.logger.log(b.user_friendly_id()+".syncBarrier success.");var d;a=a.map(function(a){return b.param0(a)});d=a[0];b.params_=a[1];void 0==d||!1!==d.is_null||null!==b.dtmf_&&b.dtmf_.object_id()==d.oid||(b.dtmf_=new D(b,
d.oid));c(b)})["catch"](function(a){a=b.logRemoteInvokeError(a,".syncBarrier failed!");d(a)})})};b.getCapabilities=function(a){p.logger.log(this.constructor.name+".getCapabilities() called.");return f.NavigatorUserMedia.getCapabilities(a)};Object.defineProperty(b.prototype,"dtmf",{get:function(){p.logger.log(this.user_friendly_id()+".get dtmf() called.");return this.dtmf_},enumerable:!0,configurable:!0});b.prototype.setParameters=function(a){var b=this;p.logger.log(this.user_friendly_id()+".setParameters() called.");
return new Promise(function(c,d){b.waitUntilConnected("RtpSender.setParameters").then(function(){return Promise.all([b.remoteInvoke(!1,g.method_id_RTCRtpSender_t.setParameters,a)])}).then(function(d){p.logger.log(b.user_friendly_id()+".setParameters(): success.");c();b.params_=a})["catch"](function(a){a=b.logRemoteInvokeError(a,".setParameters() failed!");d(a)})})};b.prototype.getParameters=function(){var a=this;p.logger.log(this.user_friendly_id()+".getParameters() called.");this.waitUntilConnected(this.user_friendly_id()+
".getParameters").then(function(){p.logger.log(a.user_friendly_id()+".getParameters() remote invoking");return a.remoteInvoke(!1,g.method_id_RTCRtpSender_t.getParameters,{oid:a.object_id()})}).then(function(b){p.logger.log(a.user_friendly_id()+".getParameters() success");a.params_=a.param0(b)})["catch"](function(b){a.logRemoteInvokeError(b,".getParameters() failed!")});p.logger.log(this.user_friendly_id()+".getParameters() returning: "+this.params_);return this.params_};b.prototype.replaceTrack=function(a){var b=
this;p.logger.log(this.user_friendly_id()+".replaceTrack() called. track_:"+this.track_+", withTrack:"+a);return new Promise(function(c,d){b.waitUntilConnected("RtpSender.replaceTrack").then(function(){if(a)return Promise.all([b.remoteInvoke(!1,g.method_id_RTCRtpSender_t.replaceTrack,{oid:a.object_id()})]);if(b.unified_)return Promise.all([b.remoteInvoke(!1,g.method_id_RTCRtpSender_t.replaceTrack,{oid:0})]);p.logger.log(b.user_friendly_id()+".replaceTrack(): failed with null track!");d()}).then(function(d){p.logger.log(b.user_friendly_id()+
".replaceTrack(): success.");c();b.reinitTrack(a)})["catch"](function(a){a=b.logRemoteInvokeError(a,".replaceTrack() failed!");d(a)})})};return b}(b);a.RtpSender=A;var y=function(a){function b(c,d,f,h,e){c=a.call(this,c,g.class_id_t.RTCRtpReceiver,d,f)||this;p.logger.log(c.user_friendly_id()+".constructor");c.contribsources_=[];c.syncsources_=[];c.params_=null;c.unified_=h;e&&(c.track_=e);return c}d(b,a);b.prototype.dumpInfo=function(){p.logger.log("RtpReceiver["+this.object_id()+"].dumpInfo():");
this.track&&this.track.dumpInfo();this.transport&&this.transport.dumpInfo()};b.prototype.syncBarrier=function(){var b=this;p.logger.log(this.user_friendly_id()+".syncBarrier() called.");return new Promise(function(c,d){b.waitUntilConnected("RtpReceiver.syncBarrier").then(function(){return a.prototype.syncBarrierBase.call(b)}).then(function(){p.logger.log(b.user_friendly_id()+".syncBarrierBase success.");return x.RemoteSession.isFeaturePstnSupported()&&x.RemoteSession.isFeatureDtmfSupported()?Promise.all([b.remoteInvoke(!1,
g.method_id_RTCRtpReceiver_t.getContributingSources,[]),b.remoteInvoke(!1,g.method_id_RTCRtpReceiver_t.getSynchronizationSources,[]),b.remoteInvoke(!1,g.method_id_RTCRtpReceiver_t.getParameters,{oid:b.object_id()})]):Promise.all([b.remoteInvoke(!1,g.method_id_RTCRtpReceiver_t.getContributingSources,[])])}).then(function(a){p.logger.log(b.user_friendly_id()+".syncBarrier success.");a=a.map(function(a){return b.param0(a)});b.contribsources_=a[0];b.syncsources_=a[1];b.params_=a[2];c(b)})["catch"](function(a){a=
b.logRemoteInvokeError(a,".syncBarrier() failed!");d(a)})})};b.getCapabilities=function(a){p.logger.log(this.constructor.name+".getCapabilities() called.");return f.NavigatorUserMedia.getCapabilities(a)};b.prototype.getContributingSources=function(){var a=this;p.logger.log(this.user_friendly_id()+".getContributingSources() called. "+JSON.stringify(this.contribsources_));this.waitUntilConnected("RtpReceiver.getContributingSources").then(function(){return Promise.all([a.remoteInvoke(!1,g.method_id_RTCRtpReceiver_t.getContributingSources,
[])])}).then(function(b){a.contribsources_=b.map(function(b){return a.param0(b)})[0];p.logger.log(a.user_friendly_id(),".getContributingSources() success: "+JSON.stringify(a.contribsources_))})["catch"](function(b){a.logRemoteInvokeError(b,".getContributingSources() failed!");a.contribsources_=[]});return this.contribsources_};b.prototype.getParameters=function(){p.logger.log(this.user_friendly_id()+".getParameters() called.");return this.params_};b.prototype.getSynchronizationSources=function(){p.logger.log(this.user_friendly_id()+
".getSynchronizationSources() called.");return this.syncsources_};return b}(b);a.RtpReceiver=y},377:function(b,a,c){var d=this&&this.__extends||function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return a(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c);b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(a,"__esModule",
{value:!0});var e=c(658),r=c(550),n=c(851),g=c(589);b=function(){function a(){this.direction="sendrecv";this.sendEncodings=[];this.streams=[];n.logger.log(this.user_friendly_id()+".constructor")}a.prototype.user_friendly_id=function(){return this.constructor.name};return a}();a.RtpTransceiverInit=b;var p;(function(a){a[a.kSendRecv=0]="kSendRecv";a[a.kSendOnly=1]="kSendOnly";a[a.kRecvOnly=2]="kRecvOnly";a[a.kInactive=3]="kInactive"})(p||(p={}));b=function(a){function b(c,d,k,G,t,h){c=a.call(this,c,
r.class_id_t.RTCRtpTransceiver,d,k)||this;n.logger.log(c.user_friendly_id()+".constructor");c.unified_=G;c.sender_=new g.RtpSender(c,0,e.ProxyMode.Pseudo,G);c.receiver_=h?h:new g.RtpReceiver(c,0,e.ProxyMode.Pseudo,G);t?(c.direction_=c.toRtpTransceiverDirection(t),c.currentDirection_=c.toRtpTransceiverDirection(t)):(c.direction_=p.kSendRecv,c.currentDirection_=p.kSendRecv);return c}d(b,a);b.prototype.dumpInfo=function(){n.logger.log(this.user_friendly_id()+".dumpInfo() [id="+this.mid+"] direction="+
this.toRTCRtpTransceiverDirection(this.direction_)," currentDirection="+this.toRTCRtpTransceiverDirection(this.currentDirection_));this.sender&&this.sender.dumpInfo();this.receiver&&this.receiver.dumpInfo()};b.prototype.syncBarrier=function(){var a=this;n.logger.log(this.user_friendly_id()+".syncBarrier() called.");return new Promise(function(b,c){a.waitUntilConnected("RtpTransceiver.syncBarrier").then(function(){return Promise.all([a.remoteInvoke(!1,r.method_id_RTCRtpTransceiver_t.mid,{oid:a.object_id()}),
a.remoteInvoke(!1,r.method_id_RTCRtpTransceiver_t.direction,{oid:a.object_id()}),a.remoteInvoke(!1,r.method_id_RTCRtpTransceiver_t.currentDirection,{oid:a.object_id()}),a.remoteInvoke(!1,r.method_id_RTCRtpTransceiver_t.sender,{oid:a.object_id()}),a.remoteInvoke(!1,r.method_id_RTCRtpTransceiver_t.receiver,{oid:a.object_id()})])}).then(function(c){var d;n.logger.log(a.user_friendly_id()+".syncBarrier remote success.");d=c.map(function(b){return a.param0(b)});a.mid_=d[0];a.direction_=d[1];a.currentDirection_=
d[2];c=d[3];d=d[4];var g=[];void 0!=c&&!1===c.is_null&&(a.sender_.bind(a,c.oid),g.push(a.sender_.syncBarrier()));void 0!=d&&!1===d.is_null&&(a.receiver_.bind(a,d.oid),g.push(a.receiver_.syncBarrier()));if(0==g.length)n.logger.log(a.user_friendly_id()+".syncBarrier success"),b(a);else return n.logger.log(a.user_friendly_id()+".prop.syncBarrier start"),Promise.all(g)}).then(function(){n.logger.log(a.user_friendly_id()+".syncBarrier success");b(a)})["catch"](function(b){b=a.logRemoteInvokeError(b,".syncBarrier() failed!");
c(b)})})};Object.defineProperty(b.prototype,"mid",{get:function(){n.logger.log(this.user_friendly_id()+".get_mid() called: "+this.mid_);return this.mid_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"sender",{get:function(){return this.sender_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"receiver",{get:function(){return this.receiver_},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"direction",{get:function(){n.logger.log(this.user_friendly_id()+
".get_direction() called. "+this.toRTCRtpTransceiverDirection(this.direction_));return this.toRTCRtpTransceiverDirection(this.direction_)},set:function(a){var b=this;n.logger.log(this.user_friendly_id()+".set_direction() called. "+a);this.direction_=this.toRtpTransceiverDirection(a);this.waitUntilConnected("RtpTransceiver.set_direction").then(function(){return b.remoteInvoke(!0,r.method_id_RTCRtpTransceiver_t.direction,b.toRtpTransceiverDirection(a))}).then(function(){n.logger.log(b.user_friendly_id()+
".set_direction: success.")})["catch"](function(a){b.logRemoteInvokeError(a,".set_direction() failed!")})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"currentDirection",{get:function(){n.logger.log(this.user_friendly_id()+".get_currentDirection() called. "+this.toRTCRtpTransceiverDirection(this.direction_));return this.toRTCRtpTransceiverDirection(this.currentDirection_)},enumerable:!0,configurable:!0});b.prototype.stop=function(){var a=this;n.logger.log(this.user_friendly_id()+
".stop() called.");this.waitUntilConnected("RtpTransceiver.stop").then(function(){return a.remoteInvoke(!0,r.method_id_RTCRtpTransceiver_t.stop)}).then(function(){n.logger.log(a.user_friendly_id()+".stop: success.")})["catch"](function(b){a.logRemoteInvokeError(b,".stop() failed!")})};b.prototype.setCodecPreferences=function(a){var b=this;n.logger.log(this.user_friendly_id()+".setCodecPreferences() called.");this.waitUntilConnected("RtpTransceiver.setCodecPreferences").then(function(){return b.remoteInvoke(!0,
r.method_id_RTCRtpTransceiver_t.setCodecPreferences,a)}).then(function(){n.logger.log(b.user_friendly_id()+".setCodecPreferences: success.")})["catch"](function(a){b.logRemoteInvokeError(a,".setCodecPreferences() failed!")})};b.prototype.toRtpTransceiverDirection=function(a){var b=p.kSendRecv;switch(a){case "inactive":b=p.kInactive;break;case "recvonly":b=p.kRecvOnly;break;case "sendonly":b=p.kSendOnly;break;case "sendrecv":b=p.kSendRecv;break;default:b=p.kInactive}return b};b.prototype.toRTCRtpTransceiverDirection=
function(a){var b="sendrecv";switch(a){default:b="inactive";break;case p.kRecvOnly:b="recvonly";break;case p.kSendOnly:b="sendonly";break;case p.kSendRecv:b="sendrecv"}return b};return b}(e.ProxyObject);a.RtpTransceiver=b},509:function(b,a){Object.defineProperty(a,"__esModule",{value:!0});(function(a){a[a.Unknown=0]="Unknown";a[a.Cap=1]="Cap";a[a.GetSources=2]="GetSources";a[a.SetActive=3]="SetActive";a[a.TopologyChanged=4]="TopologyChanged"})(a.sshare_cmd||(a.sshare_cmd={}));(function(a){a[a.Unknown=
0]="Unknown";a[a.Initialized=1]="Initialized";a[a.Error=2]="Error"})(a.sshare_state||(a.sshare_state={}));var c=function(){function a(){}a.prototype.onInitialized=function(a){};a.prototype.onInitComplete=function(){};a.prototype.onError=function(a){};a.prototype.onGetSources=function(a,b){};a.prototype.onSetActive=function(a,b){};a.prototype.onToplogyChanged=function(){};return a}();a.ScreenShareUtil=c},517:function(b,a){Object.defineProperty(a,"__esModule",{value:!0});var c=function(){function a(){this.items=
[]}a.fromJSON=function(b){for(var c=new a,g=0;g<b.length;g++){var e=d.fromJSON(b[g]);c.items.push(e)}return c};a.toRTCStatsReport=function(a){return a};a.prototype.toJSON=function(){return JSON.stringify(this.items)};a.prototype.result=function(){return this.items};return a}();a.StatsReport=c;var d=function(){function a(){this.names_=[];this.stat_=new Map;this.id="";this.timestamp=0;this.type=""}a.fromJSON=function(b){var c=new a;c.id=b.id||"";c.timestamp=b.timestamp||"";c.type=b.type||"";Object.keys(b).forEach(function(a){"id"!==
a&&"timestamp"!==a&&"type"!==a&&(c.names_.push(a),c.stat_.set(a,b[a]))});return c};a.prototype.toJSON=function(){return JSON.stringify({id:this.id,timestamp:this.timestamp,type:this.type,stat:this.stat_})};a.prototype.names=function(){return this.names_};a.prototype.stat=function(a){return this.stat_.get(a)};return a}();a.Stats=d},394:function(b,a,c){Object.defineProperty(a,"__esModule",{value:!0});var d=c(946),e=c(851);(function(a){a[a.unknown=0]="unknown";a[a.active=1]="active";a[a.idle=2]="idle"})(a.tel_CallState||
(a.tel_CallState={}));(function(a){a[a.unknown=0]="unknown";a[a.incoming=1]="incoming";a[a.outgoing=2]="outgoing"})(a.tel_CallDirection||(a.tel_CallDirection={}));(function(a){a[a.unknown=0]="unknown";a[a.audio=1]="audio";a[a.video=2]="video";a[a.multi=3]="multi";a[a.dshare=4]="dshare"})(a.tel_CallType||(a.tel_CallType={}));var r;(function(a){a[a.Unknown=0]="Unknown";a[a.Cap=1]="Cap";a[a.Init=2]="Init";a[a.Data=3]="Data"})(r=a.tel_cmd||(a.tel_cmd={}));a.tel_key_ConferenceCallDuration="ConferenceCallDuration";
a.tel_key_AudioCallDuration="AudioCallDuration";a.tel_key_VideoCallDuration="VideoCallDuration";a.tel_key_ScreensharingCallDuration="ScreensharingCallDuration";a.tel_key_CallEstIncoming="CallEstIncoming";a.tel_key_CallEstOutgoing="CallEstOutgoing";a.tel_key_AudioDeviceUsed="AudioDeviceUsed";a.tel_key_VideoDeviceUsed="VideoDeviceUsed";a.tel_key_SpeakerDeviceUsed="SpeakerDeviceUsed";a.tel_key_PerfCallDirection="PerfCallDirection";a.tel_key_PerfCallState="PerfCallState";a.tel_key_PerfCallType="PerfCallType";
a.tel_key_VerWebrpc="VerWebrpc";a.tel_key_VerWebrtcCodecs="VerWebrtcCodecs";a.tel_key_VerReceiver="VerReceiver";a.tel_key_VerVda="VerVda";a.tel_key_VerEndpoint="VerEndpoint";a.tel_key_VerTypeScript="VerTypeScript";a.tel_key_OSFamily="OSFamily";a.tel_key_OSVersion="OSVersion";a.tel_key_OSArchitecture="OSArchitecture";a.tel_key_OSDistro="OSDistro";a.tel_key_OSEdition="OSEdition";var n=function(){function a(b,c,d,g){this.cmd=b;this.key=c;this.value=d;this.flags=g}a.prototype.SendTelemetryData=function(a){a.SendTelemetryData(this.cmd,
this.key,this.value,this.flags)};return a}();b=function(){function a(){this.id=0;this.deferredData=[]}a.prototype.reset=function(){this.id=0;this.deferredData=[]};a.prototype.onInitialized=function(a){for(this.id=a;this.deferredData&&0<this.deferredData.length;)this.deferredData.shift().SendTelemetryData(this)};a.prototype.SendTelemetryInit=function(){0<this.id&&this.reset();try{d.getRedirector().WSSendObject({v:"telemetry",hdr:{command:r.Init,id:0},init:{domain:"HDXMM Teams",subdomain:"Teams",feature:"msteams",
version:"1.1.1.1"}})}catch(a){e.logger.log(a)}};a.prototype.SendTelemetryData=function(a,b,c,g){if(a!=r.Data)e.logger.log("invalid telemetry command!");else if(0==this.id)this.deferredData.push(new n(a,b,c,g));else try{d.getRedirector().WSSendObject({v:"telemetry",hdr:{command:a,id:this.id},data:{key:b,value:c,flags:g}})}catch(m){e.logger.log(m)}};return a}();a.Telemetry=b},307:function(b,a,c){var d=c(550).Features,e=c(360),r=c(144),n=c(679),g=c(945),p=c(368),f=c(851).logger,k=c(650),x=c(247).gc,
m=c(946);(function(a,b){a.CitrixWebRTC=b()})("undefined"!==typeof self?self:this,function(){function a(b){m.getRedirector().SendTelemetryData_Speaker(b)}function b(){var a=window.getCitrixWebrtcRedir;void 0!==a?a().then(function(a){f.log("sucesss on connect, getCitrixWebrtcRedir reg value:"+a);"1"===a&&null===I&&(f.log("supported client"),I=new k.RemoteSession)})["catch"](function(){f.log("Failure to Read Webrtc redir Reg Key");h()}):(f.log("window.getCitrixWebrtcRedir() method is not available yet"),
h())}function c(a){if("1"===a)f.log("Supported client"),m.getRedirector().pingConnectionBegin(!0);else if("0"===a){f.log("VDI Event: Unsupported client reported");try{F({event:"vdiClientDisconnected",reason:"endpointUnsupported",msg:"Unsupported endpoint connected"})}catch(b){f.log("onVMEvent(): exception: "+b.message)}}else f.log("Citrix Webrtc Redir Reg Key value is incorrect")}function h(){!1===H&&(f.log("starting MS Reg retry..."),H=!0,A(10))}function A(a){if(0>=a){H=!1;f.log("VDI Event: Reg Key not Updated after timer reported, Fallback");
try{F({event:"vdiClientDisconnected",reason:"failure",msg:"Citrix Webrtc Redir Reg Key not Present"})}catch(b){f.log("onVMEvent(): exception: "+b.message)}}else{var d=window.getCitrixWebrtcRedir;void 0!==d?d().then(function(b){f.log("CitrixMSTeamsRedir reg value:"+b);"0"===b||"1"===b?(c(b),H=!1):(f.log("MS Teams Redir Reg key not updated - Start timer"),setTimeout(function(){f.log("Timer waiting for registry to be updated count :"+a);A(--a)},1E3))})["catch"](function(){f.log("Failure to Read MS Teams redir Reg Key - Start timer");
setTimeout(function(){f.log("Timer waiting for registry to be updated count :"+a);A(--a)},1E3)}):(f.log("window.getCitrixWebrtcRedir() method is not available yet"),setTimeout(function(){f.log("Timer waiting for registry to be updated count :"+a);A(--a)},1E3))}}function y(){f.log("VDI: sendSessionInfo");I&&I.getSessionInfo().then(function(a){f.log("getSessionInfo success! info:"+JSON.stringify(a));try{F({event:"vdiClientConnected",version:a})}catch(b){f.log("onVMEvent(): exception: "+b.message)}})["catch"](function(){f.log("getSessionInfo failure! session is not fully connected yet...")})}
var E=e.PeerConnection,u=new r.NavigatorUserMedia,q=r.NavigatorUserMedia.getCapabilities,w=new r.RemoteDevices,z=new p.FrameTracker,C=0,F=window.VMEventCallback,l=!1;window.onVdiClientDisconnected=function(a){f.log("VDI Event: vdiClientDisconnected");f.log("VDI : cleanup");m.getRedirector().clearReqs();r.NavigatorUserMedia.resetcaps();z=w=u=null;I&&I.release();I=null;x.reset();f.log("VDI : cleanup done");if(!0===a&&!1===l){f.log("VDI Event: vdiClientDisconnected with failure reported");l=!0;try{F({event:"vdiClientDisconnected",
reason:"failure",msg:"Websocket Connection Failure"})}catch(b){f.log("onVMEvent(): exception: "+b.message)}}else{l=!1;try{F({event:"vdiClientDisconnected",reason:"endpointDisconnected"})}catch(b){f.log("onVMEvent(): exception: "+b.message)}}};var I=new k.RemoteSession;window.onVdiClientDisconnectedTimer=function(){f.log("VDI Event: onVdiClientDisconnectedTimer");null===I&&(I=new k.RemoteSession)};window.onVdiClientConnected=function(){f.log("VDI Event: vdiClientConnected");p.FrameTracker.sendOverlayInfo();
null!==w&&w.isValid()||(w=new r.RemoteDevices);null!==u&&u.isValid()||(u=new r.NavigatorUserMedia);u.getCapabilities().then(function(a){f.log(".getCapabilities() success "+a)})["catch"](function(){f.log(".getCapabilities() failure")});y();navigator.mediaDevices.dispatchEvent(new CustomEvent("devicechange"))};var H=!1;return{Features:d,CitrixPeerConnection:E,getUserMedia:function(a,c,d){b();f.log("VDI Shim getUserMedia");null!==u&&u.isValid()||(u=new r.NavigatorUserMedia);return u.webkitGetUserMedia(a,
c,d)},getDisplayMedia:function(a){b();f.log("VDI Shim getDisplayMedia");null!==w&&w.isValid()||(w=new r.RemoteDevices);return w.getDisplayMedia(a)},enumerateDevices:function(){b();null!==w&&w.isValid()||(w=new r.RemoteDevices);return w.enumerateDevices()},mapVideoElement:function(a){f.log("VDI New Video Element Created, Creating Mapping to VDA");null===z&&(z=new p.FrameTracker);void 0!==a.remoteVideoElement?f.log("Video element is already configured!"):(b(),Object.defineProperty(a,"remoteVideoElement",
{writable:!0,value:null}),a.id||(a.id="ctx-vid-"+C++),a.remoteVideoElement=new n.VideoElement(a.id),a.remoteVideoElement.onloadedmetadata=function(){var b=new Event("loadedmetadata");a.dispatchEvent(b)},a.remoteVideoElement.ontimeupdate=function(){var b=new Event("timeupdate");a.dispatchEvent(b)},a.remoteVideoElement.onconnectionstatechange=function(){"connected"===a.remoteVideoElement.connectionState?z.track(a,function(b){a.remoteVideoElement.setFrame(b)}):z.untrack(a)},Object.defineProperty(a,"sinkId",
{get:function(){return a.remoteVideoElement.sinkId},set:function(b){f.log("VDI Shim set video element SinkId value = "+b);a.remoteVideoElement.sinkId=b}}),Object.defineProperty(a,"srcObject",{get:function(){return a.remoteVideoElement.srcObject},set:function(b){f.log("VDI Shim set video element srcObject");a.remoteVideoElement.srcObject=b}}),Object.defineProperty(a,"videoWidth",{get:function(){return a.remoteVideoElement.videoWidth}}),Object.defineProperty(a,"videoHeight",{get:function(){return a.remoteVideoElement.videoHeight}}))},
mapAudioElement:function(c){f.log("VDI New Audio Element Created, Creating Mapping to VDA");if(void 0!==c.remoteAudioElement)f.log("Audio element is already configured!");else{b();Object.defineProperty(c,"remoteAudioElement",{writable:!0,value:null});c.remoteAudioElement=new g.AudioElement;var d=c.remoteAudioElement.play;c.play=function(){f.log("VDI Shim remote audio play");return d.apply(c.remoteAudioElement,arguments)};var l=c.remoteAudioElement.pause;c.pause=function(){f.log("VDI Shim remote audio pause");
return l.apply(c.remoteAudioElement,arguments)};Object.defineProperty(c,"sinkId",{get:function(){return c.remoteAudioElement.sinkId},set:function(a){f.log("VDI Shim set audio element SinkId value = "+a);c.setSinkId(a).then(function(){f.log("VDI Shim set audio element SinkId success")})["catch"](function(){f.log("VDI Shim set audio element SinkId failure")})}});c.setSinkId=function(b){f.log("VDI Shim set audio element SinkId value = "+b);var d=c.remoteAudioElement.setSinkId(b),l;r.enumerateddecices.forEach(function(a){b===
a.deviceId&&(l=a.label)});a(l);return d};Object.defineProperty(c,"srcObject",{get:function(){return c.remoteAudioElement.srcObject},set:function(a){f.log("VDI Shim set audio element srcObject "+JSON.stringify(a));c.remoteAudioElement.srcObject=a}})}},setVMEventCallback:function(a){F=a;m.getRedirector().isConnected()&&!window.VMEventCallback&&y();window.VMEventCallback=null;f.log("VDI Event Callback Set")},addClipRect:function(a){f.log("VDI Adding Occlusion "+JSON.stringify(a));null===z&&(z=new p.FrameTracker);
z.addOcclusion(a)},removeClipRect:function(a){f.log("VDI Removing Occlusion "+JSON.stringify(a));null===z&&(z=new p.FrameTracker);z.removeOcclusion(a)},initLog:function(a){f.setMSLogger(a);f.log("VDI init logger")},isFeatureOn:function(a){return null===I?!1:I.isFeatureSupported(a)},onConnectionChange:function(a){f.log("VDI : onConnectionChange to "+a);!1===a?f.log("Disconnecting from the VDA"):(f.log("Connecting to the VDA"),a=window.getCitrixWebrtcRedir,void 0!==a?a().then(function(a){f.log("Sucesss on connect, CitrixMSTeamsRedir reg value:"+
a);"0"===a||"1"===a?c(a):(f.log("MS Teams Redir Reg key not updated yet"),h())})["catch"](function(){f.log("Failure to Read MS Teams redir Reg Key");h()}):(f.log("window.getCitrixWebrtcRedir() method is not available yet"),h()))},setCodecCapabilities:function(a){f.log("VDI Shim setCodecCapabilities");null!==u&&u.isValid()||(u=new r.NavigatorUserMedia);return u.setCodecCapabilities(a)},createMediaStream:function(a){f.log("VDI Shim createMediaStream");b();return new r.RemoteStream(null,0,0,a)},getCapabilities:function(a){b();
f.log("VDI Shim getCapabilities");null!==u&&u.isValid()||(u=new r.NavigatorUserMedia,q=r.NavigatorUserMedia.getCapabilities);return q.apply(u,arguments)},destroyVideoElement:function(a,b){f.log("VDI Shim destroyVideoElement: ");if(a){var c=a.remoteVideoElement;c&&c.dispose();a.remoteVideoElement=void 0}},destroyAudioElement:function(a,b,c){f.log("VDI Shim destroyAudioElement: ");a&&((b=a.remoteAudioElement)&&b.dispose(),a.remoteAudioElement=void 0)}}})},679:function(b,a,c){var d=this&&this.__extends||
function(){var a=function(b,c){a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return a(b,c)};return function(b,c){function d(){this.constructor=b}a(b,c);b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(a,"__esModule",{value:!0});var e=c(658),k=c(550),n=c(851),g=c(946),p=c(550),f=function(){return function(a){this.x=Math.round(a.x)*window.devicePixelRatio;
this.y=Math.round(a.y)*window.devicePixelRatio;this.width=Math.round(a.width)*window.devicePixelRatio;this.height=Math.round(a.height)*window.devicePixelRatio}}();a.VideoRect=f;var J;(function(a){a[a.pixels=0]="pixels";a[a.percent=1]="percent"})(J||(J={}));var x=function(){function a(b){this.value=parseInt(b);this.units=this.detectUnits(b)}a.prototype.detectUnits=function(a){return-1===a.toLowerCase().indexOf("px")?J.pixels:J.percent};return a}(),m;(function(a){a[a.fill=0]="fill";a[a.contain=1]="contain";
a[a.cover=2]="cover"})(m||(m={}));var D=function(){return function(a,b){this.x=a;this.y=b}}(),B=function(){function a(b,c,d){this.fit=this.convertFit(b);this.position=new D(c,d)}a.prototype.convertFit=function(a){return"fill"==a?m.fill:"contain"==a?m.contain:"cover"==a?m.cover:m.fill};return a}();b=function(a){function b(c){var d=a.call(this,null,k.class_id_t.VideoElement,0,e.ProxyMode.Local)||this;d.srcObject_=null;d.sinkId_="";d.videoWidth=0;d.videoHeight=0;d.isLoaded=!1;d.connectionState="disconnected";
d.styleObserver=null;d.pendingRelease_=!1;d.activeConnectionEvent_=null;d.connectionEventQueue_=[];d.elementId=c;return d}d(b,a);b.prototype.dispose=function(){n.logger.log("VideoElement.dispose (elementId: "+this.elementId+" oid: "+this.object_id()+")");this.pendingRelease_=!0;this.srcObject=this.ontimeupdate=this.onloadedmetadata=null};b.prototype.setState=function(a){this.connectionState=a;if(this.onconnectionstatechange_)this.onconnectionstatechange_()};Object.defineProperty(b.prototype,"sinkId",
{get:function(){return this.sinkId_},set:function(a){var b=this;this.waitUntilConnected("VideoElement.sinkId").then(function(){return b.remoteInvoke(!0,k.method_id_VideoElement_t.sinkId,a)}).then(function(){b.sinkId_=a})["catch"](function(a){b.logRemoteInvokeError(a,".set_sinkId() failed!")})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"srcObject",{get:function(){return this.srcObject_},set:function(a){n.logger.log(this.user_friendly_id()+".srcObject: set srcObject... this.srcObject:"+
this.srcObject+" obj:"+a);if(this.srcObject_!==a){var b=g.getRedirector().getFeatureValue(p.FEATURE_ms_teams_1911);null!==this.srcObject_&&(null===a&&b&&this.disconnect(),b||this.disconnect(),this.isLoaded=!1);this.srcObject_=a;null!==this.srcObject_&&this.connectTo(this.srcObject_)}},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"onconnectionstatechange",{get:function(){return this.onconnectionstatechange_},set:function(a){n.logger.log(this.user_friendly_id()+".set_onconnectionstatechange() called.");
this.onconnectionstatechange_=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"onloadedmetadata",{set:function(a){n.logger.log(this.user_friendly_id()+".set_onloadedmetadata() called.");this.onloadedmetadata_=a},enumerable:!0,configurable:!0});b.prototype.setupOnVideoFrameChanged=function(){var a=this,b=this.registerCallbacks(!1,!1,k.method_id_VideoElement_t.onvideoframechanged);b.then(function(b){n.logger.log(a.user_friendly_id()+".onvideoframechanged",b.params);a.videoWidth=
b.params[0]||0;a.videoHeight=b.params[1]||0;a.isLoaded||(a.isLoaded=!0,a.onloadedmetadata_&&a.onloadedmetadata_())});this.remoteInvoke(!0,k.method_id_VideoElement_t.onvideoframechanged,b.success)};b.prototype.processConnectionEvent=function(){var a=this;if(0!==this.connectionEventQueue_.length&&!this.activeConnectionEvent_){var b=this.connectionEventQueue_.pop();"connectTo"==b.operation?this.activeConnectionEvent_=this.connectToAsync(b.param):"disconnect"==b.operation&&(this.activeConnectionEvent_=
this.disconnectAsync());this.activeConnectionEvent_.then(function(){a.activeConnectionEvent_=void 0;a.processConnectionEvent()})["catch"](function(){n.logger.log(a.user_friendly_id()+" : Failed to handle connection event! ");a.activeConnectionEvent_=void 0;a.processConnectionEvent()})}};b.prototype.connectTo=function(a){this.connectionEventQueue_.push({operation:"connectTo",param:a});this.processConnectionEvent()};b.prototype.disconnect=function(){this.connectionEventQueue_.push({operation:"disconnect",
param:null});this.processConnectionEvent()};b.prototype.connectToAsync=function(a){var b=this;return new Promise(function(c,d){n.logger.log(b.user_friendly_id()+".connectTo: connect media stream with id = "+a.id+", clone_id = "+a.clone_state.clone_id);b.streamId_=a.id;b.waitUntilConnected("VideoElement.connectTo").then(function(){return a.waitUntilConnected("MediaStream.connectTo")}).then(function(){b.setupOnVideoFrameChanged();return a.clone_state.synchronize(a)}).then(function(a){n.logger.log(b.user_friendly_id()+
".connectTo: remote invoking");var c=b.registerCallbacks(!0,!1,k.method_id_VideoElement_t.connectTo);return Promise.all([b.remoteInvoke(!1,k.method_id_VideoElement_t.connectTo,{oid:a.object_id()},c.success,c.fail),c.prom()])}).then(function(a){n.logger.log(b.user_friendly_id()+".connectTo: remote media stream is connected!");b.setState("connected");b.watch();b.updateTimer=setInterval(function(){b.ontimeupdate&&b.ontimeupdate()},250);(a=window.document.getElementById(b.elementId))&&b.updateStyle(a);
c()})["catch"](function(a){b.logRemoteInvokeError(a,".connectTo: failed to connect!");d()})})};b.prototype.disconnectAsync=function(){var a=this;return new Promise(function(b,c){n.logger.log(a.user_friendly_id()+".disconnect: disconnecting stream : "+a.streamId_);a.unwatch();a.waitUntilConnected("VideoElement.disconnect").then(function(){a.updateTimer&&clearInterval(a.updateTimer);var b=a.registerCallbacks(!1,!0,k.method_id_VideoElement_t.onvideoframechanged);a.remoteInvoke(!0,k.method_id_VideoElement_t.onvideoframechanged,
b.success);return a.remoteInvoke(!1,k.method_id_VideoElement_t.disconnect)}).then(function(){n.logger.log(a.user_friendly_id()+".disconnect: remote media stream is disconnected!");a.setState("disconnected");1==a.pendingRelease_&&(a.pendingRelease_=!1,a.onconnectionstatechange=null,a.release());b()})["catch"](function(b){a.logRemoteInvokeError(b,".disconnect: failed to connect!");c()})})};b.prototype.setFrame=function(a){var b=this;n.logger.log(this.user_friendly_id()+".setFrame: set video frame to",
a.x,a.y,a.width,a.height);this.waitUntilConnected("VideoElement.setFrame").then(function(){var c=new f(a);return b.remoteInvoke(!1,k.method_id_VideoElement_t.setFrame,c)}).then(function(){n.logger.log(b.user_friendly_id()+".setFrame: success!")})["catch"](function(a){b.logRemoteInvokeError(a,".setFrame: failed to connect!")})};b.prototype.addClipRect=function(a){var b=this;n.logger.log(this.user_friendly_id()+".addClipRect: ",JSON.stringify(a));this.waitUntilConnected("VideoElement.addClipRect").then(function(){var c=
new f(a);return b.remoteInvoke(!1,k.method_id_VideoElement_t.addClipRect,c)})["catch"](function(a){b.logRemoteInvokeError(a,".addClipRect failed!")})};b.prototype.removeClipRect=function(a){var b=this;n.logger.log(this.user_friendly_id()+".removeClipRect: ",JSON.stringify(a));this.waitUntilConnected("VideoElement.removeClipRect").then(function(){var c=new f(a);return b.remoteInvoke(!1,k.method_id_VideoElement_t.removeClipRect,c)})["catch"](function(a){b.logRemoteInvokeError(a,".removeClipRect failed!")})};
b.prototype.watch=function(){var a=this;if(g.getRedirector().getFeatureValue(p.FEATURE_ms_teams_video_placement)){var b=window.document.getElementById(this.elementId);b&&(this.unwatch(),this.styleObserver=new MutationObserver(function(b){b.forEach(function(b){"style"==b.attributeName?a.updateStyle(b.target):a.elementId=b.target.id})}),this.styleObserver.observe(b,{attributes:!0,attributeOldValue:!0,attributeFilter:["style","id"]}))}};b.prototype.unwatch=function(){this.styleObserver&&(this.styleObserver.disconnect(),
this.styleObserver=null)};b.prototype.updateStyle=function(a){if("connected"==this.connectionState){var b=window.getComputedStyle(a).getPropertyValue("object-fit"),c=window.getComputedStyle(a).getPropertyValue("object-position").split(" ");a=new x(c[0]);c=new x(c[1]);this.placement=new B(b,a,c)}else n.logger.log(this.user_friendly_id()+".updateStyle: video element is not connected")};Object.defineProperty(b.prototype,"placement",{get:function(){return this.placement_},set:function(a){var b=this;g.getRedirector().getFeatureValue(p.FEATURE_ms_teams_video_placement)?
this.waitUntilConnected("VideoElement.placement").then(function(){return b.remoteInvoke(!0,k.method_id_VideoElement_t.placement,a)}).then(function(){b.placement_=a})["catch"](function(a){b.logRemoteInvokeError(a,".placement setter: failed to connect!")}):n.logger.log(this.user_friendly_id()+".placement: video placement feature is not supported on a client")},enumerable:!0,configurable:!0});return b}(e.ProxyObject);a.VideoElement=b},269:function(b,a){Object.defineProperty(a,"__esModule",{value:!0});
a.FEATURE_ms_teams_redirection="ms_teams_redirection";a.FEATURE_unsupported="unsupported";var c=function(){return function(a,b,c,d){this.major=a;this.minor=b;this.revision=c;this.build=d}}();a.VersionData=c;c=function(){return function(){}}();a.FeatureData=c;c=function(){return function(a,b){this.fature=a;this.version=b}}();a.WebrpcFeatureInfo=c;c=function(){return function(a,b,c,d,g){this.family=a;this.version=b;this.architecture=c;this.distro=d;this.edition=g}}();a.OSInfo=c;c=function(){return function(a,
b){this.machine_id=a;this.user_id=b}}();a.EndpointId=c;c=function(){return function(b,c,d,e,g){void 0===g&&(g=a.FEATURE_ms_teams_redirection);this.iid=b;this.mid=c;this.name=d;this.isprop=e;this.feature=g}}();a.WebrpcMethodInfo=c;c=function(){return function(a,b,c){this.id=a;this.name=b;this.methods=c}}();a.WebrpcClassInfo=c;c=function(){return function(a,b){this.name=a;this.classes=b}}();a.WebrpcClassLibInfo=c},550:function(b,a,c){Object.defineProperty(a,"__esModule",{value:!0});var d=c(187);(function(b){for(var c in b)a.hasOwnProperty(c)||
(a[c]=b[c])})(c(187));b=function(){function a(){}a.getInterfaceByid=function(a){for(var b=0,c=d.class_lib_info.classes;b<c.length;b++){var e=c[b];if(e.id==a)return e}return null};a.getMethodByid=function(a,b){var c=this.getInterfaceByid(a);if(null!=c)for(var d=0,c=c.methods;d<c.length;d++){var f=c[d];if(f.mid==b)return f}return null};a.getMethodFeatureByid=function(a,b){var c=this.getInterfaceByid(a);if(null!=c)for(var d=0,c=c.methods;d<c.length;d++){var f=c[d];if(f.mid==b)return f.feature}return null};
a.composeClassInfoData=function(a){a=a.hdr;if(void 0==a)return"*** Invalid packet: Couldn't find hdr object ***";var b=a.proc;if(void 0==b)return"";a=b.iid;for(var b=b.methodid,c=0,e=d.class_lib_info.classes;c<e.length;c++){var f=e[c];if(f.id==a)for(var k=0,v=f.methods;k<v.length;k++){var m=v[k];if(m.mid==b)return f.name+"::"+m.name}}return""};return a}();a.WebrpcClassLibInfoUtil=b},187:function(b,a,c){Object.defineProperty(a,"__esModule",{value:!0});b=c(269);c=c(269);a.VersionData=c.VersionData;
a.FeatureData=c.FeatureData;a.OSInfo=c.OSInfo;a.EndpointId=c.EndpointId;a.BUILD_TYPE_SDK=!0;a.HDXMS_VERSION="2.0.0.4";a.FEATURE_vda_service_no_buffer_limit="wsservice_no_buffer_limit";a.FEATURE_vda_app_sharing="webrtc_app_sharing";a.FEATURE_vda_multi_window="webrtc_multi_window";a.FEATURE_ms_teams_desktop_sharing="ms_teams_desktop_sharing";a.FEATURE_ms_teams_speaking_indicator="ms_teams_speaking_indicator";a.FEATURE_ms_teams_common_media_constraints="ms_teams_common_media_constraints";a.FEATURE_ms_teams_1911=
"ms_teams_1911";a.FEATURE_ms_teams_pstn="ms_teams_pstn";a.FEATURE_ms_teams_1912="ms_teams_1912";a.FEATURE_ms_teams_mstrack_constraints="ms_teams_mstrack_constraints";a.FEATURE_ms_teams_osinfo="ms_teams_osinfo";a.FEATURE_ms_teams_endpoint_id="ms_teams_endpoint_id";a.FEATURE_ms_teams_remote_audio_notifications="ms_teams_remote_audio_notifications";a.FEATURE_ms_teams_device_group_id="ms_teams_device_group_id";a.FEATURE_ms_teams_dtmf="ms_teams_dtmf";a.FEATURE_ms_teams_video_placement="ms_teams_video_placement";
a.FEATURE_ms_teams_codec_capability="ms_teams_codec_capability";a.FEATURE_ms_teams_multi_window="ms_teams_multi_windows";a.FEATURE_ms_teams_webrtc_1dot0="ms_teams_webrtc_1.0";a.FEATURE_ms_teams_data_channel="ms_teams_data_channel";a.FEATURE_ms_teams_no_vd_buffer_limit="ms_teams_no_vd_buffer_limit";new b.WebrpcFeatureInfo(b.FEATURE_ms_teams_redirection,new b.VersionData(1,1,0,0));new b.WebrpcFeatureInfo(a.FEATURE_ms_teams_desktop_sharing,new b.VersionData(1,2,0,0));new b.WebrpcFeatureInfo(a.FEATURE_ms_teams_speaking_indicator,
new b.VersionData(1,2,0,0));new b.WebrpcFeatureInfo(a.FEATURE_ms_teams_common_media_constraints,new b.VersionData(1,4,0,0));new b.WebrpcFeatureInfo(a.FEATURE_ms_teams_1911,new b.VersionData(1,4,0,0));new b.WebrpcFeatureInfo(a.FEATURE_ms_teams_1912,new b.VersionData(1,5,0,0));new b.WebrpcFeatureInfo(a.FEATURE_ms_teams_mstrack_constraints,new b.VersionData(1,6,0,0));new b.WebrpcFeatureInfo(a.FEATURE_ms_teams_pstn,new b.VersionData(1,6,0,0));new b.WebrpcFeatureInfo(a.FEATURE_ms_teams_osinfo,new b.VersionData(1,
7,0,0));new b.WebrpcFeatureInfo(a.FEATURE_ms_teams_endpoint_id,new b.VersionData(1,7,0,0));new b.WebrpcFeatureInfo(a.FEATURE_ms_teams_remote_audio_notifications,new b.VersionData(1,7,0,0));new b.WebrpcFeatureInfo(a.FEATURE_ms_teams_device_group_id,new b.VersionData(1,7,0,0));new b.WebrpcFeatureInfo(a.FEATURE_ms_teams_codec_capability,new b.VersionData(1,7,0,0));new b.WebrpcFeatureInfo(a.FEATURE_ms_teams_dtmf,new b.VersionData(1,7,0,0));new b.WebrpcFeatureInfo(a.FEATURE_ms_teams_video_placement,new b.VersionData(1,
7,0,0));new b.WebrpcFeatureInfo(a.FEATURE_ms_teams_webrtc_1dot0,new b.VersionData(1,8,0,0));new b.WebrpcFeatureInfo(a.FEATURE_ms_teams_data_channel,new b.VersionData(1,8,0,0));new b.WebrpcFeatureInfo(a.FEATURE_ms_teams_multi_window,new b.VersionData(1,14,0,0));c=function(){function a(){}a.FEATURE_public_screenshare="screenshare";a.FEATURE_public_redirection="redirection";a.FEATURE_public_speaking_indicator="speaking_indicator";a.FEATURE_public_pstn="pstn";a.FEATURE_public_osinfo="osinfo";a.FEATURE_public_endpoint_id=
"endpointid";a.FEATURE_public_remote_audio_notifications="remoteaudionotifications";a.FEATURE_public_device_group_id="compositedevices";a.FEATURE_public_dtmf="dtmf";a.FEATURE_public_monitor_sharing="multimonitorscreenshare";a.FEATURE_public_app_sharing="appshare";a.FEATURE_public_codec_capability="codec_capability";a.FEATURE_public_webrtc1dot0="webrtc1.0";a.FEATURE_public_data_channel="datachannel";a.FEATURE_public_vdnobuflimit="vdnobuflimit";a.FEATURE_public_multi_window="multiwindow";return a}();
a.Features=c;a.featureNameMap={};a.featureNameMap[c.FEATURE_public_screenshare]=[a.FEATURE_ms_teams_desktop_sharing];a.featureNameMap[c.FEATURE_public_redirection]=[b.FEATURE_ms_teams_redirection];a.featureNameMap[c.FEATURE_public_speaking_indicator]=[a.FEATURE_ms_teams_speaking_indicator];a.featureNameMap[c.FEATURE_public_pstn]=[a.FEATURE_ms_teams_pstn];a.featureNameMap[c.FEATURE_public_osinfo]=[a.FEATURE_ms_teams_osinfo];a.featureNameMap[c.FEATURE_public_endpoint_id]=[a.FEATURE_ms_teams_endpoint_id];
a.featureNameMap[c.FEATURE_public_remote_audio_notifications]=[a.FEATURE_ms_teams_remote_audio_notifications];a.featureNameMap[c.FEATURE_public_device_group_id]=[a.FEATURE_ms_teams_device_group_id];a.featureNameMap[c.FEATURE_public_dtmf]=[a.FEATURE_ms_teams_dtmf];a.featureNameMap[c.FEATURE_public_codec_capability]=[a.FEATURE_ms_teams_codec_capability];a.featureNameMap[c.FEATURE_public_webrtc1dot0]=[a.FEATURE_ms_teams_webrtc_1dot0];a.featureNameMap[c.FEATURE_public_multi_window]=[a.FEATURE_ms_teams_multi_window];
a.featureNameMap[c.FEATURE_public_data_channel]=[a.FEATURE_ms_teams_data_channel];a.featureNameMap[c.FEATURE_public_vdnobuflimit]=[a.FEATURE_ms_teams_no_vd_buffer_limit];(function(a){a[a.EngineControl=0]="EngineControl";a[a.RTCPeerConnection=1]="RTCPeerConnection";a[a.RTCSessionDescription=2]="RTCSessionDescription";a[a.RTCIceCandidate=3]="RTCIceCandidate";a[a.RTCIceCandidateEvent=4]="RTCIceCandidateEvent";a[a.MediaDevices=5]="MediaDevices";a[a.MediaDeviceInfo=6]="MediaDeviceInfo";a[a.MediaStreamTrack=
7]="MediaStreamTrack";a[a.MediaStreamEvent=8]="MediaStreamEvent";a[a.MediaStream=9]="MediaStream";a[a.NavigatorUserMedia=10]="NavigatorUserMedia";a[a.VideoElement=11]="VideoElement";a[a.AudioElement=12]="AudioElement";a[a.RTCRtpReceiver=13]="RTCRtpReceiver";a[a.RTCRtpSender=14]="RTCRtpSender";a[a.RTCDtlsTransport=15]="RTCDtlsTransport";a[a.RTCIceTransport=16]="RTCIceTransport";a[a.RTCDTMFSender=17]="RTCDTMFSender";a[a.RTCDTMFToneChangeEvent=18]="RTCDTMFToneChangeEvent";a[a.RTCIceCandidatePair=19]=
"RTCIceCandidatePair";a[a.RTCRtpTransceiver=20]="RTCRtpTransceiver";a[a.reserved3=21]="reserved3";a[a.reserved4=22]="reserved4";a[a.reserved1=23]="reserved1";a[a.reserved2=24]="reserved2";a[a.RTCDataChannel=25]="RTCDataChannel";a[a.RTCSctpTransport=26]="RTCSctpTransport"})(c=a.class_id_t||(a.class_id_t={}));var d;(function(a){a[a.ctor=0]="ctor";a[a.version=1]="version";a[a.feature_flags=2]="feature_flags";a[a.version_info=3]="version_info";a[a.osinfo=4]="osinfo";a[a.endpoint_id=5]="endpoint_id"})(d=
a.method_id_EngineControl_t||(a.method_id_EngineControl_t={}));var e;(function(a){a[a.ctor=0]="ctor";a[a.localDescription=1]="localDescription";a[a.remoteDescription=2]="remoteDescription";a[a.readyState=3]="readyState";a[a.iceState=4]="iceState";a[a.localStreams=5]="localStreams";a[a.remoteStreams=6]="remoteStreams";a[a.createOffer=7]="createOffer";a[a.createAnswer=8]="createAnswer";a[a.setLocalDescription=9]="setLocalDescription";a[a.setRemoteDescription=10]="setRemoteDescription";a[a.updateIce=
11]="updateIce";a[a.addIceCandidate=12]="addIceCandidate";a[a.addStream=13]="addStream";a[a.removeStream=14]="removeStream";a[a.close=15]="close";a[a.iceConnectionState=16]="iceConnectionState";a[a.iceGatheringState=17]="iceGatheringState";a[a.signalingState=18]="signalingState";a[a.onaddstream=19]="onaddstream";a[a.onicecandidate=20]="onicecandidate";a[a.oniceconnectionstatechange=21]="oniceconnectionstatechange";a[a.onicegatheringstatechange=22]="onicegatheringstatechange";a[a.onsignalingstatechange=
23]="onsignalingstatechange";a[a.onnegotiationneeded=24]="onnegotiationneeded";a[a.onremovestream=25]="onremovestream";a[a.getStats=26]="getStats";a[a.getReceivers=27]="getReceivers";a[a.getSenders=28]="getSenders";a[a.addTrack=29]="addTrack";a[a.removeTrack=30]="removeTrack";a[a.ontrack=31]="ontrack";a[a.setLocalDescription_v2=32]="setLocalDescription_v2";a[a.setRemoteDescription_v2=33]="setRemoteDescription_v2";a[a.addTransceiverWithTrack=34]="addTransceiverWithTrack";a[a.addTransceiverWithKind=
35]="addTransceiverWithKind";a[a.getTransceivers=36]="getTransceivers";a[a.onconnectionstatechange=37]="onconnectionstatechange";a[a.sctp=38]="sctp";a[a.ondatachannel=39]="ondatachannel";a[a.createDataChannel=40]="createDataChannel";a[a.getStats_v2=41]="getStats_v2"})(e=a.method_id_RTCPeerConnection_t||(a.method_id_RTCPeerConnection_t={}));var k;(function(a){a[a.ctor=0]="ctor";a[a.enumerateDevices=1]="enumerateDevices";a[a.getDisplayMedia=2]="getDisplayMedia";a[a.ondevicechange=3]="ondevicechange"})(k=
a.method_id_MediaDevices_t||(a.method_id_MediaDevices_t={}));var n;(function(a){a[a.ctor=0]="ctor";a[a.deviceId=1]="deviceId";a[a.kind=2]="kind";a[a.label=3]="label";a[a.groupId=4]="groupId"})(n=a.method_id_MediaDeviceInfo_t||(a.method_id_MediaDeviceInfo_t={}));var g;(function(a){a[a.ctor=0]="ctor";a[a.type=1]="type";a[a.sdp=2]="sdp"})(g=a.method_id_RTCSessionDescription_t||(a.method_id_RTCSessionDescription_t={}));var p;(function(a){a[a.ctor=0]="ctor";a[a.kind=1]="kind";a[a.id=2]="id";a[a.label=
3]="label";a[a.enabled=4]="enabled";a[a.muted=5]="muted";a[a.readyState=6]="readyState";a[a.onended=7]="onended";a[a.onmute=8]="onmute";a[a.onunmute=9]="onunmute";a[a.clone=10]="clone";a[a.stop=11]="stop";a[a.getCapabilities=12]="getCapabilities";a[a.getSettings=13]="getSettings";a[a.applyConstraints=14]="applyConstraints";a[a.getConstraints=15]="getConstraints"})(p=a.method_id_MediaStreamTrack_t||(a.method_id_MediaStreamTrack_t={}));var f;(function(a){a[a.ctor=0]="ctor";a[a.id=1]="id";a[a.getAudioTracks=
2]="getAudioTracks";a[a.getVideoTracks=3]="getVideoTracks";a[a.getTracks=4]="getTracks";a[a.getTrackById=5]="getTrackById";a[a.addTrack=6]="addTrack";a[a.removeTrack=7]="removeTrack";a[a.clone=8]="clone";a[a.active=9]="active"})(f=a.method_id_MediaStream_t||(a.method_id_MediaStream_t={}));var J;(function(a){a[a.ctor=0]="ctor";a[a.getUserMedia=1]="getUserMedia";a[a.setCodecCapabilities=2]="setCodecCapabilities";a[a.getCapabilities=3]="getCapabilities"})(J=a.method_id_NavigatorUserMedia_t||(a.method_id_NavigatorUserMedia_t=
{}));var x;(function(a){a[a.ctor=0]="ctor";a[a.candidate=1]="candidate";a[a.sdpMid=2]="sdpMid";a[a.sdpMLineIndex=3]="sdpMLineIndex"})(x=a.method_id_RTCIceCandidate_t||(a.method_id_RTCIceCandidate_t={}));var m;(function(a){a[a.ctor=0]="ctor";a[a.candidate=1]="candidate"})(m=a.method_id_RTCIceCandidateEvent_t||(a.method_id_RTCIceCandidateEvent_t={}));var D;(function(a){a[a.ctor=0]="ctor";a[a.stream=1]="stream"})(D=a.method_id_MediaStreamEvent_t||(a.method_id_MediaStreamEvent_t={}));var B;(function(a){a[a.ctor=
0]="ctor";a[a.sinkId=1]="sinkId";a[a.connectTo=2]="connectTo";a[a.disconnect=3]="disconnect";a[a.setFrame=4]="setFrame";a[a.addClipRect=5]="addClipRect";a[a.removeClipRect=6]="removeClipRect";a[a.onerror=7]="onerror";a[a.onvideoframechanged=8]="onvideoframechanged";a[a.placement=9]="placement"})(B=a.method_id_VideoElement_t||(a.method_id_VideoElement_t={}));var t;(function(a){a[a.ctor=0]="ctor";a[a.sinkId=1]="sinkId";a[a.srcObject=2]="srcObject";a[a.src=3]="src";a[a.play=4]="play";a[a.pause=5]="pause"})(t=
a.method_id_AudioElement_t||(a.method_id_AudioElement_t={}));var h;(function(a){a[a.ctor=0]="ctor";a[a.track=1]="track";a[a.getContributingSources=2]="getContributingSources";a[a.getSynchronizationSources=3]="getSynchronizationSources";a[a.transport=4]="transport";a[a.rtcpTransport=5]="rtcpTransport";a[a.getCapabilities=6]="getCapabilities";a[a.getParameters=7]="getParameters";a[a.getStats=8]="getStats";a[a.getCapabilities_v2=9]="getCapabilities_v2"})(h=a.method_id_RTCRtpReceiver_t||(a.method_id_RTCRtpReceiver_t=
{}));var A;(function(a){a[a.ctor=0]="ctor";a[a.track=1]="track";a[a.transport=2]="transport";a[a.rtcpTransport=3]="rtcpTransport";a[a.dtmf=4]="dtmf";a[a.getCapabilities=5]="getCapabilities";a[a.getParameters=6]="getParameters";a[a.setParameters=7]="setParameters";a[a.replaceTrack=8]="replaceTrack";a[a.getStats=9]="getStats";a[a.setStreams=10]="setStreams";a[a.getCapabilities_v2=11]="getCapabilities_v2"})(A=a.method_id_RTCRtpSender_t||(a.method_id_RTCRtpSender_t={}));var y;(function(a){a[a.ctor=0]=
"ctor";a[a.transport=1]="transport";a[a.state=2]="state";a[a.getRemoteCertificates=3]="getRemoteCertificates";a[a.onstatechange=4]="onstatechange";a[a.onerror=5]="onerror"})(y=a.method_id_RTCDtlsTransport_t||(a.method_id_RTCDtlsTransport_t={}));var E;(function(a){a[a.ctor=0]="ctor";a[a.role=1]="role";a[a.component=2]="component";a[a.state=3]="state";a[a.gatheringState=4]="gatheringState";a[a.localcandidates=5]="localcandidates";a[a.remotecandidates=6]="remotecandidates";a[a.onstatechange=7]="onstatechange";
a[a.ongatheringstatechange=8]="ongatheringstatechange";a[a.onselectedcandidatepairchange=9]="onselectedcandidatepairchange"})(E=a.method_id_RTCIceTransport_t||(a.method_id_RTCIceTransport_t={}));var u;(function(a){a[a.ctor=0]="ctor";a[a.insertDTMF=1]="insertDTMF";a[a.ontonechange=2]="ontonechange";a[a.canInsertDTMF=3]="canInsertDTMF";a[a.toneBuffer=4]="toneBuffer"})(u=a.method_id_RTCDTMFSender_t||(a.method_id_RTCDTMFSender_t={}));var q;(function(a){a[a.ctor=0]="ctor";a[a.tone=1]="tone";a[a.tone_buffer=
2]="tone_buffer"})(q=a.method_id_RTCDTMFToneChangeEvent_t||(a.method_id_RTCDTMFToneChangeEvent_t={}));var w;(function(a){a[a.ctor=0]="ctor";a[a.local=1]="local";a[a.remote=2]="remote"})(w=a.method_id_RTCIceCandidatePair_t||(a.method_id_RTCIceCandidatePair_t={}));var z;(function(a){a[a.ctor=0]="ctor";a[a.mid=1]="mid";a[a.sender=2]="sender";a[a.receiver=3]="receiver";a[a.direction=4]="direction";a[a.currentDirection=5]="currentDirection";a[a.stop=6]="stop";a[a.setCodecPreferences=7]="setCodecPreferences"})(z=
a.method_id_RTCRtpTransceiver_t||(a.method_id_RTCRtpTransceiver_t={}));var C;(function(a){a[a.ctor=0]="ctor";a[a.label=1]="label";a[a.ordered=2]="ordered";a[a.maxPacketLifeTime=3]="maxPacketLifeTime";a[a.maxRetransmits=4]="maxRetransmits";a[a.protocol=5]="protocol";a[a.negotiated=6]="negotiated";a[a.id=7]="id";a[a.readyState=8]="readyState";a[a.bufferedAmount=9]="bufferedAmount";a[a.bufferedAmountLowThreshold=10]="bufferedAmountLowThreshold";a[a.onopen=11]="onopen";a[a.onbufferedamountlow=12]="onbufferedamountlow";
a[a.onerror=13]="onerror";a[a.onclosing=14]="onclosing";a[a.onclose=15]="onclose";a[a.onmessage=16]="onmessage";a[a.close=17]="close";a[a.send_text=18]="send_text";a[a.send_binary=19]="send_binary"})(C=a.method_id_RTCDataChannel_t||(a.method_id_RTCDataChannel_t={}));var F;(function(a){a[a.ctor=0]="ctor";a[a.transport=1]="transport";a[a.state=2]="state";a[a.maxMessageSize=3]="maxMessageSize";a[a.maxChannels=4]="maxChannels";a[a.onstatechange=5]="onstatechange"})(F=a.method_id_RTCSctpTransport_t||(a.method_id_RTCSctpTransport_t=
{}));a.class_lib_info=new b.WebrpcClassLibInfo("webrpc_class_library",[new b.WebrpcClassInfo(c.EngineControl,"EngineControl",[new b.WebrpcMethodInfo(c.EngineControl,d.ctor,"ctor",!1),new b.WebrpcMethodInfo(c.EngineControl,d.version,"version",!0),new b.WebrpcMethodInfo(c.EngineControl,d.feature_flags,"feature_flags",!0),new b.WebrpcMethodInfo(c.EngineControl,d.version_info,"version_info",!0,a.FEATURE_ms_teams_desktop_sharing),new b.WebrpcMethodInfo(c.EngineControl,d.osinfo,"osinfo",!0,a.FEATURE_ms_teams_osinfo),
new b.WebrpcMethodInfo(c.EngineControl,d.endpoint_id,"endpoint_id",!0,a.FEATURE_ms_teams_endpoint_id)]),new b.WebrpcClassInfo(c.RTCPeerConnection,"RTCPeerConnection",[new b.WebrpcMethodInfo(c.RTCPeerConnection,e.ctor,"ctor",!1),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.localDescription,"localDescription",!0),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.remoteDescription,"remoteDescription",!0),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.readyState,"readyState",!0),new b.WebrpcMethodInfo(c.RTCPeerConnection,
e.iceState,"iceState",!0),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.localStreams,"localStreams",!0),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.remoteStreams,"remoteStreams",!0),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.createOffer,"createOffer",!1),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.createAnswer,"createAnswer",!1),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.setLocalDescription,"setLocalDescription",!1),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.setRemoteDescription,"setRemoteDescription",
!1),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.updateIce,"updateIce",!0),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.addIceCandidate,"addIceCandidate",!0),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.addStream,"addStream",!0),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.removeStream,"removeStream",!0),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.close,"close",!0),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.iceConnectionState,"iceConnectionState",!0),new b.WebrpcMethodInfo(c.RTCPeerConnection,
e.iceGatheringState,"iceGatheringState",!0),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.signalingState,"signalingState",!0),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.onaddstream,"onaddstream",!0),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.onicecandidate,"onicecandidate",!0),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.oniceconnectionstatechange,"oniceconnectionstatechange",!0),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.onicegatheringstatechange,"onicegatheringstatechange",!0),new b.WebrpcMethodInfo(c.RTCPeerConnection,
e.onsignalingstatechange,"onsignalingstatechange",!0),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.onnegotiationneeded,"onnegotiationneeded",!0),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.onremovestream,"onremovestream",!0),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.getStats,"getStats",!1),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.getReceivers,"getReceivers",!1,a.FEATURE_ms_teams_speaking_indicator),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.getSenders,"getSenders",!1,a.FEATURE_ms_teams_pstn),
new b.WebrpcMethodInfo(c.RTCPeerConnection,e.addTrack,"addTrack",!1,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.removeTrack,"removeTrack",!1,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.ontrack,"ontrack",!0,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.setLocalDescription_v2,"setLocalDescription_v2",!1,a.FEATURE_ms_teams_webrtc_1dot0),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.setRemoteDescription_v2,"setRemoteDescription_v2",
!1,a.FEATURE_ms_teams_webrtc_1dot0),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.addTransceiverWithTrack,"addTransceiverWithTrack",!1,a.FEATURE_ms_teams_webrtc_1dot0),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.addTransceiverWithKind,"addTransceiverWithKind",!1,a.FEATURE_ms_teams_webrtc_1dot0),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.getTransceivers,"getTransceivers",!1,a.FEATURE_ms_teams_webrtc_1dot0),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.onconnectionstatechange,"onconnectionstatechange",
!0,a.FEATURE_ms_teams_webrtc_1dot0),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.sctp,"sctp",!0,a.FEATURE_ms_teams_data_channel),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.ondatachannel,"ondatachannel",!0,a.FEATURE_ms_teams_data_channel),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.createDataChannel,"createDataChannel",!1,a.FEATURE_ms_teams_data_channel),new b.WebrpcMethodInfo(c.RTCPeerConnection,e.getStats_v2,"getStats_v2",!1,a.FEATURE_ms_teams_webrtc_1dot0)]),new b.WebrpcClassInfo(c.RTCSessionDescription,
"RTCSessionDescription",[new b.WebrpcMethodInfo(c.RTCSessionDescription,g.ctor,"ctor",!1),new b.WebrpcMethodInfo(c.RTCSessionDescription,g.type,"type",!0),new b.WebrpcMethodInfo(c.RTCSessionDescription,g.sdp,"sdp",!0)]),new b.WebrpcClassInfo(c.RTCIceCandidate,"RTCIceCandidate",[new b.WebrpcMethodInfo(c.RTCIceCandidate,x.ctor,"ctor",!1),new b.WebrpcMethodInfo(c.RTCIceCandidate,x.candidate,"candidate",!0),new b.WebrpcMethodInfo(c.RTCIceCandidate,x.sdpMid,"sdpMid",!0),new b.WebrpcMethodInfo(c.RTCIceCandidate,
x.sdpMLineIndex,"sdpMLineIndex",!0)]),new b.WebrpcClassInfo(c.RTCIceCandidateEvent,"RTCIceCandidateEvent",[new b.WebrpcMethodInfo(c.RTCIceCandidateEvent,m.ctor,"ctor",!1),new b.WebrpcMethodInfo(c.RTCIceCandidateEvent,m.candidate,"candidate",!0)]),new b.WebrpcClassInfo(c.MediaDevices,"MediaDevices",[new b.WebrpcMethodInfo(c.MediaDevices,k.ctor,"ctor",!1),new b.WebrpcMethodInfo(c.MediaDevices,k.enumerateDevices,"enumerateDevices",!1),new b.WebrpcMethodInfo(c.MediaDevices,k.getDisplayMedia,"getDisplayMedia",
!1,a.FEATURE_ms_teams_desktop_sharing),new b.WebrpcMethodInfo(c.MediaDevices,k.ondevicechange,"ondevicechange",!0,a.FEATURE_ms_teams_speaking_indicator)]),new b.WebrpcClassInfo(c.MediaDeviceInfo,"MediaDeviceInfo",[new b.WebrpcMethodInfo(c.MediaDeviceInfo,n.ctor,"ctor",!1),new b.WebrpcMethodInfo(c.MediaDeviceInfo,n.deviceId,"deviceId",!0),new b.WebrpcMethodInfo(c.MediaDeviceInfo,n.kind,"kind",!0),new b.WebrpcMethodInfo(c.MediaDeviceInfo,n.label,"label",!0),new b.WebrpcMethodInfo(c.MediaDeviceInfo,
n.groupId,"groupId",!0)]),new b.WebrpcClassInfo(c.MediaStreamTrack,"MediaStreamTrack",[new b.WebrpcMethodInfo(c.MediaStreamTrack,p.ctor,"ctor",!1),new b.WebrpcMethodInfo(c.MediaStreamTrack,p.clone,"clone",!1),new b.WebrpcMethodInfo(c.MediaStreamTrack,p.stop,"stop",!1),new b.WebrpcMethodInfo(c.MediaStreamTrack,p.getCapabilities,"getCapabilities",!1),new b.WebrpcMethodInfo(c.MediaStreamTrack,p.getSettings,"getSettings",!1),new b.WebrpcMethodInfo(c.MediaStreamTrack,p.applyConstraints,"applyConstraints",
!1,a.FEATURE_ms_teams_desktop_sharing),new b.WebrpcMethodInfo(c.MediaStreamTrack,p.kind,"kind",!0),new b.WebrpcMethodInfo(c.MediaStreamTrack,p.id,"id",!0),new b.WebrpcMethodInfo(c.MediaStreamTrack,p.label,"label",!0),new b.WebrpcMethodInfo(c.MediaStreamTrack,p.enabled,"enabled",!0),new b.WebrpcMethodInfo(c.MediaStreamTrack,p.muted,"muted",!0),new b.WebrpcMethodInfo(c.MediaStreamTrack,p.readyState,"readyState",!0),new b.WebrpcMethodInfo(c.MediaStreamTrack,p.onended,"onended",!0),new b.WebrpcMethodInfo(c.MediaStreamTrack,
p.onmute,"onmute",!0),new b.WebrpcMethodInfo(c.MediaStreamTrack,p.onunmute,"onunmute",!0),new b.WebrpcMethodInfo(c.MediaStreamTrack,p.getConstraints,"getConstraints",!1,a.FEATURE_ms_teams_mstrack_constraints)]),new b.WebrpcClassInfo(c.MediaStream,"MediaStream",[new b.WebrpcMethodInfo(c.MediaStream,f.ctor,"ctor",!1),new b.WebrpcMethodInfo(c.MediaStream,f.id,"id",!0),new b.WebrpcMethodInfo(c.MediaStream,f.getAudioTracks,"getAudioTracks",!1),new b.WebrpcMethodInfo(c.MediaStream,f.getVideoTracks,"getVideoTracks",
!1),new b.WebrpcMethodInfo(c.MediaStream,f.getTracks,"getTracks",!1),new b.WebrpcMethodInfo(c.MediaStream,f.getTrackById,"getTrackById",!1),new b.WebrpcMethodInfo(c.MediaStream,f.addTrack,"addTrack",!1),new b.WebrpcMethodInfo(c.MediaStream,f.removeTrack,"removeTrack",!1),new b.WebrpcMethodInfo(c.MediaStream,f.clone,"clone",!0),new b.WebrpcMethodInfo(c.MediaStream,f.active,"active",!0)]),new b.WebrpcClassInfo(c.NavigatorUserMedia,"NavigatorUserMedia",[new b.WebrpcMethodInfo(c.NavigatorUserMedia,J.ctor,
"ctor",!1),new b.WebrpcMethodInfo(c.NavigatorUserMedia,J.getUserMedia,"getUserMedia",!1),new b.WebrpcMethodInfo(c.NavigatorUserMedia,J.setCodecCapabilities,"setCodecCapabilities",!1,a.FEATURE_ms_teams_codec_capability),new b.WebrpcMethodInfo(c.NavigatorUserMedia,J.getCapabilities,"getRtpCapabilities",!1,a.FEATURE_ms_teams_webrtc_1dot0)]),new b.WebrpcClassInfo(c.MediaStreamEvent,"MediaStreamEvent",[new b.WebrpcMethodInfo(c.MediaStreamEvent,D.ctor,"ctor",!1),new b.WebrpcMethodInfo(c.MediaStreamEvent,
D.stream,"stream",!0)]),new b.WebrpcClassInfo(c.VideoElement,"VideoElement",[new b.WebrpcMethodInfo(c.VideoElement,B.ctor,"ctor",!1),new b.WebrpcMethodInfo(c.VideoElement,B.sinkId,"sinkId",!0),new b.WebrpcMethodInfo(c.VideoElement,B.connectTo,"connectTo",!1),new b.WebrpcMethodInfo(c.VideoElement,B.disconnect,"disconnect",!1),new b.WebrpcMethodInfo(c.VideoElement,B.setFrame,"setFrame",!1),new b.WebrpcMethodInfo(c.VideoElement,B.addClipRect,"addClipRect",!1),new b.WebrpcMethodInfo(c.VideoElement,B.removeClipRect,
"removeClipRect",!1),new b.WebrpcMethodInfo(c.VideoElement,B.onerror,"onerror",!0),new b.WebrpcMethodInfo(c.VideoElement,B.onvideoframechanged,"onvideoframechanged",!0),new b.WebrpcMethodInfo(c.VideoElement,B.placement,"placement",!0,a.FEATURE_ms_teams_video_placement)]),new b.WebrpcClassInfo(c.AudioElement,"AudioElement",[new b.WebrpcMethodInfo(c.AudioElement,t.ctor,"ctor",!1),new b.WebrpcMethodInfo(c.AudioElement,t.sinkId,"sinkId",!0),new b.WebrpcMethodInfo(c.AudioElement,t.srcObject,"srcObject",
!0),new b.WebrpcMethodInfo(c.AudioElement,t.src,"src",!0),new b.WebrpcMethodInfo(c.AudioElement,t.play,"play",!1),new b.WebrpcMethodInfo(c.AudioElement,t.pause,"pause",!1)]),new b.WebrpcClassInfo(c.RTCRtpReceiver,"RTCRtpReceiver",[new b.WebrpcMethodInfo(c.RTCRtpReceiver,h.ctor,"ctor",!1,a.FEATURE_ms_teams_speaking_indicator),new b.WebrpcMethodInfo(c.RTCRtpReceiver,h.track,"track",!0,a.FEATURE_ms_teams_speaking_indicator),new b.WebrpcMethodInfo(c.RTCRtpReceiver,h.getContributingSources,"getContributingSources",
!1,a.FEATURE_ms_teams_speaking_indicator),new b.WebrpcMethodInfo(c.RTCRtpReceiver,h.getSynchronizationSources,"getSynchronizationSources",!1,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCRtpReceiver,h.transport,"transport",!0,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCRtpReceiver,h.rtcpTransport,"rtcptransport",!0,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCRtpReceiver,h.getCapabilities,"getCapabilities",!1,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCRtpReceiver,
h.getParameters,"getParameters",!1,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCRtpReceiver,h.getStats,"getStats",!1,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCRtpReceiver,h.getCapabilities_v2,"getCapabilities_v2",!1,a.FEATURE_ms_teams_webrtc_1dot0)]),new b.WebrpcClassInfo(c.RTCRtpSender,"RTCRtpSender",[new b.WebrpcMethodInfo(c.RTCRtpSender,A.ctor,"ctor",!1,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCRtpSender,A.track,"track",!0,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCRtpSender,
A.transport,"transport",!0,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCRtpSender,A.rtcpTransport,"rtcpTransport",!0,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCRtpSender,A.dtmf,"dtmf",!0,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCRtpSender,A.getCapabilities,"getCapabilities",!1,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCRtpSender,A.getParameters,"getParameters",!1,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCRtpSender,A.setParameters,"setParameters",!1,
a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCRtpSender,A.replaceTrack,"replaceTrack",!1,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCRtpSender,A.getStats,"getStats",!1,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCRtpSender,A.setStreams,"setStreams",!1,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCRtpSender,A.getCapabilities_v2,"getCapabilities_v2",!1,a.FEATURE_ms_teams_webrtc_1dot0)]),new b.WebrpcClassInfo(c.RTCDtlsTransport,"RTCDtlsTransport",[new b.WebrpcMethodInfo(c.RTCDtlsTransport,
y.ctor,"ctor",!1,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCDtlsTransport,y.transport,"transport",!0,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCDtlsTransport,y.state,"state",!0,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCDtlsTransport,y.getRemoteCertificates,"getRemoteCertificates",!1,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCDtlsTransport,y.onstatechange,"onstatechange",!0,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCDtlsTransport,y.onerror,"onerror",
!0,a.FEATURE_ms_teams_pstn)]),new b.WebrpcClassInfo(c.RTCIceTransport,"RTCIceTransport",[new b.WebrpcMethodInfo(c.RTCIceTransport,E.ctor,"ctor",!1,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCIceTransport,E.role,"role",!0,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCIceTransport,E.component,"component",!0,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCIceTransport,E.state,"state",!0,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCIceTransport,E.gatheringState,"gatheringState",
!0,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCIceTransport,E.localcandidates,"localcandidates",!0,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCIceTransport,E.remotecandidates,"remotecandidates",!0,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCIceTransport,E.onstatechange,"onstatechange",!0,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCIceTransport,E.ongatheringstatechange,"ongatheringstatechange",!0,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCIceTransport,
E.onselectedcandidatepairchange,"onselectedcandidatepairchange",!0,a.FEATURE_ms_teams_pstn)]),new b.WebrpcClassInfo(c.RTCDTMFSender,"RTCDTMFSender",[new b.WebrpcMethodInfo(c.RTCDTMFSender,u.ctor,"ctor",!1,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCDTMFSender,u.insertDTMF,"insertDTMF",!1,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCDTMFSender,u.ontonechange,"ontonechange",!0,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCDTMFSender,u.canInsertDTMF,"canInsertDTMF",!0,a.FEATURE_ms_teams_pstn),
new b.WebrpcMethodInfo(c.RTCDTMFSender,u.toneBuffer,"toneBuffer",!0,a.FEATURE_ms_teams_pstn)]),new b.WebrpcClassInfo(c.RTCDTMFToneChangeEvent,"RTCDTMFToneChangeEvent",[new b.WebrpcMethodInfo(c.RTCDTMFToneChangeEvent,q.ctor,"ctor",!1,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCDTMFToneChangeEvent,q.tone,"tone",!0,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCDTMFToneChangeEvent,q.tone_buffer,"tone_buffer",!0,a.FEATURE_ms_teams_pstn)]),new b.WebrpcClassInfo(c.RTCIceCandidatePair,"RTCIceCandidatePair",
[new b.WebrpcMethodInfo(c.RTCIceCandidatePair,w.ctor,"ctor",!1,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCIceCandidatePair,w.local,"local",!0,a.FEATURE_ms_teams_pstn),new b.WebrpcMethodInfo(c.RTCIceCandidatePair,w.remote,"remote",!0,a.FEATURE_ms_teams_pstn)]),new b.WebrpcClassInfo(c.RTCRtpTransceiver,"RTCRtpTransceiver",[new b.WebrpcMethodInfo(c.RTCRtpTransceiver,z.ctor,"ctor",!1,a.FEATURE_ms_teams_webrtc_1dot0),new b.WebrpcMethodInfo(c.RTCRtpTransceiver,z.mid,"mid",!0,a.FEATURE_ms_teams_webrtc_1dot0),
new b.WebrpcMethodInfo(c.RTCRtpTransceiver,z.sender,"sender",!0,a.FEATURE_ms_teams_webrtc_1dot0),new b.WebrpcMethodInfo(c.RTCRtpTransceiver,z.receiver,"receiver",!0,a.FEATURE_ms_teams_webrtc_1dot0),new b.WebrpcMethodInfo(c.RTCRtpTransceiver,z.direction,"direction",!0,a.FEATURE_ms_teams_webrtc_1dot0),new b.WebrpcMethodInfo(c.RTCRtpTransceiver,z.currentDirection,"currentDirection",!0,a.FEATURE_ms_teams_webrtc_1dot0),new b.WebrpcMethodInfo(c.RTCRtpTransceiver,z.stop,"stop",!1,a.FEATURE_ms_teams_webrtc_1dot0),
new b.WebrpcMethodInfo(c.RTCRtpTransceiver,z.setCodecPreferences,"setCodecPreferences",!1,a.FEATURE_ms_teams_webrtc_1dot0)]),new b.WebrpcClassInfo(c.RTCDataChannel,"RTCDataChannel",[new b.WebrpcMethodInfo(c.RTCDataChannel,C.ctor,"ctor",!1,a.FEATURE_ms_teams_data_channel),new b.WebrpcMethodInfo(c.RTCDataChannel,C.label,"label",!0,a.FEATURE_ms_teams_data_channel),new b.WebrpcMethodInfo(c.RTCDataChannel,C.ordered,"ordered",!0,a.FEATURE_ms_teams_data_channel),new b.WebrpcMethodInfo(c.RTCDataChannel,C.maxPacketLifeTime,
"maxPacketLifeTime",!0,a.FEATURE_ms_teams_data_channel),new b.WebrpcMethodInfo(c.RTCDataChannel,C.maxRetransmits,"maxRetransmits",!0,a.FEATURE_ms_teams_data_channel),new b.WebrpcMethodInfo(c.RTCDataChannel,C.protocol,"protocol",!0,a.FEATURE_ms_teams_data_channel),new b.WebrpcMethodInfo(c.RTCDataChannel,C.negotiated,"negotiated",!0,a.FEATURE_ms_teams_data_channel),new b.WebrpcMethodInfo(c.RTCDataChannel,C.id,"id",!0,a.FEATURE_ms_teams_data_channel),new b.WebrpcMethodInfo(c.RTCDataChannel,C.readyState,
"readyState",!0,a.FEATURE_ms_teams_data_channel),new b.WebrpcMethodInfo(c.RTCDataChannel,C.bufferedAmount,"bufferedAmount",!0,a.FEATURE_ms_teams_data_channel),new b.WebrpcMethodInfo(c.RTCDataChannel,C.bufferedAmountLowThreshold,"bufferedAmountLowThreshold",!0,a.FEATURE_ms_teams_data_channel),new b.WebrpcMethodInfo(c.RTCDataChannel,C.onopen,"onopen",!0,a.FEATURE_ms_teams_data_channel),new b.WebrpcMethodInfo(c.RTCDataChannel,C.onbufferedamountlow,"onbufferedamountlow",!0,a.FEATURE_ms_teams_data_channel),
new b.WebrpcMethodInfo(c.RTCDataChannel,C.onerror,"onerror",!0,a.FEATURE_ms_teams_data_channel),new b.WebrpcMethodInfo(c.RTCDataChannel,C.onclosing,"onclosing",!0,a.FEATURE_ms_teams_data_channel),new b.WebrpcMethodInfo(c.RTCDataChannel,C.onclose,"onclose",!0,a.FEATURE_ms_teams_data_channel),new b.WebrpcMethodInfo(c.RTCDataChannel,C.onmessage,"onmessage",!0,a.FEATURE_ms_teams_data_channel),new b.WebrpcMethodInfo(c.RTCDataChannel,C.close,"close",!1,a.FEATURE_ms_teams_data_channel),new b.WebrpcMethodInfo(c.RTCDataChannel,
C.send_text,"send_text",!1,a.FEATURE_ms_teams_data_channel),new b.WebrpcMethodInfo(c.RTCDataChannel,C.send_binary,"send_binary",!1,a.FEATURE_ms_teams_data_channel)]),new b.WebrpcClassInfo(c.RTCSctpTransport,"RTCSctpTransport",[new b.WebrpcMethodInfo(c.RTCSctpTransport,F.ctor,"ctor",!1,a.FEATURE_ms_teams_data_channel),new b.WebrpcMethodInfo(c.RTCSctpTransport,F.transport,"transport",!0,a.FEATURE_ms_teams_data_channel),new b.WebrpcMethodInfo(c.RTCSctpTransport,F.state,"state",!0,a.FEATURE_ms_teams_data_channel),
new b.WebrpcMethodInfo(c.RTCSctpTransport,F.maxMessageSize,"maxMessageSize",!0,a.FEATURE_ms_teams_data_channel),new b.WebrpcMethodInfo(c.RTCSctpTransport,F.maxChannels,"maxChannels",!0,a.FEATURE_ms_teams_data_channel),new b.WebrpcMethodInfo(c.RTCSctpTransport,F.onstatechange,"onstatechange",!0,a.FEATURE_ms_teams_data_channel)])])},545:function(b,a,c){var d=this&&this.__spreadArrays||function(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var a=Array(a),d=0,b=0;b<c;b++)for(var e=
arguments[b],k=0,m=e.length;k<m;k++,d++)a[d]=e[k];return a};Object.defineProperty(a,"__esModule",{value:!0});var e=c(550),k;(function(a){a[a.req=0]="req";a[a.reply=1]="reply";a[a.event_req=2]="event_req";a[a.event_reply=3]="event_reply"})(k=a.ws_msg_type_t||(a.ws_msg_type_t={}));b=function(){function a(){}a.createMessageByid=function(a,b,c,k,n,m){for(var r=[],B=6;B<arguments.length;B++)r[B-6]=arguments[B];(B=e.WebrpcClassLibInfoUtil.getMethodByid(k,n))&&B.isprop||(a=!1);return this.createMessage.apply(this,
d([c,a,b,k,n,m],r))};a.createMessage=function(a,b,c,e,k,m){for(var n=[],r=6;r<arguments.length;r++)n[r-6]=arguments[r];return{v:"webrtc",hdr:{version:this._version,msg_type:this.getMsgType(a),modifier:b,destroy:c,proc:{iid:e,methodid:k}},objref:{oid:m},params:d(n)}};a.getMsgType=function(a){var b="";switch(a){default:b="req";break;case k.reply:b="reply";break;case k.event_req:b="event-req";break;case k.event_reply:b="event-reply"}return b};a._version=1;return a}();a.WsJsonUtil=b}},k={};return d(307)}()});

}).call(this)}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],2:[function(require,module,exports){
module.exports = { "default": require("core-js/library/fn/object/create"), __esModule: true };
},{"core-js/library/fn/object/create":20}],3:[function(require,module,exports){
module.exports = { "default": require("core-js/library/fn/object/define-property"), __esModule: true };
},{"core-js/library/fn/object/define-property":21}],4:[function(require,module,exports){
module.exports = { "default": require("core-js/library/fn/object/get-own-property-descriptor"), __esModule: true };
},{"core-js/library/fn/object/get-own-property-descriptor":22}],5:[function(require,module,exports){
module.exports = { "default": require("core-js/library/fn/object/get-prototype-of"), __esModule: true };
},{"core-js/library/fn/object/get-prototype-of":23}],6:[function(require,module,exports){
module.exports = { "default": require("core-js/library/fn/object/set-prototype-of"), __esModule: true };
},{"core-js/library/fn/object/set-prototype-of":24}],7:[function(require,module,exports){
module.exports = { "default": require("core-js/library/fn/promise"), __esModule: true };
},{"core-js/library/fn/promise":25}],8:[function(require,module,exports){
module.exports = { "default": require("core-js/library/fn/symbol"), __esModule: true };
},{"core-js/library/fn/symbol":26}],9:[function(require,module,exports){
module.exports = { "default": require("core-js/library/fn/symbol/iterator"), __esModule: true };
},{"core-js/library/fn/symbol/iterator":27}],10:[function(require,module,exports){
"use strict";

exports.__esModule = true;

var _promise = require("../core-js/promise");

var _promise2 = _interopRequireDefault(_promise);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = function (fn) {
  return function () {
    var gen = fn.apply(this, arguments);
    return new _promise2.default(function (resolve, reject) {
      function step(key, arg) {
        try {
          var info = gen[key](arg);
          var value = info.value;
        } catch (error) {
          reject(error);
          return;
        }

        if (info.done) {
          resolve(value);
        } else {
          return _promise2.default.resolve(value).then(function (value) {
            step("next", value);
          }, function (err) {
            step("throw", err);
          });
        }
      }

      return step("next");
    });
  };
};
},{"../core-js/promise":7}],11:[function(require,module,exports){
"use strict";

exports.__esModule = true;

exports.default = function (instance, Constructor) {
  if (!(instance instanceof Constructor)) {
    throw new TypeError("Cannot call a class as a function");
  }
};
},{}],12:[function(require,module,exports){
"use strict";

exports.__esModule = true;

var _defineProperty = require("../core-js/object/define-property");

var _defineProperty2 = _interopRequireDefault(_defineProperty);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = function () {
  function defineProperties(target, props) {
    for (var i = 0; i < props.length; i++) {
      var descriptor = props[i];
      descriptor.enumerable = descriptor.enumerable || false;
      descriptor.configurable = true;
      if ("value" in descriptor) descriptor.writable = true;
      (0, _defineProperty2.default)(target, descriptor.key, descriptor);
    }
  }

  return function (Constructor, protoProps, staticProps) {
    if (protoProps) defineProperties(Constructor.prototype, protoProps);
    if (staticProps) defineProperties(Constructor, staticProps);
    return Constructor;
  };
}();
},{"../core-js/object/define-property":3}],13:[function(require,module,exports){
"use strict";

exports.__esModule = true;

var _getPrototypeOf = require("../core-js/object/get-prototype-of");

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _getOwnPropertyDescriptor = require("../core-js/object/get-own-property-descriptor");

var _getOwnPropertyDescriptor2 = _interopRequireDefault(_getOwnPropertyDescriptor);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = function get(object, property, receiver) {
  if (object === null) object = Function.prototype;
  var desc = (0, _getOwnPropertyDescriptor2.default)(object, property);

  if (desc === undefined) {
    var parent = (0, _getPrototypeOf2.default)(object);

    if (parent === null) {
      return undefined;
    } else {
      return get(parent, property, receiver);
    }
  } else if ("value" in desc) {
    return desc.value;
  } else {
    var getter = desc.get;

    if (getter === undefined) {
      return undefined;
    }

    return getter.call(receiver);
  }
};
},{"../core-js/object/get-own-property-descriptor":4,"../core-js/object/get-prototype-of":5}],14:[function(require,module,exports){
"use strict";

exports.__esModule = true;

var _setPrototypeOf = require("../core-js/object/set-prototype-of");

var _setPrototypeOf2 = _interopRequireDefault(_setPrototypeOf);

var _create = require("../core-js/object/create");

var _create2 = _interopRequireDefault(_create);

var _typeof2 = require("../helpers/typeof");

var _typeof3 = _interopRequireDefault(_typeof2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = function (subClass, superClass) {
  if (typeof superClass !== "function" && superClass !== null) {
    throw new TypeError("Super expression must either be null or a function, not " + (typeof superClass === "undefined" ? "undefined" : (0, _typeof3.default)(superClass)));
  }

  subClass.prototype = (0, _create2.default)(superClass && superClass.prototype, {
    constructor: {
      value: subClass,
      enumerable: false,
      writable: true,
      configurable: true
    }
  });
  if (superClass) _setPrototypeOf2.default ? (0, _setPrototypeOf2.default)(subClass, superClass) : subClass.__proto__ = superClass;
};
},{"../core-js/object/create":2,"../core-js/object/set-prototype-of":6,"../helpers/typeof":16}],15:[function(require,module,exports){
"use strict";

exports.__esModule = true;

var _typeof2 = require("../helpers/typeof");

var _typeof3 = _interopRequireDefault(_typeof2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = function (self, call) {
  if (!self) {
    throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
  }

  return call && ((typeof call === "undefined" ? "undefined" : (0, _typeof3.default)(call)) === "object" || typeof call === "function") ? call : self;
};
},{"../helpers/typeof":16}],16:[function(require,module,exports){
"use strict";

exports.__esModule = true;

var _iterator = require("../core-js/symbol/iterator");

var _iterator2 = _interopRequireDefault(_iterator);

var _symbol = require("../core-js/symbol");

var _symbol2 = _interopRequireDefault(_symbol);

var _typeof = typeof _symbol2.default === "function" && typeof _iterator2.default === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof _symbol2.default === "function" && obj.constructor === _symbol2.default && obj !== _symbol2.default.prototype ? "symbol" : typeof obj; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = typeof _symbol2.default === "function" && _typeof(_iterator2.default) === "symbol" ? function (obj) {
  return typeof obj === "undefined" ? "undefined" : _typeof(obj);
} : function (obj) {
  return obj && typeof _symbol2.default === "function" && obj.constructor === _symbol2.default && obj !== _symbol2.default.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof(obj);
};
},{"../core-js/symbol":8,"../core-js/symbol/iterator":9}],17:[function(require,module,exports){
/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */

// This method of obtaining a reference to the global object needs to be
// kept identical to the way it is obtained in runtime.js
var g = (function() { return this })() || Function("return this")();

// Use `getOwnPropertyNames` because not all browsers support calling
// `hasOwnProperty` on the global `self` object in a worker. See #183.
var hadRuntime = g.regeneratorRuntime &&
  Object.getOwnPropertyNames(g).indexOf("regeneratorRuntime") >= 0;

// Save the old regeneratorRuntime in case it needs to be restored later.
var oldRuntime = hadRuntime && g.regeneratorRuntime;

// Force reevalutation of runtime.js.
g.regeneratorRuntime = undefined;

module.exports = require("./runtime");

if (hadRuntime) {
  // Restore the original runtime.
  g.regeneratorRuntime = oldRuntime;
} else {
  // Remove the global property added by runtime.js.
  try {
    delete g.regeneratorRuntime;
  } catch(e) {
    g.regeneratorRuntime = undefined;
  }
}

},{"./runtime":18}],18:[function(require,module,exports){
/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */

!(function(global) {
  "use strict";

  var Op = Object.prototype;
  var hasOwn = Op.hasOwnProperty;
  var undefined; // More compressible than void 0.
  var $Symbol = typeof Symbol === "function" ? Symbol : {};
  var iteratorSymbol = $Symbol.iterator || "@@iterator";
  var asyncIteratorSymbol = $Symbol.asyncIterator || "@@asyncIterator";
  var toStringTagSymbol = $Symbol.toStringTag || "@@toStringTag";

  var inModule = typeof module === "object";
  var runtime = global.regeneratorRuntime;
  if (runtime) {
    if (inModule) {
      // If regeneratorRuntime is defined globally and we're in a module,
      // make the exports object identical to regeneratorRuntime.
      module.exports = runtime;
    }
    // Don't bother evaluating the rest of this file if the runtime was
    // already defined globally.
    return;
  }

  // Define the runtime globally (as expected by generated code) as either
  // module.exports (if we're in a module) or a new, empty object.
  runtime = global.regeneratorRuntime = inModule ? module.exports : {};

  function wrap(innerFn, outerFn, self, tryLocsList) {
    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.
    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;
    var generator = Object.create(protoGenerator.prototype);
    var context = new Context(tryLocsList || []);

    // The ._invoke method unifies the implementations of the .next,
    // .throw, and .return methods.
    generator._invoke = makeInvokeMethod(innerFn, self, context);

    return generator;
  }
  runtime.wrap = wrap;

  // Try/catch helper to minimize deoptimizations. Returns a completion
  // record like context.tryEntries[i].completion. This interface could
  // have been (and was previously) designed to take a closure to be
  // invoked without arguments, but in all the cases we care about we
  // already have an existing method we want to call, so there's no need
  // to create a new function object. We can even get away with assuming
  // the method takes exactly one argument, since that happens to be true
  // in every case, so we don't have to touch the arguments object. The
  // only additional allocation required is the completion record, which
  // has a stable shape and so hopefully should be cheap to allocate.
  function tryCatch(fn, obj, arg) {
    try {
      return { type: "normal", arg: fn.call(obj, arg) };
    } catch (err) {
      return { type: "throw", arg: err };
    }
  }

  var GenStateSuspendedStart = "suspendedStart";
  var GenStateSuspendedYield = "suspendedYield";
  var GenStateExecuting = "executing";
  var GenStateCompleted = "completed";

  // Returning this object from the innerFn has the same effect as
  // breaking out of the dispatch switch statement.
  var ContinueSentinel = {};

  // Dummy constructor functions that we use as the .constructor and
  // .constructor.prototype properties for functions that return Generator
  // objects. For full spec compliance, you may wish to configure your
  // minifier not to mangle the names of these two functions.
  function Generator() {}
  function GeneratorFunction() {}
  function GeneratorFunctionPrototype() {}

  // This is a polyfill for %IteratorPrototype% for environments that
  // don't natively support it.
  var IteratorPrototype = {};
  IteratorPrototype[iteratorSymbol] = function () {
    return this;
  };

  var getProto = Object.getPrototypeOf;
  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));
  if (NativeIteratorPrototype &&
      NativeIteratorPrototype !== Op &&
      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {
    // This environment has a native %IteratorPrototype%; use it instead
    // of the polyfill.
    IteratorPrototype = NativeIteratorPrototype;
  }

  var Gp = GeneratorFunctionPrototype.prototype =
    Generator.prototype = Object.create(IteratorPrototype);
  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;
  GeneratorFunctionPrototype.constructor = GeneratorFunction;
  GeneratorFunctionPrototype[toStringTagSymbol] =
    GeneratorFunction.displayName = "GeneratorFunction";

  // Helper for defining the .next, .throw, and .return methods of the
  // Iterator interface in terms of a single ._invoke method.
  function defineIteratorMethods(prototype) {
    ["next", "throw", "return"].forEach(function(method) {
      prototype[method] = function(arg) {
        return this._invoke(method, arg);
      };
    });
  }

  runtime.isGeneratorFunction = function(genFun) {
    var ctor = typeof genFun === "function" && genFun.constructor;
    return ctor
      ? ctor === GeneratorFunction ||
        // For the native GeneratorFunction constructor, the best we can
        // do is to check its .name property.
        (ctor.displayName || ctor.name) === "GeneratorFunction"
      : false;
  };

  runtime.mark = function(genFun) {
    if (Object.setPrototypeOf) {
      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);
    } else {
      genFun.__proto__ = GeneratorFunctionPrototype;
      if (!(toStringTagSymbol in genFun)) {
        genFun[toStringTagSymbol] = "GeneratorFunction";
      }
    }
    genFun.prototype = Object.create(Gp);
    return genFun;
  };

  // Within the body of any async function, `await x` is transformed to
  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test
  // `hasOwn.call(value, "__await")` to determine if the yielded value is
  // meant to be awaited.
  runtime.awrap = function(arg) {
    return { __await: arg };
  };

  function AsyncIterator(generator) {
    function invoke(method, arg, resolve, reject) {
      var record = tryCatch(generator[method], generator, arg);
      if (record.type === "throw") {
        reject(record.arg);
      } else {
        var result = record.arg;
        var value = result.value;
        if (value &&
            typeof value === "object" &&
            hasOwn.call(value, "__await")) {
          return Promise.resolve(value.__await).then(function(value) {
            invoke("next", value, resolve, reject);
          }, function(err) {
            invoke("throw", err, resolve, reject);
          });
        }

        return Promise.resolve(value).then(function(unwrapped) {
          // When a yielded Promise is resolved, its final value becomes
          // the .value of the Promise<{value,done}> result for the
          // current iteration. If the Promise is rejected, however, the
          // result for this iteration will be rejected with the same
          // reason. Note that rejections of yielded Promises are not
          // thrown back into the generator function, as is the case
          // when an awaited Promise is rejected. This difference in
          // behavior between yield and await is important, because it
          // allows the consumer to decide what to do with the yielded
          // rejection (swallow it and continue, manually .throw it back
          // into the generator, abandon iteration, whatever). With
          // await, by contrast, there is no opportunity to examine the
          // rejection reason outside the generator function, so the
          // only option is to throw it from the await expression, and
          // let the generator function handle the exception.
          result.value = unwrapped;
          resolve(result);
        }, reject);
      }
    }

    var previousPromise;

    function enqueue(method, arg) {
      function callInvokeWithMethodAndArg() {
        return new Promise(function(resolve, reject) {
          invoke(method, arg, resolve, reject);
        });
      }

      return previousPromise =
        // If enqueue has been called before, then we want to wait until
        // all previous Promises have been resolved before calling invoke,
        // so that results are always delivered in the correct order. If
        // enqueue has not been called before, then it is important to
        // call invoke immediately, without waiting on a callback to fire,
        // so that the async generator function has the opportunity to do
        // any necessary setup in a predictable way. This predictability
        // is why the Promise constructor synchronously invokes its
        // executor callback, and why async functions synchronously
        // execute code before the first await. Since we implement simple
        // async functions in terms of async generators, it is especially
        // important to get this right, even though it requires care.
        previousPromise ? previousPromise.then(
          callInvokeWithMethodAndArg,
          // Avoid propagating failures to Promises returned by later
          // invocations of the iterator.
          callInvokeWithMethodAndArg
        ) : callInvokeWithMethodAndArg();
    }

    // Define the unified helper method that is used to implement .next,
    // .throw, and .return (see defineIteratorMethods).
    this._invoke = enqueue;
  }

  defineIteratorMethods(AsyncIterator.prototype);
  AsyncIterator.prototype[asyncIteratorSymbol] = function () {
    return this;
  };
  runtime.AsyncIterator = AsyncIterator;

  // Note that simple async functions are implemented on top of
  // AsyncIterator objects; they just return a Promise for the value of
  // the final result produced by the iterator.
  runtime.async = function(innerFn, outerFn, self, tryLocsList) {
    var iter = new AsyncIterator(
      wrap(innerFn, outerFn, self, tryLocsList)
    );

    return runtime.isGeneratorFunction(outerFn)
      ? iter // If outerFn is a generator, return the full iterator.
      : iter.next().then(function(result) {
          return result.done ? result.value : iter.next();
        });
  };

  function makeInvokeMethod(innerFn, self, context) {
    var state = GenStateSuspendedStart;

    return function invoke(method, arg) {
      if (state === GenStateExecuting) {
        throw new Error("Generator is already running");
      }

      if (state === GenStateCompleted) {
        if (method === "throw") {
          throw arg;
        }

        // Be forgiving, per 25.3.3.3.3 of the spec:
        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume
        return doneResult();
      }

      context.method = method;
      context.arg = arg;

      while (true) {
        var delegate = context.delegate;
        if (delegate) {
          var delegateResult = maybeInvokeDelegate(delegate, context);
          if (delegateResult) {
            if (delegateResult === ContinueSentinel) continue;
            return delegateResult;
          }
        }

        if (context.method === "next") {
          // Setting context._sent for legacy support of Babel's
          // function.sent implementation.
          context.sent = context._sent = context.arg;

        } else if (context.method === "throw") {
          if (state === GenStateSuspendedStart) {
            state = GenStateCompleted;
            throw context.arg;
          }

          context.dispatchException(context.arg);

        } else if (context.method === "return") {
          context.abrupt("return", context.arg);
        }

        state = GenStateExecuting;

        var record = tryCatch(innerFn, self, context);
        if (record.type === "normal") {
          // If an exception is thrown from innerFn, we leave state ===
          // GenStateExecuting and loop back for another invocation.
          state = context.done
            ? GenStateCompleted
            : GenStateSuspendedYield;

          if (record.arg === ContinueSentinel) {
            continue;
          }

          return {
            value: record.arg,
            done: context.done
          };

        } else if (record.type === "throw") {
          state = GenStateCompleted;
          // Dispatch the exception by looping back around to the
          // context.dispatchException(context.arg) call above.
          context.method = "throw";
          context.arg = record.arg;
        }
      }
    };
  }

  // Call delegate.iterator[context.method](context.arg) and handle the
  // result, either by returning a { value, done } result from the
  // delegate iterator, or by modifying context.method and context.arg,
  // setting context.delegate to null, and returning the ContinueSentinel.
  function maybeInvokeDelegate(delegate, context) {
    var method = delegate.iterator[context.method];
    if (method === undefined) {
      // A .throw or .return when the delegate iterator has no .throw
      // method always terminates the yield* loop.
      context.delegate = null;

      if (context.method === "throw") {
        if (delegate.iterator.return) {
          // If the delegate iterator has a return method, give it a
          // chance to clean up.
          context.method = "return";
          context.arg = undefined;
          maybeInvokeDelegate(delegate, context);

          if (context.method === "throw") {
            // If maybeInvokeDelegate(context) changed context.method from
            // "return" to "throw", let that override the TypeError below.
            return ContinueSentinel;
          }
        }

        context.method = "throw";
        context.arg = new TypeError(
          "The iterator does not provide a 'throw' method");
      }

      return ContinueSentinel;
    }

    var record = tryCatch(method, delegate.iterator, context.arg);

    if (record.type === "throw") {
      context.method = "throw";
      context.arg = record.arg;
      context.delegate = null;
      return ContinueSentinel;
    }

    var info = record.arg;

    if (! info) {
      context.method = "throw";
      context.arg = new TypeError("iterator result is not an object");
      context.delegate = null;
      return ContinueSentinel;
    }

    if (info.done) {
      // Assign the result of the finished delegate to the temporary
      // variable specified by delegate.resultName (see delegateYield).
      context[delegate.resultName] = info.value;

      // Resume execution at the desired location (see delegateYield).
      context.next = delegate.nextLoc;

      // If context.method was "throw" but the delegate handled the
      // exception, let the outer generator proceed normally. If
      // context.method was "next", forget context.arg since it has been
      // "consumed" by the delegate iterator. If context.method was
      // "return", allow the original .return call to continue in the
      // outer generator.
      if (context.method !== "return") {
        context.method = "next";
        context.arg = undefined;
      }

    } else {
      // Re-yield the result returned by the delegate method.
      return info;
    }

    // The delegate iterator is finished, so forget it and continue with
    // the outer generator.
    context.delegate = null;
    return ContinueSentinel;
  }

  // Define Generator.prototype.{next,throw,return} in terms of the
  // unified ._invoke helper method.
  defineIteratorMethods(Gp);

  Gp[toStringTagSymbol] = "Generator";

  // A Generator should always return itself as the iterator object when the
  // @@iterator function is called on it. Some browsers' implementations of the
  // iterator prototype chain incorrectly implement this, causing the Generator
  // object to not be returned from this call. This ensures that doesn't happen.
  // See https://github.com/facebook/regenerator/issues/274 for more details.
  Gp[iteratorSymbol] = function() {
    return this;
  };

  Gp.toString = function() {
    return "[object Generator]";
  };

  function pushTryEntry(locs) {
    var entry = { tryLoc: locs[0] };

    if (1 in locs) {
      entry.catchLoc = locs[1];
    }

    if (2 in locs) {
      entry.finallyLoc = locs[2];
      entry.afterLoc = locs[3];
    }

    this.tryEntries.push(entry);
  }

  function resetTryEntry(entry) {
    var record = entry.completion || {};
    record.type = "normal";
    delete record.arg;
    entry.completion = record;
  }

  function Context(tryLocsList) {
    // The root entry object (effectively a try statement without a catch
    // or a finally block) gives us a place to store values thrown from
    // locations where there is no enclosing try statement.
    this.tryEntries = [{ tryLoc: "root" }];
    tryLocsList.forEach(pushTryEntry, this);
    this.reset(true);
  }

  runtime.keys = function(object) {
    var keys = [];
    for (var key in object) {
      keys.push(key);
    }
    keys.reverse();

    // Rather than returning an object with a next method, we keep
    // things simple and return the next function itself.
    return function next() {
      while (keys.length) {
        var key = keys.pop();
        if (key in object) {
          next.value = key;
          next.done = false;
          return next;
        }
      }

      // To avoid creating an additional object, we just hang the .value
      // and .done properties off the next function object itself. This
      // also ensures that the minifier will not anonymize the function.
      next.done = true;
      return next;
    };
  };

  function values(iterable) {
    if (iterable) {
      var iteratorMethod = iterable[iteratorSymbol];
      if (iteratorMethod) {
        return iteratorMethod.call(iterable);
      }

      if (typeof iterable.next === "function") {
        return iterable;
      }

      if (!isNaN(iterable.length)) {
        var i = -1, next = function next() {
          while (++i < iterable.length) {
            if (hasOwn.call(iterable, i)) {
              next.value = iterable[i];
              next.done = false;
              return next;
            }
          }

          next.value = undefined;
          next.done = true;

          return next;
        };

        return next.next = next;
      }
    }

    // Return an iterator with no values.
    return { next: doneResult };
  }
  runtime.values = values;

  function doneResult() {
    return { value: undefined, done: true };
  }

  Context.prototype = {
    constructor: Context,

    reset: function(skipTempReset) {
      this.prev = 0;
      this.next = 0;
      // Resetting context._sent for legacy support of Babel's
      // function.sent implementation.
      this.sent = this._sent = undefined;
      this.done = false;
      this.delegate = null;

      this.method = "next";
      this.arg = undefined;

      this.tryEntries.forEach(resetTryEntry);

      if (!skipTempReset) {
        for (var name in this) {
          // Not sure about the optimal order of these conditions:
          if (name.charAt(0) === "t" &&
              hasOwn.call(this, name) &&
              !isNaN(+name.slice(1))) {
            this[name] = undefined;
          }
        }
      }
    },

    stop: function() {
      this.done = true;

      var rootEntry = this.tryEntries[0];
      var rootRecord = rootEntry.completion;
      if (rootRecord.type === "throw") {
        throw rootRecord.arg;
      }

      return this.rval;
    },

    dispatchException: function(exception) {
      if (this.done) {
        throw exception;
      }

      var context = this;
      function handle(loc, caught) {
        record.type = "throw";
        record.arg = exception;
        context.next = loc;

        if (caught) {
          // If the dispatched exception was caught by a catch block,
          // then let that catch block handle the exception normally.
          context.method = "next";
          context.arg = undefined;
        }

        return !! caught;
      }

      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        var record = entry.completion;

        if (entry.tryLoc === "root") {
          // Exception thrown outside of any try block that could handle
          // it, so set the completion value of the entire function to
          // throw the exception.
          return handle("end");
        }

        if (entry.tryLoc <= this.prev) {
          var hasCatch = hasOwn.call(entry, "catchLoc");
          var hasFinally = hasOwn.call(entry, "finallyLoc");

          if (hasCatch && hasFinally) {
            if (this.prev < entry.catchLoc) {
              return handle(entry.catchLoc, true);
            } else if (this.prev < entry.finallyLoc) {
              return handle(entry.finallyLoc);
            }

          } else if (hasCatch) {
            if (this.prev < entry.catchLoc) {
              return handle(entry.catchLoc, true);
            }

          } else if (hasFinally) {
            if (this.prev < entry.finallyLoc) {
              return handle(entry.finallyLoc);
            }

          } else {
            throw new Error("try statement without catch or finally");
          }
        }
      }
    },

    abrupt: function(type, arg) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        if (entry.tryLoc <= this.prev &&
            hasOwn.call(entry, "finallyLoc") &&
            this.prev < entry.finallyLoc) {
          var finallyEntry = entry;
          break;
        }
      }

      if (finallyEntry &&
          (type === "break" ||
           type === "continue") &&
          finallyEntry.tryLoc <= arg &&
          arg <= finallyEntry.finallyLoc) {
        // Ignore the finally entry if control is not jumping to a
        // location outside the try/catch block.
        finallyEntry = null;
      }

      var record = finallyEntry ? finallyEntry.completion : {};
      record.type = type;
      record.arg = arg;

      if (finallyEntry) {
        this.method = "next";
        this.next = finallyEntry.finallyLoc;
        return ContinueSentinel;
      }

      return this.complete(record);
    },

    complete: function(record, afterLoc) {
      if (record.type === "throw") {
        throw record.arg;
      }

      if (record.type === "break" ||
          record.type === "continue") {
        this.next = record.arg;
      } else if (record.type === "return") {
        this.rval = this.arg = record.arg;
        this.method = "return";
        this.next = "end";
      } else if (record.type === "normal" && afterLoc) {
        this.next = afterLoc;
      }

      return ContinueSentinel;
    },

    finish: function(finallyLoc) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        if (entry.finallyLoc === finallyLoc) {
          this.complete(entry.completion, entry.afterLoc);
          resetTryEntry(entry);
          return ContinueSentinel;
        }
      }
    },

    "catch": function(tryLoc) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        if (entry.tryLoc === tryLoc) {
          var record = entry.completion;
          if (record.type === "throw") {
            var thrown = record.arg;
            resetTryEntry(entry);
          }
          return thrown;
        }
      }

      // The context.catch method must only be called with a location
      // argument that corresponds to a known catch block.
      throw new Error("illegal catch attempt");
    },

    delegateYield: function(iterable, resultName, nextLoc) {
      this.delegate = {
        iterator: values(iterable),
        resultName: resultName,
        nextLoc: nextLoc
      };

      if (this.method === "next") {
        // Deliberately forget the last sent value so that we don't
        // accidentally pass it on to the delegate.
        this.arg = undefined;
      }

      return ContinueSentinel;
    }
  };
})(
  // In sloppy mode, unbound `this` refers to the global object, fallback to
  // Function constructor if we're in global strict mode. That is sadly a form
  // of indirect eval which violates Content Security Policy.
  (function() { return this })() || Function("return this")()
);

},{}],19:[function(require,module,exports){
module.exports = require("regenerator-runtime");

},{"regenerator-runtime":17}],20:[function(require,module,exports){
require('../../modules/es6.object.create');
var $Object = require('../../modules/_core').Object;
module.exports = function create(P, D) {
  return $Object.create(P, D);
};

},{"../../modules/_core":35,"../../modules/es6.object.create":103}],21:[function(require,module,exports){
require('../../modules/es6.object.define-property');
var $Object = require('../../modules/_core').Object;
module.exports = function defineProperty(it, key, desc) {
  return $Object.defineProperty(it, key, desc);
};

},{"../../modules/_core":35,"../../modules/es6.object.define-property":104}],22:[function(require,module,exports){
require('../../modules/es6.object.get-own-property-descriptor');
var $Object = require('../../modules/_core').Object;
module.exports = function getOwnPropertyDescriptor(it, key) {
  return $Object.getOwnPropertyDescriptor(it, key);
};

},{"../../modules/_core":35,"../../modules/es6.object.get-own-property-descriptor":105}],23:[function(require,module,exports){
require('../../modules/es6.object.get-prototype-of');
module.exports = require('../../modules/_core').Object.getPrototypeOf;

},{"../../modules/_core":35,"../../modules/es6.object.get-prototype-of":106}],24:[function(require,module,exports){
require('../../modules/es6.object.set-prototype-of');
module.exports = require('../../modules/_core').Object.setPrototypeOf;

},{"../../modules/_core":35,"../../modules/es6.object.set-prototype-of":107}],25:[function(require,module,exports){
require('../modules/es6.object.to-string');
require('../modules/es6.string.iterator');
require('../modules/web.dom.iterable');
require('../modules/es6.promise');
require('../modules/es7.promise.finally');
require('../modules/es7.promise.try');
module.exports = require('../modules/_core').Promise;

},{"../modules/_core":35,"../modules/es6.object.to-string":108,"../modules/es6.promise":109,"../modules/es6.string.iterator":110,"../modules/es7.promise.finally":112,"../modules/es7.promise.try":113,"../modules/web.dom.iterable":116}],26:[function(require,module,exports){
require('../../modules/es6.symbol');
require('../../modules/es6.object.to-string');
require('../../modules/es7.symbol.async-iterator');
require('../../modules/es7.symbol.observable');
module.exports = require('../../modules/_core').Symbol;

},{"../../modules/_core":35,"../../modules/es6.object.to-string":108,"../../modules/es6.symbol":111,"../../modules/es7.symbol.async-iterator":114,"../../modules/es7.symbol.observable":115}],27:[function(require,module,exports){
require('../../modules/es6.string.iterator');
require('../../modules/web.dom.iterable');
module.exports = require('../../modules/_wks-ext').f('iterator');

},{"../../modules/_wks-ext":99,"../../modules/es6.string.iterator":110,"../../modules/web.dom.iterable":116}],28:[function(require,module,exports){
module.exports = function (it) {
  if (typeof it != 'function') throw TypeError(it + ' is not a function!');
  return it;
};

},{}],29:[function(require,module,exports){
module.exports = function () { /* empty */ };

},{}],30:[function(require,module,exports){
module.exports = function (it, Constructor, name, forbiddenField) {
  if (!(it instanceof Constructor) || (forbiddenField !== undefined && forbiddenField in it)) {
    throw TypeError(name + ': incorrect invocation!');
  } return it;
};

},{}],31:[function(require,module,exports){
var isObject = require('./_is-object');
module.exports = function (it) {
  if (!isObject(it)) throw TypeError(it + ' is not an object!');
  return it;
};

},{"./_is-object":54}],32:[function(require,module,exports){
// false -> Array#indexOf
// true  -> Array#includes
var toIObject = require('./_to-iobject');
var toLength = require('./_to-length');
var toAbsoluteIndex = require('./_to-absolute-index');
module.exports = function (IS_INCLUDES) {
  return function ($this, el, fromIndex) {
    var O = toIObject($this);
    var length = toLength(O.length);
    var index = toAbsoluteIndex(fromIndex, length);
    var value;
    // Array#includes uses SameValueZero equality algorithm
    // eslint-disable-next-line no-self-compare
    if (IS_INCLUDES && el != el) while (length > index) {
      value = O[index++];
      // eslint-disable-next-line no-self-compare
      if (value != value) return true;
    // Array#indexOf ignores holes, Array#includes - not
    } else for (;length > index; index++) if (IS_INCLUDES || index in O) {
      if (O[index] === el) return IS_INCLUDES || index || 0;
    } return !IS_INCLUDES && -1;
  };
};

},{"./_to-absolute-index":90,"./_to-iobject":92,"./_to-length":93}],33:[function(require,module,exports){
// getting tag from 19.1.3.6 Object.prototype.toString()
var cof = require('./_cof');
var TAG = require('./_wks')('toStringTag');
// ES3 wrong here
var ARG = cof(function () { return arguments; }()) == 'Arguments';

// fallback for IE11 Script Access Denied error
var tryGet = function (it, key) {
  try {
    return it[key];
  } catch (e) { /* empty */ }
};

module.exports = function (it) {
  var O, T, B;
  return it === undefined ? 'Undefined' : it === null ? 'Null'
    // @@toStringTag case
    : typeof (T = tryGet(O = Object(it), TAG)) == 'string' ? T
    // builtinTag case
    : ARG ? cof(O)
    // ES3 arguments fallback
    : (B = cof(O)) == 'Object' && typeof O.callee == 'function' ? 'Arguments' : B;
};

},{"./_cof":34,"./_wks":100}],34:[function(require,module,exports){
var toString = {}.toString;

module.exports = function (it) {
  return toString.call(it).slice(8, -1);
};

},{}],35:[function(require,module,exports){
var core = module.exports = { version: '2.6.12' };
if (typeof __e == 'number') __e = core; // eslint-disable-line no-undef

},{}],36:[function(require,module,exports){
// optional / simple context binding
var aFunction = require('./_a-function');
module.exports = function (fn, that, length) {
  aFunction(fn);
  if (that === undefined) return fn;
  switch (length) {
    case 1: return function (a) {
      return fn.call(that, a);
    };
    case 2: return function (a, b) {
      return fn.call(that, a, b);
    };
    case 3: return function (a, b, c) {
      return fn.call(that, a, b, c);
    };
  }
  return function (/* ...args */) {
    return fn.apply(that, arguments);
  };
};

},{"./_a-function":28}],37:[function(require,module,exports){
// 7.2.1 RequireObjectCoercible(argument)
module.exports = function (it) {
  if (it == undefined) throw TypeError("Can't call method on  " + it);
  return it;
};

},{}],38:[function(require,module,exports){
// Thank's IE8 for his funny defineProperty
module.exports = !require('./_fails')(function () {
  return Object.defineProperty({}, 'a', { get: function () { return 7; } }).a != 7;
});

},{"./_fails":43}],39:[function(require,module,exports){
var isObject = require('./_is-object');
var document = require('./_global').document;
// typeof document.createElement is 'object' in old IE
var is = isObject(document) && isObject(document.createElement);
module.exports = function (it) {
  return is ? document.createElement(it) : {};
};

},{"./_global":45,"./_is-object":54}],40:[function(require,module,exports){
// IE 8- don't enum bug keys
module.exports = (
  'constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf'
).split(',');

},{}],41:[function(require,module,exports){
// all enumerable object keys, includes symbols
var getKeys = require('./_object-keys');
var gOPS = require('./_object-gops');
var pIE = require('./_object-pie');
module.exports = function (it) {
  var result = getKeys(it);
  var getSymbols = gOPS.f;
  if (getSymbols) {
    var symbols = getSymbols(it);
    var isEnum = pIE.f;
    var i = 0;
    var key;
    while (symbols.length > i) if (isEnum.call(it, key = symbols[i++])) result.push(key);
  } return result;
};

},{"./_object-gops":71,"./_object-keys":74,"./_object-pie":75}],42:[function(require,module,exports){
var global = require('./_global');
var core = require('./_core');
var ctx = require('./_ctx');
var hide = require('./_hide');
var has = require('./_has');
var PROTOTYPE = 'prototype';

var $export = function (type, name, source) {
  var IS_FORCED = type & $export.F;
  var IS_GLOBAL = type & $export.G;
  var IS_STATIC = type & $export.S;
  var IS_PROTO = type & $export.P;
  var IS_BIND = type & $export.B;
  var IS_WRAP = type & $export.W;
  var exports = IS_GLOBAL ? core : core[name] || (core[name] = {});
  var expProto = exports[PROTOTYPE];
  var target = IS_GLOBAL ? global : IS_STATIC ? global[name] : (global[name] || {})[PROTOTYPE];
  var key, own, out;
  if (IS_GLOBAL) source = name;
  for (key in source) {
    // contains in native
    own = !IS_FORCED && target && target[key] !== undefined;
    if (own && has(exports, key)) continue;
    // export native or passed
    out = own ? target[key] : source[key];
    // prevent global pollution for namespaces
    exports[key] = IS_GLOBAL && typeof target[key] != 'function' ? source[key]
    // bind timers to global for call from export context
    : IS_BIND && own ? ctx(out, global)
    // wrap global constructors for prevent change them in library
    : IS_WRAP && target[key] == out ? (function (C) {
      var F = function (a, b, c) {
        if (this instanceof C) {
          switch (arguments.length) {
            case 0: return new C();
            case 1: return new C(a);
            case 2: return new C(a, b);
          } return new C(a, b, c);
        } return C.apply(this, arguments);
      };
      F[PROTOTYPE] = C[PROTOTYPE];
      return F;
    // make static versions for prototype methods
    })(out) : IS_PROTO && typeof out == 'function' ? ctx(Function.call, out) : out;
    // export proto methods to core.%CONSTRUCTOR%.methods.%NAME%
    if (IS_PROTO) {
      (exports.virtual || (exports.virtual = {}))[key] = out;
      // export proto methods to core.%CONSTRUCTOR%.prototype.%NAME%
      if (type & $export.R && expProto && !expProto[key]) hide(expProto, key, out);
    }
  }
};
// type bitmap
$export.F = 1;   // forced
$export.G = 2;   // global
$export.S = 4;   // static
$export.P = 8;   // proto
$export.B = 16;  // bind
$export.W = 32;  // wrap
$export.U = 64;  // safe
$export.R = 128; // real proto method for `library`
module.exports = $export;

},{"./_core":35,"./_ctx":36,"./_global":45,"./_has":46,"./_hide":47}],43:[function(require,module,exports){
module.exports = function (exec) {
  try {
    return !!exec();
  } catch (e) {
    return true;
  }
};

},{}],44:[function(require,module,exports){
var ctx = require('./_ctx');
var call = require('./_iter-call');
var isArrayIter = require('./_is-array-iter');
var anObject = require('./_an-object');
var toLength = require('./_to-length');
var getIterFn = require('./core.get-iterator-method');
var BREAK = {};
var RETURN = {};
var exports = module.exports = function (iterable, entries, fn, that, ITERATOR) {
  var iterFn = ITERATOR ? function () { return iterable; } : getIterFn(iterable);
  var f = ctx(fn, that, entries ? 2 : 1);
  var index = 0;
  var length, step, iterator, result;
  if (typeof iterFn != 'function') throw TypeError(iterable + ' is not iterable!');
  // fast case for arrays with default iterator
  if (isArrayIter(iterFn)) for (length = toLength(iterable.length); length > index; index++) {
    result = entries ? f(anObject(step = iterable[index])[0], step[1]) : f(iterable[index]);
    if (result === BREAK || result === RETURN) return result;
  } else for (iterator = iterFn.call(iterable); !(step = iterator.next()).done;) {
    result = call(iterator, f, step.value, entries);
    if (result === BREAK || result === RETURN) return result;
  }
};
exports.BREAK = BREAK;
exports.RETURN = RETURN;

},{"./_an-object":31,"./_ctx":36,"./_is-array-iter":52,"./_iter-call":55,"./_to-length":93,"./core.get-iterator-method":101}],45:[function(require,module,exports){
// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028
var global = module.exports = typeof window != 'undefined' && window.Math == Math
  ? window : typeof self != 'undefined' && self.Math == Math ? self
  // eslint-disable-next-line no-new-func
  : Function('return this')();
if (typeof __g == 'number') __g = global; // eslint-disable-line no-undef

},{}],46:[function(require,module,exports){
var hasOwnProperty = {}.hasOwnProperty;
module.exports = function (it, key) {
  return hasOwnProperty.call(it, key);
};

},{}],47:[function(require,module,exports){
var dP = require('./_object-dp');
var createDesc = require('./_property-desc');
module.exports = require('./_descriptors') ? function (object, key, value) {
  return dP.f(object, key, createDesc(1, value));
} : function (object, key, value) {
  object[key] = value;
  return object;
};

},{"./_descriptors":38,"./_object-dp":66,"./_property-desc":79}],48:[function(require,module,exports){
var document = require('./_global').document;
module.exports = document && document.documentElement;

},{"./_global":45}],49:[function(require,module,exports){
module.exports = !require('./_descriptors') && !require('./_fails')(function () {
  return Object.defineProperty(require('./_dom-create')('div'), 'a', { get: function () { return 7; } }).a != 7;
});

},{"./_descriptors":38,"./_dom-create":39,"./_fails":43}],50:[function(require,module,exports){
// fast apply, http://jsperf.lnkit.com/fast-apply/5
module.exports = function (fn, args, that) {
  var un = that === undefined;
  switch (args.length) {
    case 0: return un ? fn()
                      : fn.call(that);
    case 1: return un ? fn(args[0])
                      : fn.call(that, args[0]);
    case 2: return un ? fn(args[0], args[1])
                      : fn.call(that, args[0], args[1]);
    case 3: return un ? fn(args[0], args[1], args[2])
                      : fn.call(that, args[0], args[1], args[2]);
    case 4: return un ? fn(args[0], args[1], args[2], args[3])
                      : fn.call(that, args[0], args[1], args[2], args[3]);
  } return fn.apply(that, args);
};

},{}],51:[function(require,module,exports){
// fallback for non-array-like ES3 and non-enumerable old V8 strings
var cof = require('./_cof');
// eslint-disable-next-line no-prototype-builtins
module.exports = Object('z').propertyIsEnumerable(0) ? Object : function (it) {
  return cof(it) == 'String' ? it.split('') : Object(it);
};

},{"./_cof":34}],52:[function(require,module,exports){
// check on default Array iterator
var Iterators = require('./_iterators');
var ITERATOR = require('./_wks')('iterator');
var ArrayProto = Array.prototype;

module.exports = function (it) {
  return it !== undefined && (Iterators.Array === it || ArrayProto[ITERATOR] === it);
};

},{"./_iterators":60,"./_wks":100}],53:[function(require,module,exports){
// 7.2.2 IsArray(argument)
var cof = require('./_cof');
module.exports = Array.isArray || function isArray(arg) {
  return cof(arg) == 'Array';
};

},{"./_cof":34}],54:[function(require,module,exports){
module.exports = function (it) {
  return typeof it === 'object' ? it !== null : typeof it === 'function';
};

},{}],55:[function(require,module,exports){
// call something on iterator step with safe closing on error
var anObject = require('./_an-object');
module.exports = function (iterator, fn, value, entries) {
  try {
    return entries ? fn(anObject(value)[0], value[1]) : fn(value);
  // 7.4.6 IteratorClose(iterator, completion)
  } catch (e) {
    var ret = iterator['return'];
    if (ret !== undefined) anObject(ret.call(iterator));
    throw e;
  }
};

},{"./_an-object":31}],56:[function(require,module,exports){
'use strict';
var create = require('./_object-create');
var descriptor = require('./_property-desc');
var setToStringTag = require('./_set-to-string-tag');
var IteratorPrototype = {};

// 25.1.2.1.1 %IteratorPrototype%[@@iterator]()
require('./_hide')(IteratorPrototype, require('./_wks')('iterator'), function () { return this; });

module.exports = function (Constructor, NAME, next) {
  Constructor.prototype = create(IteratorPrototype, { next: descriptor(1, next) });
  setToStringTag(Constructor, NAME + ' Iterator');
};

},{"./_hide":47,"./_object-create":65,"./_property-desc":79,"./_set-to-string-tag":84,"./_wks":100}],57:[function(require,module,exports){
'use strict';
var LIBRARY = require('./_library');
var $export = require('./_export');
var redefine = require('./_redefine');
var hide = require('./_hide');
var Iterators = require('./_iterators');
var $iterCreate = require('./_iter-create');
var setToStringTag = require('./_set-to-string-tag');
var getPrototypeOf = require('./_object-gpo');
var ITERATOR = require('./_wks')('iterator');
var BUGGY = !([].keys && 'next' in [].keys()); // Safari has buggy iterators w/o `next`
var FF_ITERATOR = '@@iterator';
var KEYS = 'keys';
var VALUES = 'values';

var returnThis = function () { return this; };

module.exports = function (Base, NAME, Constructor, next, DEFAULT, IS_SET, FORCED) {
  $iterCreate(Constructor, NAME, next);
  var getMethod = function (kind) {
    if (!BUGGY && kind in proto) return proto[kind];
    switch (kind) {
      case KEYS: return function keys() { return new Constructor(this, kind); };
      case VALUES: return function values() { return new Constructor(this, kind); };
    } return function entries() { return new Constructor(this, kind); };
  };
  var TAG = NAME + ' Iterator';
  var DEF_VALUES = DEFAULT == VALUES;
  var VALUES_BUG = false;
  var proto = Base.prototype;
  var $native = proto[ITERATOR] || proto[FF_ITERATOR] || DEFAULT && proto[DEFAULT];
  var $default = $native || getMethod(DEFAULT);
  var $entries = DEFAULT ? !DEF_VALUES ? $default : getMethod('entries') : undefined;
  var $anyNative = NAME == 'Array' ? proto.entries || $native : $native;
  var methods, key, IteratorPrototype;
  // Fix native
  if ($anyNative) {
    IteratorPrototype = getPrototypeOf($anyNative.call(new Base()));
    if (IteratorPrototype !== Object.prototype && IteratorPrototype.next) {
      // Set @@toStringTag to native iterators
      setToStringTag(IteratorPrototype, TAG, true);
      // fix for some old engines
      if (!LIBRARY && typeof IteratorPrototype[ITERATOR] != 'function') hide(IteratorPrototype, ITERATOR, returnThis);
    }
  }
  // fix Array#{values, @@iterator}.name in V8 / FF
  if (DEF_VALUES && $native && $native.name !== VALUES) {
    VALUES_BUG = true;
    $default = function values() { return $native.call(this); };
  }
  // Define iterator
  if ((!LIBRARY || FORCED) && (BUGGY || VALUES_BUG || !proto[ITERATOR])) {
    hide(proto, ITERATOR, $default);
  }
  // Plug for library
  Iterators[NAME] = $default;
  Iterators[TAG] = returnThis;
  if (DEFAULT) {
    methods = {
      values: DEF_VALUES ? $default : getMethod(VALUES),
      keys: IS_SET ? $default : getMethod(KEYS),
      entries: $entries
    };
    if (FORCED) for (key in methods) {
      if (!(key in proto)) redefine(proto, key, methods[key]);
    } else $export($export.P + $export.F * (BUGGY || VALUES_BUG), NAME, methods);
  }
  return methods;
};

},{"./_export":42,"./_hide":47,"./_iter-create":56,"./_iterators":60,"./_library":61,"./_object-gpo":72,"./_redefine":81,"./_set-to-string-tag":84,"./_wks":100}],58:[function(require,module,exports){
var ITERATOR = require('./_wks')('iterator');
var SAFE_CLOSING = false;

try {
  var riter = [7][ITERATOR]();
  riter['return'] = function () { SAFE_CLOSING = true; };
  // eslint-disable-next-line no-throw-literal
  Array.from(riter, function () { throw 2; });
} catch (e) { /* empty */ }

module.exports = function (exec, skipClosing) {
  if (!skipClosing && !SAFE_CLOSING) return false;
  var safe = false;
  try {
    var arr = [7];
    var iter = arr[ITERATOR]();
    iter.next = function () { return { done: safe = true }; };
    arr[ITERATOR] = function () { return iter; };
    exec(arr);
  } catch (e) { /* empty */ }
  return safe;
};

},{"./_wks":100}],59:[function(require,module,exports){
module.exports = function (done, value) {
  return { value: value, done: !!done };
};

},{}],60:[function(require,module,exports){
module.exports = {};

},{}],61:[function(require,module,exports){
module.exports = true;

},{}],62:[function(require,module,exports){
var META = require('./_uid')('meta');
var isObject = require('./_is-object');
var has = require('./_has');
var setDesc = require('./_object-dp').f;
var id = 0;
var isExtensible = Object.isExtensible || function () {
  return true;
};
var FREEZE = !require('./_fails')(function () {
  return isExtensible(Object.preventExtensions({}));
});
var setMeta = function (it) {
  setDesc(it, META, { value: {
    i: 'O' + ++id, // object ID
    w: {}          // weak collections IDs
  } });
};
var fastKey = function (it, create) {
  // return primitive with prefix
  if (!isObject(it)) return typeof it == 'symbol' ? it : (typeof it == 'string' ? 'S' : 'P') + it;
  if (!has(it, META)) {
    // can't set metadata to uncaught frozen object
    if (!isExtensible(it)) return 'F';
    // not necessary to add metadata
    if (!create) return 'E';
    // add missing metadata
    setMeta(it);
  // return object ID
  } return it[META].i;
};
var getWeak = function (it, create) {
  if (!has(it, META)) {
    // can't set metadata to uncaught frozen object
    if (!isExtensible(it)) return true;
    // not necessary to add metadata
    if (!create) return false;
    // add missing metadata
    setMeta(it);
  // return hash weak collections IDs
  } return it[META].w;
};
// add metadata on freeze-family methods calling
var onFreeze = function (it) {
  if (FREEZE && meta.NEED && isExtensible(it) && !has(it, META)) setMeta(it);
  return it;
};
var meta = module.exports = {
  KEY: META,
  NEED: false,
  fastKey: fastKey,
  getWeak: getWeak,
  onFreeze: onFreeze
};

},{"./_fails":43,"./_has":46,"./_is-object":54,"./_object-dp":66,"./_uid":96}],63:[function(require,module,exports){
var global = require('./_global');
var macrotask = require('./_task').set;
var Observer = global.MutationObserver || global.WebKitMutationObserver;
var process = global.process;
var Promise = global.Promise;
var isNode = require('./_cof')(process) == 'process';

module.exports = function () {
  var head, last, notify;

  var flush = function () {
    var parent, fn;
    if (isNode && (parent = process.domain)) parent.exit();
    while (head) {
      fn = head.fn;
      head = head.next;
      try {
        fn();
      } catch (e) {
        if (head) notify();
        else last = undefined;
        throw e;
      }
    } last = undefined;
    if (parent) parent.enter();
  };

  // Node.js
  if (isNode) {
    notify = function () {
      process.nextTick(flush);
    };
  // browsers with MutationObserver, except iOS Safari - https://github.com/zloirock/core-js/issues/339
  } else if (Observer && !(global.navigator && global.navigator.standalone)) {
    var toggle = true;
    var node = document.createTextNode('');
    new Observer(flush).observe(node, { characterData: true }); // eslint-disable-line no-new
    notify = function () {
      node.data = toggle = !toggle;
    };
  // environments with maybe non-completely correct, but existent Promise
  } else if (Promise && Promise.resolve) {
    // Promise.resolve without an argument throws an error in LG WebOS 2
    var promise = Promise.resolve(undefined);
    notify = function () {
      promise.then(flush);
    };
  // for other environments - macrotask based on:
  // - setImmediate
  // - MessageChannel
  // - window.postMessag
  // - onreadystatechange
  // - setTimeout
  } else {
    notify = function () {
      // strange IE + webpack dev server bug - use .call(global)
      macrotask.call(global, flush);
    };
  }

  return function (fn) {
    var task = { fn: fn, next: undefined };
    if (last) last.next = task;
    if (!head) {
      head = task;
      notify();
    } last = task;
  };
};

},{"./_cof":34,"./_global":45,"./_task":89}],64:[function(require,module,exports){
'use strict';
// 25.4.1.5 NewPromiseCapability(C)
var aFunction = require('./_a-function');

function PromiseCapability(C) {
  var resolve, reject;
  this.promise = new C(function ($$resolve, $$reject) {
    if (resolve !== undefined || reject !== undefined) throw TypeError('Bad Promise constructor');
    resolve = $$resolve;
    reject = $$reject;
  });
  this.resolve = aFunction(resolve);
  this.reject = aFunction(reject);
}

module.exports.f = function (C) {
  return new PromiseCapability(C);
};

},{"./_a-function":28}],65:[function(require,module,exports){
// 19.1.2.2 / 15.2.3.5 Object.create(O [, Properties])
var anObject = require('./_an-object');
var dPs = require('./_object-dps');
var enumBugKeys = require('./_enum-bug-keys');
var IE_PROTO = require('./_shared-key')('IE_PROTO');
var Empty = function () { /* empty */ };
var PROTOTYPE = 'prototype';

// Create object with fake `null` prototype: use iframe Object with cleared prototype
var createDict = function () {
  // Thrash, waste and sodomy: IE GC bug
  var iframe = require('./_dom-create')('iframe');
  var i = enumBugKeys.length;
  var lt = '<';
  var gt = '>';
  var iframeDocument;
  iframe.style.display = 'none';
  require('./_html').appendChild(iframe);
  iframe.src = 'javascript:'; // eslint-disable-line no-script-url
  // createDict = iframe.contentWindow.Object;
  // html.removeChild(iframe);
  iframeDocument = iframe.contentWindow.document;
  iframeDocument.open();
  iframeDocument.write(lt + 'script' + gt + 'document.F=Object' + lt + '/script' + gt);
  iframeDocument.close();
  createDict = iframeDocument.F;
  while (i--) delete createDict[PROTOTYPE][enumBugKeys[i]];
  return createDict();
};

module.exports = Object.create || function create(O, Properties) {
  var result;
  if (O !== null) {
    Empty[PROTOTYPE] = anObject(O);
    result = new Empty();
    Empty[PROTOTYPE] = null;
    // add "__proto__" for Object.getPrototypeOf polyfill
    result[IE_PROTO] = O;
  } else result = createDict();
  return Properties === undefined ? result : dPs(result, Properties);
};

},{"./_an-object":31,"./_dom-create":39,"./_enum-bug-keys":40,"./_html":48,"./_object-dps":67,"./_shared-key":85}],66:[function(require,module,exports){
var anObject = require('./_an-object');
var IE8_DOM_DEFINE = require('./_ie8-dom-define');
var toPrimitive = require('./_to-primitive');
var dP = Object.defineProperty;

exports.f = require('./_descriptors') ? Object.defineProperty : function defineProperty(O, P, Attributes) {
  anObject(O);
  P = toPrimitive(P, true);
  anObject(Attributes);
  if (IE8_DOM_DEFINE) try {
    return dP(O, P, Attributes);
  } catch (e) { /* empty */ }
  if ('get' in Attributes || 'set' in Attributes) throw TypeError('Accessors not supported!');
  if ('value' in Attributes) O[P] = Attributes.value;
  return O;
};

},{"./_an-object":31,"./_descriptors":38,"./_ie8-dom-define":49,"./_to-primitive":95}],67:[function(require,module,exports){
var dP = require('./_object-dp');
var anObject = require('./_an-object');
var getKeys = require('./_object-keys');

module.exports = require('./_descriptors') ? Object.defineProperties : function defineProperties(O, Properties) {
  anObject(O);
  var keys = getKeys(Properties);
  var length = keys.length;
  var i = 0;
  var P;
  while (length > i) dP.f(O, P = keys[i++], Properties[P]);
  return O;
};

},{"./_an-object":31,"./_descriptors":38,"./_object-dp":66,"./_object-keys":74}],68:[function(require,module,exports){
var pIE = require('./_object-pie');
var createDesc = require('./_property-desc');
var toIObject = require('./_to-iobject');
var toPrimitive = require('./_to-primitive');
var has = require('./_has');
var IE8_DOM_DEFINE = require('./_ie8-dom-define');
var gOPD = Object.getOwnPropertyDescriptor;

exports.f = require('./_descriptors') ? gOPD : function getOwnPropertyDescriptor(O, P) {
  O = toIObject(O);
  P = toPrimitive(P, true);
  if (IE8_DOM_DEFINE) try {
    return gOPD(O, P);
  } catch (e) { /* empty */ }
  if (has(O, P)) return createDesc(!pIE.f.call(O, P), O[P]);
};

},{"./_descriptors":38,"./_has":46,"./_ie8-dom-define":49,"./_object-pie":75,"./_property-desc":79,"./_to-iobject":92,"./_to-primitive":95}],69:[function(require,module,exports){
// fallback for IE11 buggy Object.getOwnPropertyNames with iframe and window
var toIObject = require('./_to-iobject');
var gOPN = require('./_object-gopn').f;
var toString = {}.toString;

var windowNames = typeof window == 'object' && window && Object.getOwnPropertyNames
  ? Object.getOwnPropertyNames(window) : [];

var getWindowNames = function (it) {
  try {
    return gOPN(it);
  } catch (e) {
    return windowNames.slice();
  }
};

module.exports.f = function getOwnPropertyNames(it) {
  return windowNames && toString.call(it) == '[object Window]' ? getWindowNames(it) : gOPN(toIObject(it));
};

},{"./_object-gopn":70,"./_to-iobject":92}],70:[function(require,module,exports){
// 19.1.2.7 / 15.2.3.4 Object.getOwnPropertyNames(O)
var $keys = require('./_object-keys-internal');
var hiddenKeys = require('./_enum-bug-keys').concat('length', 'prototype');

exports.f = Object.getOwnPropertyNames || function getOwnPropertyNames(O) {
  return $keys(O, hiddenKeys);
};

},{"./_enum-bug-keys":40,"./_object-keys-internal":73}],71:[function(require,module,exports){
exports.f = Object.getOwnPropertySymbols;

},{}],72:[function(require,module,exports){
// 19.1.2.9 / 15.2.3.2 Object.getPrototypeOf(O)
var has = require('./_has');
var toObject = require('./_to-object');
var IE_PROTO = require('./_shared-key')('IE_PROTO');
var ObjectProto = Object.prototype;

module.exports = Object.getPrototypeOf || function (O) {
  O = toObject(O);
  if (has(O, IE_PROTO)) return O[IE_PROTO];
  if (typeof O.constructor == 'function' && O instanceof O.constructor) {
    return O.constructor.prototype;
  } return O instanceof Object ? ObjectProto : null;
};

},{"./_has":46,"./_shared-key":85,"./_to-object":94}],73:[function(require,module,exports){
var has = require('./_has');
var toIObject = require('./_to-iobject');
var arrayIndexOf = require('./_array-includes')(false);
var IE_PROTO = require('./_shared-key')('IE_PROTO');

module.exports = function (object, names) {
  var O = toIObject(object);
  var i = 0;
  var result = [];
  var key;
  for (key in O) if (key != IE_PROTO) has(O, key) && result.push(key);
  // Don't enum bug & hidden keys
  while (names.length > i) if (has(O, key = names[i++])) {
    ~arrayIndexOf(result, key) || result.push(key);
  }
  return result;
};

},{"./_array-includes":32,"./_has":46,"./_shared-key":85,"./_to-iobject":92}],74:[function(require,module,exports){
// 19.1.2.14 / 15.2.3.14 Object.keys(O)
var $keys = require('./_object-keys-internal');
var enumBugKeys = require('./_enum-bug-keys');

module.exports = Object.keys || function keys(O) {
  return $keys(O, enumBugKeys);
};

},{"./_enum-bug-keys":40,"./_object-keys-internal":73}],75:[function(require,module,exports){
exports.f = {}.propertyIsEnumerable;

},{}],76:[function(require,module,exports){
// most Object methods by ES6 should accept primitives
var $export = require('./_export');
var core = require('./_core');
var fails = require('./_fails');
module.exports = function (KEY, exec) {
  var fn = (core.Object || {})[KEY] || Object[KEY];
  var exp = {};
  exp[KEY] = exec(fn);
  $export($export.S + $export.F * fails(function () { fn(1); }), 'Object', exp);
};

},{"./_core":35,"./_export":42,"./_fails":43}],77:[function(require,module,exports){
module.exports = function (exec) {
  try {
    return { e: false, v: exec() };
  } catch (e) {
    return { e: true, v: e };
  }
};

},{}],78:[function(require,module,exports){
var anObject = require('./_an-object');
var isObject = require('./_is-object');
var newPromiseCapability = require('./_new-promise-capability');

module.exports = function (C, x) {
  anObject(C);
  if (isObject(x) && x.constructor === C) return x;
  var promiseCapability = newPromiseCapability.f(C);
  var resolve = promiseCapability.resolve;
  resolve(x);
  return promiseCapability.promise;
};

},{"./_an-object":31,"./_is-object":54,"./_new-promise-capability":64}],79:[function(require,module,exports){
module.exports = function (bitmap, value) {
  return {
    enumerable: !(bitmap & 1),
    configurable: !(bitmap & 2),
    writable: !(bitmap & 4),
    value: value
  };
};

},{}],80:[function(require,module,exports){
var hide = require('./_hide');
module.exports = function (target, src, safe) {
  for (var key in src) {
    if (safe && target[key]) target[key] = src[key];
    else hide(target, key, src[key]);
  } return target;
};

},{"./_hide":47}],81:[function(require,module,exports){
module.exports = require('./_hide');

},{"./_hide":47}],82:[function(require,module,exports){
// Works with __proto__ only. Old v8 can't work with null proto objects.
/* eslint-disable no-proto */
var isObject = require('./_is-object');
var anObject = require('./_an-object');
var check = function (O, proto) {
  anObject(O);
  if (!isObject(proto) && proto !== null) throw TypeError(proto + ": can't set as prototype!");
};
module.exports = {
  set: Object.setPrototypeOf || ('__proto__' in {} ? // eslint-disable-line
    function (test, buggy, set) {
      try {
        set = require('./_ctx')(Function.call, require('./_object-gopd').f(Object.prototype, '__proto__').set, 2);
        set(test, []);
        buggy = !(test instanceof Array);
      } catch (e) { buggy = true; }
      return function setPrototypeOf(O, proto) {
        check(O, proto);
        if (buggy) O.__proto__ = proto;
        else set(O, proto);
        return O;
      };
    }({}, false) : undefined),
  check: check
};

},{"./_an-object":31,"./_ctx":36,"./_is-object":54,"./_object-gopd":68}],83:[function(require,module,exports){
'use strict';
var global = require('./_global');
var core = require('./_core');
var dP = require('./_object-dp');
var DESCRIPTORS = require('./_descriptors');
var SPECIES = require('./_wks')('species');

module.exports = function (KEY) {
  var C = typeof core[KEY] == 'function' ? core[KEY] : global[KEY];
  if (DESCRIPTORS && C && !C[SPECIES]) dP.f(C, SPECIES, {
    configurable: true,
    get: function () { return this; }
  });
};

},{"./_core":35,"./_descriptors":38,"./_global":45,"./_object-dp":66,"./_wks":100}],84:[function(require,module,exports){
var def = require('./_object-dp').f;
var has = require('./_has');
var TAG = require('./_wks')('toStringTag');

module.exports = function (it, tag, stat) {
  if (it && !has(it = stat ? it : it.prototype, TAG)) def(it, TAG, { configurable: true, value: tag });
};

},{"./_has":46,"./_object-dp":66,"./_wks":100}],85:[function(require,module,exports){
var shared = require('./_shared')('keys');
var uid = require('./_uid');
module.exports = function (key) {
  return shared[key] || (shared[key] = uid(key));
};

},{"./_shared":86,"./_uid":96}],86:[function(require,module,exports){
var core = require('./_core');
var global = require('./_global');
var SHARED = '__core-js_shared__';
var store = global[SHARED] || (global[SHARED] = {});

(module.exports = function (key, value) {
  return store[key] || (store[key] = value !== undefined ? value : {});
})('versions', []).push({
  version: core.version,
  mode: require('./_library') ? 'pure' : 'global',
  copyright: '© 2020 Denis Pushkarev (zloirock.ru)'
});

},{"./_core":35,"./_global":45,"./_library":61}],87:[function(require,module,exports){
// 7.3.20 SpeciesConstructor(O, defaultConstructor)
var anObject = require('./_an-object');
var aFunction = require('./_a-function');
var SPECIES = require('./_wks')('species');
module.exports = function (O, D) {
  var C = anObject(O).constructor;
  var S;
  return C === undefined || (S = anObject(C)[SPECIES]) == undefined ? D : aFunction(S);
};

},{"./_a-function":28,"./_an-object":31,"./_wks":100}],88:[function(require,module,exports){
var toInteger = require('./_to-integer');
var defined = require('./_defined');
// true  -> String#at
// false -> String#codePointAt
module.exports = function (TO_STRING) {
  return function (that, pos) {
    var s = String(defined(that));
    var i = toInteger(pos);
    var l = s.length;
    var a, b;
    if (i < 0 || i >= l) return TO_STRING ? '' : undefined;
    a = s.charCodeAt(i);
    return a < 0xd800 || a > 0xdbff || i + 1 === l || (b = s.charCodeAt(i + 1)) < 0xdc00 || b > 0xdfff
      ? TO_STRING ? s.charAt(i) : a
      : TO_STRING ? s.slice(i, i + 2) : (a - 0xd800 << 10) + (b - 0xdc00) + 0x10000;
  };
};

},{"./_defined":37,"./_to-integer":91}],89:[function(require,module,exports){
var ctx = require('./_ctx');
var invoke = require('./_invoke');
var html = require('./_html');
var cel = require('./_dom-create');
var global = require('./_global');
var process = global.process;
var setTask = global.setImmediate;
var clearTask = global.clearImmediate;
var MessageChannel = global.MessageChannel;
var Dispatch = global.Dispatch;
var counter = 0;
var queue = {};
var ONREADYSTATECHANGE = 'onreadystatechange';
var defer, channel, port;
var run = function () {
  var id = +this;
  // eslint-disable-next-line no-prototype-builtins
  if (queue.hasOwnProperty(id)) {
    var fn = queue[id];
    delete queue[id];
    fn();
  }
};
var listener = function (event) {
  run.call(event.data);
};
// Node.js 0.9+ & IE10+ has setImmediate, otherwise:
if (!setTask || !clearTask) {
  setTask = function setImmediate(fn) {
    var args = [];
    var i = 1;
    while (arguments.length > i) args.push(arguments[i++]);
    queue[++counter] = function () {
      // eslint-disable-next-line no-new-func
      invoke(typeof fn == 'function' ? fn : Function(fn), args);
    };
    defer(counter);
    return counter;
  };
  clearTask = function clearImmediate(id) {
    delete queue[id];
  };
  // Node.js 0.8-
  if (require('./_cof')(process) == 'process') {
    defer = function (id) {
      process.nextTick(ctx(run, id, 1));
    };
  // Sphere (JS game engine) Dispatch API
  } else if (Dispatch && Dispatch.now) {
    defer = function (id) {
      Dispatch.now(ctx(run, id, 1));
    };
  // Browsers with MessageChannel, includes WebWorkers
  } else if (MessageChannel) {
    channel = new MessageChannel();
    port = channel.port2;
    channel.port1.onmessage = listener;
    defer = ctx(port.postMessage, port, 1);
  // Browsers with postMessage, skip WebWorkers
  // IE8 has postMessage, but it's sync & typeof its postMessage is 'object'
  } else if (global.addEventListener && typeof postMessage == 'function' && !global.importScripts) {
    defer = function (id) {
      global.postMessage(id + '', '*');
    };
    global.addEventListener('message', listener, false);
  // IE8-
  } else if (ONREADYSTATECHANGE in cel('script')) {
    defer = function (id) {
      html.appendChild(cel('script'))[ONREADYSTATECHANGE] = function () {
        html.removeChild(this);
        run.call(id);
      };
    };
  // Rest old browsers
  } else {
    defer = function (id) {
      setTimeout(ctx(run, id, 1), 0);
    };
  }
}
module.exports = {
  set: setTask,
  clear: clearTask
};

},{"./_cof":34,"./_ctx":36,"./_dom-create":39,"./_global":45,"./_html":48,"./_invoke":50}],90:[function(require,module,exports){
var toInteger = require('./_to-integer');
var max = Math.max;
var min = Math.min;
module.exports = function (index, length) {
  index = toInteger(index);
  return index < 0 ? max(index + length, 0) : min(index, length);
};

},{"./_to-integer":91}],91:[function(require,module,exports){
// 7.1.4 ToInteger
var ceil = Math.ceil;
var floor = Math.floor;
module.exports = function (it) {
  return isNaN(it = +it) ? 0 : (it > 0 ? floor : ceil)(it);
};

},{}],92:[function(require,module,exports){
// to indexed object, toObject with fallback for non-array-like ES3 strings
var IObject = require('./_iobject');
var defined = require('./_defined');
module.exports = function (it) {
  return IObject(defined(it));
};

},{"./_defined":37,"./_iobject":51}],93:[function(require,module,exports){
// 7.1.15 ToLength
var toInteger = require('./_to-integer');
var min = Math.min;
module.exports = function (it) {
  return it > 0 ? min(toInteger(it), 0x1fffffffffffff) : 0; // pow(2, 53) - 1 == 9007199254740991
};

},{"./_to-integer":91}],94:[function(require,module,exports){
// 7.1.13 ToObject(argument)
var defined = require('./_defined');
module.exports = function (it) {
  return Object(defined(it));
};

},{"./_defined":37}],95:[function(require,module,exports){
// 7.1.1 ToPrimitive(input [, PreferredType])
var isObject = require('./_is-object');
// instead of the ES6 spec version, we didn't implement @@toPrimitive case
// and the second argument - flag - preferred type is a string
module.exports = function (it, S) {
  if (!isObject(it)) return it;
  var fn, val;
  if (S && typeof (fn = it.toString) == 'function' && !isObject(val = fn.call(it))) return val;
  if (typeof (fn = it.valueOf) == 'function' && !isObject(val = fn.call(it))) return val;
  if (!S && typeof (fn = it.toString) == 'function' && !isObject(val = fn.call(it))) return val;
  throw TypeError("Can't convert object to primitive value");
};

},{"./_is-object":54}],96:[function(require,module,exports){
var id = 0;
var px = Math.random();
module.exports = function (key) {
  return 'Symbol('.concat(key === undefined ? '' : key, ')_', (++id + px).toString(36));
};

},{}],97:[function(require,module,exports){
var global = require('./_global');
var navigator = global.navigator;

module.exports = navigator && navigator.userAgent || '';

},{"./_global":45}],98:[function(require,module,exports){
var global = require('./_global');
var core = require('./_core');
var LIBRARY = require('./_library');
var wksExt = require('./_wks-ext');
var defineProperty = require('./_object-dp').f;
module.exports = function (name) {
  var $Symbol = core.Symbol || (core.Symbol = LIBRARY ? {} : global.Symbol || {});
  if (name.charAt(0) != '_' && !(name in $Symbol)) defineProperty($Symbol, name, { value: wksExt.f(name) });
};

},{"./_core":35,"./_global":45,"./_library":61,"./_object-dp":66,"./_wks-ext":99}],99:[function(require,module,exports){
exports.f = require('./_wks');

},{"./_wks":100}],100:[function(require,module,exports){
var store = require('./_shared')('wks');
var uid = require('./_uid');
var Symbol = require('./_global').Symbol;
var USE_SYMBOL = typeof Symbol == 'function';

var $exports = module.exports = function (name) {
  return store[name] || (store[name] =
    USE_SYMBOL && Symbol[name] || (USE_SYMBOL ? Symbol : uid)('Symbol.' + name));
};

$exports.store = store;

},{"./_global":45,"./_shared":86,"./_uid":96}],101:[function(require,module,exports){
var classof = require('./_classof');
var ITERATOR = require('./_wks')('iterator');
var Iterators = require('./_iterators');
module.exports = require('./_core').getIteratorMethod = function (it) {
  if (it != undefined) return it[ITERATOR]
    || it['@@iterator']
    || Iterators[classof(it)];
};

},{"./_classof":33,"./_core":35,"./_iterators":60,"./_wks":100}],102:[function(require,module,exports){
'use strict';
var addToUnscopables = require('./_add-to-unscopables');
var step = require('./_iter-step');
var Iterators = require('./_iterators');
var toIObject = require('./_to-iobject');

// 22.1.3.4 Array.prototype.entries()
// 22.1.3.13 Array.prototype.keys()
// 22.1.3.29 Array.prototype.values()
// 22.1.3.30 Array.prototype[@@iterator]()
module.exports = require('./_iter-define')(Array, 'Array', function (iterated, kind) {
  this._t = toIObject(iterated); // target
  this._i = 0;                   // next index
  this._k = kind;                // kind
// 22.1.5.2.1 %ArrayIteratorPrototype%.next()
}, function () {
  var O = this._t;
  var kind = this._k;
  var index = this._i++;
  if (!O || index >= O.length) {
    this._t = undefined;
    return step(1);
  }
  if (kind == 'keys') return step(0, index);
  if (kind == 'values') return step(0, O[index]);
  return step(0, [index, O[index]]);
}, 'values');

// argumentsList[@@iterator] is %ArrayProto_values% (9.4.4.6, 9.4.4.7)
Iterators.Arguments = Iterators.Array;

addToUnscopables('keys');
addToUnscopables('values');
addToUnscopables('entries');

},{"./_add-to-unscopables":29,"./_iter-define":57,"./_iter-step":59,"./_iterators":60,"./_to-iobject":92}],103:[function(require,module,exports){
var $export = require('./_export');
// 19.1.2.2 / 15.2.3.5 Object.create(O [, Properties])
$export($export.S, 'Object', { create: require('./_object-create') });

},{"./_export":42,"./_object-create":65}],104:[function(require,module,exports){
var $export = require('./_export');
// 19.1.2.4 / 15.2.3.6 Object.defineProperty(O, P, Attributes)
$export($export.S + $export.F * !require('./_descriptors'), 'Object', { defineProperty: require('./_object-dp').f });

},{"./_descriptors":38,"./_export":42,"./_object-dp":66}],105:[function(require,module,exports){
// 19.1.2.6 Object.getOwnPropertyDescriptor(O, P)
var toIObject = require('./_to-iobject');
var $getOwnPropertyDescriptor = require('./_object-gopd').f;

require('./_object-sap')('getOwnPropertyDescriptor', function () {
  return function getOwnPropertyDescriptor(it, key) {
    return $getOwnPropertyDescriptor(toIObject(it), key);
  };
});

},{"./_object-gopd":68,"./_object-sap":76,"./_to-iobject":92}],106:[function(require,module,exports){
// 19.1.2.9 Object.getPrototypeOf(O)
var toObject = require('./_to-object');
var $getPrototypeOf = require('./_object-gpo');

require('./_object-sap')('getPrototypeOf', function () {
  return function getPrototypeOf(it) {
    return $getPrototypeOf(toObject(it));
  };
});

},{"./_object-gpo":72,"./_object-sap":76,"./_to-object":94}],107:[function(require,module,exports){
// 19.1.3.19 Object.setPrototypeOf(O, proto)
var $export = require('./_export');
$export($export.S, 'Object', { setPrototypeOf: require('./_set-proto').set });

},{"./_export":42,"./_set-proto":82}],108:[function(require,module,exports){

},{}],109:[function(require,module,exports){
'use strict';
var LIBRARY = require('./_library');
var global = require('./_global');
var ctx = require('./_ctx');
var classof = require('./_classof');
var $export = require('./_export');
var isObject = require('./_is-object');
var aFunction = require('./_a-function');
var anInstance = require('./_an-instance');
var forOf = require('./_for-of');
var speciesConstructor = require('./_species-constructor');
var task = require('./_task').set;
var microtask = require('./_microtask')();
var newPromiseCapabilityModule = require('./_new-promise-capability');
var perform = require('./_perform');
var userAgent = require('./_user-agent');
var promiseResolve = require('./_promise-resolve');
var PROMISE = 'Promise';
var TypeError = global.TypeError;
var process = global.process;
var versions = process && process.versions;
var v8 = versions && versions.v8 || '';
var $Promise = global[PROMISE];
var isNode = classof(process) == 'process';
var empty = function () { /* empty */ };
var Internal, newGenericPromiseCapability, OwnPromiseCapability, Wrapper;
var newPromiseCapability = newGenericPromiseCapability = newPromiseCapabilityModule.f;

var USE_NATIVE = !!function () {
  try {
    // correct subclassing with @@species support
    var promise = $Promise.resolve(1);
    var FakePromise = (promise.constructor = {})[require('./_wks')('species')] = function (exec) {
      exec(empty, empty);
    };
    // unhandled rejections tracking support, NodeJS Promise without it fails @@species test
    return (isNode || typeof PromiseRejectionEvent == 'function')
      && promise.then(empty) instanceof FakePromise
      // v8 6.6 (Node 10 and Chrome 66) have a bug with resolving custom thenables
      // https://bugs.chromium.org/p/chromium/issues/detail?id=830565
      // we can't detect it synchronously, so just check versions
      && v8.indexOf('6.6') !== 0
      && userAgent.indexOf('Chrome/66') === -1;
  } catch (e) { /* empty */ }
}();

// helpers
var isThenable = function (it) {
  var then;
  return isObject(it) && typeof (then = it.then) == 'function' ? then : false;
};
var notify = function (promise, isReject) {
  if (promise._n) return;
  promise._n = true;
  var chain = promise._c;
  microtask(function () {
    var value = promise._v;
    var ok = promise._s == 1;
    var i = 0;
    var run = function (reaction) {
      var handler = ok ? reaction.ok : reaction.fail;
      var resolve = reaction.resolve;
      var reject = reaction.reject;
      var domain = reaction.domain;
      var result, then, exited;
      try {
        if (handler) {
          if (!ok) {
            if (promise._h == 2) onHandleUnhandled(promise);
            promise._h = 1;
          }
          if (handler === true) result = value;
          else {
            if (domain) domain.enter();
            result = handler(value); // may throw
            if (domain) {
              domain.exit();
              exited = true;
            }
          }
          if (result === reaction.promise) {
            reject(TypeError('Promise-chain cycle'));
          } else if (then = isThenable(result)) {
            then.call(result, resolve, reject);
          } else resolve(result);
        } else reject(value);
      } catch (e) {
        if (domain && !exited) domain.exit();
        reject(e);
      }
    };
    while (chain.length > i) run(chain[i++]); // variable length - can't use forEach
    promise._c = [];
    promise._n = false;
    if (isReject && !promise._h) onUnhandled(promise);
  });
};
var onUnhandled = function (promise) {
  task.call(global, function () {
    var value = promise._v;
    var unhandled = isUnhandled(promise);
    var result, handler, console;
    if (unhandled) {
      result = perform(function () {
        if (isNode) {
          process.emit('unhandledRejection', value, promise);
        } else if (handler = global.onunhandledrejection) {
          handler({ promise: promise, reason: value });
        } else if ((console = global.console) && console.error) {
          console.error('Unhandled promise rejection', value);
        }
      });
      // Browsers should not trigger `rejectionHandled` event if it was handled here, NodeJS - should
      promise._h = isNode || isUnhandled(promise) ? 2 : 1;
    } promise._a = undefined;
    if (unhandled && result.e) throw result.v;
  });
};
var isUnhandled = function (promise) {
  return promise._h !== 1 && (promise._a || promise._c).length === 0;
};
var onHandleUnhandled = function (promise) {
  task.call(global, function () {
    var handler;
    if (isNode) {
      process.emit('rejectionHandled', promise);
    } else if (handler = global.onrejectionhandled) {
      handler({ promise: promise, reason: promise._v });
    }
  });
};
var $reject = function (value) {
  var promise = this;
  if (promise._d) return;
  promise._d = true;
  promise = promise._w || promise; // unwrap
  promise._v = value;
  promise._s = 2;
  if (!promise._a) promise._a = promise._c.slice();
  notify(promise, true);
};
var $resolve = function (value) {
  var promise = this;
  var then;
  if (promise._d) return;
  promise._d = true;
  promise = promise._w || promise; // unwrap
  try {
    if (promise === value) throw TypeError("Promise can't be resolved itself");
    if (then = isThenable(value)) {
      microtask(function () {
        var wrapper = { _w: promise, _d: false }; // wrap
        try {
          then.call(value, ctx($resolve, wrapper, 1), ctx($reject, wrapper, 1));
        } catch (e) {
          $reject.call(wrapper, e);
        }
      });
    } else {
      promise._v = value;
      promise._s = 1;
      notify(promise, false);
    }
  } catch (e) {
    $reject.call({ _w: promise, _d: false }, e); // wrap
  }
};

// constructor polyfill
if (!USE_NATIVE) {
  // 25.4.3.1 Promise(executor)
  $Promise = function Promise(executor) {
    anInstance(this, $Promise, PROMISE, '_h');
    aFunction(executor);
    Internal.call(this);
    try {
      executor(ctx($resolve, this, 1), ctx($reject, this, 1));
    } catch (err) {
      $reject.call(this, err);
    }
  };
  // eslint-disable-next-line no-unused-vars
  Internal = function Promise(executor) {
    this._c = [];             // <- awaiting reactions
    this._a = undefined;      // <- checked in isUnhandled reactions
    this._s = 0;              // <- state
    this._d = false;          // <- done
    this._v = undefined;      // <- value
    this._h = 0;              // <- rejection state, 0 - default, 1 - handled, 2 - unhandled
    this._n = false;          // <- notify
  };
  Internal.prototype = require('./_redefine-all')($Promise.prototype, {
    // 25.4.5.3 Promise.prototype.then(onFulfilled, onRejected)
    then: function then(onFulfilled, onRejected) {
      var reaction = newPromiseCapability(speciesConstructor(this, $Promise));
      reaction.ok = typeof onFulfilled == 'function' ? onFulfilled : true;
      reaction.fail = typeof onRejected == 'function' && onRejected;
      reaction.domain = isNode ? process.domain : undefined;
      this._c.push(reaction);
      if (this._a) this._a.push(reaction);
      if (this._s) notify(this, false);
      return reaction.promise;
    },
    // 25.4.5.1 Promise.prototype.catch(onRejected)
    'catch': function (onRejected) {
      return this.then(undefined, onRejected);
    }
  });
  OwnPromiseCapability = function () {
    var promise = new Internal();
    this.promise = promise;
    this.resolve = ctx($resolve, promise, 1);
    this.reject = ctx($reject, promise, 1);
  };
  newPromiseCapabilityModule.f = newPromiseCapability = function (C) {
    return C === $Promise || C === Wrapper
      ? new OwnPromiseCapability(C)
      : newGenericPromiseCapability(C);
  };
}

$export($export.G + $export.W + $export.F * !USE_NATIVE, { Promise: $Promise });
require('./_set-to-string-tag')($Promise, PROMISE);
require('./_set-species')(PROMISE);
Wrapper = require('./_core')[PROMISE];

// statics
$export($export.S + $export.F * !USE_NATIVE, PROMISE, {
  // 25.4.4.5 Promise.reject(r)
  reject: function reject(r) {
    var capability = newPromiseCapability(this);
    var $$reject = capability.reject;
    $$reject(r);
    return capability.promise;
  }
});
$export($export.S + $export.F * (LIBRARY || !USE_NATIVE), PROMISE, {
  // 25.4.4.6 Promise.resolve(x)
  resolve: function resolve(x) {
    return promiseResolve(LIBRARY && this === Wrapper ? $Promise : this, x);
  }
});
$export($export.S + $export.F * !(USE_NATIVE && require('./_iter-detect')(function (iter) {
  $Promise.all(iter)['catch'](empty);
})), PROMISE, {
  // 25.4.4.1 Promise.all(iterable)
  all: function all(iterable) {
    var C = this;
    var capability = newPromiseCapability(C);
    var resolve = capability.resolve;
    var reject = capability.reject;
    var result = perform(function () {
      var values = [];
      var index = 0;
      var remaining = 1;
      forOf(iterable, false, function (promise) {
        var $index = index++;
        var alreadyCalled = false;
        values.push(undefined);
        remaining++;
        C.resolve(promise).then(function (value) {
          if (alreadyCalled) return;
          alreadyCalled = true;
          values[$index] = value;
          --remaining || resolve(values);
        }, reject);
      });
      --remaining || resolve(values);
    });
    if (result.e) reject(result.v);
    return capability.promise;
  },
  // 25.4.4.4 Promise.race(iterable)
  race: function race(iterable) {
    var C = this;
    var capability = newPromiseCapability(C);
    var reject = capability.reject;
    var result = perform(function () {
      forOf(iterable, false, function (promise) {
        C.resolve(promise).then(capability.resolve, reject);
      });
    });
    if (result.e) reject(result.v);
    return capability.promise;
  }
});

},{"./_a-function":28,"./_an-instance":30,"./_classof":33,"./_core":35,"./_ctx":36,"./_export":42,"./_for-of":44,"./_global":45,"./_is-object":54,"./_iter-detect":58,"./_library":61,"./_microtask":63,"./_new-promise-capability":64,"./_perform":77,"./_promise-resolve":78,"./_redefine-all":80,"./_set-species":83,"./_set-to-string-tag":84,"./_species-constructor":87,"./_task":89,"./_user-agent":97,"./_wks":100}],110:[function(require,module,exports){
'use strict';
var $at = require('./_string-at')(true);

// 21.1.3.27 String.prototype[@@iterator]()
require('./_iter-define')(String, 'String', function (iterated) {
  this._t = String(iterated); // target
  this._i = 0;                // next index
// 21.1.5.2.1 %StringIteratorPrototype%.next()
}, function () {
  var O = this._t;
  var index = this._i;
  var point;
  if (index >= O.length) return { value: undefined, done: true };
  point = $at(O, index);
  this._i += point.length;
  return { value: point, done: false };
});

},{"./_iter-define":57,"./_string-at":88}],111:[function(require,module,exports){
'use strict';
// ECMAScript 6 symbols shim
var global = require('./_global');
var has = require('./_has');
var DESCRIPTORS = require('./_descriptors');
var $export = require('./_export');
var redefine = require('./_redefine');
var META = require('./_meta').KEY;
var $fails = require('./_fails');
var shared = require('./_shared');
var setToStringTag = require('./_set-to-string-tag');
var uid = require('./_uid');
var wks = require('./_wks');
var wksExt = require('./_wks-ext');
var wksDefine = require('./_wks-define');
var enumKeys = require('./_enum-keys');
var isArray = require('./_is-array');
var anObject = require('./_an-object');
var isObject = require('./_is-object');
var toObject = require('./_to-object');
var toIObject = require('./_to-iobject');
var toPrimitive = require('./_to-primitive');
var createDesc = require('./_property-desc');
var _create = require('./_object-create');
var gOPNExt = require('./_object-gopn-ext');
var $GOPD = require('./_object-gopd');
var $GOPS = require('./_object-gops');
var $DP = require('./_object-dp');
var $keys = require('./_object-keys');
var gOPD = $GOPD.f;
var dP = $DP.f;
var gOPN = gOPNExt.f;
var $Symbol = global.Symbol;
var $JSON = global.JSON;
var _stringify = $JSON && $JSON.stringify;
var PROTOTYPE = 'prototype';
var HIDDEN = wks('_hidden');
var TO_PRIMITIVE = wks('toPrimitive');
var isEnum = {}.propertyIsEnumerable;
var SymbolRegistry = shared('symbol-registry');
var AllSymbols = shared('symbols');
var OPSymbols = shared('op-symbols');
var ObjectProto = Object[PROTOTYPE];
var USE_NATIVE = typeof $Symbol == 'function' && !!$GOPS.f;
var QObject = global.QObject;
// Don't use setters in Qt Script, https://github.com/zloirock/core-js/issues/173
var setter = !QObject || !QObject[PROTOTYPE] || !QObject[PROTOTYPE].findChild;

// fallback for old Android, https://code.google.com/p/v8/issues/detail?id=687
var setSymbolDesc = DESCRIPTORS && $fails(function () {
  return _create(dP({}, 'a', {
    get: function () { return dP(this, 'a', { value: 7 }).a; }
  })).a != 7;
}) ? function (it, key, D) {
  var protoDesc = gOPD(ObjectProto, key);
  if (protoDesc) delete ObjectProto[key];
  dP(it, key, D);
  if (protoDesc && it !== ObjectProto) dP(ObjectProto, key, protoDesc);
} : dP;

var wrap = function (tag) {
  var sym = AllSymbols[tag] = _create($Symbol[PROTOTYPE]);
  sym._k = tag;
  return sym;
};

var isSymbol = USE_NATIVE && typeof $Symbol.iterator == 'symbol' ? function (it) {
  return typeof it == 'symbol';
} : function (it) {
  return it instanceof $Symbol;
};

var $defineProperty = function defineProperty(it, key, D) {
  if (it === ObjectProto) $defineProperty(OPSymbols, key, D);
  anObject(it);
  key = toPrimitive(key, true);
  anObject(D);
  if (has(AllSymbols, key)) {
    if (!D.enumerable) {
      if (!has(it, HIDDEN)) dP(it, HIDDEN, createDesc(1, {}));
      it[HIDDEN][key] = true;
    } else {
      if (has(it, HIDDEN) && it[HIDDEN][key]) it[HIDDEN][key] = false;
      D = _create(D, { enumerable: createDesc(0, false) });
    } return setSymbolDesc(it, key, D);
  } return dP(it, key, D);
};
var $defineProperties = function defineProperties(it, P) {
  anObject(it);
  var keys = enumKeys(P = toIObject(P));
  var i = 0;
  var l = keys.length;
  var key;
  while (l > i) $defineProperty(it, key = keys[i++], P[key]);
  return it;
};
var $create = function create(it, P) {
  return P === undefined ? _create(it) : $defineProperties(_create(it), P);
};
var $propertyIsEnumerable = function propertyIsEnumerable(key) {
  var E = isEnum.call(this, key = toPrimitive(key, true));
  if (this === ObjectProto && has(AllSymbols, key) && !has(OPSymbols, key)) return false;
  return E || !has(this, key) || !has(AllSymbols, key) || has(this, HIDDEN) && this[HIDDEN][key] ? E : true;
};
var $getOwnPropertyDescriptor = function getOwnPropertyDescriptor(it, key) {
  it = toIObject(it);
  key = toPrimitive(key, true);
  if (it === ObjectProto && has(AllSymbols, key) && !has(OPSymbols, key)) return;
  var D = gOPD(it, key);
  if (D && has(AllSymbols, key) && !(has(it, HIDDEN) && it[HIDDEN][key])) D.enumerable = true;
  return D;
};
var $getOwnPropertyNames = function getOwnPropertyNames(it) {
  var names = gOPN(toIObject(it));
  var result = [];
  var i = 0;
  var key;
  while (names.length > i) {
    if (!has(AllSymbols, key = names[i++]) && key != HIDDEN && key != META) result.push(key);
  } return result;
};
var $getOwnPropertySymbols = function getOwnPropertySymbols(it) {
  var IS_OP = it === ObjectProto;
  var names = gOPN(IS_OP ? OPSymbols : toIObject(it));
  var result = [];
  var i = 0;
  var key;
  while (names.length > i) {
    if (has(AllSymbols, key = names[i++]) && (IS_OP ? has(ObjectProto, key) : true)) result.push(AllSymbols[key]);
  } return result;
};

// 19.4.1.1 Symbol([description])
if (!USE_NATIVE) {
  $Symbol = function Symbol() {
    if (this instanceof $Symbol) throw TypeError('Symbol is not a constructor!');
    var tag = uid(arguments.length > 0 ? arguments[0] : undefined);
    var $set = function (value) {
      if (this === ObjectProto) $set.call(OPSymbols, value);
      if (has(this, HIDDEN) && has(this[HIDDEN], tag)) this[HIDDEN][tag] = false;
      setSymbolDesc(this, tag, createDesc(1, value));
    };
    if (DESCRIPTORS && setter) setSymbolDesc(ObjectProto, tag, { configurable: true, set: $set });
    return wrap(tag);
  };
  redefine($Symbol[PROTOTYPE], 'toString', function toString() {
    return this._k;
  });

  $GOPD.f = $getOwnPropertyDescriptor;
  $DP.f = $defineProperty;
  require('./_object-gopn').f = gOPNExt.f = $getOwnPropertyNames;
  require('./_object-pie').f = $propertyIsEnumerable;
  $GOPS.f = $getOwnPropertySymbols;

  if (DESCRIPTORS && !require('./_library')) {
    redefine(ObjectProto, 'propertyIsEnumerable', $propertyIsEnumerable, true);
  }

  wksExt.f = function (name) {
    return wrap(wks(name));
  };
}

$export($export.G + $export.W + $export.F * !USE_NATIVE, { Symbol: $Symbol });

for (var es6Symbols = (
  // 19.4.2.2, 19.4.2.3, 19.4.2.4, 19.4.2.6, 19.4.2.8, 19.4.2.9, 19.4.2.10, 19.4.2.11, 19.4.2.12, 19.4.2.13, 19.4.2.14
  'hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables'
).split(','), j = 0; es6Symbols.length > j;)wks(es6Symbols[j++]);

for (var wellKnownSymbols = $keys(wks.store), k = 0; wellKnownSymbols.length > k;) wksDefine(wellKnownSymbols[k++]);

$export($export.S + $export.F * !USE_NATIVE, 'Symbol', {
  // 19.4.2.1 Symbol.for(key)
  'for': function (key) {
    return has(SymbolRegistry, key += '')
      ? SymbolRegistry[key]
      : SymbolRegistry[key] = $Symbol(key);
  },
  // 19.4.2.5 Symbol.keyFor(sym)
  keyFor: function keyFor(sym) {
    if (!isSymbol(sym)) throw TypeError(sym + ' is not a symbol!');
    for (var key in SymbolRegistry) if (SymbolRegistry[key] === sym) return key;
  },
  useSetter: function () { setter = true; },
  useSimple: function () { setter = false; }
});

$export($export.S + $export.F * !USE_NATIVE, 'Object', {
  // 19.1.2.2 Object.create(O [, Properties])
  create: $create,
  // 19.1.2.4 Object.defineProperty(O, P, Attributes)
  defineProperty: $defineProperty,
  // 19.1.2.3 Object.defineProperties(O, Properties)
  defineProperties: $defineProperties,
  // 19.1.2.6 Object.getOwnPropertyDescriptor(O, P)
  getOwnPropertyDescriptor: $getOwnPropertyDescriptor,
  // 19.1.2.7 Object.getOwnPropertyNames(O)
  getOwnPropertyNames: $getOwnPropertyNames,
  // 19.1.2.8 Object.getOwnPropertySymbols(O)
  getOwnPropertySymbols: $getOwnPropertySymbols
});

// Chrome 38 and 39 `Object.getOwnPropertySymbols` fails on primitives
// https://bugs.chromium.org/p/v8/issues/detail?id=3443
var FAILS_ON_PRIMITIVES = $fails(function () { $GOPS.f(1); });

$export($export.S + $export.F * FAILS_ON_PRIMITIVES, 'Object', {
  getOwnPropertySymbols: function getOwnPropertySymbols(it) {
    return $GOPS.f(toObject(it));
  }
});

// 24.3.2 JSON.stringify(value [, replacer [, space]])
$JSON && $export($export.S + $export.F * (!USE_NATIVE || $fails(function () {
  var S = $Symbol();
  // MS Edge converts symbol values to JSON as {}
  // WebKit converts symbol values to JSON as null
  // V8 throws on boxed symbols
  return _stringify([S]) != '[null]' || _stringify({ a: S }) != '{}' || _stringify(Object(S)) != '{}';
})), 'JSON', {
  stringify: function stringify(it) {
    var args = [it];
    var i = 1;
    var replacer, $replacer;
    while (arguments.length > i) args.push(arguments[i++]);
    $replacer = replacer = args[1];
    if (!isObject(replacer) && it === undefined || isSymbol(it)) return; // IE8 returns string on undefined
    if (!isArray(replacer)) replacer = function (key, value) {
      if (typeof $replacer == 'function') value = $replacer.call(this, key, value);
      if (!isSymbol(value)) return value;
    };
    args[1] = replacer;
    return _stringify.apply($JSON, args);
  }
});

// 19.4.3.4 Symbol.prototype[@@toPrimitive](hint)
$Symbol[PROTOTYPE][TO_PRIMITIVE] || require('./_hide')($Symbol[PROTOTYPE], TO_PRIMITIVE, $Symbol[PROTOTYPE].valueOf);
// 19.4.3.5 Symbol.prototype[@@toStringTag]
setToStringTag($Symbol, 'Symbol');
// 20.2.1.9 Math[@@toStringTag]
setToStringTag(Math, 'Math', true);
// 24.3.3 JSON[@@toStringTag]
setToStringTag(global.JSON, 'JSON', true);

},{"./_an-object":31,"./_descriptors":38,"./_enum-keys":41,"./_export":42,"./_fails":43,"./_global":45,"./_has":46,"./_hide":47,"./_is-array":53,"./_is-object":54,"./_library":61,"./_meta":62,"./_object-create":65,"./_object-dp":66,"./_object-gopd":68,"./_object-gopn":70,"./_object-gopn-ext":69,"./_object-gops":71,"./_object-keys":74,"./_object-pie":75,"./_property-desc":79,"./_redefine":81,"./_set-to-string-tag":84,"./_shared":86,"./_to-iobject":92,"./_to-object":94,"./_to-primitive":95,"./_uid":96,"./_wks":100,"./_wks-define":98,"./_wks-ext":99}],112:[function(require,module,exports){
// https://github.com/tc39/proposal-promise-finally
'use strict';
var $export = require('./_export');
var core = require('./_core');
var global = require('./_global');
var speciesConstructor = require('./_species-constructor');
var promiseResolve = require('./_promise-resolve');

$export($export.P + $export.R, 'Promise', { 'finally': function (onFinally) {
  var C = speciesConstructor(this, core.Promise || global.Promise);
  var isFunction = typeof onFinally == 'function';
  return this.then(
    isFunction ? function (x) {
      return promiseResolve(C, onFinally()).then(function () { return x; });
    } : onFinally,
    isFunction ? function (e) {
      return promiseResolve(C, onFinally()).then(function () { throw e; });
    } : onFinally
  );
} });

},{"./_core":35,"./_export":42,"./_global":45,"./_promise-resolve":78,"./_species-constructor":87}],113:[function(require,module,exports){
'use strict';
// https://github.com/tc39/proposal-promise-try
var $export = require('./_export');
var newPromiseCapability = require('./_new-promise-capability');
var perform = require('./_perform');

$export($export.S, 'Promise', { 'try': function (callbackfn) {
  var promiseCapability = newPromiseCapability.f(this);
  var result = perform(callbackfn);
  (result.e ? promiseCapability.reject : promiseCapability.resolve)(result.v);
  return promiseCapability.promise;
} });

},{"./_export":42,"./_new-promise-capability":64,"./_perform":77}],114:[function(require,module,exports){
require('./_wks-define')('asyncIterator');

},{"./_wks-define":98}],115:[function(require,module,exports){
require('./_wks-define')('observable');

},{"./_wks-define":98}],116:[function(require,module,exports){
require('./es6.array.iterator');
var global = require('./_global');
var hide = require('./_hide');
var Iterators = require('./_iterators');
var TO_STRING_TAG = require('./_wks')('toStringTag');

var DOMIterables = ('CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,' +
  'DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,' +
  'MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,' +
  'SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,' +
  'TextTrackList,TouchList').split(',');

for (var i = 0; i < DOMIterables.length; i++) {
  var NAME = DOMIterables[i];
  var Collection = global[NAME];
  var proto = Collection && Collection.prototype;
  if (proto && !proto[TO_STRING_TAG]) hide(proto, TO_STRING_TAG, NAME);
  Iterators[NAME] = Iterators.Array;
}

},{"./_global":45,"./_hide":47,"./_iterators":60,"./_wks":100,"./es6.array.iterator":102}],117:[function(require,module,exports){
/*
 *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.
 *
 *  Use of this source code is governed by a BSD-style license
 *  that can be found in the LICENSE file in the root of the source
 *  tree.
 */
 /* eslint-env node */
'use strict';

var SDPUtils = require('sdp');

function fixStatsType(stat) {
  return {
    inboundrtp: 'inbound-rtp',
    outboundrtp: 'outbound-rtp',
    candidatepair: 'candidate-pair',
    localcandidate: 'local-candidate',
    remotecandidate: 'remote-candidate'
  }[stat.type] || stat.type;
}

function writeMediaSection(transceiver, caps, type, stream, dtlsRole) {
  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);

  // Map ICE parameters (ufrag, pwd) to SDP.
  sdp += SDPUtils.writeIceParameters(
      transceiver.iceGatherer.getLocalParameters());

  // Map DTLS parameters to SDP.
  sdp += SDPUtils.writeDtlsParameters(
      transceiver.dtlsTransport.getLocalParameters(),
      type === 'offer' ? 'actpass' : dtlsRole || 'active');

  sdp += 'a=mid:' + transceiver.mid + '\r\n';

  if (transceiver.rtpSender && transceiver.rtpReceiver) {
    sdp += 'a=sendrecv\r\n';
  } else if (transceiver.rtpSender) {
    sdp += 'a=sendonly\r\n';
  } else if (transceiver.rtpReceiver) {
    sdp += 'a=recvonly\r\n';
  } else {
    sdp += 'a=inactive\r\n';
  }

  if (transceiver.rtpSender) {
    var trackId = transceiver.rtpSender._initialTrackId ||
        transceiver.rtpSender.track.id;
    transceiver.rtpSender._initialTrackId = trackId;
    // spec.
    var msid = 'msid:' + (stream ? stream.id : '-') + ' ' +
        trackId + '\r\n';
    sdp += 'a=' + msid;
    // for Chrome. Legacy should no longer be required.
    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +
        ' ' + msid;

    // RTX
    if (transceiver.sendEncodingParameters[0].rtx) {
      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +
          ' ' + msid;
      sdp += 'a=ssrc-group:FID ' +
          transceiver.sendEncodingParameters[0].ssrc + ' ' +
          transceiver.sendEncodingParameters[0].rtx.ssrc +
          '\r\n';
    }
  }
  // FIXME: this should be written by writeRtpDescription.
  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +
      ' cname:' + SDPUtils.localCName + '\r\n';
  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {
    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +
        ' cname:' + SDPUtils.localCName + '\r\n';
  }
  return sdp;
}

// Edge does not like
// 1) stun: filtered after 14393 unless ?transport=udp is present
// 2) turn: that does not have all of turn:host:port?transport=udp
// 3) turn: with ipv6 addresses
// 4) turn: occurring muliple times
function filterIceServers(iceServers, edgeVersion) {
  var hasTurn = false;
  iceServers = JSON.parse(JSON.stringify(iceServers));
  return iceServers.filter(function(server) {
    if (server && (server.urls || server.url)) {
      var urls = server.urls || server.url;
      if (server.url && !server.urls) {
        console.warn('RTCIceServer.url is deprecated! Use urls instead.');
      }
      var isString = typeof urls === 'string';
      if (isString) {
        urls = [urls];
      }
      urls = urls.filter(function(url) {
        var validTurn = url.indexOf('turn:') === 0 &&
            url.indexOf('transport=udp') !== -1 &&
            url.indexOf('turn:[') === -1 &&
            !hasTurn;

        if (validTurn) {
          hasTurn = true;
          return true;
        }
        return url.indexOf('stun:') === 0 && edgeVersion >= 14393 &&
            url.indexOf('?transport=udp') === -1;
      });

      delete server.url;
      server.urls = isString ? urls[0] : urls;
      return !!urls.length;
    }
  });
}

// Determines the intersection of local and remote capabilities.
function getCommonCapabilities(localCapabilities, remoteCapabilities) {
  var commonCapabilities = {
    codecs: [],
    headerExtensions: [],
    fecMechanisms: []
  };

  var findCodecByPayloadType = function(pt, codecs) {
    pt = parseInt(pt, 10);
    for (var i = 0; i < codecs.length; i++) {
      if (codecs[i].payloadType === pt ||
          codecs[i].preferredPayloadType === pt) {
        return codecs[i];
      }
    }
  };

  var rtxCapabilityMatches = function(lRtx, rRtx, lCodecs, rCodecs) {
    var lCodec = findCodecByPayloadType(lRtx.parameters.apt, lCodecs);
    var rCodec = findCodecByPayloadType(rRtx.parameters.apt, rCodecs);
    return lCodec && rCodec &&
        lCodec.name.toLowerCase() === rCodec.name.toLowerCase();
  };

  localCapabilities.codecs.forEach(function(lCodec) {
    for (var i = 0; i < remoteCapabilities.codecs.length; i++) {
      var rCodec = remoteCapabilities.codecs[i];
      if (lCodec.name.toLowerCase() === rCodec.name.toLowerCase() &&
          lCodec.clockRate === rCodec.clockRate) {
        if (lCodec.name.toLowerCase() === 'rtx' &&
            lCodec.parameters && rCodec.parameters.apt) {
          // for RTX we need to find the local rtx that has a apt
          // which points to the same local codec as the remote one.
          if (!rtxCapabilityMatches(lCodec, rCodec,
              localCapabilities.codecs, remoteCapabilities.codecs)) {
            continue;
          }
        }
        rCodec = JSON.parse(JSON.stringify(rCodec)); // deepcopy
        // number of channels is the highest common number of channels
        rCodec.numChannels = Math.min(lCodec.numChannels,
            rCodec.numChannels);
        // push rCodec so we reply with offerer payload type
        commonCapabilities.codecs.push(rCodec);

        // determine common feedback mechanisms
        rCodec.rtcpFeedback = rCodec.rtcpFeedback.filter(function(fb) {
          for (var j = 0; j < lCodec.rtcpFeedback.length; j++) {
            if (lCodec.rtcpFeedback[j].type === fb.type &&
                lCodec.rtcpFeedback[j].parameter === fb.parameter) {
              return true;
            }
          }
          return false;
        });
        // FIXME: also need to determine .parameters
        //  see https://github.com/openpeer/ortc/issues/569
        break;
      }
    }
  });

  localCapabilities.headerExtensions.forEach(function(lHeaderExtension) {
    for (var i = 0; i < remoteCapabilities.headerExtensions.length;
         i++) {
      var rHeaderExtension = remoteCapabilities.headerExtensions[i];
      if (lHeaderExtension.uri === rHeaderExtension.uri) {
        commonCapabilities.headerExtensions.push(rHeaderExtension);
        break;
      }
    }
  });

  // FIXME: fecMechanisms
  return commonCapabilities;
}

// is action=setLocalDescription with type allowed in signalingState
function isActionAllowedInSignalingState(action, type, signalingState) {
  return {
    offer: {
      setLocalDescription: ['stable', 'have-local-offer'],
      setRemoteDescription: ['stable', 'have-remote-offer']
    },
    answer: {
      setLocalDescription: ['have-remote-offer', 'have-local-pranswer'],
      setRemoteDescription: ['have-local-offer', 'have-remote-pranswer']
    }
  }[type][action].indexOf(signalingState) !== -1;
}

function maybeAddCandidate(iceTransport, candidate) {
  // Edge's internal representation adds some fields therefore
  // not all fieldѕ are taken into account.
  var alreadyAdded = iceTransport.getRemoteCandidates()
      .find(function(remoteCandidate) {
        return candidate.foundation === remoteCandidate.foundation &&
            candidate.ip === remoteCandidate.ip &&
            candidate.port === remoteCandidate.port &&
            candidate.priority === remoteCandidate.priority &&
            candidate.protocol === remoteCandidate.protocol &&
            candidate.type === remoteCandidate.type;
      });
  if (!alreadyAdded) {
    iceTransport.addRemoteCandidate(candidate);
  }
  return !alreadyAdded;
}


function makeError(name, description) {
  var e = new Error(description);
  e.name = name;
  // legacy error codes from https://heycam.github.io/webidl/#idl-DOMException-error-names
  e.code = {
    NotSupportedError: 9,
    InvalidStateError: 11,
    InvalidAccessError: 15,
    TypeError: undefined,
    OperationError: undefined
  }[name];
  return e;
}

module.exports = function(window, edgeVersion) {
  // https://w3c.github.io/mediacapture-main/#mediastream
  // Helper function to add the track to the stream and
  // dispatch the event ourselves.
  function addTrackToStreamAndFireEvent(track, stream) {
    stream.addTrack(track);
    stream.dispatchEvent(new window.MediaStreamTrackEvent('addtrack',
        {track: track}));
  }

  function removeTrackFromStreamAndFireEvent(track, stream) {
    stream.removeTrack(track);
    stream.dispatchEvent(new window.MediaStreamTrackEvent('removetrack',
        {track: track}));
  }

  function fireAddTrack(pc, track, receiver, streams) {
    var trackEvent = new Event('track');
    trackEvent.track = track;
    trackEvent.receiver = receiver;
    trackEvent.transceiver = {receiver: receiver};
    trackEvent.streams = streams;
    window.setTimeout(function() {
      pc._dispatchEvent('track', trackEvent);
    });
  }

  var RTCPeerConnection = function(config) {
    var pc = this;

    var _eventTarget = document.createDocumentFragment();
    ['addEventListener', 'removeEventListener', 'dispatchEvent']
        .forEach(function(method) {
          pc[method] = _eventTarget[method].bind(_eventTarget);
        });

    this.canTrickleIceCandidates = null;

    this.needNegotiation = false;

    this.localStreams = [];
    this.remoteStreams = [];

    this._localDescription = null;
    this._remoteDescription = null;

    this.signalingState = 'stable';
    this.iceConnectionState = 'new';
    this.connectionState = 'new';
    this.iceGatheringState = 'new';

    config = JSON.parse(JSON.stringify(config || {}));

    this.usingBundle = config.bundlePolicy === 'max-bundle';
    if (config.rtcpMuxPolicy === 'negotiate') {
      throw(makeError('NotSupportedError',
          'rtcpMuxPolicy \'negotiate\' is not supported'));
    } else if (!config.rtcpMuxPolicy) {
      config.rtcpMuxPolicy = 'require';
    }

    switch (config.iceTransportPolicy) {
      case 'all':
      case 'relay':
        break;
      default:
        config.iceTransportPolicy = 'all';
        break;
    }

    switch (config.bundlePolicy) {
      case 'balanced':
      case 'max-compat':
      case 'max-bundle':
        break;
      default:
        config.bundlePolicy = 'balanced';
        break;
    }

    config.iceServers = filterIceServers(config.iceServers || [], edgeVersion);

    this._iceGatherers = [];
    if (config.iceCandidatePoolSize) {
      for (var i = config.iceCandidatePoolSize; i > 0; i--) {
        this._iceGatherers.push(new window.RTCIceGatherer({
          iceServers: config.iceServers,
          gatherPolicy: config.iceTransportPolicy
        }));
      }
    } else {
      config.iceCandidatePoolSize = 0;
    }

    this._config = config;

    // per-track iceGathers, iceTransports, dtlsTransports, rtpSenders, ...
    // everything that is needed to describe a SDP m-line.
    this.transceivers = [];

    this._sdpSessionId = SDPUtils.generateSessionId();
    this._sdpSessionVersion = 0;

    this._dtlsRole = undefined; // role for a=setup to use in answers.

    this._isClosed = false;
  };

  Object.defineProperty(RTCPeerConnection.prototype, 'localDescription', {
    configurable: true,
    get: function() {
      return this._localDescription;
    }
  });
  Object.defineProperty(RTCPeerConnection.prototype, 'remoteDescription', {
    configurable: true,
    get: function() {
      return this._remoteDescription;
    }
  });

  // set up event handlers on prototype
  RTCPeerConnection.prototype.onicecandidate = null;
  RTCPeerConnection.prototype.onaddstream = null;
  RTCPeerConnection.prototype.ontrack = null;
  RTCPeerConnection.prototype.onremovestream = null;
  RTCPeerConnection.prototype.onsignalingstatechange = null;
  RTCPeerConnection.prototype.oniceconnectionstatechange = null;
  RTCPeerConnection.prototype.onconnectionstatechange = null;
  RTCPeerConnection.prototype.onicegatheringstatechange = null;
  RTCPeerConnection.prototype.onnegotiationneeded = null;
  RTCPeerConnection.prototype.ondatachannel = null;

  RTCPeerConnection.prototype._dispatchEvent = function(name, event) {
    if (this._isClosed) {
      return;
    }
    this.dispatchEvent(event);
    if (typeof this['on' + name] === 'function') {
      this['on' + name](event);
    }
  };

  RTCPeerConnection.prototype._emitGatheringStateChange = function() {
    var event = new Event('icegatheringstatechange');
    this._dispatchEvent('icegatheringstatechange', event);
  };

  RTCPeerConnection.prototype.getConfiguration = function() {
    return this._config;
  };

  RTCPeerConnection.prototype.getLocalStreams = function() {
    return this.localStreams;
  };

  RTCPeerConnection.prototype.getRemoteStreams = function() {
    return this.remoteStreams;
  };

  // internal helper to create a transceiver object.
  // (which is not yet the same as the WebRTC 1.0 transceiver)
  RTCPeerConnection.prototype._createTransceiver = function(kind, doNotAdd) {
    var hasBundleTransport = this.transceivers.length > 0;
    var transceiver = {
      track: null,
      iceGatherer: null,
      iceTransport: null,
      dtlsTransport: null,
      localCapabilities: null,
      remoteCapabilities: null,
      rtpSender: null,
      rtpReceiver: null,
      kind: kind,
      mid: null,
      sendEncodingParameters: null,
      recvEncodingParameters: null,
      stream: null,
      associatedRemoteMediaStreams: [],
      wantReceive: true
    };
    if (this.usingBundle && hasBundleTransport) {
      transceiver.iceTransport = this.transceivers[0].iceTransport;
      transceiver.dtlsTransport = this.transceivers[0].dtlsTransport;
    } else {
      var transports = this._createIceAndDtlsTransports();
      transceiver.iceTransport = transports.iceTransport;
      transceiver.dtlsTransport = transports.dtlsTransport;
    }
    if (!doNotAdd) {
      this.transceivers.push(transceiver);
    }
    return transceiver;
  };

  RTCPeerConnection.prototype.addTrack = function(track, stream) {
    if (this._isClosed) {
      throw makeError('InvalidStateError',
          'Attempted to call addTrack on a closed peerconnection.');
    }

    var alreadyExists = this.transceivers.find(function(s) {
      return s.track === track;
    });

    if (alreadyExists) {
      throw makeError('InvalidAccessError', 'Track already exists.');
    }

    var transceiver;
    for (var i = 0; i < this.transceivers.length; i++) {
      if (!this.transceivers[i].track &&
          this.transceivers[i].kind === track.kind) {
        transceiver = this.transceivers[i];
      }
    }
    if (!transceiver) {
      transceiver = this._createTransceiver(track.kind);
    }

    this._maybeFireNegotiationNeeded();

    if (this.localStreams.indexOf(stream) === -1) {
      this.localStreams.push(stream);
    }

    transceiver.track = track;
    transceiver.stream = stream;
    transceiver.rtpSender = new window.RTCRtpSender(track,
        transceiver.dtlsTransport);
    return transceiver.rtpSender;
  };

  RTCPeerConnection.prototype.addStream = function(stream) {
    var pc = this;
    if (edgeVersion >= 15025) {
      stream.getTracks().forEach(function(track) {
        pc.addTrack(track, stream);
      });
    } else {
      // Clone is necessary for local demos mostly, attaching directly
      // to two different senders does not work (build 10547).
      // Fixed in 15025 (or earlier)
      var clonedStream = stream.clone();
      stream.getTracks().forEach(function(track, idx) {
        var clonedTrack = clonedStream.getTracks()[idx];
        track.addEventListener('enabled', function(event) {
          clonedTrack.enabled = event.enabled;
        });
      });
      clonedStream.getTracks().forEach(function(track) {
        pc.addTrack(track, clonedStream);
      });
    }
  };

  RTCPeerConnection.prototype.removeTrack = function(sender) {
    if (this._isClosed) {
      throw makeError('InvalidStateError',
          'Attempted to call removeTrack on a closed peerconnection.');
    }

    if (!(sender instanceof window.RTCRtpSender)) {
      throw new TypeError('Argument 1 of RTCPeerConnection.removeTrack ' +
          'does not implement interface RTCRtpSender.');
    }

    var transceiver = this.transceivers.find(function(t) {
      return t.rtpSender === sender;
    });

    if (!transceiver) {
      throw makeError('InvalidAccessError',
          'Sender was not created by this connection.');
    }
    var stream = transceiver.stream;

    transceiver.rtpSender.stop();
    transceiver.rtpSender = null;
    transceiver.track = null;
    transceiver.stream = null;

    // remove the stream from the set of local streams
    var localStreams = this.transceivers.map(function(t) {
      return t.stream;
    });
    if (localStreams.indexOf(stream) === -1 &&
        this.localStreams.indexOf(stream) > -1) {
      this.localStreams.splice(this.localStreams.indexOf(stream), 1);
    }

    this._maybeFireNegotiationNeeded();
  };

  RTCPeerConnection.prototype.removeStream = function(stream) {
    var pc = this;
    stream.getTracks().forEach(function(track) {
      var sender = pc.getSenders().find(function(s) {
        return s.track === track;
      });
      if (sender) {
        pc.removeTrack(sender);
      }
    });
  };

  RTCPeerConnection.prototype.getSenders = function() {
    return this.transceivers.filter(function(transceiver) {
      return !!transceiver.rtpSender;
    })
    .map(function(transceiver) {
      return transceiver.rtpSender;
    });
  };

  RTCPeerConnection.prototype.getReceivers = function() {
    return this.transceivers.filter(function(transceiver) {
      return !!transceiver.rtpReceiver;
    })
    .map(function(transceiver) {
      return transceiver.rtpReceiver;
    });
  };


  RTCPeerConnection.prototype._createIceGatherer = function(sdpMLineIndex,
      usingBundle) {
    var pc = this;
    if (usingBundle && sdpMLineIndex > 0) {
      return this.transceivers[0].iceGatherer;
    } else if (this._iceGatherers.length) {
      return this._iceGatherers.shift();
    }
    var iceGatherer = new window.RTCIceGatherer({
      iceServers: this._config.iceServers,
      gatherPolicy: this._config.iceTransportPolicy
    });
    Object.defineProperty(iceGatherer, 'state',
        {value: 'new', writable: true}
    );

    this.transceivers[sdpMLineIndex].bufferedCandidateEvents = [];
    this.transceivers[sdpMLineIndex].bufferCandidates = function(event) {
      var end = !event.candidate || Object.keys(event.candidate).length === 0;
      // polyfill since RTCIceGatherer.state is not implemented in
      // Edge 10547 yet.
      iceGatherer.state = end ? 'completed' : 'gathering';
      if (pc.transceivers[sdpMLineIndex].bufferedCandidateEvents !== null) {
        pc.transceivers[sdpMLineIndex].bufferedCandidateEvents.push(event);
      }
    };
    iceGatherer.addEventListener('localcandidate',
      this.transceivers[sdpMLineIndex].bufferCandidates);
    return iceGatherer;
  };

  // start gathering from an RTCIceGatherer.
  RTCPeerConnection.prototype._gather = function(mid, sdpMLineIndex) {
    var pc = this;
    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;
    if (iceGatherer.onlocalcandidate) {
      return;
    }
    var bufferedCandidateEvents =
      this.transceivers[sdpMLineIndex].bufferedCandidateEvents;
    this.transceivers[sdpMLineIndex].bufferedCandidateEvents = null;
    iceGatherer.removeEventListener('localcandidate',
      this.transceivers[sdpMLineIndex].bufferCandidates);
    iceGatherer.onlocalcandidate = function(evt) {
      if (pc.usingBundle && sdpMLineIndex > 0) {
        // if we know that we use bundle we can drop candidates with
        // ѕdpMLineIndex > 0. If we don't do this then our state gets
        // confused since we dispose the extra ice gatherer.
        return;
      }
      var event = new Event('icecandidate');
      event.candidate = {sdpMid: mid, sdpMLineIndex: sdpMLineIndex};

      var cand = evt.candidate;
      // Edge emits an empty object for RTCIceCandidateComplete‥
      var end = !cand || Object.keys(cand).length === 0;
      if (end) {
        // polyfill since RTCIceGatherer.state is not implemented in
        // Edge 10547 yet.
        if (iceGatherer.state === 'new' || iceGatherer.state === 'gathering') {
          iceGatherer.state = 'completed';
        }
      } else {
        if (iceGatherer.state === 'new') {
          iceGatherer.state = 'gathering';
        }
        // RTCIceCandidate doesn't have a component, needs to be added
        cand.component = 1;
        // also the usernameFragment. TODO: update SDP to take both variants.
        cand.ufrag = iceGatherer.getLocalParameters().usernameFragment;

        var serializedCandidate = SDPUtils.writeCandidate(cand);
        event.candidate = Object.assign(event.candidate,
            SDPUtils.parseCandidate(serializedCandidate));

        event.candidate.candidate = serializedCandidate;
        event.candidate.toJSON = function() {
          return {
            candidate: event.candidate.candidate,
            sdpMid: event.candidate.sdpMid,
            sdpMLineIndex: event.candidate.sdpMLineIndex,
            usernameFragment: event.candidate.usernameFragment
          };
        };
      }

      // update local description.
      var sections = SDPUtils.getMediaSections(pc._localDescription.sdp);
      if (!end) {
        sections[event.candidate.sdpMLineIndex] +=
            'a=' + event.candidate.candidate + '\r\n';
      } else {
        sections[event.candidate.sdpMLineIndex] +=
            'a=end-of-candidates\r\n';
      }
      pc._localDescription.sdp =
          SDPUtils.getDescription(pc._localDescription.sdp) +
          sections.join('');
      var complete = pc.transceivers.every(function(transceiver) {
        return transceiver.iceGatherer &&
            transceiver.iceGatherer.state === 'completed';
      });

      if (pc.iceGatheringState !== 'gathering') {
        pc.iceGatheringState = 'gathering';
        pc._emitGatheringStateChange();
      }

      // Emit candidate. Also emit null candidate when all gatherers are
      // complete.
      if (!end) {
        pc._dispatchEvent('icecandidate', event);
      }
      if (complete) {
        pc._dispatchEvent('icecandidate', new Event('icecandidate'));
        pc.iceGatheringState = 'complete';
        pc._emitGatheringStateChange();
      }
    };

    // emit already gathered candidates.
    window.setTimeout(function() {
      bufferedCandidateEvents.forEach(function(e) {
        iceGatherer.onlocalcandidate(e);
      });
    }, 0);
  };

  // Create ICE transport and DTLS transport.
  RTCPeerConnection.prototype._createIceAndDtlsTransports = function() {
    var pc = this;
    var iceTransport = new window.RTCIceTransport(null);
    iceTransport.onicestatechange = function() {
      pc._updateIceConnectionState();
      pc._updateConnectionState();
    };

    var dtlsTransport = new window.RTCDtlsTransport(iceTransport);
    dtlsTransport.ondtlsstatechange = function() {
      pc._updateConnectionState();
    };
    dtlsTransport.onerror = function() {
      // onerror does not set state to failed by itself.
      Object.defineProperty(dtlsTransport, 'state',
          {value: 'failed', writable: true});
      pc._updateConnectionState();
    };

    return {
      iceTransport: iceTransport,
      dtlsTransport: dtlsTransport
    };
  };

  // Destroy ICE gatherer, ICE transport and DTLS transport.
  // Without triggering the callbacks.
  RTCPeerConnection.prototype._disposeIceAndDtlsTransports = function(
      sdpMLineIndex) {
    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;
    if (iceGatherer) {
      delete iceGatherer.onlocalcandidate;
      delete this.transceivers[sdpMLineIndex].iceGatherer;
    }
    var iceTransport = this.transceivers[sdpMLineIndex].iceTransport;
    if (iceTransport) {
      delete iceTransport.onicestatechange;
      delete this.transceivers[sdpMLineIndex].iceTransport;
    }
    var dtlsTransport = this.transceivers[sdpMLineIndex].dtlsTransport;
    if (dtlsTransport) {
      delete dtlsTransport.ondtlsstatechange;
      delete dtlsTransport.onerror;
      delete this.transceivers[sdpMLineIndex].dtlsTransport;
    }
  };

  // Start the RTP Sender and Receiver for a transceiver.
  RTCPeerConnection.prototype._transceive = function(transceiver,
      send, recv) {
    var params = getCommonCapabilities(transceiver.localCapabilities,
        transceiver.remoteCapabilities);
    if (send && transceiver.rtpSender) {
      params.encodings = transceiver.sendEncodingParameters;
      params.rtcp = {
        cname: SDPUtils.localCName,
        compound: transceiver.rtcpParameters.compound
      };
      if (transceiver.recvEncodingParameters.length) {
        params.rtcp.ssrc = transceiver.recvEncodingParameters[0].ssrc;
      }
      transceiver.rtpSender.send(params);
    }
    if (recv && transceiver.rtpReceiver && params.codecs.length > 0) {
      // remove RTX field in Edge 14942
      if (transceiver.kind === 'video'
          && transceiver.recvEncodingParameters
          && edgeVersion < 15019) {
        transceiver.recvEncodingParameters.forEach(function(p) {
          delete p.rtx;
        });
      }
      if (transceiver.recvEncodingParameters.length) {
        params.encodings = transceiver.recvEncodingParameters;
      } else {
        params.encodings = [{}];
      }
      params.rtcp = {
        compound: transceiver.rtcpParameters.compound
      };
      if (transceiver.rtcpParameters.cname) {
        params.rtcp.cname = transceiver.rtcpParameters.cname;
      }
      if (transceiver.sendEncodingParameters.length) {
        params.rtcp.ssrc = transceiver.sendEncodingParameters[0].ssrc;
      }
      transceiver.rtpReceiver.receive(params);
    }
  };

  RTCPeerConnection.prototype.setLocalDescription = function(description) {
    var pc = this;

    // Note: pranswer is not supported.
    if (['offer', 'answer'].indexOf(description.type) === -1) {
      return Promise.reject(makeError('TypeError',
          'Unsupported type "' + description.type + '"'));
    }

    if (!isActionAllowedInSignalingState('setLocalDescription',
        description.type, pc.signalingState) || pc._isClosed) {
      return Promise.reject(makeError('InvalidStateError',
          'Can not set local ' + description.type +
          ' in state ' + pc.signalingState));
    }

    var sections;
    var sessionpart;
    if (description.type === 'offer') {
      // VERY limited support for SDP munging. Limited to:
      // * changing the order of codecs
      sections = SDPUtils.splitSections(description.sdp);
      sessionpart = sections.shift();
      sections.forEach(function(mediaSection, sdpMLineIndex) {
        var caps = SDPUtils.parseRtpParameters(mediaSection);
        pc.transceivers[sdpMLineIndex].localCapabilities = caps;
      });

      pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {
        pc._gather(transceiver.mid, sdpMLineIndex);
      });
    } else if (description.type === 'answer') {
      sections = SDPUtils.splitSections(pc._remoteDescription.sdp);
      sessionpart = sections.shift();
      var isIceLite = SDPUtils.matchPrefix(sessionpart,
          'a=ice-lite').length > 0;
      sections.forEach(function(mediaSection, sdpMLineIndex) {
        var transceiver = pc.transceivers[sdpMLineIndex];
        var iceGatherer = transceiver.iceGatherer;
        var iceTransport = transceiver.iceTransport;
        var dtlsTransport = transceiver.dtlsTransport;
        var localCapabilities = transceiver.localCapabilities;
        var remoteCapabilities = transceiver.remoteCapabilities;

        // treat bundle-only as not-rejected.
        var rejected = SDPUtils.isRejected(mediaSection) &&
            SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;

        if (!rejected && !transceiver.rejected) {
          var remoteIceParameters = SDPUtils.getIceParameters(
              mediaSection, sessionpart);
          var remoteDtlsParameters = SDPUtils.getDtlsParameters(
              mediaSection, sessionpart);
          if (isIceLite) {
            remoteDtlsParameters.role = 'server';
          }

          if (!pc.usingBundle || sdpMLineIndex === 0) {
            pc._gather(transceiver.mid, sdpMLineIndex);
            if (iceTransport.state === 'new') {
              iceTransport.start(iceGatherer, remoteIceParameters,
                  isIceLite ? 'controlling' : 'controlled');
            }
            if (dtlsTransport.state === 'new') {
              dtlsTransport.start(remoteDtlsParameters);
            }
          }

          // Calculate intersection of capabilities.
          var params = getCommonCapabilities(localCapabilities,
              remoteCapabilities);

          // Start the RTCRtpSender. The RTCRtpReceiver for this
          // transceiver has already been started in setRemoteDescription.
          pc._transceive(transceiver,
              params.codecs.length > 0,
              false);
        }
      });
    }

    pc._localDescription = {
      type: description.type,
      sdp: description.sdp
    };
    if (description.type === 'offer') {
      pc._updateSignalingState('have-local-offer');
    } else {
      pc._updateSignalingState('stable');
    }

    return Promise.resolve();
  };

  RTCPeerConnection.prototype.setRemoteDescription = function(description) {
    var pc = this;

    // Note: pranswer is not supported.
    if (['offer', 'answer'].indexOf(description.type) === -1) {
      return Promise.reject(makeError('TypeError',
          'Unsupported type "' + description.type + '"'));
    }

    if (!isActionAllowedInSignalingState('setRemoteDescription',
        description.type, pc.signalingState) || pc._isClosed) {
      return Promise.reject(makeError('InvalidStateError',
          'Can not set remote ' + description.type +
          ' in state ' + pc.signalingState));
    }

    var streams = {};
    pc.remoteStreams.forEach(function(stream) {
      streams[stream.id] = stream;
    });
    var receiverList = [];
    var sections = SDPUtils.splitSections(description.sdp);
    var sessionpart = sections.shift();
    var isIceLite = SDPUtils.matchPrefix(sessionpart,
        'a=ice-lite').length > 0;
    var usingBundle = SDPUtils.matchPrefix(sessionpart,
        'a=group:BUNDLE ').length > 0;
    pc.usingBundle = usingBundle;
    var iceOptions = SDPUtils.matchPrefix(sessionpart,
        'a=ice-options:')[0];
    if (iceOptions) {
      pc.canTrickleIceCandidates = iceOptions.substr(14).split(' ')
          .indexOf('trickle') >= 0;
    } else {
      pc.canTrickleIceCandidates = false;
    }

    sections.forEach(function(mediaSection, sdpMLineIndex) {
      var lines = SDPUtils.splitLines(mediaSection);
      var kind = SDPUtils.getKind(mediaSection);
      // treat bundle-only as not-rejected.
      var rejected = SDPUtils.isRejected(mediaSection) &&
          SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 0;
      var protocol = lines[0].substr(2).split(' ')[2];

      var direction = SDPUtils.getDirection(mediaSection, sessionpart);
      var remoteMsid = SDPUtils.parseMsid(mediaSection);

      var mid = SDPUtils.getMid(mediaSection) || SDPUtils.generateIdentifier();

      // Reject datachannels which are not implemented yet.
      if (rejected || (kind === 'application' && (protocol === 'DTLS/SCTP' ||
          protocol === 'UDP/DTLS/SCTP'))) {
        // TODO: this is dangerous in the case where a non-rejected m-line
        //     becomes rejected.
        pc.transceivers[sdpMLineIndex] = {
          mid: mid,
          kind: kind,
          protocol: protocol,
          rejected: true
        };
        return;
      }

      if (!rejected && pc.transceivers[sdpMLineIndex] &&
          pc.transceivers[sdpMLineIndex].rejected) {
        // recycle a rejected transceiver.
        pc.transceivers[sdpMLineIndex] = pc._createTransceiver(kind, true);
      }

      var transceiver;
      var iceGatherer;
      var iceTransport;
      var dtlsTransport;
      var rtpReceiver;
      var sendEncodingParameters;
      var recvEncodingParameters;
      var localCapabilities;

      var track;
      // FIXME: ensure the mediaSection has rtcp-mux set.
      var remoteCapabilities = SDPUtils.parseRtpParameters(mediaSection);
      var remoteIceParameters;
      var remoteDtlsParameters;
      if (!rejected) {
        remoteIceParameters = SDPUtils.getIceParameters(mediaSection,
            sessionpart);
        remoteDtlsParameters = SDPUtils.getDtlsParameters(mediaSection,
            sessionpart);
        remoteDtlsParameters.role = 'client';
      }
      recvEncodingParameters =
          SDPUtils.parseRtpEncodingParameters(mediaSection);

      var rtcpParameters = SDPUtils.parseRtcpParameters(mediaSection);

      var isComplete = SDPUtils.matchPrefix(mediaSection,
          'a=end-of-candidates', sessionpart).length > 0;
      var cands = SDPUtils.matchPrefix(mediaSection, 'a=candidate:')
          .map(function(cand) {
            return SDPUtils.parseCandidate(cand);
          })
          .filter(function(cand) {
            return cand.component === 1;
          });

      // Check if we can use BUNDLE and dispose transports.
      if ((description.type === 'offer' || description.type === 'answer') &&
          !rejected && usingBundle && sdpMLineIndex > 0 &&
          pc.transceivers[sdpMLineIndex]) {
        pc._disposeIceAndDtlsTransports(sdpMLineIndex);
        pc.transceivers[sdpMLineIndex].iceGatherer =
            pc.transceivers[0].iceGatherer;
        pc.transceivers[sdpMLineIndex].iceTransport =
            pc.transceivers[0].iceTransport;
        pc.transceivers[sdpMLineIndex].dtlsTransport =
            pc.transceivers[0].dtlsTransport;
        if (pc.transceivers[sdpMLineIndex].rtpSender) {
          pc.transceivers[sdpMLineIndex].rtpSender.setTransport(
              pc.transceivers[0].dtlsTransport);
        }
        if (pc.transceivers[sdpMLineIndex].rtpReceiver) {
          pc.transceivers[sdpMLineIndex].rtpReceiver.setTransport(
              pc.transceivers[0].dtlsTransport);
        }
      }
      if (description.type === 'offer' && !rejected) {
        transceiver = pc.transceivers[sdpMLineIndex] ||
            pc._createTransceiver(kind);
        transceiver.mid = mid;

        if (!transceiver.iceGatherer) {
          transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,
              usingBundle);
        }

        if (cands.length && transceiver.iceTransport.state === 'new') {
          if (isComplete && (!usingBundle || sdpMLineIndex === 0)) {
            transceiver.iceTransport.setRemoteCandidates(cands);
          } else {
            cands.forEach(function(candidate) {
              maybeAddCandidate(transceiver.iceTransport, candidate);
            });
          }
        }

        localCapabilities = window.RTCRtpReceiver.getCapabilities(kind);

        // filter RTX until additional stuff needed for RTX is implemented
        // in adapter.js
        if (edgeVersion < 15019) {
          localCapabilities.codecs = localCapabilities.codecs.filter(
              function(codec) {
                return codec.name !== 'rtx';
              });
        }

        sendEncodingParameters = transceiver.sendEncodingParameters || [{
          ssrc: (2 * sdpMLineIndex + 2) * 1001
        }];

        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams
        var isNewTrack = false;
        if (direction === 'sendrecv' || direction === 'sendonly') {
          isNewTrack = !transceiver.rtpReceiver;
          rtpReceiver = transceiver.rtpReceiver ||
              new window.RTCRtpReceiver(transceiver.dtlsTransport, kind);

          if (isNewTrack) {
            var stream;
            track = rtpReceiver.track;
            // FIXME: does not work with Plan B.
            if (remoteMsid && remoteMsid.stream === '-') {
              // no-op. a stream id of '-' means: no associated stream.
            } else if (remoteMsid) {
              if (!streams[remoteMsid.stream]) {
                streams[remoteMsid.stream] = new window.MediaStream();
                Object.defineProperty(streams[remoteMsid.stream], 'id', {
                  get: function() {
                    return remoteMsid.stream;
                  }
                });
              }
              Object.defineProperty(track, 'id', {
                get: function() {
                  return remoteMsid.track;
                }
              });
              stream = streams[remoteMsid.stream];
            } else {
              if (!streams.default) {
                streams.default = new window.MediaStream();
              }
              stream = streams.default;
            }
            if (stream) {
              addTrackToStreamAndFireEvent(track, stream);
              transceiver.associatedRemoteMediaStreams.push(stream);
            }
            receiverList.push([track, rtpReceiver, stream]);
          }
        } else if (transceiver.rtpReceiver && transceiver.rtpReceiver.track) {
          transceiver.associatedRemoteMediaStreams.forEach(function(s) {
            var nativeTrack = s.getTracks().find(function(t) {
              return t.id === transceiver.rtpReceiver.track.id;
            });
            if (nativeTrack) {
              removeTrackFromStreamAndFireEvent(nativeTrack, s);
            }
          });
          transceiver.associatedRemoteMediaStreams = [];
        }

        transceiver.localCapabilities = localCapabilities;
        transceiver.remoteCapabilities = remoteCapabilities;
        transceiver.rtpReceiver = rtpReceiver;
        transceiver.rtcpParameters = rtcpParameters;
        transceiver.sendEncodingParameters = sendEncodingParameters;
        transceiver.recvEncodingParameters = recvEncodingParameters;

        // Start the RTCRtpReceiver now. The RTPSender is started in
        // setLocalDescription.
        pc._transceive(pc.transceivers[sdpMLineIndex],
            false,
            isNewTrack);
      } else if (description.type === 'answer' && !rejected) {
        transceiver = pc.transceivers[sdpMLineIndex];
        iceGatherer = transceiver.iceGatherer;
        iceTransport = transceiver.iceTransport;
        dtlsTransport = transceiver.dtlsTransport;
        rtpReceiver = transceiver.rtpReceiver;
        sendEncodingParameters = transceiver.sendEncodingParameters;
        localCapabilities = transceiver.localCapabilities;

        pc.transceivers[sdpMLineIndex].recvEncodingParameters =
            recvEncodingParameters;
        pc.transceivers[sdpMLineIndex].remoteCapabilities =
            remoteCapabilities;
        pc.transceivers[sdpMLineIndex].rtcpParameters = rtcpParameters;

        if (cands.length && iceTransport.state === 'new') {
          if ((isIceLite || isComplete) &&
              (!usingBundle || sdpMLineIndex === 0)) {
            iceTransport.setRemoteCandidates(cands);
          } else {
            cands.forEach(function(candidate) {
              maybeAddCandidate(transceiver.iceTransport, candidate);
            });
          }
        }

        if (!usingBundle || sdpMLineIndex === 0) {
          if (iceTransport.state === 'new') {
            iceTransport.start(iceGatherer, remoteIceParameters,
                'controlling');
          }
          if (dtlsTransport.state === 'new') {
            dtlsTransport.start(remoteDtlsParameters);
          }
        }

        // If the offer contained RTX but the answer did not,
        // remove RTX from sendEncodingParameters.
        var commonCapabilities = getCommonCapabilities(
          transceiver.localCapabilities,
          transceiver.remoteCapabilities);

        var hasRtx = commonCapabilities.codecs.filter(function(c) {
          return c.name.toLowerCase() === 'rtx';
        }).length;
        if (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {
          delete transceiver.sendEncodingParameters[0].rtx;
        }

        pc._transceive(transceiver,
            direction === 'sendrecv' || direction === 'recvonly',
            direction === 'sendrecv' || direction === 'sendonly');

        // TODO: rewrite to use http://w3c.github.io/webrtc-pc/#set-associated-remote-streams
        if (rtpReceiver &&
            (direction === 'sendrecv' || direction === 'sendonly')) {
          track = rtpReceiver.track;
          if (remoteMsid) {
            if (!streams[remoteMsid.stream]) {
              streams[remoteMsid.stream] = new window.MediaStream();
            }
            addTrackToStreamAndFireEvent(track, streams[remoteMsid.stream]);
            receiverList.push([track, rtpReceiver, streams[remoteMsid.stream]]);
          } else {
            if (!streams.default) {
              streams.default = new window.MediaStream();
            }
            addTrackToStreamAndFireEvent(track, streams.default);
            receiverList.push([track, rtpReceiver, streams.default]);
          }
        } else {
          // FIXME: actually the receiver should be created later.
          delete transceiver.rtpReceiver;
        }
      }
    });

    if (pc._dtlsRole === undefined) {
      pc._dtlsRole = description.type === 'offer' ? 'active' : 'passive';
    }

    pc._remoteDescription = {
      type: description.type,
      sdp: description.sdp
    };
    if (description.type === 'offer') {
      pc._updateSignalingState('have-remote-offer');
    } else {
      pc._updateSignalingState('stable');
    }
    Object.keys(streams).forEach(function(sid) {
      var stream = streams[sid];
      if (stream.getTracks().length) {
        if (pc.remoteStreams.indexOf(stream) === -1) {
          pc.remoteStreams.push(stream);
          var event = new Event('addstream');
          event.stream = stream;
          window.setTimeout(function() {
            pc._dispatchEvent('addstream', event);
          });
        }

        receiverList.forEach(function(item) {
          var track = item[0];
          var receiver = item[1];
          if (stream.id !== item[2].id) {
            return;
          }
          fireAddTrack(pc, track, receiver, [stream]);
        });
      }
    });
    receiverList.forEach(function(item) {
      if (item[2]) {
        return;
      }
      fireAddTrack(pc, item[0], item[1], []);
    });

    // check whether addIceCandidate({}) was called within four seconds after
    // setRemoteDescription.
    window.setTimeout(function() {
      if (!(pc && pc.transceivers)) {
        return;
      }
      pc.transceivers.forEach(function(transceiver) {
        if (transceiver.iceTransport &&
            transceiver.iceTransport.state === 'new' &&
            transceiver.iceTransport.getRemoteCandidates().length > 0) {
          console.warn('Timeout for addRemoteCandidate. Consider sending ' +
              'an end-of-candidates notification');
          transceiver.iceTransport.addRemoteCandidate({});
        }
      });
    }, 4000);

    return Promise.resolve();
  };

  RTCPeerConnection.prototype.close = function() {
    this.transceivers.forEach(function(transceiver) {
      /* not yet
      if (transceiver.iceGatherer) {
        transceiver.iceGatherer.close();
      }
      */
      if (transceiver.iceTransport) {
        transceiver.iceTransport.stop();
      }
      if (transceiver.dtlsTransport) {
        transceiver.dtlsTransport.stop();
      }
      if (transceiver.rtpSender) {
        transceiver.rtpSender.stop();
      }
      if (transceiver.rtpReceiver) {
        transceiver.rtpReceiver.stop();
      }
    });
    // FIXME: clean up tracks, local streams, remote streams, etc
    this._isClosed = true;
    this._updateSignalingState('closed');
  };

  // Update the signaling state.
  RTCPeerConnection.prototype._updateSignalingState = function(newState) {
    this.signalingState = newState;
    var event = new Event('signalingstatechange');
    this._dispatchEvent('signalingstatechange', event);
  };

  // Determine whether to fire the negotiationneeded event.
  RTCPeerConnection.prototype._maybeFireNegotiationNeeded = function() {
    var pc = this;
    if (this.signalingState !== 'stable' || this.needNegotiation === true) {
      return;
    }
    this.needNegotiation = true;
    window.setTimeout(function() {
      if (pc.needNegotiation) {
        pc.needNegotiation = false;
        var event = new Event('negotiationneeded');
        pc._dispatchEvent('negotiationneeded', event);
      }
    }, 0);
  };

  // Update the ice connection state.
  RTCPeerConnection.prototype._updateIceConnectionState = function() {
    var newState;
    var states = {
      'new': 0,
      closed: 0,
      checking: 0,
      connected: 0,
      completed: 0,
      disconnected: 0,
      failed: 0
    };
    this.transceivers.forEach(function(transceiver) {
      if (transceiver.iceTransport && !transceiver.rejected) {
        states[transceiver.iceTransport.state]++;
      }
    });

    newState = 'new';
    if (states.failed > 0) {
      newState = 'failed';
    } else if (states.checking > 0) {
      newState = 'checking';
    } else if (states.disconnected > 0) {
      newState = 'disconnected';
    } else if (states.new > 0) {
      newState = 'new';
    } else if (states.connected > 0) {
      newState = 'connected';
    } else if (states.completed > 0) {
      newState = 'completed';
    }

    if (newState !== this.iceConnectionState) {
      this.iceConnectionState = newState;
      var event = new Event('iceconnectionstatechange');
      this._dispatchEvent('iceconnectionstatechange', event);
    }
  };

  // Update the connection state.
  RTCPeerConnection.prototype._updateConnectionState = function() {
    var newState;
    var states = {
      'new': 0,
      closed: 0,
      connecting: 0,
      connected: 0,
      completed: 0,
      disconnected: 0,
      failed: 0
    };
    this.transceivers.forEach(function(transceiver) {
      if (transceiver.iceTransport && transceiver.dtlsTransport &&
          !transceiver.rejected) {
        states[transceiver.iceTransport.state]++;
        states[transceiver.dtlsTransport.state]++;
      }
    });
    // ICETransport.completed and connected are the same for this purpose.
    states.connected += states.completed;

    newState = 'new';
    if (states.failed > 0) {
      newState = 'failed';
    } else if (states.connecting > 0) {
      newState = 'connecting';
    } else if (states.disconnected > 0) {
      newState = 'disconnected';
    } else if (states.new > 0) {
      newState = 'new';
    } else if (states.connected > 0) {
      newState = 'connected';
    }

    if (newState !== this.connectionState) {
      this.connectionState = newState;
      var event = new Event('connectionstatechange');
      this._dispatchEvent('connectionstatechange', event);
    }
  };

  RTCPeerConnection.prototype.createOffer = function() {
    var pc = this;

    if (pc._isClosed) {
      return Promise.reject(makeError('InvalidStateError',
          'Can not call createOffer after close'));
    }

    var numAudioTracks = pc.transceivers.filter(function(t) {
      return t.kind === 'audio';
    }).length;
    var numVideoTracks = pc.transceivers.filter(function(t) {
      return t.kind === 'video';
    }).length;

    // Determine number of audio and video tracks we need to send/recv.
    var offerOptions = arguments[0];
    if (offerOptions) {
      // Reject Chrome legacy constraints.
      if (offerOptions.mandatory || offerOptions.optional) {
        throw new TypeError(
            'Legacy mandatory/optional constraints not supported.');
      }
      if (offerOptions.offerToReceiveAudio !== undefined) {
        if (offerOptions.offerToReceiveAudio === true) {
          numAudioTracks = 1;
        } else if (offerOptions.offerToReceiveAudio === false) {
          numAudioTracks = 0;
        } else {
          numAudioTracks = offerOptions.offerToReceiveAudio;
        }
      }
      if (offerOptions.offerToReceiveVideo !== undefined) {
        if (offerOptions.offerToReceiveVideo === true) {
          numVideoTracks = 1;
        } else if (offerOptions.offerToReceiveVideo === false) {
          numVideoTracks = 0;
        } else {
          numVideoTracks = offerOptions.offerToReceiveVideo;
        }
      }
    }

    pc.transceivers.forEach(function(transceiver) {
      if (transceiver.kind === 'audio') {
        numAudioTracks--;
        if (numAudioTracks < 0) {
          transceiver.wantReceive = false;
        }
      } else if (transceiver.kind === 'video') {
        numVideoTracks--;
        if (numVideoTracks < 0) {
          transceiver.wantReceive = false;
        }
      }
    });

    // Create M-lines for recvonly streams.
    while (numAudioTracks > 0 || numVideoTracks > 0) {
      if (numAudioTracks > 0) {
        pc._createTransceiver('audio');
        numAudioTracks--;
      }
      if (numVideoTracks > 0) {
        pc._createTransceiver('video');
        numVideoTracks--;
      }
    }

    var sdp = SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,
        pc._sdpSessionVersion++);
    pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {
      // For each track, create an ice gatherer, ice transport,
      // dtls transport, potentially rtpsender and rtpreceiver.
      var track = transceiver.track;
      var kind = transceiver.kind;
      var mid = transceiver.mid || SDPUtils.generateIdentifier();
      transceiver.mid = mid;

      if (!transceiver.iceGatherer) {
        transceiver.iceGatherer = pc._createIceGatherer(sdpMLineIndex,
            pc.usingBundle);
      }

      var localCapabilities = window.RTCRtpSender.getCapabilities(kind);
      // filter RTX until additional stuff needed for RTX is implemented
      // in adapter.js
      if (edgeVersion < 15019) {
        localCapabilities.codecs = localCapabilities.codecs.filter(
            function(codec) {
              return codec.name !== 'rtx';
            });
      }
      localCapabilities.codecs.forEach(function(codec) {
        // work around https://bugs.chromium.org/p/webrtc/issues/detail?id=6552
        // by adding level-asymmetry-allowed=1
        if (codec.name === 'H264' &&
            codec.parameters['level-asymmetry-allowed'] === undefined) {
          codec.parameters['level-asymmetry-allowed'] = '1';
        }

        // for subsequent offers, we might have to re-use the payload
        // type of the last offer.
        if (transceiver.remoteCapabilities &&
            transceiver.remoteCapabilities.codecs) {
          transceiver.remoteCapabilities.codecs.forEach(function(remoteCodec) {
            if (codec.name.toLowerCase() === remoteCodec.name.toLowerCase() &&
                codec.clockRate === remoteCodec.clockRate) {
              codec.preferredPayloadType = remoteCodec.payloadType;
            }
          });
        }
      });
      localCapabilities.headerExtensions.forEach(function(hdrExt) {
        var remoteExtensions = transceiver.remoteCapabilities &&
            transceiver.remoteCapabilities.headerExtensions || [];
        remoteExtensions.forEach(function(rHdrExt) {
          if (hdrExt.uri === rHdrExt.uri) {
            hdrExt.id = rHdrExt.id;
          }
        });
      });

      // generate an ssrc now, to be used later in rtpSender.send
      var sendEncodingParameters = transceiver.sendEncodingParameters || [{
        ssrc: (2 * sdpMLineIndex + 1) * 1001
      }];
      if (track) {
        // add RTX
        if (edgeVersion >= 15019 && kind === 'video' &&
            !sendEncodingParameters[0].rtx) {
          sendEncodingParameters[0].rtx = {
            ssrc: sendEncodingParameters[0].ssrc + 1
          };
        }
      }

      if (transceiver.wantReceive) {
        transceiver.rtpReceiver = new window.RTCRtpReceiver(
            transceiver.dtlsTransport, kind);
      }

      transceiver.localCapabilities = localCapabilities;
      transceiver.sendEncodingParameters = sendEncodingParameters;
    });

    // always offer BUNDLE and dispose on return if not supported.
    if (pc._config.bundlePolicy !== 'max-compat') {
      sdp += 'a=group:BUNDLE ' + pc.transceivers.map(function(t) {
        return t.mid;
      }).join(' ') + '\r\n';
    }
    sdp += 'a=ice-options:trickle\r\n';

    pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {
      sdp += writeMediaSection(transceiver, transceiver.localCapabilities,
          'offer', transceiver.stream, pc._dtlsRole);
      sdp += 'a=rtcp-rsize\r\n';

      if (transceiver.iceGatherer && pc.iceGatheringState !== 'new' &&
          (sdpMLineIndex === 0 || !pc.usingBundle)) {
        transceiver.iceGatherer.getLocalCandidates().forEach(function(cand) {
          cand.component = 1;
          sdp += 'a=' + SDPUtils.writeCandidate(cand) + '\r\n';
        });

        if (transceiver.iceGatherer.state === 'completed') {
          sdp += 'a=end-of-candidates\r\n';
        }
      }
    });

    var desc = new window.RTCSessionDescription({
      type: 'offer',
      sdp: sdp
    });
    return Promise.resolve(desc);
  };

  RTCPeerConnection.prototype.createAnswer = function() {
    var pc = this;

    if (pc._isClosed) {
      return Promise.reject(makeError('InvalidStateError',
          'Can not call createAnswer after close'));
    }

    if (!(pc.signalingState === 'have-remote-offer' ||
        pc.signalingState === 'have-local-pranswer')) {
      return Promise.reject(makeError('InvalidStateError',
          'Can not call createAnswer in signalingState ' + pc.signalingState));
    }

    var sdp = SDPUtils.writeSessionBoilerplate(pc._sdpSessionId,
        pc._sdpSessionVersion++);
    if (pc.usingBundle) {
      sdp += 'a=group:BUNDLE ' + pc.transceivers.map(function(t) {
        return t.mid;
      }).join(' ') + '\r\n';
    }
    sdp += 'a=ice-options:trickle\r\n';

    var mediaSectionsInOffer = SDPUtils.getMediaSections(
        pc._remoteDescription.sdp).length;
    pc.transceivers.forEach(function(transceiver, sdpMLineIndex) {
      if (sdpMLineIndex + 1 > mediaSectionsInOffer) {
        return;
      }
      if (transceiver.rejected) {
        if (transceiver.kind === 'application') {
          if (transceiver.protocol === 'DTLS/SCTP') { // legacy fmt
            sdp += 'm=application 0 DTLS/SCTP 5000\r\n';
          } else {
            sdp += 'm=application 0 ' + transceiver.protocol +
                ' webrtc-datachannel\r\n';
          }
        } else if (transceiver.kind === 'audio') {
          sdp += 'm=audio 0 UDP/TLS/RTP/SAVPF 0\r\n' +
              'a=rtpmap:0 PCMU/8000\r\n';
        } else if (transceiver.kind === 'video') {
          sdp += 'm=video 0 UDP/TLS/RTP/SAVPF 120\r\n' +
              'a=rtpmap:120 VP8/90000\r\n';
        }
        sdp += 'c=IN IP4 0.0.0.0\r\n' +
            'a=inactive\r\n' +
            'a=mid:' + transceiver.mid + '\r\n';
        return;
      }

      // FIXME: look at direction.
      if (transceiver.stream) {
        var localTrack;
        if (transceiver.kind === 'audio') {
          localTrack = transceiver.stream.getAudioTracks()[0];
        } else if (transceiver.kind === 'video') {
          localTrack = transceiver.stream.getVideoTracks()[0];
        }
        if (localTrack) {
          // add RTX
          if (edgeVersion >= 15019 && transceiver.kind === 'video' &&
              !transceiver.sendEncodingParameters[0].rtx) {
            transceiver.sendEncodingParameters[0].rtx = {
              ssrc: transceiver.sendEncodingParameters[0].ssrc + 1
            };
          }
        }
      }

      // Calculate intersection of capabilities.
      var commonCapabilities = getCommonCapabilities(
          transceiver.localCapabilities,
          transceiver.remoteCapabilities);

      var hasRtx = commonCapabilities.codecs.filter(function(c) {
        return c.name.toLowerCase() === 'rtx';
      }).length;
      if (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {
        delete transceiver.sendEncodingParameters[0].rtx;
      }

      sdp += writeMediaSection(transceiver, commonCapabilities,
          'answer', transceiver.stream, pc._dtlsRole);
      if (transceiver.rtcpParameters &&
          transceiver.rtcpParameters.reducedSize) {
        sdp += 'a=rtcp-rsize\r\n';
      }
    });

    var desc = new window.RTCSessionDescription({
      type: 'answer',
      sdp: sdp
    });
    return Promise.resolve(desc);
  };

  RTCPeerConnection.prototype.addIceCandidate = function(candidate) {
    var pc = this;
    var sections;
    if (candidate && !(candidate.sdpMLineIndex !== undefined ||
        candidate.sdpMid)) {
      return Promise.reject(new TypeError('sdpMLineIndex or sdpMid required'));
    }

    // TODO: needs to go into ops queue.
    return new Promise(function(resolve, reject) {
      if (!pc._remoteDescription) {
        return reject(makeError('InvalidStateError',
            'Can not add ICE candidate without a remote description'));
      } else if (!candidate || candidate.candidate === '') {
        for (var j = 0; j < pc.transceivers.length; j++) {
          if (pc.transceivers[j].rejected) {
            continue;
          }
          pc.transceivers[j].iceTransport.addRemoteCandidate({});
          sections = SDPUtils.getMediaSections(pc._remoteDescription.sdp);
          sections[j] += 'a=end-of-candidates\r\n';
          pc._remoteDescription.sdp =
              SDPUtils.getDescription(pc._remoteDescription.sdp) +
              sections.join('');
          if (pc.usingBundle) {
            break;
          }
        }
      } else {
        var sdpMLineIndex = candidate.sdpMLineIndex;
        if (candidate.sdpMid) {
          for (var i = 0; i < pc.transceivers.length; i++) {
            if (pc.transceivers[i].mid === candidate.sdpMid) {
              sdpMLineIndex = i;
              break;
            }
          }
        }
        var transceiver = pc.transceivers[sdpMLineIndex];
        if (transceiver) {
          if (transceiver.rejected) {
            return resolve();
          }
          var cand = Object.keys(candidate.candidate).length > 0 ?
              SDPUtils.parseCandidate(candidate.candidate) : {};
          // Ignore Chrome's invalid candidates since Edge does not like them.
          if (cand.protocol === 'tcp' && (cand.port === 0 || cand.port === 9)) {
            return resolve();
          }
          // Ignore RTCP candidates, we assume RTCP-MUX.
          if (cand.component && cand.component !== 1) {
            return resolve();
          }
          // when using bundle, avoid adding candidates to the wrong
          // ice transport. And avoid adding candidates added in the SDP.
          if (sdpMLineIndex === 0 || (sdpMLineIndex > 0 &&
              transceiver.iceTransport !== pc.transceivers[0].iceTransport)) {
            if (!maybeAddCandidate(transceiver.iceTransport, cand)) {
              return reject(makeError('OperationError',
                  'Can not add ICE candidate'));
            }
          }

          // update the remoteDescription.
          var candidateString = candidate.candidate.trim();
          if (candidateString.indexOf('a=') === 0) {
            candidateString = candidateString.substr(2);
          }
          sections = SDPUtils.getMediaSections(pc._remoteDescription.sdp);
          sections[sdpMLineIndex] += 'a=' +
              (cand.type ? candidateString : 'end-of-candidates')
              + '\r\n';
          pc._remoteDescription.sdp =
              SDPUtils.getDescription(pc._remoteDescription.sdp) +
              sections.join('');
        } else {
          return reject(makeError('OperationError',
              'Can not add ICE candidate'));
        }
      }
      resolve();
    });
  };

  RTCPeerConnection.prototype.getStats = function(selector) {
    if (selector && selector instanceof window.MediaStreamTrack) {
      var senderOrReceiver = null;
      this.transceivers.forEach(function(transceiver) {
        if (transceiver.rtpSender &&
            transceiver.rtpSender.track === selector) {
          senderOrReceiver = transceiver.rtpSender;
        } else if (transceiver.rtpReceiver &&
            transceiver.rtpReceiver.track === selector) {
          senderOrReceiver = transceiver.rtpReceiver;
        }
      });
      if (!senderOrReceiver) {
        throw makeError('InvalidAccessError', 'Invalid selector.');
      }
      return senderOrReceiver.getStats();
    }

    var promises = [];
    this.transceivers.forEach(function(transceiver) {
      ['rtpSender', 'rtpReceiver', 'iceGatherer', 'iceTransport',
          'dtlsTransport'].forEach(function(method) {
            if (transceiver[method]) {
              promises.push(transceiver[method].getStats());
            }
          });
    });
    return Promise.all(promises).then(function(allStats) {
      var results = new Map();
      allStats.forEach(function(stats) {
        stats.forEach(function(stat) {
          results.set(stat.id, stat);
        });
      });
      return results;
    });
  };

  // fix low-level stat names and return Map instead of object.
  var ortcObjects = ['RTCRtpSender', 'RTCRtpReceiver', 'RTCIceGatherer',
    'RTCIceTransport', 'RTCDtlsTransport'];
  ortcObjects.forEach(function(ortcObjectName) {
    var obj = window[ortcObjectName];
    if (obj && obj.prototype && obj.prototype.getStats) {
      var nativeGetstats = obj.prototype.getStats;
      obj.prototype.getStats = function() {
        return nativeGetstats.apply(this)
        .then(function(nativeStats) {
          var mapStats = new Map();
          Object.keys(nativeStats).forEach(function(id) {
            nativeStats[id].type = fixStatsType(nativeStats[id]);
            mapStats.set(id, nativeStats[id]);
          });
          return mapStats;
        });
      };
    }
  });

  // legacy callback shims. Should be moved to adapter.js some days.
  var methods = ['createOffer', 'createAnswer'];
  methods.forEach(function(method) {
    var nativeMethod = RTCPeerConnection.prototype[method];
    RTCPeerConnection.prototype[method] = function() {
      var args = arguments;
      if (typeof args[0] === 'function' ||
          typeof args[1] === 'function') { // legacy
        return nativeMethod.apply(this, [arguments[2]])
        .then(function(description) {
          if (typeof args[0] === 'function') {
            args[0].apply(null, [description]);
          }
        }, function(error) {
          if (typeof args[1] === 'function') {
            args[1].apply(null, [error]);
          }
        });
      }
      return nativeMethod.apply(this, arguments);
    };
  });

  methods = ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate'];
  methods.forEach(function(method) {
    var nativeMethod = RTCPeerConnection.prototype[method];
    RTCPeerConnection.prototype[method] = function() {
      var args = arguments;
      if (typeof args[1] === 'function' ||
          typeof args[2] === 'function') { // legacy
        return nativeMethod.apply(this, arguments)
        .then(function() {
          if (typeof args[1] === 'function') {
            args[1].apply(null);
          }
        }, function(error) {
          if (typeof args[2] === 'function') {
            args[2].apply(null, [error]);
          }
        });
      }
      return nativeMethod.apply(this, arguments);
    };
  });

  // getStats is special. It doesn't have a spec legacy method yet we support
  // getStats(something, cb) without error callbacks.
  ['getStats'].forEach(function(method) {
    var nativeMethod = RTCPeerConnection.prototype[method];
    RTCPeerConnection.prototype[method] = function() {
      var args = arguments;
      if (typeof args[1] === 'function') {
        return nativeMethod.apply(this, arguments)
        .then(function() {
          if (typeof args[1] === 'function') {
            args[1].apply(null);
          }
        });
      }
      return nativeMethod.apply(this, arguments);
    };
  });

  return RTCPeerConnection;
};

},{"sdp":118}],118:[function(require,module,exports){
/* eslint-env node */
'use strict';

// SDP helpers.
var SDPUtils = {};

// Generate an alphanumeric identifier for cname or mids.
// TODO: use UUIDs instead? https://gist.github.com/jed/982883
SDPUtils.generateIdentifier = function() {
  return Math.random().toString(36).substr(2, 10);
};

// The RTCP CNAME used by all peerconnections from the same JS.
SDPUtils.localCName = SDPUtils.generateIdentifier();

// Splits SDP into lines, dealing with both CRLF and LF.
SDPUtils.splitLines = function(blob) {
  return blob.trim().split('\n').map(function(line) {
    return line.trim();
  });
};
// Splits SDP into sessionpart and mediasections. Ensures CRLF.
SDPUtils.splitSections = function(blob) {
  var parts = blob.split('\nm=');
  return parts.map(function(part, index) {
    return (index > 0 ? 'm=' + part : part).trim() + '\r\n';
  });
};

// returns the session description.
SDPUtils.getDescription = function(blob) {
  var sections = SDPUtils.splitSections(blob);
  return sections && sections[0];
};

// returns the individual media sections.
SDPUtils.getMediaSections = function(blob) {
  var sections = SDPUtils.splitSections(blob);
  sections.shift();
  return sections;
};

// Returns lines that start with a certain prefix.
SDPUtils.matchPrefix = function(blob, prefix) {
  return SDPUtils.splitLines(blob).filter(function(line) {
    return line.indexOf(prefix) === 0;
  });
};

// Parses an ICE candidate line. Sample input:
// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8
// rport 55996"
SDPUtils.parseCandidate = function(line) {
  var parts;
  // Parse both variants.
  if (line.indexOf('a=candidate:') === 0) {
    parts = line.substring(12).split(' ');
  } else {
    parts = line.substring(10).split(' ');
  }

  var candidate = {
    foundation: parts[0],
    component: parseInt(parts[1], 10),
    protocol: parts[2].toLowerCase(),
    priority: parseInt(parts[3], 10),
    ip: parts[4],
    address: parts[4], // address is an alias for ip.
    port: parseInt(parts[5], 10),
    // skip parts[6] == 'typ'
    type: parts[7]
  };

  for (var i = 8; i < parts.length; i += 2) {
    switch (parts[i]) {
      case 'raddr':
        candidate.relatedAddress = parts[i + 1];
        break;
      case 'rport':
        candidate.relatedPort = parseInt(parts[i + 1], 10);
        break;
      case 'tcptype':
        candidate.tcpType = parts[i + 1];
        break;
      case 'ufrag':
        candidate.ufrag = parts[i + 1]; // for backward compability.
        candidate.usernameFragment = parts[i + 1];
        break;
      default: // extension handling, in particular ufrag
        candidate[parts[i]] = parts[i + 1];
        break;
    }
  }
  return candidate;
};

// Translates a candidate object into SDP candidate attribute.
SDPUtils.writeCandidate = function(candidate) {
  var sdp = [];
  sdp.push(candidate.foundation);
  sdp.push(candidate.component);
  sdp.push(candidate.protocol.toUpperCase());
  sdp.push(candidate.priority);
  sdp.push(candidate.address || candidate.ip);
  sdp.push(candidate.port);

  var type = candidate.type;
  sdp.push('typ');
  sdp.push(type);
  if (type !== 'host' && candidate.relatedAddress &&
      candidate.relatedPort) {
    sdp.push('raddr');
    sdp.push(candidate.relatedAddress);
    sdp.push('rport');
    sdp.push(candidate.relatedPort);
  }
  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {
    sdp.push('tcptype');
    sdp.push(candidate.tcpType);
  }
  if (candidate.usernameFragment || candidate.ufrag) {
    sdp.push('ufrag');
    sdp.push(candidate.usernameFragment || candidate.ufrag);
  }
  return 'candidate:' + sdp.join(' ');
};

// Parses an ice-options line, returns an array of option tags.
// a=ice-options:foo bar
SDPUtils.parseIceOptions = function(line) {
  return line.substr(14).split(' ');
};

// Parses an rtpmap line, returns RTCRtpCoddecParameters. Sample input:
// a=rtpmap:111 opus/48000/2
SDPUtils.parseRtpMap = function(line) {
  var parts = line.substr(9).split(' ');
  var parsed = {
    payloadType: parseInt(parts.shift(), 10) // was: id
  };

  parts = parts[0].split('/');

  parsed.name = parts[0];
  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate
  parsed.channels = parts.length === 3 ? parseInt(parts[2], 10) : 1;
  // legacy alias, got renamed back to channels in ORTC.
  parsed.numChannels = parsed.channels;
  return parsed;
};

// Generate an a=rtpmap line from RTCRtpCodecCapability or
// RTCRtpCodecParameters.
SDPUtils.writeRtpMap = function(codec) {
  var pt = codec.payloadType;
  if (codec.preferredPayloadType !== undefined) {
    pt = codec.preferredPayloadType;
  }
  var channels = codec.channels || codec.numChannels || 1;
  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +
      (channels !== 1 ? '/' + channels : '') + '\r\n';
};

// Parses an a=extmap line (headerextension from RFC 5285). Sample input:
// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset
// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset
SDPUtils.parseExtmap = function(line) {
  var parts = line.substr(9).split(' ');
  return {
    id: parseInt(parts[0], 10),
    direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',
    uri: parts[1]
  };
};

// Generates a=extmap line from RTCRtpHeaderExtensionParameters or
// RTCRtpHeaderExtension.
SDPUtils.writeExtmap = function(headerExtension) {
  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +
      (headerExtension.direction && headerExtension.direction !== 'sendrecv'
        ? '/' + headerExtension.direction
        : '') +
      ' ' + headerExtension.uri + '\r\n';
};

// Parses an ftmp line, returns dictionary. Sample input:
// a=fmtp:96 vbr=on;cng=on
// Also deals with vbr=on; cng=on
SDPUtils.parseFmtp = function(line) {
  var parsed = {};
  var kv;
  var parts = line.substr(line.indexOf(' ') + 1).split(';');
  for (var j = 0; j < parts.length; j++) {
    kv = parts[j].trim().split('=');
    parsed[kv[0].trim()] = kv[1];
  }
  return parsed;
};

// Generates an a=ftmp line from RTCRtpCodecCapability or RTCRtpCodecParameters.
SDPUtils.writeFmtp = function(codec) {
  var line = '';
  var pt = codec.payloadType;
  if (codec.preferredPayloadType !== undefined) {
    pt = codec.preferredPayloadType;
  }
  if (codec.parameters && Object.keys(codec.parameters).length) {
    var params = [];
    Object.keys(codec.parameters).forEach(function(param) {
      if (codec.parameters[param]) {
        params.push(param + '=' + codec.parameters[param]);
      } else {
        params.push(param);
      }
    });
    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\r\n';
  }
  return line;
};

// Parses an rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:
// a=rtcp-fb:98 nack rpsi
SDPUtils.parseRtcpFb = function(line) {
  var parts = line.substr(line.indexOf(' ') + 1).split(' ');
  return {
    type: parts.shift(),
    parameter: parts.join(' ')
  };
};
// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.
SDPUtils.writeRtcpFb = function(codec) {
  var lines = '';
  var pt = codec.payloadType;
  if (codec.preferredPayloadType !== undefined) {
    pt = codec.preferredPayloadType;
  }
  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {
    // FIXME: special handling for trr-int?
    codec.rtcpFeedback.forEach(function(fb) {
      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type +
      (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +
          '\r\n';
    });
  }
  return lines;
};

// Parses an RFC 5576 ssrc media attribute. Sample input:
// a=ssrc:3735928559 cname:something
SDPUtils.parseSsrcMedia = function(line) {
  var sp = line.indexOf(' ');
  var parts = {
    ssrc: parseInt(line.substr(7, sp - 7), 10)
  };
  var colon = line.indexOf(':', sp);
  if (colon > -1) {
    parts.attribute = line.substr(sp + 1, colon - sp - 1);
    parts.value = line.substr(colon + 1);
  } else {
    parts.attribute = line.substr(sp + 1);
  }
  return parts;
};

SDPUtils.parseSsrcGroup = function(line) {
  var parts = line.substr(13).split(' ');
  return {
    semantics: parts.shift(),
    ssrcs: parts.map(function(ssrc) {
      return parseInt(ssrc, 10);
    })
  };
};

// Extracts the MID (RFC 5888) from a media section.
// returns the MID or undefined if no mid line was found.
SDPUtils.getMid = function(mediaSection) {
  var mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];
  if (mid) {
    return mid.substr(6);
  }
};

SDPUtils.parseFingerprint = function(line) {
  var parts = line.substr(14).split(' ');
  return {
    algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.
    value: parts[1]
  };
};

// Extracts DTLS parameters from SDP media section or sessionpart.
// FIXME: for consistency with other functions this should only
//   get the fingerprint line as input. See also getIceParameters.
SDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {
  var lines = SDPUtils.matchPrefix(mediaSection + sessionpart,
    'a=fingerprint:');
  // Note: a=setup line is ignored since we use the 'auto' role.
  // Note2: 'algorithm' is not case sensitive except in Edge.
  return {
    role: 'auto',
    fingerprints: lines.map(SDPUtils.parseFingerprint)
  };
};

// Serializes DTLS parameters to SDP.
SDPUtils.writeDtlsParameters = function(params, setupType) {
  var sdp = 'a=setup:' + setupType + '\r\n';
  params.fingerprints.forEach(function(fp) {
    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\r\n';
  });
  return sdp;
};

// Parses a=crypto lines into
//   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#dictionary-rtcsrtpsdesparameters-members
SDPUtils.parseCryptoLine = function(line) {
  var parts = line.substr(9).split(' ');
  return {
    tag: parseInt(parts[0], 10),
    cryptoSuite: parts[1],
    keyParams: parts[2],
    sessionParams: parts.slice(3),
  };
};

SDPUtils.writeCryptoLine = function(parameters) {
  return 'a=crypto:' + parameters.tag + ' ' +
    parameters.cryptoSuite + ' ' +
    (typeof parameters.keyParams === 'object'
      ? SDPUtils.writeCryptoKeyParams(parameters.keyParams)
      : parameters.keyParams) +
    (parameters.sessionParams ? ' ' + parameters.sessionParams.join(' ') : '') +
    '\r\n';
};

// Parses the crypto key parameters into
//   https://rawgit.com/aboba/edgertc/master/msortc-rs4.html#rtcsrtpkeyparam*
SDPUtils.parseCryptoKeyParams = function(keyParams) {
  if (keyParams.indexOf('inline:') !== 0) {
    return null;
  }
  var parts = keyParams.substr(7).split('|');
  return {
    keyMethod: 'inline',
    keySalt: parts[0],
    lifeTime: parts[1],
    mkiValue: parts[2] ? parts[2].split(':')[0] : undefined,
    mkiLength: parts[2] ? parts[2].split(':')[1] : undefined,
  };
};

SDPUtils.writeCryptoKeyParams = function(keyParams) {
  return keyParams.keyMethod + ':'
    + keyParams.keySalt +
    (keyParams.lifeTime ? '|' + keyParams.lifeTime : '') +
    (keyParams.mkiValue && keyParams.mkiLength
      ? '|' + keyParams.mkiValue + ':' + keyParams.mkiLength
      : '');
};

// Extracts all SDES paramters.
SDPUtils.getCryptoParameters = function(mediaSection, sessionpart) {
  var lines = SDPUtils.matchPrefix(mediaSection + sessionpart,
    'a=crypto:');
  return lines.map(SDPUtils.parseCryptoLine);
};

// Parses ICE information from SDP media section or sessionpart.
// FIXME: for consistency with other functions this should only
//   get the ice-ufrag and ice-pwd lines as input.
SDPUtils.getIceParameters = function(mediaSection, sessionpart) {
  var ufrag = SDPUtils.matchPrefix(mediaSection + sessionpart,
    'a=ice-ufrag:')[0];
  var pwd = SDPUtils.matchPrefix(mediaSection + sessionpart,
    'a=ice-pwd:')[0];
  if (!(ufrag && pwd)) {
    return null;
  }
  return {
    usernameFragment: ufrag.substr(12),
    password: pwd.substr(10),
  };
};

// Serializes ICE parameters to SDP.
SDPUtils.writeIceParameters = function(params) {
  return 'a=ice-ufrag:' + params.usernameFragment + '\r\n' +
      'a=ice-pwd:' + params.password + '\r\n';
};

// Parses the SDP media section and returns RTCRtpParameters.
SDPUtils.parseRtpParameters = function(mediaSection) {
  var description = {
    codecs: [],
    headerExtensions: [],
    fecMechanisms: [],
    rtcp: []
  };
  var lines = SDPUtils.splitLines(mediaSection);
  var mline = lines[0].split(' ');
  for (var i = 3; i < mline.length; i++) { // find all codecs from mline[3..]
    var pt = mline[i];
    var rtpmapline = SDPUtils.matchPrefix(
      mediaSection, 'a=rtpmap:' + pt + ' ')[0];
    if (rtpmapline) {
      var codec = SDPUtils.parseRtpMap(rtpmapline);
      var fmtps = SDPUtils.matchPrefix(
        mediaSection, 'a=fmtp:' + pt + ' ');
      // Only the first a=fmtp:<pt> is considered.
      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};
      codec.rtcpFeedback = SDPUtils.matchPrefix(
        mediaSection, 'a=rtcp-fb:' + pt + ' ')
        .map(SDPUtils.parseRtcpFb);
      description.codecs.push(codec);
      // parse FEC mechanisms from rtpmap lines.
      switch (codec.name.toUpperCase()) {
        case 'RED':
        case 'ULPFEC':
          description.fecMechanisms.push(codec.name.toUpperCase());
          break;
        default: // only RED and ULPFEC are recognized as FEC mechanisms.
          break;
      }
    }
  }
  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(function(line) {
    description.headerExtensions.push(SDPUtils.parseExtmap(line));
  });
  // FIXME: parse rtcp.
  return description;
};

// Generates parts of the SDP media section describing the capabilities /
// parameters.
SDPUtils.writeRtpDescription = function(kind, caps) {
  var sdp = '';

  // Build the mline.
  sdp += 'm=' + kind + ' ';
  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.
  sdp += ' UDP/TLS/RTP/SAVPF ';
  sdp += caps.codecs.map(function(codec) {
    if (codec.preferredPayloadType !== undefined) {
      return codec.preferredPayloadType;
    }
    return codec.payloadType;
  }).join(' ') + '\r\n';

  sdp += 'c=IN IP4 0.0.0.0\r\n';
  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\r\n';

  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.
  caps.codecs.forEach(function(codec) {
    sdp += SDPUtils.writeRtpMap(codec);
    sdp += SDPUtils.writeFmtp(codec);
    sdp += SDPUtils.writeRtcpFb(codec);
  });
  var maxptime = 0;
  caps.codecs.forEach(function(codec) {
    if (codec.maxptime > maxptime) {
      maxptime = codec.maxptime;
    }
  });
  if (maxptime > 0) {
    sdp += 'a=maxptime:' + maxptime + '\r\n';
  }
  sdp += 'a=rtcp-mux\r\n';

  if (caps.headerExtensions) {
    caps.headerExtensions.forEach(function(extension) {
      sdp += SDPUtils.writeExtmap(extension);
    });
  }
  // FIXME: write fecMechanisms.
  return sdp;
};

// Parses the SDP media section and returns an array of
// RTCRtpEncodingParameters.
SDPUtils.parseRtpEncodingParameters = function(mediaSection) {
  var encodingParameters = [];
  var description = SDPUtils.parseRtpParameters(mediaSection);
  var hasRed = description.fecMechanisms.indexOf('RED') !== -1;
  var hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;

  // filter a=ssrc:... cname:, ignore PlanB-msid
  var ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')
    .map(function(line) {
      return SDPUtils.parseSsrcMedia(line);
    })
    .filter(function(parts) {
      return parts.attribute === 'cname';
    });
  var primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;
  var secondarySsrc;

  var flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')
    .map(function(line) {
      var parts = line.substr(17).split(' ');
      return parts.map(function(part) {
        return parseInt(part, 10);
      });
    });
  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {
    secondarySsrc = flows[0][1];
  }

  description.codecs.forEach(function(codec) {
    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {
      var encParam = {
        ssrc: primarySsrc,
        codecPayloadType: parseInt(codec.parameters.apt, 10)
      };
      if (primarySsrc && secondarySsrc) {
        encParam.rtx = {ssrc: secondarySsrc};
      }
      encodingParameters.push(encParam);
      if (hasRed) {
        encParam = JSON.parse(JSON.stringify(encParam));
        encParam.fec = {
          ssrc: primarySsrc,
          mechanism: hasUlpfec ? 'red+ulpfec' : 'red'
        };
        encodingParameters.push(encParam);
      }
    }
  });
  if (encodingParameters.length === 0 && primarySsrc) {
    encodingParameters.push({
      ssrc: primarySsrc
    });
  }

  // we support both b=AS and b=TIAS but interpret AS as TIAS.
  var bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');
  if (bandwidth.length) {
    if (bandwidth[0].indexOf('b=TIAS:') === 0) {
      bandwidth = parseInt(bandwidth[0].substr(7), 10);
    } else if (bandwidth[0].indexOf('b=AS:') === 0) {
      // use formula from JSEP to convert b=AS to TIAS value.
      bandwidth = parseInt(bandwidth[0].substr(5), 10) * 1000 * 0.95
          - (50 * 40 * 8);
    } else {
      bandwidth = undefined;
    }
    encodingParameters.forEach(function(params) {
      params.maxBitrate = bandwidth;
    });
  }
  return encodingParameters;
};

// parses http://draft.ortc.org/#rtcrtcpparameters*
SDPUtils.parseRtcpParameters = function(mediaSection) {
  var rtcpParameters = {};

  // Gets the first SSRC. Note tha with RTX there might be multiple
  // SSRCs.
  var remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')
    .map(function(line) {
      return SDPUtils.parseSsrcMedia(line);
    })
    .filter(function(obj) {
      return obj.attribute === 'cname';
    })[0];
  if (remoteSsrc) {
    rtcpParameters.cname = remoteSsrc.value;
    rtcpParameters.ssrc = remoteSsrc.ssrc;
  }

  // Edge uses the compound attribute instead of reducedSize
  // compound is !reducedSize
  var rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');
  rtcpParameters.reducedSize = rsize.length > 0;
  rtcpParameters.compound = rsize.length === 0;

  // parses the rtcp-mux attrіbute.
  // Note that Edge does not support unmuxed RTCP.
  var mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');
  rtcpParameters.mux = mux.length > 0;

  return rtcpParameters;
};

// parses either a=msid: or a=ssrc:... msid lines and returns
// the id of the MediaStream and MediaStreamTrack.
SDPUtils.parseMsid = function(mediaSection) {
  var parts;
  var spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');
  if (spec.length === 1) {
    parts = spec[0].substr(7).split(' ');
    return {stream: parts[0], track: parts[1]};
  }
  var planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')
    .map(function(line) {
      return SDPUtils.parseSsrcMedia(line);
    })
    .filter(function(msidParts) {
      return msidParts.attribute === 'msid';
    });
  if (planB.length > 0) {
    parts = planB[0].value.split(' ');
    return {stream: parts[0], track: parts[1]};
  }
};

// SCTP
// parses draft-ietf-mmusic-sctp-sdp-26 first and falls back
// to draft-ietf-mmusic-sctp-sdp-05
SDPUtils.parseSctpDescription = function(mediaSection) {
  var mline = SDPUtils.parseMLine(mediaSection);
  var maxSizeLine = SDPUtils.matchPrefix(mediaSection, 'a=max-message-size:');
  var maxMessageSize;
  if (maxSizeLine.length > 0) {
    maxMessageSize = parseInt(maxSizeLine[0].substr(19), 10);
  }
  if (isNaN(maxMessageSize)) {
    maxMessageSize = 65536;
  }
  var sctpPort = SDPUtils.matchPrefix(mediaSection, 'a=sctp-port:');
  if (sctpPort.length > 0) {
    return {
      port: parseInt(sctpPort[0].substr(12), 10),
      protocol: mline.fmt,
      maxMessageSize: maxMessageSize
    };
  }
  var sctpMapLines = SDPUtils.matchPrefix(mediaSection, 'a=sctpmap:');
  if (sctpMapLines.length > 0) {
    var parts = SDPUtils.matchPrefix(mediaSection, 'a=sctpmap:')[0]
      .substr(10)
      .split(' ');
    return {
      port: parseInt(parts[0], 10),
      protocol: parts[1],
      maxMessageSize: maxMessageSize
    };
  }
};

// SCTP
// outputs the draft-ietf-mmusic-sctp-sdp-26 version that all browsers
// support by now receiving in this format, unless we originally parsed
// as the draft-ietf-mmusic-sctp-sdp-05 format (indicated by the m-line
// protocol of DTLS/SCTP -- without UDP/ or TCP/)
SDPUtils.writeSctpDescription = function(media, sctp) {
  var output = [];
  if (media.protocol !== 'DTLS/SCTP') {
    output = [
      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.protocol + '\r\n',
      'c=IN IP4 0.0.0.0\r\n',
      'a=sctp-port:' + sctp.port + '\r\n'
    ];
  } else {
    output = [
      'm=' + media.kind + ' 9 ' + media.protocol + ' ' + sctp.port + '\r\n',
      'c=IN IP4 0.0.0.0\r\n',
      'a=sctpmap:' + sctp.port + ' ' + sctp.protocol + ' 65535\r\n'
    ];
  }
  if (sctp.maxMessageSize !== undefined) {
    output.push('a=max-message-size:' + sctp.maxMessageSize + '\r\n');
  }
  return output.join('');
};

// Generate a session ID for SDP.
// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1
// recommends using a cryptographically random +ve 64-bit value
// but right now this should be acceptable and within the right range
SDPUtils.generateSessionId = function() {
  return Math.random().toString().substr(2, 21);
};

// Write boilder plate for start of SDP
// sessId argument is optional - if not supplied it will
// be generated randomly
// sessVersion is optional and defaults to 2
// sessUser is optional and defaults to 'thisisadapterortc'
SDPUtils.writeSessionBoilerplate = function(sessId, sessVer, sessUser) {
  var sessionId;
  var version = sessVer !== undefined ? sessVer : 2;
  if (sessId) {
    sessionId = sessId;
  } else {
    sessionId = SDPUtils.generateSessionId();
  }
  var user = sessUser || 'thisisadapterortc';
  // FIXME: sess-id should be an NTP timestamp.
  return 'v=0\r\n' +
      'o=' + user + ' ' + sessionId + ' ' + version +
        ' IN IP4 127.0.0.1\r\n' +
      's=-\r\n' +
      't=0 0\r\n';
};

SDPUtils.writeMediaSection = function(transceiver, caps, type, stream) {
  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);

  // Map ICE parameters (ufrag, pwd) to SDP.
  sdp += SDPUtils.writeIceParameters(
    transceiver.iceGatherer.getLocalParameters());

  // Map DTLS parameters to SDP.
  sdp += SDPUtils.writeDtlsParameters(
    transceiver.dtlsTransport.getLocalParameters(),
    type === 'offer' ? 'actpass' : 'active');

  sdp += 'a=mid:' + transceiver.mid + '\r\n';

  if (transceiver.direction) {
    sdp += 'a=' + transceiver.direction + '\r\n';
  } else if (transceiver.rtpSender && transceiver.rtpReceiver) {
    sdp += 'a=sendrecv\r\n';
  } else if (transceiver.rtpSender) {
    sdp += 'a=sendonly\r\n';
  } else if (transceiver.rtpReceiver) {
    sdp += 'a=recvonly\r\n';
  } else {
    sdp += 'a=inactive\r\n';
  }

  if (transceiver.rtpSender) {
    // spec.
    var msid = 'msid:' + stream.id + ' ' +
        transceiver.rtpSender.track.id + '\r\n';
    sdp += 'a=' + msid;

    // for Chrome.
    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +
        ' ' + msid;
    if (transceiver.sendEncodingParameters[0].rtx) {
      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +
          ' ' + msid;
      sdp += 'a=ssrc-group:FID ' +
          transceiver.sendEncodingParameters[0].ssrc + ' ' +
          transceiver.sendEncodingParameters[0].rtx.ssrc +
          '\r\n';
    }
  }
  // FIXME: this should be written by writeRtpDescription.
  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +
      ' cname:' + SDPUtils.localCName + '\r\n';
  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {
    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +
        ' cname:' + SDPUtils.localCName + '\r\n';
  }
  return sdp;
};

// Gets the direction from the mediaSection or the sessionpart.
SDPUtils.getDirection = function(mediaSection, sessionpart) {
  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.
  var lines = SDPUtils.splitLines(mediaSection);
  for (var i = 0; i < lines.length; i++) {
    switch (lines[i]) {
      case 'a=sendrecv':
      case 'a=sendonly':
      case 'a=recvonly':
      case 'a=inactive':
        return lines[i].substr(2);
      default:
        // FIXME: What should happen here?
    }
  }
  if (sessionpart) {
    return SDPUtils.getDirection(sessionpart);
  }
  return 'sendrecv';
};

SDPUtils.getKind = function(mediaSection) {
  var lines = SDPUtils.splitLines(mediaSection);
  var mline = lines[0].split(' ');
  return mline[0].substr(2);
};

SDPUtils.isRejected = function(mediaSection) {
  return mediaSection.split(' ', 2)[1] === '0';
};

SDPUtils.parseMLine = function(mediaSection) {
  var lines = SDPUtils.splitLines(mediaSection);
  var parts = lines[0].substr(2).split(' ');
  return {
    kind: parts[0],
    port: parseInt(parts[1], 10),
    protocol: parts[2],
    fmt: parts.slice(3).join(' ')
  };
};

SDPUtils.parseOLine = function(mediaSection) {
  var line = SDPUtils.matchPrefix(mediaSection, 'o=')[0];
  var parts = line.substr(2).split(' ');
  return {
    username: parts[0],
    sessionId: parts[1],
    sessionVersion: parseInt(parts[2], 10),
    netType: parts[3],
    addressType: parts[4],
    address: parts[5]
  };
};

// a very naive interpretation of a valid SDP.
SDPUtils.isValidSDP = function(blob) {
  if (typeof blob !== 'string' || blob.length === 0) {
    return false;
  }
  var lines = SDPUtils.splitLines(blob);
  for (var i = 0; i < lines.length; i++) {
    if (lines[i].length < 2 || lines[i].charAt(1) !== '=') {
      return false;
    }
    // TODO: check the modifier a bit more.
  }
  return true;
};

// Expose public methods.
if (typeof module === 'object') {
  module.exports = SDPUtils;
}

},{}],119:[function(require,module,exports){
/**
 * Convert array of 16 byte values to UUID string format of the form:
 * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX
 */
var byteToHex = [];
for (var i = 0; i < 256; ++i) {
  byteToHex[i] = (i + 0x100).toString(16).substr(1);
}

function bytesToUuid(buf, offset) {
  var i = offset || 0;
  var bth = byteToHex;
  // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4
  return ([
    bth[buf[i++]], bth[buf[i++]],
    bth[buf[i++]], bth[buf[i++]], '-',
    bth[buf[i++]], bth[buf[i++]], '-',
    bth[buf[i++]], bth[buf[i++]], '-',
    bth[buf[i++]], bth[buf[i++]], '-',
    bth[buf[i++]], bth[buf[i++]],
    bth[buf[i++]], bth[buf[i++]],
    bth[buf[i++]], bth[buf[i++]]
  ]).join('');
}

module.exports = bytesToUuid;

},{}],120:[function(require,module,exports){
// Unique ID creation requires a high quality random # generator.  In the
// browser this is a little complicated due to unknown quality of Math.random()
// and inconsistent support for the `crypto` API.  We do the best we can via
// feature-detection

// getRandomValues needs to be invoked in a context where "this" is a Crypto
// implementation. Also, find the complete implementation of crypto on IE11.
var getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto)) ||
                      (typeof(msCrypto) != 'undefined' && typeof window.msCrypto.getRandomValues == 'function' && msCrypto.getRandomValues.bind(msCrypto));

if (getRandomValues) {
  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto
  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef

  module.exports = function whatwgRNG() {
    getRandomValues(rnds8);
    return rnds8;
  };
} else {
  // Math.random()-based (RNG)
  //
  // If all else fails, use Math.random().  It's fast, but is of unspecified
  // quality.
  var rnds = new Array(16);

  module.exports = function mathRNG() {
    for (var i = 0, r; i < 16; i++) {
      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;
      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;
    }

    return rnds;
  };
}

},{}],121:[function(require,module,exports){
var rng = require('./lib/rng');
var bytesToUuid = require('./lib/bytesToUuid');

function v4(options, buf, offset) {
  var i = buf && offset || 0;

  if (typeof(options) == 'string') {
    buf = options === 'binary' ? new Array(16) : null;
    options = null;
  }
  options = options || {};

  var rnds = options.random || (options.rng || rng)();

  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`
  rnds[6] = (rnds[6] & 0x0f) | 0x40;
  rnds[8] = (rnds[8] & 0x3f) | 0x80;

  // Copy bytes to buffer, if provided
  if (buf) {
    for (var ii = 0; ii < 16; ++ii) {
      buf[i + ii] = rnds[ii];
    }
  }

  return buf || bytesToUuid(rnds);
}

module.exports = v4;

},{"./lib/bytesToUuid":119,"./lib/rng":120}],122:[function(require,module,exports){
(function (global){(function (){
/*
 *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.
 *
 *  Use of this source code is governed by a BSD-style license
 *  that can be found in the LICENSE file in the root of the source
 *  tree.
 */
 /* eslint-env node */

'use strict';

var adapterFactory = require('./adapter_factory.js');
module.exports = adapterFactory({window: global.window});

}).call(this)}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./adapter_factory.js":123}],123:[function(require,module,exports){
/*
 *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.
 *
 *  Use of this source code is governed by a BSD-style license
 *  that can be found in the LICENSE file in the root of the source
 *  tree.
 */
 /* eslint-env node */

'use strict';

var utils = require('./utils');
// Shimming starts here.
module.exports = function(dependencies, opts) {
  var window = dependencies && dependencies.window;

  var options = {
    shimChrome: true,
    shimFirefox: true,
    shimEdge: true,
    shimSafari: true,
  };

  for (var key in opts) {
    if (hasOwnProperty.call(opts, key)) {
      options[key] = opts[key];
    }
  }

  // Utils.
  var logging = utils.log;
  var browserDetails = utils.detectBrowser(window);

  // Uncomment the line below if you want logging to occur, including logging
  // for the switch statement below. Can also be turned on in the browser via
  // adapter.disableLog(false), but then logging from the switch statement below
  // will not appear.
  // require('./utils').disableLog(false);

  // Browser shims.
  var chromeShim = require('./chrome/chrome_shim') || null;
  var edgeShim = require('./edge/edge_shim') || null;
  var firefoxShim = require('./firefox/firefox_shim') || null;
  var safariShim = require('./safari/safari_shim') || null;
  var commonShim = require('./common_shim') || null;

  // Export to the adapter global object visible in the browser.
  var adapter = {
    browserDetails: browserDetails,
    commonShim: commonShim,
    extractVersion: utils.extractVersion,
    disableLog: utils.disableLog,
    disableWarnings: utils.disableWarnings
  };

  // Shim browser if found.
  switch (browserDetails.browser) {
    case 'chrome':
      if (!chromeShim || !chromeShim.shimPeerConnection ||
          !options.shimChrome) {
        logging('Chrome shim is not included in this adapter release.');
        return adapter;
      }
      logging('adapter.js shimming chrome.');
      // Export to the adapter global object visible in the browser.
      adapter.browserShim = chromeShim;
      commonShim.shimCreateObjectURL(window);

      chromeShim.shimGetUserMedia(window);
      chromeShim.shimMediaStream(window);
      chromeShim.shimSourceObject(window);
      chromeShim.shimPeerConnection(window);
      chromeShim.shimOnTrack(window);
      chromeShim.shimAddTrackRemoveTrack(window);
      chromeShim.shimGetSendersWithDtmf(window);
      chromeShim.shimSenderReceiverGetStats(window);
      chromeShim.fixNegotiationNeeded(window);

      commonShim.shimRTCIceCandidate(window);
      commonShim.shimMaxMessageSize(window);
      commonShim.shimSendThrowTypeError(window);
      break;
    case 'firefox':
      if (!firefoxShim || !firefoxShim.shimPeerConnection ||
          !options.shimFirefox) {
        logging('Firefox shim is not included in this adapter release.');
        return adapter;
      }
      logging('adapter.js shimming firefox.');
      // Export to the adapter global object visible in the browser.
      adapter.browserShim = firefoxShim;
      commonShim.shimCreateObjectURL(window);

      firefoxShim.shimGetUserMedia(window);
      firefoxShim.shimSourceObject(window);
      firefoxShim.shimPeerConnection(window);
      firefoxShim.shimOnTrack(window);
      firefoxShim.shimRemoveStream(window);
      firefoxShim.shimSenderGetStats(window);
      firefoxShim.shimReceiverGetStats(window);
      firefoxShim.shimRTCDataChannel(window);

      commonShim.shimRTCIceCandidate(window);
      commonShim.shimMaxMessageSize(window);
      commonShim.shimSendThrowTypeError(window);
      break;
    case 'edge':
      if (!edgeShim || !edgeShim.shimPeerConnection || !options.shimEdge) {
        logging('MS edge shim is not included in this adapter release.');
        return adapter;
      }
      logging('adapter.js shimming edge.');
      // Export to the adapter global object visible in the browser.
      adapter.browserShim = edgeShim;
      commonShim.shimCreateObjectURL(window);

      edgeShim.shimGetUserMedia(window);
      edgeShim.shimPeerConnection(window);
      edgeShim.shimReplaceTrack(window);
      edgeShim.shimGetDisplayMedia(window);

      // the edge shim implements the full RTCIceCandidate object.

      commonShim.shimMaxMessageSize(window);
      commonShim.shimSendThrowTypeError(window);
      break;
    case 'safari':
      if (!safariShim || !options.shimSafari) {
        logging('Safari shim is not included in this adapter release.');
        return adapter;
      }
      logging('adapter.js shimming safari.');
      // Export to the adapter global object visible in the browser.
      adapter.browserShim = safariShim;
      commonShim.shimCreateObjectURL(window);

      safariShim.shimRTCIceServerUrls(window);
      safariShim.shimCreateOfferLegacy(window);
      safariShim.shimCallbacksAPI(window);
      safariShim.shimLocalStreamsAPI(window);
      safariShim.shimRemoteStreamsAPI(window);
      safariShim.shimTrackEventTransceiver(window);
      safariShim.shimGetUserMedia(window);

      commonShim.shimRTCIceCandidate(window);
      commonShim.shimMaxMessageSize(window);
      commonShim.shimSendThrowTypeError(window);
      break;
    default:
      logging('Unsupported browser!');
      break;
  }

  return adapter;
};

},{"./chrome/chrome_shim":124,"./common_shim":126,"./edge/edge_shim":127,"./firefox/firefox_shim":130,"./safari/safari_shim":132,"./utils":133}],124:[function(require,module,exports){

/*
 *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.
 *
 *  Use of this source code is governed by a BSD-style license
 *  that can be found in the LICENSE file in the root of the source
 *  tree.
 */
 /* eslint-env node */
'use strict';
var utils = require('../utils.js');
var logging = utils.log;

/* iterates the stats graph recursively. */
function walkStats(stats, base, resultSet) {
  if (!base || resultSet.has(base.id)) {
    return;
  }
  resultSet.set(base.id, base);
  Object.keys(base).forEach(function(name) {
    if (name.endsWith('Id')) {
      walkStats(stats, stats.get(base[name]), resultSet);
    } else if (name.endsWith('Ids')) {
      base[name].forEach(function(id) {
        walkStats(stats, stats.get(id), resultSet);
      });
    }
  });
}

/* filter getStats for a sender/receiver track. */
function filterStats(result, track, outbound) {
  var streamStatsType = outbound ? 'outbound-rtp' : 'inbound-rtp';
  var filteredResult = new Map();
  if (track === null) {
    return filteredResult;
  }
  var trackStats = [];
  result.forEach(function(value) {
    if (value.type === 'track' &&
        value.trackIdentifier === track.id) {
      trackStats.push(value);
    }
  });
  trackStats.forEach(function(trackStat) {
    result.forEach(function(stats) {
      if (stats.type === streamStatsType && stats.trackId === trackStat.id) {
        walkStats(result, stats, filteredResult);
      }
    });
  });
  return filteredResult;
}

module.exports = {
  shimGetUserMedia: require('./getusermedia'),
  shimMediaStream: function(window) {
    window.MediaStream = window.MediaStream || window.webkitMediaStream;
  },

  shimOnTrack: function(window) {
    if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in
        window.RTCPeerConnection.prototype)) {
      Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {
        get: function() {
          return this._ontrack;
        },
        set: function(f) {
          if (this._ontrack) {
            this.removeEventListener('track', this._ontrack);
          }
          this.addEventListener('track', this._ontrack = f);
        },
        enumerable: true,
        configurable: true
      });
      var origSetRemoteDescription =
          window.RTCPeerConnection.prototype.setRemoteDescription;
      window.RTCPeerConnection.prototype.setRemoteDescription = function() {
        var pc = this;
        if (!pc._ontrackpoly) {
          pc._ontrackpoly = function(e) {
            // onaddstream does not fire when a track is added to an existing
            // stream. But stream.onaddtrack is implemented so we use that.
            e.stream.addEventListener('addtrack', function(te) {
              var receiver;
              if (window.RTCPeerConnection.prototype.getReceivers) {
                receiver = pc.getReceivers().find(function(r) {
                  return r.track && r.track.id === te.track.id;
                });
              } else {
                receiver = {track: te.track};
              }

              var event = new Event('track');
              event.track = te.track;
              event.receiver = receiver;
              event.transceiver = {receiver: receiver};
              event.streams = [e.stream];
              pc.dispatchEvent(event);
            });
            e.stream.getTracks().forEach(function(track) {
              var receiver;
              if (window.RTCPeerConnection.prototype.getReceivers) {
                receiver = pc.getReceivers().find(function(r) {
                  return r.track && r.track.id === track.id;
                });
              } else {
                receiver = {track: track};
              }
              var event = new Event('track');
              event.track = track;
              event.receiver = receiver;
              event.transceiver = {receiver: receiver};
              event.streams = [e.stream];
              pc.dispatchEvent(event);
            });
          };
          pc.addEventListener('addstream', pc._ontrackpoly);
        }
        return origSetRemoteDescription.apply(pc, arguments);
      };
    } else {
      // even if RTCRtpTransceiver is in window, it is only used and
      // emitted in unified-plan. Unfortunately this means we need
      // to unconditionally wrap the event.
      utils.wrapPeerConnectionEvent(window, 'track', function(e) {
        if (!e.transceiver) {
          Object.defineProperty(e, 'transceiver',
            {value: {receiver: e.receiver}});
        }
        return e;
      });
    }
  },

  shimGetSendersWithDtmf: function(window) {
    // Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.
    if (typeof window === 'object' && window.RTCPeerConnection &&
        !('getSenders' in window.RTCPeerConnection.prototype) &&
        'createDTMFSender' in window.RTCPeerConnection.prototype) {
      var shimSenderWithDtmf = function(pc, track) {
        return {
          track: track,
          get dtmf() {
            if (this._dtmf === undefined) {
              if (track.kind === 'audio') {
                this._dtmf = pc.createDTMFSender(track);
              } else {
                this._dtmf = null;
              }
            }
            return this._dtmf;
          },
          _pc: pc
        };
      };

      // augment addTrack when getSenders is not available.
      if (!window.RTCPeerConnection.prototype.getSenders) {
        window.RTCPeerConnection.prototype.getSenders = function() {
          this._senders = this._senders || [];
          return this._senders.slice(); // return a copy of the internal state.
        };
        var origAddTrack = window.RTCPeerConnection.prototype.addTrack;
        window.RTCPeerConnection.prototype.addTrack = function(track, stream) {
          var pc = this;
          var sender = origAddTrack.apply(pc, arguments);
          if (!sender) {
            sender = shimSenderWithDtmf(pc, track);
            pc._senders.push(sender);
          }
          return sender;
        };

        var origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;
        window.RTCPeerConnection.prototype.removeTrack = function(sender) {
          var pc = this;
          origRemoveTrack.apply(pc, arguments);
          var idx = pc._senders.indexOf(sender);
          if (idx !== -1) {
            pc._senders.splice(idx, 1);
          }
        };
      }
      var origAddStream = window.RTCPeerConnection.prototype.addStream;
      window.RTCPeerConnection.prototype.addStream = function(stream) {
        var pc = this;
        pc._senders = pc._senders || [];
        origAddStream.apply(pc, [stream]);
        stream.getTracks().forEach(function(track) {
          pc._senders.push(shimSenderWithDtmf(pc, track));
        });
      };

      var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;
      window.RTCPeerConnection.prototype.removeStream = function(stream) {
        var pc = this;
        pc._senders = pc._senders || [];
        origRemoveStream.apply(pc, [stream]);

        stream.getTracks().forEach(function(track) {
          var sender = pc._senders.find(function(s) {
            return s.track === track;
          });
          if (sender) {
            pc._senders.splice(pc._senders.indexOf(sender), 1); // remove sender
          }
        });
      };
    } else if (typeof window === 'object' && window.RTCPeerConnection &&
               'getSenders' in window.RTCPeerConnection.prototype &&
               'createDTMFSender' in window.RTCPeerConnection.prototype &&
               window.RTCRtpSender &&
               !('dtmf' in window.RTCRtpSender.prototype)) {
      var origGetSenders = window.RTCPeerConnection.prototype.getSenders;
      window.RTCPeerConnection.prototype.getSenders = function() {
        var pc = this;
        var senders = origGetSenders.apply(pc, []);
        senders.forEach(function(sender) {
          sender._pc = pc;
        });
        return senders;
      };

      Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {
        get: function() {
          if (this._dtmf === undefined) {
            if (this.track.kind === 'audio') {
              this._dtmf = this._pc.createDTMFSender(this.track);
            } else {
              this._dtmf = null;
            }
          }
          return this._dtmf;
        }
      });
    }
  },

  shimSenderReceiverGetStats: function(window) {
    if (!(typeof window === 'object' && window.RTCPeerConnection &&
        window.RTCRtpSender && window.RTCRtpReceiver)) {
      return;
    }

    // shim sender stats.
    if (!('getStats' in window.RTCRtpSender.prototype)) {
      var origGetSenders = window.RTCPeerConnection.prototype.getSenders;
      if (origGetSenders) {
        window.RTCPeerConnection.prototype.getSenders = function() {
          var pc = this;
          var senders = origGetSenders.apply(pc, []);
          senders.forEach(function(sender) {
            sender._pc = pc;
          });
          return senders;
        };
      }

      var origAddTrack = window.RTCPeerConnection.prototype.addTrack;
      if (origAddTrack) {
        window.RTCPeerConnection.prototype.addTrack = function() {
          var sender = origAddTrack.apply(this, arguments);
          sender._pc = this;
          return sender;
        };
      }
      window.RTCRtpSender.prototype.getStats = function() {
        var sender = this;
        return this._pc.getStats().then(function(result) {
          /* Note: this will include stats of all senders that
           *   send a track with the same id as sender.track as
           *   it is not possible to identify the RTCRtpSender.
           */
          return filterStats(result, sender.track, true);
        });
      };
    }

    // shim receiver stats.
    if (!('getStats' in window.RTCRtpReceiver.prototype)) {
      var origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;
      if (origGetReceivers) {
        window.RTCPeerConnection.prototype.getReceivers = function() {
          var pc = this;
          var receivers = origGetReceivers.apply(pc, []);
          receivers.forEach(function(receiver) {
            receiver._pc = pc;
          });
          return receivers;
        };
      }
      utils.wrapPeerConnectionEvent(window, 'track', function(e) {
        e.receiver._pc = e.srcElement;
        return e;
      });
      window.RTCRtpReceiver.prototype.getStats = function() {
        var receiver = this;
        return this._pc.getStats().then(function(result) {
          return filterStats(result, receiver.track, false);
        });
      };
    }

    if (!('getStats' in window.RTCRtpSender.prototype &&
        'getStats' in window.RTCRtpReceiver.prototype)) {
      return;
    }

    // shim RTCPeerConnection.getStats(track).
    var origGetStats = window.RTCPeerConnection.prototype.getStats;
    window.RTCPeerConnection.prototype.getStats = function() {
      var pc = this;
      if (arguments.length > 0 &&
          arguments[0] instanceof window.MediaStreamTrack) {
        var track = arguments[0];
        var sender;
        var receiver;
        var err;
        pc.getSenders().forEach(function(s) {
          if (s.track === track) {
            if (sender) {
              err = true;
            } else {
              sender = s;
            }
          }
        });
        pc.getReceivers().forEach(function(r) {
          if (r.track === track) {
            if (receiver) {
              err = true;
            } else {
              receiver = r;
            }
          }
          return r.track === track;
        });
        if (err || (sender && receiver)) {
          return Promise.reject(new DOMException(
            'There are more than one sender or receiver for the track.',
            'InvalidAccessError'));
        } else if (sender) {
          return sender.getStats();
        } else if (receiver) {
          return receiver.getStats();
        }
        return Promise.reject(new DOMException(
          'There is no sender or receiver for the track.',
          'InvalidAccessError'));
      }
      return origGetStats.apply(pc, arguments);
    };
  },

  shimSourceObject: function(window) {
    var URL = window && window.URL;

    if (typeof window === 'object') {
      if (window.HTMLMediaElement &&
        !('srcObject' in window.HTMLMediaElement.prototype)) {
        // Shim the srcObject property, once, when HTMLMediaElement is found.
        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {
          get: function() {
            return this._srcObject;
          },
          set: function(stream) {
            var self = this;
            // Use _srcObject as a private property for this shim
            this._srcObject = stream;
            if (this.src) {
              URL.revokeObjectURL(this.src);
            }

            if (!stream) {
              this.src = '';
              return undefined;
            }
            this.src = URL.createObjectURL(stream);
            // We need to recreate the blob url when a track is added or
            // removed. Doing it manually since we want to avoid a recursion.
            stream.addEventListener('addtrack', function() {
              if (self.src) {
                URL.revokeObjectURL(self.src);
              }
              self.src = URL.createObjectURL(stream);
            });
            stream.addEventListener('removetrack', function() {
              if (self.src) {
                URL.revokeObjectURL(self.src);
              }
              self.src = URL.createObjectURL(stream);
            });
          }
        });
      }
    }
  },

  shimAddTrackRemoveTrackWithNative: function(window) {
    // shim addTrack/removeTrack with native variants in order to make
    // the interactions with legacy getLocalStreams behave as in other browsers.
    // Keeps a mapping stream.id => [stream, rtpsenders...]
    window.RTCPeerConnection.prototype.getLocalStreams = function() {
      var pc = this;
      this._shimmedLocalStreams = this._shimmedLocalStreams || {};
      return Object.keys(this._shimmedLocalStreams).map(function(streamId) {
        return pc._shimmedLocalStreams[streamId][0];
      });
    };

    var origAddTrack = window.RTCPeerConnection.prototype.addTrack;
    window.RTCPeerConnection.prototype.addTrack = function(track, stream) {
      if (!stream) {
        return origAddTrack.apply(this, arguments);
      }
      this._shimmedLocalStreams = this._shimmedLocalStreams || {};

      var sender = origAddTrack.apply(this, arguments);
      if (!this._shimmedLocalStreams[stream.id]) {
        this._shimmedLocalStreams[stream.id] = [stream, sender];
      } else if (this._shimmedLocalStreams[stream.id].indexOf(sender) === -1) {
        this._shimmedLocalStreams[stream.id].push(sender);
      }
      return sender;
    };

    var origAddStream = window.RTCPeerConnection.prototype.addStream;
    window.RTCPeerConnection.prototype.addStream = function(stream) {
      var pc = this;
      this._shimmedLocalStreams = this._shimmedLocalStreams || {};

      stream.getTracks().forEach(function(track) {
        var alreadyExists = pc.getSenders().find(function(s) {
          return s.track === track;
        });
        if (alreadyExists) {
          throw new DOMException('Track already exists.',
              'InvalidAccessError');
        }
      });
      var existingSenders = pc.getSenders();
      origAddStream.apply(this, arguments);
      var newSenders = pc.getSenders().filter(function(newSender) {
        return existingSenders.indexOf(newSender) === -1;
      });
      this._shimmedLocalStreams[stream.id] = [stream].concat(newSenders);
    };

    var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;
    window.RTCPeerConnection.prototype.removeStream = function(stream) {
      this._shimmedLocalStreams = this._shimmedLocalStreams || {};
      delete this._shimmedLocalStreams[stream.id];
      return origRemoveStream.apply(this, arguments);
    };

    var origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;
    window.RTCPeerConnection.prototype.removeTrack = function(sender) {
      var pc = this;
      this._shimmedLocalStreams = this._shimmedLocalStreams || {};
      if (sender) {
        Object.keys(this._shimmedLocalStreams).forEach(function(streamId) {
          var idx = pc._shimmedLocalStreams[streamId].indexOf(sender);
          if (idx !== -1) {
            pc._shimmedLocalStreams[streamId].splice(idx, 1);
          }
          if (pc._shimmedLocalStreams[streamId].length === 1) {
            delete pc._shimmedLocalStreams[streamId];
          }
        });
      }
      return origRemoveTrack.apply(this, arguments);
    };
  },

  shimAddTrackRemoveTrack: function(window) {
    if (!window.RTCPeerConnection) {
      return;
    }
    var browserDetails = utils.detectBrowser(window);
    // shim addTrack and removeTrack.
    if (window.RTCPeerConnection.prototype.addTrack &&
        browserDetails.version >= 65) {
      return this.shimAddTrackRemoveTrackWithNative(window);
    }

    // also shim pc.getLocalStreams when addTrack is shimmed
    // to return the original streams.
    var origGetLocalStreams = window.RTCPeerConnection.prototype
        .getLocalStreams;
    window.RTCPeerConnection.prototype.getLocalStreams = function() {
      var pc = this;
      var nativeStreams = origGetLocalStreams.apply(this);
      pc._reverseStreams = pc._reverseStreams || {};
      return nativeStreams.map(function(stream) {
        return pc._reverseStreams[stream.id];
      });
    };

    var origAddStream = window.RTCPeerConnection.prototype.addStream;
    window.RTCPeerConnection.prototype.addStream = function(stream) {
      var pc = this;
      pc._streams = pc._streams || {};
      pc._reverseStreams = pc._reverseStreams || {};

      stream.getTracks().forEach(function(track) {
        var alreadyExists = pc.getSenders().find(function(s) {
          return s.track === track;
        });
        if (alreadyExists) {
          throw new DOMException('Track already exists.',
              'InvalidAccessError');
        }
      });
      // Add identity mapping for consistency with addTrack.
      // Unless this is being used with a stream from addTrack.
      if (!pc._reverseStreams[stream.id]) {
        var newStream = new window.MediaStream(stream.getTracks());
        pc._streams[stream.id] = newStream;
        pc._reverseStreams[newStream.id] = stream;
        stream = newStream;
      }
      origAddStream.apply(pc, [stream]);
    };

    var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;
    window.RTCPeerConnection.prototype.removeStream = function(stream) {
      var pc = this;
      pc._streams = pc._streams || {};
      pc._reverseStreams = pc._reverseStreams || {};

      origRemoveStream.apply(pc, [(pc._streams[stream.id] || stream)]);
      delete pc._reverseStreams[(pc._streams[stream.id] ?
          pc._streams[stream.id].id : stream.id)];
      delete pc._streams[stream.id];
    };

    window.RTCPeerConnection.prototype.addTrack = function(track, stream) {
      var pc = this;
      if (pc.signalingState === 'closed') {
        throw new DOMException(
          'The RTCPeerConnection\'s signalingState is \'closed\'.',
          'InvalidStateError');
      }
      var streams = [].slice.call(arguments, 1);
      if (streams.length !== 1 ||
          !streams[0].getTracks().find(function(t) {
            return t === track;
          })) {
        // this is not fully correct but all we can manage without
        // [[associated MediaStreams]] internal slot.
        throw new DOMException(
          'The adapter.js addTrack polyfill only supports a single ' +
          ' stream which is associated with the specified track.',
          'NotSupportedError');
      }

      var alreadyExists = pc.getSenders().find(function(s) {
        return s.track === track;
      });
      if (alreadyExists) {
        throw new DOMException('Track already exists.',
            'InvalidAccessError');
      }

      pc._streams = pc._streams || {};
      pc._reverseStreams = pc._reverseStreams || {};
      var oldStream = pc._streams[stream.id];
      if (oldStream) {
        // this is using odd Chrome behaviour, use with caution:
        // https://bugs.chromium.org/p/webrtc/issues/detail?id=7815
        // Note: we rely on the high-level addTrack/dtmf shim to
        // create the sender with a dtmf sender.
        oldStream.addTrack(track);

        // Trigger ONN async.
        Promise.resolve().then(function() {
          pc.dispatchEvent(new Event('negotiationneeded'));
        });
      } else {
        var newStream = new window.MediaStream([track]);
        pc._streams[stream.id] = newStream;
        pc._reverseStreams[newStream.id] = stream;
        pc.addStream(newStream);
      }
      return pc.getSenders().find(function(s) {
        return s.track === track;
      });
    };

    // replace the internal stream id with the external one and
    // vice versa.
    function replaceInternalStreamId(pc, description) {
      var sdp = description.sdp;
      Object.keys(pc._reverseStreams || []).forEach(function(internalId) {
        var externalStream = pc._reverseStreams[internalId];
        var internalStream = pc._streams[externalStream.id];
        sdp = sdp.replace(new RegExp(internalStream.id, 'g'),
            externalStream.id);
      });
      return new RTCSessionDescription({
        type: description.type,
        sdp: sdp
      });
    }
    function replaceExternalStreamId(pc, description) {
      var sdp = description.sdp;
      Object.keys(pc._reverseStreams || []).forEach(function(internalId) {
        var externalStream = pc._reverseStreams[internalId];
        var internalStream = pc._streams[externalStream.id];
        sdp = sdp.replace(new RegExp(externalStream.id, 'g'),
            internalStream.id);
      });
      return new RTCSessionDescription({
        type: description.type,
        sdp: sdp
      });
    }
    ['createOffer', 'createAnswer'].forEach(function(method) {
      var nativeMethod = window.RTCPeerConnection.prototype[method];
      window.RTCPeerConnection.prototype[method] = function() {
        var pc = this;
        var args = arguments;
        var isLegacyCall = arguments.length &&
            typeof arguments[0] === 'function';
        if (isLegacyCall) {
          return nativeMethod.apply(pc, [
            function(description) {
              var desc = replaceInternalStreamId(pc, description);
              args[0].apply(null, [desc]);
            },
            function(err) {
              if (args[1]) {
                args[1].apply(null, err);
              }
            }, arguments[2]
          ]);
        }
        return nativeMethod.apply(pc, arguments)
        .then(function(description) {
          return replaceInternalStreamId(pc, description);
        });
      };
    });

    var origSetLocalDescription =
        window.RTCPeerConnection.prototype.setLocalDescription;
    window.RTCPeerConnection.prototype.setLocalDescription = function() {
      var pc = this;
      if (!arguments.length || !arguments[0].type) {
        return origSetLocalDescription.apply(pc, arguments);
      }
      arguments[0] = replaceExternalStreamId(pc, arguments[0]);
      return origSetLocalDescription.apply(pc, arguments);
    };

    // TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier

    var origLocalDescription = Object.getOwnPropertyDescriptor(
        window.RTCPeerConnection.prototype, 'localDescription');
    Object.defineProperty(window.RTCPeerConnection.prototype,
        'localDescription', {
          get: function() {
            var pc = this;
            var description = origLocalDescription.get.apply(this);
            if (description.type === '') {
              return description;
            }
            return replaceInternalStreamId(pc, description);
          }
        });

    window.RTCPeerConnection.prototype.removeTrack = function(sender) {
      var pc = this;
      if (pc.signalingState === 'closed') {
        throw new DOMException(
          'The RTCPeerConnection\'s signalingState is \'closed\'.',
          'InvalidStateError');
      }
      // We can not yet check for sender instanceof RTCRtpSender
      // since we shim RTPSender. So we check if sender._pc is set.
      if (!sender._pc) {
        throw new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' +
            'does not implement interface RTCRtpSender.', 'TypeError');
      }
      var isLocal = sender._pc === pc;
      if (!isLocal) {
        throw new DOMException('Sender was not created by this connection.',
            'InvalidAccessError');
      }

      // Search for the native stream the senders track belongs to.
      pc._streams = pc._streams || {};
      var stream;
      Object.keys(pc._streams).forEach(function(streamid) {
        var hasTrack = pc._streams[streamid].getTracks().find(function(track) {
          return sender.track === track;
        });
        if (hasTrack) {
          stream = pc._streams[streamid];
        }
      });

      if (stream) {
        if (stream.getTracks().length === 1) {
          // if this is the last track of the stream, remove the stream. This
          // takes care of any shimmed _senders.
          pc.removeStream(pc._reverseStreams[stream.id]);
        } else {
          // relying on the same odd chrome behaviour as above.
          stream.removeTrack(sender.track);
        }
        pc.dispatchEvent(new Event('negotiationneeded'));
      }
    };
  },

  shimPeerConnection: function(window) {
    var browserDetails = utils.detectBrowser(window);

    // The RTCPeerConnection object.
    if (!window.RTCPeerConnection && window.webkitRTCPeerConnection) {
      window.RTCPeerConnection = function(pcConfig, pcConstraints) {
        // Translate iceTransportPolicy to iceTransports,
        // see https://code.google.com/p/webrtc/issues/detail?id=4869
        // this was fixed in M56 along with unprefixing RTCPeerConnection.
        logging('PeerConnection');
        if (pcConfig && pcConfig.iceTransportPolicy) {
          pcConfig.iceTransports = pcConfig.iceTransportPolicy;
        }

        return new window.webkitRTCPeerConnection(pcConfig, pcConstraints);
      };
      window.RTCPeerConnection.prototype =
          window.webkitRTCPeerConnection.prototype;
      // wrap static methods. Currently just generateCertificate.
      if (window.webkitRTCPeerConnection.generateCertificate) {
        Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {
          get: function() {
            return window.webkitRTCPeerConnection.generateCertificate;
          }
        });
      }
    }
    if (!window.RTCPeerConnection) {
      return;
    }

    var origGetStats = window.RTCPeerConnection.prototype.getStats;
    window.RTCPeerConnection.prototype.getStats = function(selector,
        successCallback, errorCallback) {
      var pc = this;
      var args = arguments;

      // If selector is a function then we are in the old style stats so just
      // pass back the original getStats format to avoid breaking old users.
      if (arguments.length > 0 && typeof selector === 'function') {
        return origGetStats.apply(this, arguments);
      }

      // When spec-style getStats is supported, return those when called with
      // either no arguments or the selector argument is null.
      if (origGetStats.length === 0 && (arguments.length === 0 ||
          typeof arguments[0] !== 'function')) {
        return origGetStats.apply(this, []);
      }

      var fixChromeStats_ = function(response) {
        var standardReport = {};
        var reports = response.result();
        reports.forEach(function(report) {
          var standardStats = {
            id: report.id,
            timestamp: report.timestamp,
            type: {
              localcandidate: 'local-candidate',
              remotecandidate: 'remote-candidate'
            }[report.type] || report.type
          };
          report.names().forEach(function(name) {
            standardStats[name] = report.stat(name);
          });
          standardReport[standardStats.id] = standardStats;
        });

        return standardReport;
      };

      // shim getStats with maplike support
      var makeMapStats = function(stats) {
        return new Map(Object.keys(stats).map(function(key) {
          return [key, stats[key]];
        }));
      };

      if (arguments.length >= 2) {
        var successCallbackWrapper_ = function(response) {
          args[1](makeMapStats(fixChromeStats_(response)));
        };

        return origGetStats.apply(this, [successCallbackWrapper_,
          arguments[0]]);
      }

      // promise-support
      return new Promise(function(resolve, reject) {
        origGetStats.apply(pc, [
          function(response) {
            resolve(makeMapStats(fixChromeStats_(response)));
          }, reject]);
      }).then(successCallback, errorCallback);
    };

    // add promise support -- natively available in Chrome 51
    if (browserDetails.version < 51) {
      ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']
          .forEach(function(method) {
            var nativeMethod = window.RTCPeerConnection.prototype[method];
            window.RTCPeerConnection.prototype[method] = function() {
              var args = arguments;
              var pc = this;
              var promise = new Promise(function(resolve, reject) {
                nativeMethod.apply(pc, [args[0], resolve, reject]);
              });
              if (args.length < 2) {
                return promise;
              }
              return promise.then(function() {
                args[1].apply(null, []);
              },
              function(err) {
                if (args.length >= 3) {
                  args[2].apply(null, [err]);
                }
              });
            };
          });
    }

    // promise support for createOffer and createAnswer. Available (without
    // bugs) since M52: crbug/619289
    if (browserDetails.version < 52) {
      ['createOffer', 'createAnswer'].forEach(function(method) {
        var nativeMethod = window.RTCPeerConnection.prototype[method];
        window.RTCPeerConnection.prototype[method] = function() {
          var pc = this;
          if (arguments.length < 1 || (arguments.length === 1 &&
              typeof arguments[0] === 'object')) {
            var opts = arguments.length === 1 ? arguments[0] : undefined;
            return new Promise(function(resolve, reject) {
              nativeMethod.apply(pc, [resolve, reject, opts]);
            });
          }
          return nativeMethod.apply(this, arguments);
        };
      });
    }

    // shim implicit creation of RTCSessionDescription/RTCIceCandidate
    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']
        .forEach(function(method) {
          var nativeMethod = window.RTCPeerConnection.prototype[method];
          window.RTCPeerConnection.prototype[method] = function() {
            arguments[0] = new ((method === 'addIceCandidate') ?
                window.RTCIceCandidate :
                window.RTCSessionDescription)(arguments[0]);
            return nativeMethod.apply(this, arguments);
          };
        });

    // support for addIceCandidate(null or undefined)
    var nativeAddIceCandidate =
        window.RTCPeerConnection.prototype.addIceCandidate;
    window.RTCPeerConnection.prototype.addIceCandidate = function() {
      if (!arguments[0]) {
        if (arguments[1]) {
          arguments[1].apply(null);
        }
        return Promise.resolve();
      }
      return nativeAddIceCandidate.apply(this, arguments);
    };
  },

  fixNegotiationNeeded: function(window) {
    utils.wrapPeerConnectionEvent(window, 'negotiationneeded', function(e) {
      var pc = e.target;
      if (pc.signalingState !== 'stable') {
        return;
      }
      return e;
    });
  },

  shimGetDisplayMedia: function(window, getSourceId) {
    if (!window.navigator || !window.navigator.mediaDevices ||
        'getDisplayMedia' in window.navigator.mediaDevices) {
      return;
    }
    // getSourceId is a function that returns a promise resolving with
    // the sourceId of the screen/window/tab to be shared.
    if (typeof getSourceId !== 'function') {
      console.error('shimGetDisplayMedia: getSourceId argument is not ' +
          'a function');
      return;
    }
    window.navigator.mediaDevices.getDisplayMedia = function(constraints) {
      return getSourceId(constraints)
        .then(function(sourceId) {
          var widthSpecified = constraints.video && constraints.video.width;
          var heightSpecified = constraints.video && constraints.video.height;
          var frameRateSpecified = constraints.video &&
            constraints.video.frameRate;
          constraints.video = {
            mandatory: {
              chromeMediaSource: 'desktop',
              chromeMediaSourceId: sourceId,
              maxFrameRate: frameRateSpecified || 3
            }
          };
          if (widthSpecified) {
            constraints.video.mandatory.maxWidth = widthSpecified;
          }
          if (heightSpecified) {
            constraints.video.mandatory.maxHeight = heightSpecified;
          }
          return window.navigator.mediaDevices.getUserMedia(constraints);
        });
    };
    window.navigator.getDisplayMedia = function(constraints) {
      utils.deprecated('navigator.getDisplayMedia',
          'navigator.mediaDevices.getDisplayMedia');
      return window.navigator.mediaDevices.getDisplayMedia(constraints);
    };
  }
};

},{"../utils.js":133,"./getusermedia":125}],125:[function(require,module,exports){
/*
 *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.
 *
 *  Use of this source code is governed by a BSD-style license
 *  that can be found in the LICENSE file in the root of the source
 *  tree.
 */
 /* eslint-env node */
'use strict';
var utils = require('../utils.js');
var logging = utils.log;

// Expose public methods.
module.exports = function(window) {
  var browserDetails = utils.detectBrowser(window);
  var navigator = window && window.navigator;

  var constraintsToChrome_ = function(c) {
    if (typeof c !== 'object' || c.mandatory || c.optional) {
      return c;
    }
    var cc = {};
    Object.keys(c).forEach(function(key) {
      if (key === 'require' || key === 'advanced' || key === 'mediaSource') {
        return;
      }
      var r = (typeof c[key] === 'object') ? c[key] : {ideal: c[key]};
      if (r.exact !== undefined && typeof r.exact === 'number') {
        r.min = r.max = r.exact;
      }
      var oldname_ = function(prefix, name) {
        if (prefix) {
          return prefix + name.charAt(0).toUpperCase() + name.slice(1);
        }
        return (name === 'deviceId') ? 'sourceId' : name;
      };
      if (r.ideal !== undefined) {
        cc.optional = cc.optional || [];
        var oc = {};
        if (typeof r.ideal === 'number') {
          oc[oldname_('min', key)] = r.ideal;
          cc.optional.push(oc);
          oc = {};
          oc[oldname_('max', key)] = r.ideal;
          cc.optional.push(oc);
        } else {
          oc[oldname_('', key)] = r.ideal;
          cc.optional.push(oc);
        }
      }
      if (r.exact !== undefined && typeof r.exact !== 'number') {
        cc.mandatory = cc.mandatory || {};
        cc.mandatory[oldname_('', key)] = r.exact;
      } else {
        ['min', 'max'].forEach(function(mix) {
          if (r[mix] !== undefined) {
            cc.mandatory = cc.mandatory || {};
            cc.mandatory[oldname_(mix, key)] = r[mix];
          }
        });
      }
    });
    if (c.advanced) {
      cc.optional = (cc.optional || []).concat(c.advanced);
    }
    return cc;
  };

  var shimConstraints_ = function(constraints, func) {
    if (browserDetails.version >= 61) {
      return func(constraints);
    }
    constraints = JSON.parse(JSON.stringify(constraints));
    if (constraints && typeof constraints.audio === 'object') {
      var remap = function(obj, a, b) {
        if (a in obj && !(b in obj)) {
          obj[b] = obj[a];
          delete obj[a];
        }
      };
      constraints = JSON.parse(JSON.stringify(constraints));
      remap(constraints.audio, 'autoGainControl', 'googAutoGainControl');
      remap(constraints.audio, 'noiseSuppression', 'googNoiseSuppression');
      constraints.audio = constraintsToChrome_(constraints.audio);
    }
    if (constraints && typeof constraints.video === 'object') {
      // Shim facingMode for mobile & surface pro.
      var face = constraints.video.facingMode;
      face = face && ((typeof face === 'object') ? face : {ideal: face});
      var getSupportedFacingModeLies = browserDetails.version < 66;

      if ((face && (face.exact === 'user' || face.exact === 'environment' ||
                    face.ideal === 'user' || face.ideal === 'environment')) &&
          !(navigator.mediaDevices.getSupportedConstraints &&
            navigator.mediaDevices.getSupportedConstraints().facingMode &&
            !getSupportedFacingModeLies)) {
        delete constraints.video.facingMode;
        var matches;
        if (face.exact === 'environment' || face.ideal === 'environment') {
          matches = ['back', 'rear'];
        } else if (face.exact === 'user' || face.ideal === 'user') {
          matches = ['front'];
        }
        if (matches) {
          // Look for matches in label, or use last cam for back (typical).
          return navigator.mediaDevices.enumerateDevices()
          .then(function(devices) {
            devices = devices.filter(function(d) {
              return d.kind === 'videoinput';
            });
            var dev = devices.find(function(d) {
              return matches.some(function(match) {
                return d.label.toLowerCase().indexOf(match) !== -1;
              });
            });
            if (!dev && devices.length && matches.indexOf('back') !== -1) {
              dev = devices[devices.length - 1]; // more likely the back cam
            }
            if (dev) {
              constraints.video.deviceId = face.exact ? {exact: dev.deviceId} :
                                                        {ideal: dev.deviceId};
            }
            constraints.video = constraintsToChrome_(constraints.video);
            logging('chrome: ' + JSON.stringify(constraints));
            return func(constraints);
          });
        }
      }
      constraints.video = constraintsToChrome_(constraints.video);
    }
    logging('chrome: ' + JSON.stringify(constraints));
    return func(constraints);
  };

  var shimError_ = function(e) {
    if (browserDetails.version >= 64) {
      return e;
    }
    return {
      name: {
        PermissionDeniedError: 'NotAllowedError',
        PermissionDismissedError: 'NotAllowedError',
        InvalidStateError: 'NotAllowedError',
        DevicesNotFoundError: 'NotFoundError',
        ConstraintNotSatisfiedError: 'OverconstrainedError',
        TrackStartError: 'NotReadableError',
        MediaDeviceFailedDueToShutdown: 'NotAllowedError',
        MediaDeviceKillSwitchOn: 'NotAllowedError',
        TabCaptureError: 'AbortError',
        ScreenCaptureError: 'AbortError',
        DeviceCaptureError: 'AbortError'
      }[e.name] || e.name,
      message: e.message,
      constraint: e.constraint || e.constraintName,
      toString: function() {
        return this.name + (this.message && ': ') + this.message;
      }
    };
  };

  var getUserMedia_ = function(constraints, onSuccess, onError) {
    shimConstraints_(constraints, function(c) {
      navigator.webkitGetUserMedia(c, onSuccess, function(e) {
        if (onError) {
          onError(shimError_(e));
        }
      });
    });
  };

  navigator.getUserMedia = getUserMedia_;

  // Returns the result of getUserMedia as a Promise.
  var getUserMediaPromise_ = function(constraints) {
    return new Promise(function(resolve, reject) {
      navigator.getUserMedia(constraints, resolve, reject);
    });
  };

  if (!navigator.mediaDevices) {
    navigator.mediaDevices = {
      getUserMedia: getUserMediaPromise_,
      enumerateDevices: function() {
        return new Promise(function(resolve) {
          var kinds = {audio: 'audioinput', video: 'videoinput'};
          return window.MediaStreamTrack.getSources(function(devices) {
            resolve(devices.map(function(device) {
              return {label: device.label,
                kind: kinds[device.kind],
                deviceId: device.id,
                groupId: ''};
            }));
          });
        });
      },
      getSupportedConstraints: function() {
        return {
          deviceId: true, echoCancellation: true, facingMode: true,
          frameRate: true, height: true, width: true
        };
      }
    };
  }

  // A shim for getUserMedia method on the mediaDevices object.
  // TODO(KaptenJansson) remove once implemented in Chrome stable.
  if (!navigator.mediaDevices.getUserMedia) {
    navigator.mediaDevices.getUserMedia = function(constraints) {
      return getUserMediaPromise_(constraints);
    };
  } else {
    // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia
    // function which returns a Promise, it does not accept spec-style
    // constraints.
    var origGetUserMedia = navigator.mediaDevices.getUserMedia.
        bind(navigator.mediaDevices);
    navigator.mediaDevices.getUserMedia = function(cs) {
      return shimConstraints_(cs, function(c) {
        return origGetUserMedia(c).then(function(stream) {
          if (c.audio && !stream.getAudioTracks().length ||
              c.video && !stream.getVideoTracks().length) {
            stream.getTracks().forEach(function(track) {
              track.stop();
            });
            throw new DOMException('', 'NotFoundError');
          }
          return stream;
        }, function(e) {
          return Promise.reject(shimError_(e));
        });
      });
    };
  }

  // Dummy devicechange event methods.
  // TODO(KaptenJansson) remove once implemented in Chrome stable.
  if (typeof navigator.mediaDevices.addEventListener === 'undefined') {
    navigator.mediaDevices.addEventListener = function() {
      logging('Dummy mediaDevices.addEventListener called.');
    };
  }
  if (typeof navigator.mediaDevices.removeEventListener === 'undefined') {
    navigator.mediaDevices.removeEventListener = function() {
      logging('Dummy mediaDevices.removeEventListener called.');
    };
  }
};

},{"../utils.js":133}],126:[function(require,module,exports){
/*
 *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.
 *
 *  Use of this source code is governed by a BSD-style license
 *  that can be found in the LICENSE file in the root of the source
 *  tree.
 */
 /* eslint-env node */
'use strict';

var SDPUtils = require('sdp');
var utils = require('./utils');

module.exports = {
  shimRTCIceCandidate: function(window) {
    // foundation is arbitrarily chosen as an indicator for full support for
    // https://w3c.github.io/webrtc-pc/#rtcicecandidate-interface
    if (!window.RTCIceCandidate || (window.RTCIceCandidate && 'foundation' in
        window.RTCIceCandidate.prototype)) {
      return;
    }

    var NativeRTCIceCandidate = window.RTCIceCandidate;
    window.RTCIceCandidate = function(args) {
      // Remove the a= which shouldn't be part of the candidate string.
      if (typeof args === 'object' && args.candidate &&
          args.candidate.indexOf('a=') === 0) {
        args = JSON.parse(JSON.stringify(args));
        args.candidate = args.candidate.substr(2);
      }

      if (args.candidate && args.candidate.length) {
        // Augment the native candidate with the parsed fields.
        var nativeCandidate = new NativeRTCIceCandidate(args);
        var parsedCandidate = SDPUtils.parseCandidate(args.candidate);
        var augmentedCandidate = Object.assign(nativeCandidate,
            parsedCandidate);

        // Add a serializer that does not serialize the extra attributes.
        augmentedCandidate.toJSON = function() {
          return {
            candidate: augmentedCandidate.candidate,
            sdpMid: augmentedCandidate.sdpMid,
            sdpMLineIndex: augmentedCandidate.sdpMLineIndex,
            usernameFragment: augmentedCandidate.usernameFragment,
          };
        };
        return augmentedCandidate;
      }
      return new NativeRTCIceCandidate(args);
    };
    window.RTCIceCandidate.prototype = NativeRTCIceCandidate.prototype;

    // Hook up the augmented candidate in onicecandidate and
    // addEventListener('icecandidate', ...)
    utils.wrapPeerConnectionEvent(window, 'icecandidate', function(e) {
      if (e.candidate) {
        Object.defineProperty(e, 'candidate', {
          value: new window.RTCIceCandidate(e.candidate),
          writable: 'false'
        });
      }
      return e;
    });
  },

  // shimCreateObjectURL must be called before shimSourceObject to avoid loop.

  shimCreateObjectURL: function(window) {
    var URL = window && window.URL;

    if (!(typeof window === 'object' && window.HTMLMediaElement &&
          'srcObject' in window.HTMLMediaElement.prototype &&
        URL.createObjectURL && URL.revokeObjectURL)) {
      // Only shim CreateObjectURL using srcObject if srcObject exists.
      return undefined;
    }

    var nativeCreateObjectURL = URL.createObjectURL.bind(URL);
    var nativeRevokeObjectURL = URL.revokeObjectURL.bind(URL);
    var streams = new Map(), newId = 0;

    URL.createObjectURL = function(stream) {
      if ('getTracks' in stream) {
        var url = 'polyblob:' + (++newId);
        streams.set(url, stream);
        utils.deprecated('URL.createObjectURL(stream)',
            'elem.srcObject = stream');
        return url;
      }
      return nativeCreateObjectURL(stream);
    };
    URL.revokeObjectURL = function(url) {
      nativeRevokeObjectURL(url);
      streams.delete(url);
    };

    var dsc = Object.getOwnPropertyDescriptor(window.HTMLMediaElement.prototype,
                                              'src');
    Object.defineProperty(window.HTMLMediaElement.prototype, 'src', {
      get: function() {
        return dsc.get.apply(this);
      },
      set: function(url) {
        this.srcObject = streams.get(url) || null;
        return dsc.set.apply(this, [url]);
      }
    });

    var nativeSetAttribute = window.HTMLMediaElement.prototype.setAttribute;
    window.HTMLMediaElement.prototype.setAttribute = function() {
      if (arguments.length === 2 &&
          ('' + arguments[0]).toLowerCase() === 'src') {
        this.srcObject = streams.get(arguments[1]) || null;
      }
      return nativeSetAttribute.apply(this, arguments);
    };
  },

  shimMaxMessageSize: function(window) {
    if (window.RTCSctpTransport || !window.RTCPeerConnection) {
      return;
    }
    var browserDetails = utils.detectBrowser(window);

    if (!('sctp' in window.RTCPeerConnection.prototype)) {
      Object.defineProperty(window.RTCPeerConnection.prototype, 'sctp', {
        get: function() {
          return typeof this._sctp === 'undefined' ? null : this._sctp;
        }
      });
    }

    var sctpInDescription = function(description) {
      var sections = SDPUtils.splitSections(description.sdp);
      sections.shift();
      return sections.some(function(mediaSection) {
        var mLine = SDPUtils.parseMLine(mediaSection);
        return mLine && mLine.kind === 'application'
            && mLine.protocol.indexOf('SCTP') !== -1;
      });
    };

    var getRemoteFirefoxVersion = function(description) {
      // TODO: Is there a better solution for detecting Firefox?
      var match = description.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);
      if (match === null || match.length < 2) {
        return -1;
      }
      var version = parseInt(match[1], 10);
      // Test for NaN (yes, this is ugly)
      return version !== version ? -1 : version;
    };

    var getCanSendMaxMessageSize = function(remoteIsFirefox) {
      // Every implementation we know can send at least 64 KiB.
      // Note: Although Chrome is technically able to send up to 256 KiB, the
      //       data does not reach the other peer reliably.
      //       See: https://bugs.chromium.org/p/webrtc/issues/detail?id=8419
      var canSendMaxMessageSize = 65536;
      if (browserDetails.browser === 'firefox') {
        if (browserDetails.version < 57) {
          if (remoteIsFirefox === -1) {
            // FF < 57 will send in 16 KiB chunks using the deprecated PPID
            // fragmentation.
            canSendMaxMessageSize = 16384;
          } else {
            // However, other FF (and RAWRTC) can reassemble PPID-fragmented
            // messages. Thus, supporting ~2 GiB when sending.
            canSendMaxMessageSize = 2147483637;
          }
        } else if (browserDetails.version < 60) {
          // Currently, all FF >= 57 will reset the remote maximum message size
          // to the default value when a data channel is created at a later
          // stage. :(
          // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831
          canSendMaxMessageSize =
            browserDetails.version === 57 ? 65535 : 65536;
        } else {
          // FF >= 60 supports sending ~2 GiB
          canSendMaxMessageSize = 2147483637;
        }
      }
      return canSendMaxMessageSize;
    };

    var getMaxMessageSize = function(description, remoteIsFirefox) {
      // Note: 65536 bytes is the default value from the SDP spec. Also,
      //       every implementation we know supports receiving 65536 bytes.
      var maxMessageSize = 65536;

      // FF 57 has a slightly incorrect default remote max message size, so
      // we need to adjust it here to avoid a failure when sending.
      // See: https://bugzilla.mozilla.org/show_bug.cgi?id=1425697
      if (browserDetails.browser === 'firefox'
           && browserDetails.version === 57) {
        maxMessageSize = 65535;
      }

      var match = SDPUtils.matchPrefix(description.sdp, 'a=max-message-size:');
      if (match.length > 0) {
        maxMessageSize = parseInt(match[0].substr(19), 10);
      } else if (browserDetails.browser === 'firefox' &&
                  remoteIsFirefox !== -1) {
        // If the maximum message size is not present in the remote SDP and
        // both local and remote are Firefox, the remote peer can receive
        // ~2 GiB.
        maxMessageSize = 2147483637;
      }
      return maxMessageSize;
    };

    var origSetRemoteDescription =
        window.RTCPeerConnection.prototype.setRemoteDescription;
    window.RTCPeerConnection.prototype.setRemoteDescription = function() {
      var pc = this;
      pc._sctp = null;

      if (sctpInDescription(arguments[0])) {
        // Check if the remote is FF.
        var isFirefox = getRemoteFirefoxVersion(arguments[0]);

        // Get the maximum message size the local peer is capable of sending
        var canSendMMS = getCanSendMaxMessageSize(isFirefox);

        // Get the maximum message size of the remote peer.
        var remoteMMS = getMaxMessageSize(arguments[0], isFirefox);

        // Determine final maximum message size
        var maxMessageSize;
        if (canSendMMS === 0 && remoteMMS === 0) {
          maxMessageSize = Number.POSITIVE_INFINITY;
        } else if (canSendMMS === 0 || remoteMMS === 0) {
          maxMessageSize = Math.max(canSendMMS, remoteMMS);
        } else {
          maxMessageSize = Math.min(canSendMMS, remoteMMS);
        }

        // Create a dummy RTCSctpTransport object and the 'maxMessageSize'
        // attribute.
        var sctp = {};
        Object.defineProperty(sctp, 'maxMessageSize', {
          get: function() {
            return maxMessageSize;
          }
        });
        pc._sctp = sctp;
      }

      return origSetRemoteDescription.apply(pc, arguments);
    };
  },

  shimSendThrowTypeError: function(window) {
    if (!(window.RTCPeerConnection &&
        'createDataChannel' in window.RTCPeerConnection.prototype)) {
      return;
    }

    // Note: Although Firefox >= 57 has a native implementation, the maximum
    //       message size can be reset for all data channels at a later stage.
    //       See: https://bugzilla.mozilla.org/show_bug.cgi?id=1426831

    function wrapDcSend(dc, pc) {
      var origDataChannelSend = dc.send;
      dc.send = function() {
        var data = arguments[0];
        var length = data.length || data.size || data.byteLength;
        if (dc.readyState === 'open' &&
            pc.sctp && length > pc.sctp.maxMessageSize) {
          throw new TypeError('Message too large (can send a maximum of ' +
            pc.sctp.maxMessageSize + ' bytes)');
        }
        return origDataChannelSend.apply(dc, arguments);
      };
    }
    var origCreateDataChannel =
      window.RTCPeerConnection.prototype.createDataChannel;
    window.RTCPeerConnection.prototype.createDataChannel = function() {
      var pc = this;
      var dataChannel = origCreateDataChannel.apply(pc, arguments);
      wrapDcSend(dataChannel, pc);
      return dataChannel;
    };
    utils.wrapPeerConnectionEvent(window, 'datachannel', function(e) {
      wrapDcSend(e.channel, e.target);
      return e;
    });
  }
};

},{"./utils":133,"sdp":118}],127:[function(require,module,exports){
/*
 *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.
 *
 *  Use of this source code is governed by a BSD-style license
 *  that can be found in the LICENSE file in the root of the source
 *  tree.
 */
 /* eslint-env node */
'use strict';

var utils = require('../utils');
var filterIceServers = require('./filtericeservers');
var shimRTCPeerConnection = require('rtcpeerconnection-shim');

module.exports = {
  shimGetUserMedia: require('./getusermedia'),
  shimPeerConnection: function(window) {
    var browserDetails = utils.detectBrowser(window);

    if (window.RTCIceGatherer) {
      if (!window.RTCIceCandidate) {
        window.RTCIceCandidate = function(args) {
          return args;
        };
      }
      if (!window.RTCSessionDescription) {
        window.RTCSessionDescription = function(args) {
          return args;
        };
      }
      // this adds an additional event listener to MediaStrackTrack that signals
      // when a tracks enabled property was changed. Workaround for a bug in
      // addStream, see below. No longer required in 15025+
      if (browserDetails.version < 15025) {
        var origMSTEnabled = Object.getOwnPropertyDescriptor(
            window.MediaStreamTrack.prototype, 'enabled');
        Object.defineProperty(window.MediaStreamTrack.prototype, 'enabled', {
          set: function(value) {
            origMSTEnabled.set.call(this, value);
            var ev = new Event('enabled');
            ev.enabled = value;
            this.dispatchEvent(ev);
          }
        });
      }
    }

    // ORTC defines the DTMF sender a bit different.
    // https://github.com/w3c/ortc/issues/714
    if (window.RTCRtpSender && !('dtmf' in window.RTCRtpSender.prototype)) {
      Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {
        get: function() {
          if (this._dtmf === undefined) {
            if (this.track.kind === 'audio') {
              this._dtmf = new window.RTCDtmfSender(this);
            } else if (this.track.kind === 'video') {
              this._dtmf = null;
            }
          }
          return this._dtmf;
        }
      });
    }
    // Edge currently only implements the RTCDtmfSender, not the
    // RTCDTMFSender alias. See http://draft.ortc.org/#rtcdtmfsender2*
    if (window.RTCDtmfSender && !window.RTCDTMFSender) {
      window.RTCDTMFSender = window.RTCDtmfSender;
    }

    var RTCPeerConnectionShim = shimRTCPeerConnection(window,
        browserDetails.version);
    window.RTCPeerConnection = function(config) {
      if (config && config.iceServers) {
        config.iceServers = filterIceServers(config.iceServers);
      }
      return new RTCPeerConnectionShim(config);
    };
    window.RTCPeerConnection.prototype = RTCPeerConnectionShim.prototype;
  },
  shimReplaceTrack: function(window) {
    // ORTC has replaceTrack -- https://github.com/w3c/ortc/issues/614
    if (window.RTCRtpSender &&
        !('replaceTrack' in window.RTCRtpSender.prototype)) {
      window.RTCRtpSender.prototype.replaceTrack =
          window.RTCRtpSender.prototype.setTrack;
    }
  },
  shimGetDisplayMedia: function(window, preferredMediaSource) {
    if (!('getDisplayMedia' in window.navigator) ||
        !window.navigator.mediaDevices ||
        'getDisplayMedia' in window.navigator.mediaDevices) {
      return;
    }
    var origGetDisplayMedia = window.navigator.getDisplayMedia;
    window.navigator.mediaDevices.getDisplayMedia = function(constraints) {
      return origGetDisplayMedia.call(window.navigator, constraints);
    };
    window.navigator.getDisplayMedia = function(constraints) {
      utils.deprecated('navigator.getDisplayMedia',
          'navigator.mediaDevices.getDisplayMedia');
      return origGetDisplayMedia.call(window.navigator, constraints);
    };
  }
};

},{"../utils":133,"./filtericeservers":128,"./getusermedia":129,"rtcpeerconnection-shim":117}],128:[function(require,module,exports){
/*
 *  Copyright (c) 2018 The WebRTC project authors. All Rights Reserved.
 *
 *  Use of this source code is governed by a BSD-style license
 *  that can be found in the LICENSE file in the root of the source
 *  tree.
 */
 /* eslint-env node */
'use strict';

var utils = require('../utils');
// Edge does not like
// 1) stun: filtered after 14393 unless ?transport=udp is present
// 2) turn: that does not have all of turn:host:port?transport=udp
// 3) turn: with ipv6 addresses
// 4) turn: occurring muliple times
module.exports = function(iceServers, edgeVersion) {
  var hasTurn = false;
  iceServers = JSON.parse(JSON.stringify(iceServers));
  return iceServers.filter(function(server) {
    if (server && (server.urls || server.url)) {
      var urls = server.urls || server.url;
      if (server.url && !server.urls) {
        utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');
      }
      var isString = typeof urls === 'string';
      if (isString) {
        urls = [urls];
      }
      urls = urls.filter(function(url) {
        var validTurn = url.indexOf('turn:') === 0 &&
            url.indexOf('transport=udp') !== -1 &&
            url.indexOf('turn:[') === -1 &&
            !hasTurn;

        if (validTurn) {
          hasTurn = true;
          return true;
        }
        return url.indexOf('stun:') === 0 && edgeVersion >= 14393 &&
            url.indexOf('?transport=udp') === -1;
      });

      delete server.url;
      server.urls = isString ? urls[0] : urls;
      return !!urls.length;
    }
  });
};

},{"../utils":133}],129:[function(require,module,exports){
/*
 *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.
 *
 *  Use of this source code is governed by a BSD-style license
 *  that can be found in the LICENSE file in the root of the source
 *  tree.
 */
 /* eslint-env node */
'use strict';

// Expose public methods.
module.exports = function(window) {
  var navigator = window && window.navigator;

  var shimError_ = function(e) {
    return {
      name: {PermissionDeniedError: 'NotAllowedError'}[e.name] || e.name,
      message: e.message,
      constraint: e.constraint,
      toString: function() {
        return this.name;
      }
    };
  };

  // getUserMedia error shim.
  var origGetUserMedia = navigator.mediaDevices.getUserMedia.
      bind(navigator.mediaDevices);
  navigator.mediaDevices.getUserMedia = function(c) {
    return origGetUserMedia(c).catch(function(e) {
      return Promise.reject(shimError_(e));
    });
  };
};

},{}],130:[function(require,module,exports){
/*
 *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.
 *
 *  Use of this source code is governed by a BSD-style license
 *  that can be found in the LICENSE file in the root of the source
 *  tree.
 */
 /* eslint-env node */
'use strict';

var utils = require('../utils');

module.exports = {
  shimGetUserMedia: require('./getusermedia'),
  shimOnTrack: function(window) {
    if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in
        window.RTCPeerConnection.prototype)) {
      Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {
        get: function() {
          return this._ontrack;
        },
        set: function(f) {
          if (this._ontrack) {
            this.removeEventListener('track', this._ontrack);
            this.removeEventListener('addstream', this._ontrackpoly);
          }
          this.addEventListener('track', this._ontrack = f);
          this.addEventListener('addstream', this._ontrackpoly = function(e) {
            e.stream.getTracks().forEach(function(track) {
              var event = new Event('track');
              event.track = track;
              event.receiver = {track: track};
              event.transceiver = {receiver: event.receiver};
              event.streams = [e.stream];
              this.dispatchEvent(event);
            }.bind(this));
          }.bind(this));
        },
        enumerable: true,
        configurable: true
      });
    }
    if (typeof window === 'object' && window.RTCTrackEvent &&
        ('receiver' in window.RTCTrackEvent.prototype) &&
        !('transceiver' in window.RTCTrackEvent.prototype)) {
      Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {
        get: function() {
          return {receiver: this.receiver};
        }
      });
    }
  },

  shimSourceObject: function(window) {
    // Firefox has supported mozSrcObject since FF22, unprefixed in 42.
    if (typeof window === 'object') {
      if (window.HTMLMediaElement &&
        !('srcObject' in window.HTMLMediaElement.prototype)) {
        // Shim the srcObject property, once, when HTMLMediaElement is found.
        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {
          get: function() {
            return this.mozSrcObject;
          },
          set: function(stream) {
            this.mozSrcObject = stream;
          }
        });
      }
    }
  },

  shimPeerConnection: function(window) {
    var browserDetails = utils.detectBrowser(window);

    if (typeof window !== 'object' || !(window.RTCPeerConnection ||
        window.mozRTCPeerConnection)) {
      return; // probably media.peerconnection.enabled=false in about:config
    }
    // The RTCPeerConnection object.
    if (!window.RTCPeerConnection) {
      window.RTCPeerConnection = function(pcConfig, pcConstraints) {
        if (browserDetails.version < 38) {
          // .urls is not supported in FF < 38.
          // create RTCIceServers with a single url.
          if (pcConfig && pcConfig.iceServers) {
            var newIceServers = [];
            for (var i = 0; i < pcConfig.iceServers.length; i++) {
              var server = pcConfig.iceServers[i];
              if (server.hasOwnProperty('urls')) {
                for (var j = 0; j < server.urls.length; j++) {
                  var newServer = {
                    url: server.urls[j]
                  };
                  if (server.urls[j].indexOf('turn') === 0) {
                    newServer.username = server.username;
                    newServer.credential = server.credential;
                  }
                  newIceServers.push(newServer);
                }
              } else {
                newIceServers.push(pcConfig.iceServers[i]);
              }
            }
            pcConfig.iceServers = newIceServers;
          }
        }
        return new window.mozRTCPeerConnection(pcConfig, pcConstraints);
      };
      window.RTCPeerConnection.prototype =
          window.mozRTCPeerConnection.prototype;

      // wrap static methods. Currently just generateCertificate.
      if (window.mozRTCPeerConnection.generateCertificate) {
        Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {
          get: function() {
            return window.mozRTCPeerConnection.generateCertificate;
          }
        });
      }

      window.RTCSessionDescription = window.mozRTCSessionDescription;
      window.RTCIceCandidate = window.mozRTCIceCandidate;
    }

    // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.
    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']
        .forEach(function(method) {
          var nativeMethod = window.RTCPeerConnection.prototype[method];
          window.RTCPeerConnection.prototype[method] = function() {
            arguments[0] = new ((method === 'addIceCandidate') ?
                window.RTCIceCandidate :
                window.RTCSessionDescription)(arguments[0]);
            return nativeMethod.apply(this, arguments);
          };
        });

    // support for addIceCandidate(null or undefined)
    var nativeAddIceCandidate =
        window.RTCPeerConnection.prototype.addIceCandidate;
    window.RTCPeerConnection.prototype.addIceCandidate = function() {
      if (!arguments[0]) {
        if (arguments[1]) {
          arguments[1].apply(null);
        }
        return Promise.resolve();
      }
      return nativeAddIceCandidate.apply(this, arguments);
    };

    // shim getStats with maplike support
    var makeMapStats = function(stats) {
      var map = new Map();
      Object.keys(stats).forEach(function(key) {
        map.set(key, stats[key]);
        map[key] = stats[key];
      });
      return map;
    };

    var modernStatsTypes = {
      inboundrtp: 'inbound-rtp',
      outboundrtp: 'outbound-rtp',
      candidatepair: 'candidate-pair',
      localcandidate: 'local-candidate',
      remotecandidate: 'remote-candidate'
    };

    var nativeGetStats = window.RTCPeerConnection.prototype.getStats;
    window.RTCPeerConnection.prototype.getStats = function(
      selector,
      onSucc,
      onErr
    ) {
      return nativeGetStats.apply(this, [selector || null])
        .then(function(stats) {
          if (browserDetails.version < 48) {
            stats = makeMapStats(stats);
          }
          if (browserDetails.version < 53 && !onSucc) {
            // Shim only promise getStats with spec-hyphens in type names
            // Leave callback version alone; misc old uses of forEach before Map
            try {
              stats.forEach(function(stat) {
                stat.type = modernStatsTypes[stat.type] || stat.type;
              });
            } catch (e) {
              if (e.name !== 'TypeError') {
                throw e;
              }
              // Avoid TypeError: "type" is read-only, in old versions. 34-43ish
              stats.forEach(function(stat, i) {
                stats.set(i, Object.assign({}, stat, {
                  type: modernStatsTypes[stat.type] || stat.type
                }));
              });
            }
          }
          return stats;
        })
        .then(onSucc, onErr);
    };
  },

  shimSenderGetStats: function(window) {
    if (!(typeof window === 'object' && window.RTCPeerConnection &&
        window.RTCRtpSender)) {
      return;
    }
    if (window.RTCRtpSender && 'getStats' in window.RTCRtpSender.prototype) {
      return;
    }
    var origGetSenders = window.RTCPeerConnection.prototype.getSenders;
    if (origGetSenders) {
      window.RTCPeerConnection.prototype.getSenders = function() {
        var pc = this;
        var senders = origGetSenders.apply(pc, []);
        senders.forEach(function(sender) {
          sender._pc = pc;
        });
        return senders;
      };
    }

    var origAddTrack = window.RTCPeerConnection.prototype.addTrack;
    if (origAddTrack) {
      window.RTCPeerConnection.prototype.addTrack = function() {
        var sender = origAddTrack.apply(this, arguments);
        sender._pc = this;
        return sender;
      };
    }
    window.RTCRtpSender.prototype.getStats = function() {
      return this.track ? this._pc.getStats(this.track) :
          Promise.resolve(new Map());
    };
  },

  shimReceiverGetStats: function(window) {
    if (!(typeof window === 'object' && window.RTCPeerConnection &&
        window.RTCRtpSender)) {
      return;
    }
    if (window.RTCRtpSender && 'getStats' in window.RTCRtpReceiver.prototype) {
      return;
    }
    var origGetReceivers = window.RTCPeerConnection.prototype.getReceivers;
    if (origGetReceivers) {
      window.RTCPeerConnection.prototype.getReceivers = function() {
        var pc = this;
        var receivers = origGetReceivers.apply(pc, []);
        receivers.forEach(function(receiver) {
          receiver._pc = pc;
        });
        return receivers;
      };
    }
    utils.wrapPeerConnectionEvent(window, 'track', function(e) {
      e.receiver._pc = e.srcElement;
      return e;
    });
    window.RTCRtpReceiver.prototype.getStats = function() {
      return this._pc.getStats(this.track);
    };
  },

  shimRemoveStream: function(window) {
    if (!window.RTCPeerConnection ||
        'removeStream' in window.RTCPeerConnection.prototype) {
      return;
    }
    window.RTCPeerConnection.prototype.removeStream = function(stream) {
      var pc = this;
      utils.deprecated('removeStream', 'removeTrack');
      this.getSenders().forEach(function(sender) {
        if (sender.track && stream.getTracks().indexOf(sender.track) !== -1) {
          pc.removeTrack(sender);
        }
      });
    };
  },

  shimRTCDataChannel: function(window) {
    // rename DataChannel to RTCDataChannel (native fix in FF60):
    // https://bugzilla.mozilla.org/show_bug.cgi?id=1173851
    if (window.DataChannel && !window.RTCDataChannel) {
      window.RTCDataChannel = window.DataChannel;
    }
  },

  shimGetDisplayMedia: function(window, preferredMediaSource) {
    if (!window.navigator || !window.navigator.mediaDevices ||
        'getDisplayMedia' in window.navigator.mediaDevices) {
      return;
    }
    window.navigator.mediaDevices.getDisplayMedia = function(constraints) {
      if (!(constraints && constraints.video)) {
        var err = new DOMException('getDisplayMedia without video ' +
            'constraints is undefined');
        err.name = 'NotFoundError';
        // from https://heycam.github.io/webidl/#idl-DOMException-error-names
        err.code = 8;
        return Promise.reject(err);
      }
      if (constraints.video === true) {
        constraints.video = {mediaSource: preferredMediaSource};
      } else {
        constraints.video.mediaSource = preferredMediaSource;
      }
      return window.navigator.mediaDevices.getUserMedia(constraints);
    };
    window.navigator.getDisplayMedia = function(constraints) {
      utils.deprecated('navigator.getDisplayMedia',
          'navigator.mediaDevices.getDisplayMedia');
      return window.navigator.mediaDevices.getDisplayMedia(constraints);
    };
  }
};

},{"../utils":133,"./getusermedia":131}],131:[function(require,module,exports){
/*
 *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.
 *
 *  Use of this source code is governed by a BSD-style license
 *  that can be found in the LICENSE file in the root of the source
 *  tree.
 */
 /* eslint-env node */
'use strict';

var utils = require('../utils');
var logging = utils.log;

// Expose public methods.
module.exports = function(window) {
  var browserDetails = utils.detectBrowser(window);
  var navigator = window && window.navigator;
  var MediaStreamTrack = window && window.MediaStreamTrack;

  var shimError_ = function(e) {
    return {
      name: {
        InternalError: 'NotReadableError',
        NotSupportedError: 'TypeError',
        PermissionDeniedError: 'NotAllowedError',
        SecurityError: 'NotAllowedError'
      }[e.name] || e.name,
      message: {
        'The operation is insecure.': 'The request is not allowed by the ' +
        'user agent or the platform in the current context.'
      }[e.message] || e.message,
      constraint: e.constraint,
      toString: function() {
        return this.name + (this.message && ': ') + this.message;
      }
    };
  };

  // getUserMedia constraints shim.
  var getUserMedia_ = function(constraints, onSuccess, onError) {
    var constraintsToFF37_ = function(c) {
      if (typeof c !== 'object' || c.require) {
        return c;
      }
      var require = [];
      Object.keys(c).forEach(function(key) {
        if (key === 'require' || key === 'advanced' || key === 'mediaSource') {
          return;
        }
        var r = c[key] = (typeof c[key] === 'object') ?
            c[key] : {ideal: c[key]};
        if (r.min !== undefined ||
            r.max !== undefined || r.exact !== undefined) {
          require.push(key);
        }
        if (r.exact !== undefined) {
          if (typeof r.exact === 'number') {
            r. min = r.max = r.exact;
          } else {
            c[key] = r.exact;
          }
          delete r.exact;
        }
        if (r.ideal !== undefined) {
          c.advanced = c.advanced || [];
          var oc = {};
          if (typeof r.ideal === 'number') {
            oc[key] = {min: r.ideal, max: r.ideal};
          } else {
            oc[key] = r.ideal;
          }
          c.advanced.push(oc);
          delete r.ideal;
          if (!Object.keys(r).length) {
            delete c[key];
          }
        }
      });
      if (require.length) {
        c.require = require;
      }
      return c;
    };
    constraints = JSON.parse(JSON.stringify(constraints));
    if (browserDetails.version < 38) {
      logging('spec: ' + JSON.stringify(constraints));
      if (constraints.audio) {
        constraints.audio = constraintsToFF37_(constraints.audio);
      }
      if (constraints.video) {
        constraints.video = constraintsToFF37_(constraints.video);
      }
      logging('ff37: ' + JSON.stringify(constraints));
    }
    return navigator.mozGetUserMedia(constraints, onSuccess, function(e) {
      onError(shimError_(e));
    });
  };

  // Returns the result of getUserMedia as a Promise.
  var getUserMediaPromise_ = function(constraints) {
    return new Promise(function(resolve, reject) {
      getUserMedia_(constraints, resolve, reject);
    });
  };

  // Shim for mediaDevices on older versions.
  if (!navigator.mediaDevices) {
    navigator.mediaDevices = {getUserMedia: getUserMediaPromise_,
      addEventListener: function() { },
      removeEventListener: function() { }
    };
  }
  navigator.mediaDevices.enumerateDevices =
      navigator.mediaDevices.enumerateDevices || function() {
        return new Promise(function(resolve) {
          var infos = [
            {kind: 'audioinput', deviceId: 'default', label: '', groupId: ''},
            {kind: 'videoinput', deviceId: 'default', label: '', groupId: ''}
          ];
          resolve(infos);
        });
      };

  if (browserDetails.version < 41) {
    // Work around http://bugzil.la/1169665
    var orgEnumerateDevices =
        navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);
    navigator.mediaDevices.enumerateDevices = function() {
      return orgEnumerateDevices().then(undefined, function(e) {
        if (e.name === 'NotFoundError') {
          return [];
        }
        throw e;
      });
    };
  }
  if (browserDetails.version < 49) {
    var origGetUserMedia = navigator.mediaDevices.getUserMedia.
        bind(navigator.mediaDevices);
    navigator.mediaDevices.getUserMedia = function(c) {
      return origGetUserMedia(c).then(function(stream) {
        // Work around https://bugzil.la/802326
        if (c.audio && !stream.getAudioTracks().length ||
            c.video && !stream.getVideoTracks().length) {
          stream.getTracks().forEach(function(track) {
            track.stop();
          });
          throw new DOMException('The object can not be found here.',
                                 'NotFoundError');
        }
        return stream;
      }, function(e) {
        return Promise.reject(shimError_(e));
      });
    };
  }
  if (!(browserDetails.version > 55 &&
      'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {
    var remap = function(obj, a, b) {
      if (a in obj && !(b in obj)) {
        obj[b] = obj[a];
        delete obj[a];
      }
    };

    var nativeGetUserMedia = navigator.mediaDevices.getUserMedia.
        bind(navigator.mediaDevices);
    navigator.mediaDevices.getUserMedia = function(c) {
      if (typeof c === 'object' && typeof c.audio === 'object') {
        c = JSON.parse(JSON.stringify(c));
        remap(c.audio, 'autoGainControl', 'mozAutoGainControl');
        remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');
      }
      return nativeGetUserMedia(c);
    };

    if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {
      var nativeGetSettings = MediaStreamTrack.prototype.getSettings;
      MediaStreamTrack.prototype.getSettings = function() {
        var obj = nativeGetSettings.apply(this, arguments);
        remap(obj, 'mozAutoGainControl', 'autoGainControl');
        remap(obj, 'mozNoiseSuppression', 'noiseSuppression');
        return obj;
      };
    }

    if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {
      var nativeApplyConstraints = MediaStreamTrack.prototype.applyConstraints;
      MediaStreamTrack.prototype.applyConstraints = function(c) {
        if (this.kind === 'audio' && typeof c === 'object') {
          c = JSON.parse(JSON.stringify(c));
          remap(c, 'autoGainControl', 'mozAutoGainControl');
          remap(c, 'noiseSuppression', 'mozNoiseSuppression');
        }
        return nativeApplyConstraints.apply(this, [c]);
      };
    }
  }
  navigator.getUserMedia = function(constraints, onSuccess, onError) {
    if (browserDetails.version < 44) {
      return getUserMedia_(constraints, onSuccess, onError);
    }
    // Replace Firefox 44+'s deprecation warning with unprefixed version.
    utils.deprecated('navigator.getUserMedia',
        'navigator.mediaDevices.getUserMedia');
    navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);
  };
};

},{"../utils":133}],132:[function(require,module,exports){
/*
 *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.
 *
 *  Use of this source code is governed by a BSD-style license
 *  that can be found in the LICENSE file in the root of the source
 *  tree.
 */
'use strict';
var utils = require('../utils');

module.exports = {
  shimLocalStreamsAPI: function(window) {
    if (typeof window !== 'object' || !window.RTCPeerConnection) {
      return;
    }
    if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {
      window.RTCPeerConnection.prototype.getLocalStreams = function() {
        if (!this._localStreams) {
          this._localStreams = [];
        }
        return this._localStreams;
      };
    }
    if (!('getStreamById' in window.RTCPeerConnection.prototype)) {
      window.RTCPeerConnection.prototype.getStreamById = function(id) {
        var result = null;
        if (this._localStreams) {
          this._localStreams.forEach(function(stream) {
            if (stream.id === id) {
              result = stream;
            }
          });
        }
        if (this._remoteStreams) {
          this._remoteStreams.forEach(function(stream) {
            if (stream.id === id) {
              result = stream;
            }
          });
        }
        return result;
      };
    }
    if (!('addStream' in window.RTCPeerConnection.prototype)) {
      var _addTrack = window.RTCPeerConnection.prototype.addTrack;
      window.RTCPeerConnection.prototype.addStream = function(stream) {
        if (!this._localStreams) {
          this._localStreams = [];
        }
        if (this._localStreams.indexOf(stream) === -1) {
          this._localStreams.push(stream);
        }
        var pc = this;
        stream.getTracks().forEach(function(track) {
          _addTrack.call(pc, track, stream);
        });
      };

      window.RTCPeerConnection.prototype.addTrack = function(track, stream) {
        if (stream) {
          if (!this._localStreams) {
            this._localStreams = [stream];
          } else if (this._localStreams.indexOf(stream) === -1) {
            this._localStreams.push(stream);
          }
        }
        return _addTrack.call(this, track, stream);
      };
    }
    if (!('removeStream' in window.RTCPeerConnection.prototype)) {
      window.RTCPeerConnection.prototype.removeStream = function(stream) {
        if (!this._localStreams) {
          this._localStreams = [];
        }
        var index = this._localStreams.indexOf(stream);
        if (index === -1) {
          return;
        }
        this._localStreams.splice(index, 1);
        var pc = this;
        var tracks = stream.getTracks();
        this.getSenders().forEach(function(sender) {
          if (tracks.indexOf(sender.track) !== -1) {
            pc.removeTrack(sender);
          }
        });
      };
    }
  },
  shimRemoteStreamsAPI: function(window) {
    if (typeof window !== 'object' || !window.RTCPeerConnection) {
      return;
    }
    if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {
      window.RTCPeerConnection.prototype.getRemoteStreams = function() {
        return this._remoteStreams ? this._remoteStreams : [];
      };
    }
    if (!('onaddstream' in window.RTCPeerConnection.prototype)) {
      Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {
        get: function() {
          return this._onaddstream;
        },
        set: function(f) {
          if (this._onaddstream) {
            this.removeEventListener('addstream', this._onaddstream);
          }
          this.addEventListener('addstream', this._onaddstream = f);
        }
      });
      var origSetRemoteDescription =
          window.RTCPeerConnection.prototype.setRemoteDescription;
      window.RTCPeerConnection.prototype.setRemoteDescription = function() {
        var pc = this;
        if (!this._onaddstreampoly) {
          this.addEventListener('track', this._onaddstreampoly = function(e) {
            e.streams.forEach(function(stream) {
              if (!pc._remoteStreams) {
                pc._remoteStreams = [];
              }
              if (pc._remoteStreams.indexOf(stream) >= 0) {
                return;
              }
              pc._remoteStreams.push(stream);
              var event = new Event('addstream');
              event.stream = stream;
              pc.dispatchEvent(event);
            });
          });
        }
        return origSetRemoteDescription.apply(pc, arguments);
      };
    }
  },
  shimCallbacksAPI: function(window) {
    if (typeof window !== 'object' || !window.RTCPeerConnection) {
      return;
    }
    var prototype = window.RTCPeerConnection.prototype;
    var createOffer = prototype.createOffer;
    var createAnswer = prototype.createAnswer;
    var setLocalDescription = prototype.setLocalDescription;
    var setRemoteDescription = prototype.setRemoteDescription;
    var addIceCandidate = prototype.addIceCandidate;

    prototype.createOffer = function(successCallback, failureCallback) {
      var options = (arguments.length >= 2) ? arguments[2] : arguments[0];
      var promise = createOffer.apply(this, [options]);
      if (!failureCallback) {
        return promise;
      }
      promise.then(successCallback, failureCallback);
      return Promise.resolve();
    };

    prototype.createAnswer = function(successCallback, failureCallback) {
      var options = (arguments.length >= 2) ? arguments[2] : arguments[0];
      var promise = createAnswer.apply(this, [options]);
      if (!failureCallback) {
        return promise;
      }
      promise.then(successCallback, failureCallback);
      return Promise.resolve();
    };

    var withCallback = function(description, successCallback, failureCallback) {
      var promise = setLocalDescription.apply(this, [description]);
      if (!failureCallback) {
        return promise;
      }
      promise.then(successCallback, failureCallback);
      return Promise.resolve();
    };
    prototype.setLocalDescription = withCallback;

    withCallback = function(description, successCallback, failureCallback) {
      var promise = setRemoteDescription.apply(this, [description]);
      if (!failureCallback) {
        return promise;
      }
      promise.then(successCallback, failureCallback);
      return Promise.resolve();
    };
    prototype.setRemoteDescription = withCallback;

    withCallback = function(candidate, successCallback, failureCallback) {
      var promise = addIceCandidate.apply(this, [candidate]);
      if (!failureCallback) {
        return promise;
      }
      promise.then(successCallback, failureCallback);
      return Promise.resolve();
    };
    prototype.addIceCandidate = withCallback;
  },
  shimGetUserMedia: function(window) {
    var navigator = window && window.navigator;

    if (!navigator.getUserMedia) {
      if (navigator.webkitGetUserMedia) {
        navigator.getUserMedia = navigator.webkitGetUserMedia.bind(navigator);
      } else if (navigator.mediaDevices &&
          navigator.mediaDevices.getUserMedia) {
        navigator.getUserMedia = function(constraints, cb, errcb) {
          navigator.mediaDevices.getUserMedia(constraints)
          .then(cb, errcb);
        }.bind(navigator);
      }
    }
  },
  shimRTCIceServerUrls: function(window) {
    // migrate from non-spec RTCIceServer.url to RTCIceServer.urls
    var OrigPeerConnection = window.RTCPeerConnection;
    window.RTCPeerConnection = function(pcConfig, pcConstraints) {
      if (pcConfig && pcConfig.iceServers) {
        var newIceServers = [];
        for (var i = 0; i < pcConfig.iceServers.length; i++) {
          var server = pcConfig.iceServers[i];
          if (!server.hasOwnProperty('urls') &&
              server.hasOwnProperty('url')) {
            utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');
            server = JSON.parse(JSON.stringify(server));
            server.urls = server.url;
            delete server.url;
            newIceServers.push(server);
          } else {
            newIceServers.push(pcConfig.iceServers[i]);
          }
        }
        pcConfig.iceServers = newIceServers;
      }
      return new OrigPeerConnection(pcConfig, pcConstraints);
    };
    window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;
    // wrap static methods. Currently just generateCertificate.
    if ('generateCertificate' in window.RTCPeerConnection) {
      Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {
        get: function() {
          return OrigPeerConnection.generateCertificate;
        }
      });
    }
  },
  shimTrackEventTransceiver: function(window) {
    // Add event.transceiver member over deprecated event.receiver
    if (typeof window === 'object' && window.RTCPeerConnection &&
        ('receiver' in window.RTCTrackEvent.prototype) &&
        // can't check 'transceiver' in window.RTCTrackEvent.prototype, as it is
        // defined for some reason even when window.RTCTransceiver is not.
        !window.RTCTransceiver) {
      Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {
        get: function() {
          return {receiver: this.receiver};
        }
      });
    }
  },

  shimCreateOfferLegacy: function(window) {
    var origCreateOffer = window.RTCPeerConnection.prototype.createOffer;
    window.RTCPeerConnection.prototype.createOffer = function(offerOptions) {
      var pc = this;
      if (offerOptions) {
        if (typeof offerOptions.offerToReceiveAudio !== 'undefined') {
          // support bit values
          offerOptions.offerToReceiveAudio = !!offerOptions.offerToReceiveAudio;
        }
        var audioTransceiver = pc.getTransceivers().find(function(transceiver) {
          return transceiver.sender.track &&
              transceiver.sender.track.kind === 'audio';
        });
        if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {
          if (audioTransceiver.direction === 'sendrecv') {
            if (audioTransceiver.setDirection) {
              audioTransceiver.setDirection('sendonly');
            } else {
              audioTransceiver.direction = 'sendonly';
            }
          } else if (audioTransceiver.direction === 'recvonly') {
            if (audioTransceiver.setDirection) {
              audioTransceiver.setDirection('inactive');
            } else {
              audioTransceiver.direction = 'inactive';
            }
          }
        } else if (offerOptions.offerToReceiveAudio === true &&
            !audioTransceiver) {
          pc.addTransceiver('audio');
        }


        if (typeof offerOptions.offerToReceiveVideo !== 'undefined') {
          // support bit values
          offerOptions.offerToReceiveVideo = !!offerOptions.offerToReceiveVideo;
        }
        var videoTransceiver = pc.getTransceivers().find(function(transceiver) {
          return transceiver.sender.track &&
              transceiver.sender.track.kind === 'video';
        });
        if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {
          if (videoTransceiver.direction === 'sendrecv') {
            videoTransceiver.setDirection('sendonly');
          } else if (videoTransceiver.direction === 'recvonly') {
            videoTransceiver.setDirection('inactive');
          }
        } else if (offerOptions.offerToReceiveVideo === true &&
            !videoTransceiver) {
          pc.addTransceiver('video');
        }
      }
      return origCreateOffer.apply(pc, arguments);
    };
  }
};

},{"../utils":133}],133:[function(require,module,exports){
/*
 *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.
 *
 *  Use of this source code is governed by a BSD-style license
 *  that can be found in the LICENSE file in the root of the source
 *  tree.
 */
 /* eslint-env node */
'use strict';

var logDisabled_ = true;
var deprecationWarnings_ = true;

/**
 * Extract browser version out of the provided user agent string.
 *
 * @param {!string} uastring userAgent string.
 * @param {!string} expr Regular expression used as match criteria.
 * @param {!number} pos position in the version string to be returned.
 * @return {!number} browser version.
 */
function extractVersion(uastring, expr, pos) {
  var match = uastring.match(expr);
  return match && match.length >= pos && parseInt(match[pos], 10);
}

// Wraps the peerconnection event eventNameToWrap in a function
// which returns the modified event object (or false to prevent
// the event).
function wrapPeerConnectionEvent(window, eventNameToWrap, wrapper) {
  if (!window.RTCPeerConnection) {
    return;
  }
  var proto = window.RTCPeerConnection.prototype;
  var nativeAddEventListener = proto.addEventListener;
  proto.addEventListener = function(nativeEventName, cb) {
    if (nativeEventName !== eventNameToWrap) {
      return nativeAddEventListener.apply(this, arguments);
    }
    var wrappedCallback = function(e) {
      var modifiedEvent = wrapper(e);
      if (modifiedEvent) {
        cb(modifiedEvent);
      }
    };
    this._eventMap = this._eventMap || {};
    this._eventMap[cb] = wrappedCallback;
    return nativeAddEventListener.apply(this, [nativeEventName,
      wrappedCallback]);
  };

  var nativeRemoveEventListener = proto.removeEventListener;
  proto.removeEventListener = function(nativeEventName, cb) {
    if (nativeEventName !== eventNameToWrap || !this._eventMap
        || !this._eventMap[cb]) {
      return nativeRemoveEventListener.apply(this, arguments);
    }
    var unwrappedCb = this._eventMap[cb];
    delete this._eventMap[cb];
    return nativeRemoveEventListener.apply(this, [nativeEventName,
      unwrappedCb]);
  };

  Object.defineProperty(proto, 'on' + eventNameToWrap, {
    get: function() {
      return this['_on' + eventNameToWrap];
    },
    set: function(cb) {
      if (this['_on' + eventNameToWrap]) {
        this.removeEventListener(eventNameToWrap,
            this['_on' + eventNameToWrap]);
        delete this['_on' + eventNameToWrap];
      }
      if (cb) {
        this.addEventListener(eventNameToWrap,
            this['_on' + eventNameToWrap] = cb);
      }
    },
    enumerable: true,
    configurable: true
  });
}

// Utility methods.
module.exports = {
  extractVersion: extractVersion,
  wrapPeerConnectionEvent: wrapPeerConnectionEvent,
  disableLog: function(bool) {
    if (typeof bool !== 'boolean') {
      return new Error('Argument type: ' + typeof bool +
          '. Please use a boolean.');
    }
    logDisabled_ = bool;
    return (bool) ? 'adapter.js logging disabled' :
        'adapter.js logging enabled';
  },

  /**
   * Disable or enable deprecation warnings
   * @param {!boolean} bool set to true to disable warnings.
   */
  disableWarnings: function(bool) {
    if (typeof bool !== 'boolean') {
      return new Error('Argument type: ' + typeof bool +
          '. Please use a boolean.');
    }
    deprecationWarnings_ = !bool;
    return 'adapter.js deprecation warnings ' + (bool ? 'disabled' : 'enabled');
  },

  log: function() {
    if (typeof window === 'object') {
      if (logDisabled_) {
        return;
      }
      if (typeof console !== 'undefined' && typeof console.log === 'function') {
        console.log.apply(console, arguments);
      }
    }
  },

  /**
   * Shows a deprecation warning suggesting the modern and spec-compatible API.
   */
  deprecated: function(oldMethod, newMethod) {
    if (!deprecationWarnings_) {
      return;
    }
    console.warn(oldMethod + ' is deprecated, please use ' + newMethod +
        ' instead.');
  },

  /**
   * Browser detector.
   *
   * @return {object} result containing browser and version
   *     properties.
   */
  detectBrowser: function(window) {
    var navigator = window && window.navigator;

    // Returned result object.
    var result = {};
    result.browser = null;
    result.version = null;

    // Fail early if it's not a browser
    if (typeof window === 'undefined' || !window.navigator) {
      result.browser = 'Not a browser.';
      return result;
    }

    if (navigator.mozGetUserMedia) { // Firefox.
      result.browser = 'firefox';
      result.version = extractVersion(navigator.userAgent,
          /Firefox\/(\d+)\./, 1);
    } else if (navigator.webkitGetUserMedia) {
      // Chrome, Chromium, Webview, Opera.
      // Version matches Chrome/WebRTC version.
      result.browser = 'chrome';
      result.version = extractVersion(navigator.userAgent,
          /Chrom(e|ium)\/(\d+)\./, 2);
    } else if (navigator.mediaDevices &&
        navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)) { // Edge.
      result.browser = 'edge';
      result.version = extractVersion(navigator.userAgent,
          /Edge\/(\d+).(\d+)$/, 2);
    } else if (window.RTCPeerConnection &&
        navigator.userAgent.match(/AppleWebKit\/(\d+)\./)) { // Safari.
      result.browser = 'safari';
      result.version = extractVersion(navigator.userAgent,
          /AppleWebKit\/(\d+)\./, 1);
    } else { // Default fallthrough: not supported.
      result.browser = 'Not a supported browser.';
      return result;
    }

    return result;
  }
};

},{}],134:[function(require,module,exports){
(function (global){(function (){
'use strict';

require('webrtc-adapter');

var _rtc_session = require('./rtc_session');

var _rtc_session2 = _interopRequireDefault(_rtc_session);

var _rtc_const = require('./rtc_const');

var _rtc_peer_connection_factory = require('./rtc_peer_connection_factory');

var _rtc_peer_connection_factory2 = _interopRequireDefault(_rtc_peer_connection_factory);

var _v = require('uuid/v4');

var _v2 = _interopRequireDefault(_v);

var _StandardStrategy = require('./strategies/StandardStrategy');

var _StandardStrategy2 = _interopRequireDefault(_StandardStrategy);

var _CitrixVDIStrategy = require('./strategies/CitrixVDIStrategy');

var _CitrixVDIStrategy2 = _interopRequireDefault(_CitrixVDIStrategy);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * @license
 * License info for uuid module assembled into js bundle:
 *
 * The MIT License (MIT)
 *
 * Copyright (c) 2010-2016 Robert Kieffer and other contributors
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
global.connect = global.connect || {}; /**
                                        * @license
                                        * Copyright 2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.
                                        *
                                        * SPDX-License-Identifier: Apache-2.0
                                        */
/**
 * @license
 * License info for webrtc-adapter module assembled into js bundle:
 *
 * Copyright (c) 2014, The WebRTC project authors. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
 *
 * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
 *
 * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
 *
 * Neither the name of Google nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
/**
 * @license
 * License info for sdp module assembled into js bundle:
 *
 * See https://www.npmjs.com/package/sdp
 */

global.connect.RTCSession = _rtc_session2.default;
global.connect.RTCErrors = _rtc_const.RTC_ERRORS;
global.connect.RtcPeerConnectionFactory = _rtc_peer_connection_factory2.default;
global.connect.uuid = _v2.default;
global.connect.StandardStrategy = _StandardStrategy2.default;
global.connect.CitrixVDIStrategy = _CitrixVDIStrategy2.default;

global.lily = global.lily || {};
global.lily.RTCSession = _rtc_session2.default;
global.lily.RTCErrors = _rtc_const.RTC_ERRORS;

}).call(this)}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./rtc_const":136,"./rtc_peer_connection_factory":137,"./rtc_session":138,"./strategies/CitrixVDIStrategy":143,"./strategies/StandardStrategy":144,"uuid/v4":121,"webrtc-adapter":122}],135:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.UnknownSignalingError = exports.UnknownSignalingErrorName = exports.CallNotFoundException = exports.CallNotFoundExceptionName = exports.BusyException = exports.BusyExceptionName = exports.UnsupportedOperation = exports.UnsupportedOperationExceptionName = exports.IllegalState = exports.IllegalStateExceptionName = exports.IllegalParameters = exports.IllegalParametersExceptionName = exports.GumTimeout = exports.GumTimeoutExceptionName = exports.Timeout = exports.TimeoutExceptionName = undefined;

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright 2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 * SPDX-License-Identifier: Apache-2.0
 */
var TimeoutExceptionName = exports.TimeoutExceptionName = 'Timeout';

var Timeout = exports.Timeout = function (_Error) {
    (0, _inherits3.default)(Timeout, _Error);

    function Timeout(msg) {
        (0, _classCallCheck3.default)(this, Timeout);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Timeout.__proto__ || Object.getPrototypeOf(Timeout)).call(this, msg));

        _this.name = TimeoutExceptionName;
        return _this;
    }

    return Timeout;
}(Error);

var GumTimeoutExceptionName = exports.GumTimeoutExceptionName = 'GumTimeout';

var GumTimeout = exports.GumTimeout = function (_Timeout) {
    (0, _inherits3.default)(GumTimeout, _Timeout);

    function GumTimeout(msg) {
        (0, _classCallCheck3.default)(this, GumTimeout);

        var _this2 = (0, _possibleConstructorReturn3.default)(this, (GumTimeout.__proto__ || Object.getPrototypeOf(GumTimeout)).call(this, msg));

        _this2.name = GumTimeoutExceptionName;
        return _this2;
    }

    return GumTimeout;
}(Timeout);

var IllegalParametersExceptionName = exports.IllegalParametersExceptionName = 'IllegalParameters';

var IllegalParameters = exports.IllegalParameters = function (_Error2) {
    (0, _inherits3.default)(IllegalParameters, _Error2);

    function IllegalParameters(msg) {
        (0, _classCallCheck3.default)(this, IllegalParameters);

        var _this3 = (0, _possibleConstructorReturn3.default)(this, (IllegalParameters.__proto__ || Object.getPrototypeOf(IllegalParameters)).call(this, msg));

        _this3.name = IllegalParametersExceptionName;
        return _this3;
    }

    return IllegalParameters;
}(Error);

var IllegalStateExceptionName = exports.IllegalStateExceptionName = 'IllegalState';

var IllegalState = exports.IllegalState = function (_Error3) {
    (0, _inherits3.default)(IllegalState, _Error3);

    function IllegalState(msg) {
        (0, _classCallCheck3.default)(this, IllegalState);

        var _this4 = (0, _possibleConstructorReturn3.default)(this, (IllegalState.__proto__ || Object.getPrototypeOf(IllegalState)).call(this, msg));

        _this4.name = IllegalStateExceptionName;
        return _this4;
    }

    return IllegalState;
}(Error);

var UnsupportedOperationExceptionName = exports.UnsupportedOperationExceptionName = 'UnsupportedOperation';

var UnsupportedOperation = exports.UnsupportedOperation = function (_Error4) {
    (0, _inherits3.default)(UnsupportedOperation, _Error4);

    function UnsupportedOperation(msg) {
        (0, _classCallCheck3.default)(this, UnsupportedOperation);

        var _this5 = (0, _possibleConstructorReturn3.default)(this, (UnsupportedOperation.__proto__ || Object.getPrototypeOf(UnsupportedOperation)).call(this, msg));

        _this5.name = UnsupportedOperationExceptionName;
        return _this5;
    }

    return UnsupportedOperation;
}(Error);

var BusyExceptionName = exports.BusyExceptionName = 'BusyException';

var BusyException = exports.BusyException = function (_Error5) {
    (0, _inherits3.default)(BusyException, _Error5);

    function BusyException(msg) {
        (0, _classCallCheck3.default)(this, BusyException);

        var _this6 = (0, _possibleConstructorReturn3.default)(this, (BusyException.__proto__ || Object.getPrototypeOf(BusyException)).call(this, msg));

        _this6.name = BusyExceptionName;
        return _this6;
    }

    return BusyException;
}(Error);

var CallNotFoundExceptionName = exports.CallNotFoundExceptionName = 'CallNotFoundException';

var CallNotFoundException = exports.CallNotFoundException = function (_Error6) {
    (0, _inherits3.default)(CallNotFoundException, _Error6);

    function CallNotFoundException(msg) {
        (0, _classCallCheck3.default)(this, CallNotFoundException);

        var _this7 = (0, _possibleConstructorReturn3.default)(this, (CallNotFoundException.__proto__ || Object.getPrototypeOf(CallNotFoundException)).call(this, msg));

        _this7.name = CallNotFoundExceptionName;
        return _this7;
    }

    return CallNotFoundException;
}(Error);

var UnknownSignalingErrorName = exports.UnknownSignalingErrorName = 'UnknownSignalingError';

var UnknownSignalingError = exports.UnknownSignalingError = function (_Error7) {
    (0, _inherits3.default)(UnknownSignalingError, _Error7);

    function UnknownSignalingError() {
        (0, _classCallCheck3.default)(this, UnknownSignalingError);

        var _this8 = (0, _possibleConstructorReturn3.default)(this, (UnknownSignalingError.__proto__ || Object.getPrototypeOf(UnknownSignalingError)).call(this));

        _this8.name = UnknownSignalingErrorName;
        return _this8;
    }

    return UnknownSignalingError;
}(Error);

},{"babel-runtime/helpers/classCallCheck":11,"babel-runtime/helpers/inherits":14,"babel-runtime/helpers/possibleConstructorReturn":15}],136:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});
/**
 * Copyright 2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 * SPDX-License-Identifier: Apache-2.0
 */

/**
 * Timeout waiting for server response to accept/hangup request.
 */
var MAX_ACCEPT_BYE_DELAY_MS = exports.MAX_ACCEPT_BYE_DELAY_MS = 2000;
/**
 * Timeout waiting for server response to invite.
 */
var MAX_INVITE_DELAY_MS = exports.MAX_INVITE_DELAY_MS = 5000;
/**
 *  Default timeout on opening WebSocket connection.
 */
var DEFAULT_CONNECT_TIMEOUT_MS = exports.DEFAULT_CONNECT_TIMEOUT_MS = 10000;
/**
 * Default ice collection timeout in milliseconds.
 */
var DEFAULT_ICE_TIMEOUT_MS = exports.DEFAULT_ICE_TIMEOUT_MS = 8000;
/**
 * Default gum timeout in milliseconds to be enforced during start of a call.
 */
var DEFAULT_GUM_TIMEOUT_MS = exports.DEFAULT_GUM_TIMEOUT_MS = 10000;

var SOFTPHONE_ROUTE_KEY = exports.SOFTPHONE_ROUTE_KEY = "aws/softphone";

var INVITE_METHOD_NAME = exports.INVITE_METHOD_NAME = "invite";
var ACCEPT_METHOD_NAME = exports.ACCEPT_METHOD_NAME = "accept";
var BYE_METHOD_NAME = exports.BYE_METHOD_NAME = "bye";

var RTC_PEER_CONNECTION_CONFIG = exports.RTC_PEER_CONNECTION_CONFIG = {
    iceTransportPolicy: 'relay',
    rtcpMuxPolicy: 'require',
    bundlePolicy: 'balanced',
    sdpSemantics: 'unified',
    enableDtlsSrtp: true
};

var RTC_PEER_CONNECTION_OPTIONAL_CONFIG = exports.RTC_PEER_CONNECTION_OPTIONAL_CONFIG = {
    optional: [{
        googDscp: true

    }, {
        DtlsSrtpKeyAgreement: true
    }]
};

var DEFAULT_ICE_CANDIDATE_POOL_SIZE = exports.DEFAULT_ICE_CANDIDATE_POOL_SIZE = 1;

var RTC_PEER_CONNECTION_IDLE_TIMEOUT_MS = exports.RTC_PEER_CONNECTION_IDLE_TIMEOUT_MS = 1 * 60 * 1000;

var NETWORK_CONNECTIVITY_CHECK_INTERVAL_MS = exports.NETWORK_CONNECTIVITY_CHECK_INTERVAL_MS = 250;

var CHROME_SUPPORTED_VERSION = exports.CHROME_SUPPORTED_VERSION = 59;

/**
 * RTC error names.
 */
var RTC_ERRORS = exports.RTC_ERRORS = {
    ICE_COLLECTION_TIMEOUT: 'Ice Collection Timeout',
    USER_BUSY: 'User Busy',
    SIGNALLING_CONNECTION_FAILURE: 'Signalling Connection Failure',
    SIGNALLING_HANDSHAKE_FAILURE: 'Signalling Handshake Failure',
    SET_REMOTE_DESCRIPTION_FAILURE: 'Set Remote Description Failure',
    CREATE_OFFER_FAILURE: 'Create Offer Failure',
    SET_LOCAL_DESCRIPTION_FAILURE: 'Set Local Description Failure',
    INVALID_REMOTE_SDP: 'Invalid Remote SDP',
    NO_REMOTE_ICE_CANDIDATE: 'No Remote ICE Candidate',
    GUM_TIMEOUT_FAILURE: 'GUM Timeout Failure',
    GUM_OTHER_FAILURE: 'GUM Other Failure',
    CALL_NOT_FOUND: 'Call Not Found'
};

var ICE_CONNECTION_STATE = exports.ICE_CONNECTION_STATE = {
    NEW: 'new',
    CHECKING: 'checking',
    CONNECTED: 'connected',
    COMPLETED: 'completed',
    FAILED: 'failed',
    DISCONNECTED: 'disconnected',
    CLOSED: 'closed'
};

var PEER_CONNECTION_STATE = exports.PEER_CONNECTION_STATE = {
    NEW: 'new',
    CONNECTING: 'connecting',
    CONNECTED: 'connected',
    FAILED: 'failed',
    DISCONNECTED: 'disconnected',
    CLOSED: 'closed'
};

},{}],137:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _utils = require('./utils');

var _rtc_const = require('./rtc_const');

var _CCPInitiationStrategyInterface = require('./strategies/CCPInitiationStrategyInterface');

var _CCPInitiationStrategyInterface2 = _interopRequireDefault(_CCPInitiationStrategyInterface);

var _StandardStrategy = require('./strategies/StandardStrategy');

var _StandardStrategy2 = _interopRequireDefault(_StandardStrategy);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var RtcPeerConnectionFactory = function () {

    //transportHandle must be a callback function which should return a promise which is going to return the iceServers. Please refer https://www.w3.org/TR/webrtc/#rtciceserver-dictionary for iceServer example
    //publishError(errorType, errorMessage) must be a callback function which will publish the passed error message to client browser
    function RtcPeerConnectionFactory(logger, wssManager, clientId, transportHandle, publishError) {
        var strategy = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : new _StandardStrategy2.default();
        (0, _classCallCheck3.default)(this, RtcPeerConnectionFactory);

        if (!(strategy instanceof _CCPInitiationStrategyInterface2.default)) {
            throw new Error('Expected a strategy of type CCPInitiationStrategyInterface');
        }
        (0, _utils.assertTrue)((0, _utils.isFunction)(transportHandle), 'transportHandle must be a function');
        (0, _utils.assertTrue)((0, _utils.isFunction)(publishError), 'publishError must be a function');
        this._strategy = strategy;
        this._logger = logger;
        this._clientId = clientId;
        this._wssManager = wssManager;
        this._requestIceAccess = transportHandle;
        this._publishError = publishError;
        this._browserSupported = this._isBrowserSupported();
        this._initializeWebSocketEventListeners();
        this._requestPeerConnection();
        this._networkConnectivityChecker();

        this._logger.log("RTC.js is using " + strategy.getName());
    }

    (0, _createClass3.default)(RtcPeerConnectionFactory, [{
        key: '_isBrowserSupported',
        value: function _isBrowserSupported() {
            this._strategy._isBrowserSupported();
        }

        //This will handle the idleConnection and quota limits notification from the server

    }, {
        key: '_webSocketManagerOnMessage',
        value: function _webSocketManagerOnMessage(event) {
            var content = void 0;
            if (event.content) {
                content = JSON.parse(event.content);
            }
            if (content && this._clientId === content.clientId) {
                if (content.jsonRpcMsg.method === "idleConnection") {
                    this._clearIdleRtcPeerConnection();
                } else if (content.jsonRpcMsg.method === "quotaBreached") {
                    this._logger.log("Number of active sessions are more then allowed limit for the client " + this._clientId);
                    this._closeRTCPeerConnection();
                    this._publishError("multiple_softphone_active_sessions", "Number of active sessions are more then allowed limit.");
                }
            }
        }
    }, {
        key: '_initializeWebSocketEventListeners',
        value: function _initializeWebSocketEventListeners() {
            this._wssManager.subscribeTopics([_rtc_const.SOFTPHONE_ROUTE_KEY]);
            this._unSubscribe = this._wssManager.onMessage(_rtc_const.SOFTPHONE_ROUTE_KEY, (0, _utils.hitch)(this, this._webSocketManagerOnMessage));
        }

        // This method will create and return new peer connection if browser is not supporting early ice collection.
        // For the supported browser, this method will request for new peerConnection after returning the existing peerConnection

    }, {
        key: 'get',
        value: function get(iceServers) {
            var self = this;
            var pc = self._pc;
            self._pc = null;
            if (pc == null) {
                pc = self._createRtcPeerConnection(iceServers);
            }
            self.clearIdleRtcPeerConnectionTimerId();
            self._requestPeerConnection();
            return pc;
        }
    }, {
        key: 'clearIdleRtcPeerConnectionTimerId',
        value: function clearIdleRtcPeerConnectionTimerId() {
            var self = this;
            if (self._idleRtcPeerConnectionTimerId) {
                clearTimeout(self._idleRtcPeerConnectionTimerId);
                self._idleRtcPeerConnectionTimerId = null;
            }
        }
    }, {
        key: '_requestPeerConnection',
        value: function _requestPeerConnection() {
            var self = this;
            if (!self._peerConnectionRequestInFlight && self._browserSupported) {
                self._peerConnectionRequestInFlight = true;
                self._requestIceAccess().then(function (response) {
                    self._pc = self._createRtcPeerConnection(response);
                    self._peerConnectionRequestInFlight = false;
                    self._idleRtcPeerConnectionTimerId = setTimeout((0, _utils.hitch)(self, self._refreshRtcPeerConnection), _rtc_const.RTC_PEER_CONNECTION_IDLE_TIMEOUT_MS);
                },
                // eslint-disable-next-line no-unused-vars
                function (reason) {
                    self._peerConnectionRequestInFlight = false;
                });
            }
        }
    }, {
        key: '_networkConnectivityChecker',
        value: function _networkConnectivityChecker() {
            var self = this;
            setInterval(function () {
                if (!navigator.onLine && self._pc) {
                    self._logger.log("Network offline. Cleaning up early connection");
                    self._pc.close();
                    self._pc = null;
                }
            }, _rtc_const.NETWORK_CONNECTIVITY_CHECK_INTERVAL_MS);
        }
    }, {
        key: '_createRtcPeerConnection',
        value: function _createRtcPeerConnection(iceServers) {
            var rtcPeerConnectionConfig = JSON.parse(JSON.stringify(_rtc_const.RTC_PEER_CONNECTION_CONFIG));
            rtcPeerConnectionConfig.iceServers = iceServers;
            rtcPeerConnectionConfig.iceCandidatePoolSize = _rtc_const.DEFAULT_ICE_CANDIDATE_POOL_SIZE;
            return this._strategy._createRtcPeerConnection(rtcPeerConnectionConfig, _rtc_const.RTC_PEER_CONNECTION_OPTIONAL_CONFIG);
        }
    }, {
        key: '_clearIdleRtcPeerConnection',
        value: function _clearIdleRtcPeerConnection() {
            this._logger.log("session is idle from long time. closing the peer connection for client " + this._clientId);
            this._closeRTCPeerConnection();
        }
    }, {
        key: '_refreshRtcPeerConnection',
        value: function _refreshRtcPeerConnection() {
            this._idleRtcPeerConnectionTimerId = null;
            this._clearIdleRtcPeerConnection();
            this._logger.log("refreshing peer connection for client " + this._clientId);
            this._requestPeerConnection();
        }
    }, {
        key: '_closeRTCPeerConnection',
        value: function _closeRTCPeerConnection() {
            if (this._pc) {
                this._pc.close();
                this._pc = null;
            }
        }
    }]);
    return RtcPeerConnectionFactory;
}();

exports.default = RtcPeerConnectionFactory;

},{"./rtc_const":136,"./strategies/CCPInitiationStrategyInterface":142,"./strategies/StandardStrategy":144,"./utils":145,"babel-runtime/helpers/classCallCheck":11,"babel-runtime/helpers/createClass":12}],138:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.FailedState = exports.DisconnectedState = exports.CleanUpState = exports.TalkingState = exports.AcceptState = exports.InviteAnswerState = exports.ConnectSignalingAndIceCollectionState = exports.SetLocalSessionDescriptionState = exports.CreateOfferState = exports.GrabLocalMediaState = exports.RTCSessionState = undefined;

var _regenerator = require('babel-runtime/regenerator');

var _regenerator2 = _interopRequireDefault(_regenerator);

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _typeof2 = require('babel-runtime/helpers/typeof');

var _typeof3 = _interopRequireDefault(_typeof2);

var _get2 = require('babel-runtime/helpers/get');

var _get3 = _interopRequireDefault(_get2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _utils = require('./utils');

var _session_report = require('./session_report');

var _rtc_const = require('./rtc_const');

var _exceptions = require('./exceptions');

var _signaling = require('./signaling');

var _signaling2 = _interopRequireDefault(_signaling);

var _v = require('uuid/v4');

var _v2 = _interopRequireDefault(_v);

var _rtpStats = require('./rtp-stats');

var _sdp = require('sdp');

var _CCPInitiationStrategyInterface = require('./strategies/CCPInitiationStrategyInterface');

var _CCPInitiationStrategyInterface2 = _interopRequireDefault(_CCPInitiationStrategyInterface);

var _StandardStrategy = require('./strategies/StandardStrategy');

var _StandardStrategy2 = _interopRequireDefault(_StandardStrategy);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright 2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 * SPDX-License-Identifier: Apache-2.0
 */
var RTCSessionState = exports.RTCSessionState = function () {
    /**
     *
     * @param {RtcSession} rtcSession
     */
    function RTCSessionState(rtcSession) {
        (0, _classCallCheck3.default)(this, RTCSessionState);

        this._rtcSession = rtcSession;
    }

    (0, _createClass3.default)(RTCSessionState, [{
        key: 'onEnter',
        value: function onEnter() {}
    }, {
        key: 'onExit',
        value: function onExit() {}
    }, {
        key: '_isCurrentState',
        value: function _isCurrentState() {
            return this._rtcSession._state === this;
        }
    }, {
        key: 'transit',
        value: function transit(nextState) {
            if (this._isCurrentState()) {
                this._rtcSession.transit(nextState);
            }
        }
    }, {
        key: 'hangup',
        value: function hangup() {
            this.transit(new FailedState(this._rtcSession));
        }
    }, {
        key: 'onIceCandidate',
        value: function onIceCandidate(evt) {// eslint-disable-line no-unused-vars
            //ignore candidate by default, ConnectSignalingAndIceCollectionState will override to collect candidates, but collecting process could last much longer than ConnectSignalingAndIceCollectionState
            //we don't want to spam the console log
        }
    }, {
        key: 'onRemoteHungup',
        value: function onRemoteHungup() {
            throw new _exceptions.UnsupportedOperation('onRemoteHungup not implemented by ' + this.name);
        }
    }, {
        key: 'onSignalingConnected',
        value: function onSignalingConnected() {
            throw new _exceptions.UnsupportedOperation('onSignalingConnected not implemented by ' + this.name);
        }
    }, {
        key: 'onSignalingHandshaked',
        value: function onSignalingHandshaked() {
            throw new _exceptions.UnsupportedOperation('onSignalingHandshaked not implemented by ' + this.name);
        }
    }, {
        key: 'onSignalingFailed',
        value: function onSignalingFailed(e) {
            // eslint-disable-line no-unused-vars
            throw new _exceptions.UnsupportedOperation('onSignalingFailed not implemented by ' + this.name);
        }
    }, {
        key: 'onIceStateChange',
        value: function onIceStateChange(evt) {// eslint-disable-line no-unused-vars
        }
    }, {
        key: 'logger',
        get: function get() {
            return this._rtcSession._logger;
        }
    }, {
        key: 'name',
        get: function get() {
            return "RTCSessionState";
        }
    }]);
    return RTCSessionState;
}();

var GrabLocalMediaState = exports.GrabLocalMediaState = function (_RTCSessionState) {
    (0, _inherits3.default)(GrabLocalMediaState, _RTCSessionState);

    function GrabLocalMediaState() {
        (0, _classCallCheck3.default)(this, GrabLocalMediaState);
        return (0, _possibleConstructorReturn3.default)(this, (GrabLocalMediaState.__proto__ || Object.getPrototypeOf(GrabLocalMediaState)).apply(this, arguments));
    }

    (0, _createClass3.default)(GrabLocalMediaState, [{
        key: 'onEnter',
        value: function onEnter() {
            var self = this;
            var startTime = Date.now();
            if (self._rtcSession._isUserProvidedStream) {
                self.transit(new CreateOfferState(self._rtcSession));
            } else {
                var gumTimeoutPromise = new Promise(function (resolve, reject) {
                    setTimeout(function () {
                        reject(new _exceptions.GumTimeout('Local media has not been initialized yet.'));
                    }, self._rtcSession._gumTimeoutMillis);
                });
                var sessionGumPromise = self._gUM(self._rtcSession._buildMediaConstraints());

                Promise.race([sessionGumPromise, gumTimeoutPromise]).then(function (stream) {
                    self._rtcSession._sessionReport.gumTimeMillis = Date.now() - startTime;
                    self._rtcSession._onGumSuccess(self._rtcSession);
                    self._rtcSession._localStream = stream;
                    self._rtcSession._sessionReport.gumOtherFailure = false;
                    self._rtcSession._sessionReport.gumTimeoutFailure = false;
                    self.transit(new CreateOfferState(self._rtcSession));
                }).catch(function (e) {
                    self._rtcSession._sessionReport.gumTimeMillis = Date.now() - startTime;
                    var errorReason;
                    if (e instanceof _exceptions.GumTimeout) {
                        errorReason = _rtc_const.RTC_ERRORS.GUM_TIMEOUT_FAILURE;
                        self._rtcSession._sessionReport.gumTimeoutFailure = true;
                        self._rtcSession._sessionReport.gumOtherFailure = false;
                    } else {
                        errorReason = _rtc_const.RTC_ERRORS.GUM_OTHER_FAILURE;
                        self._rtcSession._sessionReport.gumOtherFailure = true;
                        self._rtcSession._sessionReport.gumTimeoutFailure = false;
                    }
                    self.logger.error('Local media initialization failed', e);
                    self._rtcSession._onGumError(self._rtcSession);
                    self.transit(new FailedState(self._rtcSession, errorReason));
                });
            }
        }
    }, {
        key: '_gUM',
        value: function _gUM(constraints) {
            return this._rtcSession._strategy._gUM(constraints);
        }
    }, {
        key: 'name',
        get: function get() {
            return "GrabLocalMediaState";
        }
    }]);
    return GrabLocalMediaState;
}(RTCSessionState);

var CreateOfferState = exports.CreateOfferState = function (_RTCSessionState2) {
    (0, _inherits3.default)(CreateOfferState, _RTCSessionState2);

    function CreateOfferState() {
        (0, _classCallCheck3.default)(this, CreateOfferState);
        return (0, _possibleConstructorReturn3.default)(this, (CreateOfferState.__proto__ || Object.getPrototypeOf(CreateOfferState)).apply(this, arguments));
    }

    (0, _createClass3.default)(CreateOfferState, [{
        key: 'onEnter',
        value: function onEnter() {
            var self = this;
            var stream = self._rtcSession._localStream;
            self._rtcSession._strategy.createOfferStateOnEnter(self._rtcSession._pc, stream);
            self._rtcSession._onLocalStreamAdded(self._rtcSession, stream);
            self._rtcSession._pc.createOffer().then(function (rtcSessionDescription) {
                self._rtcSession._localSessionDescription = rtcSessionDescription;
                self._rtcSession._sessionReport.createOfferFailure = false;
                self.transit(new SetLocalSessionDescriptionState(self._rtcSession));
            }).catch(function (e) {
                self.logger.error('CreateOffer failed', e);
                self._rtcSession._sessionReport.createOfferFailure = true;
                self.transit(new FailedState(self._rtcSession, _rtc_const.RTC_ERRORS.CREATE_OFFER_FAILURE));
            });
        }
    }, {
        key: 'name',
        get: function get() {
            return "CreateOfferState";
        }
    }]);
    return CreateOfferState;
}(RTCSessionState);

var SetLocalSessionDescriptionState = exports.SetLocalSessionDescriptionState = function (_RTCSessionState3) {
    (0, _inherits3.default)(SetLocalSessionDescriptionState, _RTCSessionState3);

    function SetLocalSessionDescriptionState() {
        (0, _classCallCheck3.default)(this, SetLocalSessionDescriptionState);
        return (0, _possibleConstructorReturn3.default)(this, (SetLocalSessionDescriptionState.__proto__ || Object.getPrototypeOf(SetLocalSessionDescriptionState)).apply(this, arguments));
    }

    (0, _createClass3.default)(SetLocalSessionDescriptionState, [{
        key: 'onEnter',
        value: function onEnter() {
            var self = this;

            // fix/modify SDP as needed here, before setLocalDescription
            var localDescription = self._rtcSession._localSessionDescription;
            var sdpOptions = new _utils.SdpOptions();
            // Set audio codec.
            if (self._rtcSession._forceAudioCodec) {
                sdpOptions.forceCodec['audio'] = self._rtcSession._forceAudioCodec;
            }
            // Set video codec.
            if (self._rtcSession._forceVideoCodec) {
                sdpOptions.forceCodec['video'] = self._rtcSession._forceVideoCodec;
            }
            sdpOptions.enableOpusDtx = self._rtcSession._enableOpusDtx;

            var transformedSdp = (0, _utils.transformSdp)(localDescription.sdp, sdpOptions);
            localDescription.sdp = transformedSdp.sdp;
            localDescription.sdp += 'a=ptime:20\r\n';
            localDescription.sdp += 'a=maxptime:20\r\n';
            localDescription.sdp = localDescription.sdp.replace("minptime=10", "minptime=20");

            self.logger.info('LocalSD', self._rtcSession._localSessionDescription);
            self._rtcSession._pc.setLocalDescription(self._rtcSession._localSessionDescription).then(function () {
                var initializationTime = Date.now() - self._rtcSession._connectTimeStamp;
                self._rtcSession._sessionReport.initializationTimeMillis = initializationTime;
                self._rtcSession._onSessionInitialized(self._rtcSession, initializationTime);
                self._rtcSession._sessionReport.setLocalDescriptionFailure = false;
                self.transit(new ConnectSignalingAndIceCollectionState(self._rtcSession, transformedSdp.mLines));
            }).catch(function (e) {
                self.logger.error('SetLocalDescription failed', e);
                self._rtcSession._sessionReport.setLocalDescriptionFailure = true;
                self.transit(new FailedState(self._rtcSession, _rtc_const.RTC_ERRORS.SET_LOCAL_DESCRIPTION_FAILURE));
            });
        }
    }, {
        key: 'name',
        get: function get() {
            return "SetLocalSessionDescriptionState";
        }
    }]);
    return SetLocalSessionDescriptionState;
}(RTCSessionState);

/**
 * Kick off signaling connection. Wait until signaling connects and ICE collection (which already started in previous state) completes.
 * ICE collection times out after user specified amount of time (default to DEFAULT_ICE_TIMEOUT_MS) in case user has complex network environment that blackholes STUN/TURN requests. In this case at least one candidate is required to move forward.
 * ICE collection could also wrap up before timeout if it's determined that RTP candidates from same TURN server have been collected for all m lines.
 */


var ConnectSignalingAndIceCollectionState = exports.ConnectSignalingAndIceCollectionState = function (_RTCSessionState4) {
    (0, _inherits3.default)(ConnectSignalingAndIceCollectionState, _RTCSessionState4);

    /**
     * Create ConnectSignalingAndIceCollectionState object.
     * @param {RtcSession} rtcSession
     * @param {number} mLines Number of m lines in SDP
     */
    function ConnectSignalingAndIceCollectionState(rtcSession, mLines) {
        (0, _classCallCheck3.default)(this, ConnectSignalingAndIceCollectionState);

        var _this4 = (0, _possibleConstructorReturn3.default)(this, (ConnectSignalingAndIceCollectionState.__proto__ || Object.getPrototypeOf(ConnectSignalingAndIceCollectionState)).call(this, rtcSession));

        _this4._iceCandidates = [];
        _this4._iceCandidateFoundationsMap = {};
        _this4._mLines = mLines;
        return _this4;
    }

    (0, _createClass3.default)(ConnectSignalingAndIceCollectionState, [{
        key: 'onEnter',
        value: function onEnter() {
            var self = this;
            self._startTime = Date.now();
            setTimeout(function () {
                if (self._isCurrentState() && !self._iceCompleted) {
                    self.logger.warn('ICE collection timed out');
                    self._reportIceCompleted(true);
                }
            }, self._rtcSession._iceTimeoutMillis);
            self._rtcSession._createSignalingChannel().connect();
        }
    }, {
        key: 'onSignalingConnected',
        value: function onSignalingConnected() {
            this._rtcSession._signallingConnectTimestamp = Date.now();
            this._rtcSession._sessionReport.signallingConnectTimeMillis = this._rtcSession._signallingConnectTimestamp - this._startTime;
            this._signalingConnected = true;
            this._rtcSession._onSignalingConnected(this._rtcSession);
            this._rtcSession._sessionReport.signallingConnectionFailure = false;
            this._checkAndTransit();
        }
    }, {
        key: 'onSignalingFailed',
        value: function onSignalingFailed(e) {
            this._rtcSession._sessionReport.signallingConnectTimeMillis = Date.now() - this._startTime;
            this.logger.error('Failed connecting to signaling server', e);
            this._rtcSession._sessionReport.signallingConnectionFailure = true;
            this.transit(new FailedState(this._rtcSession, _rtc_const.RTC_ERRORS.SIGNALLING_CONNECTION_FAILURE));
        }
    }, {
        key: '_createLocalCandidate',
        value: function _createLocalCandidate(initDict) {
            return new RTCIceCandidate(initDict);
        }
    }, {
        key: 'onIceCandidate',
        value: function onIceCandidate(evt) {
            var candidate = evt.candidate;
            this.logger.log('onicecandidate ' + JSON.stringify(candidate));
            if (candidate) {
                if (candidate.candidate) {
                    this._iceCandidates.push(this._createLocalCandidate(candidate));
                    if (!this._iceCompleted) {
                        this._checkCandidatesSufficient(candidate);
                    }
                }
            } else {
                this._reportIceCompleted(false);
            }
        }
    }, {
        key: '_checkCandidatesSufficient',
        value: function _checkCandidatesSufficient(candidate) {
            //check if we collected sufficient candidates from single media server to start the call
            var candidateObj = (0, _sdp.parseCandidate)(candidate.candidate);
            if (candidateObj.component != 1) {
                return;
            }
            var candidateFoundation = candidateObj.foundation;
            var candidateMLineIndex = candidate.sdpMLineIndex;
            if (candidateFoundation && candidateMLineIndex >= 0 && candidateMLineIndex < this._mLines) {
                var mIndexList = this._iceCandidateFoundationsMap[candidateFoundation] || [];
                if (!mIndexList.includes(candidateMLineIndex)) {
                    mIndexList.push(candidateMLineIndex);
                }
                this._iceCandidateFoundationsMap[candidateFoundation] = mIndexList;

                if (this._mLines == mIndexList.length) {
                    this._reportIceCompleted(false);
                }
            }
        }
    }, {
        key: '_reportIceCompleted',
        value: function _reportIceCompleted(isTimeout) {
            this._rtcSession._sessionReport.iceCollectionTimeMillis = Date.now() - this._startTime;
            this._iceCompleted = true;
            this._rtcSession._onIceCollectionComplete(this._rtcSession, isTimeout, this._iceCandidates.length);
            if (this._iceCandidates.length > 0) {
                this._rtcSession._sessionReport.iceCollectionFailure = false;
                this._checkAndTransit();
            } else {
                this.logger.error('No ICE candidate');
                this._rtcSession._sessionReport.iceCollectionFailure = true;
                this.transit(new FailedState(this._rtcSession, _rtc_const.RTC_ERRORS.ICE_COLLECTION_TIMEOUT));
            }
        }
    }, {
        key: '_checkAndTransit',
        value: function _checkAndTransit() {
            if (this._iceCompleted && this._signalingConnected) {
                this.transit(new InviteAnswerState(this._rtcSession, this._iceCandidates));
            } else if (!this._iceCompleted) {
                this.logger.log('Pending ICE collection');
            } else {
                //implies _signalingConnected == false
                this.logger.log('Pending signaling connection');
            }
        }
    }, {
        key: 'name',
        get: function get() {
            return "ConnectSignalingAndIceCollectionState";
        }
    }]);
    return ConnectSignalingAndIceCollectionState;
}(RTCSessionState);

var InviteAnswerState = exports.InviteAnswerState = function (_RTCSessionState5) {
    (0, _inherits3.default)(InviteAnswerState, _RTCSessionState5);

    function InviteAnswerState(rtcSession, iceCandidates) {
        (0, _classCallCheck3.default)(this, InviteAnswerState);

        var _this5 = (0, _possibleConstructorReturn3.default)(this, (InviteAnswerState.__proto__ || Object.getPrototypeOf(InviteAnswerState)).call(this, rtcSession));

        _this5._iceCandidates = iceCandidates;
        return _this5;
    }

    (0, _createClass3.default)(InviteAnswerState, [{
        key: 'onEnter',
        value: function onEnter() {
            var rtcSession = this._rtcSession;
            rtcSession._onSignalingStarted(rtcSession);
            rtcSession._signalingChannel.invite(rtcSession._localSessionDescription.sdp, this._iceCandidates);
        }
    }, {
        key: 'onSignalingAnswered',
        value: function onSignalingAnswered(sdp, candidates) {
            this._rtcSession._sessionReport.userBusyFailure = false;
            this._rtcSession._sessionReport.handshakingFailure = false;
            this.transit(new AcceptState(this._rtcSession, sdp, candidates));
        }
    }, {
        key: 'onSignalingFailed',
        value: function onSignalingFailed(e) {
            var reason;
            if (e.name == _exceptions.BusyExceptionName) {
                this.logger.error('User Busy, possibly multiple CCP windows open', e);
                this._rtcSession._sessionReport.userBusyFailure = true;
                this._rtcSession._sessionReport.handshakingFailure = true;
                reason = _rtc_const.RTC_ERRORS.USER_BUSY;
            } else if (e.name == _exceptions.CallNotFoundExceptionName) {
                this.logger.error('Call not found. One of the participant probably hungup.', e);
                reason = _rtc_const.RTC_ERRORS.CALL_NOT_FOUND;
                this._rtcSession._sessionReport.handshakingFailure = true;
            } else {
                this.logger.error('Failed handshaking with signaling server', e);
                this._rtcSession._sessionReport.userBusyFailure = false;
                this._rtcSession._sessionReport.handshakingFailure = true;
                reason = _rtc_const.RTC_ERRORS.SIGNALLING_HANDSHAKE_FAILURE;
            }
            this.transit(new FailedState(this._rtcSession, reason));
        }
    }, {
        key: 'name',
        get: function get() {
            return "InviteAnswerState";
        }
    }]);
    return InviteAnswerState;
}(RTCSessionState);

var AcceptState = exports.AcceptState = function (_RTCSessionState6) {
    (0, _inherits3.default)(AcceptState, _RTCSessionState6);

    function AcceptState(rtcSession, sdp, candidates) {
        (0, _classCallCheck3.default)(this, AcceptState);

        var _this6 = (0, _possibleConstructorReturn3.default)(this, (AcceptState.__proto__ || Object.getPrototypeOf(AcceptState)).call(this, rtcSession));

        _this6._sdp = sdp;
        _this6._candidates = candidates;
        return _this6;
    }

    (0, _createClass3.default)(AcceptState, [{
        key: '_createSessionDescription',
        value: function _createSessionDescription(initDict) {
            return new RTCSessionDescription(initDict);
        }
    }, {
        key: '_createRemoteCandidate',
        value: function _createRemoteCandidate(initDict) {
            return new RTCIceCandidate(initDict);
        }
    }, {
        key: 'onEnter',
        value: function onEnter() {
            var self = this;
            var rtcSession = self._rtcSession;

            if (!self._sdp) {
                self.logger.error('Invalid remote SDP');
                rtcSession._stopSession();
                rtcSession._sessionReport.invalidRemoteSDPFailure = true;
                self.transit(new FailedState(rtcSession, _rtc_const.RTC_ERRORS.INVALID_REMOTE_SDP));
                return;
            } else if (!self._candidates || self._candidates.length < 1) {
                self.logger.error('No remote ICE candidate');
                rtcSession._stopSession();
                rtcSession._sessionReport.noRemoteIceCandidateFailure = true;
                self.transit(new FailedState(rtcSession, _rtc_const.RTC_ERRORS.NO_REMOTE_ICE_CANDIDATE));
                return;
            }

            rtcSession._sessionReport.invalidRemoteSDPFailure = false;
            rtcSession._sessionReport.noRemoteIceCandidateFailure = false;
            self._rtcSession._strategy.acceptStateOnEnter(self, rtcSession);
        }
    }, {
        key: 'onSignalingHandshaked',
        value: function onSignalingHandshaked() {
            this._rtcSession._sessionReport.handshakingTimeMillis = Date.now() - this._rtcSession._signallingConnectTimestamp;
            this._signalingHandshaked = true;
            this._checkAndTransit();
        }
    }, {
        key: '_checkAndTransit',
        value: function _checkAndTransit() {
            if (this._signalingHandshaked && this._remoteDescriptionSet) {
                this.transit(new TalkingState(this._rtcSession));
            } else if (!this._signalingHandshaked) {
                this.logger.log('Pending handshaking');
            } else {
                //implies _remoteDescriptionSet == false
                this.logger.log('Pending setting remote description');
            }
        }
    }, {
        key: 'name',
        get: function get() {
            return "AcceptState";
        }
    }]);
    return AcceptState;
}(RTCSessionState);

var TalkingState = exports.TalkingState = function (_RTCSessionState7) {
    (0, _inherits3.default)(TalkingState, _RTCSessionState7);

    function TalkingState() {
        (0, _classCallCheck3.default)(this, TalkingState);
        return (0, _possibleConstructorReturn3.default)(this, (TalkingState.__proto__ || Object.getPrototypeOf(TalkingState)).apply(this, arguments));
    }

    (0, _createClass3.default)(TalkingState, [{
        key: 'onEnter',
        value: function onEnter() {
            this._startTime = Date.now();
            this._rtcSession._sessionReport.preTalkingTimeMillis = this._startTime - this._rtcSession._connectTimeStamp;
            this._rtcSession._onSessionConnected(this._rtcSession);
        }
    }, {
        key: 'onSignalingReconnected',
        value: function onSignalingReconnected() {}
    }, {
        key: 'onRemoteHungup',
        value: function onRemoteHungup() {
            this._rtcSession._signalingChannel.hangup();
            this.transit(new DisconnectedState(this._rtcSession));
        }
    }, {
        key: 'hangup',
        value: function hangup() {
            this._rtcSession._signalingChannel.hangup();
            this.transit(new DisconnectedState(this._rtcSession));
        }
    }, {
        key: 'onIceStateChange',
        value: function onIceStateChange(evt) {
            var iceState = this._rtcSession._strategy.onIceStateChange(evt, this._rtcSession._pc);
            this.logger.info('ICE Connection State: ', iceState);

            if (iceState == _rtc_const.ICE_CONNECTION_STATE.DISCONNECTED) {
                this.logger.info('Lost ICE connection');
                this._rtcSession._sessionReport.iceConnectionsLost += 1;
            }
            if (iceState == _rtc_const.ICE_CONNECTION_STATE.FAILED) {
                this._rtcSession._sessionReport.iceConnectionsFailed = true;
            }
        }
    }, {
        key: 'onPeerConnectionStateChange',
        value: function onPeerConnectionStateChange() {
            var peerConnectionState = this._rtcSession._strategy.onPeerConnectionStateChange(this._rtcSession._pc);
            this.logger.info('Peer Connection State: ', peerConnectionState);

            if (peerConnectionState == _rtc_const.PEER_CONNECTION_STATE.FAILED) {
                this._rtcSession._sessionReport.peerConnectionFailed = true;
            }
        }
    }, {
        key: 'onExit',
        value: function onExit() {
            this._rtcSession._sessionReport.talkingTimeMillis = Date.now() - this._startTime;
            this._rtcSession._detachMedia();
            this._rtcSession._sessionReport.sessionEndTime = new Date();
            this._rtcSession._onSessionCompleted(this._rtcSession);
        }
    }, {
        key: 'name',
        get: function get() {
            return "TalkingState";
        }
    }]);
    return TalkingState;
}(RTCSessionState);

var CleanUpState = exports.CleanUpState = function (_RTCSessionState8) {
    (0, _inherits3.default)(CleanUpState, _RTCSessionState8);

    function CleanUpState() {
        (0, _classCallCheck3.default)(this, CleanUpState);
        return (0, _possibleConstructorReturn3.default)(this, (CleanUpState.__proto__ || Object.getPrototypeOf(CleanUpState)).apply(this, arguments));
    }

    (0, _createClass3.default)(CleanUpState, [{
        key: 'onEnter',
        value: function onEnter() {
            this._startTime = Date.now();
            this._rtcSession._stopSession();
            this._rtcSession._sessionReport.cleanupTimeMillis = Date.now() - this._startTime;
            this._rtcSession._onSessionDestroyed(this._rtcSession, this._rtcSession._sessionReport);
        }
    }, {
        key: 'hangup',
        value: function hangup() {
            //do nothing, already at the end of lifecycle
        }
    }, {
        key: 'name',
        get: function get() {
            return "CleanUpState";
        }
    }]);
    return CleanUpState;
}(RTCSessionState);

var DisconnectedState = exports.DisconnectedState = function (_CleanUpState) {
    (0, _inherits3.default)(DisconnectedState, _CleanUpState);

    function DisconnectedState() {
        (0, _classCallCheck3.default)(this, DisconnectedState);
        return (0, _possibleConstructorReturn3.default)(this, (DisconnectedState.__proto__ || Object.getPrototypeOf(DisconnectedState)).apply(this, arguments));
    }

    (0, _createClass3.default)(DisconnectedState, [{
        key: 'name',
        get: function get() {
            return "DisconnectedState";
        }
    }]);
    return DisconnectedState;
}(CleanUpState);

var FailedState = exports.FailedState = function (_CleanUpState2) {
    (0, _inherits3.default)(FailedState, _CleanUpState2);

    function FailedState(rtcSession, failureReason) {
        (0, _classCallCheck3.default)(this, FailedState);

        var _this10 = (0, _possibleConstructorReturn3.default)(this, (FailedState.__proto__ || Object.getPrototypeOf(FailedState)).call(this, rtcSession));

        _this10._failureReason = failureReason;
        return _this10;
    }

    (0, _createClass3.default)(FailedState, [{
        key: 'onEnter',
        value: function onEnter() {
            this._rtcSession._sessionReport.sessionEndTime = new Date();
            this._rtcSession._onSessionFailed(this._rtcSession, this._failureReason);
            (0, _get3.default)(FailedState.prototype.__proto__ || Object.getPrototypeOf(FailedState.prototype), 'onEnter', this).call(this);
        }
    }, {
        key: 'name',
        get: function get() {
            return "FailedState";
        }
    }]);
    return FailedState;
}(CleanUpState);

var RtcSession = function () {
    /**
     * Build an AmazonConnect RTC session.
     * @param {*} signalingUri
     * @param {*} iceServers Array of ice servers
     * @param {*} contactToken A string representing the contact token (optional)
     * @param {*} logger An object provides logging functions, such as console
     * @param {*} contactId Must be UUID, uniquely identifies the session.
     */
    function RtcSession(signalingUri, iceServers, contactToken, logger, contactId, connectionId, wssManager) {
        var strategy = arguments.length > 7 && arguments[7] !== undefined ? arguments[7] : new _StandardStrategy2.default();
        (0, _classCallCheck3.default)(this, RtcSession);

        if (!(strategy instanceof _CCPInitiationStrategyInterface2.default)) {
            throw new Error('Expected a strategy of type CCPInitiationStrategyInterface');
        }
        if (typeof signalingUri !== 'string' || signalingUri.trim().length === 0) {
            throw new _exceptions.IllegalParameters('signalingUri required');
        }
        if (!iceServers) {
            throw new _exceptions.IllegalParameters('iceServers required');
        }
        if ((typeof logger === 'undefined' ? 'undefined' : (0, _typeof3.default)(logger)) !== 'object') {
            throw new _exceptions.IllegalParameters('logger required');
        }
        if (!contactId) {
            this._callId = (0, _v2.default)();
        } else {
            this._callId = contactId;
        }
        this._strategy = strategy;
        this._connectionId = connectionId;
        this._wssManager = wssManager;
        this._sessionReport = new _session_report.SessionReport();
        this._signalingUri = signalingUri;
        this._iceServers = iceServers;
        this._contactToken = contactToken;
        this._originalLogger = logger;
        this._logger = (0, _utils.wrapLogger)(this._originalLogger, this._callId, 'SESSION');
        this._iceTimeoutMillis = _rtc_const.DEFAULT_ICE_TIMEOUT_MS;
        this._gumTimeoutMillis = _rtc_const.DEFAULT_GUM_TIMEOUT_MS;

        this._enableAudio = true;
        this._enableVideo = false;
        this._facingMode = 'user';
        this._legacyStatsReportSupport = false;
        /**
         * user may provide the stream to the RtcSession directly to connect to the other end.
         * user may also acquire the stream from the local device.
         * This flag is used to track where the stream is acquired.
         * If it's acquired from local devices, then we must close the stream when the session ends.
         * If it's provided by user (rather than local camera/microphone), then we should leave it open when the
         * session ends.
         */
        this._isUserProvidedStream = false;

        this._onGumError = this._onGumSuccess = this._onLocalStreamAdded = this._onSessionFailed = this._onSessionInitialized = this._onSignalingConnected = this._onIceCollectionComplete = this._onSignalingStarted = this._onSessionConnected = this._onRemoteStreamAdded = this._onSessionCompleted = this._onSessionDestroyed = function () {};
    }

    (0, _createClass3.default)(RtcSession, [{
        key: 'pauseLocalVideo',
        value: function pauseLocalVideo() {
            if (this._localStream) {
                var videoTrack = this._localStream.getVideoTracks()[0];
                if (videoTrack) {
                    videoTrack.enabled = false;
                }
            }
        }
    }, {
        key: 'resumeLocalVideo',
        value: function resumeLocalVideo() {
            if (this._localStream) {
                var videoTrack = this._localStream.getVideoTracks()[0];
                if (videoTrack) {
                    videoTrack.enabled = true;
                }
            }
        }
    }, {
        key: 'pauseRemoteVideo',
        value: function pauseRemoteVideo() {
            if (this._remoteVideoStream) {
                var videoTrack = this._remoteVideoStream.getTracks()[1];
                if (videoTrack) {
                    videoTrack.enabled = false;
                }
            }
        }
    }, {
        key: 'resumeRemoteVideo',
        value: function resumeRemoteVideo() {
            if (this._remoteVideoStream) {
                var videoTrack = this._remoteVideoStream.getTracks()[1];
                if (videoTrack) {
                    videoTrack.enabled = true;
                }
            }
        }
    }, {
        key: 'pauseLocalAudio',
        value: function pauseLocalAudio() {
            if (this._localStream) {
                var audioTrack = this._localStream.getAudioTracks()[0];
                if (audioTrack) {
                    audioTrack.enabled = false;
                }
            }
        }
    }, {
        key: 'resumeLocalAudio',
        value: function resumeLocalAudio() {
            if (this._localStream) {
                var audioTrack = this._localStream.getAudioTracks()[0];
                if (audioTrack) {
                    audioTrack.enabled = true;
                }
            }
        }
    }, {
        key: 'pauseRemoteAudio',
        value: function pauseRemoteAudio() {
            if (this._remoteAudioStream) {
                var audioTrack = this._remoteAudioStream.getTracks()[0];
                if (audioTrack) {
                    audioTrack.enabled = false;
                }
            }
        }
    }, {
        key: 'resumeRemoteAudio',
        value: function resumeRemoteAudio() {
            if (this._remoteAudioStream) {
                var audioTrack = this._remoteAudioStream.getTracks()[0];
                if (audioTrack) {
                    audioTrack.enabled = true;
                }
            }
        }
        /**
         * Callback when gUM succeeds.
         * First param is RtcSession object.
         */

    }, {
        key: 'transit',
        value: function transit(nextState) {
            try {
                this._logger.info((this._state ? this._state.name : 'null') + ' => ' + nextState.name);
                if (this._state && this._state.onExit) {
                    this._state.onExit();
                }
            } finally {
                this._state = nextState;
                if (nextState.onEnter) {
                    try {
                        nextState.onEnter();
                    } catch (e) {
                        this._logger.warn(nextState.name + '#onEnter failed', e);
                        throw e; // eslint-disable-line no-unsafe-finally
                    }
                }
            }
        }
    }, {
        key: '_createSignalingChannel',
        value: function _createSignalingChannel() {
            var signalingChannel = new _signaling2.default(this._callId, this._signalingUri, this._contactToken, this._originalLogger, this._signalingConnectTimeout, this._connectionId, this._wssManager);
            signalingChannel.onConnected = (0, _utils.hitch)(this, this._signalingConnected);
            signalingChannel.onAnswered = (0, _utils.hitch)(this, this._signalingAnswered);
            signalingChannel.onHandshaked = (0, _utils.hitch)(this, this._signalingHandshaked);
            signalingChannel.onRemoteHungup = (0, _utils.hitch)(this, this._signalingRemoteHungup);
            signalingChannel.onFailed = (0, _utils.hitch)(this, this._signalingFailed);
            signalingChannel.onDisconnected = (0, _utils.hitch)(this, this._signalingDisconnected);

            this._signalingChannel = signalingChannel;

            return signalingChannel;
        }
    }, {
        key: '_signalingConnected',
        value: function _signalingConnected() {
            this._state.onSignalingConnected();
        }
    }, {
        key: '_signalingAnswered',
        value: function _signalingAnswered(sdp, candidates) {
            this._state.onSignalingAnswered(sdp, candidates);
        }
    }, {
        key: '_signalingHandshaked',
        value: function _signalingHandshaked() {
            this._state.onSignalingHandshaked();
        }
    }, {
        key: '_signalingRemoteHungup',
        value: function _signalingRemoteHungup() {
            this._state.onRemoteHungup();
        }
    }, {
        key: '_signalingFailed',
        value: function _signalingFailed(e) {
            this._state.onSignalingFailed(e);
        }
    }, {
        key: '_signalingDisconnected',
        value: function _signalingDisconnected() {}
    }, {
        key: '_createPeerConnection',
        value: function _createPeerConnection(configuration, optionalConfiguration) {
            return this._strategy._createPeerConnection(configuration, optionalConfiguration);
        }
    }, {
        key: 'connect',
        value: function connect(pc) {
            var self = this;
            var now = new Date();
            self._sessionReport.sessionStartTime = now;
            self._connectTimeStamp = now.getTime();
            if (pc && pc.signalingState != 'closed') {
                self._pc = pc;
            } else {
                if (pc) {
                    pc.close();
                    pc = null;
                }
                _rtc_const.RTC_PEER_CONNECTION_CONFIG.iceServers = self._iceServers;
                self._pc = self._createPeerConnection(_rtc_const.RTC_PEER_CONNECTION_CONFIG, _rtc_const.RTC_PEER_CONNECTION_OPTIONAL_CONFIG);
            }
            self._strategy.connect(self);
            self._pc.onicecandidate = (0, _utils.hitch)(self, self._onIceCandidate);
            self._pc.onconnectionstatechange = (0, _utils.hitch)(self, self._onPeerConnectionStateChange);
            self._pc.oniceconnectionstatechange = (0, _utils.hitch)(self, self._onIceStateChange);

            (0, _utils.isLegacyStatsReportSupported)(self._pc).then(function (result) {
                self._legacyStatsReportSupport = result;
                self.transit(new GrabLocalMediaState(self));
            });
        }
    }, {
        key: 'accept',
        value: function accept() {
            throw new _exceptions.UnsupportedOperation('accept does not go through signaling channel at this moment');
        }
    }, {
        key: 'hangup',
        value: function hangup() {
            this._state.hangup();
        }

        /**
         * Get a promise containing an object with two named lists of audio stats, one for each channel on each
         * media type of 'video' and 'audio'.
         * @return Rejected promise if failed to get MediaRtpStats. The promise is never resolved with null value.
         */

    }, {
        key: 'getStats',
        value: function () {
            var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee3() {
                var _this11 = this;

                var timestamp, impl, statsResult, rttReducer, audioInputRttMilliseconds, videoInputRttMilliseconds;
                return _regenerator2.default.wrap(function _callee3$(_context3) {
                    while (1) {
                        switch (_context3.prev = _context3.next) {
                            case 0:
                                timestamp = new Date();

                                impl = function () {
                                    var _ref2 = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee2(stream, streamType) {
                                        var tracks;
                                        return _regenerator2.default.wrap(function _callee2$(_context2) {
                                            while (1) {
                                                switch (_context2.prev = _context2.next) {
                                                    case 0:
                                                        tracks = [];

                                                        if (stream) {
                                                            _context2.next = 3;
                                                            break;
                                                        }

                                                        return _context2.abrupt('return', []);

                                                    case 3:
                                                        _context2.t0 = streamType;
                                                        _context2.next = _context2.t0 === 'audio_input' ? 6 : _context2.t0 === 'audio_output' ? 6 : _context2.t0 === 'video_input' ? 8 : _context2.t0 === 'video_output' ? 8 : 10;
                                                        break;

                                                    case 6:
                                                        tracks = stream.getAudioTracks();
                                                        return _context2.abrupt('break', 11);

                                                    case 8:
                                                        tracks = stream.getVideoTracks();
                                                        return _context2.abrupt('break', 11);

                                                    case 10:
                                                        throw new Error('Unsupported stream type while trying to get stats: ' + streamType);

                                                    case 11:
                                                        _context2.next = 13;
                                                        return Promise.all(tracks.map((0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {
                                                            return _regenerator2.default.wrap(function _callee$(_context) {
                                                                while (1) {
                                                                    switch (_context.prev = _context.next) {
                                                                        case 0:
                                                                            return _context.abrupt('return', _this11._pc.getStats().then(function (rawStats) {
                                                                                var digestedStats = (0, _rtpStats.extractMediaStatsFromStats)(timestamp, rawStats, streamType);
                                                                                if (!digestedStats) {
                                                                                    throw new Error('Failed to extract MediaRtpStats from RTCStatsReport for stream type ' + streamType);
                                                                                }
                                                                                return digestedStats;
                                                                            }));

                                                                        case 1:
                                                                        case 'end':
                                                                            return _context.stop();
                                                                    }
                                                                }
                                                            }, _callee, _this11);
                                                        }))));

                                                    case 13:
                                                        return _context2.abrupt('return', _context2.sent);

                                                    case 14:
                                                    case 'end':
                                                        return _context2.stop();
                                                }
                                            }
                                        }, _callee2, _this11);
                                    }));

                                    return function impl(_x2, _x3) {
                                        return _ref2.apply(this, arguments);
                                    };
                                }();

                                if (!(this._pc && this._pc.signalingState === 'stable')) {
                                    _context3.next = 26;
                                    break;
                                }

                                _context3.next = 5;
                                return impl(this._remoteAudioStream, 'audio_input');

                            case 5:
                                _context3.t0 = _context3.sent;
                                _context3.next = 8;
                                return impl(this._localStream, 'audio_output');

                            case 8:
                                _context3.t1 = _context3.sent;
                                _context3.t2 = {
                                    input: _context3.t0,
                                    output: _context3.t1
                                };
                                _context3.next = 12;
                                return impl(this._remoteVideoStream, 'video_input');

                            case 12:
                                _context3.t3 = _context3.sent;
                                _context3.next = 15;
                                return impl(this._localStream, 'video_output');

                            case 15:
                                _context3.t4 = _context3.sent;
                                _context3.t5 = {
                                    input: _context3.t3,
                                    output: _context3.t4
                                };
                                statsResult = {
                                    audio: _context3.t2,
                                    video: _context3.t5
                                };

                                // For consistency's sake, coalesce rttMilliseconds into the output for audio and video.
                                rttReducer = function rttReducer(acc, stats) {
                                    if (stats.rttMilliseconds !== null && (acc === null || stats.rttMilliseconds > acc)) {
                                        acc = stats.rttMilliseconds;
                                    }
                                    stats._rttMilliseconds = null;
                                    return acc;
                                };

                                audioInputRttMilliseconds = statsResult.audio.input.reduce(rttReducer, null);
                                videoInputRttMilliseconds = statsResult.video.input.reduce(rttReducer, null);


                                if (audioInputRttMilliseconds !== null) {
                                    statsResult.audio.output.forEach(function (stats) {
                                        stats._rttMilliseconds = audioInputRttMilliseconds;
                                    });
                                }

                                if (videoInputRttMilliseconds !== null) {
                                    statsResult.video.output.forEach(function (stats) {
                                        stats._rttMilliseconds = videoInputRttMilliseconds;
                                    });
                                }

                                return _context3.abrupt('return', statsResult);

                            case 26:
                                return _context3.abrupt('return', Promise.reject(new _exceptions.IllegalState()));

                            case 27:
                            case 'end':
                                return _context3.stop();
                        }
                    }
                }, _callee3, this);
            }));

            function getStats() {
                return _ref.apply(this, arguments);
            }

            return getStats;
        }()

        /**
         * Get a promise of MediaRtpStats object for remote audio (from Amazon Connect to client).
         * @return Rejected promise if failed to get MediaRtpStats. The promise is never resolved with null value.
         * @deprecated in favor of getStats()
         */

    }, {
        key: 'getRemoteAudioStats',
        value: function getRemoteAudioStats() {
            return this.getStats().then(function (stats) {
                if (stats.audio.output.length > 0) {
                    return stats.audio.output[0];
                } else {
                    return Promise.reject(new _exceptions.IllegalState());
                }
            });
        }

        /**
         * Get a promise of MediaRtpStats object for user audio (from client to Amazon Connect).
         * @return Rejected promise if failed to get MediaRtpStats. The promise is never resolved with null value.
         * @deprecated in favor of getStats()
         */

    }, {
        key: 'getUserAudioStats',
        value: function getUserAudioStats() {
            return this.getStats().then(function (stats) {
                if (stats.audio.input.length > 0) {
                    return stats.audio.input[0];
                } else {
                    return Promise.reject(new _exceptions.IllegalState());
                }
            });
        }

        /**
         * Get a promise of MediaRtpStats object for user video (from client to Amazon Connect).
         * @return Rejected promise if failed to get MediaRtpStats. The promise is never resolved with null value.
         * @deprecated in favor of getStats()
         */

    }, {
        key: 'getRemoteVideoStats',
        value: function getRemoteVideoStats() {
            return this.getStats().then(function (stats) {
                if (stats.video.output.length > 0) {
                    return stats.video.output[0];
                } else {
                    return Promise.reject(new _exceptions.IllegalState());
                }
            });
        }

        /**
         * Get a promise of MediaRtpStats object for user video (from client to Amazon Connect).
         * @return Rejected promise if failed to get MediaRtpStats. The promise is never resolved with null value.
         * @deprecated in favor of getStats()
         */

    }, {
        key: 'getUserVideoStats',
        value: function getUserVideoStats() {
            return this.getStats().then(function (stats) {
                if (stats.video.input.length > 0) {
                    return stats.video.input[0];
                } else {
                    return Promise.reject(new _exceptions.IllegalState());
                }
            });
        }
    }, {
        key: '_onIceCandidate',
        value: function _onIceCandidate(evt) {
            this._state.onIceCandidate(evt);
        }
    }, {
        key: '_onPeerConnectionStateChange',
        value: function _onPeerConnectionStateChange() {
            this._state.onPeerConnectionStateChange();
        }
    }, {
        key: '_onIceStateChange',
        value: function _onIceStateChange(evt) {
            this._state.onIceStateChange(evt);
        }

        /**
         * Attach remote media stream to web element.
         */

    }, {
        key: '_ontrack',
        value: function _ontrack(evt) {
            this._strategy._ontrack(this, evt);
            this._onRemoteStreamAdded(this, evt.streams[0]);
        }
    }, {
        key: '_detachMedia',
        value: function _detachMedia() {
            if (this._remoteVideoElement) {
                this._remoteVideoElement.srcObject = null;
            }
            if (this._remoteAudioElement) {
                this._remoteAudioElement.srcObject = null;
                this._remoteAudioStream = null;
            }
        }
    }, {
        key: '_stopSession',
        value: function _stopSession() {
            try {
                if (this._localStream && !this._isUserProvidedStream) {
                    (0, _utils.closeStream)(this._localStream);
                    this._localStream = null;
                    this._isUserProvidedStream = false;
                }
            } finally {
                try {
                    if (this._pc) {
                        this._pc.close();
                    }
                } catch (e) {
                    // eat exception
                } finally {
                    this._pc = null;
                }
            }
        }
    }, {
        key: '_buildMediaConstraints',
        value: function _buildMediaConstraints() {
            var self = this;
            var mediaConstraints = {};

            self._strategy._buildMediaConstraints(self, mediaConstraints);

            if (self._enableVideo) {
                var videoConstraints = {};
                var widthConstraints = {};
                var heightConstraints = {};
                var frameRateConstraints = {};

                //build video width constraints
                if (typeof self._idealVideoWidth !== 'undefined') {
                    widthConstraints.ideal = self._idealVideoWidth;
                }
                if (typeof self._maxVideoWidth !== 'undefined') {
                    widthConstraints.max = self._maxVideoWidth;
                }
                if (typeof self._minVideoWidth !== 'undefined') {
                    widthConstraints.min = self._minVideoWidth;
                }
                // build video height constraints
                if (typeof self._idealVideoHeight !== 'undefined') {
                    heightConstraints.ideal = self._idealVideoHeight;
                }
                if (typeof self._maxVideoHeight !== 'undefined') {
                    heightConstraints.max = self._maxVideoHeight;
                }
                if (typeof self._minVideoHeight !== 'undefined') {
                    heightConstraints.min = self._minVideoHeight;
                }
                if (Object.keys(widthConstraints).length > 0 && Object.keys(heightConstraints).length > 0) {
                    videoConstraints.width = widthConstraints;
                    videoConstraints.height = heightConstraints;
                }
                // build frame rate constraints
                if (typeof self._videoFrameRate !== 'undefined') {
                    frameRateConstraints.ideal = self._videoFrameRate;
                }
                if (typeof self._minVideoFrameRate !== 'undefined') {
                    frameRateConstraints.min = self._minVideoFrameRate;
                }
                if (typeof self._maxVideoFrameRate !== 'undefined') {
                    frameRateConstraints.max = self._maxVideoFrameRate;
                }
                if (Object.keys(frameRateConstraints).length > 0) {
                    videoConstraints.frameRate = frameRateConstraints;
                }

                // build facing mode constraints
                if (self._facingMode !== 'user' && self._facingMode !== "environment") {
                    self._facingMode = 'user';
                }
                videoConstraints.facingMode = self._facingMode;

                // set video constraints
                if (Object.keys(videoConstraints).length > 0) {
                    mediaConstraints.video = videoConstraints;
                } else {
                    mediaConstraints.video = true;
                }
            }

            return mediaConstraints;
        }
    }, {
        key: 'sessionReport',
        get: function get() {
            return this._sessionReport;
        }
    }, {
        key: 'callId',
        get: function get() {
            return this._callId;
        }
        /**
         * getMediaStream returns the local stream, which may be acquired from local device or from user provided stream.
         * Rather than getting a stream by calling getUserMedia (which gets a stream from local device such as camera),
         * user could also provide the stream to the RtcSession directly to connect to the other end.
         */

    }, {
        key: 'mediaStream',
        get: function get() {
            return this._localStream;
        },

        /**
         * Optional. RtcSession will grab input device if this is not specified.
         * Please note: this RtcSession class only support single audio track and/or single video track.
         */
        set: function set(input) {
            this._localStream = input;
            this._isUserProvidedStream = true;
        }
        /**
         * Needed, expect an audio element that can be used to play remote audio stream.
         */

    }, {
        key: 'remoteVideoStream',
        get: function get() {
            return this._remoteVideoStream;
        }
    }, {
        key: 'onGumSuccess',
        set: function set(handler) {
            this._onGumSuccess = handler;
        }
        /**
         * Callback when gUM fails.
         * First param is RtcSession object.
         * Second param is the error.
         */

    }, {
        key: 'onGumError',
        set: function set(handler) {
            this._onGumError = handler;
        }
        /**
         * Callback if failed initializing local resources
         * First param is RtcSession object.
         */

    }, {
        key: 'onSessionFailed',
        set: function set(handler) {
            this._onSessionFailed = handler;
        }
        /**
         * Callback after local user media stream is added to the session.
         * First param is RtcSession object.
         * Second param is media stream
         */

    }, {
        key: 'onLocalStreamAdded',
        set: function set(handler) {
            this._onLocalStreamAdded = handler;
        }
        /**
         * Callback when all local resources are ready. Establishing signaling chanel and ICE collection happens at the same time after this.
         * First param is RtcSession object.
         */

    }, {
        key: 'onSessionInitialized',
        set: function set(handler) {
            this._onSessionInitialized = handler;
        }
        /**
         * Callback when signaling channel is established.
         * RTC session will move forward only if onSignalingConnected and onIceCollectionComplete are both called.
         *
         * First param is RtcSession object.
         */

    }, {
        key: 'onSignalingConnected',
        set: function set(handler) {
            this._onSignalingConnected = handler;
        }
        /**
         * Callback when ICE collection completes either because there is no more candidate or collection timed out.
         * RTC session will move forward only if onSignalingConnected and onIceCollectionComplete are both called.
         *
         * First param is RtcSession object.
         * Second param is boolean, TRUE - ICE collection timed out.
         * Third param is number of candidates collected.
         */

    }, {
        key: 'onIceCollectionComplete',
        set: function set(handler) {
            this._onIceCollectionComplete = handler;
        }
        /**
         * Callback when signaling channel is established and ICE collection completed with at least one candidate.
         * First param is RtcSession object.
         */

    }, {
        key: 'onSignalingStarted',
        set: function set(handler) {
            this._onSignalingStarted = handler;
        }
        /**
         * Callback when the call is established (handshaked and media stream should be flowing)
         * First param is RtcSession object.
         */

    }, {
        key: 'onSessionConnected',
        set: function set(handler) {
            this._onSessionConnected = handler;
        }
        /**
         * Callback after remote media stream is added to the session.
         * This could be called multiple times with the same stream if multiple tracks are included in the same stream.
         *
         * First param is RtcSession object.
         * Second param is media stream track.
         */

    }, {
        key: 'onRemoteStreamAdded',
        set: function set(handler) {
            this._onRemoteStreamAdded = handler;
        }
        /**
         * Callback when the hangup is initiated (implies the call was successfully established).
         * First param is RtcSession object.
         */

    }, {
        key: 'onSessionCompleted',
        set: function set(handler) {
            this._onSessionCompleted = handler;
        }
        /**
         * Callback after session is cleaned up, no matter if the call was successfully established or not.
         * First param is RtcSession object.
         * Second param is SessionReport object.
         */

    }, {
        key: 'onSessionDestroyed',
        set: function set(handler) {
            this._onSessionDestroyed = handler;
        }
    }, {
        key: 'enableAudio',
        set: function set(flag) {
            this._enableAudio = flag;
        }
    }, {
        key: 'echoCancellation',
        set: function set(flag) {
            this._echoCancellation = flag;
        }
    }, {
        key: 'enableVideo',
        set: function set(flag) {
            this._enableVideo = flag;
        }
    }, {
        key: 'maxVideoFrameRate',
        set: function set(frameRate) {
            this._maxVideoFrameRate = frameRate;
        }
    }, {
        key: 'minVideoFrameRate',
        set: function set(frameRate) {
            this._minVideoFrameRate = frameRate;
        }
    }, {
        key: 'videoFrameRate',
        set: function set(frameRate) {
            this._videoFrameRate = frameRate;
        }
    }, {
        key: 'maxVideoWidth',
        set: function set(width) {
            this._maxVideoWidth = width;
        }
    }, {
        key: 'minVideoWidth',
        set: function set(width) {
            this._minVideoWidth = width;
        }
    }, {
        key: 'idealVideoWidth',
        set: function set(width) {
            this._idealVideoWidth = width;
        }
    }, {
        key: 'maxVideoHeight',
        set: function set(height) {
            this._maxVideoHeight = height;
        }
    }, {
        key: 'minVideoHeight',
        set: function set(height) {
            this._minVideoHeight = height;
        }
    }, {
        key: 'idealVideoHeight',
        set: function set(height) {
            this._idealVideoHeight = height;
        }
    }, {
        key: 'facingMode',
        set: function set(mode) {
            this._facingMode = mode;
        }
    }, {
        key: 'remoteAudioElement',
        set: function set(element) {
            this._remoteAudioElement = element;
        }
    }, {
        key: 'remoteVideoElement',
        set: function set(element) {
            this._remoteVideoElement = element;
        }
        /**
         * Override the default signaling connect time out.
         */

    }, {
        key: 'signalingConnectTimeout',
        set: function set(ms) {
            this._signalingConnectTimeout = ms;
        }
        /**
         * Override the default ICE collection time limit.
         */

    }, {
        key: 'iceTimeoutMillis',
        set: function set(timeoutMillis) {
            this._iceTimeoutMillis = timeoutMillis;
        }
        /**
         * Override the default GUM timeout time limit.
         */

    }, {
        key: 'gumTimeoutMillis',
        set: function set(timeoutMillis) {
            this._gumTimeoutMillis = timeoutMillis;
        }
        /**
         * connect-rtc-js initiate the handshaking with all browser supported codec by default, Amazon Connect service will choose the codec according to its preference setting.
         * Setting this attribute will force connect-rtc-js to only use specified codec.
         * WARNING: Setting this to unsupported codec will cause the failure of handshaking.
         * Supported audio codecs: opus.
         */

    }, {
        key: 'forceAudioCodec',
        set: function set(audioCodec) {
            this._forceAudioCodec = audioCodec;
        }

        /**
         * connect-rtc-js initiate the handshaking with all browser supported codec by default, Amazon Connect service will choose the codec according to its preference setting.
         * Setting this attribute will force connect-rtc-js to only use specified codec.
         * WARNING: Setting this to unsupported codec will cause the failure of handshaking.
         * Supported video codecs: VP8, VP9, H264.
         */

    }, {
        key: 'forceVideoCodec',
        set: function set(videoCodec) {
            this._forceVideoCodec = videoCodec;
        }

        /**
         * connect-rtc-js disables OPUS DTX by default because it harms audio quality.
         * @param flag boolean
         */

    }, {
        key: 'enableOpusDtx',
        set: function set(flag) {
            this._enableOpusDtx = flag;
        }
    }]);
    return RtcSession;
}();

exports.default = RtcSession;

},{"./exceptions":135,"./rtc_const":136,"./rtp-stats":139,"./session_report":140,"./signaling":141,"./strategies/CCPInitiationStrategyInterface":142,"./strategies/StandardStrategy":144,"./utils":145,"babel-runtime/helpers/asyncToGenerator":10,"babel-runtime/helpers/classCallCheck":11,"babel-runtime/helpers/createClass":12,"babel-runtime/helpers/get":13,"babel-runtime/helpers/inherits":14,"babel-runtime/helpers/possibleConstructorReturn":15,"babel-runtime/helpers/typeof":16,"babel-runtime/regenerator":19,"sdp":118,"uuid/v4":121}],139:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

exports.extractMediaStatsFromStats = extractMediaStatsFromStats;

var _utils = require('./utils');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function extractMediaStatsFromStats(timestamp, stats, streamType) {
    var extractedStats = null;
    var reportType = null;

    stats.forEach(function (statsReport) {
        if (statsReport) {
            if (statsReport.type === 'inbound-rtp' && streamType === 'audio_input') {
                // inbound-rtp: Stats for stream from Server to CCP, as seen on the browser
                reportType = statsReport.type;
                extractedStats = {
                    timestamp: timestamp,
                    packetsLost: statsReport.packetsLost,
                    // packetsCount: number of packet received by CCP, as seen on the browser
                    packetsCount: statsReport.packetsReceived,
                    jbMilliseconds: Math.floor((0, _utils.when_defined)(statsReport.jitter, 0) * 1000),
                    // Multiplying audioLevel by 32768 aligns its value with the legacy getStats API.
                    audioLevel: (0, _utils.is_defined)(statsReport.audioLevel) ? Math.floor(statsReport.audioLevel * 32768) : null
                };
            } else if (statsReport.type === 'outbound-rtp' && streamType === 'audio_output') {
                // outbound-rtp: Stats for stream from CCP to Server, as seen on the browser
                extractedStats = extractedStats || {};
                // packetsCount: number of packet sent by CCP, as seen on the browser
                extractedStats.packetsCount = statsReport.packetsSent;
            } else if (statsReport.type === 'media-source' && streamType === 'audio_output') {
                extractedStats = extractedStats || {};
                // Multiplying audioLevel by 32768 aligns its value with the legacy getStats API.
                extractedStats.audioLevel = (0, _utils.is_defined)(statsReport.audioLevel) ? Math.floor(statsReport.audioLevel * 32768) : null;
            } else if (statsReport.type === 'remote-inbound-rtp' && streamType === 'audio_output') {
                // remote-inbound-rtp: Stats for stream from CCP to Server, as seen on Server side
                reportType = statsReport.type;
                extractedStats = extractedStats || {};
                extractedStats.timestamp = timestamp;
                extractedStats.packetsLost = statsReport.packetsLost;
                extractedStats.rttMilliseconds = (0, _utils.is_defined)(statsReport.roundTripTime) ? Math.floor(statsReport.roundTripTime * 1000) : null;
                extractedStats.jbMilliseconds = Math.floor((0, _utils.when_defined)(statsReport.jitter, 0) * 1000);
            }
        }
    });

    return extractedStats ? new MediaRtpStats(extractedStats, reportType, streamType) : null;
}

/**
 * Basic RTP statistics object, represents statistics of an audio or video stream.
 */
/**
 * Extract rtp stats of specified stream from RTCStatsReport
 * Chrome reports all stream stats in statsReports whereas firefox reports only single stream stats in report
 * StreamType is passed only to pull right stream stats audio_input or audio_output.
 */

var MediaRtpStats = function () {
    function MediaRtpStats(paramsIn, statsReportType, streamType) {
        (0, _classCallCheck3.default)(this, MediaRtpStats);

        var params = paramsIn || {};

        this._timestamp = params.timestamp || new Date().getTime();
        this._packetsLost = (0, _utils.when_defined)(params.packetsLost);
        this._packetsCount = (0, _utils.when_defined)(params.packetsCount);
        this._audioLevel = (0, _utils.when_defined)(params.audioLevel);
        this._procMilliseconds = (0, _utils.when_defined)(params.procMilliseconds);
        this._rttMilliseconds = (0, _utils.when_defined)(params.rttMilliseconds);
        this._jbMilliseconds = (0, _utils.when_defined)(params.jbMilliseconds);
        this._bytesSent = (0, _utils.when_defined)(params.bytesSent);
        this._bytesReceived = (0, _utils.when_defined)(params.bytesReceived);
        this._framesEncoded = (0, _utils.when_defined)(params.framesEncoded);
        this._framesDecoded = (0, _utils.when_defined)(params.framesDecoded);
        this._frameRateSent = (0, _utils.when_defined)(params.frameRateSent);
        this._frameRateReceived = (0, _utils.when_defined)(params.frameRateReceived);
        this._statsReportType = statsReportType || params._statsReportType || "unknown";
        this._streamType = streamType || params.streamType || "unknown";
    }

    /** {number} number of packets sent to the channel */


    (0, _createClass3.default)(MediaRtpStats, [{
        key: 'packetsCount',
        get: function get() {
            return this._packetsCount;
        }
        /** {number} number of packets lost after travelling through the channel */

    }, {
        key: 'packetsLost',
        get: function get() {
            return this._packetsLost;
        }
        /** {number} number of packets lost after travelling through the channel */

    }, {
        key: 'packetLossPercentage',
        get: function get() {
            return this._packetsCount > 0 ? this._packetsLost / this._packetsCount : 0;
        }
        /** Audio volume level
         * Currently firefox doesn't provide audio level in rtp stats.
         */

    }, {
        key: 'audioLevel',
        get: function get() {
            return this._audioLevel;
        }
        /** Timestamp when stats are collected. */

    }, {
        key: 'timestamp',
        get: function get() {
            return this._timestamp;
        }
        /** {number} Processing delay calculated by time to process packet header */

    }, {
        key: 'procMilliseconds',
        get: function get() {
            return this._procMilliseconds;
        }
        /** {number} Round trip time calculated with RTCP reports */

    }, {
        key: 'rttMilliseconds',
        get: function get() {
            return this._rttMilliseconds;
        }
        /** {number} Statistical variance of RTP data packet inter-arrival time */

    }, {
        key: 'jbMilliseconds',
        get: function get() {
            return this._jbMilliseconds;
        }
        /** {number} number of bytes sent to the channel*/

    }, {
        key: 'bytesSent',
        get: function get() {
            return this._bytesSent;
        }
        /** {number} number of bytes received from the channel*/

    }, {
        key: 'bytesReceived',
        get: function get() {
            return this._bytesReceived;
        }
        /** {number} number of video frames encoded*/

    }, {
        key: 'framesEncoded',
        get: function get() {
            return this._framesEncoded;
        }
        /** {number} number of video frames decoded*/

    }, {
        key: 'framesDecoded',
        get: function get() {
            return this._framesDecoded;
        }
        /** {number} frames per second sent to the channel*/

    }, {
        key: 'frameRateSent',
        get: function get() {
            return this._frameRateSent;
        }
        /** {number} frames per second received from the channel*/

    }, {
        key: 'frameRateReceived',
        get: function get() {
            return this._frameRateReceived;
        }
        /** {string} the type of the stats report */

    }, {
        key: 'statsReportType',
        get: function get() {
            return this._statsReportType;
        }
        /** {string} the type of the stream */

    }, {
        key: 'streamType',
        get: function get() {
            return this._streamType;
        }
    }]);
    return MediaRtpStats;
}();

},{"./utils":145,"babel-runtime/helpers/classCallCheck":11,"babel-runtime/helpers/createClass":12}],140:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.SessionReport = undefined;

var _classCallCheck2 = require("babel-runtime/helpers/classCallCheck");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require("babel-runtime/helpers/createClass");

var _createClass3 = _interopRequireDefault(_createClass2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright 2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 * SPDX-License-Identifier: Apache-2.0
 */

var SessionReport = exports.SessionReport = function () {
    /**
     * @class Prototype for tracking various RTC session report
     * @constructs
     */
    function SessionReport() {
        (0, _classCallCheck3.default)(this, SessionReport);

        this._sessionStartTime = null;
        this._sessionEndTime = null;
        this._gumTimeMillis = null;
        this._initializationTimeMillis = null;
        this._iceCollectionTimeMillis = null;
        this._signallingConnectTimeMillis = null;
        this._handshakingTimeMillis = null;
        this._preTalkingTimeMillis = null;
        this._talkingTimeMillis = null;
        this._iceConnectionsLost = 0;
        this._iceConnectionsFailed = null;
        this._peerConnectionFailed = null;
        this._cleanupTimeMillis = null;
        this._iceCollectionFailure = null;
        this._signallingConnectionFailure = null;
        this._handshakingFailure = null;
        this._gumOtherFailure = null;
        this._gumTimeoutFailure = null;
        this._createOfferFailure = null;
        this._setLocalDescriptionFailure = null;
        this._userBusyFailure = null;
        this._invalidRemoteSDPFailure = null;
        this._noRemoteIceCandidateFailure = null;
        this._setRemoteDescriptionFailure = null;
        this._streamStats = [];
        this._rtcJsVersion = "1.1.21";
    }
    /**
     *Timestamp when RTCSession started.
     */


    (0, _createClass3.default)(SessionReport, [{
        key: "sessionStartTime",
        get: function get() {
            return this._sessionStartTime;
        }
        /**
         * Timestamp when RTCSession ended.
         */
        ,
        set: function set(value) {
            this._sessionStartTime = value;
        }
    }, {
        key: "sessionEndTime",
        get: function get() {
            return this._sessionEndTime;
        }
        /**
         * Time taken for grabbing user microphone at the time of connecting RTCSession.
         */
        ,
        set: function set(value) {
            this._sessionEndTime = value;
        }
    }, {
        key: "gumTimeMillis",
        get: function get() {
            return this._gumTimeMillis;
        }
        /**
         * Time taken for session initialization in millis. Includes time spent in GrabLocalMedia, SetLocalSDP states.
         */
        ,
        set: function set(value) {
            this._gumTimeMillis = value;
        }
    }, {
        key: "initializationTimeMillis",
        get: function get() {
            return this._initializationTimeMillis;
        }
        /**
         * Time spent on ICECollection in millis.
         */
        ,
        set: function set(value) {
            this._initializationTimeMillis = value;
        }
    }, {
        key: "iceCollectionTimeMillis",
        get: function get() {
            return this._iceCollectionTimeMillis;
        }
        /**
         * Time taken for connecting the signalling in millis.
         */
        ,
        set: function set(value) {
            this._iceCollectionTimeMillis = value;
        }
    }, {
        key: "signallingConnectTimeMillis",
        get: function get() {
            return this._signallingConnectTimeMillis;
        }
        /**
         * Times spent from RTCSession connection until entering Talking state in millis.
         */
        ,
        set: function set(value) {
            this._signallingConnectTimeMillis = value;
        }
    }, {
        key: "preTalkingTimeMillis",
        get: function get() {
            return this._preTalkingTimeMillis;
        }
        /**
         *  Times spent in completing handshaking process of the RTCSession in millis.
         */
        ,
        set: function set(value) {
            this._preTalkingTimeMillis = value;
        }
    }, {
        key: "handshakingTimeMillis",
        get: function get() {
            return this._handshakingTimeMillis;
        }
        /**
         *  Times spent in Talking state in millis.
         */
        ,
        set: function set(value) {
            this._handshakingTimeMillis = value;
        }
    }, {
        key: "talkingTimeMillis",
        get: function get() {
            return this._talkingTimeMillis;
        }
        /**
         * How many times the RTCSession has lost ICE connection in talking state.
         */
        ,
        set: function set(value) {
            this._talkingTimeMillis = value;
        }
    }, {
        key: "iceConnectionsLost",
        get: function get() {
            return this._iceConnectionsLost;
        }
        /**
         * Tells if the RTCSession has failed RTCPeerConnection.iceConnectionState
         */
        ,
        set: function set(value) {
            this._iceConnectionsLost = value;
        }
    }, {
        key: "iceConnectionsFailed",
        get: function get() {
            return this._iceConnectionsFailed;
        }
        /**
         * Tells if the RTCSession has failed RTCPeerConnection.connectionState
         */
        ,
        set: function set(value) {
            this._iceConnectionsFailed = value;
        }
    }, {
        key: "peerConnectionFailed",
        get: function get() {
            return this._peerConnectionFailed;
        }
        /**
         * Times spent in Cleanup state in millis
         */
        ,
        set: function set(value) {
            this._peerConnectionFailed = value;
        }
    }, {
        key: "cleanupTimeMillis",
        get: function get() {
            return this._cleanupTimeMillis;
        }
        /**
         * Tells if the RTCSession fails in ICECollection.
         */
        ,
        set: function set(value) {
            this._cleanupTimeMillis = value;
        }
    }, {
        key: "iceCollectionFailure",
        get: function get() {
            return this._iceCollectionFailure;
        }
        /**
         * Tells if the RTCSession failed in signalling connect stage.
         */
        ,
        set: function set(value) {
            this._iceCollectionFailure = value;
        }
    }, {
        key: "signallingConnectionFailure",
        get: function get() {
            return this._signallingConnectionFailure;
        }
        /**
         * Handshaking failure of the RTCSession
         */
        ,
        set: function set(value) {
            this._signallingConnectionFailure = value;
        }
    }, {
        key: "handshakingFailure",
        get: function get() {
            return this._handshakingFailure;
        }
        /**
         * Gum failed due to timeout at the time of new RTCSession connection
         */
        ,
        set: function set(value) {
            this._handshakingFailure = value;
        }
    }, {
        key: "gumTimeoutFailure",
        get: function get() {
            return this._gumTimeoutFailure;
        }
        /**
         * Gum failed due to other reasons (other than Timeout)
         */
        ,
        set: function set(value) {
            this._gumTimeoutFailure = value;
        }
    }, {
        key: "gumOtherFailure",
        get: function get() {
            return this._gumOtherFailure;
        }
        /**
         * RTC Session failed in create Offer state.
         */
        ,
        set: function set(value) {
            this._gumOtherFailure = value;
        }
    }, {
        key: "createOfferFailure",
        get: function get() {
            return this._createOfferFailure;
        }
        /**
         * Tells if setLocalDescription failed for the RTC Session.
         */
        ,
        set: function set(value) {
            this._createOfferFailure = value;
        }
    }, {
        key: "setLocalDescriptionFailure",
        get: function get() {
            return this._setLocalDescriptionFailure;
        }
        /**
         * Tells if handshaking failed due to user busy case,
         * happens when multiple softphone calls are initiated at same time.
         */
        ,
        set: function set(value) {
            this._setLocalDescriptionFailure = value;
        }
    }, {
        key: "userBusyFailure",
        get: function get() {
            return this._userBusyFailure;
        }
        /**
         * Tells it remote SDP is invalid.
         */
        ,
        set: function set(value) {
            this._userBusyFailure = value;
        }
    }, {
        key: "invalidRemoteSDPFailure",
        get: function get() {
            return this._invalidRemoteSDPFailure;
        }
        /**
         * Tells if the setRemoteDescription failed for the RTC Session.
         */
        ,
        set: function set(value) {
            this._invalidRemoteSDPFailure = value;
        }
    }, {
        key: "setRemoteDescriptionFailure",
        get: function get() {
            return this._setRemoteDescriptionFailure;
        }
        /**
         * A failure case when there is no RemoteIceCandidate.
         */
        ,
        set: function set(value) {
            this._setRemoteDescriptionFailure = value;
        }
    }, {
        key: "noRemoteIceCandidateFailure",
        get: function get() {
            return this._noRemoteIceCandidateFailure;
        }
        /**
         * Statistics for each stream(audio-in, audio-out, video-in, video-out) of the RTCSession.
         */
        ,
        set: function set(value) {
            this._noRemoteIceCandidateFailure = value;
        }
    }, {
        key: "streamStats",
        get: function get() {
            return this._streamStats;
        }
        /**
         * get current connect-rtc-js version
         */
        ,
        set: function set(value) {
            this._streamStats = value;
        }
    }, {
        key: "rtcJsVersion",
        get: function get() {
            return this._rtcJsVersion;
        },
        set: function set(value) {
            this._rtcJsVersion = value;
        }
    }]);
    return SessionReport;
}();

},{"babel-runtime/helpers/classCallCheck":11,"babel-runtime/helpers/createClass":12}],141:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.FailedState = exports.DisconnectedState = exports.PendingLocalHangupState = exports.PendingRemoteHangupState = exports.PendingReconnectState = exports.TalkingState = exports.PendingAcceptAckState = exports.PendingAcceptState = exports.PendingAnswerState = exports.PendingInviteState = exports.PendingConnectState = exports.FailOnTimeoutState = exports.SignalingState = undefined;

var _regenerator = require('babel-runtime/regenerator');

var _regenerator2 = _interopRequireDefault(_regenerator);

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _utils = require('./utils');

var _rtc_const = require('./rtc_const');

var _exceptions = require('./exceptions');

var _v = require('uuid/v4');

var _v2 = _interopRequireDefault(_v);

var _virtual_wss_connection_manager = require('./virtual_wss_connection_manager');

var _virtual_wss_connection_manager2 = _interopRequireDefault(_virtual_wss_connection_manager);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var CONNECT_MAX_RETRIES = 3;

/**
 * Abstract signaling state class.
 */
/**
 * Copyright 2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 * SPDX-License-Identifier: Apache-2.0
 */

var SignalingState = exports.SignalingState = function () {
    /**
     * @param {AmznRtcSignaling} signaling Signaling object.
     */
    function SignalingState(signaling) {
        (0, _classCallCheck3.default)(this, SignalingState);

        this._signaling = signaling;
        this._createTime = new Date().getTime();
    }

    (0, _createClass3.default)(SignalingState, [{
        key: 'setStateTimeout',
        value: function setStateTimeout(timeoutMs) {
            setTimeout((0, _utils.hitch)(this, this._onTimeoutChecked), timeoutMs);
        }
    }, {
        key: 'onEnter',
        value: function onEnter() {}
    }, {
        key: '_onTimeoutChecked',
        value: function _onTimeoutChecked() {
            if (this.isCurrentState) {
                this.onTimeout();
            }
        }
    }, {
        key: 'onTimeout',
        value: function onTimeout() {
            throw new _exceptions.UnsupportedOperation();
        }
    }, {
        key: 'transit',
        value: function transit(newState) {
            this._signaling.transit(newState);
        }
    }, {
        key: 'onExit',
        value: function onExit() {}
    }, {
        key: 'onOpen',
        value: function onOpen() {
            throw new _exceptions.UnsupportedOperation('onOpen not supported by ' + this.name);
        }
    }, {
        key: 'onError',
        value: function onError() {
            this.channelDown();
        }
    }, {
        key: 'onClose',
        value: function onClose() {
            this.channelDown();
        }
    }, {
        key: 'channelDown',
        value: function channelDown() {
            throw new _exceptions.UnsupportedOperation('channelDown not supported by ' + this.name);
        }
    }, {
        key: 'onRpcMsg',
        value: function onRpcMsg(rpcMsg) {
            // eslint-disable-line no-unused-vars
            throw new _exceptions.UnsupportedOperation('onRpcMsg not supported by ' + this.name);
        }
    }, {
        key: 'invite',
        value: function invite(sdp, iceCandidates) {
            // eslint-disable-line no-unused-vars
            throw new _exceptions.UnsupportedOperation('invite not supported by ' + this.name);
        }
    }, {
        key: 'accept',
        value: function accept() {
            throw new _exceptions.UnsupportedOperation('accept not supported by ' + this.name);
        }
    }, {
        key: 'hangup',
        value: function hangup() {
            throw new _exceptions.UnsupportedOperation('hangup not supported by ' + this.name);
        }
    }, {
        key: 'isCurrentState',
        get: function get() {
            return this === this._signaling.state;
        }
    }, {
        key: 'name',
        get: function get() {
            return "SignalingState";
        }
    }, {
        key: 'logger',
        get: function get() {
            return this._signaling._logger;
        }
    }]);
    return SignalingState;
}();

var FailOnTimeoutState = exports.FailOnTimeoutState = function (_SignalingState) {
    (0, _inherits3.default)(FailOnTimeoutState, _SignalingState);

    function FailOnTimeoutState(signaling, timeoutMs) {
        (0, _classCallCheck3.default)(this, FailOnTimeoutState);

        var _this = (0, _possibleConstructorReturn3.default)(this, (FailOnTimeoutState.__proto__ || Object.getPrototypeOf(FailOnTimeoutState)).call(this, signaling));

        _this._timeoutMs = timeoutMs;
        return _this;
    }

    (0, _createClass3.default)(FailOnTimeoutState, [{
        key: 'onEnter',
        value: function onEnter() {
            this.setStateTimeout(this._timeoutMs);
        }
    }, {
        key: 'onTimeout',
        value: function onTimeout() {
            this.transit(new FailedState(this._signaling, new _exceptions.Timeout()));
        }
    }, {
        key: 'name',
        get: function get() {
            return "FailOnTimeoutState";
        }
    }]);
    return FailOnTimeoutState;
}(SignalingState);

var PendingConnectState = exports.PendingConnectState = function (_FailOnTimeoutState) {
    (0, _inherits3.default)(PendingConnectState, _FailOnTimeoutState);

    function PendingConnectState(signaling, timeoutMs, initialStartTimeIn, retriesIn) {
        (0, _classCallCheck3.default)(this, PendingConnectState);

        var _this2 = (0, _possibleConstructorReturn3.default)(this, (PendingConnectState.__proto__ || Object.getPrototypeOf(PendingConnectState)).call(this, signaling, timeoutMs));

        _this2._initialStartTime = initialStartTimeIn || new Date().getTime();
        _this2._retries = retriesIn || 0;
        return _this2;
    }

    (0, _createClass3.default)(PendingConnectState, [{
        key: 'onOpen',
        value: function onOpen() {
            this.transit(new PendingInviteState(this._signaling));
        }
    }, {
        key: 'channelDown',
        value: function channelDown() {
            var now = new Date().getTime();
            var untilTimeoutMs = this._initialStartTime + this._timeoutMs - now;
            if (untilTimeoutMs > 0 && ++this._retries < CONNECT_MAX_RETRIES) {
                this._signaling._connect();
                this.transit(new PendingConnectState(this._signaling, untilTimeoutMs, this._initialStartTime, this._retries));
            } else {
                this.transit(new FailedState(this._signaling, new Error('channelDown')));
            }
        }
    }, {
        key: 'name',
        get: function get() {
            return "PendingConnectState";
        }
    }]);
    return PendingConnectState;
}(FailOnTimeoutState);

var PendingInviteState = exports.PendingInviteState = function (_SignalingState2) {
    (0, _inherits3.default)(PendingInviteState, _SignalingState2);

    function PendingInviteState() {
        (0, _classCallCheck3.default)(this, PendingInviteState);
        return (0, _possibleConstructorReturn3.default)(this, (PendingInviteState.__proto__ || Object.getPrototypeOf(PendingInviteState)).apply(this, arguments));
    }

    (0, _createClass3.default)(PendingInviteState, [{
        key: 'onEnter',
        value: function onEnter() {
            var self = this;
            new Promise(function notifyConnected(resolve) {
                self._signaling._connectedHandler();
                resolve();
            });
        }
    }, {
        key: 'invite',
        value: function invite(sdp, iceCandidates) {
            var self = this;
            var inviteId = (0, _v2.default)();

            var inviteParams = {
                sdp: sdp,
                candidates: iceCandidates,
                callContextToken: self._signaling._contactToken
            };
            self.logger.log('Sending SDP', (0, _utils.getRedactedSdp)(sdp));
            self._signaling._wss.send(JSON.stringify({
                jsonrpc: '2.0',
                method: _rtc_const.INVITE_METHOD_NAME,
                params: inviteParams,
                id: inviteId
            }));
            self.transit(new PendingAnswerState(self._signaling, inviteId));
        }
    }, {
        key: 'channelDown',
        value: function channelDown() {
            this.transit(new FailedState(this._signaling));
        }
    }, {
        key: 'name',
        get: function get() {
            return "PendingInviteState";
        }
    }]);
    return PendingInviteState;
}(SignalingState);

var PendingAnswerState = exports.PendingAnswerState = function (_FailOnTimeoutState2) {
    (0, _inherits3.default)(PendingAnswerState, _FailOnTimeoutState2);

    function PendingAnswerState(signaling, inviteId) {
        (0, _classCallCheck3.default)(this, PendingAnswerState);

        var _this4 = (0, _possibleConstructorReturn3.default)(this, (PendingAnswerState.__proto__ || Object.getPrototypeOf(PendingAnswerState)).call(this, signaling, _rtc_const.MAX_INVITE_DELAY_MS));

        _this4._inviteId = inviteId;
        return _this4;
    }

    (0, _createClass3.default)(PendingAnswerState, [{
        key: 'onRpcMsg',
        value: function onRpcMsg(msg) {
            var self = this;
            if (msg.id === this._inviteId) {
                if (msg.error || !msg.result) {
                    this.transit(new FailedState(this._signaling, self.translateInviteError(msg)));
                } else {
                    new Promise(function notifyAnswered(resolve) {
                        self.logger.log('Received SDP', (0, _utils.getRedactedSdp)(msg.result.sdp));
                        self._signaling._answeredHandler(msg.result.sdp, msg.result.candidates);
                        resolve();
                    });
                    this.transit(new PendingAcceptState(this._signaling, this._signaling._autoAnswer));
                }
            }
        }
    }, {
        key: 'translateInviteError',
        value: function translateInviteError(msg) {
            if (msg.error && msg.error.code == 486) {
                return new _exceptions.BusyException(msg.error.message);
            } else if (msg.error && msg.error.code == 404) {
                return new _exceptions.CallNotFoundException(msg.error.message);
            } else {
                return new _exceptions.UnknownSignalingError();
            }
        }
    }, {
        key: 'name',
        get: function get() {
            return "PendingAnswerState";
        }
    }]);
    return PendingAnswerState;
}(FailOnTimeoutState);

var PendingAcceptState = exports.PendingAcceptState = function (_SignalingState3) {
    (0, _inherits3.default)(PendingAcceptState, _SignalingState3);

    function PendingAcceptState(signaling, autoAnswer) {
        (0, _classCallCheck3.default)(this, PendingAcceptState);

        var _this5 = (0, _possibleConstructorReturn3.default)(this, (PendingAcceptState.__proto__ || Object.getPrototypeOf(PendingAcceptState)).call(this, signaling));

        _this5._autoAnswer = autoAnswer;
        return _this5;
    }

    (0, _createClass3.default)(PendingAcceptState, [{
        key: 'onEnter',
        value: function onEnter() {
            if (this._autoAnswer) {
                this.accept();
            }
        }
    }, {
        key: 'accept',
        value: function accept() {
            this.sendAcceptRequest();
            this.transit(new TalkingState(this._signaling));
        }
    }, {
        key: 'channelDown',
        value: function channelDown() {
            this.transit(new FailedState(this._signaling));
        }
    }, {
        key: 'sendAcceptRequest',
        value: function () {
            var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {
                var acceptId;
                return _regenerator2.default.wrap(function _callee$(_context) {
                    while (1) {
                        switch (_context.prev = _context.next) {
                            case 0:
                                acceptId = (0, _v2.default)();

                                this._signaling._wss.send(JSON.stringify({
                                    jsonrpc: '2.0',
                                    method: _rtc_const.ACCEPT_METHOD_NAME,
                                    params: {},
                                    id: acceptId
                                }));

                            case 2:
                            case 'end':
                                return _context.stop();
                        }
                    }
                }, _callee, this);
            }));

            function sendAcceptRequest() {
                return _ref.apply(this, arguments);
            }

            return sendAcceptRequest;
        }()
    }, {
        key: 'name',
        get: function get() {
            return "PendingAcceptState";
        }
    }]);
    return PendingAcceptState;
}(SignalingState);

var PendingAcceptAckState = exports.PendingAcceptAckState = function (_FailOnTimeoutState3) {
    (0, _inherits3.default)(PendingAcceptAckState, _FailOnTimeoutState3);

    function PendingAcceptAckState(signaling, acceptId) {
        (0, _classCallCheck3.default)(this, PendingAcceptAckState);

        var _this6 = (0, _possibleConstructorReturn3.default)(this, (PendingAcceptAckState.__proto__ || Object.getPrototypeOf(PendingAcceptAckState)).call(this, signaling, _rtc_const.MAX_ACCEPT_BYE_DELAY_MS));

        _this6._acceptId = acceptId;
        return _this6;
    }

    (0, _createClass3.default)(PendingAcceptAckState, [{
        key: 'onRpcMsg',
        value: function onRpcMsg(msg) {
            if (msg.id === this._acceptId) {
                if (msg.error) {
                    this.transit(new FailedState(this._signaling));
                } else {
                    this._signaling._clientToken = msg.result.clientToken;
                    this.transit(new TalkingState(this._signaling));
                }
            }
        }
    }, {
        key: 'name',
        get: function get() {
            return "PendingAcceptAckState";
        }
    }]);
    return PendingAcceptAckState;
}(FailOnTimeoutState);

var TalkingState = exports.TalkingState = function (_SignalingState4) {
    (0, _inherits3.default)(TalkingState, _SignalingState4);

    function TalkingState() {
        (0, _classCallCheck3.default)(this, TalkingState);
        return (0, _possibleConstructorReturn3.default)(this, (TalkingState.__proto__ || Object.getPrototypeOf(TalkingState)).apply(this, arguments));
    }

    (0, _createClass3.default)(TalkingState, [{
        key: 'onEnter',
        value: function onEnter() {
            var self = this;
            new Promise(function notifyHandshaked(resolve) {
                self._signaling._handshakedHandler();
                resolve();
            });
        }
    }, {
        key: 'hangup',
        value: function hangup() {
            var byeId = (0, _v2.default)();
            this._signaling._wss.send(JSON.stringify({
                jsonrpc: '2.0',
                method: _rtc_const.BYE_METHOD_NAME,
                params: { callContextToken: this._signaling._contactToken },
                id: byeId
            }));
            this.transit(new PendingRemoteHangupState(this._signaling, byeId));
        }
    }, {
        key: 'onRpcMsg',
        value: function onRpcMsg(msg) {
            if (msg.method === _rtc_const.BYE_METHOD_NAME) {
                this.transit(new PendingLocalHangupState(this._signaling, msg.id));
            } else if (msg.method === 'renewClientToken') {
                this._signaling._clientToken = msg.params.clientToken;
            }
        }
    }, {
        key: 'channelDown',
        value: function channelDown() {
            this._signaling._reconnect();
            this._signaling.transit(new PendingReconnectState(this._signaling));
        }
    }, {
        key: 'name',
        get: function get() {
            return "TalkingState";
        }
    }]);
    return TalkingState;
}(SignalingState);

var PendingReconnectState = exports.PendingReconnectState = function (_FailOnTimeoutState4) {
    (0, _inherits3.default)(PendingReconnectState, _FailOnTimeoutState4);

    function PendingReconnectState(signaling) {
        (0, _classCallCheck3.default)(this, PendingReconnectState);
        return (0, _possibleConstructorReturn3.default)(this, (PendingReconnectState.__proto__ || Object.getPrototypeOf(PendingReconnectState)).call(this, signaling, _rtc_const.DEFAULT_CONNECT_TIMEOUT_MS));
    }

    (0, _createClass3.default)(PendingReconnectState, [{
        key: 'onOpen',
        value: function onOpen() {
            this.transit(new TalkingState(this._signaling));
        }
    }, {
        key: 'channelDown',
        value: function channelDown() {
            this.transit(new FailedState(this._signaling));
        }
    }, {
        key: 'name',
        get: function get() {
            return "PendingReconnectState";
        }
    }]);
    return PendingReconnectState;
}(FailOnTimeoutState);

var PendingRemoteHangupState = exports.PendingRemoteHangupState = function (_FailOnTimeoutState5) {
    (0, _inherits3.default)(PendingRemoteHangupState, _FailOnTimeoutState5);

    function PendingRemoteHangupState(signaling, byeId) {
        (0, _classCallCheck3.default)(this, PendingRemoteHangupState);

        var _this9 = (0, _possibleConstructorReturn3.default)(this, (PendingRemoteHangupState.__proto__ || Object.getPrototypeOf(PendingRemoteHangupState)).call(this, signaling, _rtc_const.MAX_ACCEPT_BYE_DELAY_MS));

        _this9._byeId = byeId;
        return _this9;
    }

    (0, _createClass3.default)(PendingRemoteHangupState, [{
        key: 'onRpcMsg',
        value: function onRpcMsg(msg) {
            if (msg.id === this._byeId || msg.method === _rtc_const.BYE_METHOD_NAME) {
                this.transit(new DisconnectedState(this._signaling));
            }
        }
    }, {
        key: 'name',
        get: function get() {
            return "PendingRemoteHangupState";
        }
    }]);
    return PendingRemoteHangupState;
}(FailOnTimeoutState);

var PendingLocalHangupState = exports.PendingLocalHangupState = function (_SignalingState5) {
    (0, _inherits3.default)(PendingLocalHangupState, _SignalingState5);

    function PendingLocalHangupState(signaling, byeId) {
        (0, _classCallCheck3.default)(this, PendingLocalHangupState);

        var _this10 = (0, _possibleConstructorReturn3.default)(this, (PendingLocalHangupState.__proto__ || Object.getPrototypeOf(PendingLocalHangupState)).call(this, signaling));

        _this10._byeId = byeId;
        return _this10;
    }

    (0, _createClass3.default)(PendingLocalHangupState, [{
        key: 'onEnter',
        value: function onEnter() {
            var self = this;
            new Promise(function notifyRemoteHungup(resolve) {
                self._signaling._remoteHungupHandler();
                resolve();
            });
        }
    }, {
        key: 'hangup',
        value: function hangup() {
            var self = this;
            self._signaling._wss.send(JSON.stringify({
                jsonrpc: '2.0',
                result: {},
                id: self._byeId
            }));
            self.transit(new DisconnectedState(self._signaling));
        }
    }, {
        key: 'onRpcMsg',
        value: function onRpcMsg() {
            //Do nothing
        }
    }, {
        key: 'channelDown',
        value: function channelDown() {
            this.transit(new DisconnectedState(this._signaling));
        }
    }, {
        key: 'name',
        get: function get() {
            return "PendingLocalHangupState";
        }
    }]);
    return PendingLocalHangupState;
}(SignalingState);

var DisconnectedState = exports.DisconnectedState = function (_SignalingState6) {
    (0, _inherits3.default)(DisconnectedState, _SignalingState6);

    function DisconnectedState() {
        (0, _classCallCheck3.default)(this, DisconnectedState);
        return (0, _possibleConstructorReturn3.default)(this, (DisconnectedState.__proto__ || Object.getPrototypeOf(DisconnectedState)).apply(this, arguments));
    }

    (0, _createClass3.default)(DisconnectedState, [{
        key: 'onEnter',
        value: function onEnter() {
            var self = this;
            new Promise(function notifyDisconnected(resolve) {
                self._signaling._disconnectedHandler();
                resolve();
            });
            this._signaling._wss.close();
        }
    }, {
        key: 'channelDown',
        value: function channelDown() {
            //Do nothing
        }
    }, {
        key: 'onRpcMsg',
        value: function onRpcMsg() {
            //Do nothing
        }
    }, {
        key: 'name',
        get: function get() {
            return "DisconnectedState";
        }
    }]);
    return DisconnectedState;
}(SignalingState);

var FailedState = exports.FailedState = function (_SignalingState7) {
    (0, _inherits3.default)(FailedState, _SignalingState7);

    function FailedState(signaling, exception) {
        (0, _classCallCheck3.default)(this, FailedState);

        var _this12 = (0, _possibleConstructorReturn3.default)(this, (FailedState.__proto__ || Object.getPrototypeOf(FailedState)).call(this, signaling));

        _this12._exception = exception;
        return _this12;
    }

    (0, _createClass3.default)(FailedState, [{
        key: 'onEnter',
        value: function onEnter() {
            var self = this;
            new Promise(function notifyFailed(resolve) {
                self._signaling._failedHandler(self._exception);
                resolve();
            });
            this._signaling._wss.close();
        }
    }, {
        key: 'channelDown',
        value: function channelDown() {
            //Do nothing
        }
    }, {
        key: 'name',
        get: function get() {
            return "FailedState";
        }
    }, {
        key: 'exception',
        get: function get() {
            return this._exception;
        }
    }]);
    return FailedState;
}(SignalingState);

var AmznRtcSignaling = function () {
    function AmznRtcSignaling(callId, signalingUri, contactToken, logger, connectTimeoutMs, connectionId, wssManager) {
        (0, _classCallCheck3.default)(this, AmznRtcSignaling);

        this._callId = callId;
        this._connectTimeoutMs = connectTimeoutMs || _rtc_const.DEFAULT_CONNECT_TIMEOUT_MS;
        this._autoAnswer = true;
        this._signalingUri = signalingUri;
        this._contactToken = contactToken;
        this._logger = (0, _utils.wrapLogger)(logger, callId, 'SIGNALING');
        this._connectionId = connectionId;
        this._wssManager = wssManager;

        //empty event handlers
        this._connectedHandler = this._answeredHandler = this._handshakedHandler = this._reconnectedHandler = this._remoteHungupHandler = this._disconnectedHandler = this._failedHandler = function noOp() {};
    }

    (0, _createClass3.default)(AmznRtcSignaling, [{
        key: 'connect',
        value: function connect() {
            this._connect();
            this.transit(new PendingConnectState(this, this._connectTimeoutMs));
        }
    }, {
        key: '_connect',
        value: function _connect() {
            this._wss = this._connectWebSocket(this._buildInviteUri());
        }
    }, {
        key: 'transit',
        value: function transit(nextState) {
            try {
                this._logger.info((this._state ? this._state.name : 'null') + ' => ' + nextState.name);
                if (this.state && this.state.onExit) {
                    this.state.onExit();
                }
            } finally {
                this._state = nextState;
                if (this._state.onEnter) {
                    this._state.onEnter();
                }
            }
        }
    }, {
        key: '_connectWebSocket',
        value: function _connectWebSocket(uri) {
            var wsConnection = void 0;
            if (this._wssManager) {
                wsConnection = new _virtual_wss_connection_manager2.default(this._logger, this._connectionId, this._wssManager);
            } else {
                wsConnection = new WebSocket(uri);
            }
            wsConnection.onopen = (0, _utils.hitch)(this, this._onOpen);
            wsConnection.onmessage = (0, _utils.hitch)(this, this._onMessage);
            wsConnection.onerror = (0, _utils.hitch)(this, this._onError);
            wsConnection.onclose = (0, _utils.hitch)(this, this._onClose);
            return wsConnection;
        }
    }, {
        key: '_buildInviteUri',
        value: function _buildInviteUri() {
            if (this._contactToken) {
                return this._buildUriBase() + '&contactCtx=' + encodeURIComponent(this._contactToken);
            } else {
                return this._buildUriBase();
            }
        }
    }, {
        key: '_buildReconnectUri',
        value: function _buildReconnectUri() {
            return this._buildUriBase() + '&clientToken=' + encodeURIComponent(this._clientToken);
        }
    }, {
        key: '_buildUriBase',
        value: function _buildUriBase() {
            var separator = '?';
            if (this._signalingUri.indexOf(separator) > -1) {
                separator = '&';
            }
            return this._signalingUri + separator + 'callId=' + encodeURIComponent(this._callId);
        }
    }, {
        key: '_onMessage',
        value: function _onMessage(evt) {
            this.state.onRpcMsg(JSON.parse(evt.data));
        }
    }, {
        key: '_onOpen',
        value: function _onOpen(evt) {
            this.state.onOpen(evt);
        }
    }, {
        key: '_onError',
        value: function _onError(evt) {
            this.state.onError(evt);
        }
    }, {
        key: '_onClose',
        value: function _onClose(evt) {
            this._logger.log('WebSocket onclose code=' + evt.code + ', reason=' + evt.reason);
            this.state.onClose(evt);
        }
    }, {
        key: '_reconnect',
        value: function _reconnect() {
            this._wss = this._connectWebSocket(this._buildReconnectUri());
        }
    }, {
        key: 'invite',
        value: function invite(sdp, iceCandidates) {
            this.state.invite(sdp, iceCandidates);
        }
    }, {
        key: 'accept',
        value: function accept() {
            this.state.accept();
        }
    }, {
        key: 'hangup',
        value: function hangup() {
            this.state.hangup();
        }
    }, {
        key: 'callId',
        get: function get() {
            return this._callId;
        }
    }, {
        key: 'onConnected',
        set: function set(connectedHandler) {
            this._connectedHandler = connectedHandler;
        }
    }, {
        key: 'onAnswered',
        set: function set(answeredHandler) {
            this._answeredHandler = answeredHandler;
        }
    }, {
        key: 'onHandshaked',
        set: function set(handshakedHandler) {
            this._handshakedHandler = handshakedHandler;
        }
    }, {
        key: 'onReconnected',
        set: function set(reconnectedHandler) {
            this._reconnectedHandler = reconnectedHandler;
        }
    }, {
        key: 'onRemoteHungup',
        set: function set(remoteHungupHandler) {
            this._remoteHungupHandler = remoteHungupHandler;
        }
    }, {
        key: 'onDisconnected',
        set: function set(disconnectedHandler) {
            this._disconnectedHandler = disconnectedHandler;
        }
    }, {
        key: 'onFailed',
        set: function set(failedHandler) {
            this._failedHandler = failedHandler;
        }
    }, {
        key: 'state',
        get: function get() {
            return this._state;
        }
    }]);
    return AmznRtcSignaling;
}();

exports.default = AmznRtcSignaling;

},{"./exceptions":135,"./rtc_const":136,"./utils":145,"./virtual_wss_connection_manager":146,"babel-runtime/helpers/asyncToGenerator":10,"babel-runtime/helpers/classCallCheck":11,"babel-runtime/helpers/createClass":12,"babel-runtime/helpers/inherits":14,"babel-runtime/helpers/possibleConstructorReturn":15,"babel-runtime/regenerator":19,"uuid/v4":121}],142:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = require("babel-runtime/helpers/classCallCheck");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require("babel-runtime/helpers/createClass");

var _createClass3 = _interopRequireDefault(_createClass2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var CCPInitiationStrategyInterface = function () {
    function CCPInitiationStrategyInterface() {
        (0, _classCallCheck3.default)(this, CCPInitiationStrategyInterface);

        console.log("CCPInitiationStrategyInterface initialized");
    }

    (0, _createClass3.default)(CCPInitiationStrategyInterface, [{
        key: "getName",
        value: function getName() {}

        // the following functions are rtc_peer_connection_factory related functions
        // check if the browser supports early media connection

    }, {
        key: "_isBrowserSupported",
        value: function _isBrowserSupported() {}
    }, {
        key: "_createRtcPeerConnection",
        value: function _createRtcPeerConnection() {}

        // the following functions are rtc_session related functions

    }, {
        key: "_guM",
        value: function _guM() {}
    }, {
        key: "createOfferStateOnEnter",
        value: function createOfferStateOnEnter() {}
    }, {
        key: "acceptStateOnEnter",
        value: function acceptStateOnEnter() {}
    }, {
        key: "onIceStateChange",
        value: function onIceStateChange() {}
    }, {
        key: "onPeerConnectionStateChange",
        value: function onPeerConnectionStateChange() {}
    }, {
        key: "_createPeerConnection",
        value: function _createPeerConnection() {}
    }, {
        key: "connect",
        value: function connect() {}
    }, {
        key: "_ontrack",
        value: function _ontrack() {}
    }, {
        key: "_buildMediaConstraints",
        value: function _buildMediaConstraints() {}
    }]);
    return CCPInitiationStrategyInterface;
}();

exports.default = CCPInitiationStrategyInterface;

},{"babel-runtime/helpers/classCallCheck":11,"babel-runtime/helpers/createClass":12}],143:[function(require,module,exports){
(function (global){(function (){
"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = require("babel-runtime/helpers/classCallCheck");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require("babel-runtime/helpers/createClass");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require("babel-runtime/helpers/possibleConstructorReturn");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require("babel-runtime/helpers/inherits");

var _inherits3 = _interopRequireDefault(_inherits2);

var _CCPInitiationStrategyInterface = require("./CCPInitiationStrategyInterface");

var _CCPInitiationStrategyInterface2 = _interopRequireDefault(_CCPInitiationStrategyInterface);

var _utils = require("../utils");

var _rtc_session = require("../rtc_session");

var _rtc_const = require("../rtc_const");

require("@citrix/ucsdk/CitrixWebRTC");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var CitrixVDIStrategy = function (_CCPInitiationStrateg) {
    (0, _inherits3.default)(CitrixVDIStrategy, _CCPInitiationStrateg);

    function CitrixVDIStrategy() {
        (0, _classCallCheck3.default)(this, CitrixVDIStrategy);

        var _this = (0, _possibleConstructorReturn3.default)(this, (CitrixVDIStrategy.__proto__ || Object.getPrototypeOf(CitrixVDIStrategy)).call(this));

        if (!(0, _utils.isCitrixWebRTCSupported)()) {
            throw new Error('Citrix WebRTC redirection feature is NOT supported!');
        }
        window.getCitrixWebrtcRedir = function () {
            var registryValue = Promise.resolve(1);
            return new Promise(function (resolve, reject) {
                //retrieve registry value internally
                registryValue.then(function (v) {
                    resolve(v);
                }).catch(function () {
                    reject();
                });
            });
        };
        window.CitrixWebRTC.initLog(global.connect.getLog());
        console.log("CitrixVDIStrategy initialized");
        return _this;
    }

    // the following functions are rtc_peer_connection_factory related functions
    // check if the browser supports early media connection


    (0, _createClass3.default)(CitrixVDIStrategy, [{
        key: "_isBrowserSupported",
        value: function _isBrowserSupported() {
            // Citrix WebRTC SDK doesn't support early media connection
            return false;
        }
    }, {
        key: "_createRtcPeerConnection",
        value: function _createRtcPeerConnection(rtcPeerConnectionConfig, rtcPeerConnectionOptionalConfig) {
            return new window.CitrixWebRTC.CitrixPeerConnection(rtcPeerConnectionConfig, rtcPeerConnectionOptionalConfig);
        }

        // the following functions are rtc_session related functions

    }, {
        key: "_gUM",
        value: function _gUM(constraints) {
            return window.CitrixWebRTC.getUserMedia(constraints);
        }
    }, {
        key: "createOfferStateOnEnter",
        value: function createOfferStateOnEnter(_pc, stream) {
            stream.getTracks().forEach(function (track) {
                _pc.addTransceiver(track, {});
            });
        }
    }, {
        key: "acceptStateOnEnter",
        value: function acceptStateOnEnter(self, rtcSession) {
            console.log("ConnectRTC - rtc_session - AcceptState - rtcSession._pc.setRemoteDescription");

            var answerSessionDescription = self._createSessionDescription({ type: 'answer', sdp: self._sdp });
            console.log("ConnectRTC - rtc_session - AcceptState - answerSessionDescription: ", answerSessionDescription);

            rtcSession._pc.setRemoteDescription(answerSessionDescription, function () {
                console.log("ConnectRTC - rtc_session - AcceptState - rtcSession._pc.setRemoteDescription - success");
                var remoteCandidatePromises = Promise.all(self._candidates.map(function (candidate) {
                    var remoteCandidate = self._createRemoteCandidate(candidate);
                    self.logger.info('Adding remote candidate', remoteCandidate);
                    console.log("ConnectRTC - rtc_session - AcceptState - rtcSession._pc.setRemoteDescription - Adding remote candidate - remoteCandidate", remoteCandidate);
                    return rtcSession._pc.addIceCandidate(remoteCandidate);
                }));
                remoteCandidatePromises.catch(function (reason) {
                    console.log("ConnectRTC - rtc_session - AcceptState - rtcSession._pc.setRemoteDescription - Adding remote candidate - failed", reason);
                    self.logger.warn('Error adding remote candidate', reason);
                });
                rtcSession._sessionReport.setRemoteDescriptionFailure = false;
                self._remoteDescriptionSet = true;
                self._checkAndTransit();
            }, function (error) {
                console.error("ConnectRTC - rtc_session - AcceptState - setRemoteDescription - error:", error);
                rtcSession._stopSession();
                rtcSession._sessionReport.setRemoteDescriptionFailure = true;
                self.transit(new _rtc_session.FailedState(rtcSession, _rtc_const.RTC_ERRORS.SET_REMOTE_DESCRIPTION_FAILURE));
            });
        }
    }, {
        key: "onIceStateChange",
        value: function onIceStateChange(evt, _pc) {
            return _pc.iceConnectionState;
        }
    }, {
        key: "onPeerConnectionStateChange",
        value: function onPeerConnectionStateChange(_pc) {
            return _pc.connectionState_;
        }
    }, {
        key: "_createPeerConnection",
        value: function _createPeerConnection(configuration, optionalConfiguration) {
            return new window.CitrixWebRTC.CitrixPeerConnection(configuration, optionalConfiguration);
        }
    }, {
        key: "connect",
        value: function connect(self) {
            self._pc.onaddstream = (0, _utils.hitch)(self, self._ontrack);
        }
    }, {
        key: "_ontrack",
        value: function _ontrack(self, evt) {
            console.log('ConnectRTC - rtc_session - RtcSession - _onaddstream:', evt);

            var remoteStream = evt.stream.clone();

            var audioTracks = evt.stream.getAudioTracks();
            console.log('ConnectRTC - rtc_session - RtcSession - _onaddstream - audioTracks:', audioTracks);

            if (audioTracks !== undefined && audioTracks.length > 0) {
                console.log("ConnectRTC - rtc_session - RtcSession - _onaddstream - remoteStream " + remoteStream);
                self._remoteAudioStream = remoteStream;
                self._remoteAudioElement.srcObject = remoteStream;
            }
        }
    }, {
        key: "_buildMediaConstraints",
        value: function _buildMediaConstraints(self, mediaConstraints) {
            if (self._enableAudio) {
                var audioConstraints = {};
                if (typeof self._echoCancellation !== 'undefined') {
                    audioConstraints.echoCancellation = !!self._echoCancellation;
                }
                console.log("ConnectRTC - GUM - buildMediaConstraints - window.audio_input: " + window.audio_input);
                if (window.audio_input) {
                    audioConstraints.deviceId = window.audio_input;
                }
                if (Object.keys(audioConstraints).length > 0) {
                    mediaConstraints.audio = audioConstraints;
                } else {
                    mediaConstraints.audio = true;
                }
            } else {
                mediaConstraints.audio = false;
            }
        }
    }, {
        key: "getName",
        value: function getName() {
            return 'CitrixVDIStrategy';
        }
    }]);
    return CitrixVDIStrategy;
}(_CCPInitiationStrategyInterface2.default);

exports.default = CitrixVDIStrategy;

}).call(this)}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"../rtc_const":136,"../rtc_session":138,"../utils":145,"./CCPInitiationStrategyInterface":142,"@citrix/ucsdk/CitrixWebRTC":1,"babel-runtime/helpers/classCallCheck":11,"babel-runtime/helpers/createClass":12,"babel-runtime/helpers/inherits":14,"babel-runtime/helpers/possibleConstructorReturn":15}],144:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = require("babel-runtime/helpers/classCallCheck");

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require("babel-runtime/helpers/createClass");

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require("babel-runtime/helpers/possibleConstructorReturn");

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require("babel-runtime/helpers/inherits");

var _inherits3 = _interopRequireDefault(_inherits2);

var _CCPInitiationStrategyInterface = require("./CCPInitiationStrategyInterface");

var _CCPInitiationStrategyInterface2 = _interopRequireDefault(_CCPInitiationStrategyInterface);

var _rtc_const = require("../rtc_const");

var _utils = require("../utils");

var _rtc_session = require("../rtc_session");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var StandardStrategy = function (_CCPInitiationStrateg) {
    (0, _inherits3.default)(StandardStrategy, _CCPInitiationStrateg);

    function StandardStrategy() {
        (0, _classCallCheck3.default)(this, StandardStrategy);

        var _this = (0, _possibleConstructorReturn3.default)(this, (StandardStrategy.__proto__ || Object.getPrototypeOf(StandardStrategy)).call(this));

        console.log("StandardStrategy initialized");
        return _this;
    }

    // the following functions are rtc_peer_connection_factory related functions
    // check if the browser supports early media connection


    (0, _createClass3.default)(StandardStrategy, [{
        key: "_isBrowserSupported",
        value: function _isBrowserSupported() {
            return (0, _utils.isChromeBrowser)() && (0, _utils.getChromeBrowserVersion)() >= _rtc_const.CHROME_SUPPORTED_VERSION;
        }
    }, {
        key: "_createRtcPeerConnection",
        value: function _createRtcPeerConnection(rtcPeerConnectionConfig, rtcPeerConnectionOptionalConfig) {
            return new RTCPeerConnection(rtcPeerConnectionConfig, rtcPeerConnectionOptionalConfig);
        }

        // the following functions are rtc_session related functions

    }, {
        key: "_gUM",
        value: function _gUM(constraints) {
            return navigator.mediaDevices.getUserMedia(constraints);
        }
    }, {
        key: "createOfferStateOnEnter",
        value: function createOfferStateOnEnter(_pc, stream) {
            _pc.addStream(stream);
        }
    }, {
        key: "acceptStateOnEnter",
        value: function acceptStateOnEnter(self, rtcSession) {
            var setRemoteDescriptionPromise = rtcSession._pc.setRemoteDescription(self._createSessionDescription({
                type: 'answer',
                sdp: self._sdp
            }));
            setRemoteDescriptionPromise.catch(function (e) {
                self.logger.error('SetRemoteDescription failed', e);
            });
            setRemoteDescriptionPromise.then(function () {
                var remoteCandidatePromises = Promise.all(self._candidates.map(function (candidate) {
                    var remoteCandidate = self._createRemoteCandidate(candidate);
                    self.logger.info('Adding remote candidate', remoteCandidate);
                    return rtcSession._pc.addIceCandidate(remoteCandidate);
                }));
                remoteCandidatePromises.catch(function (reason) {
                    self.logger.warn('Error adding remote candidate', reason);
                });
                return remoteCandidatePromises;
            }).then(function () {
                rtcSession._sessionReport.setRemoteDescriptionFailure = false;
                self._remoteDescriptionSet = true;
                self._checkAndTransit();
            }).catch(function () {
                rtcSession._stopSession();
                rtcSession._sessionReport.setRemoteDescriptionFailure = true;
                self.transit(new _rtc_session.FailedState(rtcSession, _rtc_const.RTC_ERRORS.SET_REMOTE_DESCRIPTION_FAILURE));
            });
        }
    }, {
        key: "onIceStateChange",
        value: function onIceStateChange(evt, _pc) {
            // eslint-disable-line no-unused-vars
            return evt.currentTarget.iceConnectionState;
        }
    }, {
        key: "onPeerConnectionStateChange",
        value: function onPeerConnectionStateChange(_pc) {
            return _pc.connectionState;
        }
    }, {
        key: "_createPeerConnection",
        value: function _createPeerConnection(configuration, optionalConfiguration) {
            return new RTCPeerConnection(configuration, optionalConfiguration);
        }
    }, {
        key: "connect",
        value: function connect(self) {
            self._pc.ontrack = (0, _utils.hitch)(self, self._ontrack);
        }
    }, {
        key: "_ontrack",
        value: function _ontrack(self, evt) {
            if (evt.streams.length > 1) {
                self._logger.warn('Found more than 1 streams for ' + evt.track.kind + ' track ' + evt.track.id + ' : ' + evt.streams.map(function (stream) {
                    return stream.id;
                }).join(','));
            }
            if (evt.track.kind === 'video' && self._remoteVideoElement) {
                self._remoteVideoElement.srcObject = evt.streams[0];
                self._remoteVideoStream = evt.streams[0];
            } else if (evt.track.kind === 'audio' && self._remoteAudioElement) {
                self._remoteAudioElement.srcObject = evt.streams[0];
                self._remoteAudioStream = evt.streams[0];
            }
        }
    }, {
        key: "_buildMediaConstraints",
        value: function _buildMediaConstraints(self, mediaConstraints) {
            if (self._enableAudio) {
                var audioConstraints = {};
                if (typeof self._echoCancellation !== 'undefined') {
                    audioConstraints.echoCancellation = !!self._echoCancellation;
                }
                if (Object.keys(audioConstraints).length > 0) {
                    mediaConstraints.audio = audioConstraints;
                } else {
                    mediaConstraints.audio = true;
                }
            } else {
                mediaConstraints.audio = false;
            }
        }
    }, {
        key: "getName",
        value: function getName() {
            return 'StandardStrategy';
        }
    }]);
    return StandardStrategy;
}(_CCPInitiationStrategyInterface2.default);

exports.default = StandardStrategy;

},{"../rtc_const":136,"../rtc_session":138,"../utils":145,"./CCPInitiationStrategyInterface":142,"babel-runtime/helpers/classCallCheck":11,"babel-runtime/helpers/createClass":12,"babel-runtime/helpers/inherits":14,"babel-runtime/helpers/possibleConstructorReturn":15}],145:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.SdpOptions = undefined;

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

exports.hitch = hitch;
exports.wrapLogger = wrapLogger;
exports.closeStream = closeStream;
exports.transformSdp = transformSdp;
exports.is_defined = is_defined;
exports.when_defined = when_defined;
exports.isLegacyStatsReportSupported = isLegacyStatsReportSupported;
exports.isFunction = isFunction;
exports.assertTrue = assertTrue;
exports.isChromeBrowser = isChromeBrowser;
exports.getChromeBrowserVersion = getChromeBrowserVersion;
exports.isCitrixWebRTCSupported = isCitrixWebRTCSupported;
exports.getRedactedSdp = getRedactedSdp;

var _exceptions = require('./exceptions');

var _sdp = require('sdp');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * All logging methods used by connect-rtc.
 */
/**
 * Copyright 2017 Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 * SPDX-License-Identifier: Apache-2.0
 */

var logMethods = ['log', 'info', 'warn', 'error'];

/**
 * Binds the given instance object as the context for
 * the method provided.
 *
 * @param scope The instance object to be set as the scope
 *    of the function.
 * @param method The method to be encapsulated.
 *
 * All other arguments, if any, are bound to the method
 * invocation inside the closure.
 *
 * @return A closure encapsulating the invocation of the
 *    method provided in context of the given instance.
 */
function hitch() {
    var args = Array.prototype.slice.call(arguments);
    var scope = args.shift();
    var method = args.shift();

    if (!scope) {
        throw new _exceptions.IllegalParameters('utils.hitch(): scope is required!');
    }

    if (!method) {
        throw new _exceptions.IllegalParameters('utils.hitch(): method is required!');
    }

    if (typeof method !== 'function') {
        throw new _exceptions.IllegalParameters('utils.hitch(): method is not a function!');
    }

    return function _hitchedFunction() {
        var closureArgs = Array.prototype.slice.call(arguments);
        return method.apply(scope, args.concat(closureArgs));
    };
}

function wrapLogger(logger, callId, logCategory) {
    var _logger = {};
    logMethods.forEach(function (logMethod) {
        if (!logger[logMethod]) {
            throw new Error('Logging method ' + logMethod + ' required');
        }
        _logger[logMethod] = hitch(logger, logger[logMethod], callId, logCategory);
    });
    return _logger;
}

function closeStream(stream) {
    if (stream) {
        var tracks = stream.getTracks();
        for (var i = 0; i < tracks.length; i++) {
            var track = tracks[i];
            try {
                track.stop();
            } catch (e) {
                // eat exception
            }
        }
    }
}

/**
 * A parameter of transformSdp.
 * This defines all the SDP options connect-rtc-js supports.
 */

var SdpOptions = exports.SdpOptions = function () {
    function SdpOptions() {
        (0, _classCallCheck3.default)(this, SdpOptions);

        this._forceCodec = {};
    }

    (0, _createClass3.default)(SdpOptions, [{
        key: '_shouldDeleteCodec',


        /**
         * Test if given codec should be removed from SDP.
         * @param mediaType audio|video
         * @param codecName case insensitive
         * @return TRUE - should remove
         */
        value: function _shouldDeleteCodec(mediaType, codecName) {
            var upperCaseCodecName = codecName.toUpperCase();
            return this._forceCodec[mediaType] && upperCaseCodecName !== this._forceCodec[mediaType].toUpperCase() && upperCaseCodecName !== 'TELEPHONE-EVENT';
        }
    }, {
        key: 'enableOpusDtx',
        get: function get() {
            return this._enableOpusDtx;
        }

        /**
         * By default transformSdp disables dtx for OPUS codec.
         * Setting this to true would force it to turn on DTX.
         */
        ,
        set: function set(flag) {
            this._enableOpusDtx = flag;
        }

        /**
         * A map from media type (audio/video) to codec (case insensitive).
         * Add entry for force connect-rtc-js to use specified codec for certain media type.
         * For example: sdpOptions.forceCodec['audio'] = 'opus';
         */

    }, {
        key: 'forceCodec',
        get: function get() {
            return this._forceCodec;
        }
    }]);
    return SdpOptions;
}();

/**
 * Modifies input SDP according to sdpOptions.
 * See SdpOptions for available options.
 * @param sdp original SDP
 * @param sdpOptions defines changes to be applied to SDP
 * @returns a map with 'sdp' containing the transformed SDP and 'mLines' containing the number of m lines in SDP
 */


function transformSdp(sdp, sdpOptions) {
    var sections = (0, _sdp.splitSections)(sdp);
    for (var i = 1; i < sections.length; i++) {
        var mediaType = (0, _sdp.getKind)(sections[i]);
        var rtpParams = (0, _sdp.parseRtpParameters)(sections[i]);
        // a map from payload type (string) to codec object
        var codecMap = rtpParams.codecs.reduce(function (map, codec) {
            map['' + codec.payloadType] = codec;
            return map;
        }, {});
        sections[i] = (0, _sdp.splitLines)(sections[i]).map(function (line) {
            if (line.startsWith('m=')) {
                // modify m= line if SdpOptions#forceCodec specifies codec for current media type
                if (sdpOptions.forceCodec[mediaType]) {
                    var targetCodecPts = Object.keys(codecMap).filter(function (pt) {
                        return !sdpOptions._shouldDeleteCodec(mediaType, codecMap[pt].name);
                    });
                    return (/.*RTP\/S?AVPF? /.exec(line) + targetCodecPts.join(' ')
                    );
                } else {
                    return line;
                }
            } else if (line.startsWith('a=rtpmap:')) {
                var rtpMap = (0, _sdp.parseRtpMap)(line);
                var currentCodec = codecMap[rtpMap.payloadType];

                // remove this codec if SdpOptions#forceCodec specifies a different codec for current media type
                if (is_defined(currentCodec) && sdpOptions._shouldDeleteCodec(mediaType, currentCodec.name)) {
                    return null;
                }

                // append a=fmtp line immediately if current codec is OPUS (to explicitly specify OPUS parameters)
                if (is_defined(currentCodec) && currentCodec.name.toUpperCase() === 'OPUS') {
                    currentCodec.parameters.usedtx = sdpOptions.enableOpusDtx ? "1" : "0";
                    // generate fmtp line immediately after rtpmap line, and remove original fmtp line once we see it
                    return (line + "\r\n" + (0, _sdp.writeFmtp)(currentCodec)).trim();
                } else {
                    return line;
                }
            } else if (line.startsWith('a=fmtp:')) {
                var pt = line.substring('a=fmtp:'.length, line.indexOf(' '));
                var currentCodec = codecMap[pt]; // eslint-disable-line no-redeclare

                // remove this codec if SdpOptions#forceCodec specifies a different codec for current media type
                if (is_defined(currentCodec) && sdpOptions._shouldDeleteCodec(mediaType, currentCodec.name)) {
                    return null;
                }

                if (is_defined(currentCodec) && currentCodec.name.toUpperCase() === 'OPUS') {
                    // this is a line for OPUS, remove it because FMTP line is already generated when rtpmap line is processed
                    return null;
                } else {
                    return line;
                }
            } else if (line.startsWith('a=rtcp-fb:')) {
                var pt = line.substring(line.indexOf(':') + 1, line.indexOf(' ')); // eslint-disable-line no-redeclare
                if (pt === '*') {
                    //always allow wildcard in rtc-fb
                    return line;
                } else {
                    var currentCodec = codecMap[pt]; // eslint-disable-line no-redeclare

                    // remove this codec if SdpOptions#forceCodec specifies a different codec for current media type
                    if (is_defined(currentCodec) && sdpOptions._shouldDeleteCodec(mediaType, currentCodec.name)) {
                        return null;
                    } else {
                        return line;
                    }
                }
            } else {
                return line;
            }
        }).filter(function (line) {
            return line !== null;
        }).join('\r\n');
    }
    return {
        sdp: sections.map(function (section) {
            return section.trim();
        }).join('\r\n') + '\r\n',
        mLines: sections.length - 1 // first section is session description, the rest are media descriptions
    };
}

function is_defined(v) {
    return typeof v !== 'undefined';
}

function when_defined(v, alternativeIn) {
    var alternative = is_defined(alternativeIn) ? alternativeIn : null;
    return is_defined(v) ? v : alternative;
}

/**
 * Check if the getStats API for retrieving legacy stats report is supported
 */
function isLegacyStatsReportSupported(pc) {
    return new Promise(function (resolve) {
        pc.getStats(function () {
            resolve(true);
        }).catch(function () {
            // Exception thrown if browser does not support legacy stats report
            resolve(false);
        });
    });
}

/**
 * Determine if the given value is a callable function type.
 * Borrowed from Underscore.js.
 */
function isFunction(obj) {
    return !!(obj && obj.constructor && obj.call && obj.apply);
}

/**
 * Asserts that a premise is true.
 */
function assertTrue(premise, message) {
    if (!premise) {
        throw new Error(message);
    }
}

function isChromeBrowser() {
    return navigator.userAgent.indexOf("Chrome") !== -1;
}

function getChromeBrowserVersion() {
    var userAgent = navigator.userAgent;
    var chromeVersion = userAgent.substring(userAgent.indexOf("Chrome") + 7);
    if (chromeVersion) {
        return parseFloat(chromeVersion);
    } else {
        return -1;
    }
}

function isCitrixWebRTCSupported() {
    return window.CitrixWebRTC.isFeatureOn("webrtc1.0");
}

function getRedactedSdp(sdp) {
    // pattern to find and redact the value after 'a=ice-pwd:'
    var pattern = /a=ice-pwd:[^\r\n]*/;

    // Use the replace method to redact the value with '[redacted]'
    return sdp.replace(pattern, 'a=ice-pwd:[redacted]');
}

},{"./exceptions":135,"babel-runtime/helpers/classCallCheck":11,"babel-runtime/helpers/createClass":12,"sdp":118}],146:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _utils = require('./utils');

var _rtc_const = require('./rtc_const');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var VirtualWssConnectionManager = function () {
    function VirtualWssConnectionManager(logger, connectionId, wssManager) {
        (0, _classCallCheck3.default)(this, VirtualWssConnectionManager);

        this._logger = logger;
        this._connectionId = connectionId;
        this._wssManager = wssManager;
        this._initializeWebSocketEventListeners();
    }

    (0, _createClass3.default)(VirtualWssConnectionManager, [{
        key: '_initializeWebSocketEventListeners',
        value: function _initializeWebSocketEventListeners() {
            var _this = this;

            this._wssManager.subscribeTopics([_rtc_const.SOFTPHONE_ROUTE_KEY]);
            this._unSubscribe = this._wssManager.onMessage(_rtc_const.SOFTPHONE_ROUTE_KEY, (0, _utils.hitch)(this, this._webSocketManagerOnMessage));
            setTimeout(function () {
                _this._onOpen();
            }, 0);
        }
    }, {
        key: '_webSocketManagerOnMessage',
        value: function _webSocketManagerOnMessage(event) {
            var content = void 0;
            if (event.content) {
                content = JSON.parse(event.content);
            }
            if (this._onMessage && content && this._connectionId === content.connectionId) {
                this._onMessage({ data: JSON.stringify(content.jsonRpcMsg) });
            }
        }
    }, {
        key: 'send',
        value: function send(webSocketPayload) {
            var payload = {};
            try {
                payload.topic = _rtc_const.SOFTPHONE_ROUTE_KEY;
                payload.connectionId = this._connectionId;
                payload.jsonRpcMsg = JSON.parse(webSocketPayload);
                this._wssManager.sendMessage(payload);
            } catch (error) {
                this._logger.error("Error in sendMessage ", error);
            }
        }
    }, {
        key: 'close',
        value: function close() {
            this._logger.info("closing virtual connection");
            this._unSubscribe();
        }
    }, {
        key: 'onmessage',
        set: function set(callBack) {
            this._onMessage = callBack;
        }
    }, {
        key: 'onopen',
        set: function set(callBack) {
            this._onOpen = callBack;
        }
    }]);
    return VirtualWssConnectionManager;
}();

exports.default = VirtualWssConnectionManager;

},{"./rtc_const":136,"./utils":145,"babel-runtime/helpers/classCallCheck":11,"babel-runtime/helpers/createClass":12}]},{},[134])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvQGNpdHJpeC91Y3Nkay9DaXRyaXhXZWJSVEMuanMiLCJub2RlX21vZHVsZXMvYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9jcmVhdGUuanMiLCJub2RlX21vZHVsZXMvYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9kZWZpbmUtcHJvcGVydHkuanMiLCJub2RlX21vZHVsZXMvYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3IuanMiLCJub2RlX21vZHVsZXMvYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9nZXQtcHJvdG90eXBlLW9mLmpzIiwibm9kZV9tb2R1bGVzL2JhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3Qvc2V0LXByb3RvdHlwZS1vZi5qcyIsIm5vZGVfbW9kdWxlcy9iYWJlbC1ydW50aW1lL2NvcmUtanMvcHJvbWlzZS5qcyIsIm5vZGVfbW9kdWxlcy9iYWJlbC1ydW50aW1lL2NvcmUtanMvc3ltYm9sLmpzIiwibm9kZV9tb2R1bGVzL2JhYmVsLXJ1bnRpbWUvY29yZS1qcy9zeW1ib2wvaXRlcmF0b3IuanMiLCJub2RlX21vZHVsZXMvYmFiZWwtcnVudGltZS9oZWxwZXJzL2FzeW5jVG9HZW5lcmF0b3IuanMiLCJub2RlX21vZHVsZXMvYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzQ2FsbENoZWNrLmpzIiwibm9kZV9tb2R1bGVzL2JhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGVDbGFzcy5qcyIsIm5vZGVfbW9kdWxlcy9iYWJlbC1ydW50aW1lL2hlbHBlcnMvZ2V0LmpzIiwibm9kZV9tb2R1bGVzL2JhYmVsLXJ1bnRpbWUvaGVscGVycy9pbmhlcml0cy5qcyIsIm5vZGVfbW9kdWxlcy9iYWJlbC1ydW50aW1lL2hlbHBlcnMvcG9zc2libGVDb25zdHJ1Y3RvclJldHVybi5qcyIsIm5vZGVfbW9kdWxlcy9iYWJlbC1ydW50aW1lL2hlbHBlcnMvdHlwZW9mLmpzIiwibm9kZV9tb2R1bGVzL2JhYmVsLXJ1bnRpbWUvbm9kZV9tb2R1bGVzL3JlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZS1tb2R1bGUuanMiLCJub2RlX21vZHVsZXMvYmFiZWwtcnVudGltZS9ub2RlX21vZHVsZXMvcmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lLmpzIiwibm9kZV9tb2R1bGVzL2JhYmVsLXJ1bnRpbWUvcmVnZW5lcmF0b3IvaW5kZXguanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9jcmVhdGUuanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9kZWZpbmUtcHJvcGVydHkuanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3IuanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9nZXQtcHJvdG90eXBlLW9mLmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9mbi9vYmplY3Qvc2V0LXByb3RvdHlwZS1vZi5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvZm4vcHJvbWlzZS5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvZm4vc3ltYm9sL2luZGV4LmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9mbi9zeW1ib2wvaXRlcmF0b3IuanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvX2EtZnVuY3Rpb24uanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvX2FkZC10by11bnNjb3BhYmxlcy5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9fYW4taW5zdGFuY2UuanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvX2FuLW9iamVjdC5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9fYXJyYXktaW5jbHVkZXMuanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvX2NsYXNzb2YuanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvX2NvZi5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9fY29yZS5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9fY3R4LmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19kZWZpbmVkLmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19kZXNjcmlwdG9ycy5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9fZG9tLWNyZWF0ZS5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9fZW51bS1idWcta2V5cy5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9fZW51bS1rZXlzLmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19leHBvcnQuanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvX2ZhaWxzLmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19mb3Itb2YuanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvX2dsb2JhbC5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9faGFzLmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19oaWRlLmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19odG1sLmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19pZTgtZG9tLWRlZmluZS5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9faW52b2tlLmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19pb2JqZWN0LmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19pcy1hcnJheS1pdGVyLmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19pcy1hcnJheS5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9faXMtb2JqZWN0LmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19pdGVyLWNhbGwuanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvX2l0ZXItY3JlYXRlLmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19pdGVyLWRlZmluZS5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9faXRlci1kZXRlY3QuanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvX2l0ZXItc3RlcC5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9faXRlcmF0b3JzLmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19saWJyYXJ5LmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19tZXRhLmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19taWNyb3Rhc2suanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvX25ldy1wcm9taXNlLWNhcGFiaWxpdHkuanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvX29iamVjdC1jcmVhdGUuanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvX29iamVjdC1kcC5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9fb2JqZWN0LWRwcy5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9fb2JqZWN0LWdvcGQuanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvX29iamVjdC1nb3BuLWV4dC5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9fb2JqZWN0LWdvcG4uanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvX29iamVjdC1nb3BzLmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19vYmplY3QtZ3BvLmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19vYmplY3Qta2V5cy1pbnRlcm5hbC5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9fb2JqZWN0LWtleXMuanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvX29iamVjdC1waWUuanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvX29iamVjdC1zYXAuanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvX3BlcmZvcm0uanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvX3Byb21pc2UtcmVzb2x2ZS5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9fcHJvcGVydHktZGVzYy5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9fcmVkZWZpbmUtYWxsLmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19yZWRlZmluZS5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9fc2V0LXByb3RvLmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL19zZXQtc3BlY2llcy5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9fc2V0LXRvLXN0cmluZy10YWcuanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvX3NoYXJlZC1rZXkuanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvX3NoYXJlZC5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9fc3BlY2llcy1jb25zdHJ1Y3Rvci5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9fc3RyaW5nLWF0LmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL190YXNrLmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL190by1hYnNvbHV0ZS1pbmRleC5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9fdG8taW50ZWdlci5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9fdG8taW9iamVjdC5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9fdG8tbGVuZ3RoLmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL190by1vYmplY3QuanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvX3RvLXByaW1pdGl2ZS5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9fdWlkLmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL191c2VyLWFnZW50LmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL193a3MtZGVmaW5lLmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL193a3MtZXh0LmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL193a3MuanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvY29yZS5nZXQtaXRlcmF0b3ItbWV0aG9kLmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL2VzNi5hcnJheS5pdGVyYXRvci5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9lczYub2JqZWN0LmNyZWF0ZS5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9lczYub2JqZWN0LmRlZmluZS1wcm9wZXJ0eS5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9lczYub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvci5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9lczYub2JqZWN0LmdldC1wcm90b3R5cGUtb2YuanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvZXM2Lm9iamVjdC5zZXQtcHJvdG90eXBlLW9mLmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL2VzNi5vYmplY3QudG8tc3RyaW5nLmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL2VzNi5wcm9taXNlLmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL2VzNi5zdHJpbmcuaXRlcmF0b3IuanMiLCJub2RlX21vZHVsZXMvY29yZS1qcy9saWJyYXJ5L21vZHVsZXMvZXM2LnN5bWJvbC5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9lczcucHJvbWlzZS5maW5hbGx5LmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL2VzNy5wcm9taXNlLnRyeS5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy9lczcuc3ltYm9sLmFzeW5jLWl0ZXJhdG9yLmpzIiwibm9kZV9tb2R1bGVzL2NvcmUtanMvbGlicmFyeS9tb2R1bGVzL2VzNy5zeW1ib2wub2JzZXJ2YWJsZS5qcyIsIm5vZGVfbW9kdWxlcy9jb3JlLWpzL2xpYnJhcnkvbW9kdWxlcy93ZWIuZG9tLml0ZXJhYmxlLmpzIiwibm9kZV9tb2R1bGVzL3J0Y3BlZXJjb25uZWN0aW9uLXNoaW0vcnRjcGVlcmNvbm5lY3Rpb24uanMiLCJub2RlX21vZHVsZXMvc2RwL3NkcC5qcyIsIm5vZGVfbW9kdWxlcy91dWlkL2xpYi9ieXRlc1RvVXVpZC5qcyIsIm5vZGVfbW9kdWxlcy91dWlkL2xpYi9ybmctYnJvd3Nlci5qcyIsIm5vZGVfbW9kdWxlcy91dWlkL3Y0LmpzIiwibm9kZV9tb2R1bGVzL3dlYnJ0Yy1hZGFwdGVyL3NyYy9qcy9hZGFwdGVyX2NvcmUuanMiLCJub2RlX21vZHVsZXMvd2VicnRjLWFkYXB0ZXIvc3JjL2pzL2FkYXB0ZXJfZmFjdG9yeS5qcyIsIm5vZGVfbW9kdWxlcy93ZWJydGMtYWRhcHRlci9zcmMvanMvY2hyb21lL2Nocm9tZV9zaGltLmpzIiwibm9kZV9tb2R1bGVzL3dlYnJ0Yy1hZGFwdGVyL3NyYy9qcy9jaHJvbWUvZ2V0dXNlcm1lZGlhLmpzIiwibm9kZV9tb2R1bGVzL3dlYnJ0Yy1hZGFwdGVyL3NyYy9qcy9jb21tb25fc2hpbS5qcyIsIm5vZGVfbW9kdWxlcy93ZWJydGMtYWRhcHRlci9zcmMvanMvZWRnZS9lZGdlX3NoaW0uanMiLCJub2RlX21vZHVsZXMvd2VicnRjLWFkYXB0ZXIvc3JjL2pzL2VkZ2UvZmlsdGVyaWNlc2VydmVycy5qcyIsIm5vZGVfbW9kdWxlcy93ZWJydGMtYWRhcHRlci9zcmMvanMvZWRnZS9nZXR1c2VybWVkaWEuanMiLCJub2RlX21vZHVsZXMvd2VicnRjLWFkYXB0ZXIvc3JjL2pzL2ZpcmVmb3gvZmlyZWZveF9zaGltLmpzIiwibm9kZV9tb2R1bGVzL3dlYnJ0Yy1hZGFwdGVyL3NyYy9qcy9maXJlZm94L2dldHVzZXJtZWRpYS5qcyIsIm5vZGVfbW9kdWxlcy93ZWJydGMtYWRhcHRlci9zcmMvanMvc2FmYXJpL3NhZmFyaV9zaGltLmpzIiwibm9kZV9tb2R1bGVzL3dlYnJ0Yy1hZGFwdGVyL3NyYy9qcy91dGlscy5qcyIsInNyYy9qcy9jb25uZWN0LXJ0Yy5qcyIsInNyYy9qcy9leGNlcHRpb25zLmpzIiwic3JjL2pzL3J0Y19jb25zdC5qcyIsInNyYy9qcy9ydGNfcGVlcl9jb25uZWN0aW9uX2ZhY3RvcnkuanMiLCJzcmMvanMvcnRjX3Nlc3Npb24uanMiLCJzcmMvanMvcnRwLXN0YXRzLmpzIiwic3JjL2pzL3Nlc3Npb25fcmVwb3J0LmpzIiwic3JjL2pzL3NpZ25hbGluZy5qcyIsInNyYy9qcy9zdHJhdGVnaWVzL0NDUEluaXRpYXRpb25TdHJhdGVneUludGVyZmFjZS5qcyIsInNyYy9qcy9zdHJhdGVnaWVzL0NpdHJpeFZESVN0cmF0ZWd5LmpzIiwic3JjL2pzL3N0cmF0ZWdpZXMvU3RhbmRhcmRTdHJhdGVneS5qcyIsInNyYy9qcy91dGlscy5qcyIsInNyYy9qcy92aXJ0dWFsX3dzc19jb25uZWN0aW9uX21hbmFnZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7O0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQy9jQTs7QUNBQTs7QUNBQTs7QUNBQTs7QUNBQTs7QUNBQTs7QUNBQTs7QUNBQTs7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25DQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3Z0QkE7QUFDQTs7QUNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNMQTtBQUNBO0FBQ0E7O0FDRkE7QUFDQTtBQUNBOztBQ0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ0xBO0FBQ0E7QUFDQTtBQUNBOztBQ0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDSkE7QUFDQTs7QUNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDTEE7QUFDQTtBQUNBOztBQ0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNSQTtBQUNBO0FBQ0E7O0FDRkE7QUFDQTtBQUNBO0FBQ0E7O0FDSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDTkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNMQTtBQUNBO0FBQ0E7QUFDQTs7QUNIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RCQTtBQUNBO0FBQ0E7QUFDQTs7QUNIQTtBQUNBOztBQ0RBO0FBQ0E7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ25CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1BBO0FBQ0E7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDUEE7QUFDQTs7QUNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDUEE7QUFDQTs7QUNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDVEE7QUFDQTs7QUNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbENBO0FBQ0E7QUFDQTtBQUNBOztBQ0hBO0FBQ0E7QUFDQTtBQUNBOztBQ0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1RBO0FBQ0E7QUFDQTtBQUNBOztBQ0hBOztBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOVJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdFBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDWkE7QUFDQTs7QUNEQTtBQUNBOztBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2owREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDenpCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDN0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUNiQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDejZCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbFNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDak5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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RUFBaEI7QUFDSDtBQUNKOzs7NkJBVUksZ0IsRUFBa0I7QUFDbkIsZ0JBQU0sVUFBVSxFQUFoQjtBQUNBLGdCQUFJO0FBQ0Esd0JBQVEsS0FBUixHQUFnQiw4QkFBaEI7QUFDQSx3QkFBUSxZQUFSLEdBQXVCLEtBQUssYUFBNUI7QUFDQSx3QkFBUSxVQUFSLEdBQXFCLEtBQUssS0FBTCxDQUFXLGdCQUFYLENBQXJCO0FBQ0EscUJBQUssV0FBTCxDQUFpQixXQUFqQixDQUE2QixPQUE3QjtBQUNILGFBTEQsQ0FLRSxPQUFPLEtBQVAsRUFBYztBQUNaLHFCQUFLLE9BQUwsQ0FBYSxLQUFiLENBQW1CLHVCQUFuQixFQUE0QyxLQUE1QztBQUNIO0FBQ0o7OztnQ0FFTztBQUNKLGlCQUFLLE9BQUwsQ0FBYSxJQUFiLENBQWtCLDRCQUFsQjtBQUNBLGlCQUFLLFlBQUw7QUFDSDs7OzBCQXZCYSxRLEVBQVU7QUFDcEIsaUJBQUssVUFBTCxHQUFrQixRQUFsQjtBQUNIOzs7MEJBRVUsUSxFQUFVO0FBQ2pCLGlCQUFLLE9BQUwsR0FBZSxRQUFmO0FBQ0g7Ozs7O2tCQWhDZ0IsMkIiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJ2YXIgJGpzY29tcD17c2NvcGU6e30sZ2V0R2xvYmFsOmZ1bmN0aW9uKGQpe3JldHVyblwidW5kZWZpbmVkXCIhPXR5cGVvZiB3aW5kb3cmJndpbmRvdz09PWQ/ZDpcInVuZGVmaW5lZFwiIT10eXBlb2YgZ2xvYmFsP2dsb2JhbDpkfX07JGpzY29tcC5nbG9iYWw9JGpzY29tcC5nZXRHbG9iYWwodGhpcyk7JGpzY29tcC5pbml0U3ltYm9sPWZ1bmN0aW9uKCl7JGpzY29tcC5nbG9iYWwuU3ltYm9sfHwoJGpzY29tcC5nbG9iYWwuU3ltYm9sPSRqc2NvbXAuU3ltYm9sKTskanNjb21wLmluaXRTeW1ib2w9ZnVuY3Rpb24oKXt9fTskanNjb21wLnN5bWJvbENvdW50ZXJfPTA7JGpzY29tcC5TeW1ib2w9ZnVuY3Rpb24oZCl7cmV0dXJuXCJqc2NvbXBfc3ltYm9sX1wiK2QrJGpzY29tcC5zeW1ib2xDb3VudGVyXysrfTtcbiRqc2NvbXAuaW5pdFN5bWJvbEl0ZXJhdG9yPWZ1bmN0aW9uKCl7JGpzY29tcC5pbml0U3ltYm9sKCk7JGpzY29tcC5nbG9iYWwuU3ltYm9sLml0ZXJhdG9yfHwoJGpzY29tcC5nbG9iYWwuU3ltYm9sLml0ZXJhdG9yPSRqc2NvbXAuZ2xvYmFsLlN5bWJvbChcIml0ZXJhdG9yXCIpKTskanNjb21wLmluaXRTeW1ib2xJdGVyYXRvcj1mdW5jdGlvbigpe319OyRqc2NvbXAubWFrZUl0ZXJhdG9yPWZ1bmN0aW9uKGQpeyRqc2NvbXAuaW5pdFN5bWJvbEl0ZXJhdG9yKCk7aWYoZFskanNjb21wLmdsb2JhbC5TeW1ib2wuaXRlcmF0b3JdKXJldHVybiBkWyRqc2NvbXAuZ2xvYmFsLlN5bWJvbC5pdGVyYXRvcl0oKTt2YXIgZT0wO3JldHVybntuZXh0OmZ1bmN0aW9uKCl7cmV0dXJuIGU9PWQubGVuZ3RoP3tkb25lOiEwfTp7ZG9uZTohMSx2YWx1ZTpkW2UrK119fX19O1xuJGpzY29tcC5hcnJheUZyb21JdGVyYXRvcj1mdW5jdGlvbihkKXtmb3IodmFyIGUsaz1bXTshKGU9ZC5uZXh0KCkpLmRvbmU7KWsucHVzaChlLnZhbHVlKTtyZXR1cm4ga307JGpzY29tcC5hcnJheUZyb21JdGVyYWJsZT1mdW5jdGlvbihkKXtyZXR1cm4gZCBpbnN0YW5jZW9mIEFycmF5P2Q6JGpzY29tcC5hcnJheUZyb21JdGVyYXRvcigkanNjb21wLm1ha2VJdGVyYXRvcihkKSl9O1xuJGpzY29tcC5pbmhlcml0cz1mdW5jdGlvbihkLGUpe2Z1bmN0aW9uIGsoKXt9ay5wcm90b3R5cGU9ZS5wcm90b3R5cGU7ZC5wcm90b3R5cGU9bmV3IGs7ZC5wcm90b3R5cGUuY29uc3RydWN0b3I9ZDtmb3IodmFyIGIgaW4gZSlpZigkanNjb21wLmdsb2JhbC5PYmplY3QuZGVmaW5lUHJvcGVydGllcyl7dmFyIGE9JGpzY29tcC5nbG9iYWwuT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihlLGIpO2EmJiRqc2NvbXAuZ2xvYmFsLk9iamVjdC5kZWZpbmVQcm9wZXJ0eShkLGIsYSl9ZWxzZSBkW2JdPWVbYl19OyRqc2NvbXAuYXJyYXk9JGpzY29tcC5hcnJheXx8e307JGpzY29tcC5hcnJheS5kb25lXz1mdW5jdGlvbigpe3JldHVybntkb25lOiEwLHZhbHVlOnZvaWQgMH19O1xuJGpzY29tcC5hcnJheS5hcnJheUl0ZXJhdG9yXz1mdW5jdGlvbihkLGUpe2QgaW5zdGFuY2VvZiBTdHJpbmcmJihkPVN0cmluZyhkKSk7dmFyIGs9MDskanNjb21wLmluaXRTeW1ib2woKTskanNjb21wLmluaXRTeW1ib2xJdGVyYXRvcigpO3ZhciBiPXt9LGE9KGIubmV4dD1mdW5jdGlvbigpe2lmKGs8ZC5sZW5ndGgpe3ZhciBiPWsrKztyZXR1cm57dmFsdWU6ZShiLGRbYl0pLGRvbmU6ITF9fWEubmV4dD0kanNjb21wLmFycmF5LmRvbmVfO3JldHVybiAkanNjb21wLmFycmF5LmRvbmVfKCl9LGJbU3ltYm9sLml0ZXJhdG9yXT1mdW5jdGlvbigpe3JldHVybiBhfSxiKTtyZXR1cm4gYX07XG4kanNjb21wLmFycmF5LmZpbmRJbnRlcm5hbF89ZnVuY3Rpb24oZCxlLGspe2QgaW5zdGFuY2VvZiBTdHJpbmcmJihkPVN0cmluZyhkKSk7Zm9yKHZhciBiPWQubGVuZ3RoLGE9MDthPGI7YSsrKXt2YXIgYz1kW2FdO2lmKGUuY2FsbChrLGMsYSxkKSlyZXR1cm57aTphLHY6Y319cmV0dXJue2k6LTEsdjp2b2lkIDB9fTtcbiRqc2NvbXAuYXJyYXkuZnJvbT1mdW5jdGlvbihkLGUsayl7ZT12b2lkIDA9PT1lP2Z1bmN0aW9uKGEpe3JldHVybiBhfTplO3ZhciBiPVtdOyRqc2NvbXAuaW5pdFN5bWJvbCgpOyRqc2NvbXAuaW5pdFN5bWJvbEl0ZXJhdG9yKCk7aWYoZFtTeW1ib2wuaXRlcmF0b3JdKXskanNjb21wLmluaXRTeW1ib2woKTskanNjb21wLmluaXRTeW1ib2xJdGVyYXRvcigpO2Q9ZFtTeW1ib2wuaXRlcmF0b3JdKCk7Zm9yKHZhciBhOyEoYT1kLm5leHQoKSkuZG9uZTspYi5wdXNoKGUuY2FsbChrLGEudmFsdWUpKX1lbHNle2E9ZC5sZW5ndGg7Zm9yKHZhciBjPTA7YzxhO2MrKyliLnB1c2goZS5jYWxsKGssZFtjXSkpfXJldHVybiBifTskanNjb21wLmFycmF5Lm9mPWZ1bmN0aW9uKGQpe2Zvcih2YXIgZT1bXSxrPTA7azxhcmd1bWVudHMubGVuZ3RoOysrayllW2stMF09YXJndW1lbnRzW2tdO3JldHVybiAkanNjb21wLmFycmF5LmZyb20oZSl9O1xuJGpzY29tcC5hcnJheS5lbnRyaWVzPWZ1bmN0aW9uKCl7cmV0dXJuICRqc2NvbXAuYXJyYXkuYXJyYXlJdGVyYXRvcl8odGhpcyxmdW5jdGlvbihkLGUpe3JldHVybltkLGVdfSl9OyRqc2NvbXAuYXJyYXkuZW50cmllcyRpbnN0YWxsPWZ1bmN0aW9uKCl7QXJyYXkucHJvdG90eXBlLmVudHJpZXN8fChBcnJheS5wcm90b3R5cGUuZW50cmllcz0kanNjb21wLmFycmF5LmVudHJpZXMpfTskanNjb21wLmFycmF5LmtleXM9ZnVuY3Rpb24oKXtyZXR1cm4gJGpzY29tcC5hcnJheS5hcnJheUl0ZXJhdG9yXyh0aGlzLGZ1bmN0aW9uKGQpe3JldHVybiBkfSl9OyRqc2NvbXAuYXJyYXkua2V5cyRpbnN0YWxsPWZ1bmN0aW9uKCl7QXJyYXkucHJvdG90eXBlLmtleXN8fChBcnJheS5wcm90b3R5cGUua2V5cz0kanNjb21wLmFycmF5LmtleXMpfTskanNjb21wLmFycmF5LnZhbHVlcz1mdW5jdGlvbigpe3JldHVybiAkanNjb21wLmFycmF5LmFycmF5SXRlcmF0b3JfKHRoaXMsZnVuY3Rpb24oZCxlKXtyZXR1cm4gZX0pfTtcbiRqc2NvbXAuYXJyYXkudmFsdWVzJGluc3RhbGw9ZnVuY3Rpb24oKXtBcnJheS5wcm90b3R5cGUudmFsdWVzfHwoQXJyYXkucHJvdG90eXBlLnZhbHVlcz0kanNjb21wLmFycmF5LnZhbHVlcyl9OyRqc2NvbXAuYXJyYXkuY29weVdpdGhpbj1mdW5jdGlvbihkLGUsayl7dmFyIGI9dGhpcy5sZW5ndGg7ZD1OdW1iZXIoZCk7ZT1OdW1iZXIoZSk7az1OdW1iZXIobnVsbCE9az9rOmIpO2lmKGQ8ZSlmb3Ioaz1NYXRoLm1pbihrLGIpO2U8azspZSBpbiB0aGlzP3RoaXNbZCsrXT10aGlzW2UrK106KGRlbGV0ZSB0aGlzW2QrK10sZSsrKTtlbHNlIGZvcihrPU1hdGgubWluKGssYitlLWQpLGQrPWstZTtrPmU7KS0tayBpbiB0aGlzP3RoaXNbLS1kXT10aGlzW2tdOmRlbGV0ZSB0aGlzW2RdO3JldHVybiB0aGlzfTskanNjb21wLmFycmF5LmNvcHlXaXRoaW4kaW5zdGFsbD1mdW5jdGlvbigpe0FycmF5LnByb3RvdHlwZS5jb3B5V2l0aGlufHwoQXJyYXkucHJvdG90eXBlLmNvcHlXaXRoaW49JGpzY29tcC5hcnJheS5jb3B5V2l0aGluKX07XG4kanNjb21wLmFycmF5LmZpbGw9ZnVuY3Rpb24oZCxlLGspe251bGwhPWsmJmQubGVuZ3RofHwoaz10aGlzLmxlbmd0aHx8MCk7az1OdW1iZXIoayk7Zm9yKGU9TnVtYmVyKCh2b2lkIDA9PT1lPzA6ZSl8fDApO2U8aztlKyspdGhpc1tlXT1kO3JldHVybiB0aGlzfTskanNjb21wLmFycmF5LmZpbGwkaW5zdGFsbD1mdW5jdGlvbigpe0FycmF5LnByb3RvdHlwZS5maWxsfHwoQXJyYXkucHJvdG90eXBlLmZpbGw9JGpzY29tcC5hcnJheS5maWxsKX07JGpzY29tcC5hcnJheS5maW5kPWZ1bmN0aW9uKGQsZSl7cmV0dXJuICRqc2NvbXAuYXJyYXkuZmluZEludGVybmFsXyh0aGlzLGQsZSkudn07JGpzY29tcC5hcnJheS5maW5kJGluc3RhbGw9ZnVuY3Rpb24oKXtBcnJheS5wcm90b3R5cGUuZmluZHx8KEFycmF5LnByb3RvdHlwZS5maW5kPSRqc2NvbXAuYXJyYXkuZmluZCl9O1xuJGpzY29tcC5hcnJheS5maW5kSW5kZXg9ZnVuY3Rpb24oZCxlKXtyZXR1cm4gJGpzY29tcC5hcnJheS5maW5kSW50ZXJuYWxfKHRoaXMsZCxlKS5pfTskanNjb21wLmFycmF5LmZpbmRJbmRleCRpbnN0YWxsPWZ1bmN0aW9uKCl7QXJyYXkucHJvdG90eXBlLmZpbmRJbmRleHx8KEFycmF5LnByb3RvdHlwZS5maW5kSW5kZXg9JGpzY29tcC5hcnJheS5maW5kSW5kZXgpfTskanNjb21wLk1hcD1mdW5jdGlvbihkKXtkPXZvaWQgMD09PWQ/W106ZDt0aGlzLmRhdGFfPXt9O3RoaXMuaGVhZF89JGpzY29tcC5NYXAuY3JlYXRlSGVhZF8oKTt0aGlzLnNpemU9MDtpZihkKXtkPSRqc2NvbXAubWFrZUl0ZXJhdG9yKGQpO2Zvcih2YXIgZT1kLm5leHQoKTshZS5kb25lO2U9ZC5uZXh0KCkpZT1lLnZhbHVlLHRoaXMuc2V0KGVbMF0sZVsxXSl9fTtcbiRqc2NvbXAuTWFwLmNoZWNrQnJvd3NlckNvbmZvcm1hbmNlXz1mdW5jdGlvbigpe3ZhciBkPSRqc2NvbXAuZ2xvYmFsLk1hcDtpZighZHx8IWQucHJvdG90eXBlLmVudHJpZXN8fCFPYmplY3Quc2VhbClyZXR1cm4hMTt0cnl7dmFyIGU9T2JqZWN0LnNlYWwoe3g6NH0pLGs9bmV3IGQoJGpzY29tcC5tYWtlSXRlcmF0b3IoW1tlLFwic1wiXV0pKTtpZihcInNcIiE9ay5nZXQoZSl8fDEhPWsuc2l6ZXx8ay5nZXQoe3g6NH0pfHxrLnNldCh7eDo0fSxcInRcIikhPWt8fDIhPWsuc2l6ZSlyZXR1cm4hMTt2YXIgYj1rLmVudHJpZXMoKSxhPWIubmV4dCgpO2lmKGEuZG9uZXx8YS52YWx1ZVswXSE9ZXx8XCJzXCIhPWEudmFsdWVbMV0pcmV0dXJuITE7YT1iLm5leHQoKTtyZXR1cm4gYS5kb25lfHw0IT1hLnZhbHVlWzBdLnh8fFwidFwiIT1hLnZhbHVlWzFdfHwhYi5uZXh0KCkuZG9uZT8hMTohMH1jYXRjaChjKXtyZXR1cm4hMX19O1xuJGpzY29tcC5NYXAuY3JlYXRlSGVhZF89ZnVuY3Rpb24oKXt2YXIgZD17fTtyZXR1cm4gZC5wcmV2aW91cz1kLm5leHQ9ZC5oZWFkPWR9OyRqc2NvbXAuTWFwLmdldElkXz1mdW5jdGlvbihkKXtpZighKGQgaW5zdGFuY2VvZiBPYmplY3QpKXJldHVybiBTdHJpbmcoZCk7JGpzY29tcC5NYXAua2V5XyBpbiBkfHxkIGluc3RhbmNlb2YgT2JqZWN0JiZPYmplY3QuaXNFeHRlbnNpYmxlJiZPYmplY3QuaXNFeHRlbnNpYmxlKGQpJiYkanNjb21wLk1hcC5kZWZpbmVQcm9wZXJ0eV8oZCwkanNjb21wLk1hcC5rZXlfLCsrJGpzY29tcC5NYXAuaW5kZXhfKTtyZXR1cm4gJGpzY29tcC5NYXAua2V5XyBpbiBkP2RbJGpzY29tcC5NYXAua2V5X106XCIgXCIrZH07XG4kanNjb21wLk1hcC5wcm90b3R5cGUuc2V0PWZ1bmN0aW9uKGQsZSl7dmFyIGs9dGhpcy5tYXliZUdldEVudHJ5XyhkKSxiPWsuaWQsYT1rLmxpc3Qsaz1rLmVudHJ5O2F8fChhPXRoaXMuZGF0YV9bYl09W10pO2s/ay52YWx1ZT1lOihrPXtuZXh0OnRoaXMuaGVhZF8scHJldmlvdXM6dGhpcy5oZWFkXy5wcmV2aW91cyxoZWFkOnRoaXMuaGVhZF8sa2V5OmQsdmFsdWU6ZX0sYS5wdXNoKGspLHRoaXMuaGVhZF8ucHJldmlvdXMubmV4dD1rLHRoaXMuaGVhZF8ucHJldmlvdXM9ayx0aGlzLnNpemUrKyk7cmV0dXJuIHRoaXN9O1xuJGpzY29tcC5NYXAucHJvdG90eXBlW1wiZGVsZXRlXCJdPWZ1bmN0aW9uKGQpe3ZhciBlPXRoaXMubWF5YmVHZXRFbnRyeV8oZCk7ZD1lLmlkO3ZhciBrPWUubGlzdCxiPWUuaW5kZXg7cmV0dXJuKGU9ZS5lbnRyeSkmJms/KGsuc3BsaWNlKGIsMSksay5sZW5ndGh8fGRlbGV0ZSB0aGlzLmRhdGFfW2RdLGUucHJldmlvdXMubmV4dD1lLm5leHQsZS5uZXh0LnByZXZpb3VzPWUucHJldmlvdXMsZS5oZWFkPW51bGwsdGhpcy5zaXplLS0sITApOiExfTskanNjb21wLk1hcC5wcm90b3R5cGUuY2xlYXI9ZnVuY3Rpb24oKXt0aGlzLmRhdGFfPXt9O3RoaXMuaGVhZF89dGhpcy5oZWFkXy5wcmV2aW91cz0kanNjb21wLk1hcC5jcmVhdGVIZWFkXygpO3RoaXMuc2l6ZT0wfTskanNjb21wLk1hcC5wcm90b3R5cGUuaGFzPWZ1bmN0aW9uKGQpe3JldHVybiEhdGhpcy5tYXliZUdldEVudHJ5XyhkKS5lbnRyeX07XG4kanNjb21wLk1hcC5wcm90b3R5cGUuZ2V0PWZ1bmN0aW9uKGQpe3JldHVybihkPXRoaXMubWF5YmVHZXRFbnRyeV8oZCkuZW50cnkpJiZkLnZhbHVlfTskanNjb21wLk1hcC5wcm90b3R5cGUubWF5YmVHZXRFbnRyeV89ZnVuY3Rpb24oZCl7dmFyIGU9JGpzY29tcC5NYXAuZ2V0SWRfKGQpLGs9dGhpcy5kYXRhX1tlXTtpZihrKWZvcih2YXIgYj0wO2I8ay5sZW5ndGg7YisrKXt2YXIgYT1rW2JdO2lmKGQhPT1kJiZhLmtleSE9PWEua2V5fHxkPT09YS5rZXkpcmV0dXJue2lkOmUsbGlzdDprLGluZGV4OmIsZW50cnk6YX19cmV0dXJue2lkOmUsbGlzdDprLGluZGV4Oi0xLGVudHJ5OnZvaWQgMH19OyRqc2NvbXAuTWFwLnByb3RvdHlwZS5lbnRyaWVzPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaXRlcl8oZnVuY3Rpb24oZCl7cmV0dXJuW2Qua2V5LGQudmFsdWVdfSl9OyRqc2NvbXAuTWFwLnByb3RvdHlwZS5rZXlzPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaXRlcl8oZnVuY3Rpb24oZCl7cmV0dXJuIGQua2V5fSl9O1xuJGpzY29tcC5NYXAucHJvdG90eXBlLnZhbHVlcz1mdW5jdGlvbigpe3JldHVybiB0aGlzLml0ZXJfKGZ1bmN0aW9uKGQpe3JldHVybiBkLnZhbHVlfSl9OyRqc2NvbXAuTWFwLnByb3RvdHlwZS5mb3JFYWNoPWZ1bmN0aW9uKGQsZSl7Zm9yKHZhciBrPSRqc2NvbXAubWFrZUl0ZXJhdG9yKHRoaXMuZW50cmllcygpKSxiPWsubmV4dCgpOyFiLmRvbmU7Yj1rLm5leHQoKSliPWIudmFsdWUsZC5jYWxsKGUsYlsxXSxiWzBdLHRoaXMpfTtcbiRqc2NvbXAuTWFwLnByb3RvdHlwZS5pdGVyXz1mdW5jdGlvbihkKXt2YXIgZT10aGlzLGs9dGhpcy5oZWFkXzskanNjb21wLmluaXRTeW1ib2woKTskanNjb21wLmluaXRTeW1ib2xJdGVyYXRvcigpO3ZhciBiPXt9O3JldHVybiBiLm5leHQ9ZnVuY3Rpb24oKXtpZihrKXtmb3IoO2suaGVhZCE9ZS5oZWFkXzspaz1rLnByZXZpb3VzO2Zvcig7ay5uZXh0IT1rLmhlYWQ7KXJldHVybiBrPWsubmV4dCx7ZG9uZTohMSx2YWx1ZTpkKGspfTtrPW51bGx9cmV0dXJue2RvbmU6ITAsdmFsdWU6dm9pZCAwfX0sYltTeW1ib2wuaXRlcmF0b3JdPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9LGJ9OyRqc2NvbXAuTWFwLmluZGV4Xz0wOyRqc2NvbXAuTWFwLmRlZmluZVByb3BlcnR5Xz1PYmplY3QuZGVmaW5lUHJvcGVydHk/ZnVuY3Rpb24oZCxlLGspe09iamVjdC5kZWZpbmVQcm9wZXJ0eShkLGUse3ZhbHVlOlN0cmluZyhrKX0pfTpmdW5jdGlvbihkLGUsayl7ZFtlXT1TdHJpbmcoayl9O1xuJGpzY29tcC5NYXAuRW50cnlfPWZ1bmN0aW9uKCl7fTskanNjb21wLk1hcC5BU1NVTUVfTk9fTkFUSVZFPSExOyRqc2NvbXAuTWFwJGluc3RhbGw9ZnVuY3Rpb24oKXskanNjb21wLmluaXRTeW1ib2woKTskanNjb21wLmluaXRTeW1ib2xJdGVyYXRvcigpOyEkanNjb21wLk1hcC5BU1NVTUVfTk9fTkFUSVZFJiYkanNjb21wLk1hcC5jaGVja0Jyb3dzZXJDb25mb3JtYW5jZV8oKT8kanNjb21wLk1hcD0kanNjb21wLmdsb2JhbC5NYXA6KCRqc2NvbXAuaW5pdFN5bWJvbCgpLCRqc2NvbXAuaW5pdFN5bWJvbEl0ZXJhdG9yKCksJGpzY29tcC5NYXAucHJvdG90eXBlW1N5bWJvbC5pdGVyYXRvcl09JGpzY29tcC5NYXAucHJvdG90eXBlLmVudHJpZXMsJGpzY29tcC5pbml0U3ltYm9sKCksJGpzY29tcC5NYXAua2V5Xz1TeW1ib2woXCJtYXAtaWQta2V5XCIpKTskanNjb21wLk1hcCRpbnN0YWxsPWZ1bmN0aW9uKCl7fX07JGpzY29tcC5tYXRoPSRqc2NvbXAubWF0aHx8e307XG4kanNjb21wLm1hdGguY2x6MzI9ZnVuY3Rpb24oZCl7ZD1OdW1iZXIoZCk+Pj4wO2lmKDA9PT1kKXJldHVybiAzMjt2YXIgZT0wOzA9PT0oZCY0Mjk0OTAxNzYwKSYmKGQ8PD0xNixlKz0xNik7MD09PShkJjQyNzgxOTAwODApJiYoZDw8PTgsZSs9OCk7MD09PShkJjQwMjY1MzE4NDApJiYoZDw8PTQsZSs9NCk7MD09PShkJjMyMjEyMjU0NzIpJiYoZDw8PTIsZSs9Mik7MD09PShkJjIxNDc0ODM2NDgpJiZlKys7cmV0dXJuIGV9OyRqc2NvbXAubWF0aC5pbXVsPWZ1bmN0aW9uKGQsZSl7ZD1OdW1iZXIoZCk7ZT1OdW1iZXIoZSk7dmFyIGs9ZCY2NTUzNSxiPWUmNjU1MzU7cmV0dXJuIGsqYisoKGQ+Pj4xNiY2NTUzNSkqYitrKihlPj4+MTYmNjU1MzUpPDwxNj4+PjApfDB9OyRqc2NvbXAubWF0aC5zaWduPWZ1bmN0aW9uKGQpe2Q9TnVtYmVyKGQpO3JldHVybiAwPT09ZHx8aXNOYU4oZCk/ZDowPGQ/MTotMX07XG4kanNjb21wLm1hdGgubG9nMTA9ZnVuY3Rpb24oZCl7cmV0dXJuIE1hdGgubG9nKGQpL01hdGguTE4xMH07JGpzY29tcC5tYXRoLmxvZzI9ZnVuY3Rpb24oZCl7cmV0dXJuIE1hdGgubG9nKGQpL01hdGguTE4yfTskanNjb21wLm1hdGgubG9nMXA9ZnVuY3Rpb24oZCl7ZD1OdW1iZXIoZCk7aWYoLjI1PmQmJi0uMjU8ZCl7Zm9yKHZhciBlPWQsaz0xLGI9ZCxhPTAsYz0xO2EhPWI7KWUqPWQsYyo9LTEsYj0oYT1iKStjKmUvKytrO3JldHVybiBifXJldHVybiBNYXRoLmxvZygxK2QpfTskanNjb21wLm1hdGguZXhwbTE9ZnVuY3Rpb24oZCl7ZD1OdW1iZXIoZCk7aWYoLjI1PmQmJi0uMjU8ZCl7Zm9yKHZhciBlPWQsaz0xLGI9ZCxhPTA7YSE9YjspZSo9ZC8rK2ssYj0oYT1iKStlO3JldHVybiBifXJldHVybiBNYXRoLmV4cChkKS0xfTskanNjb21wLm1hdGguY29zaD1mdW5jdGlvbihkKXtkPU51bWJlcihkKTtyZXR1cm4oTWF0aC5leHAoZCkrTWF0aC5leHAoLWQpKS8yfTtcbiRqc2NvbXAubWF0aC5zaW5oPWZ1bmN0aW9uKGQpe2Q9TnVtYmVyKGQpO3JldHVybiAwPT09ZD9kOihNYXRoLmV4cChkKS1NYXRoLmV4cCgtZCkpLzJ9OyRqc2NvbXAubWF0aC50YW5oPWZ1bmN0aW9uKGQpe2Q9TnVtYmVyKGQpO2lmKDA9PT1kKXJldHVybiBkO3ZhciBlPU1hdGguZXhwKDIqLU1hdGguYWJzKGQpKSxlPSgxLWUpLygxK2UpO3JldHVybiAwPmQ/LWU6ZX07JGpzY29tcC5tYXRoLmFjb3NoPWZ1bmN0aW9uKGQpe2Q9TnVtYmVyKGQpO3JldHVybiBNYXRoLmxvZyhkK01hdGguc3FydChkKmQtMSkpfTskanNjb21wLm1hdGguYXNpbmg9ZnVuY3Rpb24oZCl7ZD1OdW1iZXIoZCk7aWYoMD09PWQpcmV0dXJuIGQ7dmFyIGU9TWF0aC5sb2coTWF0aC5hYnMoZCkrTWF0aC5zcXJ0KGQqZCsxKSk7cmV0dXJuIDA+ZD8tZTplfTtcbiRqc2NvbXAubWF0aC5hdGFuaD1mdW5jdGlvbihkKXtkPU51bWJlcihkKTtyZXR1cm4oJGpzY29tcC5tYXRoLmxvZzFwKGQpLSRqc2NvbXAubWF0aC5sb2cxcCgtZCkpLzJ9O1xuJGpzY29tcC5tYXRoLmh5cG90PWZ1bmN0aW9uKGQsZSxrKXtmb3IodmFyIGI9W10sYT0yO2E8YXJndW1lbnRzLmxlbmd0aDsrK2EpYlthLTJdPWFyZ3VtZW50c1thXTtkPU51bWJlcihkKTtlPU51bWJlcihlKTtmb3IodmFyIGM9TWF0aC5tYXgoTWF0aC5hYnMoZCksTWF0aC5hYnMoZSkpLEc9JGpzY29tcC5tYWtlSXRlcmF0b3IoYiksYT1HLm5leHQoKTshYS5kb25lO2E9Ry5uZXh0KCkpYz1NYXRoLm1heChjLE1hdGguYWJzKGEudmFsdWUpKTtpZigxRTEwMDxjfHwxRS0xMDA+Yyl7ZC89YztlLz1jO0c9ZCpkK2UqZTtiPSRqc2NvbXAubWFrZUl0ZXJhdG9yKGIpO2ZvcihhPWIubmV4dCgpOyFhLmRvbmU7YT1iLm5leHQoKSlhPWEudmFsdWUsYT1OdW1iZXIoYSkvYyxHKz1hKmE7cmV0dXJuIE1hdGguc3FydChHKSpjfWM9ZCpkK2UqZTtiPSRqc2NvbXAubWFrZUl0ZXJhdG9yKGIpO2ZvcihhPWIubmV4dCgpOyFhLmRvbmU7YT1iLm5leHQoKSlhPWEudmFsdWUsYT1OdW1iZXIoYSksYys9XG5hKmE7cmV0dXJuIE1hdGguc3FydChjKX07JGpzY29tcC5tYXRoLnRydW5jPWZ1bmN0aW9uKGQpe2Q9TnVtYmVyKGQpO2lmKGlzTmFOKGQpfHxJbmZpbml0eT09PWR8fC1JbmZpbml0eT09PWR8fDA9PT1kKXJldHVybiBkO3ZhciBlPU1hdGguZmxvb3IoTWF0aC5hYnMoZCkpO3JldHVybiAwPmQ/LWU6ZX07JGpzY29tcC5tYXRoLmNicnQ9ZnVuY3Rpb24oZCl7aWYoMD09PWQpcmV0dXJuIGQ7ZD1OdW1iZXIoZCk7dmFyIGU9TWF0aC5wb3coTWF0aC5hYnMoZCksMS8zKTtyZXR1cm4gMD5kPy1lOmV9OyRqc2NvbXAubnVtYmVyPSRqc2NvbXAubnVtYmVyfHx7fTskanNjb21wLm51bWJlci5pc0Zpbml0ZT1mdW5jdGlvbihkKXtyZXR1cm5cIm51bWJlclwiIT09dHlwZW9mIGQ/ITE6IWlzTmFOKGQpJiZJbmZpbml0eSE9PWQmJi1JbmZpbml0eSE9PWR9O1xuJGpzY29tcC5udW1iZXIuaXNJbnRlZ2VyPWZ1bmN0aW9uKGQpe3JldHVybiAkanNjb21wLm51bWJlci5pc0Zpbml0ZShkKT9kPT09TWF0aC5mbG9vcihkKTohMX07JGpzY29tcC5udW1iZXIuaXNOYU49ZnVuY3Rpb24oZCl7cmV0dXJuXCJudW1iZXJcIj09PXR5cGVvZiBkJiZpc05hTihkKX07JGpzY29tcC5udW1iZXIuaXNTYWZlSW50ZWdlcj1mdW5jdGlvbihkKXtyZXR1cm4gJGpzY29tcC5udW1iZXIuaXNJbnRlZ2VyKGQpJiZNYXRoLmFicyhkKTw9JGpzY29tcC5udW1iZXIuTUFYX1NBRkVfSU5URUdFUn07JGpzY29tcC5udW1iZXIuRVBTSUxPTj1NYXRoLnBvdygyLC01Mik7JGpzY29tcC5udW1iZXIuTUFYX1NBRkVfSU5URUdFUj05MDA3MTk5MjU0NzQwOTkxOyRqc2NvbXAubnVtYmVyLk1JTl9TQUZFX0lOVEVHRVI9LTkwMDcxOTkyNTQ3NDA5OTE7JGpzY29tcC5vYmplY3Q9JGpzY29tcC5vYmplY3R8fHt9O1xuJGpzY29tcC5vYmplY3QuYXNzaWduPWZ1bmN0aW9uKGQsZSl7Zm9yKHZhciBrPVtdLGI9MTtiPGFyZ3VtZW50cy5sZW5ndGg7KytiKWtbYi0xXT1hcmd1bWVudHNbYl07az0kanNjb21wLm1ha2VJdGVyYXRvcihrKTtmb3IoYj1rLm5leHQoKTshYi5kb25lO2I9ay5uZXh0KCkpaWYoYj1iLnZhbHVlKWZvcih2YXIgYSBpbiBiKU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLGEpJiYoZFthXT1iW2FdKTtyZXR1cm4gZH07JGpzY29tcC5vYmplY3QuaXM9ZnVuY3Rpb24oZCxlKXtyZXR1cm4gZD09PWU/MCE9PWR8fDEvZD09PTEvZTpkIT09ZCYmZSE9PWV9OyRqc2NvbXAuU2V0PWZ1bmN0aW9uKGQpe2Q9dm9pZCAwPT09ZD9bXTpkO3RoaXMubWFwXz1uZXcgJGpzY29tcC5NYXA7aWYoZCl7ZD0kanNjb21wLm1ha2VJdGVyYXRvcihkKTtmb3IodmFyIGU9ZC5uZXh0KCk7IWUuZG9uZTtlPWQubmV4dCgpKXRoaXMuYWRkKGUudmFsdWUpfXRoaXMuc2l6ZT10aGlzLm1hcF8uc2l6ZX07XG4kanNjb21wLlNldC5jaGVja0Jyb3dzZXJDb25mb3JtYW5jZV89ZnVuY3Rpb24oKXt2YXIgZD0kanNjb21wLmdsb2JhbC5TZXQ7aWYoIWR8fCFkLnByb3RvdHlwZS5lbnRyaWVzfHwhT2JqZWN0LnNlYWwpcmV0dXJuITE7dmFyIGU9T2JqZWN0LnNlYWwoe3g6NH0pLGQ9bmV3IGQoJGpzY29tcC5tYWtlSXRlcmF0b3IoW2VdKSk7aWYoZC5oYXMoZSl8fDEhPWQuc2l6ZXx8ZC5hZGQoZSkhPWR8fDEhPWQuc2l6ZXx8ZC5hZGQoe3g6NH0pIT1kfHwyIT1kLnNpemUpcmV0dXJuITE7dmFyIGQ9ZC5lbnRyaWVzKCksaz1kLm5leHQoKTtpZihrLmRvbmV8fGsudmFsdWVbMF0hPWV8fGsudmFsdWVbMV0hPWUpcmV0dXJuITE7az1kLm5leHQoKTtyZXR1cm4gay5kb25lfHxrLnZhbHVlWzBdPT1lfHw0IT1rLnZhbHVlWzBdLnh8fGsudmFsdWVbMV0hPWsudmFsdWVbMF0/ITE6ZC5uZXh0KCkuZG9uZX07XG4kanNjb21wLlNldC5wcm90b3R5cGUuYWRkPWZ1bmN0aW9uKGQpe3RoaXMubWFwXy5zZXQoZCxkKTt0aGlzLnNpemU9dGhpcy5tYXBfLnNpemU7cmV0dXJuIHRoaXN9OyRqc2NvbXAuU2V0LnByb3RvdHlwZVtcImRlbGV0ZVwiXT1mdW5jdGlvbihkKXtkPXRoaXMubWFwX1tcImRlbGV0ZVwiXShkKTt0aGlzLnNpemU9dGhpcy5tYXBfLnNpemU7cmV0dXJuIGR9OyRqc2NvbXAuU2V0LnByb3RvdHlwZS5jbGVhcj1mdW5jdGlvbigpe3RoaXMubWFwXy5jbGVhcigpO3RoaXMuc2l6ZT0wfTskanNjb21wLlNldC5wcm90b3R5cGUuaGFzPWZ1bmN0aW9uKGQpe3JldHVybiB0aGlzLm1hcF8uaGFzKGQpfTskanNjb21wLlNldC5wcm90b3R5cGUuZW50cmllcz1mdW5jdGlvbigpe3JldHVybiB0aGlzLm1hcF8uZW50cmllcygpfTskanNjb21wLlNldC5wcm90b3R5cGUudmFsdWVzPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubWFwXy52YWx1ZXMoKX07XG4kanNjb21wLlNldC5wcm90b3R5cGUuZm9yRWFjaD1mdW5jdGlvbihkLGUpe3ZhciBrPXRoaXM7dGhpcy5tYXBfLmZvckVhY2goZnVuY3Rpb24oYil7cmV0dXJuIGQuY2FsbChlLGIsYixrKX0pfTskanNjb21wLlNldC5BU1NVTUVfTk9fTkFUSVZFPSExOyRqc2NvbXAuU2V0JGluc3RhbGw9ZnVuY3Rpb24oKXshJGpzY29tcC5TZXQuQVNTVU1FX05PX05BVElWRSYmJGpzY29tcC5TZXQuY2hlY2tCcm93c2VyQ29uZm9ybWFuY2VfKCk/JGpzY29tcC5TZXQ9JGpzY29tcC5nbG9iYWwuU2V0OigkanNjb21wLk1hcCRpbnN0YWxsKCksJGpzY29tcC5pbml0U3ltYm9sKCksJGpzY29tcC5pbml0U3ltYm9sSXRlcmF0b3IoKSwkanNjb21wLlNldC5wcm90b3R5cGVbU3ltYm9sLml0ZXJhdG9yXT0kanNjb21wLlNldC5wcm90b3R5cGUudmFsdWVzKTskanNjb21wLlNldCRpbnN0YWxsPWZ1bmN0aW9uKCl7fX07JGpzY29tcC5zdHJpbmc9JGpzY29tcC5zdHJpbmd8fHt9O1xuJGpzY29tcC5zdHJpbmcubm9SZWdFeHBfPWZ1bmN0aW9uKGQsZSl7aWYoZCBpbnN0YW5jZW9mIFJlZ0V4cCl0aHJvdyBuZXcgVHlwZUVycm9yKFwiRmlyc3QgYXJndW1lbnQgdG8gU3RyaW5nLnByb3RvdHlwZS5cIitlK1wiIG11c3Qgbm90IGJlIGEgcmVndWxhciBleHByZXNzaW9uXCIpO307XG4kanNjb21wLnN0cmluZy5mcm9tQ29kZVBvaW50PWZ1bmN0aW9uKGQpe2Zvcih2YXIgZT1bXSxrPTA7azxhcmd1bWVudHMubGVuZ3RoOysrayllW2stMF09YXJndW1lbnRzW2tdO2Zvcih2YXIgaz1cIlwiLGU9JGpzY29tcC5tYWtlSXRlcmF0b3IoZSksYj1lLm5leHQoKTshYi5kb25lO2I9ZS5uZXh0KCkpe2I9Yi52YWx1ZTtiPStiO2lmKDA+Ynx8MTExNDExMTxifHxiIT09TWF0aC5mbG9vcihiKSl0aHJvdyBuZXcgUmFuZ2VFcnJvcihcImludmFsaWRfY29kZV9wb2ludCBcIitiKTs2NTUzNT49Yj9rKz1TdHJpbmcuZnJvbUNoYXJDb2RlKGIpOihiLT02NTUzNixrKz1TdHJpbmcuZnJvbUNoYXJDb2RlKGI+Pj4xMCYxMDIzfDU1Mjk2KSxrKz1TdHJpbmcuZnJvbUNoYXJDb2RlKGImMTAyM3w1NjMyMCkpfXJldHVybiBrfTtcbiRqc2NvbXAuc3RyaW5nLnJlcGVhdD1mdW5jdGlvbihkKXt2YXIgZT10aGlzLnRvU3RyaW5nKCk7aWYoMD5kfHwxMzQyMTc3Mjc5PGQpdGhyb3cgbmV3IFJhbmdlRXJyb3IoXCJJbnZhbGlkIGNvdW50IHZhbHVlXCIpO2R8PTA7Zm9yKHZhciBrPVwiXCI7ZDspaWYoZCYxJiYoays9ZSksZD4+Pj0xKWUrPWU7cmV0dXJuIGt9OyRqc2NvbXAuc3RyaW5nLnJlcGVhdCRpbnN0YWxsPWZ1bmN0aW9uKCl7U3RyaW5nLnByb3RvdHlwZS5yZXBlYXR8fChTdHJpbmcucHJvdG90eXBlLnJlcGVhdD0kanNjb21wLnN0cmluZy5yZXBlYXQpfTtcbiRqc2NvbXAuc3RyaW5nLmNvZGVQb2ludEF0PWZ1bmN0aW9uKGQpe3ZhciBlPXRoaXMudG9TdHJpbmcoKSxrPWUubGVuZ3RoO2Q9TnVtYmVyKGQpfHwwO2lmKDA8PWQmJmQ8ayl7ZHw9MDt2YXIgYj1lLmNoYXJDb2RlQXQoZCk7aWYoNTUyOTY+Ynx8NTYzMTk8Ynx8ZCsxPT09aylyZXR1cm4gYjtkPWUuY2hhckNvZGVBdChkKzEpO3JldHVybiA1NjMyMD5kfHw1NzM0MzxkP2I6MTAyNCooYi01NTI5NikrZCs5MjE2fX07JGpzY29tcC5zdHJpbmcuY29kZVBvaW50QXQkaW5zdGFsbD1mdW5jdGlvbigpe1N0cmluZy5wcm90b3R5cGUuY29kZVBvaW50QXR8fChTdHJpbmcucHJvdG90eXBlLmNvZGVQb2ludEF0PSRqc2NvbXAuc3RyaW5nLmNvZGVQb2ludEF0KX07XG4kanNjb21wLnN0cmluZy5pbmNsdWRlcz1mdW5jdGlvbihkLGUpe2U9dm9pZCAwPT09ZT8wOmU7JGpzY29tcC5zdHJpbmcubm9SZWdFeHBfKGQsXCJpbmNsdWRlc1wiKTtyZXR1cm4tMSE9PXRoaXMudG9TdHJpbmcoKS5pbmRleE9mKGQsZSl9OyRqc2NvbXAuc3RyaW5nLmluY2x1ZGVzJGluc3RhbGw9ZnVuY3Rpb24oKXtTdHJpbmcucHJvdG90eXBlLmluY2x1ZGVzfHwoU3RyaW5nLnByb3RvdHlwZS5pbmNsdWRlcz0kanNjb21wLnN0cmluZy5pbmNsdWRlcyl9O1xuJGpzY29tcC5zdHJpbmcuc3RhcnRzV2l0aD1mdW5jdGlvbihkLGUpe2U9dm9pZCAwPT09ZT8wOmU7JGpzY29tcC5zdHJpbmcubm9SZWdFeHBfKGQsXCJzdGFydHNXaXRoXCIpO3ZhciBrPXRoaXMudG9TdHJpbmcoKTtkKz1cIlwiO2Zvcih2YXIgYj1rLmxlbmd0aCxhPWQubGVuZ3RoLGM9TWF0aC5tYXgoMCxNYXRoLm1pbihlfDAsay5sZW5ndGgpKSxHPTA7RzxhJiZjPGI7KWlmKGtbYysrXSE9ZFtHKytdKXJldHVybiExO3JldHVybiBHPj1hfTskanNjb21wLnN0cmluZy5zdGFydHNXaXRoJGluc3RhbGw9ZnVuY3Rpb24oKXtTdHJpbmcucHJvdG90eXBlLnN0YXJ0c1dpdGh8fChTdHJpbmcucHJvdG90eXBlLnN0YXJ0c1dpdGg9JGpzY29tcC5zdHJpbmcuc3RhcnRzV2l0aCl9O1xuJGpzY29tcC5zdHJpbmcuZW5kc1dpdGg9ZnVuY3Rpb24oZCxlKXskanNjb21wLnN0cmluZy5ub1JlZ0V4cF8oZCxcImVuZHNXaXRoXCIpO3ZhciBrPXRoaXMudG9TdHJpbmcoKTtkKz1cIlwiO3ZvaWQgMD09PWUmJihlPWsubGVuZ3RoKTtmb3IodmFyIGI9TWF0aC5tYXgoMCxNYXRoLm1pbihlfDAsay5sZW5ndGgpKSxhPWQubGVuZ3RoOzA8YSYmMDxiOylpZihrWy0tYl0hPWRbLS1hXSlyZXR1cm4hMTtyZXR1cm4gMD49YX07JGpzY29tcC5zdHJpbmcuZW5kc1dpdGgkaW5zdGFsbD1mdW5jdGlvbigpe1N0cmluZy5wcm90b3R5cGUuZW5kc1dpdGh8fChTdHJpbmcucHJvdG90eXBlLmVuZHNXaXRoPSRqc2NvbXAuc3RyaW5nLmVuZHNXaXRoKX07XG4oZnVuY3Rpb24oZCxlKXtcIm9iamVjdFwiPT09dHlwZW9mIGV4cG9ydHMmJlwib2JqZWN0XCI9PT10eXBlb2YgbW9kdWxlP21vZHVsZS5leHBvcnRzPWUoKTpcImZ1bmN0aW9uXCI9PT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kP2RlZmluZShbXSxlKTpcIm9iamVjdFwiPT09dHlwZW9mIGV4cG9ydHM/ZXhwb3J0cy5DaXRyaXhXZWJSVEM9ZSgpOmQuQ2l0cml4V2ViUlRDPWUoKX0pKHNlbGYsZnVuY3Rpb24oKXtyZXR1cm4gZnVuY3Rpb24oKXtmdW5jdGlvbiBkKGIpe3ZhciBhPWtbYl07aWYodm9pZCAwIT09YSlyZXR1cm4gYS5leHBvcnRzO2E9a1tiXT17ZXhwb3J0czp7fX07ZVtiXS5jYWxsKGEuZXhwb3J0cyxhLGEuZXhwb3J0cyxkKTtyZXR1cm4gYS5leHBvcnRzfXZhciBlPXs5NDU6ZnVuY3Rpb24oYixhLGMpe3ZhciBkPXRoaXMmJnRoaXMuX19leHRlbmRzfHxmdW5jdGlvbigpe3ZhciBhPWZ1bmN0aW9uKGIsYyl7YT1PYmplY3Quc2V0UHJvdG90eXBlT2Z8fHtfX3Byb3RvX186W119aW5zdGFuY2VvZlxuQXJyYXkmJmZ1bmN0aW9uKGEsYil7YS5fX3Byb3RvX189Yn18fGZ1bmN0aW9uKGEsYil7Zm9yKHZhciBjIGluIGIpYi5oYXNPd25Qcm9wZXJ0eShjKSYmKGFbY109YltjXSl9O3JldHVybiBhKGIsYyl9O3JldHVybiBmdW5jdGlvbihiLGMpe2Z1bmN0aW9uIGQoKXt0aGlzLmNvbnN0cnVjdG9yPWJ9YShiLGMpO2IucHJvdG90eXBlPW51bGw9PT1jP09iamVjdC5jcmVhdGUoYyk6KGQucHJvdG90eXBlPWMucHJvdG90eXBlLG5ldyBkKX19KCk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGEsXCJfX2VzTW9kdWxlXCIse3ZhbHVlOiEwfSk7dmFyIHY9Yyg2NTgpLHI9Yyg1NTApLG49Yyg4NTEpLGc9Yyg5NDYpO2I9ZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYigpe3ZhciBjPWEuY2FsbCh0aGlzLG51bGwsci5jbGFzc19pZF90LkF1ZGlvRWxlbWVudCwwLHYuUHJveHlNb2RlLkxvY2FsKXx8dGhpcztjLnNpbmtJZF89XCJcIjtjLnNyY09iamVjdF89bnVsbDtyZXR1cm4gY31kKGIsYSk7Yi5wcm90b3R5cGUuc2V0U2lua0lkPVxuZnVuY3Rpb24oYSl7dmFyIGI9dGhpcztuLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc2V0U2lua0lkOiBzZXQgc2lua0lkIHRvIFwiK2EpO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihjLGQpe2Iud2FpdFVudGlsQ29ubmVjdGVkKFwiQXVkaW9FbGVtZW50LnNpbmtJZFwiKS50aGVuKGZ1bmN0aW9uKCl7dmFyIGQ9Yi5yZW1vdGVJbnZva2UoITAsci5tZXRob2RfaWRfQXVkaW9FbGVtZW50X3Quc2lua0lkLGEpO2cuZ2V0UmVkaXJlY3RvcigpLmdldEZlYXR1cmVWYWx1ZShyLkZFQVRVUkVfbXNfdGVhbXNfcHN0bil8fChiLnNpbmtJZF89YSxjKCkpO3JldHVybiBkfSkudGhlbihmdW5jdGlvbigpe24ubG9nZ2VyLmxvZyhiLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRTaW5rSWQ6IHN1Y2Nlc3MhIHJlc29sdmluZy4uLlwiKTtiLnNpbmtJZF89YTtjKCl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2E9Yi5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFwiLnNpbmtJZCBzZXR0ZXI6IGZhaWxlZCB0byBjb25uZWN0IVwiKTtcbmQoYSl9KX0pfTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYi5wcm90b3R5cGUsXCJzaW5rSWRcIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuc2lua0lkX30sc2V0OmZ1bmN0aW9uKGEpe3RoaXMuc2V0U2lua0lkKGEpfSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcInNyY09iamVjdFwiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zcmNPYmplY3RffSxzZXQ6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcztuLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc3JjT2JqZWN0OiBzZXQgc3JjT2JqZWN0IHRvIFwiK0pTT04uc3RyaW5naWZ5KGEpKTtpZihhIT09dGhpcy5zcmNPYmplY3RfKXt0aGlzLnNyY09iamVjdF89YTt2YXIgYz1udWxsIT09YSYmdm9pZCAwIT09YT9hLmlkOlwibnVsbFwiO3RoaXMud2FpdFVudGlsQ29ubmVjdGVkKFwiQXVkaW9FbGVtZW50LnNyY09iamVjdFwiKS50aGVuKGZ1bmN0aW9uKCl7cmV0dXJuIGIucmVtb3RlSW52b2tlKCEwLFxuci5tZXRob2RfaWRfQXVkaW9FbGVtZW50X3Quc3JjT2JqZWN0LGMpfSkudGhlbihmdW5jdGlvbigpe24ubG9nZ2VyLmxvZyhiLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zcmNPYmplY3Qgc2V0dGVyOiByZW1vdGUgc3VjY2VzcyFcIil9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2IubG9nUmVtb3RlSW52b2tlRXJyb3IoYSxcIi5zcmNPYmplY3Qgc2V0dGVyOiBmYWlsZWQgdG8gY29ubmVjdCFcIil9KX19LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwic3JjXCIse2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnNyY199LHNldDpmdW5jdGlvbihhKXt2YXIgYj10aGlzO24ubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zcmM6IHNldCBzcmMgdG8gXCIrYSk7dGhpcy5zcmNfPWE7dGhpcy53YWl0VW50aWxDb25uZWN0ZWQoXCJBdWRpb0VsZW1lbnQuc3JjXCIpLnRoZW4oZnVuY3Rpb24oKXtiLnJlbW90ZUludm9rZSghMCxcbnIubWV0aG9kX2lkX0F1ZGlvRWxlbWVudF90LnNyYyxhKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYSl7Yi5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFwiLnNyYyBzZXR0ZXI6IGZhaWxlZCB0byBjb25uZWN0IVwiKX0pfSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO2IucHJvdG90eXBlLnBsYXk9ZnVuY3Rpb24oKXt2YXIgYT10aGlzO24ubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5wbGF5KCkgY2FsbGVkLlwiKTtyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24oYixjKXthLnRvZ2dsZUF1ZGlvKCEwKTthLndhaXRVbnRpbENvbm5lY3RlZChcIkF1ZGlvRWxlbWVudC5wbGF5XCIpLnRoZW4oZnVuY3Rpb24oKXthLnJlbW90ZUludm9rZSghMSxyLm1ldGhvZF9pZF9BdWRpb0VsZW1lbnRfdC5wbGF5LFtdKS50aGVuKGZ1bmN0aW9uKCl7YigpfSlbXCJjYXRjaFwiXShmdW5jdGlvbihiKXthLmxvZ1JlbW90ZUludm9rZUVycm9yKGIsXCIucGxheTogZmFpbGVkIHRvIHJlbW90ZSFcIik7XG5jKCl9KX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYil7YS5sb2dSZW1vdGVJbnZva2VFcnJvcihiLFwiLnBsYXk6IGZhaWxlZCB0byBjb25uZWN0IVwiKTtjKCl9KX0pfTtiLnByb3RvdHlwZS5wYXVzZT1mdW5jdGlvbigpe3ZhciBhPXRoaXM7bi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLnBhdXNlKCkgY2FsbGVkLlwiKTtyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24oYixjKXthLnRvZ2dsZUF1ZGlvKCExKTthLndhaXRVbnRpbENvbm5lY3RlZChcIkF1ZGlvRWxlbWVudC5wYXVzZVwiKS50aGVuKGZ1bmN0aW9uKCl7YS5yZW1vdGVJbnZva2UoITEsci5tZXRob2RfaWRfQXVkaW9FbGVtZW50X3QucGF1c2UsW10pLnRoZW4oZnVuY3Rpb24oKXtiKCl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGIpe2EubG9nUmVtb3RlSW52b2tlRXJyb3IoYixcIi5wYXVzZTogZmFpbGVkIHRvIHJlbW90ZSFcIik7YygpfSl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGIpe2EubG9nUmVtb3RlSW52b2tlRXJyb3IoYixcblwiLnBhdXNlOiBmYWlsZWQgdG8gY29ubmVjdCFcIik7YygpfSl9KX07Yi5wcm90b3R5cGUudG9nZ2xlQXVkaW89ZnVuY3Rpb24oYSl7dGhpcy5zcmNPYmplY3RfJiYobi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLnRvZ2dsZUF1ZGlvKCkgdG9nZ2xlIGF1ZGlvIHRyYWNrczpcIithKSx0aGlzLnNyY09iamVjdF8udG9nZ2xlQXVkaW8oYSkpfTtiLnByb3RvdHlwZS5kaXNwb3NlPWZ1bmN0aW9uKCl7bi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmRpc3Bvc2UoKVwiKTt0aGlzLnNyY189dGhpcy5zaW5rSWRfPVwiXCI7dGhpcy5zcmNPYmplY3RfPW51bGw7dGhpcy5yZWxlYXNlKCl9O3JldHVybiBifSh2LlByb3h5T2JqZWN0KTthLkF1ZGlvRWxlbWVudD1ifSw5OmZ1bmN0aW9uKGIsYSxjKXt2YXIgZD10aGlzJiZ0aGlzLl9fZXh0ZW5kc3x8ZnVuY3Rpb24oKXt2YXIgYT1mdW5jdGlvbihiLGMpe2E9T2JqZWN0LnNldFByb3RvdHlwZU9mfHx7X19wcm90b19fOltdfWluc3RhbmNlb2ZcbkFycmF5JiZmdW5jdGlvbihhLGIpe2EuX19wcm90b19fPWJ9fHxmdW5jdGlvbihhLGIpe2Zvcih2YXIgYyBpbiBiKWIuaGFzT3duUHJvcGVydHkoYykmJihhW2NdPWJbY10pfTtyZXR1cm4gYShiLGMpfTtyZXR1cm4gZnVuY3Rpb24oYixjKXtmdW5jdGlvbiBkKCl7dGhpcy5jb25zdHJ1Y3Rvcj1ifWEoYixjKTtiLnByb3RvdHlwZT1udWxsPT09Yz9PYmplY3QuY3JlYXRlKGMpOihkLnByb3RvdHlwZT1jLnByb3RvdHlwZSxuZXcgZCl9fSgpO09iamVjdC5kZWZpbmVQcm9wZXJ0eShhLFwiX19lc01vZHVsZVwiLHt2YWx1ZTohMH0pO3ZhciB2PWMoNTUwKSxyPWMoOTQ2KSxuPWMoNjU4KSxnPWMoODUxKTsoZnVuY3Rpb24oYSl7YVthLldlYnJwYz0wXT1cIldlYnJwY1wiO2FbYS5XZWJydGNDb2RlY3M9MV09XCJXZWJydGNDb2RlY3NcIjthW2EuUmVjZWl2ZXI9Ml09XCJSZWNlaXZlclwiO2FbYS5WZGE9M109XCJWZGFcIjthW2EuRW5kcG9pbnQ9NF09XCJFbmRwb2ludFwiO2FbYS5UeXBlU2NyaXB0PTVdPVwiVHlwZVNjcmlwdFwiO1xuYVthLk1heD02XT1cIk1heFwifSkoYS5WZXJzaW9uVHlwZXx8KGEuVmVyc2lvblR5cGU9e30pKTtiPWZ1bmN0aW9uKGEpe2Z1bmN0aW9uIGIoKXtyZXR1cm4gYS5jYWxsKHRoaXMsbnVsbCx2LmNsYXNzX2lkX3QuRW5naW5lQ29udHJvbCwwLG4uUHJveHlNb2RlLkxvY2FsKXx8dGhpc31kKGIsYSk7Yi5wcm90b3R5cGUuYmluZD1mdW5jdGlvbigpe2cubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5iaW5kKCkgY2FsbGVkLlwiKTt0aGlzLnJlY29uc3RydWN0b3IobnVsbCx2LmNsYXNzX2lkX3QuRW5naW5lQ29udHJvbCwwKX07Yi5wcm90b3R5cGUuc3luY0JhcnJpZXI9ZnVuY3Rpb24oKXt2YXIgYT10aGlzO2cubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zeW5jQmFycmllcigpIGNhbGxlZC5cIik7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGIsYyl7YS53YWl0VW50aWxDb25uZWN0ZWQoXCJFbmdpbmVDb250cm9sLnN5bmNCYXJyaWVyXCIpLnRoZW4oZnVuY3Rpb24oKXtyZXR1cm4gUHJvbWlzZS5hbGwoW2EucmVtb3RlSW52b2tlKCExLFxudi5tZXRob2RfaWRfRW5naW5lQ29udHJvbF90LnZlcnNpb24se21ham9yOjAsbWlub3I6MCxyZXZpc2lvbjowLGJ1aWxkOjB9KSxhLnJlbW90ZUludm9rZSghMSx2Lm1ldGhvZF9pZF9FbmdpbmVDb250cm9sX3QuZmVhdHVyZV9mbGFncyxbXSldKX0pLnRoZW4oZnVuY3Rpb24oYil7Zy5sb2dnZXIubG9nKGEudXNlcl9mcmllbmRseV9pZCgpK1wicmVjZWl2ZWQgd2VicnBjIHZlcnNpb24gYW5kIHN1cHBvcnRlZCBmZWF0dXJlIGxpc3QuXCIpO2I9Yi5tYXAoZnVuY3Rpb24oYil7cmV0dXJuIGEucGFyYW0wKGIpfSk7YS52ZXJzaW9uXz1iWzBdO2EuZmVhdHVyZXNfPWJbMV07ci5nZXRSZWRpcmVjdG9yKCkuc2V0RmVhdHVyZXMoYS5mZWF0dXJlc18pO2I9W107Zm9yKHZhciBjPTAsdD1hLmZlYXR1cmVzXztjPHQubGVuZ3RoO2MrKyl7dmFyIGg9dFtjXTtcIm1zX3RlYW1zX2Rlc2t0b3Bfc2hhcmluZ1wiPT09aC5uYW1lJiZoLnZhbHVlP2IucHVzaChhLnJlbW90ZUludm9rZSghMSx2Lm1ldGhvZF9pZF9FbmdpbmVDb250cm9sX3QudmVyc2lvbl9pbmZvLFxuW10pKTpcIm1zX3RlYW1zX29zaW5mb1wiPT09aC5uYW1lJiZoLnZhbHVlP2IucHVzaChhLnJlbW90ZUludm9rZSghMSx2Lm1ldGhvZF9pZF9FbmdpbmVDb250cm9sX3Qub3NpbmZvLHtmYW1pbHk6XCJcIix2ZXJzaW9uOlwiXCIsYXJjaGl0ZWN0dXJlOlwiXCIsZGlzdHJvOlwiXCIsZWRpdGlvbjpcIlwifSkpOlwibXNfdGVhbXNfZW5kcG9pbnRfaWRcIj09PWgubmFtZSYmaC52YWx1ZSYmYi5wdXNoKGEucmVtb3RlSW52b2tlKCExLHYubWV0aG9kX2lkX0VuZ2luZUNvbnRyb2xfdC5lbmRwb2ludF9pZCx7bWFjaGluZV9pZDpcIlwiLHVzZXJfaWQ6XCJcIn0pKX1pZigwPGIubGVuZ3RoKXJldHVybiBQcm9taXNlLmFsbChiKX0pLnRoZW4oZnVuY3Rpb24oYyl7aWYodm9pZCAwPT09YylnLmxvZ2dlci5sb2coYS51c2VyX2ZyaWVuZGx5X2lkKCkrXCJyZWxlYXNlLTE5MDUgY2xpZW50LlwiKTtlbHNle2cubG9nZ2VyLmxvZyhhLnVzZXJfZnJpZW5kbHlfaWQoKStcInJlbGVhc2UtMTkwNiBvciBsYXRlciBjbGllbnQ6IHJlY2VpdmVkIGRldGFpbGVkIGNsaWVudCB2ZXJzaW9uIGxpc3QuXCIpO1xuZm9yKHZhciBkPTA7ZDxjLmxlbmd0aDtkKyspe3ZhciB0PWNbZF07dC5oZHIucHJvYy5paWQ9PXYuY2xhc3NfaWRfdC5FbmdpbmVDb250cm9sJiZ0Lmhkci5wcm9jLm1ldGhvZGlkPT12Lm1ldGhvZF9pZF9FbmdpbmVDb250cm9sX3QudmVyc2lvbl9pbmZvP2EudmVyc2lvbnNfPWEucGFyYW0wKHQpOnQuaGRyLnByb2MuaWlkPT12LmNsYXNzX2lkX3QuRW5naW5lQ29udHJvbCYmdC5oZHIucHJvYy5tZXRob2RpZD09di5tZXRob2RfaWRfRW5naW5lQ29udHJvbF90Lm9zaW5mbz9hLm9zaW5mb189YS5wYXJhbTAodCk6dC5oZHIucHJvYy5paWQ9PXYuY2xhc3NfaWRfdC5FbmdpbmVDb250cm9sJiZ0Lmhkci5wcm9jLm1ldGhvZGlkPT12Lm1ldGhvZF9pZF9FbmdpbmVDb250cm9sX3QuZW5kcG9pbnRfaWQmJihhLmVuZHBvaW50aWRfPWEucGFyYW0wKHQpKX19YihhKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYil7Yj1hLmxvZ1JlbW90ZUludm9rZUVycm9yKGIsXCJmYWlsdXJlIHRvIHJldHJpZXZlIHZlcnNpb24vZmVhdHVyZSByZWxhdGVkIGNsaWVudCBpbmZvLlwiKTtcbmMoYil9KX0pfTtyZXR1cm4gYn0obi5Qcm94eU9iamVjdCk7YS5FbmdpbmVDb250cm9sPWJ9LDM2ODpmdW5jdGlvbihiLGEsYyl7T2JqZWN0LmRlZmluZVByb3BlcnR5KGEsXCJfX2VzTW9kdWxlXCIse3ZhbHVlOiEwfSk7dmFyIGQ9Yyg4NTEpLHY9Yyg5NDYpO2I9ZnVuY3Rpb24oKXtmdW5jdGlvbiBhKCl7dmFyIGI9dGhpczt0aGlzLnJ1bm5pbmdfPSExO3RoaXMuZWxlbWVudHNfPVtdO3RoaXMuY2xpcFJlY3RzPW5ldyBTZXQ7dGhpcy53aGVlbEV2ZW50SGFuZGxlcj1mdW5jdGlvbihhKXtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Yi51cGRhdGVBbGwoKX0sMTApfTt0aGlzLmtleXVwRXZlbnRIYW5kbGVyPWZ1bmN0aW9uKGEpe1wiVGFiXCIhPWEuY29kZSYmXCJBcnJvd1VwXCIhPWEuY29kZSYmXCJBcnJvd0Rvd25cIiE9YS5jb2RlJiZcIkFycm93TGVmdFwiIT1hLmNvZGUmJlwiQXJyb3dSaWdodFwiIT1hLmNvZGUmJlwiUGFnZVVwXCIhPWEuY29kZSYmXCJQYWdlRG93blwiIT1hLmNvZGUmJlwiSG9tZVwiIT1hLmNvZGUmJlxuXCJFbmRcIiE9YS5jb2RlfHxiLnVwZGF0ZUFsbCgpfTthLnNlbmRPdmVybGF5SW5mbygpO3RoaXMub2JzZXJ2ZXJfPW5ldyBNdXRhdGlvbk9ic2VydmVyKGZ1bmN0aW9uKGEpe2IudXBkYXRlQWxsKCl9KX1hLnNlbmRPdmVybGF5SW5mbz1mdW5jdGlvbigpe3ZhciBhPXdpbmRvdy5nZXRXaW5kb3dIYW5kbGVBc0hleDtpZih2b2lkIDA9PT1hfHxudWxsPT09YSlkLmxvZ2dlci5sb2coXCJGcmFtZVRyYWNrZXIuc2VuZE92ZXJsYXlJbmZvOiBnZXRXaW5kb3dIYW5kbGUgbWV0aG9kIGlzIHVuZGVmaW5lZCBvciBudWxsXCIpO2Vsc2V7dmFyIGI9di5nZXRSZWRpcmVjdG9yKCk7UHJvbWlzZS5hbGwoW2EoKSxiLnN0YXJ0UmVkaXJlY3Rpb24oITEsXCJzZW5kT3ZlcmxheUluZm9cIildKS50aGVuKGZ1bmN0aW9uKGEpe2QubG9nZ2VyLmxvZyhcIkZyYW1lVHJhY2tlci5zZW5kT3ZlcmxheUluZm86IHNldCB3aW5kb3cgaGFuZGxlOiBcIithWzBdKTtiLldTU2VuZE9iamVjdCh7djpcIm92ZXJsYXlcIixjb21tYW5kOlwid2luZG93XCIsXG53aW5kb3dIYW5kbGU6YVswXX0pfSl9fTthLnByb3RvdHlwZS5yZWN0YW5nbGVzSW50ZXJzZWN0PWZ1bmN0aW9uKGEsYil7cmV0dXJuIGEueDxiLngrYi53aWR0aCYmYS54K2Eud2lkdGg+Yi54JiZhLnk8Yi55K2IuaGVpZ2h0JiZhLnkrYS5oZWlnaHQ+Yi55PyEwOiExfTthLnByb3RvdHlwZS5pbnRlcnNlY3RpbmdSZWN0PWZ1bmN0aW9uKGEsYil7dmFyIGM9TWF0aC5tYXgoYS5sZWZ0LGIubGVmdCksZD1NYXRoLm1heChhLnRvcCxiLnRvcCk7cmV0dXJuIG5ldyBET01SZWN0KGMsZCxNYXRoLm1pbihhLnJpZ2h0LGIucmlnaHQpLWMsTWF0aC5taW4oYS5ib3R0b20sYi5ib3R0b20pLWQpfTthLnByb3RvdHlwZS5wZWRpZ3JlZUNvdW50PWZ1bmN0aW9uKGEsYil7Zm9yKHZhciBjPTAsZD1hLnBhcmVudEVsZW1lbnQ7bnVsbCE9ZCYmZCE9YjspYysrLGQ9ZC5wYXJlbnRFbGVtZW50O3JldHVybntpc0FuY2VzdG9yOm51bGwhPWQscGVkaWdyZWU6Y319O2EucHJvdG90eXBlLnNlbGVjdFRvcG1vc3Q9XG5mdW5jdGlvbihhLGIpe3ZhciBjPWEuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksZD1iLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLGM9dGhpcy5pbnRlcnNlY3RpbmdSZWN0KGMsZCksZD1kb2N1bWVudC5lbGVtZW50RnJvbVBvaW50KGMubGVmdCtjLndpZHRoLzIsYy50b3ArYy5oZWlnaHQvMik7aWYoZD09YSlyZXR1cm4gYTtpZihkPT1iKXJldHVybiBiO2M9dGhpcy5wZWRpZ3JlZUNvdW50KGEsZCk7ZD10aGlzLnBlZGlncmVlQ291bnQoYixkKTtpZihjLmlzQW5jZXN0b3ImJmQuaXNBbmNlc3Rvcil7aWYoYy5wZWRpZ3JlZTxkLnBlZGlncmVlKXJldHVybiBhO2lmKGQucGVkaWdyZWU8Yy5wZWRpZ3JlZSlyZXR1cm4gYn1lbHNle2lmKGMuaXNBbmNlc3RvcilyZXR1cm4gYTtpZihkLmlzQW5jZXN0b3IpcmV0dXJuIGJ9fTthLnByb3RvdHlwZS5jaGVja092ZXJsYXBwaW5nVmlkZW9zPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMsYz1hLnRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbmEub3ZlcmxhcHMuZm9yRWFjaChmdW5jdGlvbihiKXthLnRhcmdldC5yZW1vdGVWaWRlb0VsZW1lbnQucmVtb3ZlQ2xpcFJlY3QoYi5yZWN0KX0pO2Eub3ZlcmxhcHM9W107dGhpcy5lbGVtZW50c18uZm9yRWFjaChmdW5jdGlvbihkKXtpZihkIT1hKXt2YXIgcj1kLm92ZXJsYXBzLm1hcChmdW5jdGlvbihhKXtyZXR1cm4gYS5lbGVtZW50fSkuaW5kZXhPZihhLnRhcmdldCk7LTEhPXImJihyPWQub3ZlcmxhcHMuc3BsaWNlKHIsMSlbMF0sZC50YXJnZXQucmVtb3RlVmlkZW9FbGVtZW50LnJlbW92ZUNsaXBSZWN0KHIucmVjdCkpO3I9ZC50YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7aWYoYi5yZWN0YW5nbGVzSW50ZXJzZWN0KGMscikpe3ZhciB4PWIuc2VsZWN0VG9wbW9zdChhLnRhcmdldCxkLnRhcmdldCk7eD09YS50YXJnZXQ/KGQub3ZlcmxhcHMucHVzaCh7ZWxlbWVudDphLnRhcmdldCxyZWN0OmN9KSxkLnRhcmdldC5yZW1vdGVWaWRlb0VsZW1lbnQuYWRkQ2xpcFJlY3QoYykpOlxueD09ZC50YXJnZXQmJihhLm92ZXJsYXBzLnB1c2goe2VsZW1lbnQ6ZC50YXJnZXQscmVjdDpyfSksYS50YXJnZXQucmVtb3RlVmlkZW9FbGVtZW50LmFkZENsaXBSZWN0KHIpKX19fSl9O2EucHJvdG90eXBlLnVwZGF0ZUFsbD1mdW5jdGlvbigpe3ZhciBhPXRoaXM7dGhpcy5lbGVtZW50c18uZm9yRWFjaChmdW5jdGlvbihiKXt2YXIgYz1iLnRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtpZih2b2lkIDAhPT1jKXt2YXIgZD1iLmNsaWVudFJlY3Q7aWYodm9pZCAwPT09ZHx8ZC54IT09Yy54fHxkLnkhPT1jLnl8fGQud2lkdGghPT1jLndpZHRofHxkLmhlaWdodCE9PWMuaGVpZ2h0KWIuY2xpZW50UmVjdD1jLGIuY2FsbGJhY2soYyksYS5jaGVja092ZXJsYXBwaW5nVmlkZW9zKGIpfX0pfTthLnByb3RvdHlwZS50cmFjaz1mdW5jdGlvbihhLGIpe3ZhciBjPXRoaXMsZj1hLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO2QubG9nZ2VyLmxvZyhcIlRyYWNrIGVsZW1lbnQgZnJhbWVcIixcbmEsSlNPTi5zdHJpbmdpZnkoZikpO2NvbnNvbGUubG9nKGEpO3RoaXMuZWxlbWVudHNfLnB1c2goe3RhcmdldDphLGNsaWVudFJlY3Q6dm9pZCAwLGNhbGxiYWNrOmIsb3ZlcmxhcHM6W119KTt0cnl7ZC5sb2dnZXIubG9nKFwiW0hkeFdlYlJUQy5qc10gSW5pdGlhbGl6aW5nIG9jY2x1c2lvbiBmb3IgbmV3IHZpZGVvRWxlbWVudFwiKSx0aGlzLmNsaXBSZWN0cy5mb3JFYWNoKGZ1bmN0aW9uKGIpe2MuYXBwbHlPY2NsdXNpb24oYSxKU09OLnBhcnNlKGIpKX0pfWNhdGNoKHIpe2QubG9nZ2VyLmxvZyhcIltIZHhXZWJSVEMuanNdIGFkZE9jY2x1c2lvbkluaXQgZmFpbGVkISBcIityKX10aGlzLnJ1bm5pbmdffHwoZC5sb2dnZXIubG9nKFwiU3RhcnQgRnJhbWVUcmFja2VyIG9ic2VydmVyLi4uXCIpLHRoaXMub2JzZXJ2ZXJfLm9ic2VydmUoZG9jdW1lbnQuYm9keSx7YXR0cmlidXRlczohMCxjaGlsZExpc3Q6ITAsc3VidHJlZTohMH0pLHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwid2hlZWxcIix0aGlzLndoZWVsRXZlbnRIYW5kbGVyKSxcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIix0aGlzLmtleXVwRXZlbnRIYW5kbGVyKSx0aGlzLnJ1bm5pbmdfPSEwKTt0aGlzLnVwZGF0ZUFsbCgpfTthLnByb3RvdHlwZS51bnRyYWNrPWZ1bmN0aW9uKGEpe2QubG9nZ2VyLmxvZyhcIlVudHJhY2sgZWxlbWVudCBmcmFtZVwiLGEpO3ZhciBiPS0xO3RoaXMuZWxlbWVudHNfLmZvckVhY2goZnVuY3Rpb24oYyxkKXtjLnRhcmdldD09PWEmJihiPWQpfSk7MDw9YiYmKHRoaXMuZWxlbWVudHNfLnNwbGljZShiLDEpLDA9PT10aGlzLmVsZW1lbnRzXy5sZW5ndGgmJihkLmxvZ2dlci5sb2coXCJTdG9wIEZyYW1lVHJhY2tlciBvYnNlcnZlci4uLlwiKSx0aGlzLm9ic2VydmVyXy5kaXNjb25uZWN0KCksd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ3aGVlbFwiLHRoaXMud2hlZWxFdmVudEhhbmRsZXIpLHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5dXBcIix0aGlzLmtleXVwRXZlbnRIYW5kbGVyKSx0aGlzLnJ1bm5pbmdfPSExKSl9O1xuYS5wcm90b3R5cGUuYXBwbHlPY2NsdXNpb249ZnVuY3Rpb24oYSxiKXt2YXIgYz1hLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO3RoaXMucmVjdGFuZ2xlc0ludGVyc2VjdChiLGMpJiZ2b2lkIDAhPT1hLnJlbW90ZVZpZGVvRWxlbWVudCYmYS5yZW1vdGVWaWRlb0VsZW1lbnQuYWRkQ2xpcFJlY3QoYil9O2EucHJvdG90eXBlLmFkZE9jY2x1c2lvbj1mdW5jdGlvbihhKXt2YXIgYj10aGlzO2QubG9nZ2VyLmxvZyhcIltIZHhXZWJSVEMuanNdIEFkZGluZyBvY2NsdXNpb24gXCIrSlNPTi5zdHJpbmdpZnkoYSkpO2QubG9nZ2VyLmxvZyhcIltIZHhXZWJSVEMuanNdIFRyYWNraW5nICdcIit0aGlzLmVsZW1lbnRzXy5sZW5ndGgrXCInIGVsZW1lbnRzLlwiKTt0aGlzLmNsaXBSZWN0cy5hZGQoSlNPTi5zdHJpbmdpZnkoYSkpO3RoaXMuZWxlbWVudHNfLmZvckVhY2goZnVuY3Rpb24oYyl7Yi5hcHBseU9jY2x1c2lvbihjLnRhcmdldCxhKX0pfTthLnByb3RvdHlwZS5yZW1vdmVPY2NsdXNpb249ZnVuY3Rpb24oYSl7ZC5sb2dnZXIubG9nKFwiW0hkeFdlYlJUQy5qc10gUmVtb3Zpbmcgb2NjbHVzaW9uIFwiK1xuSlNPTi5zdHJpbmdpZnkoYSkpO2QubG9nZ2VyLmxvZyhcIltIZHhXZWJSVEMuanNdIFRyYWNraW5nICdcIit0aGlzLmVsZW1lbnRzXy5sZW5ndGgrXCInIGVsZW1lbnRzLlwiKTt0aGlzLmNsaXBSZWN0c1tcImRlbGV0ZVwiXShKU09OLnN0cmluZ2lmeShhKSk7dGhpcy5lbGVtZW50c18uZm9yRWFjaChmdW5jdGlvbihiKXt2b2lkIDAhPT1iLnRhcmdldC5yZW1vdGVWaWRlb0VsZW1lbnQmJmIudGFyZ2V0LnJlbW90ZVZpZGVvRWxlbWVudC5yZW1vdmVDbGlwUmVjdChhKX0pfTtyZXR1cm4gYX0oKTthLkZyYW1lVHJhY2tlcj1ifSwyNDc6ZnVuY3Rpb24oYixhKXtPYmplY3QuZGVmaW5lUHJvcGVydHkoYSxcIl9fZXNNb2R1bGVcIix7dmFsdWU6ITB9KTt2YXIgYz1mdW5jdGlvbigpe2Z1bmN0aW9uIGEoYil7dGhpcy5wYXJlbnRfPXRoaXMub2JqZWN0Xz1udWxsO3RoaXMuY2hpbGRyZW5fPVtdO3RoaXMub2JqZWN0Xz1ifWEucHJvdG90eXBlLmFkZENoaWxkPWZ1bmN0aW9uKGEpe2EucGFyZW50XyE9dGhpcyYmXG4oYS5wYXJlbnRfPXRoaXMsdGhpcy5jaGlsZHJlbl8ucHVzaChhKSl9O2EucHJvdG90eXBlLnJlbW92ZUNoaWxkPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuY2hpbGRyZW5fLmluZGV4T2YoYSk7dGhpcy5jaGlsZHJlbl8uc3BsaWNlKGIsMSk7YS5wYXJlbnRfPW51bGx9O3JldHVybiBhfSgpLGQ9ZnVuY3Rpb24oKXtmdW5jdGlvbiBhKCl7dGhpcy5yb290Xz1uZXcgYyhudWxsKX1hLnByb3RvdHlwZS50cmFja09iamVjdD1mdW5jdGlvbihhLGIpe3ZvaWQgMD09PWImJihiPW51bGwpO2lmKG51bGw9PT10aGlzLmZpbmROb2RlKGEsdGhpcy5yb290Xykpe3ZhciBkPXRoaXMuZmluZE5vZGUoYix0aGlzLnJvb3RfKSxwPW5ldyBjKGEpO2Q/ZC5hZGRDaGlsZChwKTp0aGlzLnJvb3RfLmFkZENoaWxkKHApfX07YS5wcm90b3R5cGUucmVsZWFzZU9iamVjdD1mdW5jdGlvbihhKXthPXRoaXMuZmluZE5vZGUoYSx0aGlzLnJvb3RfKTtpZihudWxsPT09YXx8YT09PXRoaXMucm9vdF8pcmV0dXJuITE7XG50aGlzLmRlc3Ryb3lOb2RlT2JqZWN0UmVjdXJzZShhKTthLnBhcmVudF8ucmVtb3ZlQ2hpbGQoYSk7cmV0dXJuITB9O2EucHJvdG90eXBlLmRlc3Ryb3lOb2RlT2JqZWN0UmVjdXJzZT1mdW5jdGlvbihhKXtmb3IodmFyIGI9MCxjPWEuY2hpbGRyZW5fO2I8Yy5sZW5ndGg7YisrKXRoaXMuZGVzdHJveU5vZGVPYmplY3RSZWN1cnNlKGNbYl0pO2Eub2JqZWN0Xy5kZXN0cm95KCl9O2EucHJvdG90eXBlLnNldFBhcmVudD1mdW5jdGlvbihhLGIpe3ZhciBjPXRoaXMuZmluZE5vZGUoYSx0aGlzLnJvb3RfKTtpZihudWxsPT09YylyZXR1cm4hMTt2YXIgZD10aGlzLmZpbmROb2RlKGIsdGhpcy5yb290Xyk7aWYobnVsbD09PWQpcmV0dXJuITE7aWYoYy5wYXJlbnRfPT09ZClyZXR1cm4hMDtjLnBhcmVudF8ucmVtb3ZlQ2hpbGQoYyk7ZC5hZGRDaGlsZChjKTtyZXR1cm4hMH07YS5wcm90b3R5cGUucmVzZXQ9ZnVuY3Rpb24oKXt0aGlzLnJvb3RfLmNoaWxkcmVuXz1bXX07YS5wcm90b3R5cGUuZmluZE5vZGU9XG5mdW5jdGlvbihhLGIpe2lmKGIub2JqZWN0Xz09PWEpcmV0dXJuIGI7Zm9yKHZhciBjPW51bGwsZD0wLGY9Yi5jaGlsZHJlbl87ZDxmLmxlbmd0aCYmKGM9dGhpcy5maW5kTm9kZShhLGZbZF0pLG51bGw9PT1jKTtkKyspO3JldHVybiBjfTtyZXR1cm4gYX0oKTthLkdDPWQ7YS5nYz1uZXcgZH0sOTQ2OmZ1bmN0aW9uKGIsYSxjKXtPYmplY3QuZGVmaW5lUHJvcGVydHkoYSxcIl9fZXNNb2R1bGVcIix7dmFsdWU6ITB9KTt2YXIgZD1jKDY1OCksdj1jKDg1MSkscj1jKDU1MCksbj1jKDU0NSksZz1jKDM5NCkscD1jKDUwOSksZj1mdW5jdGlvbigpe3JldHVybiBmdW5jdGlvbihhLGIsYyxkLG0sZixnKXt0aGlzLnJlc29sdmU9YTt0aGlzLnJlamVjdD1iO3RoaXMuaWlkPWM7dGhpcy5vaWQ9ZDt0aGlzLmNiaWQ9bTt0aGlzLm9uZVNob3Q9Zjt0aGlzLm1pZD1nfX0oKSxlOyhmdW5jdGlvbihhKXthW2EucnBjX3N0YXR1c19zdWNjZXNzPTBdPVwicnBjX3N0YXR1c19zdWNjZXNzXCI7YVthLnJwY19zdGF0dXNfdW5zcGVjaWZpZWRfZXJyb3I9XG4xXT1cInJwY19zdGF0dXNfdW5zcGVjaWZpZWRfZXJyb3JcIjthW2EucnBjX3N0YXR1c191bmV4cGVjdGVkPTJdPVwicnBjX3N0YXR1c191bmV4cGVjdGVkXCI7YVthLnJwY19zdGF0dXNfaW5kZXhfb3V0X29mX2JvdW5kcz0zXT1cInJwY19zdGF0dXNfaW5kZXhfb3V0X29mX2JvdW5kc1wiO2FbYS5ycGNfc3RhdHVzX21pc3NpbmdfcGFyYW1ldGVyPTRdPVwicnBjX3N0YXR1c19taXNzaW5nX3BhcmFtZXRlclwiO2FbYS5ycGNfc3RhdHVzX21pc3NpbmdfcmV0dXJuX3ZhbHVlPTVdPVwicnBjX3N0YXR1c19taXNzaW5nX3JldHVybl92YWx1ZVwiO2FbYS5ycGNfc3RhdHVzX2ludmFsaWRfb2JqZWN0PTZdPVwicnBjX3N0YXR1c19pbnZhbGlkX29iamVjdFwiO2FbYS5ycGNfc3RhdHVzX3VzZXJfZXhjZXB0aW9uPTddPVwicnBjX3N0YXR1c191c2VyX2V4Y2VwdGlvblwiO2FbYS5ycGNfc3RhdHVzX3N5c3RlbV9lcnJvcj04XT1cInJwY19zdGF0dXNfc3lzdGVtX2Vycm9yXCJ9KShlPWEuV2VicnBjU3RhdHVzQ29kZXx8XG4oYS5XZWJycGNTdGF0dXNDb2RlPXt9KSk7dmFyIHg7KGZ1bmN0aW9uKGEpe2FbYS5Ob3RSZWRpcmVjdGVkPTBdPVwiTm90UmVkaXJlY3RlZFwiO2FbYS5Db25uZWN0aW5nPTFdPVwiQ29ubmVjdGluZ1wiO2FbYS5CaW5kaW5nPTJdPVwiQmluZGluZ1wiO2FbYS5SZWRpcmVjdGVkPTNdPVwiUmVkaXJlY3RlZFwifSkoeD1hLlJlZGlyZWN0aW9uU3RhdHVzfHwoYS5SZWRpcmVjdGlvblN0YXR1cz17fSkpO2I9ZnVuY3Rpb24oKXtmdW5jdGlvbiBhKCl7dGhpcy5waW5nYWN0aXZlPSExO3RoaXMuc3RhdHVzPXguTm90UmVkaXJlY3RlZDt0aGlzLnJlcXM9W107dGhpcy5jYnM9W107dGhpcy5kZWZlcnJlZEFjdGlvbnM9W107dGhpcy50ZWxlbWV0cnlfPW5ldyBnLlRlbGVtZXRyeTt0aGlzLnNjcmVlbnNoYXJlXz1uZXcgcC5TY3JlZW5TaGFyZVV0aWw7dGhpcy5zdGF0ZUNoYW5nZU5vdGlmY2F0aW9ucz1bXTt0aGlzLnZkYWZlYXR1cmVzXz1bXX1PYmplY3QuZGVmaW5lUHJvcGVydHkoYS5wcm90b3R5cGUsXCJ0ZWxlbWV0cnlcIixcbntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy50ZWxlbWV0cnlffSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShhLnByb3RvdHlwZSxcInNjcmVlbnNoYXJlXCIse2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnNjcmVlbnNoYXJlX30sZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITB9KTthLnByb3RvdHlwZS5zdG9wQXBwc2hhcmU9ZnVuY3Rpb24oKXt2YXIgYT13aW5kb3cuc3RvcEFwcHNoYXJlO2EmJmEoKX07YS5wcm90b3R5cGUuc2V0UmVtb3RlU2Vzc2lvbkluZm9DYj1mdW5jdGlvbihhKXt0aGlzLnJlbW90ZVNlc3Npb25JbmZvQ2I9YX07YS5wcm90b3R5cGUuc2V0RmVhdHVyZXM9ZnVuY3Rpb24oYSl7dGhpcy5mZWF0dXJlcz1hO3RoaXMuc2NyZWVuc2hhcmUub25Jbml0Q29tcGxldGUoKX07YS5wcm90b3R5cGUuZ2V0RmVhdHVyZVZhbHVlPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuZmVhdHVyZXMuZmluZChmdW5jdGlvbihiKXtyZXR1cm4gYi5uYW1lPT09XG5hfSk7cmV0dXJuIHZvaWQgMCE9PWI/Yi52YWx1ZTohMX07YS5wcm90b3R5cGUub25SZWRpcmVjdGlvbkNvbXBsZXRlPWZ1bmN0aW9uKCl7Zm9yKDt0aGlzLmRlZmVycmVkQWN0aW9ucyYmMDx0aGlzLmRlZmVycmVkQWN0aW9ucy5sZW5ndGg7KXRoaXMuZGVmZXJyZWRBY3Rpb25zLnNoaWZ0KCkucG9zdCh0aGlzLnN0YXR1cz09eC5SZWRpcmVjdGVkKX07YS5wcm90b3R5cGUuY29ubmVjdFRvU2VydmljZT1mdW5jdGlvbigpe3YubG9nZ2VyLmxvZyhcIlJlZGlyZWN0aW9uIHN0YXR1czogQ29ubmVjdGluZy4uLlwiKTt0aGlzLnN0YXR1cz14LkNvbm5lY3Rpbmc7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGEsYil7dmFyIGM9bmV3IFdlYlNvY2tldChcIndzczovLzEyNy4wLjAuMTo5MDAyXCIpO2Mub25vcGVuPWZ1bmN0aW9uKCl7YShjKX07Yy5vbmVycm9yPWZ1bmN0aW9uKGEpe3YubG9nZ2VyLmxvZyhcIndlYnNvY2tldCBjb25uZWN0aW9uIGVycm9yOiBcIithLnR5cGUpO2IoYSl9fSl9O2EucHJvdG90eXBlLndhaXRVbnRpbFJlZGlyZWN0ZWQ9XG5mdW5jdGlvbihhKXt2YXIgYj10aGlzO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihjLGQpe2Iuc3RhdHVzPT14LlJlZGlyZWN0ZWQ/YygpOjA+PWE/ZCgpOnNldFRpbWVvdXQoZnVuY3Rpb24oKXt2LmxvZ2dlci5sb2coXCJ3YWl0VW50aWxSZWRpcmVjdGVkKCkgdGltZW91dC4gY291bnQ9XCIrYSk7Yi5zdGF0dXMhPXguUmVkaXJlY3RlZD9iLndhaXRVbnRpbFJlZGlyZWN0ZWQoLS1hKS50aGVuKGZ1bmN0aW9uKCl7YygpfSlbXCJjYXRjaFwiXShmdW5jdGlvbigpe2QoKX0pOmMoKX0sMkUzKX0pfTthLnByb3RvdHlwZS5oYW5kbGVSZW1vdGVTZXNzaW9uSW5mbz1mdW5jdGlvbigpe3ZhciBhPXRoaXM7di5sb2dnZXIubG9nKFwiaGFuZGxlUmVtb3RlU2Vzc2lvbkluZm8gY2FsbGVkLlwiKTt2YXIgYj10aGlzO2IucmVtb3RlU2Vzc2lvbkluZm9DYj9iLnJlbW90ZVNlc3Npb25JbmZvQ2IoKS50aGVuKGZ1bmN0aW9uKGMpe3YubG9nZ2VyLmxvZyhcInJlbW90ZVNlc3Npb25JbmZvIHN1Y2Nlc3MhIGluZm86XCIrXG5KU09OLnN0cmluZ2lmeShjKSk7di5sb2dnZXIubG9nKFwiUmVkaXJlY3Rpb24gc3RhdHVzOiBSZWRpcmVjdGVkXCIpO2Iuc3RhdHVzPXguUmVkaXJlY3RlZDtiLnBpbmdDb25uZWN0aW9uRW5kKCk7KDAsd2luZG93Lm9uVmRpQ2xpZW50Q29ubmVjdGVkKSgpO2EudGVsZW1ldHJ5LlNlbmRUZWxlbWV0cnlJbml0KCk7Yi5vblJlZGlyZWN0aW9uQ29tcGxldGUoKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oKXt2LmxvZ2dlci5sb2coXCJyZW1vdGVTZXNzaW9uSW5mbyBmYWlsdXJlIVwiKTtiLnN1c3BlbmRSZWRpcmVjdGlvbighMCk7Yi5vblJlZGlyZWN0aW9uQ29tcGxldGUoKX0pOih2LmxvZ2dlci5sb2coXCJyZW1vdGVTZXNzaW9uSW5mb0NiIGlzIGludmFsaWQhXCIpLGIuc3VzcGVuZFJlZGlyZWN0aW9uKCEwKSxiLm9uUmVkaXJlY3Rpb25Db21wbGV0ZSgpKX07YS5wcm90b3R5cGUuc3RhcnRSZWRpcmVjdGlvbj1mdW5jdGlvbihhLGIpe3ZhciBjPXRoaXMsbT13aW5kb3cub25WZGlDbGllbnREaXNjb25uZWN0ZWQ7XG5yZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24oZixnKXtjLnN0YXR1cyE9eC5SZWRpcmVjdGVkPyh2LmxvZ2dlci5sb2coXCJBdHRlbXB0aW5nIHRvIHN0YXJ0IHJlZGlyZWN0aW9uOiBcIitiKSwhMT09PWE/Yy5kZWZlcnJlZEFjdGlvbnMucHVzaChuZXcgZC5kZWZlcnJlZF9hY3Rpb24oZixnLGIpKTpjLmNvbm5lY3RUb1NlcnZpY2UoKS50aGVuKGZ1bmN0aW9uKGEpe3YubG9nZ2VyLmxvZyhcIlJlZGlyZWN0aW9uIHN0YXR1czogQmluZGluZy4uLlwiKTtjLnN0YXR1cz14LkJpbmRpbmc7Yy53ZWJzb2NrZXQ9YTtjLndlYnNvY2tldC5vbm1lc3NhZ2U9ZnVuY3Rpb24oYSl7Yy5vbldTTWVzc2FnZShhKX07Yy53ZWJzb2NrZXQub25jbG9zZT1mdW5jdGlvbihhKXtjLm9uV1NDbG9zZShhKX07ZigpO2MuaGFuZGxlUmVtb3RlU2Vzc2lvbkluZm8oKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYSl7di5sb2dnZXIubG9nKFwiVW5hYmxlIHRvIGNvbm5lY3QgdG8gd2Vic29ja2V0IHNlcnZpY2UhXCIpO2coKTtcbmMuc3VzcGVuZFJlZGlyZWN0aW9uKCEwKTtjLm9uUmVkaXJlY3Rpb25Db21wbGV0ZSgpO20oITApfSkpOih2LmxvZ2dlci5sb2coXCJSZWRpcmVjdGlvbiBhbHJlYWR5IHN0YXJ0ZWQuXCIpLGYoKSl9KX07YS5wcm90b3R5cGUuc3VzcGVuZFJlZGlyZWN0aW9uPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXM7di5sb2dnZXIubG9nKFwiU3VzcGVuZGluZyByZWRpcmVjdGlvbi5cIik7KDAsd2luZG93Lm9uVmRpQ2xpZW50RGlzY29ubmVjdGVkKSghMSk7dmFyIGM9ITE7YT13aW5kb3cuZ2V0Q2l0cml4TVNUZWFtc1JlZGlyO3ZhciBkPXdpbmRvdy5nZXRDaXRyaXhXZWJydGNSZWRpcixtO2E/bT1hOmQmJihtPWQpO20mJm0oKS50aGVuKGZ1bmN0aW9uKGEpe3YubG9nZ2VyLmxvZyhcInN1Y2Vzc3Mgb24gZGlzY29ubmVjdFwiK2EpO1wiMVwiPT1hJiYoYz0hMCx2LmxvZ2dlci5sb2coXCJSZWcga2V5IGV4aXN0cyB3aGlsZSBkaXNjb25uZWN0aW5nXCIpKTtiLnN0YXR1cz09PXguUmVkaXJlY3RlZCYmMT09YyYmKHYubG9nZ2VyLmxvZyhcIkNhbGxpbmcgcGluZyBub3Qgbm9ybWFsIGRpc2Nvbm5lY3RcIiksXG5iLnBpbmdDb25uZWN0aW9uQmVnaW4oITEpKTt2LmxvZ2dlci5sb2coXCJSZWRpcmVjdGlvbiBzdGF0dXM6IE5vdFJlZGlyZWN0ZWRcIik7Yi5zdGF0dXM9eC5Ob3RSZWRpcmVjdGVkfSlbXCJjYXRjaFwiXShmdW5jdGlvbigpe3YubG9nZ2VyLmxvZyhcIkZhaWx1cmUgdG8gUmVhZCBNUyBUZWFtcyByZWRpciBSZWcgS2V5LCBub3QgcmV0cnlpbmcuLi5cIil9KTt0aGlzLmRpc3BhdGNoU3RhdGVDaGFuZ2VOb3RpZmljYXRpb25zKCl9O2EucHJvdG90eXBlLm9uV1NPcGVuPWZ1bmN0aW9uKCl7fTthLnByb3RvdHlwZS5vbldTQ2xvc2U9ZnVuY3Rpb24oYSl7di5sb2dnZXIubG9nKFwiZGlzY29ubmVjdGVkIGZyb20gd2Vic29ja2V0IHNlcnZpY2UuXCIpO3RyeXt0aGlzLnN1c3BlbmRSZWRpcmVjdGlvbighMCl9Y2F0Y2goYil7di5sb2dnZXIubG9nKFwic3VzcGVuZFJlZGlyZWN0aW9uKCk6IGV4Y2VwdGlvbiBjbG9zaW5nIFdlYlNvY2tldDogXCIrYi5tZXNzYWdlKX19O2EucHJvdG90eXBlLm9uV1NFcnJvcj1cbmZ1bmN0aW9uKCl7dHJ5e3RoaXMuc3VzcGVuZFJlZGlyZWN0aW9uKCEwKX1jYXRjaChhKXt2LmxvZ2dlci5sb2coXCJzdXNwZW5kUmVkaXJlY3Rpb24oKTogZXhjZXB0aW9uIG9uIFdlYlNvY2tldCBlcnJvcjogXCIrYS5tZXNzYWdlKX19O2EucHJvdG90eXBlLldTU2VuZE9iamVjdFdyYXBwZXI9ZnVuY3Rpb24oYSxiLGMsZCl7dmFyIG09ITA7YiE9ci5jbGFzc19pZF90LkVuZ2luZUNvbnRyb2x8fGMhPXIubWV0aG9kX2lkX0VuZ2luZUNvbnRyb2xfdC5jdG9yJiZjIT1yLm1ldGhvZF9pZF9FbmdpbmVDb250cm9sX3QudmVyc2lvbiYmYyE9ci5tZXRob2RfaWRfRW5naW5lQ29udHJvbF90LmZlYXR1cmVfZmxhZ3N8fChtPSExKTt2YXIgZj0hMDtpZihtJiYoZj0hMSx2b2lkIDAhPXRoaXMuZmVhdHVyZXMpKWZvcih2YXIgbT0wLHU9dGhpcy5mZWF0dXJlczttPHUubGVuZ3RoO20rKyl7dmFyIHE9dVttXTtpZighMD09PXEudmFsdWUmJnEubmFtZT09YSl7Zj0hMDticmVha319cmV0dXJuIDE9PVxuZj90aGlzLldTU2VuZE9iamVjdChkKTpQcm9taXNlLnJlamVjdChcIkNhbm5vdCBpbnZva2UgbWV0aG9kIHRoYXQgaXMgbm90IHN1cHBvcnRlZCBieSB3ZWJycGM6IGlpZChcIitiK1wiKSBtaWQoXCIrYytcIilcIil9O2EucHJvdG90eXBlLldTU2VuZE9iamVjdD1mdW5jdGlvbihhKXt2YXIgYj10aGlzO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihjLGQpe2lmKFwid2VicnRjXCI9PWEudil7dmFyIG09YS5oZHIucHJvYy5paWQsZz1hLmhkci5wcm9jLm1ldGhvZGlkLHU9YS5vYmpyZWYub2lkO2EuaGRyLmRlc3Ryb3l8fChtPW5ldyBmKGMsZCxtLHUsMCwhMCxnKSxiLnJlcXMucHVzaChtKSk7bT1KU09OLnN0cmluZ2lmeShhKTt2LmxvZ2dlci50cmFjZShcIldTU2VuZE9iamVjdDogPj4+IFwiK3IuV2VicnBjQ2xhc3NMaWJJbmZvVXRpbC5jb21wb3NlQ2xhc3NJbmZvRGF0YShhKStcIiBcIittKTt0cnl7Yi53ZWJzb2NrZXQuc2VuZChtKX1jYXRjaChxKXt2LmxvZ2dlci5sb2coXCJXU1NlbmRPYmplY3QoKTogZXhjZXB0aW9uOiBcIitcbnEubWVzc2FnZSksZChxLm1lc3NhZ2UpfX1lbHNlIGlmKFwib3ZlcmxheVwiPT1hLnYpe209SlNPTi5zdHJpbmdpZnkoYSk7di5sb2dnZXIubG9nKFwiSERYTVM6IFNlbmRPdmVybGF5RGF0YTogPj4+IFwiK20rXCInXCIpO3RyeXtiLndlYnNvY2tldC5zZW5kKG0pfWNhdGNoKHEpe3YubG9nZ2VyLmxvZyhcIldTU2VuZE9iamVjdCgpOiBleGNlcHRpb246IFwiK3EubWVzc2FnZSksZChxLm1lc3NhZ2UpfX1lbHNlIGlmKFwidGVsZW1ldHJ5XCI9PWEudil7bT1KU09OLnN0cmluZ2lmeShhKTt2LmxvZ2dlci5sb2coXCJIRFhNUzogU2VuZFRlbGVtZXRyeURhdGE6ID4+PiBcIittK1wiJ1wiKTt0cnl7Yi53ZWJzb2NrZXQuc2VuZChtKX1jYXRjaChxKXt2LmxvZ2dlci5sb2coXCJXU1NlbmRPYmplY3QoKTogZXhjZXB0aW9uOiBcIitxLm1lc3NhZ2UpLGQocS5tZXNzYWdlKX19ZWxzZSBpZihcImFwcHNoYXJpbmdcIj09YS52KXttPUpTT04uc3RyaW5naWZ5KGEpO3YubG9nZ2VyLmxvZyhcIkhEWE1TOiBTZW5kU2NyZWVuU2hhcmluZ0RhdGE6ID4+PiBcIitcbm0rXCInXCIpO3RyeXtiLndlYnNvY2tldC5zZW5kKG0pfWNhdGNoKHEpe3YubG9nZ2VyLmxvZyhcIldTU2VuZE9iamVjdCgpOiBleGNlcHRpb246IFwiK3EubWVzc2FnZSksZChxLm1lc3NhZ2UpfX1lbHNlIHYubG9nZ2VyLmxvZyhcIkhEWE1TOiBVbmtub3duIHByb3RvY29sOiAnXCIrSlNPTi5zdHJpbmdpZnkoYSkrXCInXCIpfSl9O2EucHJvdG90eXBlLndlYnJwY1N0YXR1c0NvZGVUb05hbWU9ZnVuY3Rpb24oYSl7c3dpdGNoKGEpe2Nhc2UgZS5ycGNfc3RhdHVzX3N1Y2Nlc3M6YT1cInJwY19zdGF0dXNfc3VjY2Vzc1wiO2JyZWFrO2Nhc2UgZS5ycGNfc3RhdHVzX3Vuc3BlY2lmaWVkX2Vycm9yOmE9XCJycGNfc3RhdHVzX3Vuc3BlY2lmaWVkX2Vycm9yXCI7YnJlYWs7Y2FzZSBlLnJwY19zdGF0dXNfdW5leHBlY3RlZDphPVwicnBjX3N0YXR1c191bmV4cGVjdGVkXCI7YnJlYWs7Y2FzZSBlLnJwY19zdGF0dXNfaW5kZXhfb3V0X29mX2JvdW5kczphPVwicnBjX3N0YXR1c19pbmRleF9vdXRfb2ZfYm91bmRzXCI7XG5icmVhaztjYXNlIGUucnBjX3N0YXR1c19taXNzaW5nX3BhcmFtZXRlcjphPVwicnBjX3N0YXR1c19taXNzaW5nX3BhcmFtZXRlclwiO2JyZWFrO2Nhc2UgZS5ycGNfc3RhdHVzX21pc3NpbmdfcmV0dXJuX3ZhbHVlOmE9XCJycGNfc3RhdHVzX21pc3NpbmdfcmV0dXJuX3ZhbHVlXCI7YnJlYWs7Y2FzZSBlLnJwY19zdGF0dXNfaW52YWxpZF9vYmplY3Q6YT1cInJwY19zdGF0dXNfaW52YWxpZF9vYmplY3RcIjticmVhaztjYXNlIGUucnBjX3N0YXR1c191c2VyX2V4Y2VwdGlvbjphPVwicnBjX3N0YXR1c191c2VyX2V4Y2VwdGlvblwiO2JyZWFrO2Nhc2UgZS5ycGNfc3RhdHVzX3N5c3RlbV9lcnJvcjphPVwicnBjX3N0YXR1c19zeXN0ZW1fZXJyb3JcIjticmVhaztkZWZhdWx0OmE9XCJ1bmtub3duXCJ9cmV0dXJuIGF9O2EucHJvdG90eXBlLnBhcmNlV2VicnBjRXJyb3I9ZnVuY3Rpb24oYSxiKXt2b2lkIDA9PT1hJiYoYT1iJiYwPGIubGVuZ3RoP2JbMF0uY2F0ZWdvcnl8fGJbMF0uY29kZXx8YlswXS5tZXNzYWdlP1xuZS5ycGNfc3RhdHVzX3N5c3RlbV9lcnJvcjplLnJwY19zdGF0dXNfdXNlcl9leGNlcHRpb246ZS5ycGNfc3RhdHVzX3Vuc3BlY2lmaWVkX2Vycm9yKTt2YXIgYztzd2l0Y2goYSl7Y2FzZSBlLnJwY19zdGF0dXNfdW5zcGVjaWZpZWRfZXJyb3I6Y2FzZSBlLnJwY19zdGF0dXNfdW5leHBlY3RlZDpjYXNlIGUucnBjX3N0YXR1c19pbmRleF9vdXRfb2ZfYm91bmRzOmNhc2UgZS5ycGNfc3RhdHVzX21pc3NpbmdfcGFyYW1ldGVyOmNhc2UgZS5ycGNfc3RhdHVzX21pc3NpbmdfcmV0dXJuX3ZhbHVlOmNhc2UgZS5ycGNfc3RhdHVzX2ludmFsaWRfb2JqZWN0OmM9bmV3IERPTUV4Y2VwdGlvbih0aGlzLndlYnJwY1N0YXR1c0NvZGVUb05hbWUoYSksdGhpcy53ZWJycGNTdGF0dXNDb2RlVG9OYW1lKGEpKTticmVhaztjYXNlIGUucnBjX3N0YXR1c191c2VyX2V4Y2VwdGlvbjpjPWImJjA8Yi5sZW5ndGg/bmV3IERPTUV4Y2VwdGlvbihiWzBdLHRoaXMud2VicnBjU3RhdHVzQ29kZVRvTmFtZShhKSk6XG5uZXcgRE9NRXhjZXB0aW9uKHRoaXMud2VicnBjU3RhdHVzQ29kZVRvTmFtZShhKSx0aGlzLndlYnJwY1N0YXR1c0NvZGVUb05hbWUoYSkpO2JyZWFrO2Nhc2UgZS5ycGNfc3RhdHVzX3N5c3RlbV9lcnJvcjppZihiJiYwPGIubGVuZ3RoKXtjPU9iamVjdC5jcmVhdGUoRE9NRXhjZXB0aW9uKTt2YXIgZD17dmFsdWU6bnVsbCx3cml0YWJsZTohMCxlbnVtZXJhYmxlOiExLENvbmZpZ3VyYWJsZTohMH07ZC52YWx1ZT1iWzBdLmNhdGVnb3J5O09iamVjdC5kZWZpbmVQcm9wZXJ0eShjLFwibmFtZVwiLGQpO2QudmFsdWU9YlswXS5jb2RlO09iamVjdC5kZWZpbmVQcm9wZXJ0eShjLFwiY29kZVwiLGQpO2QudmFsdWU9YlswXS5tZXNzYWdlO09iamVjdC5kZWZpbmVQcm9wZXJ0eShjLFwibWVzc2FnZVwiLGQpfWVsc2UgYz1uZXcgRE9NRXhjZXB0aW9uKHRoaXMud2VicnBjU3RhdHVzQ29kZVRvTmFtZShhKSx0aGlzLndlYnJwY1N0YXR1c0NvZGVUb05hbWUoYSkpfXJldHVybiBjfTthLnByb3RvdHlwZS5vbldTTWVzc2FnZT1cbmZ1bmN0aW9uKGEpe3ZhciBiPWEuZGF0YSxjO3RyeXtjPUpTT04ucGFyc2UoYil9Y2F0Y2gocSl7Y29uc29sZS5sb2coXCJpbnZhbGlkIEpTT04hISFcIik7Y29uc29sZS5sb2cocSk7Y29uc29sZS5sb2coYik7cmV0dXJufWlmKFwid2VicnRjXCI9PWMudil7di5sb2dnZXIudHJhY2UoXCJvbldTTWVzc2FnZTogPDw8IFwiK3IuV2VicnBjQ2xhc3NMaWJJbmZvVXRpbC5jb21wb3NlQ2xhc3NJbmZvRGF0YShjKStcIiBcIitiKTt2YXIgZD1jLmhkci5wcm9jLmlpZCxtPWMuaGRyLnByb2MubWV0aG9kaWQsZj1jLm9ianJlZi5vaWQ7YT1jLnN0YXR1cztpZihjLmhkci5tc2dfdHlwZT09bi5Xc0pzb25VdGlsLmdldE1zZ1R5cGUobi53c19tc2dfdHlwZV90LnJlcGx5KSliPXRoaXMucmVxcy5maW5kSW5kZXgoZnVuY3Rpb24oYSl7cmV0dXJuIGEuaWlkPT1kJiZhLm9pZD09ZiYmYS5taWQ9PW19KSwwPD1iPzA9PWE/dGhpcy5yZXFzLnNwbGljZShiLDEpLnNoaWZ0KCkucmVzb2x2ZShjKTooYz10aGlzLnBhcmNlV2VicnBjRXJyb3IoYSxcbmMucGFyYW1zKSx0aGlzLnJlcXMuc3BsaWNlKGIsMSkuc2hpZnQoKS5yZWplY3QoYykpOih2LmxvZ2dlci5sb2coXCJIRFhNUyBkaWRudCBmaW5kIHRoaXMgb25lLiAocmVxcylcIiksdi5sb2dnZXIubG9nKHRoaXMucmVxcykpO2Vsc2UgaWYoYy5oZHIubXNnX3R5cGU9PW4uV3NKc29uVXRpbC5nZXRNc2dUeXBlKG4ud3NfbXNnX3R5cGVfdC5ldmVudF9yZXEpKXt2YXIgdT1jLmZ1bmMuaWQsYj10aGlzLmNicy5maW5kSW5kZXgoZnVuY3Rpb24oYSl7cmV0dXJuIGEuaWlkPT1kJiZhLm9pZD09ZiYmYS5jYmlkPT11Pj4xNn0pOzA8PWI/KDA9PSh1JjY1NTM1KT90aGlzLmNic1tiXS5yZXNvbHZlKGMpOihjPXRoaXMucGFyY2VXZWJycGNFcnJvcihhLGMucGFyYW1zKSx0aGlzLmNic1tiXS5yZWplY3QoYykpLDE9PXRoaXMuY2JzW2JdLm9uZVNob3QmJnRoaXMuY2JzLnNwbGljZShiLDEpKToodi5sb2dnZXIubG9nKFwiSERYTVMgZGlkbnQgZmluZCB0aGlzIG9uZS4gKGNicylcIiksdi5sb2dnZXIubG9nKHRoaXMuY2JzKSl9ZWxzZSB2LmxvZ2dlci5sb2coXCJIRFhNUyBSZWNlaXZlZCBib2d1cyBtZXNzYWdlOiBcIitcbmIrXCInXCIpfWVsc2UgaWYoXCJ0ZWxlbWV0cnlcIj09Yy52KTA9PWMuc3RhdHVzJiYoYT1jLmhkci5jb21tYW5kLDI9PShhJjIxNDc0ODM2NDcpJiYoYj1jLmhkci5pZCx0aGlzLnRlbGVtZXRyeS5vbkluaXRpYWxpemVkKGIpLHYubG9nZ2VyLmxvZyhcIlRlbGVtZXRyeSBpbml0IHJlc3BvbnNlIHJlY2VpdmVkXCIpKSk7ZWxzZSBpZihcImZlYXR1cmVzXCI9PWMudil7YT1jLmZlYXR1cmVzO2lmKFwiZmVhdHVyZS1zdXBwb3J0XCI9PWMuY29tbWFuZClmb3Iodi5sb2dnZXIubG9nKFwiZmVhdHVyZXMgY2FwYWJpbGl0aWVzIHJlY2VpdmVkLCBmZWF0dXJlczpcIithKSx0aGlzLnZkYWZlYXR1cmVzXz1hLGI9MDtiPGEubGVuZ3RoO2IrKylpZihhW2JdPT09ci5GRUFUVVJFX3ZkYV9hcHBfc2hhcmluZyl0aGlzLnNjcmVlbnNoYXJlLm9uSW5pdGlhbGl6ZWQoITApO3RoaXMuY2xpZW50Vmlld3BvcnRNb2RlXz1jLmNsaWVudF92aWV3cG9ydF9tb2RlO3YubG9nZ2VyLmxvZyhcImZlYXR1cmVzIGNsaWVudF92aWV3cG9ydF9tb2RlIHZhbHVlOiBcIitcbnRoaXMuY2xpZW50Vmlld3BvcnRNb2RlXyl9ZWxzZVwiYXBwc2hhcmluZ1wiPT1jLnY/KGE9Yy5zdGF0dXMsMD09YT8oYT1jLmhkci5jb21tYW5kLGI9Yy5oZHIuaWQsKGEmMjE0NzQ4MzY0Nyk9PXAuc3NoYXJlX2NtZC5HZXRTb3VyY2VzPyh2LmxvZ2dlci5sb2coXCJhcHBzaGFyaW5nIEdldFNvdXJjZXMgcmVzcG9uc2UgcmVjZWl2ZWRcIiksdGhpcy5zY3JlZW5zaGFyZS5vbkdldFNvdXJjZXMoYixjLmRhdGEpKTooYSYyMTQ3NDgzNjQ3KT09cC5zc2hhcmVfY21kLlNldEFjdGl2ZT8odi5sb2dnZXIubG9nKFwiYXBwc2hhcmluZyBTZXRBY3RpdmUgcmVzcG9uc2UgcmVjZWl2ZWRcIiksdGhpcy5zY3JlZW5zaGFyZS5vblNldEFjdGl2ZShiLGMuZGF0YSkpOihhJjIxNDc0ODM2NDcpPT1wLnNzaGFyZV9jbWQuVG9wb2xvZ3lDaGFuZ2VkPyh2LmxvZ2dlci5sb2coXCJhcHBzaGFyaW5nIFdpbmRvdyB0b3BvbG9neSBjaGFuZ2VkIGNtZCByZWNlaXZlZFwiKSx0aGlzLnNjcmVlbnNoYXJlLm9uVG9wbG9neUNoYW5nZWQoKSk6XG4odi5sb2dnZXIubG9nKFwiaW52YWxpZCBjb21tYW5kIHJlcGx5OlwiK2EpLHRoaXMuc2NyZWVuc2hhcmUub25FcnJvcihiKSkpOih2LmxvZ2dlci5sb2coXCJpbnZhbGlkIHN0YXR1cyByZXBseTpcIithKSxiPWMuaGRyLmlkLHRoaXMuc2NyZWVuc2hhcmUub25FcnJvcihiKSkpOnYubG9nZ2VyLmxvZyhcIkhEWE1TOiBVbmtub3duIHByb3RvY29sOiBcIitiK1wiJ1wiKX07YS5wcm90b3R5cGUuY2xlYXJSZXFzPWZ1bmN0aW9uKCl7di5sb2dnZXIubG9nKFwiY2xlYXJSZXFzKClcIik7dGhpcy5yZXFzLmZvckVhY2goZnVuY3Rpb24oYSxiKXthLnJlamVjdCgpfSk7dGhpcy5yZXFzPVtdfTthLnByb3RvdHlwZS5yZWdpc3RlckhhbmRsZXI9ZnVuY3Rpb24oYSxiLGMpe2E9bmV3IGYoYy5yZXNvbHZlLmJpbmQoYyksYy5yZWplY3QuYmluZChjKSxhLGIsYy5pZCxjLm9uZVNob3QsMCk7dGhpcy5jYnMucHVzaChhKX07YS5wcm90b3R5cGUudW5yZWdpc3RlckhhbmRsZXI9ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPVxudGhpcy5jYnMuZmluZEluZGV4KGZ1bmN0aW9uKGQpe3JldHVybiBkLmlpZD09YSYmZC5vaWQ9PWImJmQuY2JpZD09Y30pOzA8PWQ/dGhpcy5jYnMuc3BsaWNlKGQsMSk6KHYubG9nZ2VyLmxvZyhcIkhEWE1TIERpZG50IGZpbmQgdGhpcyBjYWxsYmFjayBpbiB0aGUgbGlzdCFcIiksY29uc29sZS5sb2codGhpcy5jYnMpKX07YS5wcm90b3R5cGUuaXNSZWRpcmVjdGVkPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuc3RhdHVzPT09eC5SZWRpcmVjdGVkfHx0aGlzLnN0YXR1cz09PXguQmluZGluZ3x8dGhpcy5zdGF0dXM9PT14LkNvbm5lY3Rpbmd9O2EucHJvdG90eXBlLmlzQ29ubmVjdGVkPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuc3RhdHVzPT14LlJlZGlyZWN0ZWR9O2EucHJvdG90eXBlLmlzUGluZ0FjdGl2ZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLnBpbmdhY3RpdmV9O2EucHJvdG90eXBlLnBpbmdDb25uZWN0aW9uQmVnaW49ZnVuY3Rpb24oYSl7di5sb2dnZXIubG9nKFwiU3RhcnRlZCB0aW1lclwiKTtcbnRoaXMucGluZ2FjdGl2ZT0hMDt2YXIgYj13aW5kb3cub25WZGlDbGllbnREaXNjb25uZWN0ZWRUaW1lcjsxPT1hPyh2LmxvZ2dlci5sb2coXCJjaGVja2luZyBpZiB3ZSBhcmUgY29ubmVjdGVkLi4uXCIpLGIoKSk6dGhpcy5jb25udGltZXI9c2V0VGltZW91dChmdW5jdGlvbigpe3YubG9nZ2VyLmxvZyhcImNoZWNraW5nIGlmIHdlIGFyZSBjb25uZWN0ZWQuLi5cIik7YigpfSwxNUUzKX07YS5wcm90b3R5cGUucGluZ0Nvbm5lY3Rpb25FbmQ9ZnVuY3Rpb24oKXt0aGlzLnBpbmdhY3RpdmU9ITE7Y2xlYXJUaW1lb3V0KHRoaXMuY29ubnRpbWVyKX07YS5wcm90b3R5cGUuU2VuZFRlbGVtZXRyeURhdGFfU3BlYWtlcj1mdW5jdGlvbihhKXt0aGlzLnRlbGVtZXRyeS5TZW5kVGVsZW1ldHJ5RGF0YShnLnRlbF9jbWQuRGF0YSxnLnRlbF9rZXlfU3BlYWtlckRldmljZVVzZWQsYSwwKX07YS5wcm90b3R5cGUucmVnaXN0ZXJTdGF0ZUNoYW5nZU5vdGlmaWNhdGlvbj1mdW5jdGlvbihhKXt0aGlzLnN0YXRlQ2hhbmdlTm90aWZjYXRpb25zLnB1c2goYSl9O1xuYS5wcm90b3R5cGUudW5yZWdpc3RlclN0YXRlQ2hhbmdlTm90aWZpY2F0aW9uPWZ1bmN0aW9uKGEpe3RoaXMuc3RhdGVDaGFuZ2VOb3RpZmNhdGlvbnM9dGhpcy5zdGF0ZUNoYW5nZU5vdGlmY2F0aW9ucy5maWx0ZXIoZnVuY3Rpb24oYil7cmV0dXJuIGIhPWF9KX07YS5wcm90b3R5cGUuZGlzcGF0Y2hTdGF0ZUNoYW5nZU5vdGlmaWNhdGlvbnM9ZnVuY3Rpb24oKXt0aGlzLnN0YXRlQ2hhbmdlTm90aWZjYXRpb25zLmZvckVhY2goZnVuY3Rpb24oYSl7YSgpfSl9O2EucHJvdG90eXBlLnZkYWJ1ZmZlck5vTGltaXQ9ZnVuY3Rpb24oKXtmb3IodmFyIGE9ITEsYj0wLGM9dGhpcy52ZGFmZWF0dXJlc187YjxjLmxlbmd0aDtiKyspaWYoY1tiXT09PXIuRkVBVFVSRV92ZGFfc2VydmljZV9ub19idWZmZXJfbGltaXQpe2E9ITA7YnJlYWt9cmV0dXJuIGF9O09iamVjdC5kZWZpbmVQcm9wZXJ0eShhLnByb3RvdHlwZSxcImNsaWVudFZpZXdwb3J0TW9kZVwiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jbGllbnRWaWV3cG9ydE1vZGVffHxcblwidW5rbm93blwifSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO3JldHVybiBhfSgpO2EuSGR4TWVkaWFTdHJlYW09Yjt2YXIgbT1uZXcgYjthLmdldFJlZGlyZWN0b3I9ZnVuY3Rpb24oKXtyZXR1cm4gbX19LDk4NTpmdW5jdGlvbihiLGEsYyl7dmFyIGQ9dGhpcyYmdGhpcy5fX2V4dGVuZHN8fGZ1bmN0aW9uKCl7dmFyIGE9ZnVuY3Rpb24oYixjKXthPU9iamVjdC5zZXRQcm90b3R5cGVPZnx8e19fcHJvdG9fXzpbXX1pbnN0YW5jZW9mIEFycmF5JiZmdW5jdGlvbihhLGIpe2EuX19wcm90b19fPWJ9fHxmdW5jdGlvbihhLGIpe2Zvcih2YXIgYyBpbiBiKWIuaGFzT3duUHJvcGVydHkoYykmJihhW2NdPWJbY10pfTtyZXR1cm4gYShiLGMpfTtyZXR1cm4gZnVuY3Rpb24oYixjKXtmdW5jdGlvbiBkKCl7dGhpcy5jb25zdHJ1Y3Rvcj1ifWEoYixjKTtiLnByb3RvdHlwZT1udWxsPT09Yz9PYmplY3QuY3JlYXRlKGMpOihkLnByb3RvdHlwZT1jLnByb3RvdHlwZSxuZXcgZCl9fSgpLFxuZT10aGlzJiZ0aGlzLl9fc3ByZWFkQXJyYXlzfHxmdW5jdGlvbigpe2Zvcih2YXIgYT0wLGI9MCxjPWFyZ3VtZW50cy5sZW5ndGg7YjxjO2IrKylhKz1hcmd1bWVudHNbYl0ubGVuZ3RoO2Zvcih2YXIgYT1BcnJheShhKSxkPTAsYj0wO2I8YztiKyspZm9yKHZhciBtPWFyZ3VtZW50c1tiXSxnPTAsbj1tLmxlbmd0aDtnPG47ZysrLGQrKylhW2RdPW1bZ107cmV0dXJuIGF9O09iamVjdC5kZWZpbmVQcm9wZXJ0eShhLFwiX19lc01vZHVsZVwiLHt2YWx1ZTohMH0pO3ZhciByPWMoNjU4KSxuPWMoNTUwKSxnPWMoODUxKTtiPWZ1bmN0aW9uKGEpe2Z1bmN0aW9uIGIoYyxkLG0pe2Zvcih2YXIgZz1bXSxmPTM7Zjxhcmd1bWVudHMubGVuZ3RoO2YrKylnW2YtM109YXJndW1lbnRzW2ZdO3JldHVybiBhLmFwcGx5KHRoaXMsZShbYyxuLmNsYXNzX2lkX3QuUlRDSWNlQ2FuZGlkYXRlLGQsbSxudWxsXSxnKSl8fHRoaXN9ZChiLGEpO09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcImNhbmRpZGF0ZVwiLFxue2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmNhbmRpZGF0ZV99LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwic2RwTWlkXCIse2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnNkcE1pZF99LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwic2RwTUxpbmVJbmRleFwiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zZHBNTGluZUluZGV4X30sZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITB9KTtiLnByb3RvdHlwZS5zeW5jQmFycmllcj1mdW5jdGlvbigpe3ZhciBhPXRoaXM7Zy5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLnN5bmNCYXJyaWVyKCkgY2FsbGVkLlwiKTtyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24oYixjKXthLndhaXRVbnRpbENvbm5lY3RlZChcIkljZUNhbmRpZGF0ZS5zeW5jQmFycmllclwiKS50aGVuKGZ1bmN0aW9uKCl7cmV0dXJuIFByb21pc2UuYWxsKFthLnJlbW90ZUludm9rZSghMSxcbm4ubWV0aG9kX2lkX1JUQ0ljZUNhbmRpZGF0ZV90LmNhbmRpZGF0ZSxcIlwiKSxhLnJlbW90ZUludm9rZSghMSxuLm1ldGhvZF9pZF9SVENJY2VDYW5kaWRhdGVfdC5zZHBNaWQsXCJcIiksYS5yZW1vdGVJbnZva2UoITEsbi5tZXRob2RfaWRfUlRDSWNlQ2FuZGlkYXRlX3Quc2RwTUxpbmVJbmRleCwwKV0pfSkudGhlbihmdW5jdGlvbihjKXtjPWMubWFwKGZ1bmN0aW9uKGIpe3JldHVybiBhLnBhcmFtMChiKX0pO2EuY2FuZGlkYXRlXz1jWzBdO2Euc2RwTWlkXz1jWzFdO2Euc2RwTUxpbmVJbmRleF89Y1syXTtiKGEpfSlbXCJjYXRjaFwiXShmdW5jdGlvbihiKXtiPWEubG9nUmVtb3RlSW52b2tlRXJyb3IoYixcIi5zeW5jQmFycmllciBmYWlsZWQhXCIpO2MoYil9KX0pfTtyZXR1cm4gYn0oci5Qcm94eU9iamVjdCk7YS5JY2VDYW5kaWRhdGU9YjtiPWZ1bmN0aW9uKGEpe2Z1bmN0aW9uIGIoYyxkKXtyZXR1cm4gYS5jYWxsKHRoaXMsYyxuLmNsYXNzX2lkX3QuUlRDSWNlQ2FuZGlkYXRlUGFpcixkLFxuci5Qcm94eU1vZGUuUmVtb3RlKXx8dGhpc31kKGIsYSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwibG9jYWxcIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubG9jYWxffSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcInJlbW90ZVwiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5yZW1vdGVffSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO2IucHJvdG90eXBlLnN5bmNCYXJyaWVyPWZ1bmN0aW9uKCl7dmFyIGE9dGhpcztnLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc3luY0JhcnJpZXIoKSBjYWxsZWQuXCIpO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihiLGMpe2Eud2FpdFVudGlsQ29ubmVjdGVkKFwiSWNlQ2FuZGlkYXRlUGFpci5zeW5jQmFycmllclwiKS50aGVuKGZ1bmN0aW9uKCl7cmV0dXJuIFByb21pc2UuYWxsKFthLnJlbW90ZUludm9rZSghMSxcbm4ubWV0aG9kX2lkX1JUQ0ljZUNhbmRpZGF0ZVBhaXJfdC5sb2NhbCx7fSksYS5yZW1vdGVJbnZva2UoITEsbi5tZXRob2RfaWRfUlRDSWNlQ2FuZGlkYXRlUGFpcl90LnJlbW90ZSx7fSldKX0pLnRoZW4oZnVuY3Rpb24oYyl7Yz1jLm1hcChmdW5jdGlvbihiKXtyZXR1cm4gYS5wYXJhbTAoYil9KTthLmxvY2FsXz1jWzBdO2EucmVtb3RlXz1jWzFdO2IoYSl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGIpe2I9YS5sb2dSZW1vdGVJbnZva2VFcnJvcihiLFwiLnN5bmNCYXJyaWVyIGZhaWxlZCFcIik7YyhiKX0pfSl9O3JldHVybiBifShyLlByb3h5T2JqZWN0KTthLkljZUNhbmRpZGF0ZVBhaXI9Yn0sODUxOmZ1bmN0aW9uKGIsYSl7T2JqZWN0LmRlZmluZVByb3BlcnR5KGEsXCJfX2VzTW9kdWxlXCIse3ZhbHVlOiEwfSk7dmFyIGM9ZnVuY3Rpb24oKXtmdW5jdGlvbiBhKGIpe3RoaXMudHJhY2luZz0hMTt0aGlzLm1zbG9nZ2VyXz12b2lkIDA7dGhpcy50YWc9Yjt0aGlzLmVuYWJsZWQ9ITB9YS5wcm90b3R5cGUuc2V0TVNMb2dnZXI9XG5mdW5jdGlvbihhKXt0aGlzLm1zbG9nZ2VyXz1hfTthLnByb3RvdHlwZS5sb2c9ZnVuY3Rpb24oKXtmb3IodmFyIGE9W10sYj0wO2I8YXJndW1lbnRzLmxlbmd0aDtiKyspYVtiXT1hcmd1bWVudHNbYl07dGhpcy5lbmFibGVkJiYodm9pZCAwIT10aGlzLm1zbG9nZ2VyXz90aGlzLm1zbG9nZ2VyXy5pbmZvKHRoaXMudGFnK1wiIFwiK2EpOmNvbnNvbGUubG9nKHRoaXMudGFnK1wiIFwiK2EpKX07YS5wcm90b3R5cGUudHJhY2U9ZnVuY3Rpb24oKXtmb3IodmFyIGE9W10sYj0wO2I8YXJndW1lbnRzLmxlbmd0aDtiKyspYVtiXT1hcmd1bWVudHNbYl07dGhpcy50cmFjaW5nJiZ0aGlzLmxvZy5hcHBseSh0aGlzLGEpfTtyZXR1cm4gYX0oKTthLkxvZ2dlcj1jO2EubG9nZ2VyPW5ldyBjKFwiW0hkeFdlYlJUQy5qc11cIik7YS5sb2dnZXIuZW5hYmxlZD0hMH0sMzYwOmZ1bmN0aW9uKGIsYSxjKXt2YXIgZD10aGlzJiZ0aGlzLl9fZXh0ZW5kc3x8ZnVuY3Rpb24oKXt2YXIgYT1mdW5jdGlvbihiLGMpe2E9XG5PYmplY3Quc2V0UHJvdG90eXBlT2Z8fHtfX3Byb3RvX186W119aW5zdGFuY2VvZiBBcnJheSYmZnVuY3Rpb24oYSxiKXthLl9fcHJvdG9fXz1ifXx8ZnVuY3Rpb24oYSxiKXtmb3IodmFyIGwgaW4gYiliLmhhc093blByb3BlcnR5KGwpJiYoYVtsXT1iW2xdKX07cmV0dXJuIGEoYixjKX07cmV0dXJuIGZ1bmN0aW9uKGIsYyl7ZnVuY3Rpb24gcSgpe3RoaXMuY29uc3RydWN0b3I9Yn1hKGIsYyk7Yi5wcm90b3R5cGU9bnVsbD09PWM/T2JqZWN0LmNyZWF0ZShjKToocS5wcm90b3R5cGU9Yy5wcm90b3R5cGUsbmV3IHEpfX0oKSxlPXRoaXMmJnRoaXMuX19hd2FpdGVyfHxmdW5jdGlvbihhLGIsYyxxKXtmdW5jdGlvbiBkKGEpe3JldHVybiBhIGluc3RhbmNlb2YgYz9hOm5ldyBjKGZ1bmN0aW9uKGIpe2IoYSl9KX1yZXR1cm4gbmV3IChjfHwoYz1Qcm9taXNlKSkoZnVuY3Rpb24oYyxIKXtmdW5jdGlvbiB3KGEpe3RyeXttKHEubmV4dChhKSl9Y2F0Y2goYil7SChiKX19ZnVuY3Rpb24gaChhKXt0cnl7bShxW1widGhyb3dcIl0oYSkpfWNhdGNoKGIpe0goYil9fVxuZnVuY3Rpb24gbShhKXthLmRvbmU/YyhhLnZhbHVlKTpkKGEudmFsdWUpLnRoZW4odyxoKX1tKChxPXEuYXBwbHkoYSxifHxbXSkpLm5leHQoKSl9KX0scj10aGlzJiZ0aGlzLl9fZ2VuZXJhdG9yfHxmdW5jdGlvbihhLGIpe2Z1bmN0aW9uIGMoYSl7cmV0dXJuIGZ1bmN0aW9uKGIpe3JldHVybiBxKFthLGJdKX19ZnVuY3Rpb24gcShjKXtpZih3KXRocm93IG5ldyBUeXBlRXJyb3IoXCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuXCIpO2Zvcig7ZDspdHJ5e2lmKHc9MSxoJiYobT1jWzBdJjI/aFtcInJldHVyblwiXTpjWzBdP2hbXCJ0aHJvd1wiXXx8KChtPWhbXCJyZXR1cm5cIl0pJiZtLmNhbGwoaCksMCk6aC5uZXh0KSYmIShtPW0uY2FsbChoLGNbMV0pKS5kb25lKXJldHVybiBtO2lmKGg9MCxtKWM9W2NbMF0mMixtLnZhbHVlXTtzd2l0Y2goY1swXSl7Y2FzZSAwOmNhc2UgMTptPWM7YnJlYWs7Y2FzZSA0OnJldHVybiBkLmxhYmVsKysse3ZhbHVlOmNbMV0sZG9uZTohMX07Y2FzZSA1OmQubGFiZWwrKztcbmg9Y1sxXTtjPVswXTtjb250aW51ZTtjYXNlIDc6Yz1kLm9wcy5wb3AoKTtkLnRyeXMucG9wKCk7Y29udGludWU7ZGVmYXVsdDppZighKG09ZC50cnlzLG09MDxtLmxlbmd0aCYmbVttLmxlbmd0aC0xXSkmJig2PT09Y1swXXx8Mj09PWNbMF0pKXtkPTA7Y29udGludWV9aWYoMz09PWNbMF0mJighbXx8Y1sxXT5tWzBdJiZjWzFdPG1bM10pKWQubGFiZWw9Y1sxXTtlbHNlIGlmKDY9PT1jWzBdJiZkLmxhYmVsPG1bMV0pZC5sYWJlbD1tWzFdLG09YztlbHNlIGlmKG0mJmQubGFiZWw8bVsyXSlkLmxhYmVsPW1bMl0sZC5vcHMucHVzaChjKTtlbHNle21bMl0mJmQub3BzLnBvcCgpO2QudHJ5cy5wb3AoKTtjb250aW51ZX19Yz1iLmNhbGwoYSxkKX1jYXRjaChLKXtjPVs2LEtdLGg9MH1maW5hbGx5e3c9bT0wfWlmKGNbMF0mNSl0aHJvdyBjWzFdO3JldHVybnt2YWx1ZTpjWzBdP2NbMV06dm9pZCAwLGRvbmU6ITB9fXZhciBkPXtsYWJlbDowLHNlbnQ6ZnVuY3Rpb24oKXtpZihtWzBdJjEpdGhyb3cgbVsxXTtcbnJldHVybiBtWzFdfSx0cnlzOltdLG9wczpbXX0sdyxoLG0sdTskanNjb21wLmluaXRTeW1ib2woKTskanNjb21wLmluaXRTeW1ib2woKTskanNjb21wLmluaXRTeW1ib2xJdGVyYXRvcigpO3JldHVybiB1PXtuZXh0OmMoMCksXCJ0aHJvd1wiOmMoMSksXCJyZXR1cm5cIjpjKDIpfSxcImZ1bmN0aW9uXCI9PT10eXBlb2YgU3ltYm9sJiYodVtTeW1ib2wuaXRlcmF0b3JdPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9KSx1fSxuPXRoaXMmJnRoaXMuX19zcHJlYWRBcnJheXN8fGZ1bmN0aW9uKCl7Zm9yKHZhciBhPTAsYj0wLGM9YXJndW1lbnRzLmxlbmd0aDtiPGM7YisrKWErPWFyZ3VtZW50c1tiXS5sZW5ndGg7Zm9yKHZhciBhPUFycmF5KGEpLHE9MCxiPTA7YjxjO2IrKylmb3IodmFyIGQ9YXJndW1lbnRzW2JdLHc9MCxoPWQubGVuZ3RoO3c8aDt3KysscSsrKWFbcV09ZFt3XTtyZXR1cm4gYX07T2JqZWN0LmRlZmluZVByb3BlcnR5KGEsXCJfX2VzTW9kdWxlXCIse3ZhbHVlOiEwfSk7dmFyIGc9Yyg5NDYpLFxucD1jKDE0NCksZj1jKDU4OSksaz1jKDY1OCkseD1jKDk4NSksbT1jKDM3NyksRD1jKDY1MCksQj1jKDI0KSx0PWMoNTUwKSxoPWMoODUxKSxBPWMoNTE3KSx5PWMoMzk0KSxFPWZ1bmN0aW9uKGEpe2Z1bmN0aW9uIGIoYyxxLGQpe2M9YS5jYWxsKHRoaXMsYyx0LmNsYXNzX2lkX3QuUlRDSWNlQ2FuZGlkYXRlRXZlbnQscSxrLlByb3h5TW9kZS5SZW1vdGUpfHx0aGlzO2MudGFyZ2V0PWQ7Yy50eXBlPVwiaWNlY2FuZGlkYXRlXCI7cmV0dXJuIGN9ZChiLGEpO09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcImNhbmRpZGF0ZVwiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jYW5kaWRhdGVffSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO2IucHJvdG90eXBlLnN5bmNCYXJyaWVyPWZ1bmN0aW9uKCl7dmFyIGE9dGhpcztoLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc3luY0JhcnJpZXIoKSBjYWxsZWQuXCIpO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihiLFxuYyl7YS53YWl0VW50aWxDb25uZWN0ZWQoYS51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc3luY0JhcnJpZXJcIikudGhlbihmdW5jdGlvbigpe3JldHVybiBhLnJlbW90ZUludm9rZSghMSx0Lm1ldGhvZF9pZF9SVENJY2VDYW5kaWRhdGVFdmVudF90LmNhbmRpZGF0ZSx7b2lkOjB9KX0pLnRoZW4oZnVuY3Rpb24oYil7Yj1hLnBhcmFtMChiKTtyZXR1cm4hMT09PWIuaXNfbnVsbD8obmV3IHguSWNlQ2FuZGlkYXRlKGEsYi5vaWQsay5Qcm94eU1vZGUuUmVtb3RlKSkuc3luY0JhcnJpZXIoKTpQcm9taXNlLnJlc29sdmUobnVsbCl9KS50aGVuKGZ1bmN0aW9uKGMpe2gubG9nZ2VyLmxvZyhhLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5vbmljZWNhbmRpZGF0ZTogaWNlY2FuZGlkYXRlIGF2YWlsYWJsZSFcIik7YS5jYW5kaWRhdGVfPWM7YihhKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYil7Yj1hLmxvZ1JlbW90ZUludm9rZUVycm9yKGIsXCIub25pY2VjYW5kaWRhdGUoKSBmYWlsZWQhXCIpO2MoYil9KX0pfTtcbnJldHVybiBifShrLlByb3h5T2JqZWN0KTthLkljZUNhbmRpZGF0ZUV2ZW50PUU7dmFyIHU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBhKGIpe3RoaXMuc3RhdGVfPVwibmV3XCI7dGhpcy5jYW5kaWRhdGVzXz1bXTt0aGlzLnBjXz1ifWEucHJvdG90eXBlLnB1c2hTdGF0ZT1mdW5jdGlvbihhKXtoLmxvZ2dlci5sb2codGhpcy5wY18udXNlcl9mcmllbmRseV9pZCgpK1wiLm9uaWNlZ2F0aGVyaW5nc3RhdGVjaGFuZ2U6IG5ldyBzdGF0ZSBpcyBcIithKTt0aGlzLnN0YXRlXz1hO1wiZ2F0aGVyaW5nXCI9PXRoaXMuc3RhdGVfPyh0aGlzLmNhbmRpZGF0ZXNfPVtdLHRoaXMucG9zdFVwZGF0ZSgpKTp0aGlzLnByb2Nlc3NSZW1haW5pbmcoKX07YS5wcm90b3R5cGUuYWRkSWNlQ2FuZGlkYXRlPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXM7dGhpcy5jYW5kaWRhdGVzXy5wdXNoKGEpO2Euc3luY0JhcnJpZXIoKS50aGVuKGZ1bmN0aW9uKGEpe2gubG9nZ2VyLmxvZyhiLnBjXy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIub25pY2VjYW5kaWRhdGU6IGljZWNhbmRpZGF0ZSBhdmFpbGFibGUhXCIpO1xucmV0dXJuIFByb21pc2UuYWxsKFtiLnBjXy51cGRhdGVTZHBEZXNjcmlwdGlvbighMCksUHJvbWlzZS5yZXNvbHZlKGEpXSl9KS50aGVuKGZ1bmN0aW9uKGEpe2IucG9zdEljZUNhbmRpZGF0ZShhWzFdKX0pfTthLnByb3RvdHlwZS5wb3N0SWNlQ2FuZGlkYXRlPWZ1bmN0aW9uKGEpe2gubG9nZ2VyLmxvZyh0aGlzLnBjXy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIub25pY2VjYW5kaWRhdGU6IHBvc3RpbmcgaWNlIGNhbmRpZGF0ZSBub3chXCIpO2lmKG51bGwhPXRoaXMucGNfLm9uaWNlY2FuZGlkYXRlKXRoaXMucGNfLm9uaWNlY2FuZGlkYXRlKGEpO2Vsc2UgaC5sb2dnZXIubG9nKHRoaXMucGNfLnVzZXJfZnJpZW5kbHlfaWQoKStcIm9uaWNlY2FuZGlkYXRlIGlzIE5VTEwhISFcIik7dGhpcy5jYW5kaWRhdGVzXy5zaGlmdCgpO3RoaXMucHJvY2Vzc1JlbWFpbmluZygpfTthLnByb3RvdHlwZS5wb3N0VXBkYXRlPWZ1bmN0aW9uKCl7aC5sb2dnZXIubG9nKHRoaXMucGNfLnVzZXJfZnJpZW5kbHlfaWQoKStcblwiLm9uaWNlZ2F0aGVyaW5nc3RhdGVjaGFuZ2U6IHBvc3RpbmcgZXZlbnQgbm93IVwiKTt2YXIgYT1uZXcgeihcIm9uaWNlZ2F0aGVyaW5nc3RhdGVjaGFuZ2VcIix0aGlzLnBjXyk7dGhpcy5wY18ub25pY2VnYXRoZXJpbmdzdGF0ZWNoYW5nZShhKX07YS5wcm90b3R5cGUucHJvY2Vzc1JlbWFpbmluZz1mdW5jdGlvbigpezA9PXRoaXMuY2FuZGlkYXRlc18ubGVuZ3RoJiZcImNvbXBsZXRlXCI9PXRoaXMuc3RhdGVfPyh0aGlzLnBjXy5vbmljZWNhbmRpZGF0ZSh7Y2FuZGlkYXRlOm51bGwsdGFyZ2V0OnRoaXN9KSx0aGlzLnBvc3RVcGRhdGUoKSk6aC5sb2dnZXIubG9nKHRoaXMucGNfLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5vbmljZWNhbmRpZGF0ZTogY2FuZGlkYXRlcyByZW1haW5pbmc9W1wiK3RoaXMuY2FuZGlkYXRlc18ubWFwKGZ1bmN0aW9uKGEpe3JldHVybiBhLm9iamVjdF9pZCgpfSkrXCJdLCBzdGF0ZT1cIit0aGlzLnN0YXRlXyl9O3JldHVybiBhfSgpLHE9ZnVuY3Rpb24oKXtyZXR1cm4gZnVuY3Rpb24oYSxcbmIpe3RoaXMuc2RwPWI7dGhpcy50eXBlPWF9fSgpO2EuU2Vzc2lvbkRlc2NyaXB0aW9uSW5pdD1xO3ZhciB3PWZ1bmN0aW9uKGEpe2Z1bmN0aW9uIGIoYyxxLGQpe2Zvcih2YXIgdz1bXSxoPTM7aDxhcmd1bWVudHMubGVuZ3RoO2grKyl3W2gtM109YXJndW1lbnRzW2hdO3JldHVybiBhLmFwcGx5KHRoaXMsbihbYyx0LmNsYXNzX2lkX3QuUlRDU2Vzc2lvbkRlc2NyaXB0aW9uLHEsZCxudWxsXSx3KSl8fHRoaXN9ZChiLGEpO2IucHJvdG90eXBlLnRvSlNPTj1mdW5jdGlvbigpe3JldHVybnt0eXBlOnRoaXMudHlwZV8sc2RwOnRoaXMuc2RwX319O09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcInNkcFwiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zZHBffSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcInR5cGVcIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMudHlwZV99LGVudW1lcmFibGU6ITAsXG5jb25maWd1cmFibGU6ITB9KTtiLnByb3RvdHlwZS5zeW5jQmFycmllcj1mdW5jdGlvbigpe3ZhciBhPXRoaXM7aC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLnN5bmNCYXJyaWVyKCkgY2FsbGVkLlwiKTtyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24oYixjKXthLndhaXRVbnRpbENvbm5lY3RlZChhLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zeW5jQmFycmllclwiKS50aGVuKGZ1bmN0aW9uKCl7cmV0dXJuIFByb21pc2UuYWxsKFthLnJlbW90ZUludm9rZSghMSx0Lm1ldGhvZF9pZF9SVENTZXNzaW9uRGVzY3JpcHRpb25fdC50eXBlLDApLGEucmVtb3RlSW52b2tlKCExLHQubWV0aG9kX2lkX1JUQ1Nlc3Npb25EZXNjcmlwdGlvbl90LnNkcCxcIlwiKV0pfSkudGhlbihmdW5jdGlvbihjKXthLnR5cGVfPWEuY29udmVydFR5cGUoYS5wYXJhbTAoY1swXSkpO2Euc2RwXz1hLnBhcmFtMChjWzFdKTtiKGEpfSlbXCJjYXRjaFwiXShmdW5jdGlvbihiKXtiPWEubG9nUmVtb3RlSW52b2tlRXJyb3IoYixcblwiLnN5bmNCYXJyaWVyKCkgZmFpbGVkIVwiKTtjKGIpfSl9KX07Yi5wcm90b3R5cGUuY29udmVydFR5cGU9ZnVuY3Rpb24oYSl7cmV0dXJuIDA9PWE/XCJvZmZlclwiOjE9PWE/XCJwcmFuc3dlclwiOjI9PWE/XCJhbnN3ZXJcIjpcInJvbGxiYWNrXCJ9O2IuY29udmVydEMySD1mdW5jdGlvbihhKXtyZXR1cm5cIm9mZmVyXCI9PWE/MDpcInByYW5zd2VyXCI9PWE/MTpcImFuc3dlclwiPT1hPzI6M307cmV0dXJuIGJ9KGsuUHJveHlPYmplY3QpO2EuU2Vzc2lvbkRlc2NyaXB0aW9uPXc7dmFyIHo9ZnVuY3Rpb24oKXtyZXR1cm4gZnVuY3Rpb24oYSxiKXt0aGlzLnR5cGU9YTt0aGlzLnRhcmdldD1ifX0oKSxDPWZ1bmN0aW9uKCl7cmV0dXJuIGZ1bmN0aW9uKCl7fX0oKSxGPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gYShiLGMpe3RoaXMubG9jYWw9Yjt0aGlzLnJlbW90ZT1jfU9iamVjdC5kZWZpbmVQcm9wZXJ0eShhLnByb3RvdHlwZSxcImFjdGl2ZVwiLHtnZXQ6ZnVuY3Rpb24oKXt2YXIgYT0hMTtpZigxPT10aGlzLmxvY2FsfHxcbjE9PXRoaXMucmVtb3RlKWE9ITA7cmV0dXJuIGF9LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7cmV0dXJuIGF9KCk7Yj1mdW5jdGlvbihhKXtmdW5jdGlvbiBiKGMpe3ZhciBxPWEuY2FsbCh0aGlzLG51bGwsdC5jbGFzc19pZF90LlJUQ1BlZXJDb25uZWN0aW9uLDAsay5Qcm94eU1vZGUuTG9jYWwsbnVsbCx2b2lkIDAhPWM/Yzp7fSx7fSl8fHRoaXM7cS50aW1lZXJzdGFydGVkXz0hMTtxLmZpcnN0dGltZXJlbW90ZW9mZmVyXz0hMTtxLmZpcnN0c3RhYmxlXz0hMTtxLmZpcnN0dGltZWxvY2Fsb2ZmZXJfPSExO3EuYXVkaW9jYWxsXz1uZXcgRighMSwhMSk7cS52aWRlb2NhbGxfPW5ldyBGKCExLCExKTtxLnNjcmVlbnNoYXJpbmdjYWxsXz1uZXcgRighMSwhMSk7cS5jb25mZXJlbmNlY2FsbF89ITE7cS5pbmNvbWluZ2NhbGxfPSExO3Eub3V0Z29pbmdjYWxsXz0hMTtjJiZjLnNkcFNlbWFudGljcyYmKHEuc2RwU2VtYW50aWNzXz1jLnNkcFNlbWFudGljcyk7aC5sb2dnZXIubG9nKHEudXNlcl9mcmllbmRseV9pZCgpK1xuXCIuY29uc3RydWN0b3Igc2RwU2VtYW50aWNzPVwiK3Euc2RwU2VtYW50aWNzXyk7aWYoIXQuQlVJTERfVFlQRV9TREsmJnEuaXNVbmlmaWVkKCkmJiFnLmdldFJlZGlyZWN0b3IoKS5nZXRGZWF0dXJlVmFsdWUodC5GRUFUVVJFX21zX3RlYW1zX3dlYnJ0Y18xZG90MCkpdGhyb3cgbmV3IERPTUV4Y2VwdGlvbihcIkNXQSBjbGllbnQgZG9lcyBub3Qgc3VwcG9ydCB1bmlmaWVkIHNkcFNlbWFudGljXCIsXCJjcmVhdGVQZWVyQ29ubmVjdGlvblwiKTtxLnBlbmRpbmd0cmFuc2NlaXZlcl89ITE7cS5kZWZlcnJlZE9mZmVyQW5zd2Vycz1bXTtxLmxvY2FsU3RyZWFtcz1bXTtxLnJlbW90ZVN0cmVhbXM9W107cS5vbmFkZHN0cmVhbV89bnVsbDtxLnNpZ25hbGluZ1N0YXRlXz1cInN0YWJsZVwiO3EuaWNlQ29ubmVjdGlvblN0YXRlXz1cIm5ld1wiO3EuaWNlR2F0aGVyaW5nU3RhdGVfPVwibmV3XCI7cS5pY2VRXz1uZXcgdShxKTtxLnJlY2VpdmVyc189W107cS5zZW5kZXJzXz1bXTtxLnRyYW5zY2VpdmVyc189XG5bXTtxLnJlZ2lzdGVyU3RhdGVDaGFuZ2VOb3RpZmljYXRpb24ocS5vblN0YXRlQ2hhbmdlKTtxLmxvY2FsZGF0YWNoYW5uZWxfPW51bGw7cS5yZW1vdGVkYXRhY2hhbm5lbF89bnVsbDtyZXR1cm4gcX1kKGIsYSk7Yi5wcm90b3R5cGUuZHVtcFNkcD1mdW5jdGlvbihhKXtoLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZHVtcFNkcFwiKTthJiYoaC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiICAtLSB0eXBlOiBcIithLnR5cGUpLGgubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIiAgLS0gc2RwOiBcIithLnNkcCkpfTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYi5wcm90b3R5cGUsXCJsb2NhbERlc2NyaXB0aW9uXCIse2dldDpmdW5jdGlvbigpe2gubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5nZXRfbG9jYWxEZXNjcmlwdGlvbigpIGNhbGxlZC5cIik7cmV0dXJuIHRoaXMubG9jYWxEZXNjcmlwdGlvbl99LHNldDpmdW5jdGlvbihhKXtoLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXG5cIi5zZXRfbG9jYWxEZXNjcmlwdGlvbigpIGNhbGxlZC5cIik7dGhpcy5sb2NhbERlc2NyaXB0aW9uXz1hfSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcInJlbW90ZURlc2NyaXB0aW9uXCIse2dldDpmdW5jdGlvbigpe2gubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5nZXRfcmVtb3RlRGVzY3JpcHRpb24oKSBjYWxsZWQuXCIpO3JldHVybiB0aGlzLnJlbW90ZURlc2NyaXB0aW9uX30sc2V0OmZ1bmN0aW9uKGEpe2gubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5nZXRfcmVtb3RlRGVzY3JpcHRpb24oKSBjYWxsZWQuXCIpO3RoaXMucmVtb3RlRGVzY3JpcHRpb25fPWF9LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7Yi5wcm90b3R5cGUuaXNVbmlmaWVkPWZ1bmN0aW9uKCl7cmV0dXJuXCJ1bmlmaWVkXCI9PXRoaXMuc2RwU2VtYW50aWNzX3x8XCJ1bmlmaWVkLXBsYW5cIj09XG50aGlzLnNkcFNlbWFudGljc199O2IucHJvdG90eXBlLm9uU3RhdGVDaGFuZ2U9ZnVuY3Rpb24oKXt2YXIgYT1uZXcgeihcImljZWNvbm5lY3Rpb25zdGF0ZWNoYW5nZVwiLHRoaXMpO2lmKHRoaXMub25pY2Vjb25uZWN0aW9uc3RhdGVjaGFuZ2VfKXRoaXMub25pY2Vjb25uZWN0aW9uc3RhdGVjaGFuZ2VfKGEpfTtiLnByb3RvdHlwZS5hZGRJY2VDYW5kaWRhdGU9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcztoLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuYWRkSWNlQ2FuZGlkYXRlKCkgY2FsbGVkLlwiKTt0aGlzLndhaXRVbnRpbENvbm5lY3RlZCh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5hZGRJY2VDYW5kaWRhdGVcIikudGhlbihmdW5jdGlvbigpe3ZhciBjPXtjYW5kaWRhdGU6YS5jYW5kaWRhdGUsc2RwTWlkOmEuc2RwTWlkLHNkcE1MaW5lSW5kZXg6YS5zZHBNTGluZUluZGV4fTtpZih2b2lkIDA9PWMuY2FuZGlkYXRlfHxudWxsPT1jLmNhbmRpZGF0ZSljLmNhbmRpZGF0ZT1cblwiXCI7dm9pZCAwPT1jLnNkcE1pZCYmKGMuc2RwTWlkPW51bGwpO3ZvaWQgMD09Yy5zZHBNTGluZUluZGV4JiYoYy5zZHBNTGluZUluZGV4PW51bGwpO3JldHVybihuZXcgeC5JY2VDYW5kaWRhdGUoYiwwLGsuUHJveHlNb2RlLkxvY2FsLGMpKS5zeW5jQmFycmllcigpfSkudGhlbihmdW5jdGlvbihhKXtyZXR1cm4gYi5yZW1vdGVJbnZva2UoITEsdC5tZXRob2RfaWRfUlRDUGVlckNvbm5lY3Rpb25fdC5hZGRJY2VDYW5kaWRhdGUse29pZDphLm9iamVjdF9pZCgpfSx7fSl9KS50aGVuKGZ1bmN0aW9uKCl7aC5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wiLmFkZEljZUNhbmRpZGF0ZSgpIHN1Y2Nlc3MuXCIpO3JldHVybiBiLnVwZGF0ZVNkcERlc2NyaXB0aW9uKCExKX0pLnRoZW4oZnVuY3Rpb24oKXtoLmxvZ2dlci5sb2coYi51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuYWRkSWNlQ2FuZGlkYXRlKCkgLSBzeW5jIHJlbW90ZSBzZHAgc3VjY2Vzcy5cIil9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2IubG9nUmVtb3RlSW52b2tlRXJyb3IoYSxcblwiLmFkZEljZUNhbmRpZGF0ZSgpIGZhaWxlZCFcIil9KX07T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwib25pY2VjYW5kaWRhdGVcIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub25pY2VjYW5kaWRhdGVffSxzZXQ6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcztoLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc2V0X29uaWNlY2FuZGlkYXRlKCkgY2FsbGVkLlwiKTt0aGlzLm9uaWNlY2FuZGlkYXRlXz1hO3RoaXMud2FpdFVudGlsQ29ubmVjdGVkKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLm9uaWNlY2FuZGlkYXRlXCIpLnRoZW4oZnVuY3Rpb24oKXt2YXIgYz1iLnJlZ2lzdGVyQ2FsbGJhY2tzKCExLGIuaXNOdWxsQ2FsbGJhY2soYSksdC5tZXRob2RfaWRfUlRDUGVlckNvbm5lY3Rpb25fdC5vbmljZWNhbmRpZGF0ZSk7Yy50aGVuKGZ1bmN0aW9uKGEpe2gubG9nZ2VyLmxvZyhiLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5vbmljZWNhbmRpZGF0ZSBjYWxsYmFjayByZWNlaXZlZCEhIVwiKTtcbmE9bmV3IEUoYixiLnBhcmFtMChhKS5vaWQsYik7bnVsbCE9Yi5pY2VRXyYmYi5pY2VRXy5hZGRJY2VDYW5kaWRhdGUoYSl9KTtyZXR1cm4gYi5yZW1vdGVJbnZva2UoITAsdC5tZXRob2RfaWRfUlRDUGVlckNvbm5lY3Rpb25fdC5vbmljZWNhbmRpZGF0ZSxjLnN1Y2Nlc3MpfSlbXCJjYXRjaFwiXShmdW5jdGlvbihhKXtiLmxvZ1JlbW90ZUludm9rZUVycm9yKGEsXCIuc2V0X29uaWNlY2FuZGlkYXRlKCkgZmFpbGVkIVwiKX0pfSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO2IucHJvdG90eXBlLmNvbnZlcnRJY2VDb25uZWN0aW9uU3RhdGU9ZnVuY3Rpb24oYSl7cmV0dXJuIDA9PWE/XCJuZXdcIjoxPT1hP1wiY2hlY2tpbmdcIjoyPT1hP1wiY29ubmVjdGVkXCI6Mz09YT9cImNvbXBsZXRlZFwiOjQ9PWE/XCJmYWlsZWRcIjo1PT1hP1wiZGlzY29ubmVjdGVkXCI6XCJjbG9zZWRcIn07Yi5wcm90b3R5cGUuY29udmVydENvbm5lY3Rpb25TdGF0ZT1mdW5jdGlvbihhKXtpZigwIT1hKXtpZigxPT1hKXJldHVyblwiY29ubmVjdGluZ1wiO1xuaWYoMj09YSlyZXR1cm5cImNvbm5lY3RlZFwiO2lmKDM9PWEpcmV0dXJuXCJkaXNjb25uZWN0ZWRcIjtpZig0PT1hKXJldHVyblwiZmFpbGVkXCI7aWYoNT09YSlyZXR1cm5cImNsb3NlZFwifXJldHVyblwibmV3XCJ9O09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcIm9uY29ubmVjdGlvbnN0YXRlY2hhbmdlXCIse2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm9uY29ubmVjdGlvbnN0YXRlY2hhbmdlX30sc2V0OmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXM7aC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLnNldF9vbmNvbm5lY3Rpb25zdGF0ZWNoYW5nZSgpIGNhbGxlZC5cIik7dGhpcy5vbmNvbm5lY3Rpb25zdGF0ZWNoYW5nZV89YTt0aGlzLndhaXRVbnRpbENvbm5lY3RlZCh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5vbmNvbm5lY3Rpb25zdGF0ZWNoYW5nZVwiKS50aGVuKGZ1bmN0aW9uKCl7dmFyIGM9Yi5yZWdpc3RlckNhbGxiYWNrcyghMSxiLmlzTnVsbENhbGxiYWNrKGEpLFxudC5tZXRob2RfaWRfUlRDUGVlckNvbm5lY3Rpb25fdC5vbmNvbm5lY3Rpb25zdGF0ZWNoYW5nZSk7Yy50aGVuKGZ1bmN0aW9uKGEpe2gubG9nZ2VyLmxvZyhiLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5vbmNvbm5lY3Rpb25zdGF0ZWNoYW5nZSgpOiBzdWNjZXNzIGNhbGxiYWNrIHJlY2VpdmVkISEhXCIpO2IuY29ubmVjdGlvblN0YXRlXz1iLmNvbnZlcnRDb25uZWN0aW9uU3RhdGUoYi5wYXJhbTAoYSkpO2gubG9nZ2VyLmxvZyhiLnVzZXJfZnJpZW5kbHlfaWQoKStcIiBjb25uZWN0aW9uU3RhdGU9OlwiK2IuY29ubmVjdGlvblN0YXRlXyk7YT1uZXcgeihcImNvbm5lY3Rpb25zdGF0ZWNoYW5nZVwiLGIpO2Iub25jb25uZWN0aW9uc3RhdGVjaGFuZ2VfKGEpfSk7cmV0dXJuIGIucmVtb3RlSW52b2tlKCEwLHQubWV0aG9kX2lkX1JUQ1BlZXJDb25uZWN0aW9uX3Qub25jb25uZWN0aW9uc3RhdGVjaGFuZ2UsYy5zdWNjZXNzKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYSl7Yi5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFxuXCIuc2V0X29uY29ubmVjdGlvbnN0YXRlY2hhbmdlKCkgZmFpbGVkIVwiKX0pfSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO2IucHJvdG90eXBlLmdldF9jb25uZWN0aW9uU3RhdGU9ZnVuY3Rpb24oKXtoLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0X2Nvbm5lY3Rpb25TdGF0ZSgpIGNhbGxlZCwgdmFsdWUgPSBcIit0aGlzLmNvbm5lY3Rpb25TdGF0ZV8pO3JldHVybiB0aGlzLmlzUmVkaXJlY3RlZCgpP3RoaXMuY29ubmVjdGlvblN0YXRlXzpcImZhaWxlZFwifTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYi5wcm90b3R5cGUsXCJvbmljZWNvbm5lY3Rpb25zdGF0ZWNoYW5nZVwiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vbmljZWNvbm5lY3Rpb25zdGF0ZWNoYW5nZV99LHNldDpmdW5jdGlvbihhKXt2YXIgYj10aGlzO2gubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRfb25pY2Vjb25uZWN0aW9uc3RhdGVjaGFuZ2UoKSBjYWxsZWQuXCIpO1xudGhpcy5vbmljZWNvbm5lY3Rpb25zdGF0ZWNoYW5nZV89YTt0aGlzLndhaXRVbnRpbENvbm5lY3RlZCh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5vbmljZWNvbm5lY3Rpb25zdGF0ZWNoYW5nZVwiKS50aGVuKGZ1bmN0aW9uKCl7dmFyIGM9Yi5yZWdpc3RlckNhbGxiYWNrcyghMSxiLmlzTnVsbENhbGxiYWNrKGEpLHQubWV0aG9kX2lkX1JUQ1BlZXJDb25uZWN0aW9uX3Qub25pY2Vjb25uZWN0aW9uc3RhdGVjaGFuZ2UpO2MudGhlbihmdW5jdGlvbihhKXtoLmxvZ2dlci5sb2coYi51c2VyX2ZyaWVuZGx5X2lkKCkrXCIub25pY2Vjb25uZWN0aW9uc3RhdGVjaGFuZ2UoKTogc3VjY2VzcyBjYWxsYmFjayByZWNlaXZlZCEhIVwiKTtiLmljZUNvbm5lY3Rpb25TdGF0ZV89Yi5jb252ZXJ0SWNlQ29ubmVjdGlvblN0YXRlKGIucGFyYW0wKGEpKTthPW5ldyB6KFwiaWNlY29ubmVjdGlvbnN0YXRlY2hhbmdlXCIsYik7Yi5vbmljZWNvbm5lY3Rpb25zdGF0ZWNoYW5nZV8oYSl9KTtyZXR1cm4gYi5yZW1vdGVJbnZva2UoITAsXG50Lm1ldGhvZF9pZF9SVENQZWVyQ29ubmVjdGlvbl90Lm9uaWNlY29ubmVjdGlvbnN0YXRlY2hhbmdlLGMuc3VjY2Vzcyl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2IubG9nUmVtb3RlSW52b2tlRXJyb3IoYSxcIi5zZXRfb25pY2Vjb25uZWN0aW9uc3RhdGVjaGFuZ2UoKSBmYWlsZWQhXCIpfSl9LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwiaWNlQ29ubmVjdGlvblN0YXRlXCIse2dldDpmdW5jdGlvbigpe2gubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5nZXRfaWNlQ29ubmVjdGlvblN0YXRlKCkgY2FsbGVkLCB2YWx1ZSA9IFwiK3RoaXMuaWNlQ29ubmVjdGlvblN0YXRlXyk7cmV0dXJuIHRoaXMuaXNSZWRpcmVjdGVkKCk/dGhpcy5pY2VDb25uZWN0aW9uU3RhdGVfOlwiZmFpbGVkXCJ9LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7Yi5wcm90b3R5cGUuY29udmVydEljZUdhdGhlcmluZ1N0YXRlPVxuZnVuY3Rpb24oYSl7cmV0dXJuIDA9PWE/XCJuZXdcIjoxPT1hP1wiZ2F0aGVyaW5nXCI6XCJjb21wbGV0ZVwifTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYi5wcm90b3R5cGUsXCJvbmljZWdhdGhlcmluZ3N0YXRlY2hhbmdlXCIse2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm9uaWNlZ2F0aGVyaW5nc3RhdGVjaGFuZ2VffSxzZXQ6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcztoLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc2V0X29uaWNlZ2F0aGVyaW5nc3RhdGVjaGFuZ2UoKSBjYWxsZWQuXCIpO3RoaXMub25pY2VnYXRoZXJpbmdzdGF0ZWNoYW5nZV89YTt0aGlzLndhaXRVbnRpbENvbm5lY3RlZCh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5vbmljZWdhdGhlcmluZ3N0YXRlY2hhbmdlXCIpLnRoZW4oZnVuY3Rpb24oKXt2YXIgYz1iLnJlZ2lzdGVyQ2FsbGJhY2tzKCExLGIuaXNOdWxsQ2FsbGJhY2soYSksdC5tZXRob2RfaWRfUlRDUGVlckNvbm5lY3Rpb25fdC5vbmljZWdhdGhlcmluZ3N0YXRlY2hhbmdlKTtcbmMudGhlbihmdW5jdGlvbihhKXtoLmxvZ2dlci5sb2coYi51c2VyX2ZyaWVuZGx5X2lkKCkrXCIub25pY2VnYXRoZXJpbmdzdGF0ZWNoYW5nZSgpOiBjYWxsYmFjayByZWNlaXZlZCEhIVwiKTtiLmljZUdhdGhlcmluZ1N0YXRlXz1iLmNvbnZlcnRJY2VHYXRoZXJpbmdTdGF0ZShiLnBhcmFtMChhKSk7bnVsbCE9Yi5pY2VRXyYmYi5pY2VRXy5wdXNoU3RhdGUoYi5pY2VHYXRoZXJpbmdTdGF0ZV8pfSk7cmV0dXJuIGIucmVtb3RlSW52b2tlKCEwLHQubWV0aG9kX2lkX1JUQ1BlZXJDb25uZWN0aW9uX3Qub25pY2VnYXRoZXJpbmdzdGF0ZWNoYW5nZSxjLnN1Y2Nlc3MpfSlbXCJjYXRjaFwiXShmdW5jdGlvbihhKXtiLmxvZ1JlbW90ZUludm9rZUVycm9yKGEsXCIuc2V0X29uaWNlZ2F0aGVyaW5nc3RhdGVjaGFuZ2UoKSBmYWlsZWQhXCIpfSl9LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwiaWNlR2F0aGVyaW5nU3RhdGVcIix7Z2V0OmZ1bmN0aW9uKCl7aC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1xuXCIuZ2V0X2ljZUdhdGhlcmluZ1N0YXRlKCkgY2FsbGVkLCB2YWx1ZSA9IFwiK3RoaXMuaWNlR2F0aGVyaW5nU3RhdGVfKTtyZXR1cm4gdGhpcy5pY2VHYXRoZXJpbmdTdGF0ZV99LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7Yi5wcm90b3R5cGUuY29udmVydFNpZ25hbFN0YXRlPWZ1bmN0aW9uKGEpe3JldHVybiAwPT1hP1wic3RhYmxlXCI6MT09YT9cImhhdmUtbG9jYWwtb2ZmZXJcIjoyPT1hP1wiaGF2ZS1sb2NhbC1wcmFuc3dlclwiOjM9PWE/XCJoYXZlLXJlbW90ZS1vZmZlclwiOjQ9PWE/XCJoYXZlLXJlbW90ZS1wcmFuc3dlclwiOlwiY2xvc2VkXCJ9O2IucHJvdG90eXBlLlRlbGVtdHJ5UmVhZGluZ3NfPWZ1bmN0aW9uKCl7XCJoYXZlLWxvY2FsLW9mZmVyXCI9PXRoaXMuc2lnbmFsaW5nU3RhdGVfJiYwPT10aGlzLmZpcnN0dGltZWxvY2Fsb2ZmZXJfJiYwPT10aGlzLmZpcnN0dGltZXJlbW90ZW9mZmVyXyYmKHRoaXMub3V0Z29pbmdjYWxsc3RhcnRfPShuZXcgRGF0ZSkuZ2V0VGltZSgpLFxuMD09dGhpcy5vdXRnb2luZ2NhbGxfJiYodGhpcy5TZW5kVGVsZW1ldHJ5RGF0YSh5LnRlbF9rZXlfUGVyZkNhbGxTdGF0ZSx5LnRlbF9DYWxsU3RhdGUuYWN0aXZlLDEpLHRoaXMuU2VuZFRlbGVtZXRyeURhdGEoeS50ZWxfa2V5X1BlcmZDYWxsRGlyZWN0aW9uLHkudGVsX0NhbGxEaXJlY3Rpb24ub3V0Z29pbmcsMSksdGhpcy5vdXRnb2luZ2NhbGxfPSEwKSx0aGlzLmZpcnN0dGltZWxvY2Fsb2ZmZXJfPSEwKTtcImhhdmUtcmVtb3RlLW9mZmVyXCI9PXRoaXMuc2lnbmFsaW5nU3RhdGVfJiYwPT10aGlzLmZpcnN0dGltZXJlbW90ZW9mZmVyXyYmMD09dGhpcy5maXJzdHRpbWVsb2NhbG9mZmVyXyYmKHRoaXMuaW5jb21pbmdjYWxsc3RhcnRfPShuZXcgRGF0ZSkuZ2V0VGltZSgpLDA9PXRoaXMuaW5jb21pbmdjYWxsXyYmKHRoaXMuU2VuZFRlbGVtZXRyeURhdGEoeS50ZWxfa2V5X1BlcmZDYWxsU3RhdGUseS50ZWxfQ2FsbFN0YXRlLmFjdGl2ZSwxKSx0aGlzLlNlbmRUZWxlbWV0cnlEYXRhKHkudGVsX2tleV9QZXJmQ2FsbERpcmVjdGlvbixcbnkudGVsX0NhbGxEaXJlY3Rpb24uaW5jb21pbmcsMSksdGhpcy5pbmNvbWluZ2NhbGxfPSEwKSx0aGlzLmZpcnN0dGltZXJlbW90ZW9mZmVyXz0hMCk7XCJzdGFibGVcIj09dGhpcy5zaWduYWxpbmdTdGF0ZV8mJjA9PXRoaXMuZmlyc3RzdGFibGVfJiYodGhpcy5jYWxsc3RhcnRUaW1lXz0obmV3IERhdGUpLmdldFRpbWUoKSx0aGlzLmZpcnN0c3RhYmxlXz10aGlzLnRpbWVlcnN0YXJ0ZWRfPSEwKTtpZihcInN0YWJsZVwiPT10aGlzLnNpZ25hbGluZ1N0YXRlXyl7Zm9yKHZhciBhPTAsYj10aGlzLmxvY2FsU3RyZWFtczthPGIubGVuZ3RoO2ErKyl7dmFyIGM9YlthXTsxPD1jLmdldEF1ZGlvVHJhY2tzKCkubGVuZ3RoJiYwPT10aGlzLmF1ZGlvY2FsbF8ubG9jYWwmJih0aGlzLlNlbmRUZWxlbWV0cnlEYXRhKHkudGVsX2tleV9QZXJmQ2FsbFR5cGUseS50ZWxfQ2FsbFR5cGUuYXVkaW8sMSksdGhpcy5hdWRpb2NhbGxfLmxvY2FsPSEwKTtjPWMuZ2V0VmlkZW9UcmFja3MoKTtpZigxPD1jLmxlbmd0aClmb3IodmFyIGw9XG4wLHE9YztsPHEubGVuZ3RoO2wrKyljPXFbbF0sMT09Yy5nZXRTZXR0aW5ncygpLmRldmljZUlkLmluY2x1ZGVzKFwiZGlzcGxheVwiKT8wPT10aGlzLnNjcmVlbnNoYXJpbmdjYWxsXy5sb2NhbCYmKHRoaXMuU2VuZFRlbGVtZXRyeURhdGEoeS50ZWxfa2V5X1BlcmZDYWxsVHlwZSx5LnRlbF9DYWxsVHlwZS5kc2hhcmUsMSksdGhpcy5zY3JlZW5zaGFyaW5nY2FsbF8ubG9jYWw9ITApOjA9PXRoaXMudmlkZW9jYWxsXy5sb2NhbCYmKHRoaXMuU2VuZFRlbGVtZXRyeURhdGEoeS50ZWxfa2V5X1BlcmZDYWxsVHlwZSx5LnRlbF9DYWxsVHlwZS52aWRlbywxKSx0aGlzLnZpZGVvY2FsbF8ubG9jYWw9ITApfWE9MDtmb3IoYj10aGlzLnJlbW90ZVN0cmVhbXM7YTxiLmxlbmd0aDthKyspaWYoYz1iW2FdLDE8PWMuZ2V0QXVkaW9UcmFja3MoKS5sZW5ndGgmJjA9PXRoaXMuYXVkaW9jYWxsXy5yZW1vdGUmJih0aGlzLlNlbmRUZWxlbWV0cnlEYXRhKHkudGVsX2tleV9QZXJmQ2FsbFR5cGUseS50ZWxfQ2FsbFR5cGUuYXVkaW8sXG4xKSx0aGlzLmF1ZGlvY2FsbF8ucmVtb3RlPSEwKSxsPWMuZ2V0VmlkZW9UcmFja3MoKSwxPD1sLmxlbmd0aClmb3IoYz0wO2M8bC5sZW5ndGg7YysrKTE9PWxbY10uaWQuaW5jbHVkZXMoXCJhcHBsaWNhdGlvbnNoYXJpbmdWaWRlb1wiKT8wPT10aGlzLnNjcmVlbnNoYXJpbmdjYWxsXy5yZW1vdGUmJih0aGlzLlNlbmRUZWxlbWV0cnlEYXRhKHkudGVsX2tleV9QZXJmQ2FsbFR5cGUseS50ZWxfQ2FsbFR5cGUuZHNoYXJlLDEpLHRoaXMuc2NyZWVuc2hhcmluZ2NhbGxfLnJlbW90ZT0hMCk6MD09dGhpcy52aWRlb2NhbGxfLnJlbW90ZSYmKHRoaXMuU2VuZFRlbGVtZXRyeURhdGEoeS50ZWxfa2V5X1BlcmZDYWxsVHlwZSx5LnRlbF9DYWxsVHlwZS52aWRlbywxKSx0aGlzLnZpZGVvY2FsbF8ucmVtb3RlPSEwKTsyPHRoaXMuZ2V0UmVjZWl2ZXJzKCkubGVuZ3RoJiYwPT10aGlzLmNvbmZlcmVuY2VjYWxsXyYmKHRoaXMuU2VuZFRlbGVtZXRyeURhdGEoeS50ZWxfa2V5X1BlcmZDYWxsVHlwZSxcbnkudGVsX0NhbGxUeXBlLm11bHRpLDEpLHRoaXMuY29uZmVyZW5jZWNhbGxfPSEwKX19O09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcIm9uc2lnbmFsaW5nc3RhdGVjaGFuZ2VcIix7c2V0OmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXM7aC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLnNldF9vbnNpZ25hbGluZ3N0YXRlY2hhbmdlKCkgY2FsbGVkLlwiKTt0aGlzLm9uc2lnbmFsaW5nc3RhdGVjaGFuZ2VfPWE7dGhpcy53YWl0VW50aWxDb25uZWN0ZWQodGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIub25zaWduYWxpbmdzdGF0ZWNoYW5nZWRcIikudGhlbihmdW5jdGlvbigpe3ZhciBjPWIucmVnaXN0ZXJDYWxsYmFja3MoITEsYi5pc051bGxDYWxsYmFjayhhKSx0Lm1ldGhvZF9pZF9SVENQZWVyQ29ubmVjdGlvbl90Lm9uc2lnbmFsaW5nc3RhdGVjaGFuZ2UpO2MudGhlbihmdW5jdGlvbihhKXtoLmxvZ2dlci5sb2coYi51c2VyX2ZyaWVuZGx5X2lkKCkrXCIub25zaWduYWxpbmdzdGF0ZWNoYW5nZSgpOiBjYWxsYmFjayByZWNlaXZlZCEhIVwiKTtcbmIuc2lnbmFsaW5nU3RhdGVfPWIuY29udmVydFNpZ25hbFN0YXRlKGIucGFyYW0wKGEpKTthPW5ldyB6KFwib25zaWduYWxpbmdzdGF0ZWNoYW5nZVwiLGIpO2Iub25zaWduYWxpbmdzdGF0ZWNoYW5nZV8oYSk7Yi5UZWxlbXRyeVJlYWRpbmdzXygpfSk7cmV0dXJuIGIucmVtb3RlSW52b2tlKCEwLHQubWV0aG9kX2lkX1JUQ1BlZXJDb25uZWN0aW9uX3Qub25zaWduYWxpbmdzdGF0ZWNoYW5nZSxjLnN1Y2Nlc3MpfSlbXCJjYXRjaFwiXShmdW5jdGlvbihhKXtiLmxvZ1JlbW90ZUludm9rZUVycm9yKGEsXCIuc2V0X29uc2lnbmFsaW5nc3RhdGVjaGFuZ2UoKSBmYWlsZWQhXCIpfSl9LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwib25zaWduYWxpbmdzdGF0ZWNoYW5nZWRcIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub25zaWduYWxpbmdzdGF0ZWNoYW5nZV99LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoYi5wcm90b3R5cGUsXCJvbnRyYWNrXCIse2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm9udHJhY2tffSxzZXQ6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcztoLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc2V0X29udHJhY2soKSBjYWxsZWQuXCIpO3RoaXMub250cmFja189YTt0aGlzLndhaXRVbnRpbENvbm5lY3RlZCh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5vbnRyYWNrXCIpLnRoZW4oZnVuY3Rpb24oKXt2YXIgYz1iLnJlZ2lzdGVyQ2FsbGJhY2tzKCExLGIuaXNOdWxsQ2FsbGJhY2soYSksdC5tZXRob2RfaWRfUlRDUGVlckNvbm5lY3Rpb25fdC5vbnRyYWNrKTtjLnRoZW4oZnVuY3Rpb24oYSl7cmV0dXJuIGUoYix2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKCl7dmFyIGIsYyxsLHEsZCx3LEssSCx1LHQseixnPXRoaXM7cmV0dXJuIHIodGhpcyxmdW5jdGlvbihuKXtoLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXG5cIi5vbnRyYWNrKCk6IGNhbGxiYWNrIHJlY2VpdmVkISEhXCIpO2I9bmV3IEM7Yz1bXTtsPXRoaXMucGFyYW0wKGEpO3ZvaWQgMCE9bC50cmFjayYmITE9PT1sLnRyYWNrLmlzX251bGwmJihoLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIgYWRkaW5nIGEgUmVtb3RlTWVkaWFUcmFjayB3aXRoIG9pZDpcIitsLnRyYWNrLm9pZCkscT1uZXcgcC5SZW1vdGVNZWRpYVRyYWNrKHRoaXMsbC50cmFjay5vaWQpLGMucHVzaChxLnN5bmNCYXJyaWVyKCkpKTtiLnRyYWNrPXE7dm9pZCAwIT1sLnJlY2VpdmVyJiYhMT09PWwucmVjZWl2ZXIuaXNfbnVsbCYmKGQ9dGhpcy5yZWNlaXZlcnNfLmZpbmQoZnVuY3Rpb24oYSl7cmV0dXJuIGEub2JqZWN0X2lkKCk9PT1sLnJlY2VpdmVyLm9pZH0pLHZvaWQgMD09PWQmJihoLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIgYWRkaW5nIGEgUnRwUmVjZWl2ZXIgd2l0aCBvaWQ6XCIrbC5yZWNlaXZlci5vaWQpLGQ9bmV3IGYuUnRwUmVjZWl2ZXIodGhpcyxcbmwucmVjZWl2ZXIub2lkLGsuUHJveHlNb2RlLlJlbW90ZSx0aGlzLmlzVW5pZmllZCgpLHEpKSxjLnB1c2goZC5zeW5jQmFycmllcigpKSk7Yi5yZWNlaXZlcj1kO0QuUmVtb3RlU2Vzc2lvbi5pc0ZlYXR1cmVXZWJydGMxZG90MFN1cHBvcnRlZCgpJiZ2b2lkIDAhPWwudHJhbnNjZWl2ZXImJiExPT09bC50cmFuc2NlaXZlci5pc19udWxsJiYodz10aGlzLnRyYW5zY2VpdmVyc18uZmluZChmdW5jdGlvbihhKXtyZXR1cm4gYS5vYmplY3RfaWQoKT09PWwudHJhbnNjZWl2ZXIub2lkfSksdm9pZCAwPT09dyYmKGgubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIiBhZGRpbmcgYSBSdHBUcmFuc2NlaXZlciB3aXRoIG9pZDpcIitsLnRyYW5zY2VpdmVyLm9pZCksdz1uZXcgbS5SdHBUcmFuc2NlaXZlcih0aGlzLGwudHJhbnNjZWl2ZXIub2lkLGsuUHJveHlNb2RlLlJlbW90ZSx0aGlzLmlzVW5pZmllZCgpLFwiaW5hY3RpdmVcIixkKSx0aGlzLnRyYW5zY2VpdmVyc18ucHVzaCh3KSksXG5jLnB1c2gody5zeW5jQmFycmllcigpKSk7Yi50cmFuc2NlaXZlcj13O2Iuc3RyZWFtcz1bXTtpZih2b2lkIDAhPWwuc3RyZWFtcylmb3IoSz1mdW5jdGlvbihhKXt2YXIgbD1ILnJlbW90ZVN0cmVhbXMuZmluZChmdW5jdGlvbihiKXtyZXR1cm4hMT09PWEuaXNfbnVsbCYmYi5vYmplY3RfaWQoKT09PWEub2lkfSk7dm9pZCAwPT09bCYmKGgubG9nZ2VyLmxvZyhILnVzZXJfZnJpZW5kbHlfaWQoKStcIiBhZGRpbmcgYSBSZW1vdGVTdHJlYW0gd2l0aCBvaWQ6XCIrYS5vaWQpLGw9bmV3IHAuUmVtb3RlU3RyZWFtKEgsYS5vaWQsay5Qcm94eU1vZGUuUmVtb3RlKSxILnJlbW90ZVN0cmVhbXMucHVzaChsKSk7Yy5wdXNoKGwuc3luY0JhcnJpZXIoKSk7Yi5zdHJlYW1zLnB1c2gobCl9LEg9dGhpcyx1PTAsdD1sLnN0cmVhbXM7dTx0Lmxlbmd0aDt1Kyspej10W3VdLEsoeik7aC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLm9udHJhY2soKTogLnByb3Auc3luY0JhcnJpZXIgc3RhcnRcIik7XG5Qcm9taXNlLmFsbChjKS50aGVuKGZ1bmN0aW9uKCl7aC5sb2dnZXIubG9nKGcudXNlcl9mcmllbmRseV9pZCgpK1wiLm9udHJhY2soKTogbm90aWZpZWQhISEgd2l0aCBldnQ6IFwiK2IpO2Zvcih2YXIgYT0wLGM9Yi5zdHJlYW1zO2E8Yy5sZW5ndGg7YSsrKWNbYV0udG9nZ2xlQXVkaW8oITEpO2cub250cmFja18oYil9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2cubG9nUmVtb3RlSW52b2tlRXJyb3IoYSxcIi5vbnRyYWNrKCk6IC5wcm9wLnN5bmNCYXJyaWVyIGZhaWxlZC5cIil9KTtyZXR1cm5bMl19KX0pfSk7cmV0dXJuIGIucmVtb3RlSW52b2tlKCEwLHQubWV0aG9kX2lkX1JUQ1BlZXJDb25uZWN0aW9uX3Qub250cmFjayxjLnN1Y2Nlc3MpfSlbXCJjYXRjaFwiXShmdW5jdGlvbihhKXtiLmxvZ1JlbW90ZUludm9rZUVycm9yKGEsXCIuc2V0X29udHJhY2soKTogZmFpbGVkLlwiKX0pfSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcblwic2lnbmFsaW5nU3RhdGVcIix7Z2V0OmZ1bmN0aW9uKCl7aC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmdldF9zaWduYWxpbmdTdGF0ZSgpIGNhbGxlZCwgdmFsdWUgPSBcIit0aGlzLnNpZ25hbGluZ1N0YXRlXyk7cmV0dXJuIHRoaXMuc2lnbmFsaW5nU3RhdGVffSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcIm9ubmVnb3RpYXRpb25uZWVkZWRcIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub25uZWdvdGlhdGlvbm5lZWRlZF99LHNldDpmdW5jdGlvbihhKXt2YXIgYj10aGlzO2gubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRfb25uZWdvdGlhdGlvbm5lZWRlZCgpIGNhbGxlZC5cIik7dGhpcy5vbm5lZ290aWF0aW9ubmVlZGVkXz1hO3RoaXMud2FpdFVudGlsQ29ubmVjdGVkKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLm9ubmVnb3RpYXRpb25uZWVkZWRcIikudGhlbihmdW5jdGlvbigpe3ZhciBjPVxuYi5yZWdpc3RlckNhbGxiYWNrcyghMSxiLmlzTnVsbENhbGxiYWNrKGEpLHQubWV0aG9kX2lkX1JUQ1BlZXJDb25uZWN0aW9uX3Qub25uZWdvdGlhdGlvbm5lZWRlZCk7Yy50aGVuKGZ1bmN0aW9uKCl7aC5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wiLm9ubmVnb3RpYXRpb25uZWVkZWQoKTogY2FsbGJhY2sgcmVjZWl2ZWQhISFcIik7dmFyIGE9bmV3IHooXCJuZWdvdGlhdGlvbm5lZWRlZFwiLGIpO2Iub25uZWdvdGlhdGlvbm5lZWRlZF8oYSl9KTtyZXR1cm4gYi5yZW1vdGVJbnZva2UoITAsdC5tZXRob2RfaWRfUlRDUGVlckNvbm5lY3Rpb25fdC5vbm5lZ290aWF0aW9ubmVlZGVkLGMuc3VjY2Vzcyl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2IubG9nUmVtb3RlSW52b2tlRXJyb3IoYSxcIi5zZXRfb25uZWdvdGlhdGlvbm5lZWRlZCgpOiBmYWlsZWQuXCIpfSl9LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7Yi5wcm90b3R5cGUuZHVtcENvbnN0cmFpbnRzPWZ1bmN0aW9uKGEpe2gubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcblwiY29uc3RyYWludHM6IFwiK2EpO3ZvaWQgMCE9PWEmJjAhPT1PYmplY3Qua2V5cyhhKS5sZW5ndGh8fGgubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcImNvbnN0cmFpbnRzIGVpdGhlciB1bmRlZmluZWQgb3IgZW1wdHkhXCIpO2EmJihoLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIgIC0tIHZpZGVvOiBcIithLm9mZmVyVG9SZWNlaXZlVmlkZW8pLGgubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIiAgLS0gYXVkaW86IFwiK2Eub2ZmZXJUb1JlY2VpdmVBdWRpbyksaC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiICAtLSBpY2VSZXN0YXJ0OiBcIithLmljZVJlc3RhcnQpLGgubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIiAgLS0gdm9pY2VBY3Rpdml0eURldGVjdGlvbjogXCIrYS52b2ljZUFjdGl2aXR5RGV0ZWN0aW9uKSl9O2IucHJvdG90eXBlLmZpeF9jb25zdHJhaW50cz1mdW5jdGlvbihhKXt0aGlzLmR1bXBDb25zdHJhaW50cyhhKTtcbnZhciBiPXt9O3RoaXMuaXNVbmlmaWVkKCl8fChiPXthdWRpbzohMCx2aWRlbzohMH0pO2EmJih2b2lkIDAhPT1hLnZpZGVvJiYoYi52aWRlbz1hLm9mZmVyVG9SZWNlaXZlVmlkZW8pLHZvaWQgMCE9PWEuYXVkaW8mJihiLmF1ZGlvPWEub2ZmZXJUb1JlY2VpdmVBdWRpbyksdm9pZCAwIT09YS5pY2VSZXN0YXJ0JiYoYi5pY2VSZXN0YXJ0PWEuaWNlUmVzdGFydCksdm9pZCAwIT09YS52b2ljZUFjdGl2aXR5RGV0ZWN0aW9uJiYoYi52b2ljZUFjdGl2aXR5RGV0ZWN0aW9uPWEudm9pY2VBY3Rpdml0eURldGVjdGlvbikpO3JldHVybiBifTtiLnByb3RvdHlwZS5jcmVhdGVPZmZlcj1mdW5jdGlvbihhLGIsYyl7aC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmNyZWF0ZU9mZmVyKCkgY2FsbGVkLlwiLEpTT04uc3RyaW5naWZ5KGEpKTtyZXR1cm4gdGhpcy5pc1VuaWZpZWQoKT92b2lkIDA9PWE/dGhpcy5jcmVhdGVPZmZlcl92MigpOmE/dGhpcy5jcmVhdGVPZmZlcl92MihhKTpcbnRoaXMuY3JlYXRlT2ZmZXJfdjEoYSxiLGMpOnRoaXMuY3JlYXRlT2ZmZXJfdjEoYSxiLGMpfTtiLnByb3RvdHlwZS5jcmVhdGVPZmZlcl92Mj1mdW5jdGlvbihhKXt2YXIgYj10aGlzO2gubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5jcmVhdGVPZmZlcl92MigpIGNhbGxlZC5cIixKU09OLnN0cmluZ2lmeShhKSk7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGMsbCl7Yi5jcmVhdGVPZmZlcl92MShmdW5jdGlvbihhKXtoLmxvZ2dlci5sb2coYi51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuY3JlYXRlT2ZmZXJfdjIoKTogZ290IHNkcCEhIVwiKTthPW5ldyBxKGEudHlwZSxhLnNkcCk7YyhhKX0sZnVuY3Rpb24oYSl7dm9pZCAwIT1hJiYoYT1iLmxvZ1JlbW90ZUludm9rZUVycm9yKGEsXCIuY3JlYXRlT2ZmZXJfdjIoKSBmYWlsZWQuXCIpLGwoYSkpfSxhKX0pfTtiLnByb3RvdHlwZS5jcmVhdGVPZmZlcl92MT1mdW5jdGlvbihhLGIsYyl7dmFyIGw9dGhpcztoLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXG5cIi5jcmVhdGVPZmZlcl92MSgpLlwiLEpTT04uc3RyaW5naWZ5KGMpKTt2YXIgcT1bdGhpcy53YWl0VW50aWxDb25uZWN0ZWQodGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuY3JlYXRlT2ZmZXJfdjFcIiksdGhpcy53YWl0VHJhbnNjZWl2ZXJSZWFkeSh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5jcmVhdGVPZmZlcl92MVwiKV07UHJvbWlzZS5hbGwocSkudGhlbihmdW5jdGlvbigpe3ZhciBhPWwucmVnaXN0ZXJDYWxsYmFja3MoITAsITEsdC5tZXRob2RfaWRfUlRDUGVlckNvbm5lY3Rpb25fdC5jcmVhdGVPZmZlcik7bC5yZW1vdGVJbnZva2UoITEsdC5tZXRob2RfaWRfUlRDUGVlckNvbm5lY3Rpb25fdC5jcmVhdGVPZmZlcixhLnN1Y2Nlc3MsYS5mYWlsLGwuZml4X2NvbnN0cmFpbnRzKGMpKTtyZXR1cm4gYS5wcm9tKCl9KS50aGVuKGZ1bmN0aW9uKGEpe2gubG9nZ2VyLmxvZyhsLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5jcmVhdGVPZmZlcl92MSgpOiBzdWNjZXNzIGNhbGxiYWNrIHJlY2VpdmVkISEhXCIpO1xucmV0dXJuKG5ldyB3KGwsbC5wYXJhbTAoYSkub2lkLGsuUHJveHlNb2RlLlJlbW90ZSkpLnN5bmNCYXJyaWVyKCl9KS50aGVuKGZ1bmN0aW9uKGIpe2EmJmEoYil9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe3ZvaWQgMCE9YSYmKGE9bC5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFwiLmNyZWF0ZU9mZmVyX3YxKCkgZmFpbGVkLlwiKSxiJiZiKGEpKX0pfTtiLnByb3RvdHlwZS5jcmVhdGVBbnN3ZXI9ZnVuY3Rpb24oYSxiLGMpe2gubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5jcmVhdGVBbnN3ZXIoKSBjYWxsZWQuXCIsSlNPTi5zdHJpbmdpZnkoYSkpO3JldHVybiB0aGlzLmlzVW5pZmllZCgpP3ZvaWQgMD09YT90aGlzLmNyZWF0ZUFuc3dlcl92MigpOmE/dGhpcy5jcmVhdGVBbnN3ZXJfdjIoYSk6dGhpcy5jcmVhdGVBbnN3ZXJfdjEoYSxiLGMpOnRoaXMuY3JlYXRlQW5zd2VyX3YxKGEsYixjKX07Yi5wcm90b3R5cGUuY3JlYXRlQW5zd2VyX3YyPWZ1bmN0aW9uKGEpe3ZhciBiPVxudGhpcztoLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuY3JlYXRlQW5zd2VyX3YyKCkgY2FsbGVkLlwiLEpTT04uc3RyaW5naWZ5KGEpKTtyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24oYyxsKXtiLmNyZWF0ZUFuc3dlcl92MShmdW5jdGlvbihhKXtoLmxvZ2dlci5sb2coYi51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuY3JlYXRlQW5zd2VyX3YyKCk6IGdvdCBzZHAhISFcIik7YT1uZXcgcShhLnR5cGUsYS5zZHApO2MoYSl9LGZ1bmN0aW9uKGEpe3ZvaWQgMCE9YSYmKGE9Yi5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFwiLmNyZWF0ZUFuc3dlcl92MigpIGZhaWxlZC5cIiksbChhKSl9LGEpfSl9O2IucHJvdG90eXBlLmNyZWF0ZUFuc3dlcl92MT1mdW5jdGlvbihhLGIsYyl7dmFyIGw9dGhpcztoLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuY3JlYXRlQW5zd2VyX3YxKCkgY2FsbGVkLlwiLEpTT04uc3RyaW5naWZ5KGMpKTt2YXIgcT1bdGhpcy53YWl0VW50aWxDb25uZWN0ZWQodGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXG5cIi5jcmVhdGVBbnN3ZXJfdjFcIiksdGhpcy53YWl0VHJhbnNjZWl2ZXJSZWFkeSh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5jcmVhdGVBbnN3ZXJfdjFcIildO1Byb21pc2UuYWxsKHEpLnRoZW4oZnVuY3Rpb24oKXt2YXIgYT1sLnJlZ2lzdGVyQ2FsbGJhY2tzKCEwLCExLHQubWV0aG9kX2lkX1JUQ1BlZXJDb25uZWN0aW9uX3QuY3JlYXRlQW5zd2VyKTtsLnJlbW90ZUludm9rZSghMSx0Lm1ldGhvZF9pZF9SVENQZWVyQ29ubmVjdGlvbl90LmNyZWF0ZUFuc3dlcixhLnN1Y2Nlc3MsYS5mYWlsLGwuZml4X2NvbnN0cmFpbnRzKGMpLHt9KTtyZXR1cm4gYS5wcm9tKCl9KS50aGVuKGZ1bmN0aW9uKGEpe2gubG9nZ2VyLmxvZyhsLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5jcmVhdGVBbnN3ZXJfdjEoKTogc3VjY2VzcyBjYWxsYmFjayByZWNlaXZlZCEhIVwiKTtyZXR1cm4obmV3IHcobCxsLnBhcmFtMChhKS5vaWQsay5Qcm94eU1vZGUuUmVtb3RlKSkuc3luY0JhcnJpZXIoKX0pLnRoZW4oZnVuY3Rpb24oYil7YSYmXG5hKGIpfSlbXCJjYXRjaFwiXShmdW5jdGlvbihhKXthPWwubG9nUmVtb3RlSW52b2tlRXJyb3IoYSxcIi5jcmVhdGVBbnN3ZXJfdjEoKSBmYWlsZWQuXCIpO2ImJmIoYS5tZXNzYWdlKX0pfTtiLnByb3RvdHlwZS51cGRhdGVTZHBEZXNjcmlwdGlvbj1mdW5jdGlvbihhKXtyZXR1cm4gZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24oKXt2YXIgYixjLGwscT10aGlzO3JldHVybiByKHRoaXMsZnVuY3Rpb24oZCl7c3dpdGNoKGQubGFiZWwpe2Nhc2UgMDpyZXR1cm4gaC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLnVwZGF0ZVNkcERlc2NyaXB0aW9uKCkgY2FsbGVkLlwiKSwxIT1hP1szLDJdOls0LHRoaXMucmVtb3RlSW52b2tlKCExLHQubWV0aG9kX2lkX1JUQ1BlZXJDb25uZWN0aW9uX3QubG9jYWxEZXNjcmlwdGlvbix7b2lkOnRoaXMub2JqZWN0X2lkKCl9KV07Y2FzZSAxOnJldHVybiBiPWQuc2VudCgpLFszLDRdO2Nhc2UgMjpyZXR1cm5bNCx0aGlzLnJlbW90ZUludm9rZSghMSxcbnQubWV0aG9kX2lkX1JUQ1BlZXJDb25uZWN0aW9uX3QucmVtb3RlRGVzY3JpcHRpb24se29pZDp0aGlzLm9iamVjdF9pZCgpfSldO2Nhc2UgMzpiPWQuc2VudCgpLGQubGFiZWw9NDtjYXNlIDQ6cmV0dXJuIGM9bmV3IHcodGhpcyx0aGlzLnBhcmFtMChiKS5vaWQsay5Qcm94eU1vZGUuUmVtb3RlKSxbNCxjLnN5bmNCYXJyaWVyKClbXCJjYXRjaFwiXShmdW5jdGlvbihhKXtxLmxvZ1JlbW90ZUludm9rZUVycm9yKGEsXCJzZHAuc3luY0JhcnJpZXIoKSBmYWlsZWQhXCIpO3JldHVybiBudWxsfSldO2Nhc2UgNTpyZXR1cm4gbD1kLnNlbnQoKSwxPT1hP3RoaXMubG9jYWxEZXNjcmlwdGlvbl89bDp0aGlzLnJlbW90ZURlc2NyaXB0aW9uXz1sLFsyXX19KX0pfTtiLnByb3RvdHlwZS5zZXRMb2NhbERlc2NyaXB0aW9uPWZ1bmN0aW9uKGEsYixjKXtoLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc2V0TG9jYWxEZXNjcmlwdGlvbigpIGNhbGxlZC5cIixKU09OLnN0cmluZ2lmeShhKSk7XG5pZihhIGluc3RhbmNlb2YgcSlyZXR1cm4gdGhpcy5zZXRMb2NhbERlc2NyaXB0aW9uX3YyKGEpO2lmKGEgaW5zdGFuY2VvZiBSVENTZXNzaW9uRGVzY3JpcHRpb24mJmIpcmV0dXJuIHRoaXMuc2V0TG9jYWxEZXNjcmlwdGlvbl92MShhLGIsYyk7Yj12b2lkIDA7YT9iPW5ldyBxKGEudHlwZSxhLnNkcCk6KGgubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRMb2NhbERlc2NyaXB0aW9uKCkgZW1wdHkgcGFyYW0xLCBzZXR0aW5nIHNkcCB0eXBlIHRvIHJvbGxiYWNrXCIpLGE9dm9pZCAwLGE9XCJoYXZlLXJlbW90ZS1vZmZlclwiPT10aGlzLnNpZ25hbGluZ1N0YXRlXz9cImFuc3dlclwiOlwiaGF2ZS1sb2NhbC1wcmFuc3dlclwiPT10aGlzLnNpZ25hbGluZ1N0YXRlX3x8XCJoYXZlLXJlbW90ZS1wcmFuc3dlclwiPT10aGlzLnNpZ25hbGluZ1N0YXRlXz9cInByYW5zd2VyXCI6XCJvZmZlclwiLGI9bmV3IHEoYSxcIlwiKSk7cmV0dXJuIHRoaXMuc2V0TG9jYWxEZXNjcmlwdGlvbl92MihiKX07XG5iLnByb3RvdHlwZS5zZXRMb2NhbERlc2NyaXB0aW9uX3YyPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXM7aC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLnNldExvY2FsRGVzY3JpcHRpb25fdjIoKSBjYWxsZWQuXCIsSlNPTi5zdHJpbmdpZnkoYSkpO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihjLGwpe2Iud2FpdFVudGlsQ29ubmVjdGVkKGIudXNlcl9mcmllbmRseV9pZCgpK1wiLnNldExvY2FsRGVzY3JpcHRpb25fdjJcIikudGhlbihmdW5jdGlvbigpe3JldHVybihuZXcgdyhiLDAsay5Qcm94eU1vZGUuTG9jYWwse3R5cGU6dy5jb252ZXJ0QzJIKGEudHlwZSksc2RwOmEuc2RwfSkpLnN5bmNCYXJyaWVyKCl9KS50aGVuKGZ1bmN0aW9uKHEpe3ZhciBkPWIucmVnaXN0ZXJDYWxsYmFja3MoITAsITEsdC5tZXRob2RfaWRfUlRDUGVlckNvbm5lY3Rpb25fdC5zZXRMb2NhbERlc2NyaXB0aW9uX3YyKSxtPXt0eXBlOncuY29udmVydEMySChhLnR5cGUpLHNkcDphLnNkcH07XG5iLnJlbW90ZUludm9rZSghMSx0Lm1ldGhvZF9pZF9SVENQZWVyQ29ubmVjdGlvbl90LnNldExvY2FsRGVzY3JpcHRpb25fdjIsbSxkLnN1Y2Nlc3MsZC5mYWlsKTtkLnByb20oKS50aGVuKGZ1bmN0aW9uKCl7aC5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wiLnNldExvY2FsRGVzY3JpcHRpb25fdjIoKTogc3VjY2VzcyBjYWxsYmFjayByZWNlaXZlZCEhIVwiKTtiLmxvY2FsRGVzY3JpcHRpb25fPXE7aC5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wiLnNldExvY2FsRGVzY3JpcHRpb25fdjIoKTogdXBkYXRlZCBsb2NhbERlc2NyaXB0aW9uX1wiKTtiLmlzVW5pZmllZCgpO1Byb21pc2UuYWxsKFtdKS50aGVuKGZ1bmN0aW9uKCl7aC5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wiLnNldExvY2FsRGVzY3JpcHRpb25fdjIoKSBzdWNjZXNzLlwiKTtjKCl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2E9Yi5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFwiLnByb3Auc2V0TG9jYWxEZXNjcmlwdGlvbl92MigpIGZhaWxlZCFcIik7XG5sKGEpfSl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2E9Yi5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFwic2V0TG9jYWxEZXNjcmlwdGlvbl92MigpIGVycm9yIGNhbGxiYWNrIHJlY2VpdmVkIVwiKTtsKGEpfSl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2E9Yi5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFwiLnNldExvY2FsRGVzY3JpcHRpb25fdjIoKSBmYWlsZWQuXCIpO2woYSl9KX0pfTtiLnByb3RvdHlwZS5zZXRMb2NhbERlc2NyaXB0aW9uX3YxPWZ1bmN0aW9uKGEsYixjKXt2YXIgbD10aGlzO2gubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRMb2NhbERlc2NyaXB0aW9uX3YxKCkgY2FsbGVkLlwiKTt0aGlzLndhaXRVbnRpbENvbm5lY3RlZCh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRMb2NhbERlc2NyaXB0aW9uX3YxXCIpLnRoZW4oZnVuY3Rpb24oKXtyZXR1cm4obmV3IHcobCwwLGsuUHJveHlNb2RlLkxvY2FsLHt0eXBlOncuY29udmVydEMySChhLnR5cGUpLFxuc2RwOmEuc2RwfSkpLnN5bmNCYXJyaWVyKCl9KS50aGVuKGZ1bmN0aW9uKGEpe3ZhciBxPWwucmVnaXN0ZXJDYWxsYmFja3MoITAsITEsdC5tZXRob2RfaWRfUlRDUGVlckNvbm5lY3Rpb25fdC5zZXRMb2NhbERlc2NyaXB0aW9uKTtsLnJlbW90ZUludm9rZSghMSx0Lm1ldGhvZF9pZF9SVENQZWVyQ29ubmVjdGlvbl90LnNldExvY2FsRGVzY3JpcHRpb24se29pZDphLm9iamVjdF9pZCgpfSxxLnN1Y2Nlc3MscS5mYWlsKTtxLnByb20oKS50aGVuKGZ1bmN0aW9uKCl7aC5sb2dnZXIubG9nKGwudXNlcl9mcmllbmRseV9pZCgpK1wiLnNldExvY2FsRGVzY3JpcHRpb25fdjEoKTogc3VjY2VzcyBjYWxsYmFjayByZWNlaXZlZCEhIVwiKTtsLmxvY2FsRGVzY3JpcHRpb25fPWE7aC5sb2dnZXIubG9nKGwudXNlcl9mcmllbmRseV9pZCgpK1wiLnNldExvY2FsRGVzY3JpcHRpb25fdjEoKTogdXBkYXRlZCBsb2NhbERlc2NyaXB0aW9uX1wiKTtsLmlzVW5pZmllZCgpO1Byb21pc2UuYWxsKFtdKS50aGVuKGZ1bmN0aW9uKCl7aC5sb2dnZXIubG9nKGwudXNlcl9mcmllbmRseV9pZCgpK1xuXCIuc2V0TG9jYWxEZXNjcmlwdGlvbl92MSgpIHN1Y2Nlc3MuXCIpO2ImJmIoKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYSl7YT1sLmxvZ1JlbW90ZUludm9rZUVycm9yKGEsXCIucHJvcC5zZXRMb2NhbERlc2NyaXB0aW9uX3YxKCkgZmFpbGVkLlwiKTtjJiZjKGEubWVzc2FnZSl9KX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYSl7YT1sLmxvZ1JlbW90ZUludm9rZUVycm9yKGEsXCIuc2V0TG9jYWxEZXNjcmlwdGlvbl92MSgpIGVycm9yIGNhbGxiYWNrIHJlY2VpdmVkLlwiKTtjJiZjKGEubWVzc2FnZSl9KX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYSl7YT1sLmxvZ1JlbW90ZUludm9rZUVycm9yKGEsXCIuc2V0TG9jYWxEZXNjcmlwdGlvbl92MSgpIGZhaWxlZC5cIik7YyYmYyhhLm1lc3NhZ2UpfSl9O2IucHJvdG90eXBlLnNldFJlbW90ZURlc2NyaXB0aW9uPWZ1bmN0aW9uKGEsYixjKXtoLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc2V0UmVtb3RlRGVzY3JpcHRpb24oKSBjYWxsZWQuXCIsXG5KU09OLnN0cmluZ2lmeShhKSk7aWYoYSBpbnN0YW5jZW9mIHEpcmV0dXJuIHRoaXMuc2V0UmVtb3RlRGVzY3JpcHRpb25fdjIoYSk7aWYoYSBpbnN0YW5jZW9mIFJUQ1Nlc3Npb25EZXNjcmlwdGlvbiYmYilyZXR1cm4gdGhpcy5zZXRSZW1vdGVEZXNjcmlwdGlvbl92MShhLGIsYyk7Yj12b2lkIDA7YT9iPW5ldyBxKGEudHlwZSxhLnNkcCk6KGgubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRSZW1vdGVEZXNjcmlwdGlvbigpIGVtcHR5IHBhcmFtMSwgc2V0dGluZyBzZHAgdHlwZSB0byByb2xsYmFja1wiKSxhPXZvaWQgMCxhPVwiaGF2ZS1yZW1vdGUtb2ZmZXJcIj09dGhpcy5zaWduYWxpbmdTdGF0ZV8/XCJhbnN3ZXJcIjpcImhhdmUtbG9jYWwtcHJhbnN3ZXJcIj09dGhpcy5zaWduYWxpbmdTdGF0ZV98fFwiaGF2ZS1yZW1vdGUtcHJhbnN3ZXJcIj09dGhpcy5zaWduYWxpbmdTdGF0ZV8/XCJwcmFuc3dlclwiOlwib2ZmZXJcIixiPW5ldyBxKGEsXCJcIikpO3JldHVybiB0aGlzLnNldFJlbW90ZURlc2NyaXB0aW9uX3YyKGIpfTtcbmIucHJvdG90eXBlLnNldFJlbW90ZURlc2NyaXB0aW9uX3YyPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXM7aC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLnNldFJlbW90ZURlc2NyaXB0aW9uX3YyKCkgY2FsbGVkLlwiLEpTT04uc3RyaW5naWZ5KGEpKTtyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24oYyxsKXtiLndhaXRVbnRpbENvbm5lY3RlZChiLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRSZW1vdGVEZXNjcmlwdGlvbl92MlwiKS50aGVuKGZ1bmN0aW9uKCl7cmV0dXJuKG5ldyB3KGIsMCxrLlByb3h5TW9kZS5Mb2NhbCx7dHlwZTp3LmNvbnZlcnRDMkgoYS50eXBlKSxzZHA6YS5zZHB9KSkuc3luY0JhcnJpZXIoKX0pLnRoZW4oZnVuY3Rpb24ocSl7dmFyIGQ9Yi5yZWdpc3RlckNhbGxiYWNrcyghMCwhMSx0Lm1ldGhvZF9pZF9SVENQZWVyQ29ubmVjdGlvbl90LnNldFJlbW90ZURlc2NyaXB0aW9uX3YyKSxtPXt0eXBlOncuY29udmVydEMySChhLnR5cGUpLHNkcDphLnNkcH07XG5iLnJlbW90ZUludm9rZSghMSx0Lm1ldGhvZF9pZF9SVENQZWVyQ29ubmVjdGlvbl90LnNldFJlbW90ZURlc2NyaXB0aW9uX3YyLG0sZC5zdWNjZXNzLGQuZmFpbCk7ZC5wcm9tKCkudGhlbihmdW5jdGlvbigpe2gubG9nZ2VyLmxvZyhiLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRSZW1vdGVEZXNjcmlwdGlvbl92MigpOiBzdWNjZXNzIGNhbGxiYWNrIHJlY2VpdmVkISEhXCIpO2IucmVtb3RlRGVzY3JpcHRpb25fPXE7aC5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wiLnNldFJlbW90ZURlc2NyaXB0aW9uX3YyKCk6IHVwZGF0ZWQgcmVtb3RlRGVzY3JpcHRpb25fXCIpO3ZhciBhPVtdO2IuaXNVbmlmaWVkKCk/YS5wdXNoKGIuZ2V0VHJhbnNjZWl2ZXJzQXN5bmMoKSk6YS5wdXNoKGIuZ2V0U2VuZGVyc0FzeW5jKCkpO1Byb21pc2UuYWxsKGEpLnRoZW4oZnVuY3Rpb24oKXtoLmxvZ2dlci5sb2coYi51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc2V0UmVtb3RlRGVzY3JpcHRpb25fdjIoKTogc3VjY2Vzcy5cIik7XG5jKCl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2E9Yi5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFwiLnByb3Auc2V0UmVtb3RlRGVzY3JpcHRpb25fdjIoKSBmYWlsZWQuXCIpO2woYSl9KX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYSl7YT1iLmxvZ1JlbW90ZUludm9rZUVycm9yKGEsXCIuc2V0UmVtb3RlRGVzY3JpcHRpb25fdjIoKSBlcnJvciBjYWxsYmFjayByZWNlaXZlZC5cIik7bChhKX0pfSlbXCJjYXRjaFwiXShmdW5jdGlvbihhKXthPWIubG9nUmVtb3RlSW52b2tlRXJyb3IoYSxcIi5zZXRSZW1vdGVEZXNjcmlwdGlvbl92MigpIGZhaWxlZC5cIik7bChhKX0pfSl9O2IucHJvdG90eXBlLnNldFJlbW90ZURlc2NyaXB0aW9uX3YxPWZ1bmN0aW9uKGEsYixjKXt2YXIgbD10aGlzO2gubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRSZW1vdGVEZXNjcmlwdGlvbl92MSgpIGNhbGxlZC5cIik7dGhpcy53YWl0VW50aWxDb25uZWN0ZWQodGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc2V0UmVtb3RlRGVzY3JpcHRpb25fdjFcIikudGhlbihmdW5jdGlvbigpe3JldHVybihuZXcgdyhsLFxuMCxrLlByb3h5TW9kZS5Mb2NhbCx7dHlwZTp3LmNvbnZlcnRDMkgoYS50eXBlKSxzZHA6YS5zZHB9KSkuc3luY0JhcnJpZXIoKX0pLnRoZW4oZnVuY3Rpb24oYSl7dmFyIHE9bC5yZWdpc3RlckNhbGxiYWNrcyghMCwhMSx0Lm1ldGhvZF9pZF9SVENQZWVyQ29ubmVjdGlvbl90LnNldFJlbW90ZURlc2NyaXB0aW9uKTtsLnJlbW90ZUludm9rZSghMSx0Lm1ldGhvZF9pZF9SVENQZWVyQ29ubmVjdGlvbl90LnNldFJlbW90ZURlc2NyaXB0aW9uLHtvaWQ6YS5vYmplY3RfaWQoKX0scS5zdWNjZXNzLHEuZmFpbCk7cS5wcm9tKCkudGhlbihmdW5jdGlvbigpe2gubG9nZ2VyLmxvZyhsLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRSZW1vdGVEZXNjcmlwdGlvbl92MSgpOiBzdWNjZXNzIGNhbGxiYWNrIHJlY2VpdmVkISEhXCIpO2wucmVtb3RlRGVzY3JpcHRpb25fPWE7aC5sb2dnZXIubG9nKGwudXNlcl9mcmllbmRseV9pZCgpK1wiLnNldFJlbW90ZURlc2NyaXB0aW9uX3YxKCk6IHVwZGF0ZWQgcmVtb3RlRGVzY3JpcHRpb25fXCIpO1xudmFyIHE9W107bC5pc1VuaWZpZWQoKT9xLnB1c2gobC5nZXRUcmFuc2NlaXZlcnNBc3luYygpKTpxLnB1c2gobC5nZXRTZW5kZXJzQXN5bmMoKSk7UHJvbWlzZS5hbGwocSkudGhlbihmdW5jdGlvbigpe2gubG9nZ2VyLmxvZyhsLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRSZW1vdGVEZXNjcmlwdGlvbl92MSgpOiBzdWNjZXNzLlwiKTtiJiZiKCl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2E9bC5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFwiLnByb3Auc2V0UmVtb3RlRGVzY3JpcHRpb25fdjEoKSBmYWlsZWQuXCIpO2MmJmMoYS5tZXNzYWdlKX0pfSl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2E9bC5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFwiLnNldFJlbW90ZURlc2NyaXB0aW9uX3YxKCkgZmFpbGVkLlwiKTtjJiZjKGEubWVzc2FnZSl9KX07Yi5wcm90b3R5cGUuZ2V0TG9jYWxTdHJlYW1zPWZ1bmN0aW9uKCl7aC5sb2dnZXIubG9nKFwiUGVlckNvbm5lY3Rpb24uZ2V0TG9jYWxTdHJlYW1zKCkgY2FsbGVkLiBbb2lkPVwiK1xudGhpcy5vYmplY3RfaWQoKStcIl1cIik7Zm9yKHZhciBhPTAsYj10aGlzLmxvY2FsU3RyZWFtczthPGIubGVuZ3RoO2ErKyloLmxvZ2dlci5sb2coSlNPTi5zdHJpbmdpZnkoYlthXSkpO3JldHVybiB0aGlzLmxvY2FsU3RyZWFtc307Yi5wcm90b3R5cGUuZ2V0UmVtb3RlU3RyZWFtcz1mdW5jdGlvbigpe2gubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5nZXRSZW1vdGVTdHJlYW1zKCkgY2FsbGVkLlwiKTtmb3IodmFyIGE9MCxiPXRoaXMucmVtb3RlU3RyZWFtczthPGIubGVuZ3RoO2ErKyloLmxvZ2dlci5sb2coSlNPTi5zdHJpbmdpZnkoYlthXSkpO3JldHVybiB0aGlzLnJlbW90ZVN0cmVhbXN9O2IucHJvdG90eXBlLmFkZFRyYWNrPWZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcztoLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuYWRkVHJhY2soKSBjYWxsZWQ6IFwiK0pTT04uc3RyaW5naWZ5KGIpKTt2YXIgbD1bXTtpZihiIGluc3RhbmNlb2YgcC5SZW1vdGVTdHJlYW0pbC5wdXNoKGIuaWQpLFxudGhpcy5sb2NhbFN0cmVhbXMucHVzaChiKTtlbHNlIGZvcih2YXIgcT0wO3E8Yi5sZW5ndGg7cSsrKWwucHVzaChiW3FdLmlkKSx0aGlzLmxvY2FsU3RyZWFtcy5wdXNoKGJbcV0pO3ZhciBkPW5ldyBmLlJ0cFNlbmRlcih0aGlzLDAsay5Qcm94eU1vZGUuUHNldWRvLHRoaXMuaXNVbmlmaWVkKCkpO3RoaXMuc2VuZGVyc18ucHVzaChkKTt0aGlzLndhaXRVbnRpbENvbm5lY3RlZCh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5hZGRUcmFja1wiKS50aGVuKGZ1bmN0aW9uKCl7cmV0dXJuIGMucmVtb3RlSW52b2tlKCExLHQubWV0aG9kX2lkX1JUQ1BlZXJDb25uZWN0aW9uX3QuYWRkVHJhY2sse29pZDphLm9iamVjdF9pZCgpfSxsKX0pLnRoZW4oZnVuY3Rpb24oYSl7aC5sb2dnZXIubG9nKGMudXNlcl9mcmllbmRseV9pZCgpK1wiLmFkZFRyYWNrKCkgc3VjY2VzcyB3aXRoIG9pZDogXCIrYy5wYXJhbTAoYSkub2lkKTtkLmJpbmQoYyxjLnBhcmFtMChhKS5vaWQpO2Quc3luY0JhcnJpZXIoKS50aGVuKGZ1bmN0aW9uKCl7aC5sb2dnZXIubG9nKGMudXNlcl9mcmllbmRseV9pZCgpK1xuXCJzZW5kZXIuc3luY0JhcnJpZXIoKTogc3VjY2Vzc1wiKTtjLmlzVW5pZmllZCgpJiZjLmdldFRyYW5zY2VpdmVyc0FzeW5jKCl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2MubG9nUmVtb3RlSW52b2tlRXJyb3IoYSxcInNlbmRlci5zeW5jQmFycmllcigpIGZhaWxlZCFcIil9KX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYSl7Yy5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFwiYWRkVHJhY2soKSBmYWlsZWQhXCIpfSk7aC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmFkZFRyYWNrKCkgcmV0dXJuaW5nOiBcIitkKTtyZXR1cm4gZH07Yi5wcm90b3R5cGUucmVtb3ZlVHJhY2s9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcztoLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIucmVtb3ZlVHJhY2soKSBjYWxsZWQuXCIpO2Zvcih2YXIgYz0wO2M8dGhpcy5zZW5kZXJzXy5sZW5ndGg7YysrKXRoaXMuc2VuZGVyc19bY109PWEmJnRoaXMuc2VuZGVyc18uc3BsaWNlKGMsMSk7dGhpcy53YWl0VW50aWxDb25uZWN0ZWQodGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXG5cIi5yZW1vdmVUcmFja1wiKS50aGVuKGZ1bmN0aW9uKCl7cmV0dXJuIGIucmVtb3RlSW52b2tlKCExLHQubWV0aG9kX2lkX1JUQ1BlZXJDb25uZWN0aW9uX3QucmVtb3ZlVHJhY2sse29pZDphLm9iamVjdF9pZCgpfSl9KS50aGVuKGZ1bmN0aW9uKCl7aC5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wiLnJlbW92ZVRyYWNrKCkgc3VjY2Vzcy5cIik7Yi5pc1VuaWZpZWQoKSYmYi5nZXRUcmFuc2NlaXZlcnNBc3luYygpfSlbXCJjYXRjaFwiXShmdW5jdGlvbihhKXtiLmxvZ1JlbW90ZUludm9rZUVycm9yKGEsXCJyZW1vdmVUcmFjaygpIGZhaWxlZCFcIil9KX07Yi5wcm90b3R5cGUuYWRkU3RyZWFtPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXM7aC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmFkZFN0cmVhbSgpIGNhbGxlZDogXCIrSlNPTi5zdHJpbmdpZnkoYSkpO3RoaXMubG9jYWxTdHJlYW1zLnB1c2goYSk7dGhpcy53YWl0VW50aWxDb25uZWN0ZWQodGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXG5cIi5hZGRTdHJlYW1cIikudGhlbihmdW5jdGlvbigpe3JldHVybiBiLnJlbW90ZUludm9rZSghMSx0Lm1ldGhvZF9pZF9SVENQZWVyQ29ubmVjdGlvbl90LmFkZFN0cmVhbSx7b2lkOmEub2JqZWN0X2lkKCl9LHt9KX0pLnRoZW4oZnVuY3Rpb24oKXtoLmxvZ2dlci5sb2coYi51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuYWRkU3RyZWFtKCkgc3VjY2Vzcy5cIil9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2IubG9nUmVtb3RlSW52b2tlRXJyb3IoYSxcImFkZFN0cmVhbSgpIGZhaWxlZC5cIil9KX07Yi5wcm90b3R5cGUucmVtb3ZlU3RyZWFtPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXM7aC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLnJlbW92ZVN0cmVhbSgpIGNhbGxlZDogXCIrSlNPTi5zdHJpbmdpZnkoYSkpO2Zvcih2YXIgYz0wO2M8dGhpcy5sb2NhbFN0cmVhbXMubGVuZ3RoO2MrKyl0aGlzLmxvY2FsU3RyZWFtc1tjXT09YSYmdGhpcy5sb2NhbFN0cmVhbXMuc3BsaWNlKGMsMSk7XG50aGlzLndhaXRVbnRpbENvbm5lY3RlZCh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5yZW1vdmVTdHJlYW1cIikudGhlbihmdW5jdGlvbigpe3JldHVybiBiLnJlbW90ZUludm9rZSghMSx0Lm1ldGhvZF9pZF9SVENQZWVyQ29ubmVjdGlvbl90LnJlbW92ZVN0cmVhbSx7b2lkOmEub2JqZWN0X2lkKCl9KX0pLnRoZW4oZnVuY3Rpb24oKXtoLmxvZ2dlci5sb2coYi51c2VyX2ZyaWVuZGx5X2lkKCkrXCIucmVtb3ZlU3RyZWFtKCkgc3VjY2Vzcy5cIil9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2IubG9nUmVtb3RlSW52b2tlRXJyb3IoYSxcInJlbW92ZVN0cmVhbSgpIGZhaWxlZC5cIil9KX07T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwib25hZGRzdHJlYW1cIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub25hZGRzdHJlYW1ffSxzZXQ6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcztoLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc2V0X29uYWRkc3RyZWFtKCkgY2FsbGVkLlwiKTtcbnRoaXMub25hZGRzdHJlYW1fPWE7dGhpcy53YWl0VW50aWxDb25uZWN0ZWQodGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIub25hZGRzdHJlYW1cIikudGhlbihmdW5jdGlvbigpe3ZhciBjPWIucmVnaXN0ZXJDYWxsYmFja3MoITEsYi5pc051bGxDYWxsYmFjayhhKSx0Lm1ldGhvZF9pZF9SVENQZWVyQ29ubmVjdGlvbl90Lm9uYWRkc3RyZWFtKTtjLnRoZW4oZnVuY3Rpb24oYSl7KG5ldyBwLlJlbW90ZVN0cmVhbUV2ZW50KGIsYi5wYXJhbTAoYSkub2lkKSkuc3luY0JhcnJpZXIoKS50aGVuKGZ1bmN0aW9uKGEpe2gubG9nZ2VyLmxvZyhiLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5vbmFkZHN0cmVhbSBjYWxsYmFjayByZWNlaXZlZCFcIik7dm9pZCAwPT09Yi5yZW1vdGVTdHJlYW1zLmZpbmQoZnVuY3Rpb24oYil7cmV0dXJuIHZvaWQgMCE9YS5zdHJlYW0mJmIub2JqZWN0X2lkKCk9PT1hLnN0cmVhbS5vYmplY3RfaWQoKX0pJiZiLnJlbW90ZVN0cmVhbXMucHVzaChhLnN0cmVhbSk7dm9pZCAwIT1cbmIub25hZGRzdHJlYW1fJiYoaC5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wiLm9uYWRkc3RyZWFtIG5vdGlmaWVkISEhIFwiK2Euc3RyZWFtLmlkKSxiLm9uYWRkc3RyZWFtXyhhKSl9KX0pO3JldHVybiBiLnJlbW90ZUludm9rZSghMCx0Lm1ldGhvZF9pZF9SVENQZWVyQ29ubmVjdGlvbl90Lm9uYWRkc3RyZWFtLGMuc3VjY2Vzcyl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2IubG9nUmVtb3RlSW52b2tlRXJyb3IoYSxcInNldF9vbmFkZHN0cmVhbSgpIGZhaWxlZCFcIil9KX0sZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITB9KTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYi5wcm90b3R5cGUsXCJvbnJlbW92ZXN0cmVhbVwiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vbnJlbW92ZXN0cmVhbV99LHNldDpmdW5jdGlvbihhKXt2YXIgYj10aGlzO2gubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRfb25yZW1vdmVzdHJlYW0oKSBjYWxsZWQuXCIpO3RoaXMub25yZW1vdmVzdHJlYW1fPVxuYTt0aGlzLndhaXRVbnRpbENvbm5lY3RlZCh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5vbnJlbW92ZXN0cmVhbVwiKS50aGVuKGZ1bmN0aW9uKCl7dmFyIGM9Yi5yZWdpc3RlckNhbGxiYWNrcyghMSxiLmlzTnVsbENhbGxiYWNrKGEpLHQubWV0aG9kX2lkX1JUQ1BlZXJDb25uZWN0aW9uX3Qub25yZW1vdmVzdHJlYW0pO2MudGhlbihmdW5jdGlvbihhKXsobmV3IHAuUmVtb3RlU3RyZWFtRXZlbnQoYixiLnBhcmFtMChhKS5vaWQpKS5zeW5jQmFycmllcigpLnRoZW4oZnVuY3Rpb24oYSl7aC5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wiLm9ucmVtb3Zlc3RyZWFtIGNhbGxiYWNrIHJlY2VpdmVkISBcIithLnN0cmVhbS5pZCk7dmFyIGM9Yi5yZW1vdGVTdHJlYW1zLmZpbmRJbmRleChmdW5jdGlvbihiKXtyZXR1cm4gYi5pZD09YS5zdHJlYW0uaWR9KTswPD1jJiZiLnJlbW90ZVN0cmVhbXMuc3BsaWNlKGMsMSk7Yi5vbnJlbW92ZXN0cmVhbV8oYSl9KX0pO3JldHVybiBiLnJlbW90ZUludm9rZSghMCxcbnQubWV0aG9kX2lkX1JUQ1BlZXJDb25uZWN0aW9uX3Qub25yZW1vdmVzdHJlYW0sYy5zdWNjZXNzKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYSl7Yi5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFwic2V0X29ucmVtb3Zlc3RyZWFtKCkgZmFpbGVkIVwiKX0pfSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO2IucHJvdG90eXBlLmdldFN0YXRzPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXM7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGMsbCl7dmFyIHE9dGhpcztiLmlzUmVkaXJlY3RlZCgpP2Iud2FpdFVudGlsQ29ubmVjdGVkKGIudXNlcl9mcmllbmRseV9pZCgpK1wiLmdldFN0YXRzXCIpLnRoZW4oZnVuY3Rpb24oKXt2YXIgbD1iLnJlZ2lzdGVyQ2FsbGJhY2tzKCEwLCExLHQubWV0aG9kX2lkX1JUQ1BlZXJDb25uZWN0aW9uX3QuZ2V0U3RhdHMpO2wudGhlbihmdW5jdGlvbihiKXt2b2lkIDAhPT1iLnBhcmFtcyYmMCE9PWIucGFyYW1zLmxlbmd0aCYmKGE/KGEoQS5TdGF0c1JlcG9ydC5mcm9tSlNPTihKU09OLnBhcnNlKGIucGFyYW1zWzBdKSkpLFxuYygpKTpjKEEuU3RhdHNSZXBvcnQudG9SVENTdGF0c1JlcG9ydChKU09OLnBhcnNlKGIucGFyYW1zWzBdKSkpKX0pO3JldHVybiBhP2IucmVtb3RlSW52b2tlKCExLHQubWV0aG9kX2lkX1JUQ1BlZXJDb25uZWN0aW9uX3QuZ2V0U3RhdHMsbC5zdWNjZXNzKTpiLnJlbW90ZUludm9rZSghMSx0Lm1ldGhvZF9pZF9SVENQZWVyQ29ubmVjdGlvbl90LmdldFN0YXRzX3YyLGwuc3VjY2Vzcyl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe3EmJihhPXEubG9nUmVtb3RlSW52b2tlRXJyb3IoYSxcIi5nZXRTdGF0cygpIGZhaWxlZCFcIiksbChhKSl9KTooYSh7fSksYygpKX0pfTtiLnByb3RvdHlwZS5TZW5kVGVsZW1ldHJ5RGF0YT1mdW5jdGlvbihhLGIsYyl7Zy5nZXRSZWRpcmVjdG9yKCkudGVsZW1ldHJ5LlNlbmRUZWxlbWV0cnlEYXRhKHkudGVsX2NtZC5EYXRhLGEsYixjKX07Yi5wcm90b3R5cGUuTWlsbGlzZWNvbmRzdG9EaXNwbGF5Zm9ybWF0Xz1mdW5jdGlvbihhKXt2YXIgYixjO2M9TWF0aC5mbG9vcihhL1xuMUUzKTtiPU1hdGguZmxvb3IoYy82MCk7YT1NYXRoLmZsb29yKGIvNjApO2gubG9nZ2VyLmxvZyhNYXRoLmZsb29yKGEvMjQpK1wiOlwiK2ElMjQrXCI6XCIrYiU2MCtcIjpcIitjJTYwKX07Yi5wcm90b3R5cGUuQ2FsY3VsYXRlQ2FsbER1cmF0aW9uYW5kVHlwZV89ZnVuY3Rpb24oKXtpZigxPT10aGlzLnRpbWVlcnN0YXJ0ZWRfKXt0aGlzLnRpbWVlcnN0YXJ0ZWRfPSExO3RoaXMuY2FsbGVuZFRpbWVfPShuZXcgRGF0ZSkuZ2V0VGltZSgpO3ZhciBhPXRoaXMuY2FsbGVuZFRpbWVfLXRoaXMuY2FsbHN0YXJ0VGltZV87dGhpcy5NaWxsaXNlY29uZHN0b0Rpc3BsYXlmb3JtYXRfKGEpO2E9TWF0aC5yb3VuZChhLzFFMyk7aC5sb2dnZXIubG9nKFwiQ2FsbCBEdXJhdGlvbiBcIithKTsxPT10aGlzLmNvbmZlcmVuY2VjYWxsXz90aGlzLlNlbmRUZWxlbWV0cnlEYXRhKHkudGVsX2tleV9Db25mZXJlbmNlQ2FsbER1cmF0aW9uLGEsMSk6KDE9PXRoaXMuYXVkaW9jYWxsXy5hY3RpdmUmJnRoaXMuU2VuZFRlbGVtZXRyeURhdGEoeS50ZWxfa2V5X0F1ZGlvQ2FsbER1cmF0aW9uLFxuYSwxKSwxPT10aGlzLnZpZGVvY2FsbF8uYWN0aXZlJiZ0aGlzLlNlbmRUZWxlbWV0cnlEYXRhKHkudGVsX2tleV9WaWRlb0NhbGxEdXJhdGlvbixhLDEpLDE9PXRoaXMuc2NyZWVuc2hhcmluZ2NhbGxfLmFjdGl2ZSYmdGhpcy5TZW5kVGVsZW1ldHJ5RGF0YSh5LnRlbF9rZXlfU2NyZWVuc2hhcmluZ0NhbGxEdXJhdGlvbixhLDEpKTt2YXIgYjsxPT10aGlzLmZpcnN0dGltZWxvY2Fsb2ZmZXJfJiYoYj10aGlzLmNhbGxzdGFydFRpbWVfLXRoaXMub3V0Z29pbmdjYWxsc3RhcnRfKTsxPT10aGlzLmZpcnN0dGltZXJlbW90ZW9mZmVyXyYmKGI9dGhpcy5jYWxsc3RhcnRUaW1lXy10aGlzLmluY29taW5nY2FsbHN0YXJ0Xyk7dGhpcy5NaWxsaXNlY29uZHN0b0Rpc3BsYXlmb3JtYXRfKGIpO2I9TWF0aC5yb3VuZChiLzFFMyk7aC5sb2dnZXIubG9nKFwiQ2FsbCBFc3RhYmxpc2ggVGltZSBcIitiKTsxPT10aGlzLmluY29taW5nY2FsbF8/dGhpcy5TZW5kVGVsZW1ldHJ5RGF0YSh5LnRlbF9rZXlfQ2FsbEVzdEluY29taW5nLFxuYiwxKToxPT10aGlzLm91dGdvaW5nY2FsbF8mJnRoaXMuU2VuZFRlbGVtZXRyeURhdGEoeS50ZWxfa2V5X0NhbGxFc3RPdXRnb2luZyxiLDEpO3RoaXMuU2VuZFRlbGVtZXRyeURhdGEoeS50ZWxfa2V5X1BlcmZDYWxsU3RhdGUseS50ZWxfQ2FsbFN0YXRlLmlkbGUsMSl9fTtiLnByb3RvdHlwZS5jbG9zZT1mdW5jdGlvbigpe3ZhciBhPXRoaXM7aC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmNsb3NlKCkgY2FsbGVkLlwiKTt0aGlzLkNhbGN1bGF0ZUNhbGxEdXJhdGlvbmFuZFR5cGVfKCk7dGhpcy51bnJlZ2lzdGVyU3RhdGVDaGFuZ2VOb3RpZmljYXRpb24odGhpcy5vblN0YXRlQ2hhbmdlKTt0aGlzLm9ubmVnb3RpYXRpb25uZWVkZWQ9dGhpcy5vbnNpZ25hbGluZ3N0YXRlY2hhbmdlPXRoaXMub25pY2VnYXRoZXJpbmdzdGF0ZWNoYW5nZT10aGlzLm9uaWNlY29ubmVjdGlvbnN0YXRlY2hhbmdlPXRoaXMub25pY2VjYW5kaWRhdGU9dGhpcy5vbmFkZHN0cmVhbT1cbm51bGw7dGhpcy53YWl0VW50aWxDb25uZWN0ZWQodGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuY2xvc2VcIikudGhlbihmdW5jdGlvbigpe3JldHVybiBhLnJlbW90ZUludm9rZSghMSx0Lm1ldGhvZF9pZF9SVENQZWVyQ29ubmVjdGlvbl90LmNsb3NlKX0pLnRoZW4oZnVuY3Rpb24oKXthLmljZVFfPW51bGw7YS5yZWxlYXNlKCk7aC5sb2dnZXIubG9nKGEudXNlcl9mcmllbmRseV9pZCgpK1wiLmNsb3NlKCkgc3VjY2Vzcy5cIil9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGIpe2EubG9nUmVtb3RlSW52b2tlRXJyb3IoYixcIi5jbG9zZSgpIGZhaWxlZC5cIik7YS5pY2VRXz1udWxsO2EucmVsZWFzZSgpfSl9O2IucHJvdG90eXBlLmNyZWF0ZURUTUZTZW5kZXI9ZnVuY3Rpb24oYSl7aC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmNyZWF0ZURUTUZTZW5kZXIoKSBjYWxsZWQuXCIpO3ZhciBiLGM9dGhpcy5zZW5kZXJzXztpZih2b2lkIDA9PT1jfHwwPT09Yy5sZW5ndGgpYz10aGlzLmdldFNlbmRlcnMoKTtcbnZvaWQgMCE9YyYmKGM9Yy5maW5kKGZ1bmN0aW9uKGIpe3JldHVybiBiLnRyYWNrLmlkPT09YS5pZH0pLHZvaWQgMCE9YyYmKGgubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIiByZXR1cm5pbmcgUnRwU2VuZGVyIHdpdGggb2lkOlwiK2Mub2JqZWN0X2lkKCkpLGI9Yy5kdG1mKSk7cmV0dXJuIGJ9O2IucHJvdG90eXBlLmdldFNlbmRlcnM9ZnVuY3Rpb24oKXt2YXIgYT10aGlzO2gubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5nZXRTZW5kZXJzKCkgY2FsbGVkLiBcIik7aWYodGhpcy5pc1VuaWZpZWQoKSl7Zm9yKHZhciBiPVtdLGM9MCxsPXRoaXMudHJhbnNjZWl2ZXJzXztjPGwubGVuZ3RoO2MrKyliLnB1c2gobFtjXS5zZW5kZXIpO3RoaXMuc2VuZGVyc189Yn1lbHNlIHRoaXMuZ2V0U2VuZGVyc0FzeW5jKCkudGhlbihmdW5jdGlvbigpe2gubG9nZ2VyLmxvZyhhLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5nZXRTZW5kZXJzKCkgc3VjY2Vzcy5cIil9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGIpe2EubG9nUmVtb3RlSW52b2tlRXJyb3IoYixcblwiLmdldFNlbmRlcnMoKSBmYWlsZWQhXCIpfSk7aC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmdldFNlbmRlcnMoKSByZXR1cm5pbmc6XCIrdGhpcy5zZW5kZXJzXy5sZW5ndGgrXCIgaXRlbXNcIik7cmV0dXJuIHRoaXMuc2VuZGVyc199O2IucHJvdG90eXBlLmdldFNlbmRlcnNBc3luYz1mdW5jdGlvbigpe3ZhciBhPXRoaXM7aC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmdldFNlbmRlcnNBc3luYygpIGNhbGxlZC4gXCIrdGhpcy5zZW5kZXJzXyk7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGIsYyl7YS53YWl0VW50aWxDb25uZWN0ZWQoYS51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0U2VuZGVyc0FzeW5jXCIpLnRoZW4oZnVuY3Rpb24oKXtoLmxvZ2dlci5sb2coYS51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0U2VuZGVyc0FzeW5jIGludm9raW5nIHJlbW90ZVwiKTtyZXR1cm4gYS5yZW1vdGVJbnZva2UoITEsdC5tZXRob2RfaWRfUlRDUGVlckNvbm5lY3Rpb25fdC5nZXRTZW5kZXJzLFxuW10pfSkudGhlbihmdW5jdGlvbihjKXtoLmxvZ2dlci5sb2coYS51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0U2VuZGVyc0FzeW5jIHJlbW90ZSBzdWNjZXNzXCIpO3ZhciBsPVtdLHE9W107Yy5wYXJhbXNbMF0uZm9yRWFjaChmdW5jdGlvbihiKXt2YXIgYz1hLnNlbmRlcnNfLmZpbmQoZnVuY3Rpb24oYSl7cmV0dXJuIGEub2JqZWN0X2lkKCk9PT1iLm9pZH0pO3ZvaWQgMD09PWMmJihoLmxvZ2dlci5sb2coYS51c2VyX2ZyaWVuZGx5X2lkKCkrXCIgYWRkaW5nIGEgUnRwU2VuZGVyIHdpdGggb2lkOlwiK2Iub2lkKSxjPW5ldyBmLlJ0cFNlbmRlcihhLGIub2lkLGsuUHJveHlNb2RlLlJlbW90ZSxhLmlzVW5pZmllZCgpKSxxLnB1c2goYy5zeW5jQmFycmllcigpKSk7bC5wdXNoKGMpfSk7UHJvbWlzZS5hbGwocSkudGhlbihmdW5jdGlvbigpe2Euc2VuZGVyc189bDtoLmxvZ2dlci5sb2coYS51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0U2VuZGVyc0FzeW5jOiByZXR1cm5pbmcgc2VuZGVycyB3aXRoIGlkcyBbXCIrXG5hLnNlbmRlcnNfLm1hcChmdW5jdGlvbihhKXtyZXR1cm4gYS5vYmplY3RfaWQoKX0pK1wiXVwiKTtiKGEuc2VuZGVyc18pfSlbXCJjYXRjaFwiXShmdW5jdGlvbihjKXthLmxvZ1JlbW90ZUludm9rZUVycm9yKGMsXCIucHJvcC5nZXRTZW5kZXJzQXN5bmMoKSBmYWlsZWQuXCIpO2Euc2VuZGVyc189W107YihhLnNlbmRlcnNfKX0pfSlbXCJjYXRjaFwiXShmdW5jdGlvbihjKXthLmxvZ1JlbW90ZUludm9rZUVycm9yKGMsXCIuZ2V0U2VuZGVyc0FzeW5jKCkgZmFpbGVkLlwiKTthLnNlbmRlcnNfPVtdO2IoYS5zZW5kZXJzXyl9KX0pfTtiLnByb3RvdHlwZS5nZXRSZWNlaXZlcnM9ZnVuY3Rpb24oKXt2YXIgYT10aGlzO2gubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5nZXRSZWNlaXZlcnMoKSBjYWxsZWQuIFwiKTtpZih0aGlzLmlzVW5pZmllZCgpKXtmb3IodmFyIGI9W10sYz0wLGw9dGhpcy50cmFuc2NlaXZlcnNfO2M8bC5sZW5ndGg7YysrKWIucHVzaChsW2NdLnJlY2VpdmVyKTtcbnRoaXMucmVjZWl2ZXJzXz1ifWVsc2UgdGhpcy5nZXRSZWNlaXZlcnNBc3luYygpLnRoZW4oZnVuY3Rpb24oKXtoLmxvZ2dlci5sb2coYS51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0UmVjZWl2ZXJzKCkgc3VjY2Vzcy5cIil9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGIpe2EubG9nUmVtb3RlSW52b2tlRXJyb3IoYixcIi5nZXRSZWNlaXZlcnMoKSBmYWlsZWQhXCIpfSk7aC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmdldFJlY2VpdmVycygpIHJldHVybmluZzpcIit0aGlzLnJlY2VpdmVyc18ubGVuZ3RoK1wiIGl0ZW1zXCIpO3JldHVybiB0aGlzLnJlY2VpdmVyc199O2IucHJvdG90eXBlLmdldFJlY2VpdmVyc0FzeW5jPWZ1bmN0aW9uKCl7dmFyIGE9dGhpcztoLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0UmVjZWl2ZXJzQXN5bmMoKSBjYWxsZWQuIFwiK3RoaXMucmVjZWl2ZXJzXyk7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGIsYyl7YS53YWl0VW50aWxDb25uZWN0ZWQoYS51c2VyX2ZyaWVuZGx5X2lkKCkrXG5cIi5nZXRSZWNlaXZlcnNBc3luY1wiKS50aGVuKGZ1bmN0aW9uKCl7cmV0dXJuIGEucmVtb3RlSW52b2tlKCExLHQubWV0aG9kX2lkX1JUQ1BlZXJDb25uZWN0aW9uX3QuZ2V0UmVjZWl2ZXJzLFtdKX0pLnRoZW4oZnVuY3Rpb24oYyl7aC5sb2dnZXIubG9nKGEudXNlcl9mcmllbmRseV9pZCgpK1wiLmdldFJlY2VpdmVyc0FzeW5jOiByZW1vdGUgc3VjY2Vzcy5cIik7dmFyIGw9W10scT1bXTtjLnBhcmFtc1swXS5mb3JFYWNoKGZ1bmN0aW9uKGIpe3ZhciBjPWEucmVjZWl2ZXJzXy5maW5kKGZ1bmN0aW9uKGEpe3JldHVybiBhLm9iamVjdF9pZCgpPT09Yi5vaWR9KTt2b2lkIDA9PT1jJiYoaC5sb2dnZXIubG9nKGEudXNlcl9mcmllbmRseV9pZCgpK1wiIGFkZGluZyBhIFJ0cFJlY2VpdmVyIHdpdGggb2lkOlwiK2Iub2lkKSxjPW5ldyBmLlJ0cFJlY2VpdmVyKGEsYi5vaWQsay5Qcm94eU1vZGUuUmVtb3RlLGEuaXNVbmlmaWVkKCkpLHEucHVzaChjLnN5bmNCYXJyaWVyKCkpKTtsLnB1c2goYyl9KTtcblByb21pc2UuYWxsKHEpLnRoZW4oZnVuY3Rpb24oKXthLnJlY2VpdmVyc189bDtoLmxvZ2dlci5sb2coYS51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0UmVjZWl2ZXJzQXN5bmM6IHJldHVybmluZyByZWNlaXZlciB3aXRoIGlkcyBbXCIrYS5yZWNlaXZlcnNfLm1hcChmdW5jdGlvbihhKXtyZXR1cm4gYS5vYmplY3RfaWQoKX0pK1wiXVwiKTtiKGEucmVjZWl2ZXJzXyl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGMpe2EubG9nUmVtb3RlSW52b2tlRXJyb3IoYyxcIi5wcm9wLmdldFJlY2VpdmVyc0FzeW5jKCkgZmFpbGVkIVwiKTthLnJlY2VpdmVyc189W107YihhLnJlY2VpdmVyc18pfSl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGMpe2EubG9nUmVtb3RlSW52b2tlRXJyb3IoYyxcIi5nZXRSZWNlaXZlcnNBc3luYygpIGZhaWxlZCFcIik7YS5yZWNlaXZlcnNfPVtdO2IoYS5yZWNlaXZlcnNfKX0pfSl9O2IucHJvdG90eXBlLmFkZFRyYW5zY2VpdmVyPWZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcztoLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXG5cIi5hZGRUcmFuc2NlaXZlcigpIGNhbGxlZDogXCIrSlNPTi5zdHJpbmdpZnkoYSkrXCIgaW5pdD1cIitKU09OLnN0cmluZ2lmeShiKSk7dGhpcy5wZW5kaW5ndHJhbnNjZWl2ZXJfPSEwO3ZhciBsPVwic2VuZHJlY3ZcIjtiJiZiLmRpcmVjdGlvbiYmKGw9Yi5kaXJlY3Rpb24pO3ZhciBxPW5ldyBtLlJ0cFRyYW5zY2VpdmVyKHRoaXMsMCxrLlByb3h5TW9kZS5Qc2V1ZG8sdGhpcy5pc1VuaWZpZWQoKSxsKTt0aGlzLnRyYW5zY2VpdmVyc18ucHVzaChxKTt0aGlzLndhaXRVbnRpbENvbm5lY3RlZCh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5hZGRUcmFuc2NlaXZlclwiKS50aGVuKGZ1bmN0aW9uKCl7cmV0dXJuXCJzdHJpbmdcIj09PXR5cGVvZiBhP2MucmVtb3RlSW52b2tlKCExLHQubWV0aG9kX2lkX1JUQ1BlZXJDb25uZWN0aW9uX3QuYWRkVHJhbnNjZWl2ZXJXaXRoS2luZCxhLGIpOmMucmVtb3RlSW52b2tlKCExLHQubWV0aG9kX2lkX1JUQ1BlZXJDb25uZWN0aW9uX3QuYWRkVHJhbnNjZWl2ZXJXaXRoVHJhY2ssXG57b2lkOmEub2JqZWN0X2lkKCl9LGIpfSkudGhlbihmdW5jdGlvbihhKXtoLmxvZ2dlci5sb2coYy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuYWRkVHJhbnNjZWl2ZXIoKSBzdWNjZXNzIHdpdGggb2lkOiBcIitjLnBhcmFtMChhKS5vaWQpO3EuYmluZChjLGMucGFyYW0wKGEpLm9pZCk7cS5zeW5jQmFycmllcigpLnRoZW4oZnVuY3Rpb24oKXtoLmxvZ2dlci5sb2coYy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuYWRkVHJhbnNjZWl2ZXIoKTogc3VjY2Vzc1wiKTtjLnBlbmRpbmd0cmFuc2NlaXZlcl89ITF9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2MubG9nUmVtb3RlSW52b2tlRXJyb3IoYSxcIi5wcm9wLmFkZFRyYW5zY2VpdmVyKCkgZmFpbGVkIVwiKTtjLnBlbmRpbmd0cmFuc2NlaXZlcl89ITF9KX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYSl7Yy5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFwiYWRkVHJhbnNjZWl2ZXIoKSBmYWlsZWQhXCIpO2MucGVuZGluZ3RyYW5zY2VpdmVyXz0hMX0pO2gubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcblwiLmFkZFRyYW5zY2VpdmVyKCkgcmV0dXJuaW5nOlwiKTtyZXR1cm4gcX07Yi5wcm90b3R5cGUud2FpdFRyYW5zY2VpdmVyUmVhZHk9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcztyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24oYyxsKXtoLmxvZ2dlci50cmFjZShiLnVzZXJfZnJpZW5kbHlfaWQoKStcIi53YWl0VHJhbnNjZWl2ZXJSZWFkeSgpOiBwZW5kaW5ndHJhbnNjZWl2ZXJfPVwiK2IucGVuZGluZ3RyYW5zY2VpdmVyXyk7aWYoMD09Yi5wZW5kaW5ndHJhbnNjZWl2ZXJfKXtmb3IoO2IuZGVmZXJyZWRPZmZlckFuc3dlcnMmJjA8Yi5kZWZlcnJlZE9mZmVyQW5zd2Vycy5sZW5ndGg7KWIuZGVmZXJyZWRPZmZlckFuc3dlcnMuc2hpZnQoKS5wb3N0KCEwKTtjKCl9ZWxzZSBiLmRlZmVycmVkT2ZmZXJBbnN3ZXJzLnB1c2gobmV3IGsuZGVmZXJyZWRfYWN0aW9uKGMsbCxhKSksYi5jaGVja1RyYW5zY2VpdmVyKDE1LDFFMyl9KX07Yi5wcm90b3R5cGUuY2hlY2tUcmFuc2NlaXZlcj1mdW5jdGlvbihhLFxuYil7dmFyIGM9dGhpcztpZigwPj1hKWZvcihoLmxvZ2dlci5sb2coXCIuY2hlY2tUcmFuc2NlaXZlcigpIHRpbWVvdXQgd2FpdGluZyBmb3IgdHJhbnNjZWl2ZXIgcmVhZHkhXCIpO3RoaXMuZGVmZXJyZWRPZmZlckFuc3dlcnMmJjA8dGhpcy5kZWZlcnJlZE9mZmVyQW5zd2Vycy5sZW5ndGg7KXRoaXMuZGVmZXJyZWRPZmZlckFuc3dlcnMuc2hpZnQoKS5wb3N0KCExKTtlbHNlIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtpZigwPT1jLnBlbmRpbmd0cmFuc2NlaXZlcl8pZm9yKDtjLmRlZmVycmVkT2ZmZXJBbnN3ZXJzJiYwPGMuZGVmZXJyZWRPZmZlckFuc3dlcnMubGVuZ3RoOyljLmRlZmVycmVkT2ZmZXJBbnN3ZXJzLnNoaWZ0KCkucG9zdCghMCk7ZWxzZSBoLmxvZ2dlci5sb2coJy5jaGVja1RyYW5zY2VpdmVyKCk6IGNvdW50PSBcIicrYSksYy5jaGVja1RyYW5zY2VpdmVyKC0tYSxiKX0sYil9O2IucHJvdG90eXBlLmdldFRyYW5zY2VpdmVycz1mdW5jdGlvbigpe2gubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcblwiLmdldFRyYW5zY2VpdmVycygpIGNhbGxlZC4gXCIpO2gubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5nZXRUcmFuc2NlaXZlcnMoKSByZXR1cm5pbmc6XCIrdGhpcy50cmFuc2NlaXZlcnNfLmxlbmd0aCtcIiBpdGVtc1wiKTtyZXR1cm4gdGhpcy50cmFuc2NlaXZlcnNffTtiLnByb3RvdHlwZS5nZXRUcmFuc2NlaXZlcnNBc3luYz1mdW5jdGlvbigpe3ZhciBhPXRoaXM7aC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmdldFRyYW5zY2VpdmVyc0FzeW5jKCkgY2FsbGVkLiBcIik7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGIsYyl7YS53YWl0VW50aWxDb25uZWN0ZWQoYS51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0VHJhbnNjZWl2ZXJzQXN5bmNcIikudGhlbihmdW5jdGlvbigpe3JldHVybiBhLnJlbW90ZUludm9rZSghMSx0Lm1ldGhvZF9pZF9SVENQZWVyQ29ubmVjdGlvbl90LmdldFRyYW5zY2VpdmVycyxbXSl9KS50aGVuKGZ1bmN0aW9uKGMpe2gubG9nZ2VyLmxvZyhhLnVzZXJfZnJpZW5kbHlfaWQoKStcblwiLmdldFRyYW5zY2VpdmVyc0FzeW5jKCkgcmVtb3RlIHN1Y2Nlc3MuXCIpO3ZhciBsPVtdLHE9W107Yy5wYXJhbXNbMF0uZm9yRWFjaChmdW5jdGlvbihiKXt2YXIgYz1hLnRyYW5zY2VpdmVyc18uZmluZChmdW5jdGlvbihhKXtyZXR1cm4gYS5vYmplY3RfaWQoKT09PWIub2lkfSk7dm9pZCAwPT09YyYmKGgubG9nZ2VyLmxvZyhhLnVzZXJfZnJpZW5kbHlfaWQoKStcIiBhZGRpbmcgYSBSdHBUcmFuc2NlaXZlciB3aXRoIG9pZDpcIitiLm9pZCksYz1uZXcgbS5SdHBUcmFuc2NlaXZlcihhLGIub2lkLGsuUHJveHlNb2RlLlJlbW90ZSxhLmlzVW5pZmllZCgpKSxxLnB1c2goYy5zeW5jQmFycmllcigpKSk7bC5wdXNoKGMpfSk7UHJvbWlzZS5hbGwocSkudGhlbihmdW5jdGlvbigpe2EudHJhbnNjZWl2ZXJzXz1sO2gubG9nZ2VyLmxvZyhhLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5wcm9wLmdldFRyYW5zY2VpdmVyc0FzeW5jOiByZXR1cm5pbmcgdHJhbnNjZWl2ZXIgd2l0aCBpZHMgW1wiK2EudHJhbnNjZWl2ZXJzXy5tYXAoZnVuY3Rpb24oYSl7cmV0dXJuIGEub2JqZWN0X2lkKCl9KStcblwiXVwiKTtiKGEudHJhbnNjZWl2ZXJzXyl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGMpe2EubG9nUmVtb3RlSW52b2tlRXJyb3IoYyxcIi5wcm9wLmdldFRyYW5zY2VpdmVyc0FzeW5jKCkgZmFpbGVkIVwiKTthLnRyYW5zY2VpdmVyc189W107YihhLnRyYW5zY2VpdmVyc18pfSl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGMpe2EubG9nUmVtb3RlSW52b2tlRXJyb3IoYyxcIi5nZXRUcmFuc2NlaXZlcnNBc3luYygpIGZhaWxlZCFcIik7YS50cmFuc2NlaXZlcnNfPVtdO2IoYS50cmFuc2NlaXZlcnNfKX0pfSl9O09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcInNjdHBcIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuc2N0cF99LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwib25kYXRhY2hhbm5lbFwiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vbmRhdGFjaGFubmVsX30sc2V0OmZ1bmN0aW9uKGEpe3ZhciBiPVxudGhpcztoLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc2V0X29uZGF0YWNoYW5uZWwoKSBjYWxsZWQuXCIpO3RoaXMub25kYXRhY2hhbm5lbF89YTt0aGlzLndhaXRVbnRpbENvbm5lY3RlZCh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5vbmRhdGFjaGFubmVsXCIpLnRoZW4oZnVuY3Rpb24oKXt2YXIgYz1iLnJlZ2lzdGVyQ2FsbGJhY2tzKCExLGIuaXNOdWxsQ2FsbGJhY2soYSksdC5tZXRob2RfaWRfUlRDUGVlckNvbm5lY3Rpb25fdC5vbmRhdGFjaGFubmVsKTtjLnRoZW4oZnVuY3Rpb24oYSl7aC5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wiLm9uZGF0YWNoYW5uZWwgY2FsbGJhY2sgcmVjZWl2ZWQhISFcIik7aWYobnVsbD09PWIucmVtb3RlZGF0YWNoYW5uZWxffHxiLnJlbW90ZWRhdGFjaGFubmVsXy5vYmplY3RfaWQoKSE9Yi5wYXJhbTAoYSkub2lkKWIucmVtb3RlZGF0YWNoYW5uZWxfPW5ldyBCLlJ0Y0RhdGFDaGFubmVsKGIsYi5wYXJhbTAoYSkub2lkLFxuay5Qcm94eU1vZGUuUmVtb3RlKSxiLnJlbW90ZWRhdGFjaGFubmVsXy5zeW5jQmFycmllcigpLnRoZW4oZnVuY3Rpb24oKXtoLmxvZ2dlci5sb2coYi51c2VyX2ZyaWVuZGx5X2lkKCkrXCJyZW1vdGVkYXRhY2hhbm5lbF8uc3luY0JhcnJpZXIoKTogc3VjY2Vzc1wiKTt2YXIgYT1uZXcgRXZlbnQoXCJvbmRhdGFjaGFubmVsXCIpO2EuY2hhbm5lbD1iLnJlbW90ZWRhdGFjaGFubmVsXztpZihiLmxvY2FsZGF0YWNoYW5uZWxfJiYhYi5sb2NhbGRhdGFjaGFubmVsXy5pc2Rlc3Ryb3llZCgpKWIubG9jYWxkYXRhY2hhbm5lbF8uc3luY0JhcnJpZXIoKS50aGVuKGZ1bmN0aW9uKCl7aC5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wib25kYXRhY2hhbm5lbCgpOiBub3RpZnlpbmcuLi5cIik7aWYoYi5vbmRhdGFjaGFubmVsXyliLm9uZGF0YWNoYW5uZWxfKGEpfSlbXCJjYXRjaFwiXShmdW5jdGlvbigpe2gubG9nZ2VyLmxvZyhiLnVzZXJfZnJpZW5kbHlfaWQoKStcImxvY2FsZGF0YWNoYW5uZWxfLnN5bmNCYXJyaWVyKCk6IGZhaWxlZCFcIil9KTtcbmVsc2UgaWYoaC5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wib25kYXRhY2hhbm5lbCgpOiBub3RpZnlpbmcuLi5cIiksYi5vbmRhdGFjaGFubmVsXyliLm9uZGF0YWNoYW5uZWxfKGEpfSlbXCJjYXRjaFwiXShmdW5jdGlvbigpe2gubG9nZ2VyLmxvZyhiLnVzZXJfZnJpZW5kbHlfaWQoKStcInJlbW90ZWRhdGFjaGFubmVsXy5zeW5jQmFycmllcigpOiBmYWlsZWQhXCIpfSl9KTtyZXR1cm4gYi5yZW1vdGVJbnZva2UoITAsdC5tZXRob2RfaWRfUlRDUGVlckNvbm5lY3Rpb25fdC5vbmRhdGFjaGFubmVsLGMuc3VjY2Vzcyl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKCl7aC5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wiLm9uZGF0YWNoYW5uZWwoKSBmYWlsZWQuXCIpfSl9LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7Yi5wcm90b3R5cGUuZml4RGF0YUNoYW5uZWxDb25maWc9ZnVuY3Rpb24oYSl7aC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmZpeERhdGFDaGFubmVsQ29uZmlnKCkgY2FsbGVkOiBcIitcbmEpO3ZvaWQgMD09YSYmKGE9e30pO3ZvaWQgMD09YS5uZWdvdGlhdGVkJiZ2b2lkIDA9PWEuaWQmJihhLm5lZ290aWF0ZWQ9ITEsYS5pZD0tMSk7cmV0dXJuIGF9O2IucHJvdG90eXBlLmNyZWF0ZURhdGFDaGFubmVsPWZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcztoLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuY3JlYXRlRGF0YUNoYW5uZWwoKSBjYWxsZWQuIGxhYmVsOlwiK2EpO3RoaXMubG9jYWxkYXRhY2hhbm5lbF89bmV3IEIuUnRjRGF0YUNoYW5uZWwodGhpcywwLGsuUHJveHlNb2RlLlBzZXVkbyk7dGhpcy53YWl0VW50aWxDb25uZWN0ZWQodGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuY3JlYXRlRGF0YUNoYW5uZWxcIikudGhlbihmdW5jdGlvbigpe3JldHVybiBjLnJlbW90ZUludm9rZSghMSx0Lm1ldGhvZF9pZF9SVENQZWVyQ29ubmVjdGlvbl90LmNyZWF0ZURhdGFDaGFubmVsLGEsYy5maXhEYXRhQ2hhbm5lbENvbmZpZyhiKSl9KS50aGVuKGZ1bmN0aW9uKGEpe2gubG9nZ2VyLmxvZyhjLnVzZXJfZnJpZW5kbHlfaWQoKStcblwiLmNyZWF0ZURhdGFDaGFubmVsKCkgc3VjY2VzcyB3aXRoIG9pZDogXCIrYy5wYXJhbTAoYSkub2lkKTtjLmxvY2FsZGF0YWNoYW5uZWxfLmJpbmQoYyxjLnBhcmFtMChhKS5vaWQpO2MubG9jYWxkYXRhY2hhbm5lbF8uc3luY0JhcnJpZXIoKS50aGVuKGZ1bmN0aW9uKCl7aC5sb2dnZXIubG9nKGMudXNlcl9mcmllbmRseV9pZCgpK1wiY2hhbm5lbC5zeW5jQmFycmllcigpOiBzdWNjZXNzXCIpfSlbXCJjYXRjaFwiXShmdW5jdGlvbigpe2gubG9nZ2VyLmxvZyhjLnVzZXJfZnJpZW5kbHlfaWQoKStcImNoYW5uZWwuc3luY0JhcnJpZXIoKTogZmFpbGVkIVwiKX0pfSlbXCJjYXRjaFwiXShmdW5jdGlvbihhKXthPWMucGFyYW0wKGEpO2gubG9nZ2VyLmxvZyhjLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5jcmVhdGVEYXRhQ2hhbm5lbCgpIGZhaWxlZCB3aXRoIGVycm9yOiBcIithKX0pO2gubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5jcmVhdGVEYXRhQ2hhbm5lbCgpIHJldHVybmluZzogXCIrXG50aGlzLmxvY2FsZGF0YWNoYW5uZWxfKTtyZXR1cm4gdGhpcy5sb2NhbGRhdGFjaGFubmVsX307cmV0dXJuIGJ9KGsuUHJveHlPYmplY3QpO2EuUGVlckNvbm5lY3Rpb249Yn0sNjU4OmZ1bmN0aW9uKGIsYSxjKXt2YXIgZD10aGlzJiZ0aGlzLl9fc3ByZWFkQXJyYXlzfHxmdW5jdGlvbigpe2Zvcih2YXIgYT0wLGI9MCxjPWFyZ3VtZW50cy5sZW5ndGg7YjxjO2IrKylhKz1hcmd1bWVudHNbYl0ubGVuZ3RoO2Zvcih2YXIgYT1BcnJheShhKSxkPTAsYj0wO2I8YztiKyspZm9yKHZhciBtPWFyZ3VtZW50c1tiXSxnPTAsdT1tLmxlbmd0aDtnPHU7ZysrLGQrKylhW2RdPW1bZ107cmV0dXJuIGF9O09iamVjdC5kZWZpbmVQcm9wZXJ0eShhLFwiX19lc01vZHVsZVwiLHt2YWx1ZTohMH0pO3ZhciBlPWMoOTQ2KSxyPWMoODUxKSxuPWMoNTQ1KSxnPWMoMjQ3KSxwPWMoNTUwKSxmPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gYShiLGMsZCl7dGhpcy5yZXNvbHZlPWI7dGhpcy5yZWplY3Q9Yzt0aGlzLm5hbWVfPVxuZH1PYmplY3QuZGVmaW5lUHJvcGVydHkoYS5wcm90b3R5cGUsXCJuYW1lXCIse2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm5hbWVffSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO2EucHJvdG90eXBlLnBvc3Q9ZnVuY3Rpb24oYSl7MT09YT8oci5sb2dnZXIubG9nKCdkZWZlcnJlZF9hY3Rpb24ucG9zdCgpOiByZXNvbHZpbmcgXCInK3RoaXMubmFtZV8rJ1wiJyksdGhpcy5yZXNvbHZlKCkpOihyLmxvZ2dlci5sb2coJ2RlZmVycmVkX2FjdGlvbi5wb3N0KCk6IHJlamVjdGluZyBcIicrdGhpcy5uYW1lXysnXCInKSx0aGlzLnJlamVjdCgpKX07YS5wcm90b3R5cGUucG9zdFdpdGhSZXN1bHQ9ZnVuY3Rpb24oYSxiKXsxPT1hPyhyLmxvZ2dlci5sb2coJ2RlZmVycmVkX2FjdGlvbi5wb3N0KCk6IHJlc29sdmluZyBcIicrdGhpcy5uYW1lXysnXCInKSx0aGlzLnJlc29sdmUoYikpOihyLmxvZ2dlci5sb2coJ2RlZmVycmVkX2FjdGlvbi5wb3N0KCk6IHJlamVjdGluZyBcIicrdGhpcy5uYW1lXytcbidcIicpLHRoaXMucmVqZWN0KCkpfTtyZXR1cm4gYX0oKTthLmRlZmVycmVkX2FjdGlvbj1mO3ZhciBrPWZ1bmN0aW9uKCl7cmV0dXJuIGZ1bmN0aW9uKGEsYil7dGhpcy5pZD1hO3RoaXMuaXNfbnVsbD1ifX0oKTthLnJwY19jYWxsYmFjaz1rO3ZhciB4PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gYShiLGMsZCl7dGhpcy5zdWNjZXNzPW5ldyBrKGI8PDE2LGMpO3RoaXMuZmFpbD1uZXcgayhiPDwxNnwxLGMpO3RoaXMuaWQ9Yjt0aGlzLm9uZVNob3Q9ZH1hLnByb3RvdHlwZS5yZXNvbHZlPWZ1bmN0aW9uKGEpe3IubG9nZ2VyLnRyYWNlKFwiY2FsbGJhY2sucmVzb2x2ZSgpIGNhbGxlZC4gW2lkPVwiK3RoaXMuaWQrXCJdXCIpO251bGwhPXRoaXMuaGFuZGxlciYmdGhpcy5oYW5kbGVyKGEpfTthLnByb3RvdHlwZS5yZWplY3Q9ZnVuY3Rpb24oYSl7bnVsbCE9dGhpcy5lcnJfaGFuZGxlciYmdGhpcy5lcnJfaGFuZGxlcihhKX07YS5wcm90b3R5cGUudGhlbj1mdW5jdGlvbihhKXt0aGlzLmhhbmRsZXI9XG5hfTthLnByb3RvdHlwZS5wcm9tPWZ1bmN0aW9uKCl7dmFyIGE9dGhpcztyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24oYixjKXthLmhhbmRsZXI9YjthLmVycl9oYW5kbGVyPWN9KX07cmV0dXJuIGF9KCk7YS5jYWxsYmFjaz14O3ZhciBtOyhmdW5jdGlvbihhKXthW2EuTm90Q29uZmlndXJlZD0wXT1cIk5vdENvbmZpZ3VyZWRcIjthW2EuQ29uZmlndXJlZD0xXT1cIkNvbmZpZ3VyZWRcIjthW2EuRXJyb3I9Ml09XCJFcnJvclwiO2FbYS5EZXN0cm95ZWQ9M109XCJEZXN0cm95ZWRcIn0pKG18fChtPXt9KSk7dmFyIEQ7KGZ1bmN0aW9uKGEpe2FbYS5Mb2NhbD0wXT1cIkxvY2FsXCI7YVthLlJlbW90ZT0xXT1cIlJlbW90ZVwiO2FbYS5Qc2V1ZG89Ml09XCJQc2V1ZG9cIn0pKEQ9YS5Qcm94eU1vZGV8fChhLlByb3h5TW9kZT17fSkpO2I9ZnVuY3Rpb24oKXtmdW5jdGlvbiBhKGIsYyxmLHgsayl7dmFyIHU9dGhpczt2b2lkIDA9PT1rJiYoaz1udWxsKTtmb3IodmFyIHE9W10sdz01O3c8YXJndW1lbnRzLmxlbmd0aDt3KyspcVt3LVxuNV09YXJndW1lbnRzW3ddO3RoaXMuaGR4bXM9ZS5nZXRSZWRpcmVjdG9yKCk7dGhpcy5paWQ9Yzt0aGlzLm9pZD1mO3RoaXMubW9kZT14O3RoaXMucHJveHlzdGF0ZT1tLk5vdENvbmZpZ3VyZWQ7dGhpcy5kZWZlcnJlZEFjdGlvbnM9W107dGhpcy5jYnM9bmV3IE1hcDt4PT09RC5Mb2NhbD8odz0hMSx0aGlzLmlpZD09PXAuY2xhc3NfaWRfdC5FbmdpbmVDb250cm9sJiYodz0hMCksdGhpcy5oZHhtcy5zdGFydFJlZGlyZWN0aW9uKHcsdGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkpLnRoZW4oZnVuY3Rpb24oKXt1Lm9pZD1hLm5leHRJZCsrO3IubG9nZ2VyLmxvZyh1LnVzZXJfZnJpZW5kbHlfaWQoKStcIiBhc3NpZ25lZCBsb2NhbCBvaWQ6XCIrdS5vaWQpO3ZhciBiPXAuV2VicnBjQ2xhc3NMaWJJbmZvVXRpbC5nZXRNZXRob2RGZWF0dXJlQnlpZChjLDApO3JldHVybiB1LmhkeG1zLldTU2VuZE9iamVjdFdyYXBwZXIoYixjLDAsbi5Xc0pzb25VdGlsLmNyZWF0ZU1lc3NhZ2VCeWlkLmFwcGx5KG4uV3NKc29uVXRpbCxcbmQoWyExLCExLG4ud3NfbXNnX3R5cGVfdC5yZXEsYywwLHUub2lkXSxxKSkpfSkudGhlbihmdW5jdGlvbihhKXtyLmxvZ2dlci50cmFjZShcIlByb3h5T2JqZWN0OiBzZXR0aW5nIHN0YXRlIHRvIGNvbmZpZ3VyZWQuIChpaWQ6IFwiK3UuaWlkK1wiIG9pZDogXCIrdS5vaWQrXCIpXCIpO3ZhciBjPXUub2lkO3UucHJveHlzdGF0ZT1tLkNvbmZpZ3VyZWQ7dS5vaWQ9dS5wYXJhbTAoYSk7ci5sb2dnZXIubG9nKHUudXNlcl9mcmllbmRseV9pZCgpK1wiIGFzc2lnbmVkIHJlbW90ZSBvaWQgZm9yIGxvY2FsIG9pZDpcIitjKTt1Lm9uQ29ubmVjdGVkKCk7ayYmaygpO2cuZ2MudHJhY2tPYmplY3QodSxiKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oKXt1LnByb3h5c3RhdGU9bS5FcnJvcjt1Lm9uQ29ubmVjdGVkKCl9KSk6eD09PUQuUmVtb3RlJiYodGhpcy5wcm94eXN0YXRlPW0uQ29uZmlndXJlZCxnLmdjLnRyYWNrT2JqZWN0KHRoaXMsYikpfWEucHJvdG90eXBlLmJpbmQ9ZnVuY3Rpb24oYSxiKXtyLmxvZ2dlci50cmFjZShcIlByb3h5T2JqZWN0OiBiaW5kaW5nIG9iamVjdC4gKGlpZDogXCIrXG50aGlzLmlpZCtcIiBvaWQ6IFwiK2IrXCIgbW9kZTogXCIrdGhpcy5tb2RlK1wiKVwiKTtpZih0aGlzLm1vZGU9PT1ELlBzZXVkbyl7dGhpcy5wcm94eXN0YXRlPW0uQ29uZmlndXJlZDt2YXIgYz10aGlzLm9pZDt0aGlzLm9pZD1iO3IubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIiBhc3NpZ25lZCByZW1vdGUgb2lkIGZvciBsb2NhbCBvaWQ6XCIrYyk7dGhpcy5vbkNvbm5lY3RlZCgpO2cuZ2MudHJhY2tPYmplY3QodGhpcyxhKTt0aGlzLm1vZGU9RC5SZW1vdGV9ZWxzZSB0aGlzLm1vZGU9PT1ELlJlbW90ZT9yLmxvZ2dlci5sb2coXCJQcm94eU9iamVjdDogYmluZGluZyBhbHJlYWR5IGNvbXBsZXRlLlwiKTpyLmxvZ2dlci5sb2coXCJQcm94eU9iamVjdDogYmluZGluZyBmYWlsdXJlLiBpbmNvcnJlY3QgbW9kZSFcIil9O2EucHJvdG90eXBlLnJlY29uc3RydWN0b3I9ZnVuY3Rpb24oYSxiLGMpe2Zvcih2YXIgZj10aGlzLGU9W10sdT0zO3U8YXJndW1lbnRzLmxlbmd0aDt1KyspZVt1LVxuM109YXJndW1lbnRzW3VdO3RoaXMucHJveHlzdGF0ZT1tLk5vdENvbmZpZ3VyZWQ7dGhpcy5kZWZlcnJlZEFjdGlvbnM9W107dT1wLldlYnJwY0NsYXNzTGliSW5mb1V0aWwuZ2V0TWV0aG9kRmVhdHVyZUJ5aWQoYiwwKTt0aGlzLmhkeG1zLldTU2VuZE9iamVjdFdyYXBwZXIodSxiLDAsbi5Xc0pzb25VdGlsLmNyZWF0ZU1lc3NhZ2VCeWlkLmFwcGx5KG4uV3NKc29uVXRpbCxkKFshMSwhMSxuLndzX21zZ190eXBlX3QucmVxLGIsMCx0aGlzLm9pZF0sZSkpKS50aGVuKGZ1bmN0aW9uKGIpe3IubG9nZ2VyLnRyYWNlKFwiUHJveHlPYmplY3Q6IHNldHRpbmcgc3RhdGUgdG8gY29uZmlndXJlZC4gKGlpZDogXCIrZi5paWQrXCIgb2lkOiBcIitmLm9pZCtcIilcIik7dmFyIGM9Zi5vaWQ7Zi5wcm94eXN0YXRlPW0uQ29uZmlndXJlZDtmLm9pZD1mLnBhcmFtMChiKTtyLmxvZ2dlci5sb2coZi51c2VyX2ZyaWVuZGx5X2lkKCkrXCIgYXNzaWduZWQgcmVtb3RlIG9pZCBmb3IgbG9jYWwgb2lkOlwiK2MpO2Yub25Db25uZWN0ZWQoKTtcbmcuZ2MudHJhY2tPYmplY3QoZixhKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oKXtmLnByb3h5c3RhdGU9bS5FcnJvcjtmLm9uQ29ubmVjdGVkKCl9KX07YS5wcm90b3R5cGUuc2V0UGFyZW50PWZ1bmN0aW9uKGEpe2cuZ2Muc2V0UGFyZW50KHRoaXMsYSl9O2EucHJvdG90eXBlLnJlbGVhc2U9ZnVuY3Rpb24oKXtyLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIucmVsZWFzZSgpIGNhbGxlZC5cIik7Zy5nYy5yZWxlYXNlT2JqZWN0KHRoaXMpfTthLnByb3RvdHlwZS5kZXN0cm95PWZ1bmN0aW9uKCl7ci5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmRlc3Ryb3koKSBjYWxsZWQuXCIpO3RoaXMucHJveHlzdGF0ZT1tLkRlc3Ryb3llZDt2YXIgYT1wLldlYnJwY0NsYXNzTGliSW5mb1V0aWwuZ2V0TWV0aG9kRmVhdHVyZUJ5aWQodGhpcy5paWQsMCk7dGhpcy5oZHhtcy5XU1NlbmRPYmplY3RXcmFwcGVyKGEsdGhpcy5paWQsMCxuLldzSnNvblV0aWwuY3JlYXRlTWVzc2FnZUJ5aWQoITEsXG4hMCxuLndzX21zZ190eXBlX3QucmVxLHRoaXMuaWlkLDAsdGhpcy5vaWQpKX07YS5wcm90b3R5cGUuaXNkZXN0cm95ZWQ9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5wcm94eXN0YXRlPT1tLkRlc3Ryb3llZH07YS5wcm90b3R5cGUub25Db25uZWN0ZWQ9ZnVuY3Rpb24oKXtmb3IoO3RoaXMuZGVmZXJyZWRBY3Rpb25zJiYwPHRoaXMuZGVmZXJyZWRBY3Rpb25zLmxlbmd0aDspdGhpcy5kZWZlcnJlZEFjdGlvbnMuc2hpZnQoKS5wb3N0KHRoaXMucHJveHlzdGF0ZT09bS5Db25maWd1cmVkKX07YS5wcm90b3R5cGUuaXNQc2V1ZG89ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5tb2RlPT1ELlBzZXVkb307YS5wcm90b3R5cGUuY2hlY2tTdGF0ZT1mdW5jdGlvbihhLGIpe3ZhciBjPXRoaXM7MD49YT8oci5sb2dnZXIubG9nKFwiUHJveHlPYmplY3QuY2hlY2tTdGF0ZSgpIHRpbWVvdXQgd2FpdGluZyBmb3IgY29ubmVjdGlvbiByZXNwb25zZSEgZmFpbGVkLiAoaWlkOiBcIitjLmlpZCtcIiBvaWQ6IFwiK1xuYy5vaWQrXCIpXCIpLGMub25Db25uZWN0ZWQoKSk6c2V0VGltZW91dChmdW5jdGlvbigpe2lmKGMucHJveHlzdGF0ZT09bS5Db25maWd1cmVkKWMub25Db25uZWN0ZWQoKTtlbHNlIGlmKGMucHJveHlzdGF0ZT09bS5FcnJvciljLm9uQ29ubmVjdGVkKCk7ZWxzZSBpZihjLnByb3h5c3RhdGU9PW0uRGVzdHJveWVkKWMub25Db25uZWN0ZWQoKTtlbHNlIHIubG9nZ2VyLmxvZygnUHJveHlPYmplY3QuY2hlY2tTdGF0ZSgpOiBjb3VudD0gXCInK2ErJ1wiLiAoaWlkOiAnK2MuaWlkK1wiIG9pZDogXCIrYy5vaWQrXCIpXCIpLGMuY2hlY2tTdGF0ZSgtLWEsYil9LGIpfTthLnByb3RvdHlwZS53YWl0VW50aWxDb25uZWN0ZWQ9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcztyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24oYyxkKXtiPyhyLmxvZ2dlci50cmFjZShcIlByb3h5T2JqZWN0LndhaXRVbnRpbENvbm5lY3RlZCgpOiByZWFkeVN0YXRlPVwiK2IucHJveHlzdGF0ZStcIi4gKGlpZDogXCIrYi5paWQrXCIgb2lkOiBcIitcbmIub2lkK1wiKVwiKSxiLnByb3h5c3RhdGU9PW0uRGVzdHJveWVkPyhiLm9uQ29ubmVjdGVkKCksci5sb2dnZXIudHJhY2UoXCJyZWplY3RpbmcgYWxyZWFkeSBkZXN0cm95ZWQgT2JqZWN0OlwiK2IudXNlcl9mcmllbmRseV9pZCgpKSxkKFwiT2JqZWN0IGFscmVhZHkgZGVzdHJveWVkIDpcIitiLnVzZXJfZnJpZW5kbHlfaWQoKSkpOmIucHJveHlzdGF0ZT09bS5Db25maWd1cmVkPyhiLm9uQ29ubmVjdGVkKCksYygpKTpiLnByb3h5c3RhdGU9PW0uRXJyb3I/KHIubG9nZ2VyLnRyYWNlKFwiUHJveHlPYmplY3Qud2FpdFVudGlsQ29ubmVjdGVkKCk6IHJlYWR5U3RhdGU9XCIrYi5wcm94eXN0YXRlK1wiLiAoaWlkOiBcIitiLmlpZCtcIiBvaWQ6IFwiK2Iub2lkK1wiKVwiKSxiLm9uQ29ubmVjdGVkKCksZCgpKTooci5sb2dnZXIubG9nKCdQcm94eU9iamVjdC53YWl0VW50aWxDb25uZWN0ZWQoKTogZGVmZXJyaW5nIGFjdGlvbiBcIicrYSsnXCIuIChpaWQ6ICcrYi5paWQrXCIgb2lkOiBcIitiLm9pZCtcIilcIiksYi5kZWZlcnJlZEFjdGlvbnMucHVzaChuZXcgZihjLFxuZCxhKSksYi5jaGVja1N0YXRlKDE1LDFFMykpKTpkKFwiSW52YWxpZCBPYmplY3RcIil9KX07YS5wcm90b3R5cGUucmVtb3RlSW52b2tlPWZ1bmN0aW9uKGEsYil7Zm9yKHZhciBjPVtdLGc9MjtnPGFyZ3VtZW50cy5sZW5ndGg7ZysrKWNbZy0yXT1hcmd1bWVudHNbZ107aWYodGhpcy5wcm94eXN0YXRlPT1tLkRlc3Ryb3llZClyZXR1cm4gci5sb2dnZXIudHJhY2UoXCJyZWplY3RpbmcgYWxyZWFkeSBkZXN0cm95ZWQgT2JqZWN0OlwiK3RoaXMudXNlcl9mcmllbmRseV9pZCgpKSxQcm9taXNlLnJlamVjdChcIkNhbm5vdCBpbnZva2UgZGVzdHJveWVkIG9iamVjdCA6XCIrdGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkpO2lmKHRoaXMucHJveHlzdGF0ZT09bS5FcnJvcilyZXR1cm4gci5sb2dnZXIudHJhY2UoXCJyZWplY3RpbmcgYWxyZWFkeSBlcnJvciBzdGF0ZSBPYmplY3Q6XCIrdGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkpLFByb21pc2UucmVqZWN0KFwiQ2Fubm90IGludm9rZSBvYmplY3QgaW4gRXJyb3Igc3RhdGU6XCIrXG50aGlzLnVzZXJfZnJpZW5kbHlfaWQoKSk7Zz1wLldlYnJwY0NsYXNzTGliSW5mb1V0aWwuZ2V0TWV0aG9kRmVhdHVyZUJ5aWQodGhpcy5paWQsYik7cmV0dXJuIHRoaXMuaGR4bXMuV1NTZW5kT2JqZWN0V3JhcHBlcihnLHRoaXMuaWlkLGIsbi5Xc0pzb25VdGlsLmNyZWF0ZU1lc3NhZ2VCeWlkLmFwcGx5KG4uV3NKc29uVXRpbCxkKFthLCExLG4ud3NfbXNnX3R5cGVfdC5yZXEsdGhpcy5paWQsYix0aGlzLm9pZF0sYykpKX07YS5wcm90b3R5cGUubG9nUmVtb3RlSW52b2tlRXJyb3I9ZnVuY3Rpb24oYSxiKXt2YXIgYz1hO2M/ci5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK2IrXCIgd2l0aCBlcnJvcjogXCIrYy5tZXNzYWdlKTp0aGlzLnBhcmFtMD8oci5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK2IrXCIgd2l0aCBlcnJvcjogXCIrdGhpcy5wYXJhbTAoYSkpLGM9bmV3IERPTUV4Y2VwdGlvbihiK1wiIHdpdGggZXJyb3I6IFwiK3RoaXMucGFyYW0wKGEpLHRoaXMudXNlcl9mcmllbmRseV9pZCgpKSk6XG4oci5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK2IpLGM9bmV3IERPTUV4Y2VwdGlvbihiLHRoaXMudXNlcl9mcmllbmRseV9pZCgpKSk7cmV0dXJuIGN9O2EucHJvdG90eXBlLnJlZ2lzdGVyQ2FsbGJhY2tzPWZ1bmN0aW9uKGIsYyxkKXt0aGlzLnVucmVnaXN0ZXJDYWxsYmFja3MoZCk7dmFyIG09YS5uZXh0Y2JpZCsrLGc9bmV3IHgobSxjLGIpO2N8fChifHx0aGlzLmNicy5zZXQoZCxtKSx0aGlzLmhkeG1zLnJlZ2lzdGVySGFuZGxlcih0aGlzLmlpZCx0aGlzLm9pZCxnKSk7cmV0dXJuIGd9O2EucHJvdG90eXBlLnVucmVnaXN0ZXJDYWxsYmFja3M9ZnVuY3Rpb24oYSl7dGhpcy5jYnMuaGFzKGEpPyh0aGlzLmhkeG1zLnVucmVnaXN0ZXJIYW5kbGVyKHRoaXMuaWlkLHRoaXMub2lkLHRoaXMuY2JzLmdldChhKSksdGhpcy5jYnNbXCJkZWxldGVcIl0oYSkpOnIubG9nZ2VyLnRyYWNlKHRoaXMuY2JzKX07YS5wcm90b3R5cGUub2JqZWN0X2lkPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub2lkfTtcbmEucHJvdG90eXBlLnBhcmFtMD1mdW5jdGlvbihhKXt2YXIgYj17fTthJiZhLnBhcmFtcyYmKGI9YS5wYXJhbXNbMF0pO3JldHVybiBifTthLnByb3RvdHlwZS5pc051bGxDYWxsYmFjaz1mdW5jdGlvbihhKXtyZXR1cm4gdm9pZCAwPT1hfHxudWxsPT1hfTthLnByb3RvdHlwZS51c2VyX2ZyaWVuZGx5X2lkPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY29uc3RydWN0b3IubmFtZStcIltcIit0aGlzLm9pZCtcIl1cIn07YS5wcm90b3R5cGUuaXNSZWRpcmVjdGVkPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaGR4bXMuaXNSZWRpcmVjdGVkKCl9O2EucHJvdG90eXBlLmlzVmFsaWQ9ZnVuY3Rpb24oKXtyZXR1cm4hKHRoaXMucHJveHlzdGF0ZT09PW0uRXJyb3J8fHRoaXMucHJveHlzdGF0ZT09PW0uRGVzdHJveWVkKX07YS5wcm90b3R5cGUucmVnaXN0ZXJTdGF0ZUNoYW5nZU5vdGlmaWNhdGlvbj1mdW5jdGlvbihhKXt0aGlzLmhkeG1zLnJlZ2lzdGVyU3RhdGVDaGFuZ2VOb3RpZmljYXRpb24oYSl9O1xuYS5wcm90b3R5cGUudW5yZWdpc3RlclN0YXRlQ2hhbmdlTm90aWZpY2F0aW9uPWZ1bmN0aW9uKGEpe3RoaXMuaGR4bXMudW5yZWdpc3RlclN0YXRlQ2hhbmdlTm90aWZpY2F0aW9uKGEpfTthLm5leHRJZD0wO2EubmV4dGNiaWQ9MDtyZXR1cm4gYX0oKTthLlByb3h5T2JqZWN0PWJ9LDE0NDpmdW5jdGlvbihiLGEsYyl7ZnVuY3Rpb24gZChhKXtmb3IodmFyIGI9W10sYz0wO2M8YS5sZW5ndGg7YysrKWIucHVzaCh7b2lkOmFbY10ub2JqZWN0X2lkKCl9KTtyZXR1cm4gYn12YXIgZT10aGlzJiZ0aGlzLl9fZXh0ZW5kc3x8ZnVuY3Rpb24oKXt2YXIgYT1mdW5jdGlvbihiLGMpe2E9T2JqZWN0LnNldFByb3RvdHlwZU9mfHx7X19wcm90b19fOltdfWluc3RhbmNlb2YgQXJyYXkmJmZ1bmN0aW9uKGEsYil7YS5fX3Byb3RvX189Yn18fGZ1bmN0aW9uKGEsYil7Zm9yKHZhciBjIGluIGIpYi5oYXNPd25Qcm9wZXJ0eShjKSYmKGFbY109YltjXSl9O3JldHVybiBhKGIsYyl9O3JldHVybiBmdW5jdGlvbihiLFxuYyl7ZnVuY3Rpb24gZCgpe3RoaXMuY29uc3RydWN0b3I9Yn1hKGIsYyk7Yi5wcm90b3R5cGU9bnVsbD09PWM/T2JqZWN0LmNyZWF0ZShjKTooZC5wcm90b3R5cGU9Yy5wcm90b3R5cGUsbmV3IGQpfX0oKSxyPXRoaXMmJnRoaXMuX19hd2FpdGVyfHxmdW5jdGlvbihhLGIsYyxkKXtmdW5jdGlvbiBtKGEpe3JldHVybiBhIGluc3RhbmNlb2YgYz9hOm5ldyBjKGZ1bmN0aW9uKGIpe2IoYSl9KX1yZXR1cm4gbmV3IChjfHwoYz1Qcm9taXNlKSkoZnVuY3Rpb24oYyxxKXtmdW5jdGlvbiBsKGEpe3RyeXtnKGQubmV4dChhKSl9Y2F0Y2goYil7cShiKX19ZnVuY3Rpb24gaChhKXt0cnl7ZyhkW1widGhyb3dcIl0oYSkpfWNhdGNoKGIpe3EoYil9fWZ1bmN0aW9uIGcoYSl7YS5kb25lP2MoYS52YWx1ZSk6bShhLnZhbHVlKS50aGVuKGwsaCl9ZygoZD1kLmFwcGx5KGEsYnx8W10pKS5uZXh0KCkpfSl9LG49dGhpcyYmdGhpcy5fX2dlbmVyYXRvcnx8ZnVuY3Rpb24oYSxiKXtmdW5jdGlvbiBjKGEpe3JldHVybiBmdW5jdGlvbihiKXtyZXR1cm4gZChbYSxcbmJdKX19ZnVuY3Rpb24gZChjKXtpZihoKXRocm93IG5ldyBUeXBlRXJyb3IoXCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBleGVjdXRpbmcuXCIpO2Zvcig7bTspdHJ5e2lmKGg9MSxnJiYobD1jWzBdJjI/Z1tcInJldHVyblwiXTpjWzBdP2dbXCJ0aHJvd1wiXXx8KChsPWdbXCJyZXR1cm5cIl0pJiZsLmNhbGwoZyksMCk6Zy5uZXh0KSYmIShsPWwuY2FsbChnLGNbMV0pKS5kb25lKXJldHVybiBsO2lmKGc9MCxsKWM9W2NbMF0mMixsLnZhbHVlXTtzd2l0Y2goY1swXSl7Y2FzZSAwOmNhc2UgMTpsPWM7YnJlYWs7Y2FzZSA0OnJldHVybiBtLmxhYmVsKysse3ZhbHVlOmNbMV0sZG9uZTohMX07Y2FzZSA1Om0ubGFiZWwrKztnPWNbMV07Yz1bMF07Y29udGludWU7Y2FzZSA3OmM9bS5vcHMucG9wKCk7bS50cnlzLnBvcCgpO2NvbnRpbnVlO2RlZmF1bHQ6aWYoIShsPW0udHJ5cyxsPTA8bC5sZW5ndGgmJmxbbC5sZW5ndGgtMV0pJiYoNj09PWNbMF18fDI9PT1jWzBdKSl7bT0wO2NvbnRpbnVlfWlmKDM9PT1jWzBdJiZcbighbHx8Y1sxXT5sWzBdJiZjWzFdPGxbM10pKW0ubGFiZWw9Y1sxXTtlbHNlIGlmKDY9PT1jWzBdJiZtLmxhYmVsPGxbMV0pbS5sYWJlbD1sWzFdLGw9YztlbHNlIGlmKGwmJm0ubGFiZWw8bFsyXSltLmxhYmVsPWxbMl0sbS5vcHMucHVzaChjKTtlbHNle2xbMl0mJm0ub3BzLnBvcCgpO20udHJ5cy5wb3AoKTtjb250aW51ZX19Yz1iLmNhbGwoYSxtKX1jYXRjaChxKXtjPVs2LHFdLGc9MH1maW5hbGx5e2g9bD0wfWlmKGNbMF0mNSl0aHJvdyBjWzFdO3JldHVybnt2YWx1ZTpjWzBdP2NbMV06dm9pZCAwLGRvbmU6ITB9fXZhciBtPXtsYWJlbDowLHNlbnQ6ZnVuY3Rpb24oKXtpZihsWzBdJjEpdGhyb3cgbFsxXTtyZXR1cm4gbFsxXX0sdHJ5czpbXSxvcHM6W119LGgsZyxsLGY7JGpzY29tcC5pbml0U3ltYm9sKCk7JGpzY29tcC5pbml0U3ltYm9sKCk7JGpzY29tcC5pbml0U3ltYm9sSXRlcmF0b3IoKTtyZXR1cm4gZj17bmV4dDpjKDApLFwidGhyb3dcIjpjKDEpLFwicmV0dXJuXCI6YygyKX0sXG5cImZ1bmN0aW9uXCI9PT10eXBlb2YgU3ltYm9sJiYoZltTeW1ib2wuaXRlcmF0b3JdPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9KSxmfTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYSxcIl9fZXNNb2R1bGVcIix7dmFsdWU6ITB9KTt2YXIgZz1jKDU1MCkscD1jKDY1OCksZj1jKDg1MSksaz1jKDk0NikseD1jKDM5NCksbTthLmVudW1lcmF0ZWRkZWNpY2VzPW07dmFyIEQ9ZnVuY3Rpb24oKXtyZXR1cm4gZnVuY3Rpb24oYSxiKXt0aGlzLnR5cGU9YTt0aGlzLnRhcmdldD1ifX0oKSxCPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gYSgpe3RoaXMuaXNfbG9jYWxfY2xvbmU9ITE7dGhpcy5jbG9uZV9pZD10aGlzLmNsb25lX2NvdW50PTB9YS5wcm90b3R5cGUuY2xvbmU9ZnVuY3Rpb24oKXt0aGlzLmNsb25lX2NvdW50Kys7dmFyIGI9bmV3IGE7Yi5pc19sb2NhbF9jbG9uZT0hMDtiLmNsb25lX2lkPXRoaXMuY2xvbmVfY291bnQ7cmV0dXJuIGJ9O2EucHJvdG90eXBlLnN5bmNocm9uaXplPWZ1bmN0aW9uKGEpe3JldHVybiByKHRoaXMsXG52b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKCl7cmV0dXJuIG4odGhpcyxmdW5jdGlvbihiKXtyZXR1cm4gdGhpcy5pc19sb2NhbF9jbG9uZT9bMixhLmFzeW5jQ2xvbmUoKV06WzIsYV19KX0pfTtyZXR1cm4gYX0oKSx0PWZ1bmN0aW9uKGEpe2Z1bmN0aW9uIGIoYyxkKXt2YXIgbT1hLmNhbGwodGhpcyxjLGcuY2xhc3NfaWRfdC5NZWRpYVN0cmVhbVRyYWNrLGQscC5Qcm94eU1vZGUuUmVtb3RlKXx8dGhpczttLnJlZkNvdW50Xz0wO20ucmVmQ291bnRfKys7bS5jbG9uZV9zdGF0ZT1uZXcgQjtyZXR1cm4gbX1lKGIsYSk7Yi5wcm90b3R5cGUuZHVtcEluZm89ZnVuY3Rpb24oKXtmLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZHVtcEluZm8oKSBbaWQ9XCIrdGhpcy5pZCtcIl0ga2luZD1cIit0aGlzLmtpbmQrXCIgbGFiZWw9XCIrdGhpcy5sYWJlbCtcIiByZWZjb3VudD1cIit0aGlzLnJlZmNvdW50KX07T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwicmVmY291bnRcIixcbntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5yZWZDb3VudF99LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7Yi5wcm90b3R5cGUuYWRkUmVmPWZ1bmN0aW9uKCl7dGhpcy5yZWZDb3VudF8rKztmLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuYWRkUmVmKCkgY2FsbGVkLiBbaWQ9XCIrdGhpcy5pZCtcIl0gcmVmY291bnQ9XCIrdGhpcy5yZWZDb3VudF8pfTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYi5wcm90b3R5cGUsXCJvbmVuZGVkXCIse2dldDpmdW5jdGlvbigpe2YubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5nZXRfb25lbmRlZCgpIGNhbGxlZC4gW2lkPVwiK3RoaXMuaWQrXCJdXCIpO3JldHVybiB0aGlzLm9uZW5kZWRffSxzZXQ6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcztmLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc2V0X29uZW5kZWQoKSBjYWxsZWQuIFtpZD1cIit0aGlzLmlkK1wiXVwiKTt0aGlzLm9uZW5kZWRfPVxuYTt0aGlzLndhaXRVbnRpbENvbm5lY3RlZChcIk1lZGlhU3RyZWFtVHJhY2sub25lbmRlZFwiKS50aGVuKGZ1bmN0aW9uKCl7dmFyIGM9Yi5yZWdpc3RlckNhbGxiYWNrcyghMSxiLmlzTnVsbENhbGxiYWNrKGEpLGcubWV0aG9kX2lkX01lZGlhU3RyZWFtVHJhY2tfdC5vbmVuZGVkKTtjLnRoZW4oZnVuY3Rpb24oYSl7Zi5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wib25lbmRlZCBldmVudCByZWNlaXZlZCEhIVwiKTthPW5ldyBEKFwiZW5kZWRcIixiKTtiLnJlYWR5U3RhdGVfPVwiZW5kZWRcIjtiLm9uZW5kZWRfKGEpfSk7cmV0dXJuIGIucmVtb3RlSW52b2tlKCEwLGcubWV0aG9kX2lkX01lZGlhU3RyZWFtVHJhY2tfdC5vbmVuZGVkLGMuc3VjY2Vzcyl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2IubG9nUmVtb3RlSW52b2tlRXJyb3IoYSxcIi5vbmVuZGVkIGZhaWxlZCFcIil9KX0sZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITB9KTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYi5wcm90b3R5cGUsXG5cIm9ubXV0ZVwiLHtnZXQ6ZnVuY3Rpb24oKXtmLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0X29ubXV0ZSgpIGNhbGxlZC4gW2lkPVwiK3RoaXMuaWQrXCJdXCIpO3JldHVybiB0aGlzLm9ubXV0ZV99LHNldDpmdW5jdGlvbihhKXt2YXIgYj10aGlzO2YubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRfb25tdXRlKCkgY2FsbGVkLiBbaWQ9XCIrdGhpcy5pZCtcIl1cIik7dGhpcy5vbm11dGVfPWE7dGhpcy53YWl0VW50aWxDb25uZWN0ZWQoXCJNZWRpYVN0cmVhbVRyYWNrLm9ubXV0ZVwiKS50aGVuKGZ1bmN0aW9uKCl7dmFyIGM9Yi5yZWdpc3RlckNhbGxiYWNrcyghMSxiLmlzTnVsbENhbGxiYWNrKGEpLGcubWV0aG9kX2lkX01lZGlhU3RyZWFtVHJhY2tfdC5vbm11dGUpO2MudGhlbihmdW5jdGlvbihhKXtmLmxvZ2dlci5sb2coYi51c2VyX2ZyaWVuZGx5X2lkKCkrXCJvbm11dGUgZXZlbnQgcmVjZWl2ZWQhISFcIik7YT1uZXcgRChcIm11dGVcIixiKTtiLm11dGVkPVxuITA7Yi5vbm11dGVfKGEpfSk7cmV0dXJuIGIucmVtb3RlSW52b2tlKCEwLGcubWV0aG9kX2lkX01lZGlhU3RyZWFtVHJhY2tfdC5vbm11dGUsYy5zdWNjZXNzKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYSl7Yi5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFwiLm9ubXV0ZSBmYWlsZWQhXCIpfSl9LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwib251bm11dGVcIix7Z2V0OmZ1bmN0aW9uKCl7Zi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmdldF9vbnVubXV0ZSgpIGNhbGxlZC4gW2lkPVwiK3RoaXMuaWQrXCJdXCIpO3JldHVybiB0aGlzLm9udW5tdXRlX30sc2V0OmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXM7Zi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLnNldF9vbnVubXV0ZSgpIGNhbGxlZC4gW2lkPVwiK3RoaXMuaWQrXCJdXCIpO3RoaXMub251bm11dGVfPWE7dGhpcy53YWl0VW50aWxDb25uZWN0ZWQoXCJNZWRpYVN0cmVhbVRyYWNrLm9udW5tdXRlXCIpLnRoZW4oZnVuY3Rpb24oKXt2YXIgYz1cbmIucmVnaXN0ZXJDYWxsYmFja3MoITEsYi5pc051bGxDYWxsYmFjayhhKSxnLm1ldGhvZF9pZF9NZWRpYVN0cmVhbVRyYWNrX3Qub251bm11dGUpO2MudGhlbihmdW5jdGlvbihhKXtmLmxvZ2dlci5sb2coXCJvbnVubXV0ZSBldmVudCByZWNlaXZlZCEhIVwiKTthPW5ldyBEKFwidW5tdXRlXCIsYik7Yi5tdXRlZD0hMTtiLm9udW5tdXRlXyhhKX0pO3JldHVybiBiLnJlbW90ZUludm9rZSghMCxnLm1ldGhvZF9pZF9NZWRpYVN0cmVhbVRyYWNrX3Qub251bm11dGUsYy5zdWNjZXNzKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYSl7Yi5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFwiLm9udW5tdXRlIGZhaWxlZCFcIil9KX0sZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITB9KTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYi5wcm90b3R5cGUsXCJvbnN0b3BcIix7c2V0OmZ1bmN0aW9uKGEpe3RoaXMub25zdG9wXz1hfSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcblwiZW5hYmxlZFwiLHtnZXQ6ZnVuY3Rpb24oKXtmLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0X2VuYWJsZWQoKSBjYWxsZWQuIFtpZD1cIit0aGlzLmlkK1wiLCB2YWx1ZT1cIit0aGlzLmVuYWJsZWRfK1wiXVwiKTtyZXR1cm4gdGhpcy5lbmFibGVkX30sc2V0OmZ1bmN0aW9uKGEpe2YubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRfZW5hYmxlZCgpIGNhbGxlZC4gW2lkPVwiK3RoaXMuaWQrXCIsIHZhbHVlPVwiK2ErXCJdXCIpO3RoaXMuZW5hYmxlZF89YTt0aGlzLnJlbW90ZUludm9rZSghMCxnLm1ldGhvZF9pZF9NZWRpYVN0cmVhbVRyYWNrX3QuZW5hYmxlZCxhKX0sZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITB9KTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYi5wcm90b3R5cGUsXCJyZWFkeVN0YXRlXCIse2dldDpmdW5jdGlvbigpe2YubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5nZXRfcmVhZHlTdGF0ZSgpIGNhbGxlZC4gW2lkPVwiK1xudGhpcy5pZCtcIl1cIik7cmV0dXJuIHRoaXMucmVhZHlTdGF0ZV99LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7Yi5wcm90b3R5cGUuYXN5bmNDbG9uZT1mdW5jdGlvbigpe3JldHVybiByKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbigpe3ZhciBhLGMsZDtyZXR1cm4gbih0aGlzLGZ1bmN0aW9uKG0pe3N3aXRjaChtLmxhYmVsKXtjYXNlIDA6cmV0dXJuWzQsdGhpcy53YWl0VW50aWxDb25uZWN0ZWQoXCJSZW1vdGVNZWRpYVRyYWNrLmFzeW5jQ2xvbmVcIildO2Nhc2UgMTpyZXR1cm4gbS5zZW50KCksWzQsdGhpcy5yZW1vdGVJbnZva2UoITEsZy5tZXRob2RfaWRfTWVkaWFTdHJlYW1UcmFja190LmNsb25lLFtdKV07Y2FzZSAyOnJldHVybiBhPW0uc2VudCgpLGM9dGhpcy5wYXJhbTAoYSksZD1uZXcgYih0aGlzLGMub2lkKSxbMixkLnN5bmNCYXJyaWVyKCldfX0pfSl9O2IucHJvdG90eXBlLmNsb25lPWZ1bmN0aW9uKCl7Zi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1xuXCIuY2xvbmUoKSBjYWxsZWQuIFtpZD1cIit0aGlzLmlkK1wiXVwiKTt2YXIgYT10aGlzLmNsb25lX3N0YXRlLmNsb25lKCksYz1uZXcgYih0aGlzLHRoaXMub2JqZWN0X2lkKCkpO2MuaWQ9dGhpcy5pZCtcIi5cIithLmNsb25lX2lkLnRvU3RyaW5nKCk7Yy5sYWJlbD10aGlzLmxhYmVsO2Mua2luZD10aGlzLmtpbmQ7Yy5lbmFibGVkXz10aGlzLmVuYWJsZWRfO2MubXV0ZWQ9dGhpcy5tdXRlZDtjLnJlYWR5U3RhdGVfPXRoaXMucmVhZHlTdGF0ZV87Yy50cmFja1NldHRpbmdzXz10aGlzLnRyYWNrU2V0dGluZ3NfO2MuY2xvbmVfc3RhdGU9YTtjLmNvbnN0cmFpbnRzXz10aGlzLmNvbnN0cmFpbnRzXztjLmNhcGFiaWxpdGllc189dGhpcy5jYXBhYmlsaXRpZXNfO3JldHVybiBjfTtiLnByb3RvdHlwZS5zdG9wPWZ1bmN0aW9uKCl7dmFyIGE9dGhpcztmLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc3RvcCgpIGNhbGxlZC4gW2lkPVwiK3RoaXMuaWQrXCJdIHJlZmNvdW50PVwiK1xudGhpcy5yZWZDb3VudF8pO3RoaXMucmVhZHlTdGF0ZV89XCJlbmRlZFwiO2lmKDA8dGhpcy5yZWZDb3VudF8mJih0aGlzLnJlZkNvdW50Xy0tLDA9PT10aGlzLnJlZkNvdW50XyYmKGYubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zdG9wKCkgY2FsbGVkLiBbaWQ9XCIrdGhpcy5pZCtcIl0gcmVtb3RlIGludm9raW5nLi4uXCIpLHRoaXMucmVtb3RlSW52b2tlKCExLGcubWV0aG9kX2lkX01lZGlhU3RyZWFtVHJhY2tfdC5zdG9wKVtcImNhdGNoXCJdKGZ1bmN0aW9uKGIpe2EubG9nUmVtb3RlSW52b2tlRXJyb3IoYixcIi5zdG9wIGZhaWxlZCFcIil9KSxcInZpZGVvXCI9PXRoaXMua2luZCYmXCJyZW1vdGVhcHAtdHJhY2tcIj09dGhpcy5sYWJlbCYmay5nZXRSZWRpcmVjdG9yKCkuc3RvcEFwcHNoYXJlKCksbnVsbCE9PXRoaXMub25zdG9wXyYmdm9pZCAwIT10aGlzLm9uc3RvcF8pKSl0aGlzLm9uc3RvcF8oKX07Yi5wcm90b3R5cGUuZ2V0Q2FwYWJpbGl0aWVzPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY2FwYWJpbGl0aWVzX307XG5iLnByb3RvdHlwZS5nZXRDb25zdHJhaW50cz1mdW5jdGlvbigpe3JldHVybiB0aGlzLmNvbnN0cmFpbnRzX307Yi5wcm90b3R5cGUuZ2V0U2V0dGluZ3M9ZnVuY3Rpb24oKXtyZXR1cm5cImF1ZGlvXCI9PXRoaXMua2luZD9mdW5jdGlvbihhKXtyZXR1cm57ZGV2aWNlSWQ6YS5kZXZpY2VJZCxlY2hvQ2FuY2VsbGF0aW9uOmEuZWNob0NhbmNlbGxhdGlvbn19KHRoaXMudHJhY2tTZXR0aW5nc18pOmZ1bmN0aW9uKGEpe3JldHVybnthc3BlY3RSYXRpbzphLmFzcGVjdFJhdGlvLGRldmljZUlkOmEuZGV2aWNlSWQsZnJhbWVSYXRlOmEuZnJhbWVSYXRlLGhlaWdodDphLmhlaWdodCx3aWR0aDphLndpZHRofX0odGhpcy50cmFja1NldHRpbmdzXyl9O2IucHJvdG90eXBlLmFwcGx5Q29uc3RyYWludHM9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcztmLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuYXBwbHlDb25zdHJhaW50cygpIGNhbGxlZC5cIik7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGMsXG5kKXtiLndhaXRVbnRpbENvbm5lY3RlZChcIk1lZGlhU3RyZWFtVHJhY2suYXBwbHlDb25zdHJhaW50c1wiKS50aGVuKGZ1bmN0aW9uKCl7cmV0dXJuIFByb21pc2UuYWxsKFtiLnJlbW90ZUludm9rZSghMSxnLm1ldGhvZF9pZF9NZWRpYVN0cmVhbVRyYWNrX3QuYXBwbHlDb25zdHJhaW50cyxhKSxiLnN5bmNCYXJyaWVyKCldKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oKXtkKHtuYW1lOlwiT3ZlcmNvbnN0cmFpbmVkRXJyb3JcIixtZXNzYWdlOlwiRmFpbGVkIHRvIGFwcGx5IGNvbnN0cmFpbnRzLlwifSl9KS50aGVuKGZ1bmN0aW9uKCl7Yi5jb25zdHJhaW50c189YTtyZXR1cm4gYi5yZW1vdGVJbnZva2UoITEsZy5tZXRob2RfaWRfTWVkaWFTdHJlYW1UcmFja190LmdldENvbnN0cmFpbnRzKX0pLnRoZW4oZnVuY3Rpb24oYSl7Yi5jb25zdHJhaW50c189Yi5wYXJhbTAoYSl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2IubG9nUmVtb3RlSW52b2tlRXJyb3IoYSxcIi5zeW5jQmFycmllcigpIHJlbW90ZSBjbGllbnQgZG9lcyBub3Qgc3VwcG9ydCBnZXRDb25zdHJhaW50cyBtZXRob2QuIElnbm9yZSBpdFwiKX0pLnRoZW4oZnVuY3Rpb24oKXtyZXR1cm4gYygpfSl9KX07XG5iLmNvbnZlcnRSZWFkeVN0YXRlPWZ1bmN0aW9uKGEpe3JldHVybiAwPT1hP1wibGl2ZVwiOlwiZW5kZWRcIn07Yi5wcm90b3R5cGUuc3luY0JhcnJpZXI9ZnVuY3Rpb24oKXt2YXIgYT10aGlzO2YubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zeW5jQmFycmllcigpIGNhbGxlZC5cIik7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGMsZCl7YS53YWl0VW50aWxDb25uZWN0ZWQoXCJNZWRpYVN0cmVhbVRyYWNrLnN5bmNCYXJyaWVyXCIpLnRoZW4oZnVuY3Rpb24oKXtyZXR1cm4gUHJvbWlzZS5hbGwoW2EucmVtb3RlSW52b2tlKCExLGcubWV0aG9kX2lkX01lZGlhU3RyZWFtVHJhY2tfdC5raW5kLFwiXCIpLGEucmVtb3RlSW52b2tlKCExLGcubWV0aG9kX2lkX01lZGlhU3RyZWFtVHJhY2tfdC5pZCxcIlwiKSxhLnJlbW90ZUludm9rZSghMSxnLm1ldGhvZF9pZF9NZWRpYVN0cmVhbVRyYWNrX3QubGFiZWwsXCJcIiksYS5yZW1vdGVJbnZva2UoITEsZy5tZXRob2RfaWRfTWVkaWFTdHJlYW1UcmFja190LmVuYWJsZWQsXG4hMSksYS5yZW1vdGVJbnZva2UoITEsZy5tZXRob2RfaWRfTWVkaWFTdHJlYW1UcmFja190Lm11dGVkLCExKSxhLnJlbW90ZUludm9rZSghMSxnLm1ldGhvZF9pZF9NZWRpYVN0cmVhbVRyYWNrX3QucmVhZHlTdGF0ZSwwKSxhLnJlbW90ZUludm9rZSghMSxnLm1ldGhvZF9pZF9NZWRpYVN0cmVhbVRyYWNrX3QuZ2V0U2V0dGluZ3MpLGEucmVtb3RlSW52b2tlKCExLGcubWV0aG9kX2lkX01lZGlhU3RyZWFtVHJhY2tfdC5nZXRDYXBhYmlsaXRpZXMpXSl9KS50aGVuKGZ1bmN0aW9uKGQpe3ZhciBtPTA7ZD1kLm1hcChmdW5jdGlvbihiKXtyZXR1cm4gYS5wYXJhbTAoYil9KTthLmtpbmQ9ZFswXTthLmlkPWRbMV07YS5sYWJlbD1kWzJdO2EuZW5hYmxlZF89ZFszXTthLm11dGVkPWRbNF07bT1kWzVdO2EudHJhY2tTZXR0aW5nc189ZFs2XTthLmNhcGFiaWxpdGllc189ZFs3XTthLnJlYWR5U3RhdGVfPWIuY29udmVydFJlYWR5U3RhdGUobSk7YyhhKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYil7Yj1cbmEubG9nUmVtb3RlSW52b2tlRXJyb3IoYixcIi5zeW5jQmFycmllcigpIGZhaWxlZCFcIik7ZChiKX0pfSl9O3JldHVybiBifShwLlByb3h5T2JqZWN0KTthLlJlbW90ZU1lZGlhVHJhY2s9dDt2YXIgaD1mdW5jdGlvbigpe3JldHVybiBmdW5jdGlvbigpe319KCksQT1mdW5jdGlvbihhKXtmdW5jdGlvbiBiKGMsbSxoLGYpe3ZvaWQgMD09PWgmJihoPXAuUHJveHlNb2RlLkxvY2FsKTt2b2lkIDA9PT1mJiYoZj1bXSk7Yz1hLmNhbGwodGhpcyxjLGcuY2xhc3NfaWRfdC5NZWRpYVN0cmVhbSxtLGgsbnVsbCxkKGYpKXx8dGhpcztjLmNsb25lX3N0YXRlPW5ldyBCO2MudHJhY2tzXz1mO3JldHVybiBjfWUoYixhKTtiLnByb3RvdHlwZS5kdW1wSW5mbz1mdW5jdGlvbigpe2YubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5kdW1wSW5mbygpIFtpZD1cIit0aGlzLmlkK1wiXSBhY3RpdmU9XCIrdGhpcy5hY3RpdmVfK1wiIG51bSB0cmFja3M9XCIrdGhpcy50cmFja3NfLmxlbmd0aCk7XG5mb3IodmFyIGE9MCxiPXRoaXMudHJhY2tzXzthPGIubGVuZ3RoO2ErKyl7dmFyIGM9YlthXTtjJiZjLmR1bXBJbmZvKCl9fTtiLnByb3RvdHlwZS50b2dnbGVBdWRpbz1mdW5jdGlvbihhKXtmLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIudG9nZ2xlQXVkaW8oKSBjYWxsZWQ6IFwiK2EpO2Zvcih2YXIgYj0wLGM9dGhpcy5nZXRBdWRpb1RyYWNrcygpO2I8Yy5sZW5ndGg7YisrKWNbYl0uZW5hYmxlZD1hfTtiLnByb3RvdHlwZS50b0pTT049ZnVuY3Rpb24oKXt2YXIgYT1uZXcgaDthLmlkPXRoaXMuaWQ7YS5hY3RpdmU9dGhpcy5hY3RpdmVfO2Eub2lkPXRoaXMub2JqZWN0X2lkKCk7cmV0dXJuXCJSZW1vdGVTdHJlYW06XCIrSlNPTi5zdHJpbmdpZnkoYSl9O09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcImFjdGl2ZVwiLHtnZXQ6ZnVuY3Rpb24oKXtmLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0IGFjdGl2ZSgpIGNhbGxlZC4gW2lkPVwiK1xudGhpcy5pZCtcIl0gYWN0aXZlPVwiK3RoaXMuYWN0aXZlXyk7cmV0dXJuIHRoaXMuYWN0aXZlX30sZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITB9KTtiLnByb3RvdHlwZS5nZXRBdWRpb1RyYWNrcz1mdW5jdGlvbigpe2YubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5nZXRBdWRpb1RyYWNrcygpIGNhbGxlZC4gW2lkPVwiK3RoaXMuaWQrXCJdXCIpO2Zvcih2YXIgYT1bXSxiPTAsYz10aGlzLnRyYWNrc187YjxjLmxlbmd0aDtiKyspe3ZhciBkPWNbYl07XCJhdWRpb1wiPT1kLmtpbmQmJmEucHVzaChkKX1yZXR1cm4gYX07Yi5wcm90b3R5cGUuZ2V0VmlkZW9UcmFja3M9ZnVuY3Rpb24oKXtmLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0VmlkZW9UcmFja3MoKSBjYWxsZWQuIFtpZD1cIit0aGlzLmlkK1wiXVwiKTtmb3IodmFyIGE9W10sYj0wLGM9dGhpcy50cmFja3NfO2I8Yy5sZW5ndGg7YisrKXt2YXIgZD1jW2JdO1widmlkZW9cIj09ZC5raW5kJiZcbmEucHVzaChkKX1yZXR1cm4gYX07Yi5wcm90b3R5cGUuZ2V0VHJhY2tzPWZ1bmN0aW9uKCl7Zi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmdldFRyYWNrcygpIGNhbGxlZC4gW2lkPVwiK3RoaXMuaWQrXCJdXCIpO3JldHVybiB0aGlzLnRyYWNrc199O2IucHJvdG90eXBlLmdldFRyYWNrQnlJZD1mdW5jdGlvbihhKXtmLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0VHJhY2tCeUlkKCkgY2FsbGVkLiBbaWQ9XCIrdGhpcy5pZCtcIl1cIik7Zm9yKHZhciBiPTAsYz10aGlzLnRyYWNrc187YjxjLmxlbmd0aDtiKyspe3ZhciBkPWNbYl07aWYoZC5pZD09YSlyZXR1cm4gZH19O2IucHJvdG90eXBlLmFkZFRyYWNrPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXM7Zi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmFkZFRyYWNrKCkgY2FsbGVkLiBbaWQ9XCIrdGhpcy5pZCtcIl1cIik7dGhpcy50cmFja3NfLnB1c2goYSk7YSYmYS5kdW1wSW5mbygpO1xudmFyIGM9dGhpczt0aGlzLndhaXRVbnRpbENvbm5lY3RlZChcIk1lZGlhU3RyZWFtLmFkZFRyYWNrXCIpLnRoZW4oZnVuY3Rpb24oKXtmLmxvZ2dlci5sb2coYy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuYWRkVHJhY2sgcmVtb3RlIGludm9raW5nXCIpO3JldHVybiBjLnJlbW90ZUludm9rZSghMSxnLm1ldGhvZF9pZF9NZWRpYVN0cmVhbV90LmFkZFRyYWNrLHtvaWQ6YS5vYmplY3RfaWQoKX0pfSkudGhlbihmdW5jdGlvbigpe2YubG9nZ2VyLmxvZyhjLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5hZGRUcmFjayBzdWNjZXNzXCIpfSlbXCJjYXRjaFwiXShmdW5jdGlvbihhKXtiLmxvZ1JlbW90ZUludm9rZUVycm9yKGEsXCIuYWRkVHJhY2sgZmFpbGVkIVwiKX0pfTtiLnByb3RvdHlwZS5yZW1vdmVUcmFjaz1mdW5jdGlvbihhKXt2YXIgYj10aGlzO2YubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5yZW1vdmVUcmFjaygpIGNhbGxlZC4gW2lkPVwiK3RoaXMuaWQrXCJdXCIpO3ZhciBjPXRoaXMudHJhY2tzXy5pbmRleE9mKGEpO1xudGhpcy50cmFja3NfLnNwbGljZShjLDEpO3ZhciBkPXRoaXM7dGhpcy53YWl0VW50aWxDb25uZWN0ZWQoXCJNZWRpYVN0cmVhbS5yZW1vdmVUcmFja1wiKS50aGVuKGZ1bmN0aW9uKCl7Zi5sb2dnZXIubG9nKGQudXNlcl9mcmllbmRseV9pZCgpK1wiLnJlbW92ZVRyYWNrIHJlbW90ZSBpbnZva2luZ1wiKTtyZXR1cm4gZC5yZW1vdGVJbnZva2UoITEsZy5tZXRob2RfaWRfTWVkaWFTdHJlYW1fdC5yZW1vdmVUcmFjayx7b2lkOmEub2JqZWN0X2lkKCl9KX0pLnRoZW4oZnVuY3Rpb24oKXtmLmxvZ2dlci5sb2coZC51c2VyX2ZyaWVuZGx5X2lkKCkrXCIucmVtb3ZlVHJhY2sgc3VjY2Vzc1wiKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYSl7Yi5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFwiLnJlbW92ZVRyYWNrIGZhaWxlZCFcIil9KX07Yi5wcm90b3R5cGUuYXN5bmNDbG9uZT1mdW5jdGlvbigpe3JldHVybiByKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbigpe3ZhciBhLGMsZDtyZXR1cm4gbih0aGlzLFxuZnVuY3Rpb24obSl7c3dpdGNoKG0ubGFiZWwpe2Nhc2UgMDpyZXR1cm4gZi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmFzeW5jQ2xvbmUoKSBjYWxsZWQuIFtpZD1cIit0aGlzLmlkK1wiXVwiKSxbNCx0aGlzLndhaXRVbnRpbENvbm5lY3RlZChcImFzeW5jQ2xvbmVcIildO2Nhc2UgMTpyZXR1cm4gbS5zZW50KCksWzQsdGhpcy5yZW1vdGVJbnZva2UoITEsZy5tZXRob2RfaWRfTWVkaWFTdHJlYW1fdC5jbG9uZSxbXSldO2Nhc2UgMjpyZXR1cm4gYT1tLnNlbnQoKSxjb25zb2xlLmxvZyhhKSxjPXRoaXMucGFyYW0wKGEpLGQ9bmV3IGIodGhpcyxjLm9pZCxwLlByb3h5TW9kZS5SZW1vdGUpLFsyLGQuc3luY0JhcnJpZXIoKV19fSl9KX07Yi5wcm90b3R5cGUuY2xvbmU9ZnVuY3Rpb24oKXtmLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuY2xvbmUoKSBjYWxsZWQuIFtpZD1cIit0aGlzLmlkK1wiXVwiKTt2YXIgYT10aGlzLmNsb25lX3N0YXRlLmNsb25lKCksXG5jPW5ldyBiKHRoaXMsdGhpcy5vYmplY3RfaWQoKSxwLlByb3h5TW9kZS5SZW1vdGUpO2MuaWQ9dGhpcy5pZCtcIi5cIithLmNsb25lX2lkLnRvU3RyaW5nKCk7dGhpcy50cmFja3NfLmZvckVhY2goZnVuY3Rpb24oYSl7YS5hZGRSZWYoKX0pO2MudHJhY2tzXz10aGlzLnRyYWNrc187Yy5jbG9uZV9zdGF0ZT1hO3JldHVybiBjfTtiLnByb3RvdHlwZS5zeW5jQmFycmllcj1mdW5jdGlvbigpe3ZhciBhPXRoaXM7Zi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLnN5bmNCYXJyaWVyKCkgY2FsbGVkLiBbaWQ9XCIrdGhpcy5pZCtcIl1cIik7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGIsYyl7YS53YWl0VW50aWxDb25uZWN0ZWQoXCJNZWRpYVN0cmVhbS5zeW5jQmFycmllclwiKS50aGVuKGZ1bmN0aW9uKCl7cmV0dXJuIFByb21pc2UuYWxsKFthLnJlbW90ZUludm9rZSghMSxnLm1ldGhvZF9pZF9NZWRpYVN0cmVhbV90LmlkLFwiXCIpLGEucmVtb3RlSW52b2tlKCExLGcubWV0aG9kX2lkX01lZGlhU3RyZWFtX3QuYWN0aXZlLFxuITEpLGEucmVtb3RlSW52b2tlKCExLGcubWV0aG9kX2lkX01lZGlhU3RyZWFtX3QuZ2V0VHJhY2tzLFtdKV0pfSkudGhlbihmdW5jdGlvbihiKXtmLmxvZ2dlci5sb2coYS51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc3luY0JhcnJpZXIoKSByZW1vdGUgc3VjY2Vzc1wiKTtiPWIubWFwKGZ1bmN0aW9uKGIpe3JldHVybiBhLnBhcmFtMChiKX0pO2EuaWQ9YlswXTthLmFjdGl2ZV89YlsxXTtiPWJbMl07Zm9yKHZhciBjPVtdLGw9ZnVuY3Rpb24oYil7dmFyIGw9YS50cmFja3NfLmZpbmQoZnVuY3Rpb24oYSl7cmV0dXJuIGEub2JqZWN0X2lkKCk9PT1iLm9pZH0pO3ZvaWQgMD09PWwmJihmLmxvZ2dlci5sb2coYS51c2VyX2ZyaWVuZGx5X2lkKCkrXCIgYWRkaW5nIGEgUmVtb3RlTWVkaWFUcmFjayB3aXRoIG9pZDpcIitiLm9pZCksbD1uZXcgdChhLGIub2lkKSk7Yy5wdXNoKGwuc3luY0JhcnJpZXIoKSl9LGQ9MDtkPGIubGVuZ3RoO2QrKylsKGJbZF0pO3JldHVybiBQcm9taXNlLmFsbChjKX0pLnRoZW4oZnVuY3Rpb24oYyl7YS50cmFja3NfPVxuW107Yy5mb3JFYWNoKGZ1bmN0aW9uKGIpe2Iub25zdG9wPWZ1bmN0aW9uKCl7dmFyIGI9ITA7YS50cmFja3NfLmZvckVhY2goZnVuY3Rpb24oYSl7XCJlbmRlZFwiIT1hLnJlYWR5U3RhdGUmJihiPSExKX0pO2ImJmEucmVsZWFzZSgpfTthLnRyYWNrc18ucHVzaChiKX0pO2IoYSl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGIpe2EubG9nUmVtb3RlSW52b2tlRXJyb3IoYixcIi5zeW5jQmFycmllciBmYWlsZWQhXCIpO2MoKX0pfSl9O3JldHVybiBifShwLlByb3h5T2JqZWN0KTthLlJlbW90ZVN0cmVhbT1BO2I9ZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYihjLGQpe3JldHVybiBhLmNhbGwodGhpcyxjLGcuY2xhc3NfaWRfdC5NZWRpYVN0cmVhbUV2ZW50LGQscC5Qcm94eU1vZGUuUmVtb3RlKXx8dGhpc31lKGIsYSk7Yi5wcm90b3R5cGUuc3luY0JhcnJpZXI9ZnVuY3Rpb24oKXt2YXIgYT10aGlzO2YubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zeW5jQmFycmllcigpIGNhbGxlZC5cIik7XG5yZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24oYixjKXthLndhaXRVbnRpbENvbm5lY3RlZChcIk1lZGlhU3RyZWFtRXZlbnQuc3luY0JhcnJpZXJcIikudGhlbihmdW5jdGlvbigpe3JldHVybiBhLnJlbW90ZUludm9rZSghMSxnLm1ldGhvZF9pZF9NZWRpYVN0cmVhbUV2ZW50X3Quc3RyZWFtLHtvaWQ6MH0pfSkudGhlbihmdW5jdGlvbihiKXtyZXR1cm4obmV3IEEoYSxiLnBhcmFtc1swXS5vaWQscC5Qcm94eU1vZGUuUmVtb3RlKSkuc3luY0JhcnJpZXIoKX0pLnRoZW4oZnVuY3Rpb24oYyl7YS5zdHJlYW09YztiKGEpfSlbXCJjYXRjaFwiXShmdW5jdGlvbihiKXtiPWEubG9nUmVtb3RlSW52b2tlRXJyb3IoYixcIi5zeW5jQmFycmllcigpIGZhaWxlZCFcIik7YyhiKX0pfSl9O3JldHVybiBifShwLlByb3h5T2JqZWN0KTthLlJlbW90ZVN0cmVhbUV2ZW50PWI7dmFyIHk9ZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYihjKXtyZXR1cm4gYS5jYWxsKHRoaXMsbnVsbCxnLmNsYXNzX2lkX3QuTWVkaWFEZXZpY2VJbmZvLFxuYyxwLlByb3h5TW9kZS5SZW1vdGUpfHx0aGlzfWUoYixhKTtiLnByb3RvdHlwZS5jb252ZXJ0S2luZD1mdW5jdGlvbihhKXtyZXR1cm4gMD09YT9cImF1ZGlvaW5wdXRcIjoxPT1hP1wiYXVkaW9vdXRwdXRcIjpcInZpZGVvaW5wdXRcIn07Yi5wcm90b3R5cGUuc3luY0JhcnJpZXI9ZnVuY3Rpb24oKXt2YXIgYT10aGlzO2YubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zeW5jQmFycmllcigpIGNhbGxlZC5cIik7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGIsYyl7YS53YWl0VW50aWxDb25uZWN0ZWQoXCJSZW1vdGVEZXZpY2VJbmZvLnN5bmNCYXJyaWVyXCIpLnRoZW4oZnVuY3Rpb24oKXtyZXR1cm4gUHJvbWlzZS5hbGwoW2EucmVtb3RlSW52b2tlKCExLGcubWV0aG9kX2lkX01lZGlhRGV2aWNlSW5mb190LmRldmljZUlkLFwiXCIpLGEucmVtb3RlSW52b2tlKCExLGcubWV0aG9kX2lkX01lZGlhRGV2aWNlSW5mb190LmtpbmQsMCksYS5yZW1vdGVJbnZva2UoITEsZy5tZXRob2RfaWRfTWVkaWFEZXZpY2VJbmZvX3QubGFiZWwsXG5cIlwiKSxhLnJlbW90ZUludm9rZSghMSxnLm1ldGhvZF9pZF9NZWRpYURldmljZUluZm9fdC5ncm91cElkLFwiXCIpXSl9KS50aGVuKGZ1bmN0aW9uKGMpe2Eua2luZD1hLmNvbnZlcnRLaW5kKGEucGFyYW0wKGMuc3BsaWNlKDEsMSlbMF0pKTtjPWMubWFwKGZ1bmN0aW9uKGIpe3JldHVybiBhLnBhcmFtMChiKX0pO2EuZGV2aWNlSWQ9Y1swXTthLmxhYmVsPWNbMV07YS5ncm91cElkPWNbMl07YihhKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYil7Yj1hLmxvZ1JlbW90ZUludm9rZUVycm9yKGIsXCIuc3luY0JhcnJpZXIoKSBmYWlsZWQhXCIpO2MoYil9KX0pfTtyZXR1cm4gYn0ocC5Qcm94eU9iamVjdCk7YS5SZW1vdGVEZXZpY2VJbmZvPXk7Yj1mdW5jdGlvbihiKXtmdW5jdGlvbiBjKCl7dmFyIGE9Yi5jYWxsKHRoaXMsbnVsbCxnLmNsYXNzX2lkX3QuTWVkaWFEZXZpY2VzLDAscC5Qcm94eU1vZGUuTG9jYWwsZnVuY3Rpb24oKXthLnNldERldmljZUNoYW5nZUNhbGxiYWNrKCl9KXx8dGhpczthLmRldmljZXNfPVxuW107YS5wZW5kaW5nRW51bWVyYXRlRGV2aWNlXz1bXTtyZXR1cm4gYX1lKGMsYik7T2JqZWN0LmRlZmluZVByb3BlcnR5KGMucHJvdG90eXBlLFwicGFuZWxpZFwiLHtzZXQ6ZnVuY3Rpb24oYSl7dGhpcy5wYW5lbGlkXz1hfSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO2MucHJvdG90eXBlLmNsZWFyUGFuZWxJZD1mdW5jdGlvbigpe3RoaXMucGFuZWxpZF89LTF9O2MucHJvdG90eXBlLmVudW1lcmF0ZURldmljZXM9ZnVuY3Rpb24oKXt2YXIgYT10aGlzO3JldHVybiAwPHRoaXMuZGV2aWNlc18ubGVuZ3RoJiYwPT10aGlzLnBlbmRpbmdFbnVtZXJhdGVEZXZpY2VfLmxlbmd0aD9uZXcgUHJvbWlzZShmdW5jdGlvbihiLGMpe2YubG9nZ2VyLmxvZyhhLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5lbnVtZXJhdGVEZXZpY2VzOiByZXR1cm5pbmcgY2FjaGVkIGRldmljZXMgd2l0aCBpZHMgW1wiK2EuZGV2aWNlc18ubWFwKGZ1bmN0aW9uKGEpe3JldHVybiBhLm9iamVjdF9pZCgpfSkrXCJdXCIpO1xuYihhLmRldmljZXNfKX0pOnRoaXMuZW51bWVyYXRlRGV2aWNlc1ByaXZhdGUoITEpfTtjLnByb3RvdHlwZS5wb3N0RW51bWVyYXRlRGV2aWNlc1Jlc3VsdD1mdW5jdGlvbigpe2Zvcih2YXIgYT0hMCxiPTAsYz0wLGQ9dGhpcy5wZW5kaW5nRW51bWVyYXRlRGV2aWNlXztjPGQubGVuZ3RoO2MrKyl7dmFyIG09ZFtjXTtpZigwPT1hJiZcImVudW1lcmF0ZURldmljZXNQcml2YXRlLXJlbW90ZVwiPT1tLm5hbWUpYnJlYWs7bS5wb3N0V2l0aFJlc3VsdCghMCx0aGlzLmRldmljZXNfKTtiKys7YT0hMX0wPGImJnRoaXMucGVuZGluZ0VudW1lcmF0ZURldmljZV8uc3BsaWNlKDAsYil9O2MucHJvdG90eXBlLmVudW1lcmF0ZURldmljZXNQcml2YXRlPWZ1bmN0aW9uKGIpe3ZhciBjPXRoaXM7Zi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmVudW1lcmF0ZURldmljZXNQcml2YXRlKCkgY2FsbGVkLiByZWZyZXNoOlwiK2IrXCIgcGVuZGluZzpcIit0aGlzLnBlbmRpbmdFbnVtZXJhdGVEZXZpY2VfLmxlbmd0aCk7XG5yZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24oZCxoKXsxPT1ifHwwPT1jLnBlbmRpbmdFbnVtZXJhdGVEZXZpY2VfLmxlbmd0aD8oYy5wZW5kaW5nRW51bWVyYXRlRGV2aWNlXy5wdXNoKG5ldyBwLmRlZmVycmVkX2FjdGlvbihkLGgsXCJlbnVtZXJhdGVEZXZpY2VzUHJpdmF0ZS1yZW1vdGVcIikpLGMud2FpdFVudGlsQ29ubmVjdGVkKFwiUmVtb3RlRGV2aWNlcy5lbnVtZXJhdGVEZXZpY2VzUHJpdmF0ZVwiKS50aGVuKGZ1bmN0aW9uKCl7Zi5sb2dnZXIubG9nKGMudXNlcl9mcmllbmRseV9pZCgpK1wiLmVudW1lcmF0ZURldmljZXNQcml2YXRlKCkgcmVtb3RlIGludm9raW5nLi4uXCIpO3JldHVybiBjLnJlbW90ZUludm9rZSghMSxnLm1ldGhvZF9pZF9NZWRpYURldmljZXNfdC5lbnVtZXJhdGVEZXZpY2VzLFtdKX0pLnRoZW4oZnVuY3Rpb24oYSl7dmFyIGI9W107YS5wYXJhbXNbMF0uZm9yRWFjaChmdW5jdGlvbihhKXt2YXIgZD1jLmRldmljZXNfLmZpbmQoZnVuY3Rpb24oYil7cmV0dXJuIGIub2JqZWN0X2lkKCk9PT1cbmEub2lkfSk7dm9pZCAwPT09ZD8oZD1uZXcgeShhLm9pZCksYi5wdXNoKGQuc3luY0JhcnJpZXIoKSkpOmIucHVzaChkKX0pO3JldHVybiBQcm9taXNlLmFsbChiKX0pLnRoZW4oZnVuY3Rpb24oYil7Yy5kZXZpY2VzXy5mb3JFYWNoKGZ1bmN0aW9uKGEpe2Zvcih2YXIgYz0hMCxkPTA7ZDxiLmxlbmd0aDtkKyspe3ZhciBxPWJbZF07aWYoYS5vYmplY3RfaWQoKT09PXEub2JqZWN0X2lkKCkpe2M9ITE7YnJlYWt9fWMmJmEucmVsZWFzZSgpfSk7Yy5kZXZpY2VzXz1iO2EuZW51bWVyYXRlZGRlY2ljZXM9bT1iO2YubG9nZ2VyLmxvZyhjLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5lbnVtZXJhdGVEZXZpY2VzUHJpdmF0ZTogcmVzb2x2aW5nIGVudW1lcmF0ZWQgZGV2aWNlcyB3aXRoIGlkcyBbXCIrYi5tYXAoZnVuY3Rpb24oYSl7cmV0dXJuIGEub2JqZWN0X2lkKCl9KStcIl1cIik7Yy5wb3N0RW51bWVyYXRlRGV2aWNlc1Jlc3VsdCgpfSlbXCJjYXRjaFwiXShmdW5jdGlvbihiKXtjLmRldmljZXNfPVxuW107YS5lbnVtZXJhdGVkZGVjaWNlcz1tPVtdO2MubG9nUmVtb3RlSW52b2tlRXJyb3IoYixcIi5lbnVtZXJhdGVEZXZpY2VzUHJpdmF0ZSgpIGZhaWxlZCwgcmVzb2x2aW5nIHdpdGggZW1wdHkgbGlzdC5cIik7Yy5wb3N0RW51bWVyYXRlRGV2aWNlc1Jlc3VsdCgpfSkpOihjLnBlbmRpbmdFbnVtZXJhdGVEZXZpY2VfLnB1c2gobmV3IHAuZGVmZXJyZWRfYWN0aW9uKGQsaCxcImVudW1lcmF0ZURldmljZXNQcml2YXRlXCIpKSxmLmxvZ2dlci5sb2coYy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZW51bWVyYXRlRGV2aWNlc1ByaXZhdGUoKSBub3QgcmVtb3RpbmcgdGhpcyBjYWxsLi4uXCIpKX0pfTtjLnByb3RvdHlwZS5nZXREaXNwbGF5TWVkaWE9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcztyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24oYyxkKXtiLndhaXRVbnRpbENvbm5lY3RlZChcIlJlbW90ZURldmljZXMuZ2V0RGlzcGxheU1lZGlhXCIpLnRoZW4oZnVuY3Rpb24oKXtyZXR1cm4gYi5Jc1BhbmVsSWRWYWxpZCgpfSkudGhlbihmdW5jdGlvbigpe3ZvaWQgMCE9PVxuYS52aWRlbyYmbnVsbCE9PWEudmlkZW8mJnZvaWQgMCE9PWIucGFuZWxpZF8mJihhLnZpZGVvLmRldmljZUlkPWIucGFuZWxpZF8pO3ZhciBjPWIucHJlcGFyZURpc3BsYXlDb25zdHJhaW50cyhhKTtyZXR1cm4gYi5yZW1vdGVJbnZva2UoITEsZy5tZXRob2RfaWRfTWVkaWFEZXZpY2VzX3QuZ2V0RGlzcGxheU1lZGlhLGMpfSkudGhlbihmdW5jdGlvbihhKXtyZXR1cm4obmV3IEEobnVsbCxhLnBhcmFtc1swXS5vaWQscC5Qcm94eU1vZGUuUmVtb3RlKSkuc3luY0JhcnJpZXIoKX0pLnRoZW4oZnVuY3Rpb24oYSl7YyhhKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYSl7YT1iLmxvZ1JlbW90ZUludm9rZUVycm9yKGEsXCIuZ2V0RGlzcGxheU1lZGlhKCkgZmFpbGVkIVwiKTtkKGEpfSl9KX07Yy5wcm90b3R5cGUuc2V0RGV2aWNlQ2hhbmdlQ2FsbGJhY2s9ZnVuY3Rpb24oKXt2YXIgYT10aGlzO2YubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRfRGV2aWNlQ2hhbmdlQ2FsbGJhY2soKSBjYWxsZWQuXCIpO1xudGhpcy53YWl0VW50aWxDb25uZWN0ZWQoXCJNZWRpYURldmljZXMub25kZXZpY2VjaGFuZ2VcIikudGhlbihmdW5jdGlvbigpe3ZhciBiPWEucmVnaXN0ZXJDYWxsYmFja3MoITEsITEsZy5tZXRob2RfaWRfTWVkaWFEZXZpY2VzX3Qub25kZXZpY2VjaGFuZ2UpO2IudGhlbihmdW5jdGlvbigpe2YubG9nZ2VyLmxvZyhhLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5vbmRldmljZWNoYW5nZSgpOiBjYWxsYmFjayByZWNlaXZlZCEhIVwiKTthLmVudW1lcmF0ZURldmljZXNQcml2YXRlKCEwKS50aGVuKGZ1bmN0aW9uKCl7bmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudChcImRldmljZWNoYW5nZVwiKSl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKCl7bmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudChcImRldmljZWNoYW5nZVwiKSl9KX0pO3JldHVybiBhLnJlbW90ZUludm9rZSghMCxnLm1ldGhvZF9pZF9NZWRpYURldmljZXNfdC5vbmRldmljZWNoYW5nZSxcbmIuc3VjY2Vzcyl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGIpe2EubG9nUmVtb3RlSW52b2tlRXJyb3IoYixcIi5zZXRfb25kZXZpY2VjaGFuZ2UoKSBmYWlsZWQhXCIpfSl9O2MucHJvdG90eXBlLnByZXBhcmVEaXNwbGF5Q29uc3RyYWludHM9ZnVuY3Rpb24oYSl7aWYoay5nZXRSZWRpcmVjdG9yKCkuZ2V0RmVhdHVyZVZhbHVlKGcuRkVBVFVSRV9tc190ZWFtc19jb21tb25fbWVkaWFfY29uc3RyYWludHMpKXJldHVybiBhO3ZhciBiPXtmcmFtZVJhdGU6MTUsd2lkdGg6e21heDoxOTIwfSxoZWlnaHQ6e21heDoxMDgwfX07dm9pZCAwIT09YS52aWRlbyYmbnVsbCE9PWEudmlkZW8mJihhPWEudmlkZW8sdm9pZCAwIT09YS5mcmFtZVJhdGUmJnZvaWQgMCE9PWEud2lkdGgmJnZvaWQgMCE9PWEuaGVpZ2h0JiYoYi5mcmFtZVJhdGU9YS5mcmFtZVJhdGUsYi53aWR0aC5tYXg9YS53aWR0aC5tYXh8fGEud2lkdGgsYi5oZWlnaHQubWF4PWEuaGVpZ2h0Lm1heHx8YS5oZWlnaHQpKTtyZXR1cm57dmlkZW86Yn19O1xuYy5wcm90b3R5cGUuSXNQYW5lbElkVmFsaWQ9ZnVuY3Rpb24oKXt2YXIgYT10aGlzO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihiLGMpe2lmKC0xIT09YS5wYW5lbGlkXylmLmxvZ2dlci5sb2coYS51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuSXNQYW5lbElkVmFsaWQoKSByZXNvbHZpbmcgd2l0aCBwYW5lbGlkXzpcIithLnBhbmVsaWRfKSxiKCk7ZWxzZSB2YXIgZD0wLG09c2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXtmLmxvZ2dlci5sb2coYS51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuSXNQYW5lbElkVmFsaWQoKSB3YWl0aW5nIHBhbmVsaWRfOlwiK2EucGFuZWxpZF8pOzUwPD1kPyhjKCksY2xlYXJJbnRlcnZhbChtKSxmLmxvZ2dlci5sb2coYS51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuSXNQYW5lbElkVmFsaWQoKTogUGFuZWxJZCBpcyBpbnZhbGlkLlwiKSk6KCsrZCwtMSE9YS5wYW5lbGlkXyYmKGIoKSxjbGVhckludGVydmFsKG0pLGYubG9nZ2VyLmxvZyhhLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5Jc1BhbmVsSWRWYWxpZCgpOiBQYW5lbElkIGlzIHZhbGlkLlwiKSkpfSxcbjEwKX0pfTtyZXR1cm4gY30ocC5Qcm94eU9iamVjdCk7YS5SZW1vdGVEZXZpY2VzPWI7Yj1mdW5jdGlvbihhKXtmdW5jdGlvbiBiKCl7cmV0dXJuIGEuY2FsbCh0aGlzLG51bGwsZy5jbGFzc19pZF90Lk5hdmlnYXRvclVzZXJNZWRpYSwwLHAuUHJveHlNb2RlLkxvY2FsKXx8dGhpc31lKGIsYSk7Yi5nZXRDYXBhYmlsaXRpZXM9ZnVuY3Rpb24oYSl7Zi5sb2dnZXIubG9nKHRoaXMuY29uc3RydWN0b3IubmFtZStcIi5nZXRDYXBhYmlsaXRpZXMoKSBjYWxsZWQ6XCIrYStcIiBjYXBzOlwiK2IuY2Fwc18pO3JldHVybiBiLmNhcHNfW2FdfTtiLnJlc2V0Y2Fwcz1mdW5jdGlvbigpe2IuY2Fwc189e319O2IucHJvdG90eXBlLmdldENhcGFiaWxpdGllcz1mdW5jdGlvbigpe3ZhciBhPXRoaXM7Zi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmdldENhcGFiaWxpdGllcygpIGNhbGxlZDogXCIpO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihjLGQpe2Eud2FpdFVudGlsQ29ubmVjdGVkKGEudXNlcl9mcmllbmRseV9pZCgpK1xuXCIuZ2V0Q2FwYWJpbGl0aWVzXCIpLnRoZW4oZnVuY3Rpb24oKXtyZXR1cm4gUHJvbWlzZS5hbGwoW2EucmVtb3RlSW52b2tlKCExLGcubWV0aG9kX2lkX05hdmlnYXRvclVzZXJNZWRpYV90LmdldENhcGFiaWxpdGllcyxcImF1ZGlvXCIpLGEucmVtb3RlSW52b2tlKCExLGcubWV0aG9kX2lkX05hdmlnYXRvclVzZXJNZWRpYV90LmdldENhcGFiaWxpdGllcyxcInZpZGVvXCIpXSl9KS50aGVuKGZ1bmN0aW9uKGQpe2IuY2Fwc18uYXVkaW89YS5wYXJhbTAoZFswXSk7Yi5jYXBzXy52aWRlbz1hLnBhcmFtMChkWzFdKTtjKGIuY2Fwc18pfSlbXCJjYXRjaFwiXShmdW5jdGlvbihiKXtiPWEubG9nUmVtb3RlSW52b2tlRXJyb3IoYixcIi5nZXRDYXBhYmlsaXRpZXMoKSBmYWlsZWQhXCIpO2QoYil9KX0pfTtiLnByb3RvdHlwZS5zZXRDb2RlY0NhcGFiaWxpdGllcz1mdW5jdGlvbihhKXt2YXIgYj10aGlzO2YubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRDb2RlY0NhcGFiaWxpdGllcyA6IHNldCBjb2RlY0NhcGFiaWxpdGllcyB0byBcIitcbkpTT04uc3RyaW5naWZ5KGEpKTtyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24oYyxkKXtiLndhaXRVbnRpbENvbm5lY3RlZChcIk5hdmlnYXRvclVzZXJNZWRpYS5zZXRDb2RlY0NhcGFiaWxpdGllc1wiKS50aGVuKGZ1bmN0aW9uKCl7cmV0dXJuIGIucmVtb3RlSW52b2tlKCExLGcubWV0aG9kX2lkX05hdmlnYXRvclVzZXJNZWRpYV90LnNldENvZGVjQ2FwYWJpbGl0aWVzLGEpfSkudGhlbihmdW5jdGlvbigpe2YubG9nZ2VyLmxvZyhiLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRDb2RlY0NhcGFiaWxpdGllcygpIHN1Y2Nlc3MuXCIpO2MoITApO2IuZ2V0Q2FwYWJpbGl0aWVzKCl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2E9Yi5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFwiLnNldENvZGVjQ2FwYWJpbGl0aWVzKCkgZmFpbGVkIVwiKTtkKGEpfSl9KX07Yi5wcm90b3R5cGUud2Via2l0R2V0VXNlck1lZGlhPWZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gdGhpcy5nZXRVc2VyTWVkaWEoYSxiLGMpfTtcbmIucHJvdG90eXBlLkxvZ1RlbGVtZXRyeURldmljZV89ZnVuY3Rpb24oYSl7dHJ5e2lmKFwidW5kZWZpbmVkXCIhPT10eXBlb2YgYS5hdWRpbyl7dmFyIGI9YS5hdWRpby5kZXZpY2VJZCxjO20uZm9yRWFjaChmdW5jdGlvbihhKXtiPT1hLmRldmljZUlkJiYoYz1hLmxhYmVsKX0pO2YubG9nZ2VyLmxvZyhjKTt0aGlzLlNlbmRUZWxlbWV0cnlEYXRhKHgudGVsX2tleV9BdWRpb0RldmljZVVzZWQsYywwKX1pZihcInVuZGVmaW5lZFwiIT09dHlwZW9mIGEudmlkZW8pe3ZhciBkPWEudmlkZW8ubWFuZGF0b3J5LnNvdXJjZUlkLGg7bS5mb3JFYWNoKGZ1bmN0aW9uKGEpe2Q9PWEuZGV2aWNlSWQmJihoPWEubGFiZWwpfSk7Zi5sb2dnZXIubG9nKGgpO3RoaXMuU2VuZFRlbGVtZXRyeURhdGEoeC50ZWxfa2V5X1ZpZGVvRGV2aWNlVXNlZCxoLDApfX1jYXRjaChsKXtmLmxvZ2dlci5sb2cobCl9fTtiLnByb3RvdHlwZS5nZXRVc2VyTWVkaWE9ZnVuY3Rpb24oYSxiLGMpe2YubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcblwiLmdldFVzZXJNZWRpYSgpIGNhbGxlZDogXCIrSlNPTi5zdHJpbmdpZnkoYSkpO3JldHVybiBiJiZjP3RoaXMuZ2V0VXNlck1lZGlhX3YxKGEsYixjKTp0aGlzLmdldFVzZXJNZWRpYV92MihhKX07Yi5wcm90b3R5cGUuZ2V0VXNlck1lZGlhX3YyPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXM7Zi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmdldFVzZXJNZWRpYV92MigpIGNhbGxlZDogXCIrSlNPTi5zdHJpbmdpZnkoYSkpO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihjLGQpe2IuZ2V0VXNlck1lZGlhUHJpdmF0ZShhLGZ1bmN0aW9uKGEpe2YubG9nZ2VyLmxvZyhiLnVzZXJfZnJpZW5kbHlfaWQoKStcImdldFVzZXJNZWRpYV92MjogcmVzb2x2aW5nIHN0cmVhbVwiKTtjKGEpfSxmdW5jdGlvbihhKXtmLmxvZ2dlci5sb2coYi51c2VyX2ZyaWVuZGx5X2lkKCkrXCJnZXRVc2VyTWVkaWFfdjI6IHJlamVjdGluZyBzdHJlYW1cIik7ZChhKX0pfSl9O2IucHJvdG90eXBlLmdldFVzZXJNZWRpYV92MT1cbmZ1bmN0aW9uKGEsYixjKXtmLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0VXNlck1lZGlhX3YxKCkgY2FsbGVkOiBcIitKU09OLnN0cmluZ2lmeShhKSk7cmV0dXJuIHRoaXMuZ2V0VXNlck1lZGlhUHJpdmF0ZShhLGIsYyl9O2IucHJvdG90eXBlLmdldFVzZXJNZWRpYVByaXZhdGU9ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPXRoaXM7dGhpcy53YWl0VW50aWxDb25uZWN0ZWQoXCJOYXZpZ2F0b3JVc2VyTWVkaWEuZ2V0VXNlck1lZGlhUHJpdmF0ZVwiKS50aGVuKGZ1bmN0aW9uKCl7dmFyIGI9ZC5yZWdpc3RlckNhbGxiYWNrcyghMCwhMSxnLm1ldGhvZF9pZF9OYXZpZ2F0b3JVc2VyTWVkaWFfdC5nZXRVc2VyTWVkaWEpO2EmJlwidW5kZWZpbmVkXCIhPT10eXBlb2YgYS5hdWRpbyYmMD09T2JqZWN0LmtleXMoYS5hdWRpbykubGVuZ3RoJiYoYS5hdWRpbz17ZHVtbXk6MX0pO2lmKGEmJlwidW5kZWZpbmVkXCIhPT10eXBlb2YgYS52aWRlbyl7dmFyIGM9YS52aWRlbzt2b2lkIDA9PVxuYy5tYW5kYXRvcnkubWF4RnJhbWVSYXRlJiYoYy5tYW5kYXRvcnkubWF4RnJhbWVSYXRlPTMwKTt2b2lkIDA9PWMubWFuZGF0b3J5Lm1pbldpZHRoJiYoYy5tYW5kYXRvcnkubWluV2lkdGg9MzYwKTt2b2lkIDA9PWMubWFuZGF0b3J5Lm1heFdpZHRoJiYoYy5tYW5kYXRvcnkubWF4V2lkdGg9MTkyMCk7dm9pZCAwPT1jLm1hbmRhdG9yeS5taW5IZWlnaHQmJihjLm1hbmRhdG9yeS5taW5IZWlnaHQ9MTgwKTt2b2lkIDA9PWMubWFuZGF0b3J5Lm1heEhlaWdodCYmKGMubWFuZGF0b3J5Lm1heEhlaWdodD0xMDgwKX1kLnJlbW90ZUludm9rZSghMSxnLm1ldGhvZF9pZF9OYXZpZ2F0b3JVc2VyTWVkaWFfdC5nZXRVc2VyTWVkaWEsYSxiLnN1Y2Nlc3MsYi5mYWlsKTtyZXR1cm4gYi5wcm9tKCl9KS50aGVuKGZ1bmN0aW9uKGEpe2YubG9nZ2VyLmxvZyhkLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5nZXRVc2VyTWVkaWFQcml2YXRlOiByZWNlaXZlZCBzdWNjZXNzIGNhbGxiYWNrIVwiKTtyZXR1cm4obmV3IEEobnVsbCxcbmQucGFyYW0wKGEpLm9pZCxwLlByb3h5TW9kZS5SZW1vdGUpKS5zeW5jQmFycmllcigpfSkudGhlbihmdW5jdGlvbihtKXtmLmxvZ2dlci5sb2coZC51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0VXNlck1lZGlhUHJpdmF0ZTogTWVkaWFTdHJlYW0gcmVhZHkgdG8gZGVsaXZlclwiLEpTT04uc3RyaW5naWZ5KG0pKTswPT1tLmdldFRyYWNrcygpLmxlbmd0aD8oZi5sb2dnZXIubG9nKGQudXNlcl9mcmllbmRseV9pZCgpK1wiLmdldFVzZXJNZWRpYVByaXZhdGU6IHJlcG9ydGluZyBubyB0cmFja3MgYXMgZXJyb3IuXCIpLGMoe2NvbnN0cmFpbnROYW1lOlwiXCIsbmFtZTpcIk92ZXJjb25zdHJhaW5lZEVycm9yXCIsbWVzc2FnZTpcIlwifSkpOihkLkxvZ1RlbGVtZXRyeURldmljZV8oYSksYihtKSl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2QubG9nUmVtb3RlSW52b2tlRXJyb3IoYSxcIi5nZXRVc2VyTWVkaWFQcml2YXRlKCkgZmFpbGVkIVwiKTtrLmdldFJlZGlyZWN0b3IoKS5nZXRGZWF0dXJlVmFsdWUoZy5GRUFUVVJFX21zX3RlYW1zXzE5MTIpP1xuZC5wYXJhbTAmJmE/YyhkLnBhcmFtMChhKSk6Yyh7Y29uc3RyYWludE5hbWU6XCJcIixuYW1lOlwiT3ZlcmNvbnN0cmFpbmVkRXJyb3JcIixtZXNzYWdlOlwiXCJ9KTpjKHtjb25zdHJhaW50TmFtZTpcIlwiLG5hbWU6XCJPdmVyY29uc3RyYWluZWRFcnJvclwiLG1lc3NhZ2U6XCJcIn0pfSl9O2IucHJvdG90eXBlLlNlbmRUZWxlbWV0cnlEYXRhPWZ1bmN0aW9uKGEsYixjKXtrLmdldFJlZGlyZWN0b3IoKS50ZWxlbWV0cnkuU2VuZFRlbGVtZXRyeURhdGEoeC50ZWxfY21kLkRhdGEsYSxiLGMpfTtiLmNhcHNfPXt9O3JldHVybiBifShwLlByb3h5T2JqZWN0KTthLk5hdmlnYXRvclVzZXJNZWRpYT1ifSw2NTA6ZnVuY3Rpb24oYixhLGMpe09iamVjdC5kZWZpbmVQcm9wZXJ0eShhLFwiX19lc01vZHVsZVwiLHt2YWx1ZTohMH0pO3ZhciBkPWMoOTQ2KSxlPWMoNTUwKSxyPWMoOSksbj1jKDg1MSksZz1jKDU1MCkscD1jKDM5NCksZjsoZnVuY3Rpb24oYSl7YVthLlVua25vd249MF09XCJVbmtub3duXCI7YVthLldpbmRvd3M9XG4xXT1cIldpbmRvd3NcIjthW2EuTGludXg9Ml09XCJMaW51eFwifSkoZj1hLlJlbW90ZVR5cGV8fChhLlJlbW90ZVR5cGU9e30pKTt2YXIgaz1mdW5jdGlvbigpe3JldHVybiBmdW5jdGlvbigpe319KCk7YS5TZXNzaW9uSW5mbz1rO2I9ZnVuY3Rpb24oKXtmdW5jdGlvbiBhKCl7dmFyIGI9dGhpczt0aGlzLmlzcmVtb3RlXz0hMTt0aGlzLmlzcmVtb3RlXz0hMDt0aGlzLnR5cGVfPWYuV2luZG93czt0aGlzLmFkZHJlc3NfPVwiMC4wLjAuMFwiO3RoaXMuc2Vzc2lvbmluZm9fPW51bGw7ZC5nZXRSZWRpcmVjdG9yKCkuc2V0UmVtb3RlU2Vzc2lvbkluZm9DYihmdW5jdGlvbigpe3JldHVybiBiLnJlbW90ZVNlc3Npb25JbmZvKCl9KTt0aGlzLmVuZ2luZWNvbnRyb2xfPW5ldyByLkVuZ2luZUNvbnRyb2x9YS5wcm90b3R5cGUucmVsZWFzZT1mdW5jdGlvbigpe2QuZ2V0UmVkaXJlY3RvcigpLnNldFJlbW90ZVNlc3Npb25JbmZvQ2IobnVsbCl9O2EucHJvdG90eXBlLnVzZXJfZnJpZW5kbHlfaWQ9ZnVuY3Rpb24oKXtyZXR1cm5cIltSZW1vdGVTZXNzaW9uXVwifTtcbmEucHJvdG90eXBlLmdldEZlYXR1cmVGbGFncz1mdW5jdGlvbigpe3ZhciBhPXt9O251bGwhPT10aGlzLmVuZ2luZWNvbnRyb2xfJiZudWxsIT09dGhpcy5lbmdpbmVjb250cm9sXy5mZWF0dXJlc18mJnZvaWQgMCE9PXRoaXMuZW5naW5lY29udHJvbF8uZmVhdHVyZXNfJiZ0aGlzLmVuZ2luZWNvbnRyb2xfLmZlYXR1cmVzXy5mb3JFYWNoKGZ1bmN0aW9uKGIpe2FbYi5uYW1lXT1iLnZhbHVlfSk7cmV0dXJuIGF9O2EucHJvdG90eXBlLmlzRmVhdHVyZVN1cHBvcnRlZD1mdW5jdGlvbihhKXtpZihcInZpZGVvXCI9PT1hKXJldHVybiEwO2lmKCEoYSBpbiBnLmZlYXR1cmVOYW1lTWFwKSlyZXR1cm4hMTthPWcuZmVhdHVyZU5hbWVNYXBbYV07Zm9yKHZhciBiPXRoaXMuZ2V0RmVhdHVyZUZsYWdzKCksYz0wO2M8YS5sZW5ndGg7YysrKWlmKCEoYVtjXWluIGIpfHwhMCE9PWJbYVtjXV0pcmV0dXJuITE7cmV0dXJuITB9O2EuaXNGZWF0dXJlUHN0blN1cHBvcnRlZD1mdW5jdGlvbigpe3JldHVybiBhLnBzdG5ffTtcbmEuaXNGZWF0dXJlRHRtZlN1cHBvcnRlZD1mdW5jdGlvbigpe3JldHVybiBhLmR0bWZzd2l0Y2hffTthLmlzRmVhdHVyQXBwc2hhcmVTdXBwb3J0ZWQ9ZnVuY3Rpb24oKXtyZXR1cm4gYS5hcHBzaGFyZV99O2EuaXNGZWF0dXJlV2VicnRjMWRvdDBTdXBwb3J0ZWQ9ZnVuY3Rpb24oKXtyZXR1cm4gYS53ZWJydGMxZG90MF99O2EuaXNGZWF0dXJlRGF0YUNoYW5uZWxTdXBwb3J0ZWQ9ZnVuY3Rpb24oKXtyZXR1cm4gYS5kYXRhY2hhbm5lbF99O2EuaXNGZWF0dXJlVmROb0J1ZmZlckxpbWl0U3VwcG9ydGVkPWZ1bmN0aW9uKCl7cmV0dXJuIGEudmRub2J1ZmxpbWl0X307YS5wcm90b3R5cGUuZ2V0U2Vzc2lvbkluZm89ZnVuY3Rpb24oKXtuLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0U2Vzc2lvbkluZm8oKSBjYWxsZWQuXCIpO3JldHVybiBudWxsIT10aGlzLnNlc3Npb25pbmZvXz9Qcm9taXNlLnJlc29sdmUodGhpcy5zZXNzaW9uaW5mb18pOlByb21pc2UucmVqZWN0KCl9O1xuYS5wcm90b3R5cGUucmVtb3RlU2Vzc2lvbkluZm89ZnVuY3Rpb24oKXt2YXIgYj10aGlzLGM9dGhpcztuLmxvZ2dlci5sb2coYy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIucmVtb3RlU2Vzc2lvbkluZm8oKSBjYWxsZWQuXCIpO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihnLGYpe2MuZW5naW5lY29udHJvbF8uc3luY0JhcnJpZXIoKS50aGVuKGZ1bmN0aW9uKGQpe24ubG9nZ2VyLmxvZyhjLnVzZXJfZnJpZW5kbHlfaWQoKStcImVuZ2luZWNvbnRyb2wgaW5mbyByZWNlaXZlZCFcIik7Yy5zZXNzaW9uaW5mb189bmV3IGs7Yy5zZXNzaW9uaW5mb18udHlwZV9zY3JpcHQ9ZS5IRFhNU19WRVJTSU9OO2Muc2Vzc2lvbmluZm9fLndlYnJwYz1kLnZlcnNpb25fLm1ham9yLnRvU3RyaW5nKCkrXCIuXCIrZC52ZXJzaW9uXy5taW5vci50b1N0cmluZygpK1wiLlwiK2QudmVyc2lvbl8ucmV2aXNpb24udG9TdHJpbmcoKStcIi5cIitkLnZlcnNpb25fLmJ1aWxkLnRvU3RyaW5nKCk7aWYodm9pZCAwIT1kLnZlcnNpb25zXyYmXG5udWxsIT1kLnZlcnNpb25zXyl7Yy5TZW5kVGVsZW1ldHJ5RGF0YShwLnRlbF9rZXlfVmVyVHlwZVNjcmlwdCxlLkhEWE1TX1ZFUlNJT04sMCk7Zm9yKHZhciBmPTAsdD0wLEU9ZC52ZXJzaW9uc187dDxFLmxlbmd0aDt0Kyspe3ZhciB1PUVbdF0sdT11Lm1ham9yLnRvU3RyaW5nKCkrXCIuXCIrdS5taW5vci50b1N0cmluZygpK1wiLlwiK3UucmV2aXNpb24udG9TdHJpbmcoKStcIi5cIit1LmJ1aWxkLnRvU3RyaW5nKCk7c3dpdGNoKGYpe2Nhc2Ugci5WZXJzaW9uVHlwZS5XZWJycGM6Yy5zZXNzaW9uaW5mb18ud2VicnBjPXU7Yy5TZW5kVGVsZW1ldHJ5RGF0YShwLnRlbF9rZXlfVmVyV2VicnBjLHUsMCk7YnJlYWs7Y2FzZSByLlZlcnNpb25UeXBlLldlYnJ0Y0NvZGVjczpjLnNlc3Npb25pbmZvXy53ZWJydGNfY29kZWNzPXU7Yy5TZW5kVGVsZW1ldHJ5RGF0YShwLnRlbF9rZXlfVmVyV2VicnRjQ29kZWNzLHUsMCk7YnJlYWs7Y2FzZSByLlZlcnNpb25UeXBlLlJlY2VpdmVyOmMuc2Vzc2lvbmluZm9fLnJlY2VpdmVyPVxudTtjLlNlbmRUZWxlbWV0cnlEYXRhKHAudGVsX2tleV9WZXJSZWNlaXZlcix1LDApO2JyZWFrO2Nhc2Ugci5WZXJzaW9uVHlwZS5WZGE6Yy5zZXNzaW9uaW5mb18udmRhPXU7Yy5TZW5kVGVsZW1ldHJ5RGF0YShwLnRlbF9rZXlfVmVyVmRhLHUsMCk7YnJlYWs7Y2FzZSByLlZlcnNpb25UeXBlLkVuZHBvaW50OmMuc2Vzc2lvbmluZm9fLmVuZHBvaW50PXU7Yy5TZW5kVGVsZW1ldHJ5RGF0YShwLnRlbF9rZXlfVmVyRW5kcG9pbnQsdSwwKTticmVhaztkZWZhdWx0Om4ubG9nZ2VyLmxvZyhjLnVzZXJfZnJpZW5kbHlfaWQoKStcIlVua25vd24gdmVyc2lvbiB0eXBlIVwiKX1mKyt9fXZvaWQgMCE9ZC5vc2luZm9fJiZudWxsIT1kLm9zaW5mb18mJihjLnNlc3Npb25pbmZvXy5vc2luZm89ZC5vc2luZm9fLGQub3NpbmZvXy5mYW1pbHkuaW5jbHVkZXMoXCJEYXJ3aW5cIikmJmQub3NpbmZvXy5lZGl0aW9uLmluY2x1ZGVzKFwiTWFjXCIpP2Muc2Vzc2lvbmluZm9fLmNsaWVudFBsYXRmb3JtPVwiTWFjXCI6XG5jLnNlc3Npb25pbmZvXy5jbGllbnRQbGF0Zm9ybT1kLm9zaW5mb18uZmFtaWx5LGMuU2VuZFRlbGVtZXRyeURhdGEocC50ZWxfa2V5X09TRmFtaWx5LGQub3NpbmZvXy5mYW1pbHksMCksYy5TZW5kVGVsZW1ldHJ5RGF0YShwLnRlbF9rZXlfT1NWZXJzaW9uLGQub3NpbmZvXy52ZXJzaW9uLDApLGMuU2VuZFRlbGVtZXRyeURhdGEocC50ZWxfa2V5X09TQXJjaGl0ZWN0dXJlLGQub3NpbmZvXy5hcmNoaXRlY3R1cmUsMCksYy5TZW5kVGVsZW1ldHJ5RGF0YShwLnRlbF9rZXlfT1NEaXN0cm8sZC5vc2luZm9fLmRpc3RybywwKSxjLlNlbmRUZWxlbWV0cnlEYXRhKHAudGVsX2tleV9PU0VkaXRpb24sZC5vc2luZm9fLmVkaXRpb24sMCkpO3ZvaWQgMCE9ZC5lbmRwb2ludGlkXyYmbnVsbCE9ZC5lbmRwb2ludGlkXyYmKGMuc2Vzc2lvbmluZm9fLmVuZHBvaW50SWQ9ZC5lbmRwb2ludGlkXy5tYWNoaW5lX2lkKTthLnBzdG5fPWIuaXNGZWF0dXJlU3VwcG9ydGVkKGUuRmVhdHVyZXMuRkVBVFVSRV9wdWJsaWNfcHN0bik7XG5hLmR0bWZzd2l0Y2hfPWIuaXNGZWF0dXJlU3VwcG9ydGVkKGUuRmVhdHVyZXMuRkVBVFVSRV9wdWJsaWNfZHRtZik7YS5hcHBzaGFyZV89Yi5pc0ZlYXR1cmVTdXBwb3J0ZWQoZS5GZWF0dXJlcy5GRUFUVVJFX3B1YmxpY19hcHBfc2hhcmluZyk7YS53ZWJydGMxZG90MF89Yi5pc0ZlYXR1cmVTdXBwb3J0ZWQoZS5GZWF0dXJlcy5GRUFUVVJFX3B1YmxpY193ZWJydGMxZG90MCk7YS5kYXRhY2hhbm5lbF89Yi5pc0ZlYXR1cmVTdXBwb3J0ZWQoZS5GZWF0dXJlcy5GRUFUVVJFX3B1YmxpY19kYXRhX2NoYW5uZWwpO2EudmRub2J1ZmxpbWl0Xz1iLmlzRmVhdHVyZVN1cHBvcnRlZChlLkZlYXR1cmVzLkZFQVRVUkVfcHVibGljX3Zkbm9idWZsaW1pdCk7ZyhjLnNlc3Npb25pbmZvXyk7Yy5lbmdpbmVjb250cm9sXy5yZWxlYXNlKCl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKCl7ZC5nZXRSZWRpcmVjdG9yKCkuaXNQaW5nQWN0aXZlKCk/Yy5yZXRyeVNlc3Npb25JbmZvKCk6KGYoKSxjLmVuZ2luZWNvbnRyb2xfLnJlbGVhc2UoKSxcbmMuZW5naW5lY29udHJvbF89bnVsbCl9KX0pfTthLnByb3RvdHlwZS5yZXRyeVNlc3Npb25JbmZvPWZ1bmN0aW9uKCl7dmFyIGE9dGhpcztzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7bi5sb2dnZXIubG9nKFwiY2hlY2tpbmcgaWYgd2UgYXJlIGNvbm5lY3RlZC4uLlwiKTthLmVuZ2luZWNvbnRyb2xfLmJpbmQoKTtkLmdldFJlZGlyZWN0b3IoKS5oYW5kbGVSZW1vdGVTZXNzaW9uSW5mbygpfSwxNUUzKX07YS5wcm90b3R5cGUuU2VuZFRlbGVtZXRyeURhdGE9ZnVuY3Rpb24oYSxiLGMpe2QuZ2V0UmVkaXJlY3RvcigpLnRlbGVtZXRyeS5TZW5kVGVsZW1ldHJ5RGF0YShwLnRlbF9jbWQuRGF0YSxhLGIsYyl9O2EucHN0bl89ITE7YS5kdG1mc3dpdGNoXz0hMTthLmFwcHNoYXJlXz0hMTthLndlYnJ0YzFkb3QwXz0hMTthLmRhdGFjaGFubmVsXz0hMTthLnZkbm9idWZsaW1pdF89ITE7cmV0dXJuIGF9KCk7YS5SZW1vdGVTZXNzaW9uPWJ9LDI0OmZ1bmN0aW9uKGIsYSxjKXt2YXIgZD10aGlzJiZ0aGlzLl9fZXh0ZW5kc3x8XG5mdW5jdGlvbigpe3ZhciBhPWZ1bmN0aW9uKGIsYyl7YT1PYmplY3Quc2V0UHJvdG90eXBlT2Z8fHtfX3Byb3RvX186W119aW5zdGFuY2VvZiBBcnJheSYmZnVuY3Rpb24oYSxiKXthLl9fcHJvdG9fXz1ifXx8ZnVuY3Rpb24oYSxiKXtmb3IodmFyIGMgaW4gYiliLmhhc093blByb3BlcnR5KGMpJiYoYVtjXT1iW2NdKX07cmV0dXJuIGEoYixjKX07cmV0dXJuIGZ1bmN0aW9uKGIsYyl7ZnVuY3Rpb24gZCgpe3RoaXMuY29uc3RydWN0b3I9Yn1hKGIsYyk7Yi5wcm90b3R5cGU9bnVsbD09PWM/T2JqZWN0LmNyZWF0ZShjKTooZC5wcm90b3R5cGU9Yy5wcm90b3R5cGUsbmV3IGQpfX0oKTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYSxcIl9fZXNNb2R1bGVcIix7dmFsdWU6ITB9KTt2YXIgZT1jKDY1OCkscj1jKDU1MCksbj1jKDg1MSksZz1jKDU4OSkscDsoZnVuY3Rpb24oYSl7YVthW1wibmV3XCJdPTBdPVwibmV3XCI7YVthLmNvbm5lY3Rpbmc9MV09XCJjb25uZWN0aW5nXCI7YVthLmNvbm5lY3RlZD0yXT1cblwiY29ubmVjdGVkXCI7YVthLmNsb3NlZD0zXT1cImNsb3NlZFwiO2FbYS5tYXg9NF09XCJtYXhcIn0pKHB8fChwPXt9KSk7Yj1mdW5jdGlvbihhKXtmdW5jdGlvbiBiKGMsZCl7dmFyIGc9YS5jYWxsKHRoaXMsYyxyLmNsYXNzX2lkX3QuUlRDU2N0cFRyYW5zcG9ydCxkLGUuUHJveHlNb2RlLlJlbW90ZSl8fHRoaXM7bi5sb2dnZXIubG9nKGcudXNlcl9mcmllbmRseV9pZCgpK1wiLmNvbnN0cnVjdG9yXCIpO3JldHVybiBnfWQoYixhKTtiLnByb3RvdHlwZS5zeW5jQmFycmllcj1mdW5jdGlvbigpe3ZhciBhPXRoaXM7bi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLnN5bmNCYXJyaWVyKCkgY2FsbGVkLlwiKTtyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24oYixjKXthLndhaXRVbnRpbENvbm5lY3RlZChcIlJUQ1NjdHBUcmFuc3BvcnQuc3luY0JhcnJpZXJcIikudGhlbihmdW5jdGlvbigpe24ubG9nZ2VyLmxvZyhhLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zeW5jQmFycmllckJhc2Ugc3VjY2Vzcy5cIik7XG5yZXR1cm4gUHJvbWlzZS5hbGwoW2EucmVtb3RlSW52b2tlKCExLHIubWV0aG9kX2lkX1JUQ1NjdHBUcmFuc3BvcnRfdC50cmFuc3BvcnQse30pLGEucmVtb3RlSW52b2tlKCExLHIubWV0aG9kX2lkX1JUQ1NjdHBUcmFuc3BvcnRfdC5zdGF0ZSxcIlwiKSxhLnJlbW90ZUludm9rZSghMSxyLm1ldGhvZF9pZF9SVENTY3RwVHJhbnNwb3J0X3QubWF4TWVzc2FnZVNpemUsMCksYS5yZW1vdGVJbnZva2UoITEsci5tZXRob2RfaWRfUlRDU2N0cFRyYW5zcG9ydF90Lm1heENoYW5uZWxzLDApXSl9KS50aGVuKGZ1bmN0aW9uKGMpe3ZhciBkO2Q9Yy5tYXAoZnVuY3Rpb24oYil7cmV0dXJuIGEucGFyYW0wKGIpfSk7Yz1kWzBdO2Euc2N0cHN0YXRlXz1kWzFdO2EubWF4TWVzc2FnZVNpemVfPWRbMl07YS5tYXhDaGFubmVsc189ZFszXTtkPWEudHJhbnNwb3J0Xzt2b2lkIDA9PWN8fCExIT09Yy5pc19udWxsfHxudWxsIT09YS50cmFuc3BvcnRfJiZhLnRyYW5zcG9ydF8ub2JqZWN0X2lkKCk9PWMub2lkfHxcbihkPW5ldyBnLkR0bHNUcmFuc3BvcnQoYSxjLm9pZCkpO2Quc3luY0JhcnJpZXIoKS50aGVuKGZ1bmN0aW9uKGMpe24ubG9nZ2VyLmxvZyhhLnVzZXJfZnJpZW5kbHlfaWQoKStcInRyYW5zcG9ydC5zeW5jQmFycmllcigpOiBzdWNjZXNzXCIpO2EudHJhbnNwb3J0Xz1jO2IoYSl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKCl7bi5sb2dnZXIubG9nKGEudXNlcl9mcmllbmRseV9pZCgpK1widHJhbnNwb3J0LnN5bmNCYXJyaWVyKCk6IGZhaWxlZCFcIik7YS50cmFuc3BvcnRfPW51bGw7YihhKX0pfSlbXCJjYXRjaFwiXShmdW5jdGlvbihiKXtiPWEubG9nUmVtb3RlSW52b2tlRXJyb3IoYixcIi5zeW5jQmFycmllcigpIGZhaWxlZCFcIik7YyhiKX0pfSl9O09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcInRyYW5zcG9ydFwiLHtnZXQ6ZnVuY3Rpb24oKXtuLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0X3RyYW5zcG9ydCgpIGNhbGxlZDogXCIrdGhpcy50cmFuc3BvcnRfKTtcbnJldHVybiB0aGlzLnRyYW5zcG9ydF99LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwic3RhdGVcIix7Z2V0OmZ1bmN0aW9uKCl7bi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmdldF9zdGF0ZSgpIGNhbGxlZDogXCIrdGhpcy5zY3Rwc3RhdGVfKTtyZXR1cm4gdGhpcy5zY3Rwc3RhdGVffSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcIm1heE1lc3NhZ2VTaXplXCIse2dldDpmdW5jdGlvbigpe24ubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5nZXRfbWF4TWVzc2FnZVNpemUoKSBjYWxsZWQ6IFwiK3RoaXMubWF4TWVzc2FnZVNpemVfKTtyZXR1cm4gdGhpcy5tYXhNZXNzYWdlU2l6ZV99LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFxuXCJtYXhDaGFubmVsc1wiLHtnZXQ6ZnVuY3Rpb24oKXtuLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0X21heENoYW5uZWxzKCkgY2FsbGVkOiBcIit0aGlzLm1heENoYW5uZWxzXyk7cmV0dXJuIHRoaXMubWF4Q2hhbm5lbHNffSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcIm9uc3RhdGVjaGFuZ2VcIix7Z2V0OmZ1bmN0aW9uKCl7bi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmdldF9vbnN0YXRlY2hhbmdlKCkgY2FsbGVkOiBcIit0aGlzLm9uc3RhdGVjaGFuZ2VfKTtyZXR1cm4gdGhpcy5vbnN0YXRlY2hhbmdlX30sc2V0OmZ1bmN0aW9uKGEpe3ZhciBjPXRoaXM7bi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLnNldF9vbnN0YXRlY2hhbmdlKCkgY2FsbGVkLlwiKTt0aGlzLm9uc3RhdGVjaGFuZ2VfPWE7dGhpcy53YWl0VW50aWxDb25uZWN0ZWQodGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXG5cIi5vbnN0YXRlY2hhbmdlXCIpLnRoZW4oZnVuY3Rpb24oKXt2YXIgZD1jLnJlZ2lzdGVyQ2FsbGJhY2tzKCExLGMuaXNOdWxsQ2FsbGJhY2soYSksci5tZXRob2RfaWRfUlRDU2N0cFRyYW5zcG9ydF90Lm9uc3RhdGVjaGFuZ2UpO2QudGhlbihmdW5jdGlvbihhKXtuLmxvZ2dlci5sb2coYy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIub25zdGF0ZWNoYW5nZSBjYWxsYmFjayByZWNlaXZlZCEhIVwiKTtjLnNjdHBzdGF0ZV89Yi5jb252ZXJ0U3RhdGUoYy5wYXJhbTAoYSkpO24ubG9nZ2VyLmxvZyhjLnVzZXJfZnJpZW5kbHlfaWQoKStcInNjdHBzdGF0ZV86IFwiK2Muc2N0cHN0YXRlXyk7YT1uZXcgRXZlbnQoXCJvbnN0YXRlY2hhbmdlXCIpO2Mub25zdGF0ZWNoYW5nZV8oYSl9KTtyZXR1cm4gYy5yZW1vdGVJbnZva2UoITAsci5tZXRob2RfaWRfUlRDU2N0cFRyYW5zcG9ydF90Lm9uc3RhdGVjaGFuZ2UsZC5zdWNjZXNzKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oKXtuLmxvZ2dlci5sb2coYy51c2VyX2ZyaWVuZGx5X2lkKCkrXG5cIi5vbnN0YXRlY2hhbmdlKCkgZmFpbGVkLlwiKX0pfSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO2IuY29udmVydFN0YXRlPWZ1bmN0aW9uKGEpe3JldHVybiBhPT1wW1wibmV3XCJdP1wiY2xvc2VkXCI6YT09cC5jb25uZWN0aW5nP1wiY29ubmVjdGluZ1wiOmE9PXAuY29ubmVjdGVkP1wiY29ubmVjdGVkXCI6XCJjbG9zZWRcIn07cmV0dXJuIGJ9KGUuUHJveHlPYmplY3QpO2EuUlRDU2N0cFRyYW5zcG9ydD1iO3ZhciBmOyhmdW5jdGlvbihhKXthW2EuY29ubmVjdGluZz0wXT1cImNvbm5lY3RpbmdcIjthW2Eub3Blbj0xXT1cIm9wZW5cIjthW2EuY2xvc2luZz0yXT1cImNsb3NpbmdcIjthW2EuY2xvc2VkPTNdPVwiY2xvc2VkXCJ9KShmfHwoZj17fSkpO2I9ZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYihjLGQsZyl7Yz1hLmNhbGwodGhpcyxjLHIuY2xhc3NfaWRfdC5SVENEYXRhQ2hhbm5lbCxkLGcpfHx0aGlzO2MuYmluYXJ5VHlwZV89XCJibG9iXCI7bi5sb2dnZXIubG9nKGMudXNlcl9mcmllbmRseV9pZCgpK1xuXCIuY29uc3RydWN0b3JcIik7cmV0dXJuIGN9ZChiLGEpO2IucHJvdG90eXBlLnN5bmNCYXJyaWVyPWZ1bmN0aW9uKCl7dmFyIGE9dGhpcztuLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc3luY0JhcnJpZXIoKSBjYWxsZWQuXCIpO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihiLGMpe2Eud2FpdFVudGlsQ29ubmVjdGVkKFwiUnRjRGF0YUNoYW5uZWwuc3luY0JhcnJpZXJcIikudGhlbihmdW5jdGlvbigpe24ubG9nZ2VyLmxvZyhhLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zeW5jQmFycmllciByZW1vdGUgaW52b2tpbmcuXCIpO3JldHVybiBQcm9taXNlLmFsbChbYS5yZW1vdGVJbnZva2UoITEsci5tZXRob2RfaWRfUlRDRGF0YUNoYW5uZWxfdC5sYWJlbCxcIlwiKSxhLnJlbW90ZUludm9rZSghMSxyLm1ldGhvZF9pZF9SVENEYXRhQ2hhbm5lbF90Lm9yZGVyZWQsITApLGEucmVtb3RlSW52b2tlKCExLHIubWV0aG9kX2lkX1JUQ0RhdGFDaGFubmVsX3QubWF4UGFja2V0TGlmZVRpbWUsXG4wKSxhLnJlbW90ZUludm9rZSghMSxyLm1ldGhvZF9pZF9SVENEYXRhQ2hhbm5lbF90Lm1heFJldHJhbnNtaXRzLDApLGEucmVtb3RlSW52b2tlKCExLHIubWV0aG9kX2lkX1JUQ0RhdGFDaGFubmVsX3QucHJvdG9jb2wsXCJcIiksYS5yZW1vdGVJbnZva2UoITEsci5tZXRob2RfaWRfUlRDRGF0YUNoYW5uZWxfdC5uZWdvdGlhdGVkLCExKSxhLnJlbW90ZUludm9rZSghMSxyLm1ldGhvZF9pZF9SVENEYXRhQ2hhbm5lbF90LmlkLDApLGEucmVtb3RlSW52b2tlKCExLHIubWV0aG9kX2lkX1JUQ0RhdGFDaGFubmVsX3QucmVhZHlTdGF0ZSxcIlwiKSxhLnJlbW90ZUludm9rZSghMSxyLm1ldGhvZF9pZF9SVENEYXRhQ2hhbm5lbF90LmJ1ZmZlcmVkQW1vdW50LDApLGEucmVtb3RlSW52b2tlKCExLHIubWV0aG9kX2lkX1JUQ0RhdGFDaGFubmVsX3QuYnVmZmVyZWRBbW91bnRMb3dUaHJlc2hvbGQsMCldKX0pLnRoZW4oZnVuY3Rpb24oYyl7bi5sb2dnZXIubG9nKGEudXNlcl9mcmllbmRseV9pZCgpK1xuXCIuc3luY0JhcnJpZXIgc3VjY2Vzcy5cIik7dmFyIGQ7Yz1jLm1hcChmdW5jdGlvbihiKXtyZXR1cm4gYS5wYXJhbTAoYil9KTthLmxhYmVsXz1jWzBdO2Eub3JkZXJlZF89Y1sxXTthLm1heFBhY2tldExpZmVUaW1lXz1jWzJdO2EubWF4UmV0cmFuc21pdHNfPWNbM107YS5wcm90b2NvbF89Y1s0XTthLm5lZ290aWF0ZWRfPWNbNV07YS5pZF89Y1s2XTtkPWNbN107YS5idWZmZXJlZEFtb3VudF89Y1s4XTthLmJ1ZmZlcmVkQW1vdW50TG93VGhyZXNob2xkXz1jWzldO2EucmVhZHlTdGF0ZV89YS50b1JUQ0RhdGFDaGFubmVsU3RhdGUoZCk7YihhKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYil7Yj1hLmxvZ1JlbW90ZUludm9rZUVycm9yKGIsXCIuc3luY0JhcnJpZXIoKSBmYWlsZWQhXCIpO2MoYil9KX0pfTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYi5wcm90b3R5cGUsXCJsYWJlbFwiLHtnZXQ6ZnVuY3Rpb24oKXtuLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0X2xhYmVsKCkgY2FsbGVkOiBcIitcbnRoaXMubGFiZWxfKTtyZXR1cm4gdGhpcy5sYWJlbF99LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwib3JkZXJlZFwiLHtnZXQ6ZnVuY3Rpb24oKXtuLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0X29yZGVyZWQoKSBjYWxsZWQ6IFwiK3RoaXMub3JkZXJlZF8pO3JldHVybiB0aGlzLm9yZGVyZWRffSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcIm1heFBhY2tldExpZmVUaW1lXCIse2dldDpmdW5jdGlvbigpe24ubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5nZXRfbWF4UGFja2V0TGlmZVRpbWUoKSBjYWxsZWQ6IFwiK3RoaXMubWF4UGFja2V0TGlmZVRpbWVfKTtyZXR1cm4gdGhpcy5tYXhQYWNrZXRMaWZlVGltZV99LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFxuXCJtYXhSZXRyYW5zbWl0c1wiLHtnZXQ6ZnVuY3Rpb24oKXtuLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0X21heFJldHJhbnNtaXRzKCkgY2FsbGVkOiBcIit0aGlzLm1heFJldHJhbnNtaXRzXyk7cmV0dXJuIHRoaXMubWF4UmV0cmFuc21pdHNffSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcInByb3RvY29sXCIse2dldDpmdW5jdGlvbigpe24ubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5nZXRfcHJvdG9jb2woKSBjYWxsZWQ6IFwiK3RoaXMucHJvdG9jb2xfKTtyZXR1cm4gdGhpcy5wcm90b2NvbF99LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwibmVnb3RpYXRlZFwiLHtnZXQ6ZnVuY3Rpb24oKXtuLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0X25lZ290aWF0ZWQoKSBjYWxsZWQ6IFwiK1xudGhpcy5uZWdvdGlhdGVkXyk7cmV0dXJuIHRoaXMubmVnb3RpYXRlZF99LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwiaWRcIix7Z2V0OmZ1bmN0aW9uKCl7bi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmdldF9pZCgpIGNhbGxlZDogXCIrdGhpcy5pZF8pO3JldHVybiB0aGlzLmlkX30sZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITB9KTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYi5wcm90b3R5cGUsXCJyZWFkeVN0YXRlXCIse2dldDpmdW5jdGlvbigpe24ubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5nZXRfcmVhZHlTdGF0ZSgpIGNhbGxlZDogXCIrdGhpcy5yZWFkeVN0YXRlXyk7cmV0dXJuIHRoaXMucmVhZHlTdGF0ZV99LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwiYnVmZmVyZWRBbW91bnRcIixcbntnZXQ6ZnVuY3Rpb24oKXtuLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0X2J1ZmZlcmVkQW1vdW50KCkgY2FsbGVkOiBcIit0aGlzLmJ1ZmZlcmVkQW1vdW50Xyk7cmV0dXJuIHRoaXMuYnVmZmVyZWRBbW91bnRffSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcImJ1ZmZlcmVkQW1vdW50TG93VGhyZXNob2xkXCIse2dldDpmdW5jdGlvbigpe24ubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5nZXRfYnVmZmVyZWRBbW91bnRMb3dUaHJlc2hvbGQoKSBjYWxsZWQ6IFwiK3RoaXMuYnVmZmVyZWRBbW91bnRMb3dUaHJlc2hvbGRfKTtyZXR1cm4gdGhpcy5idWZmZXJlZEFtb3VudExvd1RocmVzaG9sZF99LHNldDpmdW5jdGlvbihhKXtuLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0X2J1ZmZlcmVkQW1vdW50TG93VGhyZXNob2xkKCkgY2FsbGVkOiBcIitcbmEpO3RoaXMuYnVmZmVyZWRBbW91bnRMb3dUaHJlc2hvbGRfPWF9LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwiYmluYXJ5VHlwZVwiLHtnZXQ6ZnVuY3Rpb24oKXtuLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0X2JpbmFyeVR5cGUoKSBjYWxsZWQ6IFwiK3RoaXMuYmluYXJ5VHlwZV8pO3JldHVybiB0aGlzLmJpbmFyeVR5cGVffSxzZXQ6ZnVuY3Rpb24oYSl7bi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLnNldF9iaW5hcnlUeXBlKCkgY2FsbGVkOiBcIithKTt0aGlzLmJpbmFyeVR5cGVfPVwiYmxvYlwiPT1hfHxcImFycmF5YnVmZmVyXCI9PWE/YTpcImJsb2JcIn0sZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITB9KTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYi5wcm90b3R5cGUsXCJvbm9wZW5cIix7Z2V0OmZ1bmN0aW9uKCl7bi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1xuXCIuZ2V0X29ub3BlbigpIGNhbGxlZC5cIik7cmV0dXJuIHRoaXMub25vcGVuX30sc2V0OmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXM7bi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLnNldF9vbm9wZW4oKSBjYWxsZWQuXCIpO3RoaXMub25vcGVuXz1hO3RoaXMud2FpdFVudGlsQ29ubmVjdGVkKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLm9ub3BlblwiKS50aGVuKGZ1bmN0aW9uKCl7dmFyIGM9Yi5yZWdpc3RlckNhbGxiYWNrcyghMSxiLmlzTnVsbENhbGxiYWNrKGEpLHIubWV0aG9kX2lkX1JUQ0RhdGFDaGFubmVsX3Qub25vcGVuKTtjLnRoZW4oZnVuY3Rpb24oYSl7bi5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wiLm9ub3BlbiBjYWxsYmFjayByZWNlaXZlZCEhIVwiKTtiLnN5bmNCYXJyaWVyKCkudGhlbihmdW5jdGlvbigpe24ubG9nZ2VyLmxvZyhiLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5vbm9wZW4gbm90aWZ5aW5nLi4uXCIpO3ZhciBhPW5ldyBFdmVudChcIm9wZW5cIixcbnt9KTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYSxcInRhcmdldFwiLHt3cml0YWJsZTohMSx2YWx1ZTpifSk7Yi5vbm9wZW5fKGEpfSlbXCJjYXRjaFwiXShmdW5jdGlvbigpe24ubG9nZ2VyLmxvZyhiLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zeW5jQmFycmllcigpOiBmYWlsZWQhXCIpfSl9KTtyZXR1cm4gYi5yZW1vdGVJbnZva2UoITAsci5tZXRob2RfaWRfUlRDRGF0YUNoYW5uZWxfdC5vbm9wZW4sYy5zdWNjZXNzKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oKXtuLmxvZ2dlci5sb2coYi51c2VyX2ZyaWVuZGx5X2lkKCkrXCIub25vcGVuKCkgZmFpbGVkLlwiKX0pfSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcIm9uYnVmZmVyZWRhbW91bnRsb3dcIix7Z2V0OmZ1bmN0aW9uKCl7bi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmdldF9vbmJ1ZmZlcmVkYW1vdW50bG93KCkgY2FsbGVkLlwiKTtyZXR1cm4gdGhpcy5vbmJ1ZmZlcmVkYW1vdW50bG93X30sXG5zZXQ6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcztuLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc2V0X29uYnVmZmVyZWRhbW91bnRsb3coKSBjYWxsZWQuXCIpO3RoaXMub25idWZmZXJlZGFtb3VudGxvd189YTt0aGlzLndhaXRVbnRpbENvbm5lY3RlZCh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5vbmJ1ZmZlcmVkYW1vdW50bG93XCIpLnRoZW4oZnVuY3Rpb24oKXt2YXIgYz1iLnJlZ2lzdGVyQ2FsbGJhY2tzKCExLGIuaXNOdWxsQ2FsbGJhY2soYSksci5tZXRob2RfaWRfUlRDRGF0YUNoYW5uZWxfdC5vbmJ1ZmZlcmVkYW1vdW50bG93KTtjLnRoZW4oZnVuY3Rpb24oYSl7bi5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wiLm9uYnVmZmVyZWRhbW91bnRsb3cgY2FsbGJhY2sgcmVjZWl2ZWQhISFcIik7YT1uZXcgRXZlbnQoXCJvbmJ1ZmZlcmVkYW1vdW50bG93XCIpO09iamVjdC5kZWZpbmVQcm9wZXJ0eShhLFwidGFyZ2V0XCIse3dyaXRhYmxlOiExLHZhbHVlOmJ9KTtcbmIub25idWZmZXJlZGFtb3VudGxvd18oYSl9KTtyZXR1cm4gYi5yZW1vdGVJbnZva2UoITAsci5tZXRob2RfaWRfUlRDRGF0YUNoYW5uZWxfdC5vbmJ1ZmZlcmVkYW1vdW50bG93LGMuc3VjY2Vzcyl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKCl7bi5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wiLm9uYnVmZmVyZWRhbW91bnRsb3dzKCkgZmFpbGVkLlwiKX0pfSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcIm9uZXJyb3JcIix7Z2V0OmZ1bmN0aW9uKCl7bi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmdldF9vbmVycm9yKCkgY2FsbGVkLlwiKTtyZXR1cm4gdGhpcy5vbmVycm9yX30sc2V0OmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXM7bi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLnNldF9vbmVycm9yKCkgY2FsbGVkLlwiKTt0aGlzLm9uZXJyb3JfPWE7dGhpcy53YWl0VW50aWxDb25uZWN0ZWQodGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXG5cIi5vbmVycm9yXCIpLnRoZW4oZnVuY3Rpb24oKXt2YXIgYz1iLnJlZ2lzdGVyQ2FsbGJhY2tzKCExLGIuaXNOdWxsQ2FsbGJhY2soYSksci5tZXRob2RfaWRfUlRDRGF0YUNoYW5uZWxfdC5vbmVycm9yKTtjLnRoZW4oZnVuY3Rpb24oYSl7bi5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wiLm9uZXJyb3IgY2FsbGJhY2sgcmVjZWl2ZWQhXCIpO2E9Yi5wYXJhbTAoYSk7bi5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wiZXJyb3I6IFwiK2EpO2E9bmV3IEV2ZW50KFwib25lcnJvclwiKTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYSxcInRhcmdldFwiLHt3cml0YWJsZTohMSx2YWx1ZTpifSk7Yi5vbmVycm9yXyhhKX0pO3JldHVybiBiLnJlbW90ZUludm9rZSghMCxyLm1ldGhvZF9pZF9SVENEYXRhQ2hhbm5lbF90Lm9uZXJyb3IsYy5zdWNjZXNzKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oKXtuLmxvZ2dlci5sb2coYi51c2VyX2ZyaWVuZGx5X2lkKCkrXCIub25lcnJvcigpIGZhaWxlZC5cIil9KX0sXG5lbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcIm9uY2xvc2luZ1wiLHtnZXQ6ZnVuY3Rpb24oKXtuLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0X29uY2xvc2luZygpIGNhbGxlZC5cIik7cmV0dXJuIHRoaXMub25jbG9zaW5nX30sc2V0OmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXM7bi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLnNldF9vbmNsb3NpbmcoKSBjYWxsZWQuXCIpO3RoaXMub25jbG9zaW5nXz1hO3RoaXMud2FpdFVudGlsQ29ubmVjdGVkKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLm9uY2xvc2luZ1wiKS50aGVuKGZ1bmN0aW9uKCl7dmFyIGM9Yi5yZWdpc3RlckNhbGxiYWNrcyghMSxiLmlzTnVsbENhbGxiYWNrKGEpLHIubWV0aG9kX2lkX1JUQ0RhdGFDaGFubmVsX3Qub25jbG9zaW5nKTtjLnRoZW4oZnVuY3Rpb24oYSl7bi5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1xuXCIub25jbG9zaW5nIGNhbGxiYWNrIHJlY2VpdmVkISEhXCIpO2E9bmV3IEV2ZW50KFwib25jbG9zaW5nXCIpO09iamVjdC5kZWZpbmVQcm9wZXJ0eShhLFwidGFyZ2V0XCIse3dyaXRhYmxlOiExLHZhbHVlOmJ9KTtiLm9uY2xvc2luZ18oYSl9KTtyZXR1cm4gYi5yZW1vdGVJbnZva2UoITAsci5tZXRob2RfaWRfUlRDRGF0YUNoYW5uZWxfdC5vbmNsb3NpbmcsYy5zdWNjZXNzKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oKXtuLmxvZ2dlci5sb2coYi51c2VyX2ZyaWVuZGx5X2lkKCkrXCIub25jbG9zaW5nKCkgZmFpbGVkLlwiKX0pfSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcIm9uY2xvc2VcIix7Z2V0OmZ1bmN0aW9uKCl7bi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmdldF9vbmNsb3NlKCkgY2FsbGVkLlwiKTtyZXR1cm4gdGhpcy5vbmNsb3NlX30sc2V0OmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXM7bi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1xuXCIuc2V0X29uY2xvc2UoKSBjYWxsZWQuXCIpO3RoaXMub25jbG9zZV89YTt0aGlzLndhaXRVbnRpbENvbm5lY3RlZCh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5vbmNsb3NlXCIpLnRoZW4oZnVuY3Rpb24oKXt2YXIgYz1iLnJlZ2lzdGVyQ2FsbGJhY2tzKCExLGIuaXNOdWxsQ2FsbGJhY2soYSksci5tZXRob2RfaWRfUlRDRGF0YUNoYW5uZWxfdC5vbmNsb3NlKTtjLnRoZW4oZnVuY3Rpb24oYSl7bi5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wiLm9uY2xvc2UgY2FsbGJhY2sgcmVjZWl2ZWQhISFcIik7YT1uZXcgRXZlbnQoXCJvbmNsb3NlXCIpO09iamVjdC5kZWZpbmVQcm9wZXJ0eShhLFwidGFyZ2V0XCIse3dyaXRhYmxlOiExLHZhbHVlOmJ9KTtiLm9uY2xvc2VfKGEpfSk7cmV0dXJuIGIucmVtb3RlSW52b2tlKCEwLHIubWV0aG9kX2lkX1JUQ0RhdGFDaGFubmVsX3Qub25jbG9zZSxjLnN1Y2Nlc3MpfSlbXCJjYXRjaFwiXShmdW5jdGlvbigpe24ubG9nZ2VyLmxvZyhiLnVzZXJfZnJpZW5kbHlfaWQoKStcblwiLm9uY2xvc2UoKSBmYWlsZWQuXCIpfSl9LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwib25tZXNzYWdlXCIse2dldDpmdW5jdGlvbigpe24ubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5nZXRfb25tZXNzYWdlKCkgY2FsbGVkLlwiKTtyZXR1cm4gdGhpcy5vbm1lc3NhZ2VffSxzZXQ6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcztuLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc2V0X29ubWVzc2FnZSgpIGNhbGxlZC5cIik7dGhpcy5vbm1lc3NhZ2VfPWE7dGhpcy53YWl0VW50aWxDb25uZWN0ZWQodGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIub25tZXNzYWdlXCIpLnRoZW4oZnVuY3Rpb24oKXt2YXIgYz1iLnJlZ2lzdGVyQ2FsbGJhY2tzKCExLGIuaXNOdWxsQ2FsbGJhY2soYSksci5tZXRob2RfaWRfUlRDRGF0YUNoYW5uZWxfdC5vbm1lc3NhZ2UpO2MudGhlbihmdW5jdGlvbihhKXtuLmxvZ2dlci5sb2coYi51c2VyX2ZyaWVuZGx5X2lkKCkrXG5cIi5vbm1lc3NhZ2UgY2FsbGJhY2sgcmVjZWl2ZWQhISFcIik7dmFyIGM9Yi5wYXJhbTAoYSk7YT1uZXcgRXZlbnQoXCJvbm1lc3NhZ2VcIik7Yy5iaW5hcnk/YS5kYXRhPWMuZGF0YV9hYjooYz1hdG9iKGMuZGF0YV9zeiksYS5kYXRhPWMpO2Iub25tZXNzYWdlXyhhKX0pO3JldHVybiBiLnJlbW90ZUludm9rZSghMCxyLm1ldGhvZF9pZF9SVENEYXRhQ2hhbm5lbF90Lm9ubWVzc2FnZSxjLnN1Y2Nlc3MpfSlbXCJjYXRjaFwiXShmdW5jdGlvbigpe24ubG9nZ2VyLmxvZyhiLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5vbm1lc3NhZ2UoKSBmYWlsZWQuXCIpfSl9LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7Yi5wcm90b3R5cGUuY2xvc2U9ZnVuY3Rpb24oKXt2YXIgYT10aGlzO24ubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5jbG9zZSgpIGNhbGxlZC5cIik7dGhpcy53YWl0VW50aWxDb25uZWN0ZWQoXCJSVENEYXRhQ2hhbm5lbC5jbG9zZVwiKS50aGVuKGZ1bmN0aW9uKCl7cmV0dXJuIGEucmVtb3RlSW52b2tlKCExLFxuci5tZXRob2RfaWRfUlRDRGF0YUNoYW5uZWxfdC5jbG9zZSl9KS50aGVuKGZ1bmN0aW9uKCl7bi5sb2dnZXIubG9nKGEudXNlcl9mcmllbmRseV9pZCgpK1wiLmNsb3NlOiBzdWNjZXNzLlwiKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oKXtuLmxvZ2dlci5sb2coYS51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuY2xvc2U6IGZhaWxlZC5cIil9KX07Yi5wcm90b3R5cGUudG9CeXRlQXJyYXk9ZnVuY3Rpb24oYSl7dmFyIGI9W107YT1uZXcgVWludDhBcnJheShhIGluc3RhbmNlb2YgQXJyYXlCdWZmZXI/YTphLmJ1ZmZlcik7Zm9yKHZhciBjIGluIGEpYi5wdXNoKGFbY10pO3JldHVybiBifTtiLnByb3RvdHlwZS5zZW5kPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXM7bi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLnNlbmQoKSBjYWxsZWQuXCIpO3RoaXMud2FpdFVudGlsQ29ubmVjdGVkKFwiUlRDRGF0YUNoYW5uZWwuc2VuZFwiKS50aGVuKGZ1bmN0aW9uKCl7aWYoXCJzdHJpbmdcIj09PXR5cGVvZiBhKXJldHVybiBuLmxvZ2dlci5sb2coYi51c2VyX2ZyaWVuZGx5X2lkKCkrXG5cImRhdGEoc3RyaW5nKTogXCIrYSksYi5yZW1vdGVJbnZva2UoITEsci5tZXRob2RfaWRfUlRDRGF0YUNoYW5uZWxfdC5zZW5kX3RleHQsYSk7aWYoYSBpbnN0YW5jZW9mIEJsb2IpYS5hcnJheUJ1ZmZlcigpLnRoZW4oZnVuY3Rpb24oYSl7YT1iLnRvQnl0ZUFycmF5KGEpO3JldHVybiBiLnJlbW90ZUludm9rZSghMSxyLm1ldGhvZF9pZF9SVENEYXRhQ2hhbm5lbF90LnNlbmRfYmluYXJ5LGEpfSlbXCJjYXRjaFwiXShmdW5jdGlvbigpe24ubG9nZ2VyLmxvZyhiLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5hcnJheUJ1ZmZlcigpOiBmYWlsZWQuXCIpfSk7ZWxzZXt2YXIgYz1iLnRvQnl0ZUFycmF5KGEpO3JldHVybiBiLnJlbW90ZUludm9rZSghMSxyLm1ldGhvZF9pZF9SVENEYXRhQ2hhbm5lbF90LnNlbmRfYmluYXJ5LGMpfX0pLnRoZW4oZnVuY3Rpb24oKXtuLmxvZ2dlci5sb2coYi51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc2VuZDogc3VjY2Vzcy5cIil9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKCl7bi5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1xuXCIuc2VuZDogZmFpbGVkLlwiKX0pfTtiLnByb3RvdHlwZS50b1JUQ0RhdGFDaGFubmVsU3RhdGU9ZnVuY3Rpb24oYSl7dmFyIGI9XCJjbG9zZWRcIjthPT1mLmNvbm5lY3Rpbmc/Yj1cImNvbm5lY3RpbmdcIjphPT1mLm9wZW4/Yj1cIm9wZW5cIjphPT1mLmNsb3Npbmc/Yj1cImNsb3NpbmdcIjphPT1mLmNsb3NlZCYmKGI9XCJjbG9zZWRcIik7cmV0dXJuIGJ9O3JldHVybiBifShlLlByb3h5T2JqZWN0KTthLlJ0Y0RhdGFDaGFubmVsPWJ9LDU4OTpmdW5jdGlvbihiLGEsYyl7dmFyIGQ9dGhpcyYmdGhpcy5fX2V4dGVuZHN8fGZ1bmN0aW9uKCl7dmFyIGE9ZnVuY3Rpb24oYixjKXthPU9iamVjdC5zZXRQcm90b3R5cGVPZnx8e19fcHJvdG9fXzpbXX1pbnN0YW5jZW9mIEFycmF5JiZmdW5jdGlvbihhLGIpe2EuX19wcm90b19fPWJ9fHxmdW5jdGlvbihhLGIpe2Zvcih2YXIgYyBpbiBiKWIuaGFzT3duUHJvcGVydHkoYykmJihhW2NdPWJbY10pfTtyZXR1cm4gYShiLGMpfTtyZXR1cm4gZnVuY3Rpb24oYixjKXtmdW5jdGlvbiBkKCl7dGhpcy5jb25zdHJ1Y3Rvcj1cbmJ9YShiLGMpO2IucHJvdG90eXBlPW51bGw9PT1jP09iamVjdC5jcmVhdGUoYyk6KGQucHJvdG90eXBlPWMucHJvdG90eXBlLG5ldyBkKX19KCksZT10aGlzJiZ0aGlzLl9fYXdhaXRlcnx8ZnVuY3Rpb24oYSxiLGMsZCl7ZnVuY3Rpb24gZyhhKXtyZXR1cm4gYSBpbnN0YW5jZW9mIGM/YTpuZXcgYyhmdW5jdGlvbihiKXtiKGEpfSl9cmV0dXJuIG5ldyAoY3x8KGM9UHJvbWlzZSkpKGZ1bmN0aW9uKGMscSl7ZnVuY3Rpb24gbChhKXt0cnl7ZihkLm5leHQoYSkpfWNhdGNoKGIpe3EoYil9fWZ1bmN0aW9uIGgoYSl7dHJ5e2YoZFtcInRocm93XCJdKGEpKX1jYXRjaChiKXtxKGIpfX1mdW5jdGlvbiBmKGEpe2EuZG9uZT9jKGEudmFsdWUpOmcoYS52YWx1ZSkudGhlbihsLGgpfWYoKGQ9ZC5hcHBseShhLGJ8fFtdKSkubmV4dCgpKX0pfSxyPXRoaXMmJnRoaXMuX19nZW5lcmF0b3J8fGZ1bmN0aW9uKGEsYil7ZnVuY3Rpb24gYyhhKXtyZXR1cm4gZnVuY3Rpb24oYil7cmV0dXJuIGQoW2EsYl0pfX1cbmZ1bmN0aW9uIGQoYyl7aWYoaCl0aHJvdyBuZXcgVHlwZUVycm9yKFwiR2VuZXJhdG9yIGlzIGFscmVhZHkgZXhlY3V0aW5nLlwiKTtmb3IoO2c7KXRyeXtpZihoPTEsZiYmKGw9Y1swXSYyP2ZbXCJyZXR1cm5cIl06Y1swXT9mW1widGhyb3dcIl18fCgobD1mW1wicmV0dXJuXCJdKSYmbC5jYWxsKGYpLDApOmYubmV4dCkmJiEobD1sLmNhbGwoZixjWzFdKSkuZG9uZSlyZXR1cm4gbDtpZihmPTAsbCljPVtjWzBdJjIsbC52YWx1ZV07c3dpdGNoKGNbMF0pe2Nhc2UgMDpjYXNlIDE6bD1jO2JyZWFrO2Nhc2UgNDpyZXR1cm4gZy5sYWJlbCsrLHt2YWx1ZTpjWzFdLGRvbmU6ITF9O2Nhc2UgNTpnLmxhYmVsKys7Zj1jWzFdO2M9WzBdO2NvbnRpbnVlO2Nhc2UgNzpjPWcub3BzLnBvcCgpO2cudHJ5cy5wb3AoKTtjb250aW51ZTtkZWZhdWx0OmlmKCEobD1nLnRyeXMsbD0wPGwubGVuZ3RoJiZsW2wubGVuZ3RoLTFdKSYmKDY9PT1jWzBdfHwyPT09Y1swXSkpe2c9MDtjb250aW51ZX1pZigzPT09Y1swXSYmXG4oIWx8fGNbMV0+bFswXSYmY1sxXTxsWzNdKSlnLmxhYmVsPWNbMV07ZWxzZSBpZig2PT09Y1swXSYmZy5sYWJlbDxsWzFdKWcubGFiZWw9bFsxXSxsPWM7ZWxzZSBpZihsJiZnLmxhYmVsPGxbMl0pZy5sYWJlbD1sWzJdLGcub3BzLnB1c2goYyk7ZWxzZXtsWzJdJiZnLm9wcy5wb3AoKTtnLnRyeXMucG9wKCk7Y29udGludWV9fWM9Yi5jYWxsKGEsZyl9Y2F0Y2gocSl7Yz1bNixxXSxmPTB9ZmluYWxseXtoPWw9MH1pZihjWzBdJjUpdGhyb3cgY1sxXTtyZXR1cm57dmFsdWU6Y1swXT9jWzFdOnZvaWQgMCxkb25lOiEwfX12YXIgZz17bGFiZWw6MCxzZW50OmZ1bmN0aW9uKCl7aWYobFswXSYxKXRocm93IGxbMV07cmV0dXJuIGxbMV19LHRyeXM6W10sb3BzOltdfSxoLGYsbCxlOyRqc2NvbXAuaW5pdFN5bWJvbCgpOyRqc2NvbXAuaW5pdFN5bWJvbCgpOyRqc2NvbXAuaW5pdFN5bWJvbEl0ZXJhdG9yKCk7cmV0dXJuIGU9e25leHQ6YygwKSxcInRocm93XCI6YygxKSxcInJldHVyblwiOmMoMil9LFxuXCJmdW5jdGlvblwiPT09dHlwZW9mIFN5bWJvbCYmKGVbU3ltYm9sLml0ZXJhdG9yXT1mdW5jdGlvbigpe3JldHVybiB0aGlzfSksZX07T2JqZWN0LmRlZmluZVByb3BlcnR5KGEsXCJfX2VzTW9kdWxlXCIse3ZhbHVlOiEwfSk7dmFyIG49Yyg2NTgpLGc9Yyg1NTApLHA9Yyg4NTEpLGY9YygxNDQpLGs9Yyg1MTcpLHg9Yyg2NTApLG09ZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYihjLGQpe3ZhciBmPWEuY2FsbCh0aGlzLGMsZy5jbGFzc19pZF90LlJUQ0RUTUZUb25lQ2hhbmdlRXZlbnQsZCxuLlByb3h5TW9kZS5SZW1vdGUpfHx0aGlzO3AubG9nZ2VyLmxvZyhmLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5jb25zdHJ1Y3RvclwiKTtyZXR1cm4gZn1kKGIsYSk7Yi5wcm90b3R5cGUuc3luY0JhcnJpZXI9ZnVuY3Rpb24oKXtyZXR1cm4gZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24oKXt2YXIgYSxiLGM9dGhpcztyZXR1cm4gcih0aGlzLGZ1bmN0aW9uKGQpe3N3aXRjaChkLmxhYmVsKXtjYXNlIDA6cmV0dXJuIHAubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcblwiLnN5bmNCYXJyaWVyKCkgY2FsbGVkLlwiKSxbNCx0aGlzLndhaXRVbnRpbENvbm5lY3RlZChcIkRUTUZUb25lQ2hhbmdlRXZlbnQuc3luY0JhcnJpZXJcIildO2Nhc2UgMTpyZXR1cm4gZC5zZW50KCksWzQsUHJvbWlzZS5hbGwoW3RoaXMucmVtb3RlSW52b2tlKCExLGcubWV0aG9kX2lkX1JUQ0RUTUZUb25lQ2hhbmdlRXZlbnRfdC50b25lLFwiXCIpLHRoaXMucmVtb3RlSW52b2tlKCExLGcubWV0aG9kX2lkX1JUQ0RUTUZUb25lQ2hhbmdlRXZlbnRfdC50b25lX2J1ZmZlcixcIlwiKV0pXTtjYXNlIDI6cmV0dXJuIGE9ZC5zZW50KCksYj1hLm1hcChmdW5jdGlvbihhKXtyZXR1cm4gYy5wYXJhbTAoYSl9KSx0aGlzLnRvbmU9YlswXSx0aGlzLnRvbmVfYnVmZmVyXz1iWzFdLFsyLHRoaXNdfX0pfSl9O09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcInRvbmVfYnVmZmVyXCIse2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnRvbmVfYnVmZmVyX30sZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITB9KTtcbnJldHVybiBifShuLlByb3h5T2JqZWN0KTthLkRUTUZUb25lQ2hhbmdlRXZlbnQ9bTt2YXIgRD1mdW5jdGlvbihhKXtmdW5jdGlvbiBiKGMsZCl7dmFyIGY9YS5jYWxsKHRoaXMsYyxnLmNsYXNzX2lkX3QuUlRDRFRNRlNlbmRlcixkLG4uUHJveHlNb2RlLlJlbW90ZSl8fHRoaXM7cC5sb2dnZXIubG9nKGYudXNlcl9mcmllbmRseV9pZCgpK1wiLmNvbnN0cnVjdG9yXCIpO2YuY2FuSW5zZXJ0RFRNRj0hMDtmLnRvbmVCdWZmZXJfPVwiXCI7cmV0dXJuIGZ9ZChiLGEpO2IucHJvdG90eXBlLmluc2VydERUTUY9ZnVuY3Rpb24oYSxiLGMpe3ZhciBkPXRoaXM7dm9pZCAwPT09YiYmKGI9MTAwKTt2b2lkIDA9PT1jJiYoYz03MCk7cC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmluc2VydERUTUYoKSBjYWxsZWQsIHRvbmVzOiBcIithKTt0aGlzLndhaXRVbnRpbENvbm5lY3RlZChcIkR0bWZTZW5kZXIuaW5zZXJ0RFRNRlwiKS50aGVuKGZ1bmN0aW9uKCl7cmV0dXJuIGQucmVtb3RlSW52b2tlKCExLFxuZy5tZXRob2RfaWRfUlRDRFRNRlNlbmRlcl90Lmluc2VydERUTUYsYSxiLGMpfSkudGhlbihmdW5jdGlvbigpe3AubG9nZ2VyLmxvZyhkLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5pbnNlcnREVE1GKCkgc3VjY2VzcywgdG9uZXM6IFwiK2EpfSlbXCJjYXRjaFwiXShmdW5jdGlvbihhKXtkLmxvZ1JlbW90ZUludm9rZUVycm9yKGEsXCIuaW5zZXJ0RFRNRigpIGZhaWxlZCFcIil9KX07T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwib250b25lY2hhbmdlXCIse2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm9udG9uZWNoYW5nZV99LHNldDpmdW5jdGlvbihhKXt2YXIgYj10aGlzO3AubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRfb250b25lY2hhbmdlKCkgY2FsbGVkLlwiKTt0aGlzLm9udG9uZWNoYW5nZV89YTt0aGlzLndhaXRVbnRpbENvbm5lY3RlZChcIkR0bWZTZW5kZXIub250b25lY2hhbmdlXCIpLnRoZW4oZnVuY3Rpb24oKXt2YXIgYz1iLnJlZ2lzdGVyQ2FsbGJhY2tzKCExLFxuYi5pc051bGxDYWxsYmFjayhhKSxnLm1ldGhvZF9pZF9SVENEVE1GU2VuZGVyX3Qub250b25lY2hhbmdlKTtjLnRoZW4oZnVuY3Rpb24oYSl7cC5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wiLm9udG9uZWNoYW5nZSBjYWxsYmFjayByZWNlaXZlZCFcIik7KG5ldyBtKGIsYi5wYXJhbTAoYSkub2lkKSkuc3luY0JhcnJpZXIoKS50aGVuKGZ1bmN0aW9uKGEpe3AubG9nZ2VyLmxvZyhiLnVzZXJfZnJpZW5kbHlfaWQoKStcInRvbmU6IFwiK2EudG9uZStcIiB0b25lX2J1ZmZlcjogXCIrYS50b25lX2J1ZmZlcik7Yi50b25lQnVmZmVyXz1hLnRvbmVfYnVmZmVyO2Iub250b25lY2hhbmdlXyhhKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYSl7Yi5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFwiLnRvbmVFdnQuc3luY0JhcnJpZXIoKSBmYWlsZWQhXCIpfSl9KTtyZXR1cm4gYi5yZW1vdGVJbnZva2UoITAsZy5tZXRob2RfaWRfUlRDRFRNRlNlbmRlcl90Lm9udG9uZWNoYW5nZSxjLnN1Y2Nlc3MpfSlbXCJjYXRjaFwiXShmdW5jdGlvbihhKXtiLmxvZ1JlbW90ZUludm9rZUVycm9yKGEsXG5cIi5zZXRfb250b25lY2hhbmdlKCkgZmFpbGVkIVwiKX0pfSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcInRvbmVCdWZmZXJcIix7Z2V0OmZ1bmN0aW9uKCl7cC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLnRvbmVCdWZmZXIoKSBjYWxsZWQuXCIpO3JldHVybiB0aGlzLnRvbmVCdWZmZXJffSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO3JldHVybiBifShuLlByb3h5T2JqZWN0KTthLkR0bWZTZW5kZXI9RDt2YXIgQj1mdW5jdGlvbihhKXtmdW5jdGlvbiBiKGMsZCl7dmFyIGY9YS5jYWxsKHRoaXMsYyxnLmNsYXNzX2lkX3QuUlRDSWNlVHJhbnNwb3J0LGQsbi5Qcm94eU1vZGUuUmVtb3RlKXx8dGhpcztwLmxvZ2dlci5sb2coZi51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuY29uc3RydWN0b3JcIik7Zi5zZWxlY3RlZFBhaXI9bnVsbDtmLmxvY2FsQ2FuZGlkYXRlc189W107Zi5yZW1vdGVDYW5kaWRhdGVzXz1cbltdO3JldHVybiBmfWQoYixhKTtiLnByb3RvdHlwZS5zeW5jQmFycmllcj1mdW5jdGlvbigpe3ZhciBhPXRoaXM7cC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLnN5bmNCYXJyaWVyKCkgY2FsbGVkLlwiKTtyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24oYyxkKXthLndhaXRVbnRpbENvbm5lY3RlZChcIkljZVRyYW5zcG9ydC5zeW5jQmFycmllclwiKS50aGVuKGZ1bmN0aW9uKCl7cmV0dXJuIFByb21pc2UuYWxsKFthLnJlbW90ZUludm9rZSghMSxnLm1ldGhvZF9pZF9SVENJY2VUcmFuc3BvcnRfdC5yb2xlLDApLGEucmVtb3RlSW52b2tlKCExLGcubWV0aG9kX2lkX1JUQ0ljZVRyYW5zcG9ydF90LmNvbXBvbmVudCwwKSxhLnJlbW90ZUludm9rZSghMSxnLm1ldGhvZF9pZF9SVENJY2VUcmFuc3BvcnRfdC5zdGF0ZSwwKSxhLnJlbW90ZUludm9rZSghMSxnLm1ldGhvZF9pZF9SVENJY2VUcmFuc3BvcnRfdC5nYXRoZXJpbmdTdGF0ZSwwKV0pfSkudGhlbihmdW5jdGlvbihkKXtwLmxvZ2dlci5sb2coYS51c2VyX2ZyaWVuZGx5X2lkKCkrXG5cIi5zeW5jQmFycmllciBzdWNjZXNzLlwiKTt2YXIgZz0wLGw9MDtkPWQubWFwKGZ1bmN0aW9uKGIpe3JldHVybiBhLnBhcmFtMChiKX0pO2Eucm9sZV89ZFswXTthLmNvbXBvbmVudF89ZFsxXTtnPWRbMl07bD1kWzNdO2Euc3RhdGVfPWIuY29udmVydFN0YXRlKGcpO2EuZ2F0aGVyaW5nU3RhdGVfPWIuY29udmVydEdhdGhlcmluZ1N0YXRlKGwpO2MoYSl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGIpe2I9YS5sb2dSZW1vdGVJbnZva2VFcnJvcihiLFwiLnN5bmNCYXJyaWVyKCkgZmFpbGVkIVwiKTtkKGIpfSl9KX07Yi5wcm90b3R5cGUuc3luY0NhbmRpZGF0ZXM9ZnVuY3Rpb24oKXt2YXIgYT10aGlzO3AubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zeW5jQ2FuZGlkYXRlcygpIGNhbGxlZC5cIik7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGIsYyl7YS53YWl0VW50aWxDb25uZWN0ZWQoXCJJY2VUcmFuc3BvcnQuc3luY0NhbmRpZGF0ZXNcIikudGhlbihmdW5jdGlvbigpe3JldHVybiBQcm9taXNlLmFsbChbYS5yZW1vdGVJbnZva2UoITEsXG5nLm1ldGhvZF9pZF9SVENJY2VUcmFuc3BvcnRfdC5sb2NhbGNhbmRpZGF0ZXMsW10pLGEucmVtb3RlSW52b2tlKCExLGcubWV0aG9kX2lkX1JUQ0ljZVRyYW5zcG9ydF90LnJlbW90ZWNhbmRpZGF0ZXMsW10pXSl9KS50aGVuKGZ1bmN0aW9uKGMpe3AubG9nZ2VyLmxvZyhhLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zeW5jQ2FuZGlkYXRlcyBzdWNjZXNzLlwiKTtjPWMubWFwKGZ1bmN0aW9uKGIpe3JldHVybiBhLnBhcmFtMChiKX0pO2EubG9jYWxDYW5kaWRhdGVzXz1jWzBdO2EucmVtb3RlQ2FuZGlkYXRlc189Y1sxXTtiKGEpfSlbXCJjYXRjaFwiXShmdW5jdGlvbihiKXtiPWEubG9nUmVtb3RlSW52b2tlRXJyb3IoYixcIi5zeW5jQ2FuZGlkYXRlcygpIGZhaWxlZCFcIik7YyhiKX0pfSl9O09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcInJvbGVcIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucm9sZV99LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFxuXCJjb21wb25lbnRcIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuY29tcG9uZW50X30sZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITB9KTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYi5wcm90b3R5cGUsXCJTdGF0ZVwiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zdGF0ZV99LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwiZ2F0aGVyaW5nU3RhdGVcIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2F0aGVyaW5nU3RhdGVffSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcIm9uc3RhdGVjaGFuZ2VcIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub25zdGF0ZWNoYW5nZV99LHNldDpmdW5jdGlvbihhKXt2YXIgYz10aGlzO3AubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRfb25zdGF0ZWNoYW5nZSgpIGNhbGxlZC5cIik7XG50aGlzLm9uc3RhdGVjaGFuZ2VfPWE7dGhpcy53YWl0VW50aWxDb25uZWN0ZWQoXCJJY2VUcmFuc3BvcnQub25zdGF0ZWNoYW5nZVwiKS50aGVuKGZ1bmN0aW9uKCl7dmFyIGQ9Yy5yZWdpc3RlckNhbGxiYWNrcyghMSxjLmlzTnVsbENhbGxiYWNrKGEpLGcubWV0aG9kX2lkX1JUQ0ljZVRyYW5zcG9ydF90Lm9uc3RhdGVjaGFuZ2UpO2QudGhlbihmdW5jdGlvbihhKXtwLmxvZ2dlci5sb2coYy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIub25zdGF0ZWNoYW5nZSBjYWxsYmFjayByZWNlaXZlZCFcIik7Yy5zeW5jQ2FuZGlkYXRlcygpLnRoZW4oZnVuY3Rpb24oYSl7cC5sb2dnZXIubG9nKGMudXNlcl9mcmllbmRseV9pZCgpK1wicmVjZWl2ZWQgdXBkYXRlZCBpY2UgY2FuZGlkYXRlcyFcIil9KTtjLnN0YXRlXz1iLmNvbnZlcnRTdGF0ZShjLnBhcmFtMChhKSk7cC5sb2dnZXIubG9nKGMudXNlcl9mcmllbmRseV9pZCgpK1wic3RhdGU6IFwiK2Muc3RhdGVfKTtjLm9uc3RhdGVjaGFuZ2VfKCl9KTtyZXR1cm4gYy5yZW1vdGVJbnZva2UoITAsXG5nLm1ldGhvZF9pZF9SVENJY2VUcmFuc3BvcnRfdC5vbnN0YXRlY2hhbmdlLGQuc3VjY2Vzcyl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2MubG9nUmVtb3RlSW52b2tlRXJyb3IoYSxcIi5zZXRfb25zdGF0ZWNoYW5nZSBmYWlsZWQhXCIpfSl9LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwib25nYXRoZXJpbmdzdGF0ZWNoYW5nZVwiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vbmdhdGhlcmluZ3N0YXRlY2hhbmdlX30sc2V0OmZ1bmN0aW9uKGEpe3ZhciBjPXRoaXM7cC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLnNldF9vbmdhdGhlcmluZ3N0YXRlY2hhbmdlKCkgY2FsbGVkLlwiKTt0aGlzLm9uZ2F0aGVyaW5nc3RhdGVjaGFuZ2VfPWE7dGhpcy53YWl0VW50aWxDb25uZWN0ZWQoXCJJY2VUcmFuc3BvcnQub25nYXRoZXJpbmdzdGF0ZWNoYW5nZVwiKS50aGVuKGZ1bmN0aW9uKCl7dmFyIGQ9XG5jLnJlZ2lzdGVyQ2FsbGJhY2tzKCExLGMuaXNOdWxsQ2FsbGJhY2soYSksZy5tZXRob2RfaWRfUlRDSWNlVHJhbnNwb3J0X3Qub25nYXRoZXJpbmdzdGF0ZWNoYW5nZSk7ZC50aGVuKGZ1bmN0aW9uKGEpe3AubG9nZ2VyLmxvZyhjLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5vbmdhdGhlcmluZ3N0YXRlY2hhbmdlIGNhbGxiYWNrIHJlY2VpdmVkIVwiKTtjLnN5bmNDYW5kaWRhdGVzKCkudGhlbihmdW5jdGlvbihhKXtwLmxvZ2dlci5sb2coYy51c2VyX2ZyaWVuZGx5X2lkKCkrXCJyZWNlaXZlZCB1cGRhdGVkIGljZSBjYW5kaWRhdGVzIVwiKX0pO2MuZ2F0aGVyaW5nU3RhdGVfPWIuY29udmVydEdhdGhlcmluZ1N0YXRlKGMucGFyYW0wKGEpKTtwLmxvZ2dlci5sb2coYy51c2VyX2ZyaWVuZGx5X2lkKCkrXCJnYXRoZXJpbmdTdGF0ZTogXCIrYy5nYXRoZXJpbmdTdGF0ZV8pO2Mub25nYXRoZXJpbmdzdGF0ZWNoYW5nZV8oKX0pO3JldHVybiBjLnJlbW90ZUludm9rZSghMCxnLm1ldGhvZF9pZF9SVENJY2VUcmFuc3BvcnRfdC5vbmdhdGhlcmluZ3N0YXRlY2hhbmdlLFxuZC5zdWNjZXNzKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYSl7Yy5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFwiLnNldF9vbmdhdGhlcmluZ3N0YXRlY2hhbmdlIGZhaWxlZCFcIil9KX0sZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITB9KTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYi5wcm90b3R5cGUsXCJvbnNlbGVjdGVkY2FuZGlkYXRlcGFpcmNoYW5nZVwiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vbnNlbGVjdGVkY2FuZGlkYXRlcGFpcmNoYW5nZV99LHNldDpmdW5jdGlvbihhKXt2YXIgYj10aGlzO3AubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRfb25zZWxlY3RlZGNhbmRpZGF0ZXBhaXJjaGFuZ2UoKSBjYWxsZWQuXCIpO3RoaXMub25zZWxlY3RlZGNhbmRpZGF0ZXBhaXJjaGFuZ2VfPWE7dGhpcy53YWl0VW50aWxDb25uZWN0ZWQoXCJJY2VUcmFuc3BvcnQub25zZWxlY3RlZGNhbmRpZGF0ZXBhaXJjaGFuZ2VcIikudGhlbihmdW5jdGlvbigpe3ZhciBjPVxuYi5yZWdpc3RlckNhbGxiYWNrcyghMSxiLmlzTnVsbENhbGxiYWNrKGEpLGcubWV0aG9kX2lkX1JUQ0ljZVRyYW5zcG9ydF90Lm9uc2VsZWN0ZWRjYW5kaWRhdGVwYWlyY2hhbmdlKTtjLnRoZW4oZnVuY3Rpb24oYSl7cC5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wiLm9uc2VsZWN0ZWRjYW5kaWRhdGVwYWlyY2hhbmdlIGNhbGxiYWNrIHJlY2VpdmVkIVwiKTtiLnN5bmNDYW5kaWRhdGVzKCkudGhlbihmdW5jdGlvbihhKXtwLmxvZ2dlci5sb2coYi51c2VyX2ZyaWVuZGx5X2lkKCkrXCJyZWNlaXZlZCB1cGRhdGVkIGljZSBjYW5kaWRhdGVzIVwiKX0pO2Iuc2VsZWN0ZWRQYWlyPWIucGFyYW0wKGEpO3AubG9nZ2VyLmxvZyhiLnVzZXJfZnJpZW5kbHlfaWQoKStcInNlbGVjdGVkUGFpcjogXCIrYi5zZWxlY3RlZFBhaXIpO2Iub25zZWxlY3RlZGNhbmRpZGF0ZXBhaXJjaGFuZ2VfKCl9KTtyZXR1cm4gYi5yZW1vdGVJbnZva2UoITAsZy5tZXRob2RfaWRfUlRDSWNlVHJhbnNwb3J0X3Qub25zZWxlY3RlZGNhbmRpZGF0ZXBhaXJjaGFuZ2UsXG5jLnN1Y2Nlc3MpfSlbXCJjYXRjaFwiXShmdW5jdGlvbihhKXtiLmxvZ1JlbW90ZUludm9rZUVycm9yKGEsXCIuc2V0X29uc2VsZWN0ZWRjYW5kaWRhdGVwYWlyY2hhbmdlIGZhaWxlZCFcIil9KX0sZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITB9KTtiLnByb3RvdHlwZS5nZXRMb2NhbENhbmRpZGF0ZXM9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5sb2NhbENhbmRpZGF0ZXNffTtiLnByb3RvdHlwZS5nZXRSZW1vdGVDYW5kaWRhdGVzPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucmVtb3RlQ2FuZGlkYXRlc199O2IucHJvdG90eXBlLmdldExvY2FsUGFyYW1ldGVycz1mdW5jdGlvbigpe3JldHVybiBudWxsfTtiLnByb3RvdHlwZS5nZXRSZW1vdGVQYXJhbWV0ZXJzPWZ1bmN0aW9uKCl7cmV0dXJuIG51bGx9O2IucHJvdG90eXBlLmdldFNlbGVjdGVkQ2FuZGlkYXRlUGFpcj1mdW5jdGlvbigpe3JldHVybiB0aGlzLnNlbGVjdGVkUGFpcn07Yi5jb252ZXJ0U3RhdGU9ZnVuY3Rpb24oYSl7cmV0dXJuIDA9PVxuYT9cIm5ld1wiOjE9PWE/XCJjaGVja2luZ1wiOjI9PWE/XCJjb25uZWN0ZWRcIjozPT1hP1wiY29tcGxldGVkXCI6ND09YT9cImZhaWxlZFwiOjU9PWE/XCJkaXNjb25uZWN0ZWRcIjpcImNsb3NlZFwifTtiLmNvbnZlcnRHYXRoZXJpbmdTdGF0ZT1mdW5jdGlvbihhKXtyZXR1cm4gMD09YT9cIm5ld1wiOjE9PWE/XCJnYXRoZXJpbmdcIjpcImNvbXBsZXRlXCJ9O3JldHVybiBifShuLlByb3h5T2JqZWN0KTthLkljZVRyYW5zcG9ydD1CO3ZhciB0OyhmdW5jdGlvbihhKXthW2FbXCJuZXdcIl09MF09XCJuZXdcIjthW2EuY29ubmVjdGluZz0xXT1cImNvbm5lY3RpbmdcIjthW2EuY29ubmVjdGVkPTJdPVwiY29ubmVjdGVkXCI7YVthLmNsb3NlZD0zXT1cImNsb3NlZFwiO2FbYS5mYWlsZWQ9NF09XCJmYWlsZWRcIjthW2EubWF4PTVdPVwibWF4XCJ9KSh0fHwodD17fSkpO3ZhciBoPWZ1bmN0aW9uKGEpe2Z1bmN0aW9uIGIoYyxkKXt2YXIgZj1hLmNhbGwodGhpcyxjLGcuY2xhc3NfaWRfdC5SVENEdGxzVHJhbnNwb3J0LGQsbi5Qcm94eU1vZGUuUmVtb3RlKXx8XG50aGlzO3AubG9nZ2VyLmxvZyhmLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5jb25zdHJ1Y3RvclwiKTtmLnN0YXRlXz1cIm5ld1wiO2YudHJhbnNwb3J0Xz1udWxsO2YucmVtb3RlQ2VydGlmaWNhdGVzXz1bXTtyZXR1cm4gZn1kKGIsYSk7Yi5wcm90b3R5cGUuZHVtcEluZm89ZnVuY3Rpb24oKXtwLmxvZ2dlci5sb2coXCJEdGxzVHJhbnNwb3J0W1wiK3RoaXMub2JqZWN0X2lkKCkrXCJdLmR1bXBJbmZvKCk6XCIpO3AubG9nZ2VyLmxvZyhcIiAgICAtIHN0YXRlOlwiK3RoaXMuc3RhdGVfKTtwLmxvZ2dlci5sb2coXCIgICAgLSB0cmFuc3BvcnQ6XCIrdGhpcy50cmFuc3BvcnRfKX07Yi5wcm90b3R5cGUuc3luY0JhcnJpZXI9ZnVuY3Rpb24oKXt2YXIgYT10aGlzO3AubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zeW5jQmFycmllcigpIGNhbGxlZC5cIik7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGMsZCl7YS53YWl0VW50aWxDb25uZWN0ZWQoXCJEdGxzVHJhbnNwb3J0LnN5bmNCYXJyaWVyXCIpLnRoZW4oZnVuY3Rpb24oKXtyZXR1cm4gUHJvbWlzZS5hbGwoW2EucmVtb3RlSW52b2tlKCExLFxuZy5tZXRob2RfaWRfUlRDRHRsc1RyYW5zcG9ydF90LnRyYW5zcG9ydCx7fSksYS5yZW1vdGVJbnZva2UoITEsZy5tZXRob2RfaWRfUlRDRHRsc1RyYW5zcG9ydF90LnN0YXRlLDApLGEucmVtb3RlSW52b2tlKCExLGcubWV0aG9kX2lkX1JUQ0R0bHNUcmFuc3BvcnRfdC5nZXRSZW1vdGVDZXJ0aWZpY2F0ZXMsW10pXSl9KS50aGVuKGZ1bmN0aW9uKGcpe3ZhciBmO3AubG9nZ2VyLmxvZyhhLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zeW5jQmFycmllciByZW1vdGUgc3VjY2Vzcy5cIik7dmFyIGw7Zj1nLm1hcChmdW5jdGlvbihiKXtyZXR1cm4gYS5wYXJhbTAoYil9KTtnPWZbMF07bD1mWzFdO2EucmVtb3RlQ2VydGlmaWNhdGVzXz1mWzJdO2Euc3RhdGVfPWIuY29udmVydFN0YXRlKGwpO2Y9W107dm9pZCAwPT1nfHwwIT1nLmlzX251bGx8fG51bGwhPT1hLnRyYW5zcG9ydF8mJmEudHJhbnNwb3J0Xy5vYmplY3RfaWQoKT09Zy5vaWR8fChhLnRyYW5zcG9ydF89bmV3IEIoYSxnLm9pZCksZi5wdXNoKGEudHJhbnNwb3J0Xy5zeW5jQmFycmllcigpKSk7XG5Qcm9taXNlLmFsbChmKS50aGVuKGZ1bmN0aW9uKCl7cC5sb2dnZXIubG9nKGEudXNlcl9mcmllbmRseV9pZCgpK1wiLnN5bmNCYXJyaWVyIHN1Y2Nlc3NcIik7YyhhKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYil7Yj1hLmxvZ1JlbW90ZUludm9rZUVycm9yKGIsXCIucHJvcC5zeW5jQmFycmllciBmYWlsZWQhXCIpO2QoYil9KX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYil7Yj1hLmxvZ1JlbW90ZUludm9rZUVycm9yKGIsXCIuc3luY0JhcnJpZXIgZmFpbGVkIVwiKTtkKGIpfSl9KX07T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwidHJhbnNwb3J0XCIse2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnRyYW5zcG9ydF99LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwic3RhdGVcIix7Z2V0OmZ1bmN0aW9uKCl7cC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmdldF9zdGF0ZSgpIGNhbGxlZDogXCIrXG50aGlzLnN0YXRlXyk7cmV0dXJuIHRoaXMuc3RhdGVffSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO2IucHJvdG90eXBlLmdldFJlbW90ZUNlcnRpZmljYXRlcz1mdW5jdGlvbigpe3JldHVybiB0aGlzLnJlbW90ZUNlcnRpZmljYXRlc199O09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcIm9uc3RhdGVjaGFuZ2VcIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub25zdGF0ZWNoYW5nZV99LHNldDpmdW5jdGlvbihhKXt2YXIgYz10aGlzO3AubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRfb25zdGF0ZWNoYW5nZSgpIGNhbGxlZC5cIik7dGhpcy5vbnN0YXRlY2hhbmdlXz1hO3RoaXMud2FpdFVudGlsQ29ubmVjdGVkKFwiRHRsc1RyYW5zcG9ydC5vbnN0YXRlY2hhbmdlXCIpLnRoZW4oZnVuY3Rpb24oKXt2YXIgZD1jLnJlZ2lzdGVyQ2FsbGJhY2tzKCExLGMuaXNOdWxsQ2FsbGJhY2soYSksZy5tZXRob2RfaWRfUlRDRHRsc1RyYW5zcG9ydF90Lm9uc3RhdGVjaGFuZ2UpO1xuZC50aGVuKGZ1bmN0aW9uKGEpe3AubG9nZ2VyLmxvZyhjLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5vbnN0YXRlY2hhbmdlIGNhbGxiYWNrIHJlY2VpdmVkIVwiKTtjLnN0YXRlXz1iLmNvbnZlcnRTdGF0ZShjLnBhcmFtMChhKSk7cC5sb2dnZXIubG9nKGMudXNlcl9mcmllbmRseV9pZCgpK1wic3RhdGVfOiBcIitjLnN0YXRlXyk7Yy5vbnN0YXRlY2hhbmdlXygpfSk7cmV0dXJuIGMucmVtb3RlSW52b2tlKCEwLGcubWV0aG9kX2lkX1JUQ0R0bHNUcmFuc3BvcnRfdC5vbnN0YXRlY2hhbmdlLGQuc3VjY2Vzcyl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2MubG9nUmVtb3RlSW52b2tlRXJyb3IoYSxcIi5zZXRfb25zdGF0ZWNoYW5nZSBmYWlsZWQhXCIpfSl9LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwib25lcnJvclwiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5vbmVycm9yX30sc2V0OmZ1bmN0aW9uKGEpe3ZhciBiPVxudGhpcztwLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc2V0X29uZXJyb3IoKSBjYWxsZWQuXCIpO3RoaXMub25lcnJvcl89YTt0aGlzLndhaXRVbnRpbENvbm5lY3RlZChcIkR0bHNUcmFuc3BvcnQub25lcnJvclwiKS50aGVuKGZ1bmN0aW9uKCl7dmFyIGM9Yi5yZWdpc3RlckNhbGxiYWNrcyghMSxiLmlzTnVsbENhbGxiYWNrKGEpLGcubWV0aG9kX2lkX1JUQ0R0bHNUcmFuc3BvcnRfdC5vbmVycm9yKTtjLnRoZW4oZnVuY3Rpb24oYSl7cC5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wiLm9uZXJyb3IgY2FsbGJhY2sgcmVjZWl2ZWQhXCIpO2E9Yi5wYXJhbTAoYSk7cC5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wiZXJyb3I6IFwiK2EpO2Iub25lcnJvcl8oYSl9KTtyZXR1cm4gYi5yZW1vdGVJbnZva2UoITAsZy5tZXRob2RfaWRfUlRDRHRsc1RyYW5zcG9ydF90Lm9uZXJyb3IsYy5zdWNjZXNzKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYSl7Yi5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFxuXCIuc2V0X29uZXJyb3IgZmFpbGVkIVwiKX0pfSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO2IuY29udmVydFN0YXRlPWZ1bmN0aW9uKGEpe3JldHVybiBhPT10W1wibmV3XCJdP1wibmV3XCI6YT09dC5jb25uZWN0aW5nP1wiY29ubmVjdGluZ1wiOmE9PXQuY29ubmVjdGVkP1wiY29ubmVjdGVkXCI6YT09dC5jbG9zZWQ/XCJjbG9zZWRcIjpcImZhaWxlZFwifTtyZXR1cm4gYn0obi5Qcm94eU9iamVjdCk7YS5EdGxzVHJhbnNwb3J0PWg7Yj1mdW5jdGlvbihhKXtmdW5jdGlvbiBiKGMsZCxnLGYpe2M9YS5jYWxsKHRoaXMsYyxkLGcsZil8fHRoaXM7cC5sb2dnZXIubG9nKGMudXNlcl9mcmllbmRseV9pZCgpK1wiLmNvbnN0cnVjdG9yIGJhc2VcIik7Yy50cmFja189bnVsbDtjLnRyYW5zcG9ydF89bnVsbDtjLnJ0Y3BUcmFuc3BvcnRfPW51bGw7cmV0dXJuIGN9ZChiLGEpO2IucHJvdG90eXBlLnN5bmNCYXJyaWVyQmFzZT1mdW5jdGlvbigpe3ZhciBhPXRoaXM7cC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1xuXCIuc3luY0JhcnJpZXJCYXNlKCkgY2FsbGVkLlwiKTtyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24oYixjKXt2YXIgZCxlLGw7YSBpbnN0YW5jZW9mIEE/KGQ9Zy5tZXRob2RfaWRfUlRDUnRwU2VuZGVyX3QudHJhY2ssZT1nLm1ldGhvZF9pZF9SVENSdHBTZW5kZXJfdC50cmFuc3BvcnQsbD1nLm1ldGhvZF9pZF9SVENSdHBTZW5kZXJfdC5ydGNwVHJhbnNwb3J0KTphIGluc3RhbmNlb2YgeSYmKGQ9Zy5tZXRob2RfaWRfUlRDUnRwUmVjZWl2ZXJfdC50cmFjayxlPWcubWV0aG9kX2lkX1JUQ1J0cFJlY2VpdmVyX3QudHJhbnNwb3J0LGw9Zy5tZXRob2RfaWRfUlRDUnRwUmVjZWl2ZXJfdC5ydGNwVHJhbnNwb3J0KTthLndhaXRVbnRpbENvbm5lY3RlZChcIlJ0cFNlbmRlclJlY2VpdmVyLnN5bmNCYXJyaWVyQmFzZVwiKS50aGVuKGZ1bmN0aW9uKCl7cmV0dXJuIHguUmVtb3RlU2Vzc2lvbi5pc0ZlYXR1cmVQc3RuU3VwcG9ydGVkKCkmJnguUmVtb3RlU2Vzc2lvbi5pc0ZlYXR1cmVEdG1mU3VwcG9ydGVkKCk/XG5Qcm9taXNlLmFsbChbYS5yZW1vdGVJbnZva2UoITEsZCx7b2lkOmEub2JqZWN0X2lkKCl9KSxhLnJlbW90ZUludm9rZSghMSxlLHtvaWQ6YS5vYmplY3RfaWQoKX0pLGEucmVtb3RlSW52b2tlKCExLGwse29pZDphLm9iamVjdF9pZCgpfSldKTpQcm9taXNlLmFsbChbYS5yZW1vdGVJbnZva2UoITEsZCx7b2lkOmEub2JqZWN0X2lkKCl9KV0pfSkudGhlbihmdW5jdGlvbihkKXt2YXIgbDtwLmxvZ2dlci5sb2coYS51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc3luY0JhcnJpZXJCYXNlIHJlbW90ZSBzdWNjZXNzLlwiKTt2YXIgZztsPWQubWFwKGZ1bmN0aW9uKGIpe3JldHVybiBhLnBhcmFtMChiKX0pO2Q9bFswXTtnPWxbMV07bD1sWzJdO3ZhciBlPVtdO3ZvaWQgMCE9ZCYmITE9PT1kLmlzX251bGwmJihudWxsPT09YS50cmFja198fGEudHJhY2tfLm9iamVjdF9pZCgpIT1kLm9pZD9hLnRyYWNrXz1uZXcgZi5SZW1vdGVNZWRpYVRyYWNrKGEsZC5vaWQpOmEudHJhY2tfLmJpbmQoYSxkLm9pZCksXG5lLnB1c2goYS50cmFjay5zeW5jQmFycmllcigpKSk7dm9pZCAwPT1nfHwhMSE9PWcuaXNfbnVsbHx8bnVsbCE9PWEudHJhbnNwb3J0XyYmYS50cmFuc3BvcnRfLm9iamVjdF9pZCgpPT1nLm9pZHx8KGEudHJhbnNwb3J0Xz1uZXcgaChhLGcub2lkKSxlLnB1c2goYS50cmFuc3BvcnRfLnN5bmNCYXJyaWVyKCkpKTt2b2lkIDA9PWx8fCExIT09bC5pc19udWxsfHxudWxsIT09YS5ydGNwVHJhbnNwb3J0XyYmYS5ydGNwVHJhbnNwb3J0Xy5vYmplY3RfaWQoKT09bC5vaWR8fChhLnJ0Y3BUcmFuc3BvcnRfPW5ldyBoKGEsbC5vaWQpLGUucHVzaChhLnJ0Y3BUcmFuc3BvcnRfLnN5bmNCYXJyaWVyKCkpKTtQcm9taXNlLmFsbChlKS50aGVuKGZ1bmN0aW9uKCl7cC5sb2dnZXIubG9nKGEudXNlcl9mcmllbmRseV9pZCgpK1wiLnByb3Auc3luY0JhcnJpZXJCYXNlIHN1Y2Nlc3NcIik7YihhKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYil7Yj1hLmxvZ1JlbW90ZUludm9rZUVycm9yKGIsXCIucHJvcC5zeW5jQmFycmllckJhc2UgZmFpbGVkIVwiKTtcbmMoYil9KX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYil7Yj1hLmxvZ1JlbW90ZUludm9rZUVycm9yKGIsXCIuc3luY0JhcnJpZXJCYXNlKCkgZmFpbGVkIVwiKTtjKGIpfSl9KX07T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwidHJhbnNwb3J0XCIse2dldDpmdW5jdGlvbigpe3AubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5nZXQgdHJhbnNwb3J0KCkgY2FsbGVkLlwiKTtyZXR1cm4gdGhpcy50cmFuc3BvcnRffSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcInJ0Y3BUcmFuc3BvcnRcIix7Z2V0OmZ1bmN0aW9uKCl7cC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmdldCBydGNwVHJhbnNwb3J0KCkgY2FsbGVkLlwiKTtyZXR1cm4gdGhpcy5ydGNwVHJhbnNwb3J0X30sZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITB9KTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYi5wcm90b3R5cGUsXG5cInRyYWNrXCIse2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnRyYWNrX30sZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITB9KTtiLnByb3RvdHlwZS5yZWluaXRUcmFjaz1mdW5jdGlvbihhKXt0aGlzLnRyYWNrXz1hfTtiLnByb3RvdHlwZS5nZXRTdGF0cz1mdW5jdGlvbigpe3AubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5nZXRTdGF0cygpIGNhbGxlZC5cIik7dmFyIGE9dGhpcztyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24oYixjKXt2YXIgZD10aGlzO2EuaXNSZWRpcmVjdGVkKCk/YS53YWl0VW50aWxDb25uZWN0ZWQoXCJSdHBSZWNlaXZlci5nZXRTdGF0c1wiKS50aGVuKGZ1bmN0aW9uKCl7dmFyIGM7ZCBpbnN0YW5jZW9mIEE/Yz1nLm1ldGhvZF9pZF9SVENSdHBTZW5kZXJfdC5nZXRTdGF0czpkIGluc3RhbmNlb2YgeSYmKGM9Zy5tZXRob2RfaWRfUlRDUnRwUmVjZWl2ZXJfdC5nZXRTdGF0cyk7dmFyIGw9YS5yZWdpc3RlckNhbGxiYWNrcyghMCwhMSxcbmMpO2wudGhlbihmdW5jdGlvbihhKXt2b2lkIDAhPT1hLnBhcmFtcyYmMCE9PWEucGFyYW1zLmxlbmd0aCYmYihrLlN0YXRzUmVwb3J0LmZyb21KU09OKEpTT04ucGFyc2UoYS5wYXJhbXNbMF0pKSl9KTtyZXR1cm4gYS5yZW1vdGVJbnZva2UoITEsYyxsLnN1Y2Nlc3MpfSlbXCJjYXRjaFwiXShmdW5jdGlvbihhKXthPWQubG9nUmVtb3RlSW52b2tlRXJyb3IoYSxcIi5nZXRTdGF0cygpIGZhaWxlZCFcIik7YyhhKX0pOihwLmxvZ2dlci5sb2coYS51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0U3RhdHMoKTogbm90IGluIGFjdGl2ZSByZWRpcmVjdGlvbiFcIiksYigpKX0pfTtyZXR1cm4gYn0obi5Qcm94eU9iamVjdCk7YS5SdHBTZW5kZXJSZWNlaXZlcj1iO3ZhciBBPWZ1bmN0aW9uKGEpe2Z1bmN0aW9uIGIoYyxkLGYsaCl7Yz1hLmNhbGwodGhpcyxjLGcuY2xhc3NfaWRfdC5SVENSdHBTZW5kZXIsZCxmKXx8dGhpcztwLmxvZ2dlci5sb2coYy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuY29uc3RydWN0b3JcIik7XG5jLmR0bWZfPW51bGw7Yy5wYXJhbXNfPW51bGw7Yy51bmlmaWVkXz1oO3JldHVybiBjfWQoYixhKTtiLnByb3RvdHlwZS5kdW1wSW5mbz1mdW5jdGlvbigpe3AubG9nZ2VyLmxvZyhcIlJ0cFNlbmRlcltcIit0aGlzLm9iamVjdF9pZCgpK1wiXS5kdW1wSW5mbygpOlwiKTt0aGlzLnRyYWNrJiZ0aGlzLnRyYWNrLmR1bXBJbmZvKCl9O2IucHJvdG90eXBlLnN5bmNCYXJyaWVyPWZ1bmN0aW9uKCl7dmFyIGI9dGhpcztwLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc3luY0JhcnJpZXIoKSBjYWxsZWQuXCIpO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihjLGQpe2Iud2FpdFVudGlsQ29ubmVjdGVkKFwiUnRwU2VuZGVyLnN5bmNCYXJyaWVyXCIpLnRoZW4oZnVuY3Rpb24oKXtyZXR1cm4gYS5wcm90b3R5cGUuc3luY0JhcnJpZXJCYXNlLmNhbGwoYil9KS50aGVuKGZ1bmN0aW9uKCl7cC5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wiLnN5bmNCYXJyaWVyQmFzZSBzdWNjZXNzLlwiKTtcbnJldHVybiB4LlJlbW90ZVNlc3Npb24uaXNGZWF0dXJlUHN0blN1cHBvcnRlZCgpJiZ4LlJlbW90ZVNlc3Npb24uaXNGZWF0dXJlRHRtZlN1cHBvcnRlZCgpP1Byb21pc2UuYWxsKFtiLnJlbW90ZUludm9rZSghMSxnLm1ldGhvZF9pZF9SVENSdHBTZW5kZXJfdC5kdG1mLHtvaWQ6Yi5vYmplY3RfaWQoKX0pLGIucmVtb3RlSW52b2tlKCExLGcubWV0aG9kX2lkX1JUQ1J0cFNlbmRlcl90LmdldFBhcmFtZXRlcnMse29pZDpiLm9iamVjdF9pZCgpfSldKTpQcm9taXNlLmFsbChbXSl9KS50aGVuKGZ1bmN0aW9uKGEpe3AubG9nZ2VyLmxvZyhiLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zeW5jQmFycmllciBzdWNjZXNzLlwiKTt2YXIgZDthPWEubWFwKGZ1bmN0aW9uKGEpe3JldHVybiBiLnBhcmFtMChhKX0pO2Q9YVswXTtiLnBhcmFtc189YVsxXTt2b2lkIDA9PWR8fCExIT09ZC5pc19udWxsfHxudWxsIT09Yi5kdG1mXyYmYi5kdG1mXy5vYmplY3RfaWQoKT09ZC5vaWR8fChiLmR0bWZfPW5ldyBEKGIsXG5kLm9pZCkpO2MoYil9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2E9Yi5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFwiLnN5bmNCYXJyaWVyIGZhaWxlZCFcIik7ZChhKX0pfSl9O2IuZ2V0Q2FwYWJpbGl0aWVzPWZ1bmN0aW9uKGEpe3AubG9nZ2VyLmxvZyh0aGlzLmNvbnN0cnVjdG9yLm5hbWUrXCIuZ2V0Q2FwYWJpbGl0aWVzKCkgY2FsbGVkLlwiKTtyZXR1cm4gZi5OYXZpZ2F0b3JVc2VyTWVkaWEuZ2V0Q2FwYWJpbGl0aWVzKGEpfTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYi5wcm90b3R5cGUsXCJkdG1mXCIse2dldDpmdW5jdGlvbigpe3AubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5nZXQgZHRtZigpIGNhbGxlZC5cIik7cmV0dXJuIHRoaXMuZHRtZl99LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7Yi5wcm90b3R5cGUuc2V0UGFyYW1ldGVycz1mdW5jdGlvbihhKXt2YXIgYj10aGlzO3AubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRQYXJhbWV0ZXJzKCkgY2FsbGVkLlwiKTtcbnJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihjLGQpe2Iud2FpdFVudGlsQ29ubmVjdGVkKFwiUnRwU2VuZGVyLnNldFBhcmFtZXRlcnNcIikudGhlbihmdW5jdGlvbigpe3JldHVybiBQcm9taXNlLmFsbChbYi5yZW1vdGVJbnZva2UoITEsZy5tZXRob2RfaWRfUlRDUnRwU2VuZGVyX3Quc2V0UGFyYW1ldGVycyxhKV0pfSkudGhlbihmdW5jdGlvbihkKXtwLmxvZ2dlci5sb2coYi51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc2V0UGFyYW1ldGVycygpOiBzdWNjZXNzLlwiKTtjKCk7Yi5wYXJhbXNfPWF9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2E9Yi5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFwiLnNldFBhcmFtZXRlcnMoKSBmYWlsZWQhXCIpO2QoYSl9KX0pfTtiLnByb3RvdHlwZS5nZXRQYXJhbWV0ZXJzPWZ1bmN0aW9uKCl7dmFyIGE9dGhpcztwLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0UGFyYW1ldGVycygpIGNhbGxlZC5cIik7dGhpcy53YWl0VW50aWxDb25uZWN0ZWQodGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXG5cIi5nZXRQYXJhbWV0ZXJzXCIpLnRoZW4oZnVuY3Rpb24oKXtwLmxvZ2dlci5sb2coYS51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0UGFyYW1ldGVycygpIHJlbW90ZSBpbnZva2luZ1wiKTtyZXR1cm4gYS5yZW1vdGVJbnZva2UoITEsZy5tZXRob2RfaWRfUlRDUnRwU2VuZGVyX3QuZ2V0UGFyYW1ldGVycyx7b2lkOmEub2JqZWN0X2lkKCl9KX0pLnRoZW4oZnVuY3Rpb24oYil7cC5sb2dnZXIubG9nKGEudXNlcl9mcmllbmRseV9pZCgpK1wiLmdldFBhcmFtZXRlcnMoKSBzdWNjZXNzXCIpO2EucGFyYW1zXz1hLnBhcmFtMChiKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYil7YS5sb2dSZW1vdGVJbnZva2VFcnJvcihiLFwiLmdldFBhcmFtZXRlcnMoKSBmYWlsZWQhXCIpfSk7cC5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmdldFBhcmFtZXRlcnMoKSByZXR1cm5pbmc6IFwiK3RoaXMucGFyYW1zXyk7cmV0dXJuIHRoaXMucGFyYW1zX307Yi5wcm90b3R5cGUucmVwbGFjZVRyYWNrPWZ1bmN0aW9uKGEpe3ZhciBiPVxudGhpcztwLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIucmVwbGFjZVRyYWNrKCkgY2FsbGVkLiB0cmFja186XCIrdGhpcy50cmFja18rXCIsIHdpdGhUcmFjazpcIithKTtyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24oYyxkKXtiLndhaXRVbnRpbENvbm5lY3RlZChcIlJ0cFNlbmRlci5yZXBsYWNlVHJhY2tcIikudGhlbihmdW5jdGlvbigpe2lmKGEpcmV0dXJuIFByb21pc2UuYWxsKFtiLnJlbW90ZUludm9rZSghMSxnLm1ldGhvZF9pZF9SVENSdHBTZW5kZXJfdC5yZXBsYWNlVHJhY2sse29pZDphLm9iamVjdF9pZCgpfSldKTtpZihiLnVuaWZpZWRfKXJldHVybiBQcm9taXNlLmFsbChbYi5yZW1vdGVJbnZva2UoITEsZy5tZXRob2RfaWRfUlRDUnRwU2VuZGVyX3QucmVwbGFjZVRyYWNrLHtvaWQ6MH0pXSk7cC5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wiLnJlcGxhY2VUcmFjaygpOiBmYWlsZWQgd2l0aCBudWxsIHRyYWNrIVwiKTtkKCl9KS50aGVuKGZ1bmN0aW9uKGQpe3AubG9nZ2VyLmxvZyhiLnVzZXJfZnJpZW5kbHlfaWQoKStcblwiLnJlcGxhY2VUcmFjaygpOiBzdWNjZXNzLlwiKTtjKCk7Yi5yZWluaXRUcmFjayhhKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYSl7YT1iLmxvZ1JlbW90ZUludm9rZUVycm9yKGEsXCIucmVwbGFjZVRyYWNrKCkgZmFpbGVkIVwiKTtkKGEpfSl9KX07cmV0dXJuIGJ9KGIpO2EuUnRwU2VuZGVyPUE7dmFyIHk9ZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYihjLGQsZixoLGUpe2M9YS5jYWxsKHRoaXMsYyxnLmNsYXNzX2lkX3QuUlRDUnRwUmVjZWl2ZXIsZCxmKXx8dGhpcztwLmxvZ2dlci5sb2coYy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuY29uc3RydWN0b3JcIik7Yy5jb250cmlic291cmNlc189W107Yy5zeW5jc291cmNlc189W107Yy5wYXJhbXNfPW51bGw7Yy51bmlmaWVkXz1oO2UmJihjLnRyYWNrXz1lKTtyZXR1cm4gY31kKGIsYSk7Yi5wcm90b3R5cGUuZHVtcEluZm89ZnVuY3Rpb24oKXtwLmxvZ2dlci5sb2coXCJSdHBSZWNlaXZlcltcIit0aGlzLm9iamVjdF9pZCgpK1wiXS5kdW1wSW5mbygpOlwiKTtcbnRoaXMudHJhY2smJnRoaXMudHJhY2suZHVtcEluZm8oKTt0aGlzLnRyYW5zcG9ydCYmdGhpcy50cmFuc3BvcnQuZHVtcEluZm8oKX07Yi5wcm90b3R5cGUuc3luY0JhcnJpZXI9ZnVuY3Rpb24oKXt2YXIgYj10aGlzO3AubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zeW5jQmFycmllcigpIGNhbGxlZC5cIik7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGMsZCl7Yi53YWl0VW50aWxDb25uZWN0ZWQoXCJSdHBSZWNlaXZlci5zeW5jQmFycmllclwiKS50aGVuKGZ1bmN0aW9uKCl7cmV0dXJuIGEucHJvdG90eXBlLnN5bmNCYXJyaWVyQmFzZS5jYWxsKGIpfSkudGhlbihmdW5jdGlvbigpe3AubG9nZ2VyLmxvZyhiLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zeW5jQmFycmllckJhc2Ugc3VjY2Vzcy5cIik7cmV0dXJuIHguUmVtb3RlU2Vzc2lvbi5pc0ZlYXR1cmVQc3RuU3VwcG9ydGVkKCkmJnguUmVtb3RlU2Vzc2lvbi5pc0ZlYXR1cmVEdG1mU3VwcG9ydGVkKCk/UHJvbWlzZS5hbGwoW2IucmVtb3RlSW52b2tlKCExLFxuZy5tZXRob2RfaWRfUlRDUnRwUmVjZWl2ZXJfdC5nZXRDb250cmlidXRpbmdTb3VyY2VzLFtdKSxiLnJlbW90ZUludm9rZSghMSxnLm1ldGhvZF9pZF9SVENSdHBSZWNlaXZlcl90LmdldFN5bmNocm9uaXphdGlvblNvdXJjZXMsW10pLGIucmVtb3RlSW52b2tlKCExLGcubWV0aG9kX2lkX1JUQ1J0cFJlY2VpdmVyX3QuZ2V0UGFyYW1ldGVycyx7b2lkOmIub2JqZWN0X2lkKCl9KV0pOlByb21pc2UuYWxsKFtiLnJlbW90ZUludm9rZSghMSxnLm1ldGhvZF9pZF9SVENSdHBSZWNlaXZlcl90LmdldENvbnRyaWJ1dGluZ1NvdXJjZXMsW10pXSl9KS50aGVuKGZ1bmN0aW9uKGEpe3AubG9nZ2VyLmxvZyhiLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zeW5jQmFycmllciBzdWNjZXNzLlwiKTthPWEubWFwKGZ1bmN0aW9uKGEpe3JldHVybiBiLnBhcmFtMChhKX0pO2IuY29udHJpYnNvdXJjZXNfPWFbMF07Yi5zeW5jc291cmNlc189YVsxXTtiLnBhcmFtc189YVsyXTtjKGIpfSlbXCJjYXRjaFwiXShmdW5jdGlvbihhKXthPVxuYi5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFwiLnN5bmNCYXJyaWVyKCkgZmFpbGVkIVwiKTtkKGEpfSl9KX07Yi5nZXRDYXBhYmlsaXRpZXM9ZnVuY3Rpb24oYSl7cC5sb2dnZXIubG9nKHRoaXMuY29uc3RydWN0b3IubmFtZStcIi5nZXRDYXBhYmlsaXRpZXMoKSBjYWxsZWQuXCIpO3JldHVybiBmLk5hdmlnYXRvclVzZXJNZWRpYS5nZXRDYXBhYmlsaXRpZXMoYSl9O2IucHJvdG90eXBlLmdldENvbnRyaWJ1dGluZ1NvdXJjZXM9ZnVuY3Rpb24oKXt2YXIgYT10aGlzO3AubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5nZXRDb250cmlidXRpbmdTb3VyY2VzKCkgY2FsbGVkLiBcIitKU09OLnN0cmluZ2lmeSh0aGlzLmNvbnRyaWJzb3VyY2VzXykpO3RoaXMud2FpdFVudGlsQ29ubmVjdGVkKFwiUnRwUmVjZWl2ZXIuZ2V0Q29udHJpYnV0aW5nU291cmNlc1wiKS50aGVuKGZ1bmN0aW9uKCl7cmV0dXJuIFByb21pc2UuYWxsKFthLnJlbW90ZUludm9rZSghMSxnLm1ldGhvZF9pZF9SVENSdHBSZWNlaXZlcl90LmdldENvbnRyaWJ1dGluZ1NvdXJjZXMsXG5bXSldKX0pLnRoZW4oZnVuY3Rpb24oYil7YS5jb250cmlic291cmNlc189Yi5tYXAoZnVuY3Rpb24oYil7cmV0dXJuIGEucGFyYW0wKGIpfSlbMF07cC5sb2dnZXIubG9nKGEudXNlcl9mcmllbmRseV9pZCgpLFwiLmdldENvbnRyaWJ1dGluZ1NvdXJjZXMoKSBzdWNjZXNzOiBcIitKU09OLnN0cmluZ2lmeShhLmNvbnRyaWJzb3VyY2VzXykpfSlbXCJjYXRjaFwiXShmdW5jdGlvbihiKXthLmxvZ1JlbW90ZUludm9rZUVycm9yKGIsXCIuZ2V0Q29udHJpYnV0aW5nU291cmNlcygpIGZhaWxlZCFcIik7YS5jb250cmlic291cmNlc189W119KTtyZXR1cm4gdGhpcy5jb250cmlic291cmNlc199O2IucHJvdG90eXBlLmdldFBhcmFtZXRlcnM9ZnVuY3Rpb24oKXtwLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0UGFyYW1ldGVycygpIGNhbGxlZC5cIik7cmV0dXJuIHRoaXMucGFyYW1zX307Yi5wcm90b3R5cGUuZ2V0U3luY2hyb25pemF0aW9uU291cmNlcz1mdW5jdGlvbigpe3AubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcblwiLmdldFN5bmNocm9uaXphdGlvblNvdXJjZXMoKSBjYWxsZWQuXCIpO3JldHVybiB0aGlzLnN5bmNzb3VyY2VzX307cmV0dXJuIGJ9KGIpO2EuUnRwUmVjZWl2ZXI9eX0sMzc3OmZ1bmN0aW9uKGIsYSxjKXt2YXIgZD10aGlzJiZ0aGlzLl9fZXh0ZW5kc3x8ZnVuY3Rpb24oKXt2YXIgYT1mdW5jdGlvbihiLGMpe2E9T2JqZWN0LnNldFByb3RvdHlwZU9mfHx7X19wcm90b19fOltdfWluc3RhbmNlb2YgQXJyYXkmJmZ1bmN0aW9uKGEsYil7YS5fX3Byb3RvX189Yn18fGZ1bmN0aW9uKGEsYil7Zm9yKHZhciBjIGluIGIpYi5oYXNPd25Qcm9wZXJ0eShjKSYmKGFbY109YltjXSl9O3JldHVybiBhKGIsYyl9O3JldHVybiBmdW5jdGlvbihiLGMpe2Z1bmN0aW9uIGQoKXt0aGlzLmNvbnN0cnVjdG9yPWJ9YShiLGMpO2IucHJvdG90eXBlPW51bGw9PT1jP09iamVjdC5jcmVhdGUoYyk6KGQucHJvdG90eXBlPWMucHJvdG90eXBlLG5ldyBkKX19KCk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGEsXCJfX2VzTW9kdWxlXCIsXG57dmFsdWU6ITB9KTt2YXIgZT1jKDY1OCkscj1jKDU1MCksbj1jKDg1MSksZz1jKDU4OSk7Yj1mdW5jdGlvbigpe2Z1bmN0aW9uIGEoKXt0aGlzLmRpcmVjdGlvbj1cInNlbmRyZWN2XCI7dGhpcy5zZW5kRW5jb2RpbmdzPVtdO3RoaXMuc3RyZWFtcz1bXTtuLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuY29uc3RydWN0b3JcIil9YS5wcm90b3R5cGUudXNlcl9mcmllbmRseV9pZD1mdW5jdGlvbigpe3JldHVybiB0aGlzLmNvbnN0cnVjdG9yLm5hbWV9O3JldHVybiBhfSgpO2EuUnRwVHJhbnNjZWl2ZXJJbml0PWI7dmFyIHA7KGZ1bmN0aW9uKGEpe2FbYS5rU2VuZFJlY3Y9MF09XCJrU2VuZFJlY3ZcIjthW2Eua1NlbmRPbmx5PTFdPVwia1NlbmRPbmx5XCI7YVthLmtSZWN2T25seT0yXT1cImtSZWN2T25seVwiO2FbYS5rSW5hY3RpdmU9M109XCJrSW5hY3RpdmVcIn0pKHB8fChwPXt9KSk7Yj1mdW5jdGlvbihhKXtmdW5jdGlvbiBiKGMsZCxrLEcsdCxoKXtjPWEuY2FsbCh0aGlzLGMsXG5yLmNsYXNzX2lkX3QuUlRDUnRwVHJhbnNjZWl2ZXIsZCxrKXx8dGhpcztuLmxvZ2dlci5sb2coYy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuY29uc3RydWN0b3JcIik7Yy51bmlmaWVkXz1HO2Muc2VuZGVyXz1uZXcgZy5SdHBTZW5kZXIoYywwLGUuUHJveHlNb2RlLlBzZXVkbyxHKTtjLnJlY2VpdmVyXz1oP2g6bmV3IGcuUnRwUmVjZWl2ZXIoYywwLGUuUHJveHlNb2RlLlBzZXVkbyxHKTt0PyhjLmRpcmVjdGlvbl89Yy50b1J0cFRyYW5zY2VpdmVyRGlyZWN0aW9uKHQpLGMuY3VycmVudERpcmVjdGlvbl89Yy50b1J0cFRyYW5zY2VpdmVyRGlyZWN0aW9uKHQpKTooYy5kaXJlY3Rpb25fPXAua1NlbmRSZWN2LGMuY3VycmVudERpcmVjdGlvbl89cC5rU2VuZFJlY3YpO3JldHVybiBjfWQoYixhKTtiLnByb3RvdHlwZS5kdW1wSW5mbz1mdW5jdGlvbigpe24ubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5kdW1wSW5mbygpIFtpZD1cIit0aGlzLm1pZCtcIl0gZGlyZWN0aW9uPVwiK1xudGhpcy50b1JUQ1J0cFRyYW5zY2VpdmVyRGlyZWN0aW9uKHRoaXMuZGlyZWN0aW9uXyksXCIgY3VycmVudERpcmVjdGlvbj1cIit0aGlzLnRvUlRDUnRwVHJhbnNjZWl2ZXJEaXJlY3Rpb24odGhpcy5jdXJyZW50RGlyZWN0aW9uXykpO3RoaXMuc2VuZGVyJiZ0aGlzLnNlbmRlci5kdW1wSW5mbygpO3RoaXMucmVjZWl2ZXImJnRoaXMucmVjZWl2ZXIuZHVtcEluZm8oKX07Yi5wcm90b3R5cGUuc3luY0JhcnJpZXI9ZnVuY3Rpb24oKXt2YXIgYT10aGlzO24ubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zeW5jQmFycmllcigpIGNhbGxlZC5cIik7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGIsYyl7YS53YWl0VW50aWxDb25uZWN0ZWQoXCJSdHBUcmFuc2NlaXZlci5zeW5jQmFycmllclwiKS50aGVuKGZ1bmN0aW9uKCl7cmV0dXJuIFByb21pc2UuYWxsKFthLnJlbW90ZUludm9rZSghMSxyLm1ldGhvZF9pZF9SVENSdHBUcmFuc2NlaXZlcl90Lm1pZCx7b2lkOmEub2JqZWN0X2lkKCl9KSxcbmEucmVtb3RlSW52b2tlKCExLHIubWV0aG9kX2lkX1JUQ1J0cFRyYW5zY2VpdmVyX3QuZGlyZWN0aW9uLHtvaWQ6YS5vYmplY3RfaWQoKX0pLGEucmVtb3RlSW52b2tlKCExLHIubWV0aG9kX2lkX1JUQ1J0cFRyYW5zY2VpdmVyX3QuY3VycmVudERpcmVjdGlvbix7b2lkOmEub2JqZWN0X2lkKCl9KSxhLnJlbW90ZUludm9rZSghMSxyLm1ldGhvZF9pZF9SVENSdHBUcmFuc2NlaXZlcl90LnNlbmRlcix7b2lkOmEub2JqZWN0X2lkKCl9KSxhLnJlbW90ZUludm9rZSghMSxyLm1ldGhvZF9pZF9SVENSdHBUcmFuc2NlaXZlcl90LnJlY2VpdmVyLHtvaWQ6YS5vYmplY3RfaWQoKX0pXSl9KS50aGVuKGZ1bmN0aW9uKGMpe3ZhciBkO24ubG9nZ2VyLmxvZyhhLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zeW5jQmFycmllciByZW1vdGUgc3VjY2Vzcy5cIik7ZD1jLm1hcChmdW5jdGlvbihiKXtyZXR1cm4gYS5wYXJhbTAoYil9KTthLm1pZF89ZFswXTthLmRpcmVjdGlvbl89ZFsxXTthLmN1cnJlbnREaXJlY3Rpb25fPVxuZFsyXTtjPWRbM107ZD1kWzRdO3ZhciBnPVtdO3ZvaWQgMCE9YyYmITE9PT1jLmlzX251bGwmJihhLnNlbmRlcl8uYmluZChhLGMub2lkKSxnLnB1c2goYS5zZW5kZXJfLnN5bmNCYXJyaWVyKCkpKTt2b2lkIDAhPWQmJiExPT09ZC5pc19udWxsJiYoYS5yZWNlaXZlcl8uYmluZChhLGQub2lkKSxnLnB1c2goYS5yZWNlaXZlcl8uc3luY0JhcnJpZXIoKSkpO2lmKDA9PWcubGVuZ3RoKW4ubG9nZ2VyLmxvZyhhLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zeW5jQmFycmllciBzdWNjZXNzXCIpLGIoYSk7ZWxzZSByZXR1cm4gbi5sb2dnZXIubG9nKGEudXNlcl9mcmllbmRseV9pZCgpK1wiLnByb3Auc3luY0JhcnJpZXIgc3RhcnRcIiksUHJvbWlzZS5hbGwoZyl9KS50aGVuKGZ1bmN0aW9uKCl7bi5sb2dnZXIubG9nKGEudXNlcl9mcmllbmRseV9pZCgpK1wiLnN5bmNCYXJyaWVyIHN1Y2Nlc3NcIik7YihhKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYil7Yj1hLmxvZ1JlbW90ZUludm9rZUVycm9yKGIsXCIuc3luY0JhcnJpZXIoKSBmYWlsZWQhXCIpO1xuYyhiKX0pfSl9O09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcIm1pZFwiLHtnZXQ6ZnVuY3Rpb24oKXtuLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0X21pZCgpIGNhbGxlZDogXCIrdGhpcy5taWRfKTtyZXR1cm4gdGhpcy5taWRffSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcInNlbmRlclwiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zZW5kZXJffSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcInJlY2VpdmVyXCIse2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnJlY2VpdmVyX30sZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITB9KTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYi5wcm90b3R5cGUsXCJkaXJlY3Rpb25cIix7Z2V0OmZ1bmN0aW9uKCl7bi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1xuXCIuZ2V0X2RpcmVjdGlvbigpIGNhbGxlZC4gXCIrdGhpcy50b1JUQ1J0cFRyYW5zY2VpdmVyRGlyZWN0aW9uKHRoaXMuZGlyZWN0aW9uXykpO3JldHVybiB0aGlzLnRvUlRDUnRwVHJhbnNjZWl2ZXJEaXJlY3Rpb24odGhpcy5kaXJlY3Rpb25fKX0sc2V0OmZ1bmN0aW9uKGEpe3ZhciBiPXRoaXM7bi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLnNldF9kaXJlY3Rpb24oKSBjYWxsZWQuIFwiK2EpO3RoaXMuZGlyZWN0aW9uXz10aGlzLnRvUnRwVHJhbnNjZWl2ZXJEaXJlY3Rpb24oYSk7dGhpcy53YWl0VW50aWxDb25uZWN0ZWQoXCJSdHBUcmFuc2NlaXZlci5zZXRfZGlyZWN0aW9uXCIpLnRoZW4oZnVuY3Rpb24oKXtyZXR1cm4gYi5yZW1vdGVJbnZva2UoITAsci5tZXRob2RfaWRfUlRDUnRwVHJhbnNjZWl2ZXJfdC5kaXJlY3Rpb24sYi50b1J0cFRyYW5zY2VpdmVyRGlyZWN0aW9uKGEpKX0pLnRoZW4oZnVuY3Rpb24oKXtuLmxvZ2dlci5sb2coYi51c2VyX2ZyaWVuZGx5X2lkKCkrXG5cIi5zZXRfZGlyZWN0aW9uOiBzdWNjZXNzLlwiKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYSl7Yi5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFwiLnNldF9kaXJlY3Rpb24oKSBmYWlsZWQhXCIpfSl9LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwiY3VycmVudERpcmVjdGlvblwiLHtnZXQ6ZnVuY3Rpb24oKXtuLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuZ2V0X2N1cnJlbnREaXJlY3Rpb24oKSBjYWxsZWQuIFwiK3RoaXMudG9SVENSdHBUcmFuc2NlaXZlckRpcmVjdGlvbih0aGlzLmRpcmVjdGlvbl8pKTtyZXR1cm4gdGhpcy50b1JUQ1J0cFRyYW5zY2VpdmVyRGlyZWN0aW9uKHRoaXMuY3VycmVudERpcmVjdGlvbl8pfSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO2IucHJvdG90eXBlLnN0b3A9ZnVuY3Rpb24oKXt2YXIgYT10aGlzO24ubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcblwiLnN0b3AoKSBjYWxsZWQuXCIpO3RoaXMud2FpdFVudGlsQ29ubmVjdGVkKFwiUnRwVHJhbnNjZWl2ZXIuc3RvcFwiKS50aGVuKGZ1bmN0aW9uKCl7cmV0dXJuIGEucmVtb3RlSW52b2tlKCEwLHIubWV0aG9kX2lkX1JUQ1J0cFRyYW5zY2VpdmVyX3Quc3RvcCl9KS50aGVuKGZ1bmN0aW9uKCl7bi5sb2dnZXIubG9nKGEudXNlcl9mcmllbmRseV9pZCgpK1wiLnN0b3A6IHN1Y2Nlc3MuXCIpfSlbXCJjYXRjaFwiXShmdW5jdGlvbihiKXthLmxvZ1JlbW90ZUludm9rZUVycm9yKGIsXCIuc3RvcCgpIGZhaWxlZCFcIil9KX07Yi5wcm90b3R5cGUuc2V0Q29kZWNQcmVmZXJlbmNlcz1mdW5jdGlvbihhKXt2YXIgYj10aGlzO24ubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRDb2RlY1ByZWZlcmVuY2VzKCkgY2FsbGVkLlwiKTt0aGlzLndhaXRVbnRpbENvbm5lY3RlZChcIlJ0cFRyYW5zY2VpdmVyLnNldENvZGVjUHJlZmVyZW5jZXNcIikudGhlbihmdW5jdGlvbigpe3JldHVybiBiLnJlbW90ZUludm9rZSghMCxcbnIubWV0aG9kX2lkX1JUQ1J0cFRyYW5zY2VpdmVyX3Quc2V0Q29kZWNQcmVmZXJlbmNlcyxhKX0pLnRoZW4oZnVuY3Rpb24oKXtuLmxvZ2dlci5sb2coYi51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc2V0Q29kZWNQcmVmZXJlbmNlczogc3VjY2Vzcy5cIil9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2IubG9nUmVtb3RlSW52b2tlRXJyb3IoYSxcIi5zZXRDb2RlY1ByZWZlcmVuY2VzKCkgZmFpbGVkIVwiKX0pfTtiLnByb3RvdHlwZS50b1J0cFRyYW5zY2VpdmVyRGlyZWN0aW9uPWZ1bmN0aW9uKGEpe3ZhciBiPXAua1NlbmRSZWN2O3N3aXRjaChhKXtjYXNlIFwiaW5hY3RpdmVcIjpiPXAua0luYWN0aXZlO2JyZWFrO2Nhc2UgXCJyZWN2b25seVwiOmI9cC5rUmVjdk9ubHk7YnJlYWs7Y2FzZSBcInNlbmRvbmx5XCI6Yj1wLmtTZW5kT25seTticmVhaztjYXNlIFwic2VuZHJlY3ZcIjpiPXAua1NlbmRSZWN2O2JyZWFrO2RlZmF1bHQ6Yj1wLmtJbmFjdGl2ZX1yZXR1cm4gYn07Yi5wcm90b3R5cGUudG9SVENSdHBUcmFuc2NlaXZlckRpcmVjdGlvbj1cbmZ1bmN0aW9uKGEpe3ZhciBiPVwic2VuZHJlY3ZcIjtzd2l0Y2goYSl7ZGVmYXVsdDpiPVwiaW5hY3RpdmVcIjticmVhaztjYXNlIHAua1JlY3ZPbmx5OmI9XCJyZWN2b25seVwiO2JyZWFrO2Nhc2UgcC5rU2VuZE9ubHk6Yj1cInNlbmRvbmx5XCI7YnJlYWs7Y2FzZSBwLmtTZW5kUmVjdjpiPVwic2VuZHJlY3ZcIn1yZXR1cm4gYn07cmV0dXJuIGJ9KGUuUHJveHlPYmplY3QpO2EuUnRwVHJhbnNjZWl2ZXI9Yn0sNTA5OmZ1bmN0aW9uKGIsYSl7T2JqZWN0LmRlZmluZVByb3BlcnR5KGEsXCJfX2VzTW9kdWxlXCIse3ZhbHVlOiEwfSk7KGZ1bmN0aW9uKGEpe2FbYS5Vbmtub3duPTBdPVwiVW5rbm93blwiO2FbYS5DYXA9MV09XCJDYXBcIjthW2EuR2V0U291cmNlcz0yXT1cIkdldFNvdXJjZXNcIjthW2EuU2V0QWN0aXZlPTNdPVwiU2V0QWN0aXZlXCI7YVthLlRvcG9sb2d5Q2hhbmdlZD00XT1cIlRvcG9sb2d5Q2hhbmdlZFwifSkoYS5zc2hhcmVfY21kfHwoYS5zc2hhcmVfY21kPXt9KSk7KGZ1bmN0aW9uKGEpe2FbYS5Vbmtub3duPVxuMF09XCJVbmtub3duXCI7YVthLkluaXRpYWxpemVkPTFdPVwiSW5pdGlhbGl6ZWRcIjthW2EuRXJyb3I9Ml09XCJFcnJvclwifSkoYS5zc2hhcmVfc3RhdGV8fChhLnNzaGFyZV9zdGF0ZT17fSkpO3ZhciBjPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gYSgpe31hLnByb3RvdHlwZS5vbkluaXRpYWxpemVkPWZ1bmN0aW9uKGEpe307YS5wcm90b3R5cGUub25Jbml0Q29tcGxldGU9ZnVuY3Rpb24oKXt9O2EucHJvdG90eXBlLm9uRXJyb3I9ZnVuY3Rpb24oYSl7fTthLnByb3RvdHlwZS5vbkdldFNvdXJjZXM9ZnVuY3Rpb24oYSxiKXt9O2EucHJvdG90eXBlLm9uU2V0QWN0aXZlPWZ1bmN0aW9uKGEsYil7fTthLnByb3RvdHlwZS5vblRvcGxvZ3lDaGFuZ2VkPWZ1bmN0aW9uKCl7fTtyZXR1cm4gYX0oKTthLlNjcmVlblNoYXJlVXRpbD1jfSw1MTc6ZnVuY3Rpb24oYixhKXtPYmplY3QuZGVmaW5lUHJvcGVydHkoYSxcIl9fZXNNb2R1bGVcIix7dmFsdWU6ITB9KTt2YXIgYz1mdW5jdGlvbigpe2Z1bmN0aW9uIGEoKXt0aGlzLml0ZW1zPVxuW119YS5mcm9tSlNPTj1mdW5jdGlvbihiKXtmb3IodmFyIGM9bmV3IGEsZz0wO2c8Yi5sZW5ndGg7ZysrKXt2YXIgZT1kLmZyb21KU09OKGJbZ10pO2MuaXRlbXMucHVzaChlKX1yZXR1cm4gY307YS50b1JUQ1N0YXRzUmVwb3J0PWZ1bmN0aW9uKGEpe3JldHVybiBhfTthLnByb3RvdHlwZS50b0pTT049ZnVuY3Rpb24oKXtyZXR1cm4gSlNPTi5zdHJpbmdpZnkodGhpcy5pdGVtcyl9O2EucHJvdG90eXBlLnJlc3VsdD1mdW5jdGlvbigpe3JldHVybiB0aGlzLml0ZW1zfTtyZXR1cm4gYX0oKTthLlN0YXRzUmVwb3J0PWM7dmFyIGQ9ZnVuY3Rpb24oKXtmdW5jdGlvbiBhKCl7dGhpcy5uYW1lc189W107dGhpcy5zdGF0Xz1uZXcgTWFwO3RoaXMuaWQ9XCJcIjt0aGlzLnRpbWVzdGFtcD0wO3RoaXMudHlwZT1cIlwifWEuZnJvbUpTT049ZnVuY3Rpb24oYil7dmFyIGM9bmV3IGE7Yy5pZD1iLmlkfHxcIlwiO2MudGltZXN0YW1wPWIudGltZXN0YW1wfHxcIlwiO2MudHlwZT1iLnR5cGV8fFwiXCI7T2JqZWN0LmtleXMoYikuZm9yRWFjaChmdW5jdGlvbihhKXtcImlkXCIhPT1cbmEmJlwidGltZXN0YW1wXCIhPT1hJiZcInR5cGVcIiE9PWEmJihjLm5hbWVzXy5wdXNoKGEpLGMuc3RhdF8uc2V0KGEsYlthXSkpfSk7cmV0dXJuIGN9O2EucHJvdG90eXBlLnRvSlNPTj1mdW5jdGlvbigpe3JldHVybiBKU09OLnN0cmluZ2lmeSh7aWQ6dGhpcy5pZCx0aW1lc3RhbXA6dGhpcy50aW1lc3RhbXAsdHlwZTp0aGlzLnR5cGUsc3RhdDp0aGlzLnN0YXRffSl9O2EucHJvdG90eXBlLm5hbWVzPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubmFtZXNffTthLnByb3RvdHlwZS5zdGF0PWZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnN0YXRfLmdldChhKX07cmV0dXJuIGF9KCk7YS5TdGF0cz1kfSwzOTQ6ZnVuY3Rpb24oYixhLGMpe09iamVjdC5kZWZpbmVQcm9wZXJ0eShhLFwiX19lc01vZHVsZVwiLHt2YWx1ZTohMH0pO3ZhciBkPWMoOTQ2KSxlPWMoODUxKTsoZnVuY3Rpb24oYSl7YVthLnVua25vd249MF09XCJ1bmtub3duXCI7YVthLmFjdGl2ZT0xXT1cImFjdGl2ZVwiO2FbYS5pZGxlPTJdPVwiaWRsZVwifSkoYS50ZWxfQ2FsbFN0YXRlfHxcbihhLnRlbF9DYWxsU3RhdGU9e30pKTsoZnVuY3Rpb24oYSl7YVthLnVua25vd249MF09XCJ1bmtub3duXCI7YVthLmluY29taW5nPTFdPVwiaW5jb21pbmdcIjthW2Eub3V0Z29pbmc9Ml09XCJvdXRnb2luZ1wifSkoYS50ZWxfQ2FsbERpcmVjdGlvbnx8KGEudGVsX0NhbGxEaXJlY3Rpb249e30pKTsoZnVuY3Rpb24oYSl7YVthLnVua25vd249MF09XCJ1bmtub3duXCI7YVthLmF1ZGlvPTFdPVwiYXVkaW9cIjthW2EudmlkZW89Ml09XCJ2aWRlb1wiO2FbYS5tdWx0aT0zXT1cIm11bHRpXCI7YVthLmRzaGFyZT00XT1cImRzaGFyZVwifSkoYS50ZWxfQ2FsbFR5cGV8fChhLnRlbF9DYWxsVHlwZT17fSkpO3ZhciByOyhmdW5jdGlvbihhKXthW2EuVW5rbm93bj0wXT1cIlVua25vd25cIjthW2EuQ2FwPTFdPVwiQ2FwXCI7YVthLkluaXQ9Ml09XCJJbml0XCI7YVthLkRhdGE9M109XCJEYXRhXCJ9KShyPWEudGVsX2NtZHx8KGEudGVsX2NtZD17fSkpO2EudGVsX2tleV9Db25mZXJlbmNlQ2FsbER1cmF0aW9uPVwiQ29uZmVyZW5jZUNhbGxEdXJhdGlvblwiO1xuYS50ZWxfa2V5X0F1ZGlvQ2FsbER1cmF0aW9uPVwiQXVkaW9DYWxsRHVyYXRpb25cIjthLnRlbF9rZXlfVmlkZW9DYWxsRHVyYXRpb249XCJWaWRlb0NhbGxEdXJhdGlvblwiO2EudGVsX2tleV9TY3JlZW5zaGFyaW5nQ2FsbER1cmF0aW9uPVwiU2NyZWVuc2hhcmluZ0NhbGxEdXJhdGlvblwiO2EudGVsX2tleV9DYWxsRXN0SW5jb21pbmc9XCJDYWxsRXN0SW5jb21pbmdcIjthLnRlbF9rZXlfQ2FsbEVzdE91dGdvaW5nPVwiQ2FsbEVzdE91dGdvaW5nXCI7YS50ZWxfa2V5X0F1ZGlvRGV2aWNlVXNlZD1cIkF1ZGlvRGV2aWNlVXNlZFwiO2EudGVsX2tleV9WaWRlb0RldmljZVVzZWQ9XCJWaWRlb0RldmljZVVzZWRcIjthLnRlbF9rZXlfU3BlYWtlckRldmljZVVzZWQ9XCJTcGVha2VyRGV2aWNlVXNlZFwiO2EudGVsX2tleV9QZXJmQ2FsbERpcmVjdGlvbj1cIlBlcmZDYWxsRGlyZWN0aW9uXCI7YS50ZWxfa2V5X1BlcmZDYWxsU3RhdGU9XCJQZXJmQ2FsbFN0YXRlXCI7YS50ZWxfa2V5X1BlcmZDYWxsVHlwZT1cIlBlcmZDYWxsVHlwZVwiO1xuYS50ZWxfa2V5X1ZlcldlYnJwYz1cIlZlcldlYnJwY1wiO2EudGVsX2tleV9WZXJXZWJydGNDb2RlY3M9XCJWZXJXZWJydGNDb2RlY3NcIjthLnRlbF9rZXlfVmVyUmVjZWl2ZXI9XCJWZXJSZWNlaXZlclwiO2EudGVsX2tleV9WZXJWZGE9XCJWZXJWZGFcIjthLnRlbF9rZXlfVmVyRW5kcG9pbnQ9XCJWZXJFbmRwb2ludFwiO2EudGVsX2tleV9WZXJUeXBlU2NyaXB0PVwiVmVyVHlwZVNjcmlwdFwiO2EudGVsX2tleV9PU0ZhbWlseT1cIk9TRmFtaWx5XCI7YS50ZWxfa2V5X09TVmVyc2lvbj1cIk9TVmVyc2lvblwiO2EudGVsX2tleV9PU0FyY2hpdGVjdHVyZT1cIk9TQXJjaGl0ZWN0dXJlXCI7YS50ZWxfa2V5X09TRGlzdHJvPVwiT1NEaXN0cm9cIjthLnRlbF9rZXlfT1NFZGl0aW9uPVwiT1NFZGl0aW9uXCI7dmFyIG49ZnVuY3Rpb24oKXtmdW5jdGlvbiBhKGIsYyxkLGcpe3RoaXMuY21kPWI7dGhpcy5rZXk9Yzt0aGlzLnZhbHVlPWQ7dGhpcy5mbGFncz1nfWEucHJvdG90eXBlLlNlbmRUZWxlbWV0cnlEYXRhPWZ1bmN0aW9uKGEpe2EuU2VuZFRlbGVtZXRyeURhdGEodGhpcy5jbWQsXG50aGlzLmtleSx0aGlzLnZhbHVlLHRoaXMuZmxhZ3MpfTtyZXR1cm4gYX0oKTtiPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gYSgpe3RoaXMuaWQ9MDt0aGlzLmRlZmVycmVkRGF0YT1bXX1hLnByb3RvdHlwZS5yZXNldD1mdW5jdGlvbigpe3RoaXMuaWQ9MDt0aGlzLmRlZmVycmVkRGF0YT1bXX07YS5wcm90b3R5cGUub25Jbml0aWFsaXplZD1mdW5jdGlvbihhKXtmb3IodGhpcy5pZD1hO3RoaXMuZGVmZXJyZWREYXRhJiYwPHRoaXMuZGVmZXJyZWREYXRhLmxlbmd0aDspdGhpcy5kZWZlcnJlZERhdGEuc2hpZnQoKS5TZW5kVGVsZW1ldHJ5RGF0YSh0aGlzKX07YS5wcm90b3R5cGUuU2VuZFRlbGVtZXRyeUluaXQ9ZnVuY3Rpb24oKXswPHRoaXMuaWQmJnRoaXMucmVzZXQoKTt0cnl7ZC5nZXRSZWRpcmVjdG9yKCkuV1NTZW5kT2JqZWN0KHt2OlwidGVsZW1ldHJ5XCIsaGRyOntjb21tYW5kOnIuSW5pdCxpZDowfSxpbml0Ontkb21haW46XCJIRFhNTSBUZWFtc1wiLHN1YmRvbWFpbjpcIlRlYW1zXCIsZmVhdHVyZTpcIm1zdGVhbXNcIixcbnZlcnNpb246XCIxLjEuMS4xXCJ9fSl9Y2F0Y2goYSl7ZS5sb2dnZXIubG9nKGEpfX07YS5wcm90b3R5cGUuU2VuZFRlbGVtZXRyeURhdGE9ZnVuY3Rpb24oYSxiLGMsZyl7aWYoYSE9ci5EYXRhKWUubG9nZ2VyLmxvZyhcImludmFsaWQgdGVsZW1ldHJ5IGNvbW1hbmQhXCIpO2Vsc2UgaWYoMD09dGhpcy5pZCl0aGlzLmRlZmVycmVkRGF0YS5wdXNoKG5ldyBuKGEsYixjLGcpKTtlbHNlIHRyeXtkLmdldFJlZGlyZWN0b3IoKS5XU1NlbmRPYmplY3Qoe3Y6XCJ0ZWxlbWV0cnlcIixoZHI6e2NvbW1hbmQ6YSxpZDp0aGlzLmlkfSxkYXRhOntrZXk6Yix2YWx1ZTpjLGZsYWdzOmd9fSl9Y2F0Y2gobSl7ZS5sb2dnZXIubG9nKG0pfX07cmV0dXJuIGF9KCk7YS5UZWxlbWV0cnk9Yn0sMzA3OmZ1bmN0aW9uKGIsYSxjKXt2YXIgZD1jKDU1MCkuRmVhdHVyZXMsZT1jKDM2MCkscj1jKDE0NCksbj1jKDY3OSksZz1jKDk0NSkscD1jKDM2OCksZj1jKDg1MSkubG9nZ2VyLGs9Yyg2NTApLHg9YygyNDcpLmdjLFxubT1jKDk0Nik7KGZ1bmN0aW9uKGEsYil7YS5DaXRyaXhXZWJSVEM9YigpfSkoXCJ1bmRlZmluZWRcIiE9PXR5cGVvZiBzZWxmP3NlbGY6dGhpcyxmdW5jdGlvbigpe2Z1bmN0aW9uIGEoYil7bS5nZXRSZWRpcmVjdG9yKCkuU2VuZFRlbGVtZXRyeURhdGFfU3BlYWtlcihiKX1mdW5jdGlvbiBiKCl7dmFyIGE9d2luZG93LmdldENpdHJpeFdlYnJ0Y1JlZGlyO3ZvaWQgMCE9PWE/YSgpLnRoZW4oZnVuY3Rpb24oYSl7Zi5sb2coXCJzdWNlc3NzIG9uIGNvbm5lY3QsIGdldENpdHJpeFdlYnJ0Y1JlZGlyIHJlZyB2YWx1ZTpcIithKTtcIjFcIj09PWEmJm51bGw9PT1JJiYoZi5sb2coXCJzdXBwb3J0ZWQgY2xpZW50XCIpLEk9bmV3IGsuUmVtb3RlU2Vzc2lvbil9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKCl7Zi5sb2coXCJGYWlsdXJlIHRvIFJlYWQgV2VicnRjIHJlZGlyIFJlZyBLZXlcIik7aCgpfSk6KGYubG9nKFwid2luZG93LmdldENpdHJpeFdlYnJ0Y1JlZGlyKCkgbWV0aG9kIGlzIG5vdCBhdmFpbGFibGUgeWV0XCIpLFxuaCgpKX1mdW5jdGlvbiBjKGEpe2lmKFwiMVwiPT09YSlmLmxvZyhcIlN1cHBvcnRlZCBjbGllbnRcIiksbS5nZXRSZWRpcmVjdG9yKCkucGluZ0Nvbm5lY3Rpb25CZWdpbighMCk7ZWxzZSBpZihcIjBcIj09PWEpe2YubG9nKFwiVkRJIEV2ZW50OiBVbnN1cHBvcnRlZCBjbGllbnQgcmVwb3J0ZWRcIik7dHJ5e0Yoe2V2ZW50OlwidmRpQ2xpZW50RGlzY29ubmVjdGVkXCIscmVhc29uOlwiZW5kcG9pbnRVbnN1cHBvcnRlZFwiLG1zZzpcIlVuc3VwcG9ydGVkIGVuZHBvaW50IGNvbm5lY3RlZFwifSl9Y2F0Y2goYil7Zi5sb2coXCJvblZNRXZlbnQoKTogZXhjZXB0aW9uOiBcIitiLm1lc3NhZ2UpfX1lbHNlIGYubG9nKFwiQ2l0cml4IFdlYnJ0YyBSZWRpciBSZWcgS2V5IHZhbHVlIGlzIGluY29ycmVjdFwiKX1mdW5jdGlvbiBoKCl7ITE9PT1IJiYoZi5sb2coXCJzdGFydGluZyBNUyBSZWcgcmV0cnkuLi5cIiksSD0hMCxBKDEwKSl9ZnVuY3Rpb24gQShhKXtpZigwPj1hKXtIPSExO2YubG9nKFwiVkRJIEV2ZW50OiBSZWcgS2V5IG5vdCBVcGRhdGVkIGFmdGVyIHRpbWVyIHJlcG9ydGVkLCBGYWxsYmFja1wiKTtcbnRyeXtGKHtldmVudDpcInZkaUNsaWVudERpc2Nvbm5lY3RlZFwiLHJlYXNvbjpcImZhaWx1cmVcIixtc2c6XCJDaXRyaXggV2VicnRjIFJlZGlyIFJlZyBLZXkgbm90IFByZXNlbnRcIn0pfWNhdGNoKGIpe2YubG9nKFwib25WTUV2ZW50KCk6IGV4Y2VwdGlvbjogXCIrYi5tZXNzYWdlKX19ZWxzZXt2YXIgZD13aW5kb3cuZ2V0Q2l0cml4V2VicnRjUmVkaXI7dm9pZCAwIT09ZD9kKCkudGhlbihmdW5jdGlvbihiKXtmLmxvZyhcIkNpdHJpeE1TVGVhbXNSZWRpciByZWcgdmFsdWU6XCIrYik7XCIwXCI9PT1ifHxcIjFcIj09PWI/KGMoYiksSD0hMSk6KGYubG9nKFwiTVMgVGVhbXMgUmVkaXIgUmVnIGtleSBub3QgdXBkYXRlZCAtIFN0YXJ0IHRpbWVyXCIpLHNldFRpbWVvdXQoZnVuY3Rpb24oKXtmLmxvZyhcIlRpbWVyIHdhaXRpbmcgZm9yIHJlZ2lzdHJ5IHRvIGJlIHVwZGF0ZWQgY291bnQgOlwiK2EpO0EoLS1hKX0sMUUzKSl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKCl7Zi5sb2coXCJGYWlsdXJlIHRvIFJlYWQgTVMgVGVhbXMgcmVkaXIgUmVnIEtleSAtIFN0YXJ0IHRpbWVyXCIpO1xuc2V0VGltZW91dChmdW5jdGlvbigpe2YubG9nKFwiVGltZXIgd2FpdGluZyBmb3IgcmVnaXN0cnkgdG8gYmUgdXBkYXRlZCBjb3VudCA6XCIrYSk7QSgtLWEpfSwxRTMpfSk6KGYubG9nKFwid2luZG93LmdldENpdHJpeFdlYnJ0Y1JlZGlyKCkgbWV0aG9kIGlzIG5vdCBhdmFpbGFibGUgeWV0XCIpLHNldFRpbWVvdXQoZnVuY3Rpb24oKXtmLmxvZyhcIlRpbWVyIHdhaXRpbmcgZm9yIHJlZ2lzdHJ5IHRvIGJlIHVwZGF0ZWQgY291bnQgOlwiK2EpO0EoLS1hKX0sMUUzKSl9fWZ1bmN0aW9uIHkoKXtmLmxvZyhcIlZESTogc2VuZFNlc3Npb25JbmZvXCIpO0kmJkkuZ2V0U2Vzc2lvbkluZm8oKS50aGVuKGZ1bmN0aW9uKGEpe2YubG9nKFwiZ2V0U2Vzc2lvbkluZm8gc3VjY2VzcyEgaW5mbzpcIitKU09OLnN0cmluZ2lmeShhKSk7dHJ5e0Yoe2V2ZW50OlwidmRpQ2xpZW50Q29ubmVjdGVkXCIsdmVyc2lvbjphfSl9Y2F0Y2goYil7Zi5sb2coXCJvblZNRXZlbnQoKTogZXhjZXB0aW9uOiBcIitiLm1lc3NhZ2UpfX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oKXtmLmxvZyhcImdldFNlc3Npb25JbmZvIGZhaWx1cmUhIHNlc3Npb24gaXMgbm90IGZ1bGx5IGNvbm5lY3RlZCB5ZXQuLi5cIil9KX1cbnZhciBFPWUuUGVlckNvbm5lY3Rpb24sdT1uZXcgci5OYXZpZ2F0b3JVc2VyTWVkaWEscT1yLk5hdmlnYXRvclVzZXJNZWRpYS5nZXRDYXBhYmlsaXRpZXMsdz1uZXcgci5SZW1vdGVEZXZpY2VzLHo9bmV3IHAuRnJhbWVUcmFja2VyLEM9MCxGPXdpbmRvdy5WTUV2ZW50Q2FsbGJhY2ssbD0hMTt3aW5kb3cub25WZGlDbGllbnREaXNjb25uZWN0ZWQ9ZnVuY3Rpb24oYSl7Zi5sb2coXCJWREkgRXZlbnQ6IHZkaUNsaWVudERpc2Nvbm5lY3RlZFwiKTtmLmxvZyhcIlZESSA6IGNsZWFudXBcIik7bS5nZXRSZWRpcmVjdG9yKCkuY2xlYXJSZXFzKCk7ci5OYXZpZ2F0b3JVc2VyTWVkaWEucmVzZXRjYXBzKCk7ej13PXU9bnVsbDtJJiZJLnJlbGVhc2UoKTtJPW51bGw7eC5yZXNldCgpO2YubG9nKFwiVkRJIDogY2xlYW51cCBkb25lXCIpO2lmKCEwPT09YSYmITE9PT1sKXtmLmxvZyhcIlZESSBFdmVudDogdmRpQ2xpZW50RGlzY29ubmVjdGVkIHdpdGggZmFpbHVyZSByZXBvcnRlZFwiKTtsPSEwO3RyeXtGKHtldmVudDpcInZkaUNsaWVudERpc2Nvbm5lY3RlZFwiLFxucmVhc29uOlwiZmFpbHVyZVwiLG1zZzpcIldlYnNvY2tldCBDb25uZWN0aW9uIEZhaWx1cmVcIn0pfWNhdGNoKGIpe2YubG9nKFwib25WTUV2ZW50KCk6IGV4Y2VwdGlvbjogXCIrYi5tZXNzYWdlKX19ZWxzZXtsPSExO3RyeXtGKHtldmVudDpcInZkaUNsaWVudERpc2Nvbm5lY3RlZFwiLHJlYXNvbjpcImVuZHBvaW50RGlzY29ubmVjdGVkXCJ9KX1jYXRjaChiKXtmLmxvZyhcIm9uVk1FdmVudCgpOiBleGNlcHRpb246IFwiK2IubWVzc2FnZSl9fX07dmFyIEk9bmV3IGsuUmVtb3RlU2Vzc2lvbjt3aW5kb3cub25WZGlDbGllbnREaXNjb25uZWN0ZWRUaW1lcj1mdW5jdGlvbigpe2YubG9nKFwiVkRJIEV2ZW50OiBvblZkaUNsaWVudERpc2Nvbm5lY3RlZFRpbWVyXCIpO251bGw9PT1JJiYoST1uZXcgay5SZW1vdGVTZXNzaW9uKX07d2luZG93Lm9uVmRpQ2xpZW50Q29ubmVjdGVkPWZ1bmN0aW9uKCl7Zi5sb2coXCJWREkgRXZlbnQ6IHZkaUNsaWVudENvbm5lY3RlZFwiKTtwLkZyYW1lVHJhY2tlci5zZW5kT3ZlcmxheUluZm8oKTtcbm51bGwhPT13JiZ3LmlzVmFsaWQoKXx8KHc9bmV3IHIuUmVtb3RlRGV2aWNlcyk7bnVsbCE9PXUmJnUuaXNWYWxpZCgpfHwodT1uZXcgci5OYXZpZ2F0b3JVc2VyTWVkaWEpO3UuZ2V0Q2FwYWJpbGl0aWVzKCkudGhlbihmdW5jdGlvbihhKXtmLmxvZyhcIi5nZXRDYXBhYmlsaXRpZXMoKSBzdWNjZXNzIFwiK2EpfSlbXCJjYXRjaFwiXShmdW5jdGlvbigpe2YubG9nKFwiLmdldENhcGFiaWxpdGllcygpIGZhaWx1cmVcIil9KTt5KCk7bmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudChcImRldmljZWNoYW5nZVwiKSl9O3ZhciBIPSExO3JldHVybntGZWF0dXJlczpkLENpdHJpeFBlZXJDb25uZWN0aW9uOkUsZ2V0VXNlck1lZGlhOmZ1bmN0aW9uKGEsYyxkKXtiKCk7Zi5sb2coXCJWREkgU2hpbSBnZXRVc2VyTWVkaWFcIik7bnVsbCE9PXUmJnUuaXNWYWxpZCgpfHwodT1uZXcgci5OYXZpZ2F0b3JVc2VyTWVkaWEpO3JldHVybiB1LndlYmtpdEdldFVzZXJNZWRpYShhLFxuYyxkKX0sZ2V0RGlzcGxheU1lZGlhOmZ1bmN0aW9uKGEpe2IoKTtmLmxvZyhcIlZESSBTaGltIGdldERpc3BsYXlNZWRpYVwiKTtudWxsIT09dyYmdy5pc1ZhbGlkKCl8fCh3PW5ldyByLlJlbW90ZURldmljZXMpO3JldHVybiB3LmdldERpc3BsYXlNZWRpYShhKX0sZW51bWVyYXRlRGV2aWNlczpmdW5jdGlvbigpe2IoKTtudWxsIT09dyYmdy5pc1ZhbGlkKCl8fCh3PW5ldyByLlJlbW90ZURldmljZXMpO3JldHVybiB3LmVudW1lcmF0ZURldmljZXMoKX0sbWFwVmlkZW9FbGVtZW50OmZ1bmN0aW9uKGEpe2YubG9nKFwiVkRJIE5ldyBWaWRlbyBFbGVtZW50IENyZWF0ZWQsIENyZWF0aW5nIE1hcHBpbmcgdG8gVkRBXCIpO251bGw9PT16JiYoej1uZXcgcC5GcmFtZVRyYWNrZXIpO3ZvaWQgMCE9PWEucmVtb3RlVmlkZW9FbGVtZW50P2YubG9nKFwiVmlkZW8gZWxlbWVudCBpcyBhbHJlYWR5IGNvbmZpZ3VyZWQhXCIpOihiKCksT2JqZWN0LmRlZmluZVByb3BlcnR5KGEsXCJyZW1vdGVWaWRlb0VsZW1lbnRcIixcbnt3cml0YWJsZTohMCx2YWx1ZTpudWxsfSksYS5pZHx8KGEuaWQ9XCJjdHgtdmlkLVwiK0MrKyksYS5yZW1vdGVWaWRlb0VsZW1lbnQ9bmV3IG4uVmlkZW9FbGVtZW50KGEuaWQpLGEucmVtb3RlVmlkZW9FbGVtZW50Lm9ubG9hZGVkbWV0YWRhdGE9ZnVuY3Rpb24oKXt2YXIgYj1uZXcgRXZlbnQoXCJsb2FkZWRtZXRhZGF0YVwiKTthLmRpc3BhdGNoRXZlbnQoYil9LGEucmVtb3RlVmlkZW9FbGVtZW50Lm9udGltZXVwZGF0ZT1mdW5jdGlvbigpe3ZhciBiPW5ldyBFdmVudChcInRpbWV1cGRhdGVcIik7YS5kaXNwYXRjaEV2ZW50KGIpfSxhLnJlbW90ZVZpZGVvRWxlbWVudC5vbmNvbm5lY3Rpb25zdGF0ZWNoYW5nZT1mdW5jdGlvbigpe1wiY29ubmVjdGVkXCI9PT1hLnJlbW90ZVZpZGVvRWxlbWVudC5jb25uZWN0aW9uU3RhdGU/ei50cmFjayhhLGZ1bmN0aW9uKGIpe2EucmVtb3RlVmlkZW9FbGVtZW50LnNldEZyYW1lKGIpfSk6ei51bnRyYWNrKGEpfSxPYmplY3QuZGVmaW5lUHJvcGVydHkoYSxcInNpbmtJZFwiLFxue2dldDpmdW5jdGlvbigpe3JldHVybiBhLnJlbW90ZVZpZGVvRWxlbWVudC5zaW5rSWR9LHNldDpmdW5jdGlvbihiKXtmLmxvZyhcIlZESSBTaGltIHNldCB2aWRlbyBlbGVtZW50IFNpbmtJZCB2YWx1ZSA9IFwiK2IpO2EucmVtb3RlVmlkZW9FbGVtZW50LnNpbmtJZD1ifX0pLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShhLFwic3JjT2JqZWN0XCIse2dldDpmdW5jdGlvbigpe3JldHVybiBhLnJlbW90ZVZpZGVvRWxlbWVudC5zcmNPYmplY3R9LHNldDpmdW5jdGlvbihiKXtmLmxvZyhcIlZESSBTaGltIHNldCB2aWRlbyBlbGVtZW50IHNyY09iamVjdFwiKTthLnJlbW90ZVZpZGVvRWxlbWVudC5zcmNPYmplY3Q9Yn19KSxPYmplY3QuZGVmaW5lUHJvcGVydHkoYSxcInZpZGVvV2lkdGhcIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGEucmVtb3RlVmlkZW9FbGVtZW50LnZpZGVvV2lkdGh9fSksT2JqZWN0LmRlZmluZVByb3BlcnR5KGEsXCJ2aWRlb0hlaWdodFwiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gYS5yZW1vdGVWaWRlb0VsZW1lbnQudmlkZW9IZWlnaHR9fSkpfSxcbm1hcEF1ZGlvRWxlbWVudDpmdW5jdGlvbihjKXtmLmxvZyhcIlZESSBOZXcgQXVkaW8gRWxlbWVudCBDcmVhdGVkLCBDcmVhdGluZyBNYXBwaW5nIHRvIFZEQVwiKTtpZih2b2lkIDAhPT1jLnJlbW90ZUF1ZGlvRWxlbWVudClmLmxvZyhcIkF1ZGlvIGVsZW1lbnQgaXMgYWxyZWFkeSBjb25maWd1cmVkIVwiKTtlbHNle2IoKTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYyxcInJlbW90ZUF1ZGlvRWxlbWVudFwiLHt3cml0YWJsZTohMCx2YWx1ZTpudWxsfSk7Yy5yZW1vdGVBdWRpb0VsZW1lbnQ9bmV3IGcuQXVkaW9FbGVtZW50O3ZhciBkPWMucmVtb3RlQXVkaW9FbGVtZW50LnBsYXk7Yy5wbGF5PWZ1bmN0aW9uKCl7Zi5sb2coXCJWREkgU2hpbSByZW1vdGUgYXVkaW8gcGxheVwiKTtyZXR1cm4gZC5hcHBseShjLnJlbW90ZUF1ZGlvRWxlbWVudCxhcmd1bWVudHMpfTt2YXIgbD1jLnJlbW90ZUF1ZGlvRWxlbWVudC5wYXVzZTtjLnBhdXNlPWZ1bmN0aW9uKCl7Zi5sb2coXCJWREkgU2hpbSByZW1vdGUgYXVkaW8gcGF1c2VcIik7XG5yZXR1cm4gbC5hcHBseShjLnJlbW90ZUF1ZGlvRWxlbWVudCxhcmd1bWVudHMpfTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYyxcInNpbmtJZFwiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gYy5yZW1vdGVBdWRpb0VsZW1lbnQuc2lua0lkfSxzZXQ6ZnVuY3Rpb24oYSl7Zi5sb2coXCJWREkgU2hpbSBzZXQgYXVkaW8gZWxlbWVudCBTaW5rSWQgdmFsdWUgPSBcIithKTtjLnNldFNpbmtJZChhKS50aGVuKGZ1bmN0aW9uKCl7Zi5sb2coXCJWREkgU2hpbSBzZXQgYXVkaW8gZWxlbWVudCBTaW5rSWQgc3VjY2Vzc1wiKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oKXtmLmxvZyhcIlZESSBTaGltIHNldCBhdWRpbyBlbGVtZW50IFNpbmtJZCBmYWlsdXJlXCIpfSl9fSk7Yy5zZXRTaW5rSWQ9ZnVuY3Rpb24oYil7Zi5sb2coXCJWREkgU2hpbSBzZXQgYXVkaW8gZWxlbWVudCBTaW5rSWQgdmFsdWUgPSBcIitiKTt2YXIgZD1jLnJlbW90ZUF1ZGlvRWxlbWVudC5zZXRTaW5rSWQoYiksbDtyLmVudW1lcmF0ZWRkZWNpY2VzLmZvckVhY2goZnVuY3Rpb24oYSl7Yj09PVxuYS5kZXZpY2VJZCYmKGw9YS5sYWJlbCl9KTthKGwpO3JldHVybiBkfTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYyxcInNyY09iamVjdFwiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gYy5yZW1vdGVBdWRpb0VsZW1lbnQuc3JjT2JqZWN0fSxzZXQ6ZnVuY3Rpb24oYSl7Zi5sb2coXCJWREkgU2hpbSBzZXQgYXVkaW8gZWxlbWVudCBzcmNPYmplY3QgXCIrSlNPTi5zdHJpbmdpZnkoYSkpO2MucmVtb3RlQXVkaW9FbGVtZW50LnNyY09iamVjdD1hfX0pfX0sc2V0Vk1FdmVudENhbGxiYWNrOmZ1bmN0aW9uKGEpe0Y9YTttLmdldFJlZGlyZWN0b3IoKS5pc0Nvbm5lY3RlZCgpJiYhd2luZG93LlZNRXZlbnRDYWxsYmFjayYmeSgpO3dpbmRvdy5WTUV2ZW50Q2FsbGJhY2s9bnVsbDtmLmxvZyhcIlZESSBFdmVudCBDYWxsYmFjayBTZXRcIil9LGFkZENsaXBSZWN0OmZ1bmN0aW9uKGEpe2YubG9nKFwiVkRJIEFkZGluZyBPY2NsdXNpb24gXCIrSlNPTi5zdHJpbmdpZnkoYSkpO251bGw9PT16JiYoej1uZXcgcC5GcmFtZVRyYWNrZXIpO1xuei5hZGRPY2NsdXNpb24oYSl9LHJlbW92ZUNsaXBSZWN0OmZ1bmN0aW9uKGEpe2YubG9nKFwiVkRJIFJlbW92aW5nIE9jY2x1c2lvbiBcIitKU09OLnN0cmluZ2lmeShhKSk7bnVsbD09PXomJih6PW5ldyBwLkZyYW1lVHJhY2tlcik7ei5yZW1vdmVPY2NsdXNpb24oYSl9LGluaXRMb2c6ZnVuY3Rpb24oYSl7Zi5zZXRNU0xvZ2dlcihhKTtmLmxvZyhcIlZESSBpbml0IGxvZ2dlclwiKX0saXNGZWF0dXJlT246ZnVuY3Rpb24oYSl7cmV0dXJuIG51bGw9PT1JPyExOkkuaXNGZWF0dXJlU3VwcG9ydGVkKGEpfSxvbkNvbm5lY3Rpb25DaGFuZ2U6ZnVuY3Rpb24oYSl7Zi5sb2coXCJWREkgOiBvbkNvbm5lY3Rpb25DaGFuZ2UgdG8gXCIrYSk7ITE9PT1hP2YubG9nKFwiRGlzY29ubmVjdGluZyBmcm9tIHRoZSBWREFcIik6KGYubG9nKFwiQ29ubmVjdGluZyB0byB0aGUgVkRBXCIpLGE9d2luZG93LmdldENpdHJpeFdlYnJ0Y1JlZGlyLHZvaWQgMCE9PWE/YSgpLnRoZW4oZnVuY3Rpb24oYSl7Zi5sb2coXCJTdWNlc3NzIG9uIGNvbm5lY3QsIENpdHJpeE1TVGVhbXNSZWRpciByZWcgdmFsdWU6XCIrXG5hKTtcIjBcIj09PWF8fFwiMVwiPT09YT9jKGEpOihmLmxvZyhcIk1TIFRlYW1zIFJlZGlyIFJlZyBrZXkgbm90IHVwZGF0ZWQgeWV0XCIpLGgoKSl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKCl7Zi5sb2coXCJGYWlsdXJlIHRvIFJlYWQgTVMgVGVhbXMgcmVkaXIgUmVnIEtleVwiKTtoKCl9KTooZi5sb2coXCJ3aW5kb3cuZ2V0Q2l0cml4V2VicnRjUmVkaXIoKSBtZXRob2QgaXMgbm90IGF2YWlsYWJsZSB5ZXRcIiksaCgpKSl9LHNldENvZGVjQ2FwYWJpbGl0aWVzOmZ1bmN0aW9uKGEpe2YubG9nKFwiVkRJIFNoaW0gc2V0Q29kZWNDYXBhYmlsaXRpZXNcIik7bnVsbCE9PXUmJnUuaXNWYWxpZCgpfHwodT1uZXcgci5OYXZpZ2F0b3JVc2VyTWVkaWEpO3JldHVybiB1LnNldENvZGVjQ2FwYWJpbGl0aWVzKGEpfSxjcmVhdGVNZWRpYVN0cmVhbTpmdW5jdGlvbihhKXtmLmxvZyhcIlZESSBTaGltIGNyZWF0ZU1lZGlhU3RyZWFtXCIpO2IoKTtyZXR1cm4gbmV3IHIuUmVtb3RlU3RyZWFtKG51bGwsMCwwLGEpfSxnZXRDYXBhYmlsaXRpZXM6ZnVuY3Rpb24oYSl7YigpO1xuZi5sb2coXCJWREkgU2hpbSBnZXRDYXBhYmlsaXRpZXNcIik7bnVsbCE9PXUmJnUuaXNWYWxpZCgpfHwodT1uZXcgci5OYXZpZ2F0b3JVc2VyTWVkaWEscT1yLk5hdmlnYXRvclVzZXJNZWRpYS5nZXRDYXBhYmlsaXRpZXMpO3JldHVybiBxLmFwcGx5KHUsYXJndW1lbnRzKX0sZGVzdHJveVZpZGVvRWxlbWVudDpmdW5jdGlvbihhLGIpe2YubG9nKFwiVkRJIFNoaW0gZGVzdHJveVZpZGVvRWxlbWVudDogXCIpO2lmKGEpe3ZhciBjPWEucmVtb3RlVmlkZW9FbGVtZW50O2MmJmMuZGlzcG9zZSgpO2EucmVtb3RlVmlkZW9FbGVtZW50PXZvaWQgMH19LGRlc3Ryb3lBdWRpb0VsZW1lbnQ6ZnVuY3Rpb24oYSxiLGMpe2YubG9nKFwiVkRJIFNoaW0gZGVzdHJveUF1ZGlvRWxlbWVudDogXCIpO2EmJigoYj1hLnJlbW90ZUF1ZGlvRWxlbWVudCkmJmIuZGlzcG9zZSgpLGEucmVtb3RlQXVkaW9FbGVtZW50PXZvaWQgMCl9fX0pfSw2Nzk6ZnVuY3Rpb24oYixhLGMpe3ZhciBkPXRoaXMmJnRoaXMuX19leHRlbmRzfHxcbmZ1bmN0aW9uKCl7dmFyIGE9ZnVuY3Rpb24oYixjKXthPU9iamVjdC5zZXRQcm90b3R5cGVPZnx8e19fcHJvdG9fXzpbXX1pbnN0YW5jZW9mIEFycmF5JiZmdW5jdGlvbihhLGIpe2EuX19wcm90b19fPWJ9fHxmdW5jdGlvbihhLGIpe2Zvcih2YXIgYyBpbiBiKWIuaGFzT3duUHJvcGVydHkoYykmJihhW2NdPWJbY10pfTtyZXR1cm4gYShiLGMpfTtyZXR1cm4gZnVuY3Rpb24oYixjKXtmdW5jdGlvbiBkKCl7dGhpcy5jb25zdHJ1Y3Rvcj1ifWEoYixjKTtiLnByb3RvdHlwZT1udWxsPT09Yz9PYmplY3QuY3JlYXRlKGMpOihkLnByb3RvdHlwZT1jLnByb3RvdHlwZSxuZXcgZCl9fSgpO09iamVjdC5kZWZpbmVQcm9wZXJ0eShhLFwiX19lc01vZHVsZVwiLHt2YWx1ZTohMH0pO3ZhciBlPWMoNjU4KSxrPWMoNTUwKSxuPWMoODUxKSxnPWMoOTQ2KSxwPWMoNTUwKSxmPWZ1bmN0aW9uKCl7cmV0dXJuIGZ1bmN0aW9uKGEpe3RoaXMueD1NYXRoLnJvdW5kKGEueCkqd2luZG93LmRldmljZVBpeGVsUmF0aW87XG50aGlzLnk9TWF0aC5yb3VuZChhLnkpKndpbmRvdy5kZXZpY2VQaXhlbFJhdGlvO3RoaXMud2lkdGg9TWF0aC5yb3VuZChhLndpZHRoKSp3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbzt0aGlzLmhlaWdodD1NYXRoLnJvdW5kKGEuaGVpZ2h0KSp3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpb319KCk7YS5WaWRlb1JlY3Q9Zjt2YXIgSjsoZnVuY3Rpb24oYSl7YVthLnBpeGVscz0wXT1cInBpeGVsc1wiO2FbYS5wZXJjZW50PTFdPVwicGVyY2VudFwifSkoSnx8KEo9e30pKTt2YXIgeD1mdW5jdGlvbigpe2Z1bmN0aW9uIGEoYil7dGhpcy52YWx1ZT1wYXJzZUludChiKTt0aGlzLnVuaXRzPXRoaXMuZGV0ZWN0VW5pdHMoYil9YS5wcm90b3R5cGUuZGV0ZWN0VW5pdHM9ZnVuY3Rpb24oYSl7cmV0dXJuLTE9PT1hLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcInB4XCIpP0oucGl4ZWxzOkoucGVyY2VudH07cmV0dXJuIGF9KCksbTsoZnVuY3Rpb24oYSl7YVthLmZpbGw9MF09XCJmaWxsXCI7YVthLmNvbnRhaW49MV09XCJjb250YWluXCI7XG5hW2EuY292ZXI9Ml09XCJjb3ZlclwifSkobXx8KG09e30pKTt2YXIgRD1mdW5jdGlvbigpe3JldHVybiBmdW5jdGlvbihhLGIpe3RoaXMueD1hO3RoaXMueT1ifX0oKSxCPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gYShiLGMsZCl7dGhpcy5maXQ9dGhpcy5jb252ZXJ0Rml0KGIpO3RoaXMucG9zaXRpb249bmV3IEQoYyxkKX1hLnByb3RvdHlwZS5jb252ZXJ0Rml0PWZ1bmN0aW9uKGEpe3JldHVyblwiZmlsbFwiPT1hP20uZmlsbDpcImNvbnRhaW5cIj09YT9tLmNvbnRhaW46XCJjb3ZlclwiPT1hP20uY292ZXI6bS5maWxsfTtyZXR1cm4gYX0oKTtiPWZ1bmN0aW9uKGEpe2Z1bmN0aW9uIGIoYyl7dmFyIGQ9YS5jYWxsKHRoaXMsbnVsbCxrLmNsYXNzX2lkX3QuVmlkZW9FbGVtZW50LDAsZS5Qcm94eU1vZGUuTG9jYWwpfHx0aGlzO2Quc3JjT2JqZWN0Xz1udWxsO2Quc2lua0lkXz1cIlwiO2QudmlkZW9XaWR0aD0wO2QudmlkZW9IZWlnaHQ9MDtkLmlzTG9hZGVkPSExO2QuY29ubmVjdGlvblN0YXRlPVwiZGlzY29ubmVjdGVkXCI7XG5kLnN0eWxlT2JzZXJ2ZXI9bnVsbDtkLnBlbmRpbmdSZWxlYXNlXz0hMTtkLmFjdGl2ZUNvbm5lY3Rpb25FdmVudF89bnVsbDtkLmNvbm5lY3Rpb25FdmVudFF1ZXVlXz1bXTtkLmVsZW1lbnRJZD1jO3JldHVybiBkfWQoYixhKTtiLnByb3RvdHlwZS5kaXNwb3NlPWZ1bmN0aW9uKCl7bi5sb2dnZXIubG9nKFwiVmlkZW9FbGVtZW50LmRpc3Bvc2UgKGVsZW1lbnRJZDogXCIrdGhpcy5lbGVtZW50SWQrXCIgb2lkOiBcIit0aGlzLm9iamVjdF9pZCgpK1wiKVwiKTt0aGlzLnBlbmRpbmdSZWxlYXNlXz0hMDt0aGlzLnNyY09iamVjdD10aGlzLm9udGltZXVwZGF0ZT10aGlzLm9ubG9hZGVkbWV0YWRhdGE9bnVsbH07Yi5wcm90b3R5cGUuc2V0U3RhdGU9ZnVuY3Rpb24oYSl7dGhpcy5jb25uZWN0aW9uU3RhdGU9YTtpZih0aGlzLm9uY29ubmVjdGlvbnN0YXRlY2hhbmdlXyl0aGlzLm9uY29ubmVjdGlvbnN0YXRlY2hhbmdlXygpfTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYi5wcm90b3R5cGUsXCJzaW5rSWRcIixcbntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zaW5rSWRffSxzZXQ6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpczt0aGlzLndhaXRVbnRpbENvbm5lY3RlZChcIlZpZGVvRWxlbWVudC5zaW5rSWRcIikudGhlbihmdW5jdGlvbigpe3JldHVybiBiLnJlbW90ZUludm9rZSghMCxrLm1ldGhvZF9pZF9WaWRlb0VsZW1lbnRfdC5zaW5rSWQsYSl9KS50aGVuKGZ1bmN0aW9uKCl7Yi5zaW5rSWRfPWF9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2IubG9nUmVtb3RlSW52b2tlRXJyb3IoYSxcIi5zZXRfc2lua0lkKCkgZmFpbGVkIVwiKX0pfSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcInNyY09iamVjdFwiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zcmNPYmplY3RffSxzZXQ6ZnVuY3Rpb24oYSl7bi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLnNyY09iamVjdDogc2V0IHNyY09iamVjdC4uLiB0aGlzLnNyY09iamVjdDpcIitcbnRoaXMuc3JjT2JqZWN0K1wiIG9iajpcIithKTtpZih0aGlzLnNyY09iamVjdF8hPT1hKXt2YXIgYj1nLmdldFJlZGlyZWN0b3IoKS5nZXRGZWF0dXJlVmFsdWUocC5GRUFUVVJFX21zX3RlYW1zXzE5MTEpO251bGwhPT10aGlzLnNyY09iamVjdF8mJihudWxsPT09YSYmYiYmdGhpcy5kaXNjb25uZWN0KCksYnx8dGhpcy5kaXNjb25uZWN0KCksdGhpcy5pc0xvYWRlZD0hMSk7dGhpcy5zcmNPYmplY3RfPWE7bnVsbCE9PXRoaXMuc3JjT2JqZWN0XyYmdGhpcy5jb25uZWN0VG8odGhpcy5zcmNPYmplY3RfKX19LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwib25jb25uZWN0aW9uc3RhdGVjaGFuZ2VcIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMub25jb25uZWN0aW9uc3RhdGVjaGFuZ2VffSxzZXQ6ZnVuY3Rpb24oYSl7bi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLnNldF9vbmNvbm5lY3Rpb25zdGF0ZWNoYW5nZSgpIGNhbGxlZC5cIik7XG50aGlzLm9uY29ubmVjdGlvbnN0YXRlY2hhbmdlXz1hfSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSxcIm9ubG9hZGVkbWV0YWRhdGFcIix7c2V0OmZ1bmN0aW9uKGEpe24ubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRfb25sb2FkZWRtZXRhZGF0YSgpIGNhbGxlZC5cIik7dGhpcy5vbmxvYWRlZG1ldGFkYXRhXz1hfSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pO2IucHJvdG90eXBlLnNldHVwT25WaWRlb0ZyYW1lQ2hhbmdlZD1mdW5jdGlvbigpe3ZhciBhPXRoaXMsYj10aGlzLnJlZ2lzdGVyQ2FsbGJhY2tzKCExLCExLGsubWV0aG9kX2lkX1ZpZGVvRWxlbWVudF90Lm9udmlkZW9mcmFtZWNoYW5nZWQpO2IudGhlbihmdW5jdGlvbihiKXtuLmxvZ2dlci5sb2coYS51c2VyX2ZyaWVuZGx5X2lkKCkrXCIub252aWRlb2ZyYW1lY2hhbmdlZFwiLGIucGFyYW1zKTthLnZpZGVvV2lkdGg9XG5iLnBhcmFtc1swXXx8MDthLnZpZGVvSGVpZ2h0PWIucGFyYW1zWzFdfHwwO2EuaXNMb2FkZWR8fChhLmlzTG9hZGVkPSEwLGEub25sb2FkZWRtZXRhZGF0YV8mJmEub25sb2FkZWRtZXRhZGF0YV8oKSl9KTt0aGlzLnJlbW90ZUludm9rZSghMCxrLm1ldGhvZF9pZF9WaWRlb0VsZW1lbnRfdC5vbnZpZGVvZnJhbWVjaGFuZ2VkLGIuc3VjY2Vzcyl9O2IucHJvdG90eXBlLnByb2Nlc3NDb25uZWN0aW9uRXZlbnQ9ZnVuY3Rpb24oKXt2YXIgYT10aGlzO2lmKDAhPT10aGlzLmNvbm5lY3Rpb25FdmVudFF1ZXVlXy5sZW5ndGgmJiF0aGlzLmFjdGl2ZUNvbm5lY3Rpb25FdmVudF8pe3ZhciBiPXRoaXMuY29ubmVjdGlvbkV2ZW50UXVldWVfLnBvcCgpO1wiY29ubmVjdFRvXCI9PWIub3BlcmF0aW9uP3RoaXMuYWN0aXZlQ29ubmVjdGlvbkV2ZW50Xz10aGlzLmNvbm5lY3RUb0FzeW5jKGIucGFyYW0pOlwiZGlzY29ubmVjdFwiPT1iLm9wZXJhdGlvbiYmKHRoaXMuYWN0aXZlQ29ubmVjdGlvbkV2ZW50Xz1cbnRoaXMuZGlzY29ubmVjdEFzeW5jKCkpO3RoaXMuYWN0aXZlQ29ubmVjdGlvbkV2ZW50Xy50aGVuKGZ1bmN0aW9uKCl7YS5hY3RpdmVDb25uZWN0aW9uRXZlbnRfPXZvaWQgMDthLnByb2Nlc3NDb25uZWN0aW9uRXZlbnQoKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oKXtuLmxvZ2dlci5sb2coYS51c2VyX2ZyaWVuZGx5X2lkKCkrXCIgOiBGYWlsZWQgdG8gaGFuZGxlIGNvbm5lY3Rpb24gZXZlbnQhIFwiKTthLmFjdGl2ZUNvbm5lY3Rpb25FdmVudF89dm9pZCAwO2EucHJvY2Vzc0Nvbm5lY3Rpb25FdmVudCgpfSl9fTtiLnByb3RvdHlwZS5jb25uZWN0VG89ZnVuY3Rpb24oYSl7dGhpcy5jb25uZWN0aW9uRXZlbnRRdWV1ZV8ucHVzaCh7b3BlcmF0aW9uOlwiY29ubmVjdFRvXCIscGFyYW06YX0pO3RoaXMucHJvY2Vzc0Nvbm5lY3Rpb25FdmVudCgpfTtiLnByb3RvdHlwZS5kaXNjb25uZWN0PWZ1bmN0aW9uKCl7dGhpcy5jb25uZWN0aW9uRXZlbnRRdWV1ZV8ucHVzaCh7b3BlcmF0aW9uOlwiZGlzY29ubmVjdFwiLFxucGFyYW06bnVsbH0pO3RoaXMucHJvY2Vzc0Nvbm5lY3Rpb25FdmVudCgpfTtiLnByb3RvdHlwZS5jb25uZWN0VG9Bc3luYz1mdW5jdGlvbihhKXt2YXIgYj10aGlzO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihjLGQpe24ubG9nZ2VyLmxvZyhiLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5jb25uZWN0VG86IGNvbm5lY3QgbWVkaWEgc3RyZWFtIHdpdGggaWQgPSBcIithLmlkK1wiLCBjbG9uZV9pZCA9IFwiK2EuY2xvbmVfc3RhdGUuY2xvbmVfaWQpO2Iuc3RyZWFtSWRfPWEuaWQ7Yi53YWl0VW50aWxDb25uZWN0ZWQoXCJWaWRlb0VsZW1lbnQuY29ubmVjdFRvXCIpLnRoZW4oZnVuY3Rpb24oKXtyZXR1cm4gYS53YWl0VW50aWxDb25uZWN0ZWQoXCJNZWRpYVN0cmVhbS5jb25uZWN0VG9cIil9KS50aGVuKGZ1bmN0aW9uKCl7Yi5zZXR1cE9uVmlkZW9GcmFtZUNoYW5nZWQoKTtyZXR1cm4gYS5jbG9uZV9zdGF0ZS5zeW5jaHJvbml6ZShhKX0pLnRoZW4oZnVuY3Rpb24oYSl7bi5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1xuXCIuY29ubmVjdFRvOiByZW1vdGUgaW52b2tpbmdcIik7dmFyIGM9Yi5yZWdpc3RlckNhbGxiYWNrcyghMCwhMSxrLm1ldGhvZF9pZF9WaWRlb0VsZW1lbnRfdC5jb25uZWN0VG8pO3JldHVybiBQcm9taXNlLmFsbChbYi5yZW1vdGVJbnZva2UoITEsay5tZXRob2RfaWRfVmlkZW9FbGVtZW50X3QuY29ubmVjdFRvLHtvaWQ6YS5vYmplY3RfaWQoKX0sYy5zdWNjZXNzLGMuZmFpbCksYy5wcm9tKCldKX0pLnRoZW4oZnVuY3Rpb24oYSl7bi5sb2dnZXIubG9nKGIudXNlcl9mcmllbmRseV9pZCgpK1wiLmNvbm5lY3RUbzogcmVtb3RlIG1lZGlhIHN0cmVhbSBpcyBjb25uZWN0ZWQhXCIpO2Iuc2V0U3RhdGUoXCJjb25uZWN0ZWRcIik7Yi53YXRjaCgpO2IudXBkYXRlVGltZXI9c2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXtiLm9udGltZXVwZGF0ZSYmYi5vbnRpbWV1cGRhdGUoKX0sMjUwKTsoYT13aW5kb3cuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYi5lbGVtZW50SWQpKSYmYi51cGRhdGVTdHlsZShhKTtcbmMoKX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYSl7Yi5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFwiLmNvbm5lY3RUbzogZmFpbGVkIHRvIGNvbm5lY3QhXCIpO2QoKX0pfSl9O2IucHJvdG90eXBlLmRpc2Nvbm5lY3RBc3luYz1mdW5jdGlvbigpe3ZhciBhPXRoaXM7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKGIsYyl7bi5sb2dnZXIubG9nKGEudXNlcl9mcmllbmRseV9pZCgpK1wiLmRpc2Nvbm5lY3Q6IGRpc2Nvbm5lY3Rpbmcgc3RyZWFtIDogXCIrYS5zdHJlYW1JZF8pO2EudW53YXRjaCgpO2Eud2FpdFVudGlsQ29ubmVjdGVkKFwiVmlkZW9FbGVtZW50LmRpc2Nvbm5lY3RcIikudGhlbihmdW5jdGlvbigpe2EudXBkYXRlVGltZXImJmNsZWFySW50ZXJ2YWwoYS51cGRhdGVUaW1lcik7dmFyIGI9YS5yZWdpc3RlckNhbGxiYWNrcyghMSwhMCxrLm1ldGhvZF9pZF9WaWRlb0VsZW1lbnRfdC5vbnZpZGVvZnJhbWVjaGFuZ2VkKTthLnJlbW90ZUludm9rZSghMCxrLm1ldGhvZF9pZF9WaWRlb0VsZW1lbnRfdC5vbnZpZGVvZnJhbWVjaGFuZ2VkLFxuYi5zdWNjZXNzKTtyZXR1cm4gYS5yZW1vdGVJbnZva2UoITEsay5tZXRob2RfaWRfVmlkZW9FbGVtZW50X3QuZGlzY29ubmVjdCl9KS50aGVuKGZ1bmN0aW9uKCl7bi5sb2dnZXIubG9nKGEudXNlcl9mcmllbmRseV9pZCgpK1wiLmRpc2Nvbm5lY3Q6IHJlbW90ZSBtZWRpYSBzdHJlYW0gaXMgZGlzY29ubmVjdGVkIVwiKTthLnNldFN0YXRlKFwiZGlzY29ubmVjdGVkXCIpOzE9PWEucGVuZGluZ1JlbGVhc2VfJiYoYS5wZW5kaW5nUmVsZWFzZV89ITEsYS5vbmNvbm5lY3Rpb25zdGF0ZWNoYW5nZT1udWxsLGEucmVsZWFzZSgpKTtiKCl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGIpe2EubG9nUmVtb3RlSW52b2tlRXJyb3IoYixcIi5kaXNjb25uZWN0OiBmYWlsZWQgdG8gY29ubmVjdCFcIik7YygpfSl9KX07Yi5wcm90b3R5cGUuc2V0RnJhbWU9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcztuLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIuc2V0RnJhbWU6IHNldCB2aWRlbyBmcmFtZSB0b1wiLFxuYS54LGEueSxhLndpZHRoLGEuaGVpZ2h0KTt0aGlzLndhaXRVbnRpbENvbm5lY3RlZChcIlZpZGVvRWxlbWVudC5zZXRGcmFtZVwiKS50aGVuKGZ1bmN0aW9uKCl7dmFyIGM9bmV3IGYoYSk7cmV0dXJuIGIucmVtb3RlSW52b2tlKCExLGsubWV0aG9kX2lkX1ZpZGVvRWxlbWVudF90LnNldEZyYW1lLGMpfSkudGhlbihmdW5jdGlvbigpe24ubG9nZ2VyLmxvZyhiLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5zZXRGcmFtZTogc3VjY2VzcyFcIil9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2IubG9nUmVtb3RlSW52b2tlRXJyb3IoYSxcIi5zZXRGcmFtZTogZmFpbGVkIHRvIGNvbm5lY3QhXCIpfSl9O2IucHJvdG90eXBlLmFkZENsaXBSZWN0PWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXM7bi5sb2dnZXIubG9nKHRoaXMudXNlcl9mcmllbmRseV9pZCgpK1wiLmFkZENsaXBSZWN0OiBcIixKU09OLnN0cmluZ2lmeShhKSk7dGhpcy53YWl0VW50aWxDb25uZWN0ZWQoXCJWaWRlb0VsZW1lbnQuYWRkQ2xpcFJlY3RcIikudGhlbihmdW5jdGlvbigpe3ZhciBjPVxubmV3IGYoYSk7cmV0dXJuIGIucmVtb3RlSW52b2tlKCExLGsubWV0aG9kX2lkX1ZpZGVvRWxlbWVudF90LmFkZENsaXBSZWN0LGMpfSlbXCJjYXRjaFwiXShmdW5jdGlvbihhKXtiLmxvZ1JlbW90ZUludm9rZUVycm9yKGEsXCIuYWRkQ2xpcFJlY3QgZmFpbGVkIVwiKX0pfTtiLnByb3RvdHlwZS5yZW1vdmVDbGlwUmVjdD1mdW5jdGlvbihhKXt2YXIgYj10aGlzO24ubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5yZW1vdmVDbGlwUmVjdDogXCIsSlNPTi5zdHJpbmdpZnkoYSkpO3RoaXMud2FpdFVudGlsQ29ubmVjdGVkKFwiVmlkZW9FbGVtZW50LnJlbW92ZUNsaXBSZWN0XCIpLnRoZW4oZnVuY3Rpb24oKXt2YXIgYz1uZXcgZihhKTtyZXR1cm4gYi5yZW1vdGVJbnZva2UoITEsay5tZXRob2RfaWRfVmlkZW9FbGVtZW50X3QucmVtb3ZlQ2xpcFJlY3QsYyl9KVtcImNhdGNoXCJdKGZ1bmN0aW9uKGEpe2IubG9nUmVtb3RlSW52b2tlRXJyb3IoYSxcIi5yZW1vdmVDbGlwUmVjdCBmYWlsZWQhXCIpfSl9O1xuYi5wcm90b3R5cGUud2F0Y2g9ZnVuY3Rpb24oKXt2YXIgYT10aGlzO2lmKGcuZ2V0UmVkaXJlY3RvcigpLmdldEZlYXR1cmVWYWx1ZShwLkZFQVRVUkVfbXNfdGVhbXNfdmlkZW9fcGxhY2VtZW50KSl7dmFyIGI9d2luZG93LmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuZWxlbWVudElkKTtiJiYodGhpcy51bndhdGNoKCksdGhpcy5zdHlsZU9ic2VydmVyPW5ldyBNdXRhdGlvbk9ic2VydmVyKGZ1bmN0aW9uKGIpe2IuZm9yRWFjaChmdW5jdGlvbihiKXtcInN0eWxlXCI9PWIuYXR0cmlidXRlTmFtZT9hLnVwZGF0ZVN0eWxlKGIudGFyZ2V0KTphLmVsZW1lbnRJZD1iLnRhcmdldC5pZH0pfSksdGhpcy5zdHlsZU9ic2VydmVyLm9ic2VydmUoYix7YXR0cmlidXRlczohMCxhdHRyaWJ1dGVPbGRWYWx1ZTohMCxhdHRyaWJ1dGVGaWx0ZXI6W1wic3R5bGVcIixcImlkXCJdfSkpfX07Yi5wcm90b3R5cGUudW53YXRjaD1mdW5jdGlvbigpe3RoaXMuc3R5bGVPYnNlcnZlciYmKHRoaXMuc3R5bGVPYnNlcnZlci5kaXNjb25uZWN0KCksXG50aGlzLnN0eWxlT2JzZXJ2ZXI9bnVsbCl9O2IucHJvdG90eXBlLnVwZGF0ZVN0eWxlPWZ1bmN0aW9uKGEpe2lmKFwiY29ubmVjdGVkXCI9PXRoaXMuY29ubmVjdGlvblN0YXRlKXt2YXIgYj13aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShhKS5nZXRQcm9wZXJ0eVZhbHVlKFwib2JqZWN0LWZpdFwiKSxjPXdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGEpLmdldFByb3BlcnR5VmFsdWUoXCJvYmplY3QtcG9zaXRpb25cIikuc3BsaXQoXCIgXCIpO2E9bmV3IHgoY1swXSk7Yz1uZXcgeChjWzFdKTt0aGlzLnBsYWNlbWVudD1uZXcgQihiLGEsYyl9ZWxzZSBuLmxvZ2dlci5sb2codGhpcy51c2VyX2ZyaWVuZGx5X2lkKCkrXCIudXBkYXRlU3R5bGU6IHZpZGVvIGVsZW1lbnQgaXMgbm90IGNvbm5lY3RlZFwiKX07T2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLFwicGxhY2VtZW50XCIse2dldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnBsYWNlbWVudF99LHNldDpmdW5jdGlvbihhKXt2YXIgYj10aGlzO2cuZ2V0UmVkaXJlY3RvcigpLmdldEZlYXR1cmVWYWx1ZShwLkZFQVRVUkVfbXNfdGVhbXNfdmlkZW9fcGxhY2VtZW50KT9cbnRoaXMud2FpdFVudGlsQ29ubmVjdGVkKFwiVmlkZW9FbGVtZW50LnBsYWNlbWVudFwiKS50aGVuKGZ1bmN0aW9uKCl7cmV0dXJuIGIucmVtb3RlSW52b2tlKCEwLGsubWV0aG9kX2lkX1ZpZGVvRWxlbWVudF90LnBsYWNlbWVudCxhKX0pLnRoZW4oZnVuY3Rpb24oKXtiLnBsYWNlbWVudF89YX0pW1wiY2F0Y2hcIl0oZnVuY3Rpb24oYSl7Yi5sb2dSZW1vdGVJbnZva2VFcnJvcihhLFwiLnBsYWNlbWVudCBzZXR0ZXI6IGZhaWxlZCB0byBjb25uZWN0IVwiKX0pOm4ubG9nZ2VyLmxvZyh0aGlzLnVzZXJfZnJpZW5kbHlfaWQoKStcIi5wbGFjZW1lbnQ6IHZpZGVvIHBsYWNlbWVudCBmZWF0dXJlIGlzIG5vdCBzdXBwb3J0ZWQgb24gYSBjbGllbnRcIil9LGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwfSk7cmV0dXJuIGJ9KGUuUHJveHlPYmplY3QpO2EuVmlkZW9FbGVtZW50PWJ9LDI2OTpmdW5jdGlvbihiLGEpe09iamVjdC5kZWZpbmVQcm9wZXJ0eShhLFwiX19lc01vZHVsZVwiLHt2YWx1ZTohMH0pO1xuYS5GRUFUVVJFX21zX3RlYW1zX3JlZGlyZWN0aW9uPVwibXNfdGVhbXNfcmVkaXJlY3Rpb25cIjthLkZFQVRVUkVfdW5zdXBwb3J0ZWQ9XCJ1bnN1cHBvcnRlZFwiO3ZhciBjPWZ1bmN0aW9uKCl7cmV0dXJuIGZ1bmN0aW9uKGEsYixjLGQpe3RoaXMubWFqb3I9YTt0aGlzLm1pbm9yPWI7dGhpcy5yZXZpc2lvbj1jO3RoaXMuYnVpbGQ9ZH19KCk7YS5WZXJzaW9uRGF0YT1jO2M9ZnVuY3Rpb24oKXtyZXR1cm4gZnVuY3Rpb24oKXt9fSgpO2EuRmVhdHVyZURhdGE9YztjPWZ1bmN0aW9uKCl7cmV0dXJuIGZ1bmN0aW9uKGEsYil7dGhpcy5mYXR1cmU9YTt0aGlzLnZlcnNpb249Yn19KCk7YS5XZWJycGNGZWF0dXJlSW5mbz1jO2M9ZnVuY3Rpb24oKXtyZXR1cm4gZnVuY3Rpb24oYSxiLGMsZCxnKXt0aGlzLmZhbWlseT1hO3RoaXMudmVyc2lvbj1iO3RoaXMuYXJjaGl0ZWN0dXJlPWM7dGhpcy5kaXN0cm89ZDt0aGlzLmVkaXRpb249Z319KCk7YS5PU0luZm89YztjPWZ1bmN0aW9uKCl7cmV0dXJuIGZ1bmN0aW9uKGEsXG5iKXt0aGlzLm1hY2hpbmVfaWQ9YTt0aGlzLnVzZXJfaWQ9Yn19KCk7YS5FbmRwb2ludElkPWM7Yz1mdW5jdGlvbigpe3JldHVybiBmdW5jdGlvbihiLGMsZCxlLGcpe3ZvaWQgMD09PWcmJihnPWEuRkVBVFVSRV9tc190ZWFtc19yZWRpcmVjdGlvbik7dGhpcy5paWQ9Yjt0aGlzLm1pZD1jO3RoaXMubmFtZT1kO3RoaXMuaXNwcm9wPWU7dGhpcy5mZWF0dXJlPWd9fSgpO2EuV2VicnBjTWV0aG9kSW5mbz1jO2M9ZnVuY3Rpb24oKXtyZXR1cm4gZnVuY3Rpb24oYSxiLGMpe3RoaXMuaWQ9YTt0aGlzLm5hbWU9Yjt0aGlzLm1ldGhvZHM9Y319KCk7YS5XZWJycGNDbGFzc0luZm89YztjPWZ1bmN0aW9uKCl7cmV0dXJuIGZ1bmN0aW9uKGEsYil7dGhpcy5uYW1lPWE7dGhpcy5jbGFzc2VzPWJ9fSgpO2EuV2VicnBjQ2xhc3NMaWJJbmZvPWN9LDU1MDpmdW5jdGlvbihiLGEsYyl7T2JqZWN0LmRlZmluZVByb3BlcnR5KGEsXCJfX2VzTW9kdWxlXCIse3ZhbHVlOiEwfSk7dmFyIGQ9YygxODcpOyhmdW5jdGlvbihiKXtmb3IodmFyIGMgaW4gYilhLmhhc093blByb3BlcnR5KGMpfHxcbihhW2NdPWJbY10pfSkoYygxODcpKTtiPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gYSgpe31hLmdldEludGVyZmFjZUJ5aWQ9ZnVuY3Rpb24oYSl7Zm9yKHZhciBiPTAsYz1kLmNsYXNzX2xpYl9pbmZvLmNsYXNzZXM7YjxjLmxlbmd0aDtiKyspe3ZhciBlPWNbYl07aWYoZS5pZD09YSlyZXR1cm4gZX1yZXR1cm4gbnVsbH07YS5nZXRNZXRob2RCeWlkPWZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcy5nZXRJbnRlcmZhY2VCeWlkKGEpO2lmKG51bGwhPWMpZm9yKHZhciBkPTAsYz1jLm1ldGhvZHM7ZDxjLmxlbmd0aDtkKyspe3ZhciBmPWNbZF07aWYoZi5taWQ9PWIpcmV0dXJuIGZ9cmV0dXJuIG51bGx9O2EuZ2V0TWV0aG9kRmVhdHVyZUJ5aWQ9ZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzLmdldEludGVyZmFjZUJ5aWQoYSk7aWYobnVsbCE9Yylmb3IodmFyIGQ9MCxjPWMubWV0aG9kcztkPGMubGVuZ3RoO2QrKyl7dmFyIGY9Y1tkXTtpZihmLm1pZD09YilyZXR1cm4gZi5mZWF0dXJlfXJldHVybiBudWxsfTtcbmEuY29tcG9zZUNsYXNzSW5mb0RhdGE9ZnVuY3Rpb24oYSl7YT1hLmhkcjtpZih2b2lkIDA9PWEpcmV0dXJuXCIqKiogSW52YWxpZCBwYWNrZXQ6IENvdWxkbid0IGZpbmQgaGRyIG9iamVjdCAqKipcIjt2YXIgYj1hLnByb2M7aWYodm9pZCAwPT1iKXJldHVyblwiXCI7YT1iLmlpZDtmb3IodmFyIGI9Yi5tZXRob2RpZCxjPTAsZT1kLmNsYXNzX2xpYl9pbmZvLmNsYXNzZXM7YzxlLmxlbmd0aDtjKyspe3ZhciBmPWVbY107aWYoZi5pZD09YSlmb3IodmFyIGs9MCx2PWYubWV0aG9kcztrPHYubGVuZ3RoO2srKyl7dmFyIG09dltrXTtpZihtLm1pZD09YilyZXR1cm4gZi5uYW1lK1wiOjpcIittLm5hbWV9fXJldHVyblwiXCJ9O3JldHVybiBhfSgpO2EuV2VicnBjQ2xhc3NMaWJJbmZvVXRpbD1ifSwxODc6ZnVuY3Rpb24oYixhLGMpe09iamVjdC5kZWZpbmVQcm9wZXJ0eShhLFwiX19lc01vZHVsZVwiLHt2YWx1ZTohMH0pO2I9YygyNjkpO2M9YygyNjkpO2EuVmVyc2lvbkRhdGE9Yy5WZXJzaW9uRGF0YTtcbmEuRmVhdHVyZURhdGE9Yy5GZWF0dXJlRGF0YTthLk9TSW5mbz1jLk9TSW5mbzthLkVuZHBvaW50SWQ9Yy5FbmRwb2ludElkO2EuQlVJTERfVFlQRV9TREs9ITA7YS5IRFhNU19WRVJTSU9OPVwiMi4wLjAuNFwiO2EuRkVBVFVSRV92ZGFfc2VydmljZV9ub19idWZmZXJfbGltaXQ9XCJ3c3NlcnZpY2Vfbm9fYnVmZmVyX2xpbWl0XCI7YS5GRUFUVVJFX3ZkYV9hcHBfc2hhcmluZz1cIndlYnJ0Y19hcHBfc2hhcmluZ1wiO2EuRkVBVFVSRV92ZGFfbXVsdGlfd2luZG93PVwid2VicnRjX211bHRpX3dpbmRvd1wiO2EuRkVBVFVSRV9tc190ZWFtc19kZXNrdG9wX3NoYXJpbmc9XCJtc190ZWFtc19kZXNrdG9wX3NoYXJpbmdcIjthLkZFQVRVUkVfbXNfdGVhbXNfc3BlYWtpbmdfaW5kaWNhdG9yPVwibXNfdGVhbXNfc3BlYWtpbmdfaW5kaWNhdG9yXCI7YS5GRUFUVVJFX21zX3RlYW1zX2NvbW1vbl9tZWRpYV9jb25zdHJhaW50cz1cIm1zX3RlYW1zX2NvbW1vbl9tZWRpYV9jb25zdHJhaW50c1wiO2EuRkVBVFVSRV9tc190ZWFtc18xOTExPVxuXCJtc190ZWFtc18xOTExXCI7YS5GRUFUVVJFX21zX3RlYW1zX3BzdG49XCJtc190ZWFtc19wc3RuXCI7YS5GRUFUVVJFX21zX3RlYW1zXzE5MTI9XCJtc190ZWFtc18xOTEyXCI7YS5GRUFUVVJFX21zX3RlYW1zX21zdHJhY2tfY29uc3RyYWludHM9XCJtc190ZWFtc19tc3RyYWNrX2NvbnN0cmFpbnRzXCI7YS5GRUFUVVJFX21zX3RlYW1zX29zaW5mbz1cIm1zX3RlYW1zX29zaW5mb1wiO2EuRkVBVFVSRV9tc190ZWFtc19lbmRwb2ludF9pZD1cIm1zX3RlYW1zX2VuZHBvaW50X2lkXCI7YS5GRUFUVVJFX21zX3RlYW1zX3JlbW90ZV9hdWRpb19ub3RpZmljYXRpb25zPVwibXNfdGVhbXNfcmVtb3RlX2F1ZGlvX25vdGlmaWNhdGlvbnNcIjthLkZFQVRVUkVfbXNfdGVhbXNfZGV2aWNlX2dyb3VwX2lkPVwibXNfdGVhbXNfZGV2aWNlX2dyb3VwX2lkXCI7YS5GRUFUVVJFX21zX3RlYW1zX2R0bWY9XCJtc190ZWFtc19kdG1mXCI7YS5GRUFUVVJFX21zX3RlYW1zX3ZpZGVvX3BsYWNlbWVudD1cIm1zX3RlYW1zX3ZpZGVvX3BsYWNlbWVudFwiO1xuYS5GRUFUVVJFX21zX3RlYW1zX2NvZGVjX2NhcGFiaWxpdHk9XCJtc190ZWFtc19jb2RlY19jYXBhYmlsaXR5XCI7YS5GRUFUVVJFX21zX3RlYW1zX211bHRpX3dpbmRvdz1cIm1zX3RlYW1zX211bHRpX3dpbmRvd3NcIjthLkZFQVRVUkVfbXNfdGVhbXNfd2VicnRjXzFkb3QwPVwibXNfdGVhbXNfd2VicnRjXzEuMFwiO2EuRkVBVFVSRV9tc190ZWFtc19kYXRhX2NoYW5uZWw9XCJtc190ZWFtc19kYXRhX2NoYW5uZWxcIjthLkZFQVRVUkVfbXNfdGVhbXNfbm9fdmRfYnVmZmVyX2xpbWl0PVwibXNfdGVhbXNfbm9fdmRfYnVmZmVyX2xpbWl0XCI7bmV3IGIuV2VicnBjRmVhdHVyZUluZm8oYi5GRUFUVVJFX21zX3RlYW1zX3JlZGlyZWN0aW9uLG5ldyBiLlZlcnNpb25EYXRhKDEsMSwwLDApKTtuZXcgYi5XZWJycGNGZWF0dXJlSW5mbyhhLkZFQVRVUkVfbXNfdGVhbXNfZGVza3RvcF9zaGFyaW5nLG5ldyBiLlZlcnNpb25EYXRhKDEsMiwwLDApKTtuZXcgYi5XZWJycGNGZWF0dXJlSW5mbyhhLkZFQVRVUkVfbXNfdGVhbXNfc3BlYWtpbmdfaW5kaWNhdG9yLFxubmV3IGIuVmVyc2lvbkRhdGEoMSwyLDAsMCkpO25ldyBiLldlYnJwY0ZlYXR1cmVJbmZvKGEuRkVBVFVSRV9tc190ZWFtc19jb21tb25fbWVkaWFfY29uc3RyYWludHMsbmV3IGIuVmVyc2lvbkRhdGEoMSw0LDAsMCkpO25ldyBiLldlYnJwY0ZlYXR1cmVJbmZvKGEuRkVBVFVSRV9tc190ZWFtc18xOTExLG5ldyBiLlZlcnNpb25EYXRhKDEsNCwwLDApKTtuZXcgYi5XZWJycGNGZWF0dXJlSW5mbyhhLkZFQVRVUkVfbXNfdGVhbXNfMTkxMixuZXcgYi5WZXJzaW9uRGF0YSgxLDUsMCwwKSk7bmV3IGIuV2VicnBjRmVhdHVyZUluZm8oYS5GRUFUVVJFX21zX3RlYW1zX21zdHJhY2tfY29uc3RyYWludHMsbmV3IGIuVmVyc2lvbkRhdGEoMSw2LDAsMCkpO25ldyBiLldlYnJwY0ZlYXR1cmVJbmZvKGEuRkVBVFVSRV9tc190ZWFtc19wc3RuLG5ldyBiLlZlcnNpb25EYXRhKDEsNiwwLDApKTtuZXcgYi5XZWJycGNGZWF0dXJlSW5mbyhhLkZFQVRVUkVfbXNfdGVhbXNfb3NpbmZvLG5ldyBiLlZlcnNpb25EYXRhKDEsXG43LDAsMCkpO25ldyBiLldlYnJwY0ZlYXR1cmVJbmZvKGEuRkVBVFVSRV9tc190ZWFtc19lbmRwb2ludF9pZCxuZXcgYi5WZXJzaW9uRGF0YSgxLDcsMCwwKSk7bmV3IGIuV2VicnBjRmVhdHVyZUluZm8oYS5GRUFUVVJFX21zX3RlYW1zX3JlbW90ZV9hdWRpb19ub3RpZmljYXRpb25zLG5ldyBiLlZlcnNpb25EYXRhKDEsNywwLDApKTtuZXcgYi5XZWJycGNGZWF0dXJlSW5mbyhhLkZFQVRVUkVfbXNfdGVhbXNfZGV2aWNlX2dyb3VwX2lkLG5ldyBiLlZlcnNpb25EYXRhKDEsNywwLDApKTtuZXcgYi5XZWJycGNGZWF0dXJlSW5mbyhhLkZFQVRVUkVfbXNfdGVhbXNfY29kZWNfY2FwYWJpbGl0eSxuZXcgYi5WZXJzaW9uRGF0YSgxLDcsMCwwKSk7bmV3IGIuV2VicnBjRmVhdHVyZUluZm8oYS5GRUFUVVJFX21zX3RlYW1zX2R0bWYsbmV3IGIuVmVyc2lvbkRhdGEoMSw3LDAsMCkpO25ldyBiLldlYnJwY0ZlYXR1cmVJbmZvKGEuRkVBVFVSRV9tc190ZWFtc192aWRlb19wbGFjZW1lbnQsbmV3IGIuVmVyc2lvbkRhdGEoMSxcbjcsMCwwKSk7bmV3IGIuV2VicnBjRmVhdHVyZUluZm8oYS5GRUFUVVJFX21zX3RlYW1zX3dlYnJ0Y18xZG90MCxuZXcgYi5WZXJzaW9uRGF0YSgxLDgsMCwwKSk7bmV3IGIuV2VicnBjRmVhdHVyZUluZm8oYS5GRUFUVVJFX21zX3RlYW1zX2RhdGFfY2hhbm5lbCxuZXcgYi5WZXJzaW9uRGF0YSgxLDgsMCwwKSk7bmV3IGIuV2VicnBjRmVhdHVyZUluZm8oYS5GRUFUVVJFX21zX3RlYW1zX211bHRpX3dpbmRvdyxuZXcgYi5WZXJzaW9uRGF0YSgxLDE0LDAsMCkpO2M9ZnVuY3Rpb24oKXtmdW5jdGlvbiBhKCl7fWEuRkVBVFVSRV9wdWJsaWNfc2NyZWVuc2hhcmU9XCJzY3JlZW5zaGFyZVwiO2EuRkVBVFVSRV9wdWJsaWNfcmVkaXJlY3Rpb249XCJyZWRpcmVjdGlvblwiO2EuRkVBVFVSRV9wdWJsaWNfc3BlYWtpbmdfaW5kaWNhdG9yPVwic3BlYWtpbmdfaW5kaWNhdG9yXCI7YS5GRUFUVVJFX3B1YmxpY19wc3RuPVwicHN0blwiO2EuRkVBVFVSRV9wdWJsaWNfb3NpbmZvPVwib3NpbmZvXCI7YS5GRUFUVVJFX3B1YmxpY19lbmRwb2ludF9pZD1cblwiZW5kcG9pbnRpZFwiO2EuRkVBVFVSRV9wdWJsaWNfcmVtb3RlX2F1ZGlvX25vdGlmaWNhdGlvbnM9XCJyZW1vdGVhdWRpb25vdGlmaWNhdGlvbnNcIjthLkZFQVRVUkVfcHVibGljX2RldmljZV9ncm91cF9pZD1cImNvbXBvc2l0ZWRldmljZXNcIjthLkZFQVRVUkVfcHVibGljX2R0bWY9XCJkdG1mXCI7YS5GRUFUVVJFX3B1YmxpY19tb25pdG9yX3NoYXJpbmc9XCJtdWx0aW1vbml0b3JzY3JlZW5zaGFyZVwiO2EuRkVBVFVSRV9wdWJsaWNfYXBwX3NoYXJpbmc9XCJhcHBzaGFyZVwiO2EuRkVBVFVSRV9wdWJsaWNfY29kZWNfY2FwYWJpbGl0eT1cImNvZGVjX2NhcGFiaWxpdHlcIjthLkZFQVRVUkVfcHVibGljX3dlYnJ0YzFkb3QwPVwid2VicnRjMS4wXCI7YS5GRUFUVVJFX3B1YmxpY19kYXRhX2NoYW5uZWw9XCJkYXRhY2hhbm5lbFwiO2EuRkVBVFVSRV9wdWJsaWNfdmRub2J1ZmxpbWl0PVwidmRub2J1ZmxpbWl0XCI7YS5GRUFUVVJFX3B1YmxpY19tdWx0aV93aW5kb3c9XCJtdWx0aXdpbmRvd1wiO3JldHVybiBhfSgpO1xuYS5GZWF0dXJlcz1jO2EuZmVhdHVyZU5hbWVNYXA9e307YS5mZWF0dXJlTmFtZU1hcFtjLkZFQVRVUkVfcHVibGljX3NjcmVlbnNoYXJlXT1bYS5GRUFUVVJFX21zX3RlYW1zX2Rlc2t0b3Bfc2hhcmluZ107YS5mZWF0dXJlTmFtZU1hcFtjLkZFQVRVUkVfcHVibGljX3JlZGlyZWN0aW9uXT1bYi5GRUFUVVJFX21zX3RlYW1zX3JlZGlyZWN0aW9uXTthLmZlYXR1cmVOYW1lTWFwW2MuRkVBVFVSRV9wdWJsaWNfc3BlYWtpbmdfaW5kaWNhdG9yXT1bYS5GRUFUVVJFX21zX3RlYW1zX3NwZWFraW5nX2luZGljYXRvcl07YS5mZWF0dXJlTmFtZU1hcFtjLkZFQVRVUkVfcHVibGljX3BzdG5dPVthLkZFQVRVUkVfbXNfdGVhbXNfcHN0bl07YS5mZWF0dXJlTmFtZU1hcFtjLkZFQVRVUkVfcHVibGljX29zaW5mb109W2EuRkVBVFVSRV9tc190ZWFtc19vc2luZm9dO2EuZmVhdHVyZU5hbWVNYXBbYy5GRUFUVVJFX3B1YmxpY19lbmRwb2ludF9pZF09W2EuRkVBVFVSRV9tc190ZWFtc19lbmRwb2ludF9pZF07XG5hLmZlYXR1cmVOYW1lTWFwW2MuRkVBVFVSRV9wdWJsaWNfcmVtb3RlX2F1ZGlvX25vdGlmaWNhdGlvbnNdPVthLkZFQVRVUkVfbXNfdGVhbXNfcmVtb3RlX2F1ZGlvX25vdGlmaWNhdGlvbnNdO2EuZmVhdHVyZU5hbWVNYXBbYy5GRUFUVVJFX3B1YmxpY19kZXZpY2VfZ3JvdXBfaWRdPVthLkZFQVRVUkVfbXNfdGVhbXNfZGV2aWNlX2dyb3VwX2lkXTthLmZlYXR1cmVOYW1lTWFwW2MuRkVBVFVSRV9wdWJsaWNfZHRtZl09W2EuRkVBVFVSRV9tc190ZWFtc19kdG1mXTthLmZlYXR1cmVOYW1lTWFwW2MuRkVBVFVSRV9wdWJsaWNfY29kZWNfY2FwYWJpbGl0eV09W2EuRkVBVFVSRV9tc190ZWFtc19jb2RlY19jYXBhYmlsaXR5XTthLmZlYXR1cmVOYW1lTWFwW2MuRkVBVFVSRV9wdWJsaWNfd2VicnRjMWRvdDBdPVthLkZFQVRVUkVfbXNfdGVhbXNfd2VicnRjXzFkb3QwXTthLmZlYXR1cmVOYW1lTWFwW2MuRkVBVFVSRV9wdWJsaWNfbXVsdGlfd2luZG93XT1bYS5GRUFUVVJFX21zX3RlYW1zX211bHRpX3dpbmRvd107XG5hLmZlYXR1cmVOYW1lTWFwW2MuRkVBVFVSRV9wdWJsaWNfZGF0YV9jaGFubmVsXT1bYS5GRUFUVVJFX21zX3RlYW1zX2RhdGFfY2hhbm5lbF07YS5mZWF0dXJlTmFtZU1hcFtjLkZFQVRVUkVfcHVibGljX3Zkbm9idWZsaW1pdF09W2EuRkVBVFVSRV9tc190ZWFtc19ub192ZF9idWZmZXJfbGltaXRdOyhmdW5jdGlvbihhKXthW2EuRW5naW5lQ29udHJvbD0wXT1cIkVuZ2luZUNvbnRyb2xcIjthW2EuUlRDUGVlckNvbm5lY3Rpb249MV09XCJSVENQZWVyQ29ubmVjdGlvblwiO2FbYS5SVENTZXNzaW9uRGVzY3JpcHRpb249Ml09XCJSVENTZXNzaW9uRGVzY3JpcHRpb25cIjthW2EuUlRDSWNlQ2FuZGlkYXRlPTNdPVwiUlRDSWNlQ2FuZGlkYXRlXCI7YVthLlJUQ0ljZUNhbmRpZGF0ZUV2ZW50PTRdPVwiUlRDSWNlQ2FuZGlkYXRlRXZlbnRcIjthW2EuTWVkaWFEZXZpY2VzPTVdPVwiTWVkaWFEZXZpY2VzXCI7YVthLk1lZGlhRGV2aWNlSW5mbz02XT1cIk1lZGlhRGV2aWNlSW5mb1wiO2FbYS5NZWRpYVN0cmVhbVRyYWNrPVxuN109XCJNZWRpYVN0cmVhbVRyYWNrXCI7YVthLk1lZGlhU3RyZWFtRXZlbnQ9OF09XCJNZWRpYVN0cmVhbUV2ZW50XCI7YVthLk1lZGlhU3RyZWFtPTldPVwiTWVkaWFTdHJlYW1cIjthW2EuTmF2aWdhdG9yVXNlck1lZGlhPTEwXT1cIk5hdmlnYXRvclVzZXJNZWRpYVwiO2FbYS5WaWRlb0VsZW1lbnQ9MTFdPVwiVmlkZW9FbGVtZW50XCI7YVthLkF1ZGlvRWxlbWVudD0xMl09XCJBdWRpb0VsZW1lbnRcIjthW2EuUlRDUnRwUmVjZWl2ZXI9MTNdPVwiUlRDUnRwUmVjZWl2ZXJcIjthW2EuUlRDUnRwU2VuZGVyPTE0XT1cIlJUQ1J0cFNlbmRlclwiO2FbYS5SVENEdGxzVHJhbnNwb3J0PTE1XT1cIlJUQ0R0bHNUcmFuc3BvcnRcIjthW2EuUlRDSWNlVHJhbnNwb3J0PTE2XT1cIlJUQ0ljZVRyYW5zcG9ydFwiO2FbYS5SVENEVE1GU2VuZGVyPTE3XT1cIlJUQ0RUTUZTZW5kZXJcIjthW2EuUlRDRFRNRlRvbmVDaGFuZ2VFdmVudD0xOF09XCJSVENEVE1GVG9uZUNoYW5nZUV2ZW50XCI7YVthLlJUQ0ljZUNhbmRpZGF0ZVBhaXI9MTldPVxuXCJSVENJY2VDYW5kaWRhdGVQYWlyXCI7YVthLlJUQ1J0cFRyYW5zY2VpdmVyPTIwXT1cIlJUQ1J0cFRyYW5zY2VpdmVyXCI7YVthLnJlc2VydmVkMz0yMV09XCJyZXNlcnZlZDNcIjthW2EucmVzZXJ2ZWQ0PTIyXT1cInJlc2VydmVkNFwiO2FbYS5yZXNlcnZlZDE9MjNdPVwicmVzZXJ2ZWQxXCI7YVthLnJlc2VydmVkMj0yNF09XCJyZXNlcnZlZDJcIjthW2EuUlRDRGF0YUNoYW5uZWw9MjVdPVwiUlRDRGF0YUNoYW5uZWxcIjthW2EuUlRDU2N0cFRyYW5zcG9ydD0yNl09XCJSVENTY3RwVHJhbnNwb3J0XCJ9KShjPWEuY2xhc3NfaWRfdHx8KGEuY2xhc3NfaWRfdD17fSkpO3ZhciBkOyhmdW5jdGlvbihhKXthW2EuY3Rvcj0wXT1cImN0b3JcIjthW2EudmVyc2lvbj0xXT1cInZlcnNpb25cIjthW2EuZmVhdHVyZV9mbGFncz0yXT1cImZlYXR1cmVfZmxhZ3NcIjthW2EudmVyc2lvbl9pbmZvPTNdPVwidmVyc2lvbl9pbmZvXCI7YVthLm9zaW5mbz00XT1cIm9zaW5mb1wiO2FbYS5lbmRwb2ludF9pZD01XT1cImVuZHBvaW50X2lkXCJ9KShkPVxuYS5tZXRob2RfaWRfRW5naW5lQ29udHJvbF90fHwoYS5tZXRob2RfaWRfRW5naW5lQ29udHJvbF90PXt9KSk7dmFyIGU7KGZ1bmN0aW9uKGEpe2FbYS5jdG9yPTBdPVwiY3RvclwiO2FbYS5sb2NhbERlc2NyaXB0aW9uPTFdPVwibG9jYWxEZXNjcmlwdGlvblwiO2FbYS5yZW1vdGVEZXNjcmlwdGlvbj0yXT1cInJlbW90ZURlc2NyaXB0aW9uXCI7YVthLnJlYWR5U3RhdGU9M109XCJyZWFkeVN0YXRlXCI7YVthLmljZVN0YXRlPTRdPVwiaWNlU3RhdGVcIjthW2EubG9jYWxTdHJlYW1zPTVdPVwibG9jYWxTdHJlYW1zXCI7YVthLnJlbW90ZVN0cmVhbXM9Nl09XCJyZW1vdGVTdHJlYW1zXCI7YVthLmNyZWF0ZU9mZmVyPTddPVwiY3JlYXRlT2ZmZXJcIjthW2EuY3JlYXRlQW5zd2VyPThdPVwiY3JlYXRlQW5zd2VyXCI7YVthLnNldExvY2FsRGVzY3JpcHRpb249OV09XCJzZXRMb2NhbERlc2NyaXB0aW9uXCI7YVthLnNldFJlbW90ZURlc2NyaXB0aW9uPTEwXT1cInNldFJlbW90ZURlc2NyaXB0aW9uXCI7YVthLnVwZGF0ZUljZT1cbjExXT1cInVwZGF0ZUljZVwiO2FbYS5hZGRJY2VDYW5kaWRhdGU9MTJdPVwiYWRkSWNlQ2FuZGlkYXRlXCI7YVthLmFkZFN0cmVhbT0xM109XCJhZGRTdHJlYW1cIjthW2EucmVtb3ZlU3RyZWFtPTE0XT1cInJlbW92ZVN0cmVhbVwiO2FbYS5jbG9zZT0xNV09XCJjbG9zZVwiO2FbYS5pY2VDb25uZWN0aW9uU3RhdGU9MTZdPVwiaWNlQ29ubmVjdGlvblN0YXRlXCI7YVthLmljZUdhdGhlcmluZ1N0YXRlPTE3XT1cImljZUdhdGhlcmluZ1N0YXRlXCI7YVthLnNpZ25hbGluZ1N0YXRlPTE4XT1cInNpZ25hbGluZ1N0YXRlXCI7YVthLm9uYWRkc3RyZWFtPTE5XT1cIm9uYWRkc3RyZWFtXCI7YVthLm9uaWNlY2FuZGlkYXRlPTIwXT1cIm9uaWNlY2FuZGlkYXRlXCI7YVthLm9uaWNlY29ubmVjdGlvbnN0YXRlY2hhbmdlPTIxXT1cIm9uaWNlY29ubmVjdGlvbnN0YXRlY2hhbmdlXCI7YVthLm9uaWNlZ2F0aGVyaW5nc3RhdGVjaGFuZ2U9MjJdPVwib25pY2VnYXRoZXJpbmdzdGF0ZWNoYW5nZVwiO2FbYS5vbnNpZ25hbGluZ3N0YXRlY2hhbmdlPVxuMjNdPVwib25zaWduYWxpbmdzdGF0ZWNoYW5nZVwiO2FbYS5vbm5lZ290aWF0aW9ubmVlZGVkPTI0XT1cIm9ubmVnb3RpYXRpb25uZWVkZWRcIjthW2Eub25yZW1vdmVzdHJlYW09MjVdPVwib25yZW1vdmVzdHJlYW1cIjthW2EuZ2V0U3RhdHM9MjZdPVwiZ2V0U3RhdHNcIjthW2EuZ2V0UmVjZWl2ZXJzPTI3XT1cImdldFJlY2VpdmVyc1wiO2FbYS5nZXRTZW5kZXJzPTI4XT1cImdldFNlbmRlcnNcIjthW2EuYWRkVHJhY2s9MjldPVwiYWRkVHJhY2tcIjthW2EucmVtb3ZlVHJhY2s9MzBdPVwicmVtb3ZlVHJhY2tcIjthW2Eub250cmFjaz0zMV09XCJvbnRyYWNrXCI7YVthLnNldExvY2FsRGVzY3JpcHRpb25fdjI9MzJdPVwic2V0TG9jYWxEZXNjcmlwdGlvbl92MlwiO2FbYS5zZXRSZW1vdGVEZXNjcmlwdGlvbl92Mj0zM109XCJzZXRSZW1vdGVEZXNjcmlwdGlvbl92MlwiO2FbYS5hZGRUcmFuc2NlaXZlcldpdGhUcmFjaz0zNF09XCJhZGRUcmFuc2NlaXZlcldpdGhUcmFja1wiO2FbYS5hZGRUcmFuc2NlaXZlcldpdGhLaW5kPVxuMzVdPVwiYWRkVHJhbnNjZWl2ZXJXaXRoS2luZFwiO2FbYS5nZXRUcmFuc2NlaXZlcnM9MzZdPVwiZ2V0VHJhbnNjZWl2ZXJzXCI7YVthLm9uY29ubmVjdGlvbnN0YXRlY2hhbmdlPTM3XT1cIm9uY29ubmVjdGlvbnN0YXRlY2hhbmdlXCI7YVthLnNjdHA9MzhdPVwic2N0cFwiO2FbYS5vbmRhdGFjaGFubmVsPTM5XT1cIm9uZGF0YWNoYW5uZWxcIjthW2EuY3JlYXRlRGF0YUNoYW5uZWw9NDBdPVwiY3JlYXRlRGF0YUNoYW5uZWxcIjthW2EuZ2V0U3RhdHNfdjI9NDFdPVwiZ2V0U3RhdHNfdjJcIn0pKGU9YS5tZXRob2RfaWRfUlRDUGVlckNvbm5lY3Rpb25fdHx8KGEubWV0aG9kX2lkX1JUQ1BlZXJDb25uZWN0aW9uX3Q9e30pKTt2YXIgazsoZnVuY3Rpb24oYSl7YVthLmN0b3I9MF09XCJjdG9yXCI7YVthLmVudW1lcmF0ZURldmljZXM9MV09XCJlbnVtZXJhdGVEZXZpY2VzXCI7YVthLmdldERpc3BsYXlNZWRpYT0yXT1cImdldERpc3BsYXlNZWRpYVwiO2FbYS5vbmRldmljZWNoYW5nZT0zXT1cIm9uZGV2aWNlY2hhbmdlXCJ9KShrPVxuYS5tZXRob2RfaWRfTWVkaWFEZXZpY2VzX3R8fChhLm1ldGhvZF9pZF9NZWRpYURldmljZXNfdD17fSkpO3ZhciBuOyhmdW5jdGlvbihhKXthW2EuY3Rvcj0wXT1cImN0b3JcIjthW2EuZGV2aWNlSWQ9MV09XCJkZXZpY2VJZFwiO2FbYS5raW5kPTJdPVwia2luZFwiO2FbYS5sYWJlbD0zXT1cImxhYmVsXCI7YVthLmdyb3VwSWQ9NF09XCJncm91cElkXCJ9KShuPWEubWV0aG9kX2lkX01lZGlhRGV2aWNlSW5mb190fHwoYS5tZXRob2RfaWRfTWVkaWFEZXZpY2VJbmZvX3Q9e30pKTt2YXIgZzsoZnVuY3Rpb24oYSl7YVthLmN0b3I9MF09XCJjdG9yXCI7YVthLnR5cGU9MV09XCJ0eXBlXCI7YVthLnNkcD0yXT1cInNkcFwifSkoZz1hLm1ldGhvZF9pZF9SVENTZXNzaW9uRGVzY3JpcHRpb25fdHx8KGEubWV0aG9kX2lkX1JUQ1Nlc3Npb25EZXNjcmlwdGlvbl90PXt9KSk7dmFyIHA7KGZ1bmN0aW9uKGEpe2FbYS5jdG9yPTBdPVwiY3RvclwiO2FbYS5raW5kPTFdPVwia2luZFwiO2FbYS5pZD0yXT1cImlkXCI7YVthLmxhYmVsPVxuM109XCJsYWJlbFwiO2FbYS5lbmFibGVkPTRdPVwiZW5hYmxlZFwiO2FbYS5tdXRlZD01XT1cIm11dGVkXCI7YVthLnJlYWR5U3RhdGU9Nl09XCJyZWFkeVN0YXRlXCI7YVthLm9uZW5kZWQ9N109XCJvbmVuZGVkXCI7YVthLm9ubXV0ZT04XT1cIm9ubXV0ZVwiO2FbYS5vbnVubXV0ZT05XT1cIm9udW5tdXRlXCI7YVthLmNsb25lPTEwXT1cImNsb25lXCI7YVthLnN0b3A9MTFdPVwic3RvcFwiO2FbYS5nZXRDYXBhYmlsaXRpZXM9MTJdPVwiZ2V0Q2FwYWJpbGl0aWVzXCI7YVthLmdldFNldHRpbmdzPTEzXT1cImdldFNldHRpbmdzXCI7YVthLmFwcGx5Q29uc3RyYWludHM9MTRdPVwiYXBwbHlDb25zdHJhaW50c1wiO2FbYS5nZXRDb25zdHJhaW50cz0xNV09XCJnZXRDb25zdHJhaW50c1wifSkocD1hLm1ldGhvZF9pZF9NZWRpYVN0cmVhbVRyYWNrX3R8fChhLm1ldGhvZF9pZF9NZWRpYVN0cmVhbVRyYWNrX3Q9e30pKTt2YXIgZjsoZnVuY3Rpb24oYSl7YVthLmN0b3I9MF09XCJjdG9yXCI7YVthLmlkPTFdPVwiaWRcIjthW2EuZ2V0QXVkaW9UcmFja3M9XG4yXT1cImdldEF1ZGlvVHJhY2tzXCI7YVthLmdldFZpZGVvVHJhY2tzPTNdPVwiZ2V0VmlkZW9UcmFja3NcIjthW2EuZ2V0VHJhY2tzPTRdPVwiZ2V0VHJhY2tzXCI7YVthLmdldFRyYWNrQnlJZD01XT1cImdldFRyYWNrQnlJZFwiO2FbYS5hZGRUcmFjaz02XT1cImFkZFRyYWNrXCI7YVthLnJlbW92ZVRyYWNrPTddPVwicmVtb3ZlVHJhY2tcIjthW2EuY2xvbmU9OF09XCJjbG9uZVwiO2FbYS5hY3RpdmU9OV09XCJhY3RpdmVcIn0pKGY9YS5tZXRob2RfaWRfTWVkaWFTdHJlYW1fdHx8KGEubWV0aG9kX2lkX01lZGlhU3RyZWFtX3Q9e30pKTt2YXIgSjsoZnVuY3Rpb24oYSl7YVthLmN0b3I9MF09XCJjdG9yXCI7YVthLmdldFVzZXJNZWRpYT0xXT1cImdldFVzZXJNZWRpYVwiO2FbYS5zZXRDb2RlY0NhcGFiaWxpdGllcz0yXT1cInNldENvZGVjQ2FwYWJpbGl0aWVzXCI7YVthLmdldENhcGFiaWxpdGllcz0zXT1cImdldENhcGFiaWxpdGllc1wifSkoSj1hLm1ldGhvZF9pZF9OYXZpZ2F0b3JVc2VyTWVkaWFfdHx8KGEubWV0aG9kX2lkX05hdmlnYXRvclVzZXJNZWRpYV90PVxue30pKTt2YXIgeDsoZnVuY3Rpb24oYSl7YVthLmN0b3I9MF09XCJjdG9yXCI7YVthLmNhbmRpZGF0ZT0xXT1cImNhbmRpZGF0ZVwiO2FbYS5zZHBNaWQ9Ml09XCJzZHBNaWRcIjthW2Euc2RwTUxpbmVJbmRleD0zXT1cInNkcE1MaW5lSW5kZXhcIn0pKHg9YS5tZXRob2RfaWRfUlRDSWNlQ2FuZGlkYXRlX3R8fChhLm1ldGhvZF9pZF9SVENJY2VDYW5kaWRhdGVfdD17fSkpO3ZhciBtOyhmdW5jdGlvbihhKXthW2EuY3Rvcj0wXT1cImN0b3JcIjthW2EuY2FuZGlkYXRlPTFdPVwiY2FuZGlkYXRlXCJ9KShtPWEubWV0aG9kX2lkX1JUQ0ljZUNhbmRpZGF0ZUV2ZW50X3R8fChhLm1ldGhvZF9pZF9SVENJY2VDYW5kaWRhdGVFdmVudF90PXt9KSk7dmFyIEQ7KGZ1bmN0aW9uKGEpe2FbYS5jdG9yPTBdPVwiY3RvclwiO2FbYS5zdHJlYW09MV09XCJzdHJlYW1cIn0pKEQ9YS5tZXRob2RfaWRfTWVkaWFTdHJlYW1FdmVudF90fHwoYS5tZXRob2RfaWRfTWVkaWFTdHJlYW1FdmVudF90PXt9KSk7dmFyIEI7KGZ1bmN0aW9uKGEpe2FbYS5jdG9yPVxuMF09XCJjdG9yXCI7YVthLnNpbmtJZD0xXT1cInNpbmtJZFwiO2FbYS5jb25uZWN0VG89Ml09XCJjb25uZWN0VG9cIjthW2EuZGlzY29ubmVjdD0zXT1cImRpc2Nvbm5lY3RcIjthW2Euc2V0RnJhbWU9NF09XCJzZXRGcmFtZVwiO2FbYS5hZGRDbGlwUmVjdD01XT1cImFkZENsaXBSZWN0XCI7YVthLnJlbW92ZUNsaXBSZWN0PTZdPVwicmVtb3ZlQ2xpcFJlY3RcIjthW2Eub25lcnJvcj03XT1cIm9uZXJyb3JcIjthW2Eub252aWRlb2ZyYW1lY2hhbmdlZD04XT1cIm9udmlkZW9mcmFtZWNoYW5nZWRcIjthW2EucGxhY2VtZW50PTldPVwicGxhY2VtZW50XCJ9KShCPWEubWV0aG9kX2lkX1ZpZGVvRWxlbWVudF90fHwoYS5tZXRob2RfaWRfVmlkZW9FbGVtZW50X3Q9e30pKTt2YXIgdDsoZnVuY3Rpb24oYSl7YVthLmN0b3I9MF09XCJjdG9yXCI7YVthLnNpbmtJZD0xXT1cInNpbmtJZFwiO2FbYS5zcmNPYmplY3Q9Ml09XCJzcmNPYmplY3RcIjthW2Euc3JjPTNdPVwic3JjXCI7YVthLnBsYXk9NF09XCJwbGF5XCI7YVthLnBhdXNlPTVdPVwicGF1c2VcIn0pKHQ9XG5hLm1ldGhvZF9pZF9BdWRpb0VsZW1lbnRfdHx8KGEubWV0aG9kX2lkX0F1ZGlvRWxlbWVudF90PXt9KSk7dmFyIGg7KGZ1bmN0aW9uKGEpe2FbYS5jdG9yPTBdPVwiY3RvclwiO2FbYS50cmFjaz0xXT1cInRyYWNrXCI7YVthLmdldENvbnRyaWJ1dGluZ1NvdXJjZXM9Ml09XCJnZXRDb250cmlidXRpbmdTb3VyY2VzXCI7YVthLmdldFN5bmNocm9uaXphdGlvblNvdXJjZXM9M109XCJnZXRTeW5jaHJvbml6YXRpb25Tb3VyY2VzXCI7YVthLnRyYW5zcG9ydD00XT1cInRyYW5zcG9ydFwiO2FbYS5ydGNwVHJhbnNwb3J0PTVdPVwicnRjcFRyYW5zcG9ydFwiO2FbYS5nZXRDYXBhYmlsaXRpZXM9Nl09XCJnZXRDYXBhYmlsaXRpZXNcIjthW2EuZ2V0UGFyYW1ldGVycz03XT1cImdldFBhcmFtZXRlcnNcIjthW2EuZ2V0U3RhdHM9OF09XCJnZXRTdGF0c1wiO2FbYS5nZXRDYXBhYmlsaXRpZXNfdjI9OV09XCJnZXRDYXBhYmlsaXRpZXNfdjJcIn0pKGg9YS5tZXRob2RfaWRfUlRDUnRwUmVjZWl2ZXJfdHx8KGEubWV0aG9kX2lkX1JUQ1J0cFJlY2VpdmVyX3Q9XG57fSkpO3ZhciBBOyhmdW5jdGlvbihhKXthW2EuY3Rvcj0wXT1cImN0b3JcIjthW2EudHJhY2s9MV09XCJ0cmFja1wiO2FbYS50cmFuc3BvcnQ9Ml09XCJ0cmFuc3BvcnRcIjthW2EucnRjcFRyYW5zcG9ydD0zXT1cInJ0Y3BUcmFuc3BvcnRcIjthW2EuZHRtZj00XT1cImR0bWZcIjthW2EuZ2V0Q2FwYWJpbGl0aWVzPTVdPVwiZ2V0Q2FwYWJpbGl0aWVzXCI7YVthLmdldFBhcmFtZXRlcnM9Nl09XCJnZXRQYXJhbWV0ZXJzXCI7YVthLnNldFBhcmFtZXRlcnM9N109XCJzZXRQYXJhbWV0ZXJzXCI7YVthLnJlcGxhY2VUcmFjaz04XT1cInJlcGxhY2VUcmFja1wiO2FbYS5nZXRTdGF0cz05XT1cImdldFN0YXRzXCI7YVthLnNldFN0cmVhbXM9MTBdPVwic2V0U3RyZWFtc1wiO2FbYS5nZXRDYXBhYmlsaXRpZXNfdjI9MTFdPVwiZ2V0Q2FwYWJpbGl0aWVzX3YyXCJ9KShBPWEubWV0aG9kX2lkX1JUQ1J0cFNlbmRlcl90fHwoYS5tZXRob2RfaWRfUlRDUnRwU2VuZGVyX3Q9e30pKTt2YXIgeTsoZnVuY3Rpb24oYSl7YVthLmN0b3I9MF09XG5cImN0b3JcIjthW2EudHJhbnNwb3J0PTFdPVwidHJhbnNwb3J0XCI7YVthLnN0YXRlPTJdPVwic3RhdGVcIjthW2EuZ2V0UmVtb3RlQ2VydGlmaWNhdGVzPTNdPVwiZ2V0UmVtb3RlQ2VydGlmaWNhdGVzXCI7YVthLm9uc3RhdGVjaGFuZ2U9NF09XCJvbnN0YXRlY2hhbmdlXCI7YVthLm9uZXJyb3I9NV09XCJvbmVycm9yXCJ9KSh5PWEubWV0aG9kX2lkX1JUQ0R0bHNUcmFuc3BvcnRfdHx8KGEubWV0aG9kX2lkX1JUQ0R0bHNUcmFuc3BvcnRfdD17fSkpO3ZhciBFOyhmdW5jdGlvbihhKXthW2EuY3Rvcj0wXT1cImN0b3JcIjthW2Eucm9sZT0xXT1cInJvbGVcIjthW2EuY29tcG9uZW50PTJdPVwiY29tcG9uZW50XCI7YVthLnN0YXRlPTNdPVwic3RhdGVcIjthW2EuZ2F0aGVyaW5nU3RhdGU9NF09XCJnYXRoZXJpbmdTdGF0ZVwiO2FbYS5sb2NhbGNhbmRpZGF0ZXM9NV09XCJsb2NhbGNhbmRpZGF0ZXNcIjthW2EucmVtb3RlY2FuZGlkYXRlcz02XT1cInJlbW90ZWNhbmRpZGF0ZXNcIjthW2Eub25zdGF0ZWNoYW5nZT03XT1cIm9uc3RhdGVjaGFuZ2VcIjtcbmFbYS5vbmdhdGhlcmluZ3N0YXRlY2hhbmdlPThdPVwib25nYXRoZXJpbmdzdGF0ZWNoYW5nZVwiO2FbYS5vbnNlbGVjdGVkY2FuZGlkYXRlcGFpcmNoYW5nZT05XT1cIm9uc2VsZWN0ZWRjYW5kaWRhdGVwYWlyY2hhbmdlXCJ9KShFPWEubWV0aG9kX2lkX1JUQ0ljZVRyYW5zcG9ydF90fHwoYS5tZXRob2RfaWRfUlRDSWNlVHJhbnNwb3J0X3Q9e30pKTt2YXIgdTsoZnVuY3Rpb24oYSl7YVthLmN0b3I9MF09XCJjdG9yXCI7YVthLmluc2VydERUTUY9MV09XCJpbnNlcnREVE1GXCI7YVthLm9udG9uZWNoYW5nZT0yXT1cIm9udG9uZWNoYW5nZVwiO2FbYS5jYW5JbnNlcnREVE1GPTNdPVwiY2FuSW5zZXJ0RFRNRlwiO2FbYS50b25lQnVmZmVyPTRdPVwidG9uZUJ1ZmZlclwifSkodT1hLm1ldGhvZF9pZF9SVENEVE1GU2VuZGVyX3R8fChhLm1ldGhvZF9pZF9SVENEVE1GU2VuZGVyX3Q9e30pKTt2YXIgcTsoZnVuY3Rpb24oYSl7YVthLmN0b3I9MF09XCJjdG9yXCI7YVthLnRvbmU9MV09XCJ0b25lXCI7YVthLnRvbmVfYnVmZmVyPVxuMl09XCJ0b25lX2J1ZmZlclwifSkocT1hLm1ldGhvZF9pZF9SVENEVE1GVG9uZUNoYW5nZUV2ZW50X3R8fChhLm1ldGhvZF9pZF9SVENEVE1GVG9uZUNoYW5nZUV2ZW50X3Q9e30pKTt2YXIgdzsoZnVuY3Rpb24oYSl7YVthLmN0b3I9MF09XCJjdG9yXCI7YVthLmxvY2FsPTFdPVwibG9jYWxcIjthW2EucmVtb3RlPTJdPVwicmVtb3RlXCJ9KSh3PWEubWV0aG9kX2lkX1JUQ0ljZUNhbmRpZGF0ZVBhaXJfdHx8KGEubWV0aG9kX2lkX1JUQ0ljZUNhbmRpZGF0ZVBhaXJfdD17fSkpO3ZhciB6OyhmdW5jdGlvbihhKXthW2EuY3Rvcj0wXT1cImN0b3JcIjthW2EubWlkPTFdPVwibWlkXCI7YVthLnNlbmRlcj0yXT1cInNlbmRlclwiO2FbYS5yZWNlaXZlcj0zXT1cInJlY2VpdmVyXCI7YVthLmRpcmVjdGlvbj00XT1cImRpcmVjdGlvblwiO2FbYS5jdXJyZW50RGlyZWN0aW9uPTVdPVwiY3VycmVudERpcmVjdGlvblwiO2FbYS5zdG9wPTZdPVwic3RvcFwiO2FbYS5zZXRDb2RlY1ByZWZlcmVuY2VzPTddPVwic2V0Q29kZWNQcmVmZXJlbmNlc1wifSkoej1cbmEubWV0aG9kX2lkX1JUQ1J0cFRyYW5zY2VpdmVyX3R8fChhLm1ldGhvZF9pZF9SVENSdHBUcmFuc2NlaXZlcl90PXt9KSk7dmFyIEM7KGZ1bmN0aW9uKGEpe2FbYS5jdG9yPTBdPVwiY3RvclwiO2FbYS5sYWJlbD0xXT1cImxhYmVsXCI7YVthLm9yZGVyZWQ9Ml09XCJvcmRlcmVkXCI7YVthLm1heFBhY2tldExpZmVUaW1lPTNdPVwibWF4UGFja2V0TGlmZVRpbWVcIjthW2EubWF4UmV0cmFuc21pdHM9NF09XCJtYXhSZXRyYW5zbWl0c1wiO2FbYS5wcm90b2NvbD01XT1cInByb3RvY29sXCI7YVthLm5lZ290aWF0ZWQ9Nl09XCJuZWdvdGlhdGVkXCI7YVthLmlkPTddPVwiaWRcIjthW2EucmVhZHlTdGF0ZT04XT1cInJlYWR5U3RhdGVcIjthW2EuYnVmZmVyZWRBbW91bnQ9OV09XCJidWZmZXJlZEFtb3VudFwiO2FbYS5idWZmZXJlZEFtb3VudExvd1RocmVzaG9sZD0xMF09XCJidWZmZXJlZEFtb3VudExvd1RocmVzaG9sZFwiO2FbYS5vbm9wZW49MTFdPVwib25vcGVuXCI7YVthLm9uYnVmZmVyZWRhbW91bnRsb3c9MTJdPVwib25idWZmZXJlZGFtb3VudGxvd1wiO1xuYVthLm9uZXJyb3I9MTNdPVwib25lcnJvclwiO2FbYS5vbmNsb3Npbmc9MTRdPVwib25jbG9zaW5nXCI7YVthLm9uY2xvc2U9MTVdPVwib25jbG9zZVwiO2FbYS5vbm1lc3NhZ2U9MTZdPVwib25tZXNzYWdlXCI7YVthLmNsb3NlPTE3XT1cImNsb3NlXCI7YVthLnNlbmRfdGV4dD0xOF09XCJzZW5kX3RleHRcIjthW2Euc2VuZF9iaW5hcnk9MTldPVwic2VuZF9iaW5hcnlcIn0pKEM9YS5tZXRob2RfaWRfUlRDRGF0YUNoYW5uZWxfdHx8KGEubWV0aG9kX2lkX1JUQ0RhdGFDaGFubmVsX3Q9e30pKTt2YXIgRjsoZnVuY3Rpb24oYSl7YVthLmN0b3I9MF09XCJjdG9yXCI7YVthLnRyYW5zcG9ydD0xXT1cInRyYW5zcG9ydFwiO2FbYS5zdGF0ZT0yXT1cInN0YXRlXCI7YVthLm1heE1lc3NhZ2VTaXplPTNdPVwibWF4TWVzc2FnZVNpemVcIjthW2EubWF4Q2hhbm5lbHM9NF09XCJtYXhDaGFubmVsc1wiO2FbYS5vbnN0YXRlY2hhbmdlPTVdPVwib25zdGF0ZWNoYW5nZVwifSkoRj1hLm1ldGhvZF9pZF9SVENTY3RwVHJhbnNwb3J0X3R8fChhLm1ldGhvZF9pZF9SVENTY3RwVHJhbnNwb3J0X3Q9XG57fSkpO2EuY2xhc3NfbGliX2luZm89bmV3IGIuV2VicnBjQ2xhc3NMaWJJbmZvKFwid2VicnBjX2NsYXNzX2xpYnJhcnlcIixbbmV3IGIuV2VicnBjQ2xhc3NJbmZvKGMuRW5naW5lQ29udHJvbCxcIkVuZ2luZUNvbnRyb2xcIixbbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLkVuZ2luZUNvbnRyb2wsZC5jdG9yLFwiY3RvclwiLCExKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuRW5naW5lQ29udHJvbCxkLnZlcnNpb24sXCJ2ZXJzaW9uXCIsITApLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5FbmdpbmVDb250cm9sLGQuZmVhdHVyZV9mbGFncyxcImZlYXR1cmVfZmxhZ3NcIiwhMCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLkVuZ2luZUNvbnRyb2wsZC52ZXJzaW9uX2luZm8sXCJ2ZXJzaW9uX2luZm9cIiwhMCxhLkZFQVRVUkVfbXNfdGVhbXNfZGVza3RvcF9zaGFyaW5nKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuRW5naW5lQ29udHJvbCxkLm9zaW5mbyxcIm9zaW5mb1wiLCEwLGEuRkVBVFVSRV9tc190ZWFtc19vc2luZm8pLFxubmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLkVuZ2luZUNvbnRyb2wsZC5lbmRwb2ludF9pZCxcImVuZHBvaW50X2lkXCIsITAsYS5GRUFUVVJFX21zX3RlYW1zX2VuZHBvaW50X2lkKV0pLG5ldyBiLldlYnJwY0NsYXNzSW5mbyhjLlJUQ1BlZXJDb25uZWN0aW9uLFwiUlRDUGVlckNvbm5lY3Rpb25cIixbbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1BlZXJDb25uZWN0aW9uLGUuY3RvcixcImN0b3JcIiwhMSksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1BlZXJDb25uZWN0aW9uLGUubG9jYWxEZXNjcmlwdGlvbixcImxvY2FsRGVzY3JpcHRpb25cIiwhMCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1BlZXJDb25uZWN0aW9uLGUucmVtb3RlRGVzY3JpcHRpb24sXCJyZW1vdGVEZXNjcmlwdGlvblwiLCEwKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDUGVlckNvbm5lY3Rpb24sZS5yZWFkeVN0YXRlLFwicmVhZHlTdGF0ZVwiLCEwKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDUGVlckNvbm5lY3Rpb24sXG5lLmljZVN0YXRlLFwiaWNlU3RhdGVcIiwhMCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1BlZXJDb25uZWN0aW9uLGUubG9jYWxTdHJlYW1zLFwibG9jYWxTdHJlYW1zXCIsITApLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENQZWVyQ29ubmVjdGlvbixlLnJlbW90ZVN0cmVhbXMsXCJyZW1vdGVTdHJlYW1zXCIsITApLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENQZWVyQ29ubmVjdGlvbixlLmNyZWF0ZU9mZmVyLFwiY3JlYXRlT2ZmZXJcIiwhMSksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1BlZXJDb25uZWN0aW9uLGUuY3JlYXRlQW5zd2VyLFwiY3JlYXRlQW5zd2VyXCIsITEpLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENQZWVyQ29ubmVjdGlvbixlLnNldExvY2FsRGVzY3JpcHRpb24sXCJzZXRMb2NhbERlc2NyaXB0aW9uXCIsITEpLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENQZWVyQ29ubmVjdGlvbixlLnNldFJlbW90ZURlc2NyaXB0aW9uLFwic2V0UmVtb3RlRGVzY3JpcHRpb25cIixcbiExKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDUGVlckNvbm5lY3Rpb24sZS51cGRhdGVJY2UsXCJ1cGRhdGVJY2VcIiwhMCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1BlZXJDb25uZWN0aW9uLGUuYWRkSWNlQ2FuZGlkYXRlLFwiYWRkSWNlQ2FuZGlkYXRlXCIsITApLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENQZWVyQ29ubmVjdGlvbixlLmFkZFN0cmVhbSxcImFkZFN0cmVhbVwiLCEwKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDUGVlckNvbm5lY3Rpb24sZS5yZW1vdmVTdHJlYW0sXCJyZW1vdmVTdHJlYW1cIiwhMCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1BlZXJDb25uZWN0aW9uLGUuY2xvc2UsXCJjbG9zZVwiLCEwKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDUGVlckNvbm5lY3Rpb24sZS5pY2VDb25uZWN0aW9uU3RhdGUsXCJpY2VDb25uZWN0aW9uU3RhdGVcIiwhMCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1BlZXJDb25uZWN0aW9uLFxuZS5pY2VHYXRoZXJpbmdTdGF0ZSxcImljZUdhdGhlcmluZ1N0YXRlXCIsITApLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENQZWVyQ29ubmVjdGlvbixlLnNpZ25hbGluZ1N0YXRlLFwic2lnbmFsaW5nU3RhdGVcIiwhMCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1BlZXJDb25uZWN0aW9uLGUub25hZGRzdHJlYW0sXCJvbmFkZHN0cmVhbVwiLCEwKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDUGVlckNvbm5lY3Rpb24sZS5vbmljZWNhbmRpZGF0ZSxcIm9uaWNlY2FuZGlkYXRlXCIsITApLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENQZWVyQ29ubmVjdGlvbixlLm9uaWNlY29ubmVjdGlvbnN0YXRlY2hhbmdlLFwib25pY2Vjb25uZWN0aW9uc3RhdGVjaGFuZ2VcIiwhMCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1BlZXJDb25uZWN0aW9uLGUub25pY2VnYXRoZXJpbmdzdGF0ZWNoYW5nZSxcIm9uaWNlZ2F0aGVyaW5nc3RhdGVjaGFuZ2VcIiwhMCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1BlZXJDb25uZWN0aW9uLFxuZS5vbnNpZ25hbGluZ3N0YXRlY2hhbmdlLFwib25zaWduYWxpbmdzdGF0ZWNoYW5nZVwiLCEwKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDUGVlckNvbm5lY3Rpb24sZS5vbm5lZ290aWF0aW9ubmVlZGVkLFwib25uZWdvdGlhdGlvbm5lZWRlZFwiLCEwKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDUGVlckNvbm5lY3Rpb24sZS5vbnJlbW92ZXN0cmVhbSxcIm9ucmVtb3Zlc3RyZWFtXCIsITApLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENQZWVyQ29ubmVjdGlvbixlLmdldFN0YXRzLFwiZ2V0U3RhdHNcIiwhMSksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1BlZXJDb25uZWN0aW9uLGUuZ2V0UmVjZWl2ZXJzLFwiZ2V0UmVjZWl2ZXJzXCIsITEsYS5GRUFUVVJFX21zX3RlYW1zX3NwZWFraW5nX2luZGljYXRvciksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1BlZXJDb25uZWN0aW9uLGUuZ2V0U2VuZGVycyxcImdldFNlbmRlcnNcIiwhMSxhLkZFQVRVUkVfbXNfdGVhbXNfcHN0biksXG5uZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDUGVlckNvbm5lY3Rpb24sZS5hZGRUcmFjayxcImFkZFRyYWNrXCIsITEsYS5GRUFUVVJFX21zX3RlYW1zX3BzdG4pLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENQZWVyQ29ubmVjdGlvbixlLnJlbW92ZVRyYWNrLFwicmVtb3ZlVHJhY2tcIiwhMSxhLkZFQVRVUkVfbXNfdGVhbXNfcHN0biksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1BlZXJDb25uZWN0aW9uLGUub250cmFjayxcIm9udHJhY2tcIiwhMCxhLkZFQVRVUkVfbXNfdGVhbXNfcHN0biksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1BlZXJDb25uZWN0aW9uLGUuc2V0TG9jYWxEZXNjcmlwdGlvbl92MixcInNldExvY2FsRGVzY3JpcHRpb25fdjJcIiwhMSxhLkZFQVRVUkVfbXNfdGVhbXNfd2VicnRjXzFkb3QwKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDUGVlckNvbm5lY3Rpb24sZS5zZXRSZW1vdGVEZXNjcmlwdGlvbl92MixcInNldFJlbW90ZURlc2NyaXB0aW9uX3YyXCIsXG4hMSxhLkZFQVRVUkVfbXNfdGVhbXNfd2VicnRjXzFkb3QwKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDUGVlckNvbm5lY3Rpb24sZS5hZGRUcmFuc2NlaXZlcldpdGhUcmFjayxcImFkZFRyYW5zY2VpdmVyV2l0aFRyYWNrXCIsITEsYS5GRUFUVVJFX21zX3RlYW1zX3dlYnJ0Y18xZG90MCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1BlZXJDb25uZWN0aW9uLGUuYWRkVHJhbnNjZWl2ZXJXaXRoS2luZCxcImFkZFRyYW5zY2VpdmVyV2l0aEtpbmRcIiwhMSxhLkZFQVRVUkVfbXNfdGVhbXNfd2VicnRjXzFkb3QwKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDUGVlckNvbm5lY3Rpb24sZS5nZXRUcmFuc2NlaXZlcnMsXCJnZXRUcmFuc2NlaXZlcnNcIiwhMSxhLkZFQVRVUkVfbXNfdGVhbXNfd2VicnRjXzFkb3QwKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDUGVlckNvbm5lY3Rpb24sZS5vbmNvbm5lY3Rpb25zdGF0ZWNoYW5nZSxcIm9uY29ubmVjdGlvbnN0YXRlY2hhbmdlXCIsXG4hMCxhLkZFQVRVUkVfbXNfdGVhbXNfd2VicnRjXzFkb3QwKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDUGVlckNvbm5lY3Rpb24sZS5zY3RwLFwic2N0cFwiLCEwLGEuRkVBVFVSRV9tc190ZWFtc19kYXRhX2NoYW5uZWwpLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENQZWVyQ29ubmVjdGlvbixlLm9uZGF0YWNoYW5uZWwsXCJvbmRhdGFjaGFubmVsXCIsITAsYS5GRUFUVVJFX21zX3RlYW1zX2RhdGFfY2hhbm5lbCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1BlZXJDb25uZWN0aW9uLGUuY3JlYXRlRGF0YUNoYW5uZWwsXCJjcmVhdGVEYXRhQ2hhbm5lbFwiLCExLGEuRkVBVFVSRV9tc190ZWFtc19kYXRhX2NoYW5uZWwpLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENQZWVyQ29ubmVjdGlvbixlLmdldFN0YXRzX3YyLFwiZ2V0U3RhdHNfdjJcIiwhMSxhLkZFQVRVUkVfbXNfdGVhbXNfd2VicnRjXzFkb3QwKV0pLG5ldyBiLldlYnJwY0NsYXNzSW5mbyhjLlJUQ1Nlc3Npb25EZXNjcmlwdGlvbixcblwiUlRDU2Vzc2lvbkRlc2NyaXB0aW9uXCIsW25ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENTZXNzaW9uRGVzY3JpcHRpb24sZy5jdG9yLFwiY3RvclwiLCExKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDU2Vzc2lvbkRlc2NyaXB0aW9uLGcudHlwZSxcInR5cGVcIiwhMCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1Nlc3Npb25EZXNjcmlwdGlvbixnLnNkcCxcInNkcFwiLCEwKV0pLG5ldyBiLldlYnJwY0NsYXNzSW5mbyhjLlJUQ0ljZUNhbmRpZGF0ZSxcIlJUQ0ljZUNhbmRpZGF0ZVwiLFtuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDSWNlQ2FuZGlkYXRlLHguY3RvcixcImN0b3JcIiwhMSksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ0ljZUNhbmRpZGF0ZSx4LmNhbmRpZGF0ZSxcImNhbmRpZGF0ZVwiLCEwKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDSWNlQ2FuZGlkYXRlLHguc2RwTWlkLFwic2RwTWlkXCIsITApLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENJY2VDYW5kaWRhdGUsXG54LnNkcE1MaW5lSW5kZXgsXCJzZHBNTGluZUluZGV4XCIsITApXSksbmV3IGIuV2VicnBjQ2xhc3NJbmZvKGMuUlRDSWNlQ2FuZGlkYXRlRXZlbnQsXCJSVENJY2VDYW5kaWRhdGVFdmVudFwiLFtuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDSWNlQ2FuZGlkYXRlRXZlbnQsbS5jdG9yLFwiY3RvclwiLCExKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDSWNlQ2FuZGlkYXRlRXZlbnQsbS5jYW5kaWRhdGUsXCJjYW5kaWRhdGVcIiwhMCldKSxuZXcgYi5XZWJycGNDbGFzc0luZm8oYy5NZWRpYURldmljZXMsXCJNZWRpYURldmljZXNcIixbbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLk1lZGlhRGV2aWNlcyxrLmN0b3IsXCJjdG9yXCIsITEpLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5NZWRpYURldmljZXMsay5lbnVtZXJhdGVEZXZpY2VzLFwiZW51bWVyYXRlRGV2aWNlc1wiLCExKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuTWVkaWFEZXZpY2VzLGsuZ2V0RGlzcGxheU1lZGlhLFwiZ2V0RGlzcGxheU1lZGlhXCIsXG4hMSxhLkZFQVRVUkVfbXNfdGVhbXNfZGVza3RvcF9zaGFyaW5nKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuTWVkaWFEZXZpY2VzLGsub25kZXZpY2VjaGFuZ2UsXCJvbmRldmljZWNoYW5nZVwiLCEwLGEuRkVBVFVSRV9tc190ZWFtc19zcGVha2luZ19pbmRpY2F0b3IpXSksbmV3IGIuV2VicnBjQ2xhc3NJbmZvKGMuTWVkaWFEZXZpY2VJbmZvLFwiTWVkaWFEZXZpY2VJbmZvXCIsW25ldyBiLldlYnJwY01ldGhvZEluZm8oYy5NZWRpYURldmljZUluZm8sbi5jdG9yLFwiY3RvclwiLCExKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuTWVkaWFEZXZpY2VJbmZvLG4uZGV2aWNlSWQsXCJkZXZpY2VJZFwiLCEwKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuTWVkaWFEZXZpY2VJbmZvLG4ua2luZCxcImtpbmRcIiwhMCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLk1lZGlhRGV2aWNlSW5mbyxuLmxhYmVsLFwibGFiZWxcIiwhMCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLk1lZGlhRGV2aWNlSW5mbyxcbm4uZ3JvdXBJZCxcImdyb3VwSWRcIiwhMCldKSxuZXcgYi5XZWJycGNDbGFzc0luZm8oYy5NZWRpYVN0cmVhbVRyYWNrLFwiTWVkaWFTdHJlYW1UcmFja1wiLFtuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuTWVkaWFTdHJlYW1UcmFjayxwLmN0b3IsXCJjdG9yXCIsITEpLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5NZWRpYVN0cmVhbVRyYWNrLHAuY2xvbmUsXCJjbG9uZVwiLCExKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuTWVkaWFTdHJlYW1UcmFjayxwLnN0b3AsXCJzdG9wXCIsITEpLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5NZWRpYVN0cmVhbVRyYWNrLHAuZ2V0Q2FwYWJpbGl0aWVzLFwiZ2V0Q2FwYWJpbGl0aWVzXCIsITEpLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5NZWRpYVN0cmVhbVRyYWNrLHAuZ2V0U2V0dGluZ3MsXCJnZXRTZXR0aW5nc1wiLCExKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuTWVkaWFTdHJlYW1UcmFjayxwLmFwcGx5Q29uc3RyYWludHMsXCJhcHBseUNvbnN0cmFpbnRzXCIsXG4hMSxhLkZFQVRVUkVfbXNfdGVhbXNfZGVza3RvcF9zaGFyaW5nKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuTWVkaWFTdHJlYW1UcmFjayxwLmtpbmQsXCJraW5kXCIsITApLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5NZWRpYVN0cmVhbVRyYWNrLHAuaWQsXCJpZFwiLCEwKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuTWVkaWFTdHJlYW1UcmFjayxwLmxhYmVsLFwibGFiZWxcIiwhMCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLk1lZGlhU3RyZWFtVHJhY2sscC5lbmFibGVkLFwiZW5hYmxlZFwiLCEwKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuTWVkaWFTdHJlYW1UcmFjayxwLm11dGVkLFwibXV0ZWRcIiwhMCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLk1lZGlhU3RyZWFtVHJhY2sscC5yZWFkeVN0YXRlLFwicmVhZHlTdGF0ZVwiLCEwKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuTWVkaWFTdHJlYW1UcmFjayxwLm9uZW5kZWQsXCJvbmVuZGVkXCIsITApLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5NZWRpYVN0cmVhbVRyYWNrLFxucC5vbm11dGUsXCJvbm11dGVcIiwhMCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLk1lZGlhU3RyZWFtVHJhY2sscC5vbnVubXV0ZSxcIm9udW5tdXRlXCIsITApLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5NZWRpYVN0cmVhbVRyYWNrLHAuZ2V0Q29uc3RyYWludHMsXCJnZXRDb25zdHJhaW50c1wiLCExLGEuRkVBVFVSRV9tc190ZWFtc19tc3RyYWNrX2NvbnN0cmFpbnRzKV0pLG5ldyBiLldlYnJwY0NsYXNzSW5mbyhjLk1lZGlhU3RyZWFtLFwiTWVkaWFTdHJlYW1cIixbbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLk1lZGlhU3RyZWFtLGYuY3RvcixcImN0b3JcIiwhMSksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLk1lZGlhU3RyZWFtLGYuaWQsXCJpZFwiLCEwKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuTWVkaWFTdHJlYW0sZi5nZXRBdWRpb1RyYWNrcyxcImdldEF1ZGlvVHJhY2tzXCIsITEpLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5NZWRpYVN0cmVhbSxmLmdldFZpZGVvVHJhY2tzLFwiZ2V0VmlkZW9UcmFja3NcIixcbiExKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuTWVkaWFTdHJlYW0sZi5nZXRUcmFja3MsXCJnZXRUcmFja3NcIiwhMSksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLk1lZGlhU3RyZWFtLGYuZ2V0VHJhY2tCeUlkLFwiZ2V0VHJhY2tCeUlkXCIsITEpLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5NZWRpYVN0cmVhbSxmLmFkZFRyYWNrLFwiYWRkVHJhY2tcIiwhMSksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLk1lZGlhU3RyZWFtLGYucmVtb3ZlVHJhY2ssXCJyZW1vdmVUcmFja1wiLCExKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuTWVkaWFTdHJlYW0sZi5jbG9uZSxcImNsb25lXCIsITApLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5NZWRpYVN0cmVhbSxmLmFjdGl2ZSxcImFjdGl2ZVwiLCEwKV0pLG5ldyBiLldlYnJwY0NsYXNzSW5mbyhjLk5hdmlnYXRvclVzZXJNZWRpYSxcIk5hdmlnYXRvclVzZXJNZWRpYVwiLFtuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuTmF2aWdhdG9yVXNlck1lZGlhLEouY3RvcixcblwiY3RvclwiLCExKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuTmF2aWdhdG9yVXNlck1lZGlhLEouZ2V0VXNlck1lZGlhLFwiZ2V0VXNlck1lZGlhXCIsITEpLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5OYXZpZ2F0b3JVc2VyTWVkaWEsSi5zZXRDb2RlY0NhcGFiaWxpdGllcyxcInNldENvZGVjQ2FwYWJpbGl0aWVzXCIsITEsYS5GRUFUVVJFX21zX3RlYW1zX2NvZGVjX2NhcGFiaWxpdHkpLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5OYXZpZ2F0b3JVc2VyTWVkaWEsSi5nZXRDYXBhYmlsaXRpZXMsXCJnZXRSdHBDYXBhYmlsaXRpZXNcIiwhMSxhLkZFQVRVUkVfbXNfdGVhbXNfd2VicnRjXzFkb3QwKV0pLG5ldyBiLldlYnJwY0NsYXNzSW5mbyhjLk1lZGlhU3RyZWFtRXZlbnQsXCJNZWRpYVN0cmVhbUV2ZW50XCIsW25ldyBiLldlYnJwY01ldGhvZEluZm8oYy5NZWRpYVN0cmVhbUV2ZW50LEQuY3RvcixcImN0b3JcIiwhMSksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLk1lZGlhU3RyZWFtRXZlbnQsXG5ELnN0cmVhbSxcInN0cmVhbVwiLCEwKV0pLG5ldyBiLldlYnJwY0NsYXNzSW5mbyhjLlZpZGVvRWxlbWVudCxcIlZpZGVvRWxlbWVudFwiLFtuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuVmlkZW9FbGVtZW50LEIuY3RvcixcImN0b3JcIiwhMSksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlZpZGVvRWxlbWVudCxCLnNpbmtJZCxcInNpbmtJZFwiLCEwKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuVmlkZW9FbGVtZW50LEIuY29ubmVjdFRvLFwiY29ubmVjdFRvXCIsITEpLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5WaWRlb0VsZW1lbnQsQi5kaXNjb25uZWN0LFwiZGlzY29ubmVjdFwiLCExKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuVmlkZW9FbGVtZW50LEIuc2V0RnJhbWUsXCJzZXRGcmFtZVwiLCExKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuVmlkZW9FbGVtZW50LEIuYWRkQ2xpcFJlY3QsXCJhZGRDbGlwUmVjdFwiLCExKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuVmlkZW9FbGVtZW50LEIucmVtb3ZlQ2xpcFJlY3QsXG5cInJlbW92ZUNsaXBSZWN0XCIsITEpLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5WaWRlb0VsZW1lbnQsQi5vbmVycm9yLFwib25lcnJvclwiLCEwKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuVmlkZW9FbGVtZW50LEIub252aWRlb2ZyYW1lY2hhbmdlZCxcIm9udmlkZW9mcmFtZWNoYW5nZWRcIiwhMCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlZpZGVvRWxlbWVudCxCLnBsYWNlbWVudCxcInBsYWNlbWVudFwiLCEwLGEuRkVBVFVSRV9tc190ZWFtc192aWRlb19wbGFjZW1lbnQpXSksbmV3IGIuV2VicnBjQ2xhc3NJbmZvKGMuQXVkaW9FbGVtZW50LFwiQXVkaW9FbGVtZW50XCIsW25ldyBiLldlYnJwY01ldGhvZEluZm8oYy5BdWRpb0VsZW1lbnQsdC5jdG9yLFwiY3RvclwiLCExKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuQXVkaW9FbGVtZW50LHQuc2lua0lkLFwic2lua0lkXCIsITApLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5BdWRpb0VsZW1lbnQsdC5zcmNPYmplY3QsXCJzcmNPYmplY3RcIixcbiEwKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuQXVkaW9FbGVtZW50LHQuc3JjLFwic3JjXCIsITApLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5BdWRpb0VsZW1lbnQsdC5wbGF5LFwicGxheVwiLCExKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuQXVkaW9FbGVtZW50LHQucGF1c2UsXCJwYXVzZVwiLCExKV0pLG5ldyBiLldlYnJwY0NsYXNzSW5mbyhjLlJUQ1J0cFJlY2VpdmVyLFwiUlRDUnRwUmVjZWl2ZXJcIixbbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1J0cFJlY2VpdmVyLGguY3RvcixcImN0b3JcIiwhMSxhLkZFQVRVUkVfbXNfdGVhbXNfc3BlYWtpbmdfaW5kaWNhdG9yKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDUnRwUmVjZWl2ZXIsaC50cmFjayxcInRyYWNrXCIsITAsYS5GRUFUVVJFX21zX3RlYW1zX3NwZWFraW5nX2luZGljYXRvciksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1J0cFJlY2VpdmVyLGguZ2V0Q29udHJpYnV0aW5nU291cmNlcyxcImdldENvbnRyaWJ1dGluZ1NvdXJjZXNcIixcbiExLGEuRkVBVFVSRV9tc190ZWFtc19zcGVha2luZ19pbmRpY2F0b3IpLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENSdHBSZWNlaXZlcixoLmdldFN5bmNocm9uaXphdGlvblNvdXJjZXMsXCJnZXRTeW5jaHJvbml6YXRpb25Tb3VyY2VzXCIsITEsYS5GRUFUVVJFX21zX3RlYW1zX3BzdG4pLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENSdHBSZWNlaXZlcixoLnRyYW5zcG9ydCxcInRyYW5zcG9ydFwiLCEwLGEuRkVBVFVSRV9tc190ZWFtc19wc3RuKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDUnRwUmVjZWl2ZXIsaC5ydGNwVHJhbnNwb3J0LFwicnRjcHRyYW5zcG9ydFwiLCEwLGEuRkVBVFVSRV9tc190ZWFtc19wc3RuKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDUnRwUmVjZWl2ZXIsaC5nZXRDYXBhYmlsaXRpZXMsXCJnZXRDYXBhYmlsaXRpZXNcIiwhMSxhLkZFQVRVUkVfbXNfdGVhbXNfcHN0biksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1J0cFJlY2VpdmVyLFxuaC5nZXRQYXJhbWV0ZXJzLFwiZ2V0UGFyYW1ldGVyc1wiLCExLGEuRkVBVFVSRV9tc190ZWFtc19wc3RuKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDUnRwUmVjZWl2ZXIsaC5nZXRTdGF0cyxcImdldFN0YXRzXCIsITEsYS5GRUFUVVJFX21zX3RlYW1zX3BzdG4pLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENSdHBSZWNlaXZlcixoLmdldENhcGFiaWxpdGllc192MixcImdldENhcGFiaWxpdGllc192MlwiLCExLGEuRkVBVFVSRV9tc190ZWFtc193ZWJydGNfMWRvdDApXSksbmV3IGIuV2VicnBjQ2xhc3NJbmZvKGMuUlRDUnRwU2VuZGVyLFwiUlRDUnRwU2VuZGVyXCIsW25ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENSdHBTZW5kZXIsQS5jdG9yLFwiY3RvclwiLCExLGEuRkVBVFVSRV9tc190ZWFtc19wc3RuKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDUnRwU2VuZGVyLEEudHJhY2ssXCJ0cmFja1wiLCEwLGEuRkVBVFVSRV9tc190ZWFtc19wc3RuKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDUnRwU2VuZGVyLFxuQS50cmFuc3BvcnQsXCJ0cmFuc3BvcnRcIiwhMCxhLkZFQVRVUkVfbXNfdGVhbXNfcHN0biksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1J0cFNlbmRlcixBLnJ0Y3BUcmFuc3BvcnQsXCJydGNwVHJhbnNwb3J0XCIsITAsYS5GRUFUVVJFX21zX3RlYW1zX3BzdG4pLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENSdHBTZW5kZXIsQS5kdG1mLFwiZHRtZlwiLCEwLGEuRkVBVFVSRV9tc190ZWFtc19wc3RuKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDUnRwU2VuZGVyLEEuZ2V0Q2FwYWJpbGl0aWVzLFwiZ2V0Q2FwYWJpbGl0aWVzXCIsITEsYS5GRUFUVVJFX21zX3RlYW1zX3BzdG4pLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENSdHBTZW5kZXIsQS5nZXRQYXJhbWV0ZXJzLFwiZ2V0UGFyYW1ldGVyc1wiLCExLGEuRkVBVFVSRV9tc190ZWFtc19wc3RuKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDUnRwU2VuZGVyLEEuc2V0UGFyYW1ldGVycyxcInNldFBhcmFtZXRlcnNcIiwhMSxcbmEuRkVBVFVSRV9tc190ZWFtc19wc3RuKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDUnRwU2VuZGVyLEEucmVwbGFjZVRyYWNrLFwicmVwbGFjZVRyYWNrXCIsITEsYS5GRUFUVVJFX21zX3RlYW1zX3BzdG4pLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENSdHBTZW5kZXIsQS5nZXRTdGF0cyxcImdldFN0YXRzXCIsITEsYS5GRUFUVVJFX21zX3RlYW1zX3BzdG4pLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENSdHBTZW5kZXIsQS5zZXRTdHJlYW1zLFwic2V0U3RyZWFtc1wiLCExLGEuRkVBVFVSRV9tc190ZWFtc19wc3RuKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDUnRwU2VuZGVyLEEuZ2V0Q2FwYWJpbGl0aWVzX3YyLFwiZ2V0Q2FwYWJpbGl0aWVzX3YyXCIsITEsYS5GRUFUVVJFX21zX3RlYW1zX3dlYnJ0Y18xZG90MCldKSxuZXcgYi5XZWJycGNDbGFzc0luZm8oYy5SVENEdGxzVHJhbnNwb3J0LFwiUlRDRHRsc1RyYW5zcG9ydFwiLFtuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDRHRsc1RyYW5zcG9ydCxcbnkuY3RvcixcImN0b3JcIiwhMSxhLkZFQVRVUkVfbXNfdGVhbXNfcHN0biksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ0R0bHNUcmFuc3BvcnQseS50cmFuc3BvcnQsXCJ0cmFuc3BvcnRcIiwhMCxhLkZFQVRVUkVfbXNfdGVhbXNfcHN0biksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ0R0bHNUcmFuc3BvcnQseS5zdGF0ZSxcInN0YXRlXCIsITAsYS5GRUFUVVJFX21zX3RlYW1zX3BzdG4pLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENEdGxzVHJhbnNwb3J0LHkuZ2V0UmVtb3RlQ2VydGlmaWNhdGVzLFwiZ2V0UmVtb3RlQ2VydGlmaWNhdGVzXCIsITEsYS5GRUFUVVJFX21zX3RlYW1zX3BzdG4pLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENEdGxzVHJhbnNwb3J0LHkub25zdGF0ZWNoYW5nZSxcIm9uc3RhdGVjaGFuZ2VcIiwhMCxhLkZFQVRVUkVfbXNfdGVhbXNfcHN0biksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ0R0bHNUcmFuc3BvcnQseS5vbmVycm9yLFwib25lcnJvclwiLFxuITAsYS5GRUFUVVJFX21zX3RlYW1zX3BzdG4pXSksbmV3IGIuV2VicnBjQ2xhc3NJbmZvKGMuUlRDSWNlVHJhbnNwb3J0LFwiUlRDSWNlVHJhbnNwb3J0XCIsW25ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENJY2VUcmFuc3BvcnQsRS5jdG9yLFwiY3RvclwiLCExLGEuRkVBVFVSRV9tc190ZWFtc19wc3RuKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDSWNlVHJhbnNwb3J0LEUucm9sZSxcInJvbGVcIiwhMCxhLkZFQVRVUkVfbXNfdGVhbXNfcHN0biksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ0ljZVRyYW5zcG9ydCxFLmNvbXBvbmVudCxcImNvbXBvbmVudFwiLCEwLGEuRkVBVFVSRV9tc190ZWFtc19wc3RuKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDSWNlVHJhbnNwb3J0LEUuc3RhdGUsXCJzdGF0ZVwiLCEwLGEuRkVBVFVSRV9tc190ZWFtc19wc3RuKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDSWNlVHJhbnNwb3J0LEUuZ2F0aGVyaW5nU3RhdGUsXCJnYXRoZXJpbmdTdGF0ZVwiLFxuITAsYS5GRUFUVVJFX21zX3RlYW1zX3BzdG4pLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENJY2VUcmFuc3BvcnQsRS5sb2NhbGNhbmRpZGF0ZXMsXCJsb2NhbGNhbmRpZGF0ZXNcIiwhMCxhLkZFQVRVUkVfbXNfdGVhbXNfcHN0biksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ0ljZVRyYW5zcG9ydCxFLnJlbW90ZWNhbmRpZGF0ZXMsXCJyZW1vdGVjYW5kaWRhdGVzXCIsITAsYS5GRUFUVVJFX21zX3RlYW1zX3BzdG4pLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENJY2VUcmFuc3BvcnQsRS5vbnN0YXRlY2hhbmdlLFwib25zdGF0ZWNoYW5nZVwiLCEwLGEuRkVBVFVSRV9tc190ZWFtc19wc3RuKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDSWNlVHJhbnNwb3J0LEUub25nYXRoZXJpbmdzdGF0ZWNoYW5nZSxcIm9uZ2F0aGVyaW5nc3RhdGVjaGFuZ2VcIiwhMCxhLkZFQVRVUkVfbXNfdGVhbXNfcHN0biksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ0ljZVRyYW5zcG9ydCxcbkUub25zZWxlY3RlZGNhbmRpZGF0ZXBhaXJjaGFuZ2UsXCJvbnNlbGVjdGVkY2FuZGlkYXRlcGFpcmNoYW5nZVwiLCEwLGEuRkVBVFVSRV9tc190ZWFtc19wc3RuKV0pLG5ldyBiLldlYnJwY0NsYXNzSW5mbyhjLlJUQ0RUTUZTZW5kZXIsXCJSVENEVE1GU2VuZGVyXCIsW25ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENEVE1GU2VuZGVyLHUuY3RvcixcImN0b3JcIiwhMSxhLkZFQVRVUkVfbXNfdGVhbXNfcHN0biksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ0RUTUZTZW5kZXIsdS5pbnNlcnREVE1GLFwiaW5zZXJ0RFRNRlwiLCExLGEuRkVBVFVSRV9tc190ZWFtc19wc3RuKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDRFRNRlNlbmRlcix1Lm9udG9uZWNoYW5nZSxcIm9udG9uZWNoYW5nZVwiLCEwLGEuRkVBVFVSRV9tc190ZWFtc19wc3RuKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDRFRNRlNlbmRlcix1LmNhbkluc2VydERUTUYsXCJjYW5JbnNlcnREVE1GXCIsITAsYS5GRUFUVVJFX21zX3RlYW1zX3BzdG4pLFxubmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ0RUTUZTZW5kZXIsdS50b25lQnVmZmVyLFwidG9uZUJ1ZmZlclwiLCEwLGEuRkVBVFVSRV9tc190ZWFtc19wc3RuKV0pLG5ldyBiLldlYnJwY0NsYXNzSW5mbyhjLlJUQ0RUTUZUb25lQ2hhbmdlRXZlbnQsXCJSVENEVE1GVG9uZUNoYW5nZUV2ZW50XCIsW25ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENEVE1GVG9uZUNoYW5nZUV2ZW50LHEuY3RvcixcImN0b3JcIiwhMSxhLkZFQVRVUkVfbXNfdGVhbXNfcHN0biksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ0RUTUZUb25lQ2hhbmdlRXZlbnQscS50b25lLFwidG9uZVwiLCEwLGEuRkVBVFVSRV9tc190ZWFtc19wc3RuKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDRFRNRlRvbmVDaGFuZ2VFdmVudCxxLnRvbmVfYnVmZmVyLFwidG9uZV9idWZmZXJcIiwhMCxhLkZFQVRVUkVfbXNfdGVhbXNfcHN0bildKSxuZXcgYi5XZWJycGNDbGFzc0luZm8oYy5SVENJY2VDYW5kaWRhdGVQYWlyLFwiUlRDSWNlQ2FuZGlkYXRlUGFpclwiLFxuW25ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENJY2VDYW5kaWRhdGVQYWlyLHcuY3RvcixcImN0b3JcIiwhMSxhLkZFQVRVUkVfbXNfdGVhbXNfcHN0biksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ0ljZUNhbmRpZGF0ZVBhaXIsdy5sb2NhbCxcImxvY2FsXCIsITAsYS5GRUFUVVJFX21zX3RlYW1zX3BzdG4pLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENJY2VDYW5kaWRhdGVQYWlyLHcucmVtb3RlLFwicmVtb3RlXCIsITAsYS5GRUFUVVJFX21zX3RlYW1zX3BzdG4pXSksbmV3IGIuV2VicnBjQ2xhc3NJbmZvKGMuUlRDUnRwVHJhbnNjZWl2ZXIsXCJSVENSdHBUcmFuc2NlaXZlclwiLFtuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDUnRwVHJhbnNjZWl2ZXIsei5jdG9yLFwiY3RvclwiLCExLGEuRkVBVFVSRV9tc190ZWFtc193ZWJydGNfMWRvdDApLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENSdHBUcmFuc2NlaXZlcix6Lm1pZCxcIm1pZFwiLCEwLGEuRkVBVFVSRV9tc190ZWFtc193ZWJydGNfMWRvdDApLFxubmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1J0cFRyYW5zY2VpdmVyLHouc2VuZGVyLFwic2VuZGVyXCIsITAsYS5GRUFUVVJFX21zX3RlYW1zX3dlYnJ0Y18xZG90MCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1J0cFRyYW5zY2VpdmVyLHoucmVjZWl2ZXIsXCJyZWNlaXZlclwiLCEwLGEuRkVBVFVSRV9tc190ZWFtc193ZWJydGNfMWRvdDApLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENSdHBUcmFuc2NlaXZlcix6LmRpcmVjdGlvbixcImRpcmVjdGlvblwiLCEwLGEuRkVBVFVSRV9tc190ZWFtc193ZWJydGNfMWRvdDApLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENSdHBUcmFuc2NlaXZlcix6LmN1cnJlbnREaXJlY3Rpb24sXCJjdXJyZW50RGlyZWN0aW9uXCIsITAsYS5GRUFUVVJFX21zX3RlYW1zX3dlYnJ0Y18xZG90MCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1J0cFRyYW5zY2VpdmVyLHouc3RvcCxcInN0b3BcIiwhMSxhLkZFQVRVUkVfbXNfdGVhbXNfd2VicnRjXzFkb3QwKSxcbm5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENSdHBUcmFuc2NlaXZlcix6LnNldENvZGVjUHJlZmVyZW5jZXMsXCJzZXRDb2RlY1ByZWZlcmVuY2VzXCIsITEsYS5GRUFUVVJFX21zX3RlYW1zX3dlYnJ0Y18xZG90MCldKSxuZXcgYi5XZWJycGNDbGFzc0luZm8oYy5SVENEYXRhQ2hhbm5lbCxcIlJUQ0RhdGFDaGFubmVsXCIsW25ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENEYXRhQ2hhbm5lbCxDLmN0b3IsXCJjdG9yXCIsITEsYS5GRUFUVVJFX21zX3RlYW1zX2RhdGFfY2hhbm5lbCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ0RhdGFDaGFubmVsLEMubGFiZWwsXCJsYWJlbFwiLCEwLGEuRkVBVFVSRV9tc190ZWFtc19kYXRhX2NoYW5uZWwpLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENEYXRhQ2hhbm5lbCxDLm9yZGVyZWQsXCJvcmRlcmVkXCIsITAsYS5GRUFUVVJFX21zX3RlYW1zX2RhdGFfY2hhbm5lbCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ0RhdGFDaGFubmVsLEMubWF4UGFja2V0TGlmZVRpbWUsXG5cIm1heFBhY2tldExpZmVUaW1lXCIsITAsYS5GRUFUVVJFX21zX3RlYW1zX2RhdGFfY2hhbm5lbCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ0RhdGFDaGFubmVsLEMubWF4UmV0cmFuc21pdHMsXCJtYXhSZXRyYW5zbWl0c1wiLCEwLGEuRkVBVFVSRV9tc190ZWFtc19kYXRhX2NoYW5uZWwpLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENEYXRhQ2hhbm5lbCxDLnByb3RvY29sLFwicHJvdG9jb2xcIiwhMCxhLkZFQVRVUkVfbXNfdGVhbXNfZGF0YV9jaGFubmVsKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDRGF0YUNoYW5uZWwsQy5uZWdvdGlhdGVkLFwibmVnb3RpYXRlZFwiLCEwLGEuRkVBVFVSRV9tc190ZWFtc19kYXRhX2NoYW5uZWwpLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENEYXRhQ2hhbm5lbCxDLmlkLFwiaWRcIiwhMCxhLkZFQVRVUkVfbXNfdGVhbXNfZGF0YV9jaGFubmVsKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDRGF0YUNoYW5uZWwsQy5yZWFkeVN0YXRlLFxuXCJyZWFkeVN0YXRlXCIsITAsYS5GRUFUVVJFX21zX3RlYW1zX2RhdGFfY2hhbm5lbCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ0RhdGFDaGFubmVsLEMuYnVmZmVyZWRBbW91bnQsXCJidWZmZXJlZEFtb3VudFwiLCEwLGEuRkVBVFVSRV9tc190ZWFtc19kYXRhX2NoYW5uZWwpLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENEYXRhQ2hhbm5lbCxDLmJ1ZmZlcmVkQW1vdW50TG93VGhyZXNob2xkLFwiYnVmZmVyZWRBbW91bnRMb3dUaHJlc2hvbGRcIiwhMCxhLkZFQVRVUkVfbXNfdGVhbXNfZGF0YV9jaGFubmVsKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDRGF0YUNoYW5uZWwsQy5vbm9wZW4sXCJvbm9wZW5cIiwhMCxhLkZFQVRVUkVfbXNfdGVhbXNfZGF0YV9jaGFubmVsKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDRGF0YUNoYW5uZWwsQy5vbmJ1ZmZlcmVkYW1vdW50bG93LFwib25idWZmZXJlZGFtb3VudGxvd1wiLCEwLGEuRkVBVFVSRV9tc190ZWFtc19kYXRhX2NoYW5uZWwpLFxubmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ0RhdGFDaGFubmVsLEMub25lcnJvcixcIm9uZXJyb3JcIiwhMCxhLkZFQVRVUkVfbXNfdGVhbXNfZGF0YV9jaGFubmVsKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDRGF0YUNoYW5uZWwsQy5vbmNsb3NpbmcsXCJvbmNsb3NpbmdcIiwhMCxhLkZFQVRVUkVfbXNfdGVhbXNfZGF0YV9jaGFubmVsKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDRGF0YUNoYW5uZWwsQy5vbmNsb3NlLFwib25jbG9zZVwiLCEwLGEuRkVBVFVSRV9tc190ZWFtc19kYXRhX2NoYW5uZWwpLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENEYXRhQ2hhbm5lbCxDLm9ubWVzc2FnZSxcIm9ubWVzc2FnZVwiLCEwLGEuRkVBVFVSRV9tc190ZWFtc19kYXRhX2NoYW5uZWwpLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENEYXRhQ2hhbm5lbCxDLmNsb3NlLFwiY2xvc2VcIiwhMSxhLkZFQVRVUkVfbXNfdGVhbXNfZGF0YV9jaGFubmVsKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDRGF0YUNoYW5uZWwsXG5DLnNlbmRfdGV4dCxcInNlbmRfdGV4dFwiLCExLGEuRkVBVFVSRV9tc190ZWFtc19kYXRhX2NoYW5uZWwpLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENEYXRhQ2hhbm5lbCxDLnNlbmRfYmluYXJ5LFwic2VuZF9iaW5hcnlcIiwhMSxhLkZFQVRVUkVfbXNfdGVhbXNfZGF0YV9jaGFubmVsKV0pLG5ldyBiLldlYnJwY0NsYXNzSW5mbyhjLlJUQ1NjdHBUcmFuc3BvcnQsXCJSVENTY3RwVHJhbnNwb3J0XCIsW25ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENTY3RwVHJhbnNwb3J0LEYuY3RvcixcImN0b3JcIiwhMSxhLkZFQVRVUkVfbXNfdGVhbXNfZGF0YV9jaGFubmVsKSxuZXcgYi5XZWJycGNNZXRob2RJbmZvKGMuUlRDU2N0cFRyYW5zcG9ydCxGLnRyYW5zcG9ydCxcInRyYW5zcG9ydFwiLCEwLGEuRkVBVFVSRV9tc190ZWFtc19kYXRhX2NoYW5uZWwpLG5ldyBiLldlYnJwY01ldGhvZEluZm8oYy5SVENTY3RwVHJhbnNwb3J0LEYuc3RhdGUsXCJzdGF0ZVwiLCEwLGEuRkVBVFVSRV9tc190ZWFtc19kYXRhX2NoYW5uZWwpLFxubmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1NjdHBUcmFuc3BvcnQsRi5tYXhNZXNzYWdlU2l6ZSxcIm1heE1lc3NhZ2VTaXplXCIsITAsYS5GRUFUVVJFX21zX3RlYW1zX2RhdGFfY2hhbm5lbCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1NjdHBUcmFuc3BvcnQsRi5tYXhDaGFubmVscyxcIm1heENoYW5uZWxzXCIsITAsYS5GRUFUVVJFX21zX3RlYW1zX2RhdGFfY2hhbm5lbCksbmV3IGIuV2VicnBjTWV0aG9kSW5mbyhjLlJUQ1NjdHBUcmFuc3BvcnQsRi5vbnN0YXRlY2hhbmdlLFwib25zdGF0ZWNoYW5nZVwiLCEwLGEuRkVBVFVSRV9tc190ZWFtc19kYXRhX2NoYW5uZWwpXSldKX0sNTQ1OmZ1bmN0aW9uKGIsYSxjKXt2YXIgZD10aGlzJiZ0aGlzLl9fc3ByZWFkQXJyYXlzfHxmdW5jdGlvbigpe2Zvcih2YXIgYT0wLGI9MCxjPWFyZ3VtZW50cy5sZW5ndGg7YjxjO2IrKylhKz1hcmd1bWVudHNbYl0ubGVuZ3RoO2Zvcih2YXIgYT1BcnJheShhKSxkPTAsYj0wO2I8YztiKyspZm9yKHZhciBlPVxuYXJndW1lbnRzW2JdLGs9MCxtPWUubGVuZ3RoO2s8bTtrKyssZCsrKWFbZF09ZVtrXTtyZXR1cm4gYX07T2JqZWN0LmRlZmluZVByb3BlcnR5KGEsXCJfX2VzTW9kdWxlXCIse3ZhbHVlOiEwfSk7dmFyIGU9Yyg1NTApLGs7KGZ1bmN0aW9uKGEpe2FbYS5yZXE9MF09XCJyZXFcIjthW2EucmVwbHk9MV09XCJyZXBseVwiO2FbYS5ldmVudF9yZXE9Ml09XCJldmVudF9yZXFcIjthW2EuZXZlbnRfcmVwbHk9M109XCJldmVudF9yZXBseVwifSkoaz1hLndzX21zZ190eXBlX3R8fChhLndzX21zZ190eXBlX3Q9e30pKTtiPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gYSgpe31hLmNyZWF0ZU1lc3NhZ2VCeWlkPWZ1bmN0aW9uKGEsYixjLGssbixtKXtmb3IodmFyIHI9W10sQj02O0I8YXJndW1lbnRzLmxlbmd0aDtCKyspcltCLTZdPWFyZ3VtZW50c1tCXTsoQj1lLldlYnJwY0NsYXNzTGliSW5mb1V0aWwuZ2V0TWV0aG9kQnlpZChrLG4pKSYmQi5pc3Byb3B8fChhPSExKTtyZXR1cm4gdGhpcy5jcmVhdGVNZXNzYWdlLmFwcGx5KHRoaXMsXG5kKFtjLGEsYixrLG4sbV0scikpfTthLmNyZWF0ZU1lc3NhZ2U9ZnVuY3Rpb24oYSxiLGMsZSxrLG0pe2Zvcih2YXIgbj1bXSxyPTY7cjxhcmd1bWVudHMubGVuZ3RoO3IrKyluW3ItNl09YXJndW1lbnRzW3JdO3JldHVybnt2Olwid2VicnRjXCIsaGRyOnt2ZXJzaW9uOnRoaXMuX3ZlcnNpb24sbXNnX3R5cGU6dGhpcy5nZXRNc2dUeXBlKGEpLG1vZGlmaWVyOmIsZGVzdHJveTpjLHByb2M6e2lpZDplLG1ldGhvZGlkOmt9fSxvYmpyZWY6e29pZDptfSxwYXJhbXM6ZChuKX19O2EuZ2V0TXNnVHlwZT1mdW5jdGlvbihhKXt2YXIgYj1cIlwiO3N3aXRjaChhKXtkZWZhdWx0OmI9XCJyZXFcIjticmVhaztjYXNlIGsucmVwbHk6Yj1cInJlcGx5XCI7YnJlYWs7Y2FzZSBrLmV2ZW50X3JlcTpiPVwiZXZlbnQtcmVxXCI7YnJlYWs7Y2FzZSBrLmV2ZW50X3JlcGx5OmI9XCJldmVudC1yZXBseVwifXJldHVybiBifTthLl92ZXJzaW9uPTE7cmV0dXJuIGF9KCk7YS5Xc0pzb25VdGlsPWJ9fSxrPXt9O3JldHVybiBkKDMwNyl9KCl9KTtcbiIsIm1vZHVsZS5leHBvcnRzID0geyBcImRlZmF1bHRcIjogcmVxdWlyZShcImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvY3JlYXRlXCIpLCBfX2VzTW9kdWxlOiB0cnVlIH07IiwibW9kdWxlLmV4cG9ydHMgPSB7IFwiZGVmYXVsdFwiOiByZXF1aXJlKFwiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9kZWZpbmUtcHJvcGVydHlcIiksIF9fZXNNb2R1bGU6IHRydWUgfTsiLCJtb2R1bGUuZXhwb3J0cyA9IHsgXCJkZWZhdWx0XCI6IHJlcXVpcmUoXCJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2dldC1vd24tcHJvcGVydHktZGVzY3JpcHRvclwiKSwgX19lc01vZHVsZTogdHJ1ZSB9OyIsIm1vZHVsZS5leHBvcnRzID0geyBcImRlZmF1bHRcIjogcmVxdWlyZShcImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvZ2V0LXByb3RvdHlwZS1vZlwiKSwgX19lc01vZHVsZTogdHJ1ZSB9OyIsIm1vZHVsZS5leHBvcnRzID0geyBcImRlZmF1bHRcIjogcmVxdWlyZShcImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3Qvc2V0LXByb3RvdHlwZS1vZlwiKSwgX19lc01vZHVsZTogdHJ1ZSB9OyIsIm1vZHVsZS5leHBvcnRzID0geyBcImRlZmF1bHRcIjogcmVxdWlyZShcImNvcmUtanMvbGlicmFyeS9mbi9wcm9taXNlXCIpLCBfX2VzTW9kdWxlOiB0cnVlIH07IiwibW9kdWxlLmV4cG9ydHMgPSB7IFwiZGVmYXVsdFwiOiByZXF1aXJlKFwiY29yZS1qcy9saWJyYXJ5L2ZuL3N5bWJvbFwiKSwgX19lc01vZHVsZTogdHJ1ZSB9OyIsIm1vZHVsZS5leHBvcnRzID0geyBcImRlZmF1bHRcIjogcmVxdWlyZShcImNvcmUtanMvbGlicmFyeS9mbi9zeW1ib2wvaXRlcmF0b3JcIiksIF9fZXNNb2R1bGU6IHRydWUgfTsiLCJcInVzZSBzdHJpY3RcIjtcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxudmFyIF9wcm9taXNlID0gcmVxdWlyZShcIi4uL2NvcmUtanMvcHJvbWlzZVwiKTtcblxudmFyIF9wcm9taXNlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3Byb21pc2UpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfVxuXG5leHBvcnRzLmRlZmF1bHQgPSBmdW5jdGlvbiAoZm4pIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZ2VuID0gZm4uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICByZXR1cm4gbmV3IF9wcm9taXNlMi5kZWZhdWx0KGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIGZ1bmN0aW9uIHN0ZXAoa2V5LCBhcmcpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7XG4gICAgICAgICAgdmFyIHZhbHVlID0gaW5mby52YWx1ZTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpbmZvLmRvbmUpIHtcbiAgICAgICAgICByZXNvbHZlKHZhbHVlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gX3Byb21pc2UyLmRlZmF1bHQucmVzb2x2ZSh2YWx1ZSkudGhlbihmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIHN0ZXAoXCJuZXh0XCIsIHZhbHVlKTtcbiAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBzdGVwKFwidGhyb3dcIiwgZXJyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gc3RlcChcIm5leHRcIik7XG4gICAgfSk7XG4gIH07XG59OyIsIlwidXNlIHN0cmljdFwiO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG5leHBvcnRzLmRlZmF1bHQgPSBmdW5jdGlvbiAoaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7XG4gIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTtcbiAgfVxufTsiLCJcInVzZSBzdHJpY3RcIjtcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxudmFyIF9kZWZpbmVQcm9wZXJ0eSA9IHJlcXVpcmUoXCIuLi9jb3JlLWpzL29iamVjdC9kZWZpbmUtcHJvcGVydHlcIik7XG5cbnZhciBfZGVmaW5lUHJvcGVydHkyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfZGVmaW5lUHJvcGVydHkpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfVxuXG5leHBvcnRzLmRlZmF1bHQgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07XG4gICAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7XG4gICAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7XG4gICAgICBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlO1xuICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIuZGVmYXVsdCkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHtcbiAgICBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpO1xuICAgIGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpO1xuICAgIHJldHVybiBDb25zdHJ1Y3RvcjtcbiAgfTtcbn0oKTsiLCJcInVzZSBzdHJpY3RcIjtcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxudmFyIF9nZXRQcm90b3R5cGVPZiA9IHJlcXVpcmUoXCIuLi9jb3JlLWpzL29iamVjdC9nZXQtcHJvdG90eXBlLW9mXCIpO1xuXG52YXIgX2dldFByb3RvdHlwZU9mMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2dldFByb3RvdHlwZU9mKTtcblxudmFyIF9nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPSByZXF1aXJlKFwiLi4vY29yZS1qcy9vYmplY3QvZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yXCIpO1xuXG52YXIgX2dldE93blByb3BlcnR5RGVzY3JpcHRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfVxuXG5leHBvcnRzLmRlZmF1bHQgPSBmdW5jdGlvbiBnZXQob2JqZWN0LCBwcm9wZXJ0eSwgcmVjZWl2ZXIpIHtcbiAgaWYgKG9iamVjdCA9PT0gbnVsbCkgb2JqZWN0ID0gRnVuY3Rpb24ucHJvdG90eXBlO1xuICB2YXIgZGVzYyA9ICgwLCBfZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yMi5kZWZhdWx0KShvYmplY3QsIHByb3BlcnR5KTtcblxuICBpZiAoZGVzYyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgdmFyIHBhcmVudCA9ICgwLCBfZ2V0UHJvdG90eXBlT2YyLmRlZmF1bHQpKG9iamVjdCk7XG5cbiAgICBpZiAocGFyZW50ID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZ2V0KHBhcmVudCwgcHJvcGVydHksIHJlY2VpdmVyKTtcbiAgICB9XG4gIH0gZWxzZSBpZiAoXCJ2YWx1ZVwiIGluIGRlc2MpIHtcbiAgICByZXR1cm4gZGVzYy52YWx1ZTtcbiAgfSBlbHNlIHtcbiAgICB2YXIgZ2V0dGVyID0gZGVzYy5nZXQ7XG5cbiAgICBpZiAoZ2V0dGVyID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIGdldHRlci5jYWxsKHJlY2VpdmVyKTtcbiAgfVxufTsiLCJcInVzZSBzdHJpY3RcIjtcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxudmFyIF9zZXRQcm90b3R5cGVPZiA9IHJlcXVpcmUoXCIuLi9jb3JlLWpzL29iamVjdC9zZXQtcHJvdG90eXBlLW9mXCIpO1xuXG52YXIgX3NldFByb3RvdHlwZU9mMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3NldFByb3RvdHlwZU9mKTtcblxudmFyIF9jcmVhdGUgPSByZXF1aXJlKFwiLi4vY29yZS1qcy9vYmplY3QvY3JlYXRlXCIpO1xuXG52YXIgX2NyZWF0ZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9jcmVhdGUpO1xuXG52YXIgX3R5cGVvZjIgPSByZXF1aXJlKFwiLi4vaGVscGVycy90eXBlb2ZcIik7XG5cbnZhciBfdHlwZW9mMyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3R5cGVvZjIpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfVxuXG5leHBvcnRzLmRlZmF1bHQgPSBmdW5jdGlvbiAoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHtcbiAgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSBcImZ1bmN0aW9uXCIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90IFwiICsgKHR5cGVvZiBzdXBlckNsYXNzID09PSBcInVuZGVmaW5lZFwiID8gXCJ1bmRlZmluZWRcIiA6ICgwLCBfdHlwZW9mMy5kZWZhdWx0KShzdXBlckNsYXNzKSkpO1xuICB9XG5cbiAgc3ViQ2xhc3MucHJvdG90eXBlID0gKDAsIF9jcmVhdGUyLmRlZmF1bHQpKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHtcbiAgICBjb25zdHJ1Y3Rvcjoge1xuICAgICAgdmFsdWU6IHN1YkNsYXNzLFxuICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH1cbiAgfSk7XG4gIGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2YyLmRlZmF1bHQgPyAoMCwgX3NldFByb3RvdHlwZU9mMi5kZWZhdWx0KShzdWJDbGFzcywgc3VwZXJDbGFzcykgOiBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzO1xufTsiLCJcInVzZSBzdHJpY3RcIjtcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxudmFyIF90eXBlb2YyID0gcmVxdWlyZShcIi4uL2hlbHBlcnMvdHlwZW9mXCIpO1xuXG52YXIgX3R5cGVvZjMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF90eXBlb2YyKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxuZXhwb3J0cy5kZWZhdWx0ID0gZnVuY3Rpb24gKHNlbGYsIGNhbGwpIHtcbiAgaWYgKCFzZWxmKSB7XG4gICAgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKFwidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkXCIpO1xuICB9XG5cbiAgcmV0dXJuIGNhbGwgJiYgKCh0eXBlb2YgY2FsbCA9PT0gXCJ1bmRlZmluZWRcIiA/IFwidW5kZWZpbmVkXCIgOiAoMCwgX3R5cGVvZjMuZGVmYXVsdCkoY2FsbCkpID09PSBcIm9iamVjdFwiIHx8IHR5cGVvZiBjYWxsID09PSBcImZ1bmN0aW9uXCIpID8gY2FsbCA6IHNlbGY7XG59OyIsIlwidXNlIHN0cmljdFwiO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuXG52YXIgX2l0ZXJhdG9yID0gcmVxdWlyZShcIi4uL2NvcmUtanMvc3ltYm9sL2l0ZXJhdG9yXCIpO1xuXG52YXIgX2l0ZXJhdG9yMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2l0ZXJhdG9yKTtcblxudmFyIF9zeW1ib2wgPSByZXF1aXJlKFwiLi4vY29yZS1qcy9zeW1ib2xcIik7XG5cbnZhciBfc3ltYm9sMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3N5bWJvbCk7XG5cbnZhciBfdHlwZW9mID0gdHlwZW9mIF9zeW1ib2wyLmRlZmF1bHQgPT09IFwiZnVuY3Rpb25cIiAmJiB0eXBlb2YgX2l0ZXJhdG9yMi5kZWZhdWx0ID09PSBcInN5bWJvbFwiID8gZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfSA6IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgX3N5bWJvbDIuZGVmYXVsdCA9PT0gXCJmdW5jdGlvblwiICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gX3N5bWJvbDIuZGVmYXVsdCAmJiBvYmogIT09IF9zeW1ib2wyLmRlZmF1bHQucHJvdG90eXBlID8gXCJzeW1ib2xcIiA6IHR5cGVvZiBvYmo7IH07XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9XG5cbmV4cG9ydHMuZGVmYXVsdCA9IHR5cGVvZiBfc3ltYm9sMi5kZWZhdWx0ID09PSBcImZ1bmN0aW9uXCIgJiYgX3R5cGVvZihfaXRlcmF0b3IyLmRlZmF1bHQpID09PSBcInN5bWJvbFwiID8gZnVuY3Rpb24gKG9iaikge1xuICByZXR1cm4gdHlwZW9mIG9iaiA9PT0gXCJ1bmRlZmluZWRcIiA/IFwidW5kZWZpbmVkXCIgOiBfdHlwZW9mKG9iaik7XG59IDogZnVuY3Rpb24gKG9iaikge1xuICByZXR1cm4gb2JqICYmIHR5cGVvZiBfc3ltYm9sMi5kZWZhdWx0ID09PSBcImZ1bmN0aW9uXCIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBfc3ltYm9sMi5kZWZhdWx0ICYmIG9iaiAhPT0gX3N5bWJvbDIuZGVmYXVsdC5wcm90b3R5cGUgPyBcInN5bWJvbFwiIDogdHlwZW9mIG9iaiA9PT0gXCJ1bmRlZmluZWRcIiA/IFwidW5kZWZpbmVkXCIgOiBfdHlwZW9mKG9iaik7XG59OyIsIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE0LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKi9cblxuLy8gVGhpcyBtZXRob2Qgb2Ygb2J0YWluaW5nIGEgcmVmZXJlbmNlIHRvIHRoZSBnbG9iYWwgb2JqZWN0IG5lZWRzIHRvIGJlXG4vLyBrZXB0IGlkZW50aWNhbCB0byB0aGUgd2F5IGl0IGlzIG9idGFpbmVkIGluIHJ1bnRpbWUuanNcbnZhciBnID0gKGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcyB9KSgpIHx8IEZ1bmN0aW9uKFwicmV0dXJuIHRoaXNcIikoKTtcblxuLy8gVXNlIGBnZXRPd25Qcm9wZXJ0eU5hbWVzYCBiZWNhdXNlIG5vdCBhbGwgYnJvd3NlcnMgc3VwcG9ydCBjYWxsaW5nXG4vLyBgaGFzT3duUHJvcGVydHlgIG9uIHRoZSBnbG9iYWwgYHNlbGZgIG9iamVjdCBpbiBhIHdvcmtlci4gU2VlICMxODMuXG52YXIgaGFkUnVudGltZSA9IGcucmVnZW5lcmF0b3JSdW50aW1lICYmXG4gIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGcpLmluZGV4T2YoXCJyZWdlbmVyYXRvclJ1bnRpbWVcIikgPj0gMDtcblxuLy8gU2F2ZSB0aGUgb2xkIHJlZ2VuZXJhdG9yUnVudGltZSBpbiBjYXNlIGl0IG5lZWRzIHRvIGJlIHJlc3RvcmVkIGxhdGVyLlxudmFyIG9sZFJ1bnRpbWUgPSBoYWRSdW50aW1lICYmIGcucmVnZW5lcmF0b3JSdW50aW1lO1xuXG4vLyBGb3JjZSByZWV2YWx1dGF0aW9uIG9mIHJ1bnRpbWUuanMuXG5nLnJlZ2VuZXJhdG9yUnVudGltZSA9IHVuZGVmaW5lZDtcblxubW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKFwiLi9ydW50aW1lXCIpO1xuXG5pZiAoaGFkUnVudGltZSkge1xuICAvLyBSZXN0b3JlIHRoZSBvcmlnaW5hbCBydW50aW1lLlxuICBnLnJlZ2VuZXJhdG9yUnVudGltZSA9IG9sZFJ1bnRpbWU7XG59IGVsc2Uge1xuICAvLyBSZW1vdmUgdGhlIGdsb2JhbCBwcm9wZXJ0eSBhZGRlZCBieSBydW50aW1lLmpzLlxuICB0cnkge1xuICAgIGRlbGV0ZSBnLnJlZ2VuZXJhdG9yUnVudGltZTtcbiAgfSBjYXRjaChlKSB7XG4gICAgZy5yZWdlbmVyYXRvclJ1bnRpbWUgPSB1bmRlZmluZWQ7XG4gIH1cbn1cbiIsIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE0LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKi9cblxuIShmdW5jdGlvbihnbG9iYWwpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgdmFyIE9wID0gT2JqZWN0LnByb3RvdHlwZTtcbiAgdmFyIGhhc093biA9IE9wLmhhc093blByb3BlcnR5O1xuICB2YXIgdW5kZWZpbmVkOyAvLyBNb3JlIGNvbXByZXNzaWJsZSB0aGFuIHZvaWQgMC5cbiAgdmFyICRTeW1ib2wgPSB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgPyBTeW1ib2wgOiB7fTtcbiAgdmFyIGl0ZXJhdG9yU3ltYm9sID0gJFN5bWJvbC5pdGVyYXRvciB8fCBcIkBAaXRlcmF0b3JcIjtcbiAgdmFyIGFzeW5jSXRlcmF0b3JTeW1ib2wgPSAkU3ltYm9sLmFzeW5jSXRlcmF0b3IgfHwgXCJAQGFzeW5jSXRlcmF0b3JcIjtcbiAgdmFyIHRvU3RyaW5nVGFnU3ltYm9sID0gJFN5bWJvbC50b1N0cmluZ1RhZyB8fCBcIkBAdG9TdHJpbmdUYWdcIjtcblxuICB2YXIgaW5Nb2R1bGUgPSB0eXBlb2YgbW9kdWxlID09PSBcIm9iamVjdFwiO1xuICB2YXIgcnVudGltZSA9IGdsb2JhbC5yZWdlbmVyYXRvclJ1bnRpbWU7XG4gIGlmIChydW50aW1lKSB7XG4gICAgaWYgKGluTW9kdWxlKSB7XG4gICAgICAvLyBJZiByZWdlbmVyYXRvclJ1bnRpbWUgaXMgZGVmaW5lZCBnbG9iYWxseSBhbmQgd2UncmUgaW4gYSBtb2R1bGUsXG4gICAgICAvLyBtYWtlIHRoZSBleHBvcnRzIG9iamVjdCBpZGVudGljYWwgdG8gcmVnZW5lcmF0b3JSdW50aW1lLlxuICAgICAgbW9kdWxlLmV4cG9ydHMgPSBydW50aW1lO1xuICAgIH1cbiAgICAvLyBEb24ndCBib3RoZXIgZXZhbHVhdGluZyB0aGUgcmVzdCBvZiB0aGlzIGZpbGUgaWYgdGhlIHJ1bnRpbWUgd2FzXG4gICAgLy8gYWxyZWFkeSBkZWZpbmVkIGdsb2JhbGx5LlxuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIERlZmluZSB0aGUgcnVudGltZSBnbG9iYWxseSAoYXMgZXhwZWN0ZWQgYnkgZ2VuZXJhdGVkIGNvZGUpIGFzIGVpdGhlclxuICAvLyBtb2R1bGUuZXhwb3J0cyAoaWYgd2UncmUgaW4gYSBtb2R1bGUpIG9yIGEgbmV3LCBlbXB0eSBvYmplY3QuXG4gIHJ1bnRpbWUgPSBnbG9iYWwucmVnZW5lcmF0b3JSdW50aW1lID0gaW5Nb2R1bGUgPyBtb2R1bGUuZXhwb3J0cyA6IHt9O1xuXG4gIGZ1bmN0aW9uIHdyYXAoaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZiwgdHJ5TG9jc0xpc3QpIHtcbiAgICAvLyBJZiBvdXRlckZuIHByb3ZpZGVkIGFuZCBvdXRlckZuLnByb3RvdHlwZSBpcyBhIEdlbmVyYXRvciwgdGhlbiBvdXRlckZuLnByb3RvdHlwZSBpbnN0YW5jZW9mIEdlbmVyYXRvci5cbiAgICB2YXIgcHJvdG9HZW5lcmF0b3IgPSBvdXRlckZuICYmIG91dGVyRm4ucHJvdG90eXBlIGluc3RhbmNlb2YgR2VuZXJhdG9yID8gb3V0ZXJGbiA6IEdlbmVyYXRvcjtcbiAgICB2YXIgZ2VuZXJhdG9yID0gT2JqZWN0LmNyZWF0ZShwcm90b0dlbmVyYXRvci5wcm90b3R5cGUpO1xuICAgIHZhciBjb250ZXh0ID0gbmV3IENvbnRleHQodHJ5TG9jc0xpc3QgfHwgW10pO1xuXG4gICAgLy8gVGhlIC5faW52b2tlIG1ldGhvZCB1bmlmaWVzIHRoZSBpbXBsZW1lbnRhdGlvbnMgb2YgdGhlIC5uZXh0LFxuICAgIC8vIC50aHJvdywgYW5kIC5yZXR1cm4gbWV0aG9kcy5cbiAgICBnZW5lcmF0b3IuX2ludm9rZSA9IG1ha2VJbnZva2VNZXRob2QoaW5uZXJGbiwgc2VsZiwgY29udGV4dCk7XG5cbiAgICByZXR1cm4gZ2VuZXJhdG9yO1xuICB9XG4gIHJ1bnRpbWUud3JhcCA9IHdyYXA7XG5cbiAgLy8gVHJ5L2NhdGNoIGhlbHBlciB0byBtaW5pbWl6ZSBkZW9wdGltaXphdGlvbnMuIFJldHVybnMgYSBjb21wbGV0aW9uXG4gIC8vIHJlY29yZCBsaWtlIGNvbnRleHQudHJ5RW50cmllc1tpXS5jb21wbGV0aW9uLiBUaGlzIGludGVyZmFjZSBjb3VsZFxuICAvLyBoYXZlIGJlZW4gKGFuZCB3YXMgcHJldmlvdXNseSkgZGVzaWduZWQgdG8gdGFrZSBhIGNsb3N1cmUgdG8gYmVcbiAgLy8gaW52b2tlZCB3aXRob3V0IGFyZ3VtZW50cywgYnV0IGluIGFsbCB0aGUgY2FzZXMgd2UgY2FyZSBhYm91dCB3ZVxuICAvLyBhbHJlYWR5IGhhdmUgYW4gZXhpc3RpbmcgbWV0aG9kIHdlIHdhbnQgdG8gY2FsbCwgc28gdGhlcmUncyBubyBuZWVkXG4gIC8vIHRvIGNyZWF0ZSBhIG5ldyBmdW5jdGlvbiBvYmplY3QuIFdlIGNhbiBldmVuIGdldCBhd2F5IHdpdGggYXNzdW1pbmdcbiAgLy8gdGhlIG1ldGhvZCB0YWtlcyBleGFjdGx5IG9uZSBhcmd1bWVudCwgc2luY2UgdGhhdCBoYXBwZW5zIHRvIGJlIHRydWVcbiAgLy8gaW4gZXZlcnkgY2FzZSwgc28gd2UgZG9uJ3QgaGF2ZSB0byB0b3VjaCB0aGUgYXJndW1lbnRzIG9iamVjdC4gVGhlXG4gIC8vIG9ubHkgYWRkaXRpb25hbCBhbGxvY2F0aW9uIHJlcXVpcmVkIGlzIHRoZSBjb21wbGV0aW9uIHJlY29yZCwgd2hpY2hcbiAgLy8gaGFzIGEgc3RhYmxlIHNoYXBlIGFuZCBzbyBob3BlZnVsbHkgc2hvdWxkIGJlIGNoZWFwIHRvIGFsbG9jYXRlLlxuICBmdW5jdGlvbiB0cnlDYXRjaChmbiwgb2JqLCBhcmcpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIHsgdHlwZTogXCJub3JtYWxcIiwgYXJnOiBmbi5jYWxsKG9iaiwgYXJnKSB9O1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgcmV0dXJuIHsgdHlwZTogXCJ0aHJvd1wiLCBhcmc6IGVyciB9O1xuICAgIH1cbiAgfVxuXG4gIHZhciBHZW5TdGF0ZVN1c3BlbmRlZFN0YXJ0ID0gXCJzdXNwZW5kZWRTdGFydFwiO1xuICB2YXIgR2VuU3RhdGVTdXNwZW5kZWRZaWVsZCA9IFwic3VzcGVuZGVkWWllbGRcIjtcbiAgdmFyIEdlblN0YXRlRXhlY3V0aW5nID0gXCJleGVjdXRpbmdcIjtcbiAgdmFyIEdlblN0YXRlQ29tcGxldGVkID0gXCJjb21wbGV0ZWRcIjtcblxuICAvLyBSZXR1cm5pbmcgdGhpcyBvYmplY3QgZnJvbSB0aGUgaW5uZXJGbiBoYXMgdGhlIHNhbWUgZWZmZWN0IGFzXG4gIC8vIGJyZWFraW5nIG91dCBvZiB0aGUgZGlzcGF0Y2ggc3dpdGNoIHN0YXRlbWVudC5cbiAgdmFyIENvbnRpbnVlU2VudGluZWwgPSB7fTtcblxuICAvLyBEdW1teSBjb25zdHJ1Y3RvciBmdW5jdGlvbnMgdGhhdCB3ZSB1c2UgYXMgdGhlIC5jb25zdHJ1Y3RvciBhbmRcbiAgLy8gLmNvbnN0cnVjdG9yLnByb3RvdHlwZSBwcm9wZXJ0aWVzIGZvciBmdW5jdGlvbnMgdGhhdCByZXR1cm4gR2VuZXJhdG9yXG4gIC8vIG9iamVjdHMuIEZvciBmdWxsIHNwZWMgY29tcGxpYW5jZSwgeW91IG1heSB3aXNoIHRvIGNvbmZpZ3VyZSB5b3VyXG4gIC8vIG1pbmlmaWVyIG5vdCB0byBtYW5nbGUgdGhlIG5hbWVzIG9mIHRoZXNlIHR3byBmdW5jdGlvbnMuXG4gIGZ1bmN0aW9uIEdlbmVyYXRvcigpIHt9XG4gIGZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uKCkge31cbiAgZnVuY3Rpb24gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUoKSB7fVxuXG4gIC8vIFRoaXMgaXMgYSBwb2x5ZmlsbCBmb3IgJUl0ZXJhdG9yUHJvdG90eXBlJSBmb3IgZW52aXJvbm1lbnRzIHRoYXRcbiAgLy8gZG9uJ3QgbmF0aXZlbHkgc3VwcG9ydCBpdC5cbiAgdmFyIEl0ZXJhdG9yUHJvdG90eXBlID0ge307XG4gIEl0ZXJhdG9yUHJvdG90eXBlW2l0ZXJhdG9yU3ltYm9sXSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICB2YXIgZ2V0UHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Y7XG4gIHZhciBOYXRpdmVJdGVyYXRvclByb3RvdHlwZSA9IGdldFByb3RvICYmIGdldFByb3RvKGdldFByb3RvKHZhbHVlcyhbXSkpKTtcbiAgaWYgKE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlICYmXG4gICAgICBOYXRpdmVJdGVyYXRvclByb3RvdHlwZSAhPT0gT3AgJiZcbiAgICAgIGhhc093bi5jYWxsKE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlLCBpdGVyYXRvclN5bWJvbCkpIHtcbiAgICAvLyBUaGlzIGVudmlyb25tZW50IGhhcyBhIG5hdGl2ZSAlSXRlcmF0b3JQcm90b3R5cGUlOyB1c2UgaXQgaW5zdGVhZFxuICAgIC8vIG9mIHRoZSBwb2x5ZmlsbC5cbiAgICBJdGVyYXRvclByb3RvdHlwZSA9IE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlO1xuICB9XG5cbiAgdmFyIEdwID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUucHJvdG90eXBlID1cbiAgICBHZW5lcmF0b3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShJdGVyYXRvclByb3RvdHlwZSk7XG4gIEdlbmVyYXRvckZ1bmN0aW9uLnByb3RvdHlwZSA9IEdwLmNvbnN0cnVjdG9yID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGU7XG4gIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLmNvbnN0cnVjdG9yID0gR2VuZXJhdG9yRnVuY3Rpb247XG4gIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlW3RvU3RyaW5nVGFnU3ltYm9sXSA9XG4gICAgR2VuZXJhdG9yRnVuY3Rpb24uZGlzcGxheU5hbWUgPSBcIkdlbmVyYXRvckZ1bmN0aW9uXCI7XG5cbiAgLy8gSGVscGVyIGZvciBkZWZpbmluZyB0aGUgLm5leHQsIC50aHJvdywgYW5kIC5yZXR1cm4gbWV0aG9kcyBvZiB0aGVcbiAgLy8gSXRlcmF0b3IgaW50ZXJmYWNlIGluIHRlcm1zIG9mIGEgc2luZ2xlIC5faW52b2tlIG1ldGhvZC5cbiAgZnVuY3Rpb24gZGVmaW5lSXRlcmF0b3JNZXRob2RzKHByb3RvdHlwZSkge1xuICAgIFtcIm5leHRcIiwgXCJ0aHJvd1wiLCBcInJldHVyblwiXS5mb3JFYWNoKGZ1bmN0aW9uKG1ldGhvZCkge1xuICAgICAgcHJvdG90eXBlW21ldGhvZF0gPSBmdW5jdGlvbihhcmcpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIGFyZyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgcnVudGltZS5pc0dlbmVyYXRvckZ1bmN0aW9uID0gZnVuY3Rpb24oZ2VuRnVuKSB7XG4gICAgdmFyIGN0b3IgPSB0eXBlb2YgZ2VuRnVuID09PSBcImZ1bmN0aW9uXCIgJiYgZ2VuRnVuLmNvbnN0cnVjdG9yO1xuICAgIHJldHVybiBjdG9yXG4gICAgICA/IGN0b3IgPT09IEdlbmVyYXRvckZ1bmN0aW9uIHx8XG4gICAgICAgIC8vIEZvciB0aGUgbmF0aXZlIEdlbmVyYXRvckZ1bmN0aW9uIGNvbnN0cnVjdG9yLCB0aGUgYmVzdCB3ZSBjYW5cbiAgICAgICAgLy8gZG8gaXMgdG8gY2hlY2sgaXRzIC5uYW1lIHByb3BlcnR5LlxuICAgICAgICAoY3Rvci5kaXNwbGF5TmFtZSB8fCBjdG9yLm5hbWUpID09PSBcIkdlbmVyYXRvckZ1bmN0aW9uXCJcbiAgICAgIDogZmFsc2U7XG4gIH07XG5cbiAgcnVudGltZS5tYXJrID0gZnVuY3Rpb24oZ2VuRnVuKSB7XG4gICAgaWYgKE9iamVjdC5zZXRQcm90b3R5cGVPZikge1xuICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKGdlbkZ1biwgR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBnZW5GdW4uX19wcm90b19fID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGU7XG4gICAgICBpZiAoISh0b1N0cmluZ1RhZ1N5bWJvbCBpbiBnZW5GdW4pKSB7XG4gICAgICAgIGdlbkZ1blt0b1N0cmluZ1RhZ1N5bWJvbF0gPSBcIkdlbmVyYXRvckZ1bmN0aW9uXCI7XG4gICAgICB9XG4gICAgfVxuICAgIGdlbkZ1bi5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEdwKTtcbiAgICByZXR1cm4gZ2VuRnVuO1xuICB9O1xuXG4gIC8vIFdpdGhpbiB0aGUgYm9keSBvZiBhbnkgYXN5bmMgZnVuY3Rpb24sIGBhd2FpdCB4YCBpcyB0cmFuc2Zvcm1lZCB0b1xuICAvLyBgeWllbGQgcmVnZW5lcmF0b3JSdW50aW1lLmF3cmFwKHgpYCwgc28gdGhhdCB0aGUgcnVudGltZSBjYW4gdGVzdFxuICAvLyBgaGFzT3duLmNhbGwodmFsdWUsIFwiX19hd2FpdFwiKWAgdG8gZGV0ZXJtaW5lIGlmIHRoZSB5aWVsZGVkIHZhbHVlIGlzXG4gIC8vIG1lYW50IHRvIGJlIGF3YWl0ZWQuXG4gIHJ1bnRpbWUuYXdyYXAgPSBmdW5jdGlvbihhcmcpIHtcbiAgICByZXR1cm4geyBfX2F3YWl0OiBhcmcgfTtcbiAgfTtcblxuICBmdW5jdGlvbiBBc3luY0l0ZXJhdG9yKGdlbmVyYXRvcikge1xuICAgIGZ1bmN0aW9uIGludm9rZShtZXRob2QsIGFyZywgcmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICB2YXIgcmVjb3JkID0gdHJ5Q2F0Y2goZ2VuZXJhdG9yW21ldGhvZF0sIGdlbmVyYXRvciwgYXJnKTtcbiAgICAgIGlmIChyZWNvcmQudHlwZSA9PT0gXCJ0aHJvd1wiKSB7XG4gICAgICAgIHJlamVjdChyZWNvcmQuYXJnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciByZXN1bHQgPSByZWNvcmQuYXJnO1xuICAgICAgICB2YXIgdmFsdWUgPSByZXN1bHQudmFsdWU7XG4gICAgICAgIGlmICh2YWx1ZSAmJlxuICAgICAgICAgICAgdHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiICYmXG4gICAgICAgICAgICBoYXNPd24uY2FsbCh2YWx1ZSwgXCJfX2F3YWl0XCIpKSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh2YWx1ZS5fX2F3YWl0KS50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgICBpbnZva2UoXCJuZXh0XCIsIHZhbHVlLCByZXNvbHZlLCByZWplY3QpO1xuICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgaW52b2tlKFwidGhyb3dcIiwgZXJyLCByZXNvbHZlLCByZWplY3QpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihmdW5jdGlvbih1bndyYXBwZWQpIHtcbiAgICAgICAgICAvLyBXaGVuIGEgeWllbGRlZCBQcm9taXNlIGlzIHJlc29sdmVkLCBpdHMgZmluYWwgdmFsdWUgYmVjb21lc1xuICAgICAgICAgIC8vIHRoZSAudmFsdWUgb2YgdGhlIFByb21pc2U8e3ZhbHVlLGRvbmV9PiByZXN1bHQgZm9yIHRoZVxuICAgICAgICAgIC8vIGN1cnJlbnQgaXRlcmF0aW9uLiBJZiB0aGUgUHJvbWlzZSBpcyByZWplY3RlZCwgaG93ZXZlciwgdGhlXG4gICAgICAgICAgLy8gcmVzdWx0IGZvciB0aGlzIGl0ZXJhdGlvbiB3aWxsIGJlIHJlamVjdGVkIHdpdGggdGhlIHNhbWVcbiAgICAgICAgICAvLyByZWFzb24uIE5vdGUgdGhhdCByZWplY3Rpb25zIG9mIHlpZWxkZWQgUHJvbWlzZXMgYXJlIG5vdFxuICAgICAgICAgIC8vIHRocm93biBiYWNrIGludG8gdGhlIGdlbmVyYXRvciBmdW5jdGlvbiwgYXMgaXMgdGhlIGNhc2VcbiAgICAgICAgICAvLyB3aGVuIGFuIGF3YWl0ZWQgUHJvbWlzZSBpcyByZWplY3RlZC4gVGhpcyBkaWZmZXJlbmNlIGluXG4gICAgICAgICAgLy8gYmVoYXZpb3IgYmV0d2VlbiB5aWVsZCBhbmQgYXdhaXQgaXMgaW1wb3J0YW50LCBiZWNhdXNlIGl0XG4gICAgICAgICAgLy8gYWxsb3dzIHRoZSBjb25zdW1lciB0byBkZWNpZGUgd2hhdCB0byBkbyB3aXRoIHRoZSB5aWVsZGVkXG4gICAgICAgICAgLy8gcmVqZWN0aW9uIChzd2FsbG93IGl0IGFuZCBjb250aW51ZSwgbWFudWFsbHkgLnRocm93IGl0IGJhY2tcbiAgICAgICAgICAvLyBpbnRvIHRoZSBnZW5lcmF0b3IsIGFiYW5kb24gaXRlcmF0aW9uLCB3aGF0ZXZlcikuIFdpdGhcbiAgICAgICAgICAvLyBhd2FpdCwgYnkgY29udHJhc3QsIHRoZXJlIGlzIG5vIG9wcG9ydHVuaXR5IHRvIGV4YW1pbmUgdGhlXG4gICAgICAgICAgLy8gcmVqZWN0aW9uIHJlYXNvbiBvdXRzaWRlIHRoZSBnZW5lcmF0b3IgZnVuY3Rpb24sIHNvIHRoZVxuICAgICAgICAgIC8vIG9ubHkgb3B0aW9uIGlzIHRvIHRocm93IGl0IGZyb20gdGhlIGF3YWl0IGV4cHJlc3Npb24sIGFuZFxuICAgICAgICAgIC8vIGxldCB0aGUgZ2VuZXJhdG9yIGZ1bmN0aW9uIGhhbmRsZSB0aGUgZXhjZXB0aW9uLlxuICAgICAgICAgIHJlc3VsdC52YWx1ZSA9IHVud3JhcHBlZDtcbiAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgIH0sIHJlamVjdCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIHByZXZpb3VzUHJvbWlzZTtcblxuICAgIGZ1bmN0aW9uIGVucXVldWUobWV0aG9kLCBhcmcpIHtcbiAgICAgIGZ1bmN0aW9uIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKCkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgaW52b2tlKG1ldGhvZCwgYXJnLCByZXNvbHZlLCByZWplY3QpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHByZXZpb3VzUHJvbWlzZSA9XG4gICAgICAgIC8vIElmIGVucXVldWUgaGFzIGJlZW4gY2FsbGVkIGJlZm9yZSwgdGhlbiB3ZSB3YW50IHRvIHdhaXQgdW50aWxcbiAgICAgICAgLy8gYWxsIHByZXZpb3VzIFByb21pc2VzIGhhdmUgYmVlbiByZXNvbHZlZCBiZWZvcmUgY2FsbGluZyBpbnZva2UsXG4gICAgICAgIC8vIHNvIHRoYXQgcmVzdWx0cyBhcmUgYWx3YXlzIGRlbGl2ZXJlZCBpbiB0aGUgY29ycmVjdCBvcmRlci4gSWZcbiAgICAgICAgLy8gZW5xdWV1ZSBoYXMgbm90IGJlZW4gY2FsbGVkIGJlZm9yZSwgdGhlbiBpdCBpcyBpbXBvcnRhbnQgdG9cbiAgICAgICAgLy8gY2FsbCBpbnZva2UgaW1tZWRpYXRlbHksIHdpdGhvdXQgd2FpdGluZyBvbiBhIGNhbGxiYWNrIHRvIGZpcmUsXG4gICAgICAgIC8vIHNvIHRoYXQgdGhlIGFzeW5jIGdlbmVyYXRvciBmdW5jdGlvbiBoYXMgdGhlIG9wcG9ydHVuaXR5IHRvIGRvXG4gICAgICAgIC8vIGFueSBuZWNlc3Nhcnkgc2V0dXAgaW4gYSBwcmVkaWN0YWJsZSB3YXkuIFRoaXMgcHJlZGljdGFiaWxpdHlcbiAgICAgICAgLy8gaXMgd2h5IHRoZSBQcm9taXNlIGNvbnN0cnVjdG9yIHN5bmNocm9ub3VzbHkgaW52b2tlcyBpdHNcbiAgICAgICAgLy8gZXhlY3V0b3IgY2FsbGJhY2ssIGFuZCB3aHkgYXN5bmMgZnVuY3Rpb25zIHN5bmNocm9ub3VzbHlcbiAgICAgICAgLy8gZXhlY3V0ZSBjb2RlIGJlZm9yZSB0aGUgZmlyc3QgYXdhaXQuIFNpbmNlIHdlIGltcGxlbWVudCBzaW1wbGVcbiAgICAgICAgLy8gYXN5bmMgZnVuY3Rpb25zIGluIHRlcm1zIG9mIGFzeW5jIGdlbmVyYXRvcnMsIGl0IGlzIGVzcGVjaWFsbHlcbiAgICAgICAgLy8gaW1wb3J0YW50IHRvIGdldCB0aGlzIHJpZ2h0LCBldmVuIHRob3VnaCBpdCByZXF1aXJlcyBjYXJlLlxuICAgICAgICBwcmV2aW91c1Byb21pc2UgPyBwcmV2aW91c1Byb21pc2UudGhlbihcbiAgICAgICAgICBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZyxcbiAgICAgICAgICAvLyBBdm9pZCBwcm9wYWdhdGluZyBmYWlsdXJlcyB0byBQcm9taXNlcyByZXR1cm5lZCBieSBsYXRlclxuICAgICAgICAgIC8vIGludm9jYXRpb25zIG9mIHRoZSBpdGVyYXRvci5cbiAgICAgICAgICBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZ1xuICAgICAgICApIDogY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcoKTtcbiAgICB9XG5cbiAgICAvLyBEZWZpbmUgdGhlIHVuaWZpZWQgaGVscGVyIG1ldGhvZCB0aGF0IGlzIHVzZWQgdG8gaW1wbGVtZW50IC5uZXh0LFxuICAgIC8vIC50aHJvdywgYW5kIC5yZXR1cm4gKHNlZSBkZWZpbmVJdGVyYXRvck1ldGhvZHMpLlxuICAgIHRoaXMuX2ludm9rZSA9IGVucXVldWU7XG4gIH1cblxuICBkZWZpbmVJdGVyYXRvck1ldGhvZHMoQXN5bmNJdGVyYXRvci5wcm90b3R5cGUpO1xuICBBc3luY0l0ZXJhdG9yLnByb3RvdHlwZVthc3luY0l0ZXJhdG9yU3ltYm9sXSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcbiAgcnVudGltZS5Bc3luY0l0ZXJhdG9yID0gQXN5bmNJdGVyYXRvcjtcblxuICAvLyBOb3RlIHRoYXQgc2ltcGxlIGFzeW5jIGZ1bmN0aW9ucyBhcmUgaW1wbGVtZW50ZWQgb24gdG9wIG9mXG4gIC8vIEFzeW5jSXRlcmF0b3Igb2JqZWN0czsgdGhleSBqdXN0IHJldHVybiBhIFByb21pc2UgZm9yIHRoZSB2YWx1ZSBvZlxuICAvLyB0aGUgZmluYWwgcmVzdWx0IHByb2R1Y2VkIGJ5IHRoZSBpdGVyYXRvci5cbiAgcnVudGltZS5hc3luYyA9IGZ1bmN0aW9uKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSB7XG4gICAgdmFyIGl0ZXIgPSBuZXcgQXN5bmNJdGVyYXRvcihcbiAgICAgIHdyYXAoaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZiwgdHJ5TG9jc0xpc3QpXG4gICAgKTtcblxuICAgIHJldHVybiBydW50aW1lLmlzR2VuZXJhdG9yRnVuY3Rpb24ob3V0ZXJGbilcbiAgICAgID8gaXRlciAvLyBJZiBvdXRlckZuIGlzIGEgZ2VuZXJhdG9yLCByZXR1cm4gdGhlIGZ1bGwgaXRlcmF0b3IuXG4gICAgICA6IGl0ZXIubmV4dCgpLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdC5kb25lID8gcmVzdWx0LnZhbHVlIDogaXRlci5uZXh0KCk7XG4gICAgICAgIH0pO1xuICB9O1xuXG4gIGZ1bmN0aW9uIG1ha2VJbnZva2VNZXRob2QoaW5uZXJGbiwgc2VsZiwgY29udGV4dCkge1xuICAgIHZhciBzdGF0ZSA9IEdlblN0YXRlU3VzcGVuZGVkU3RhcnQ7XG5cbiAgICByZXR1cm4gZnVuY3Rpb24gaW52b2tlKG1ldGhvZCwgYXJnKSB7XG4gICAgICBpZiAoc3RhdGUgPT09IEdlblN0YXRlRXhlY3V0aW5nKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IHJ1bm5pbmdcIik7XG4gICAgICB9XG5cbiAgICAgIGlmIChzdGF0ZSA9PT0gR2VuU3RhdGVDb21wbGV0ZWQpIHtcbiAgICAgICAgaWYgKG1ldGhvZCA9PT0gXCJ0aHJvd1wiKSB7XG4gICAgICAgICAgdGhyb3cgYXJnO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQmUgZm9yZ2l2aW5nLCBwZXIgMjUuMy4zLjMuMyBvZiB0aGUgc3BlYzpcbiAgICAgICAgLy8gaHR0cHM6Ly9wZW9wbGUubW96aWxsYS5vcmcvfmpvcmVuZG9yZmYvZXM2LWRyYWZ0Lmh0bWwjc2VjLWdlbmVyYXRvcnJlc3VtZVxuICAgICAgICByZXR1cm4gZG9uZVJlc3VsdCgpO1xuICAgICAgfVxuXG4gICAgICBjb250ZXh0Lm1ldGhvZCA9IG1ldGhvZDtcbiAgICAgIGNvbnRleHQuYXJnID0gYXJnO1xuXG4gICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICB2YXIgZGVsZWdhdGUgPSBjb250ZXh0LmRlbGVnYXRlO1xuICAgICAgICBpZiAoZGVsZWdhdGUpIHtcbiAgICAgICAgICB2YXIgZGVsZWdhdGVSZXN1bHQgPSBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KTtcbiAgICAgICAgICBpZiAoZGVsZWdhdGVSZXN1bHQpIHtcbiAgICAgICAgICAgIGlmIChkZWxlZ2F0ZVJlc3VsdCA9PT0gQ29udGludWVTZW50aW5lbCkgY29udGludWU7XG4gICAgICAgICAgICByZXR1cm4gZGVsZWdhdGVSZXN1bHQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvbnRleHQubWV0aG9kID09PSBcIm5leHRcIikge1xuICAgICAgICAgIC8vIFNldHRpbmcgY29udGV4dC5fc2VudCBmb3IgbGVnYWN5IHN1cHBvcnQgb2YgQmFiZWwnc1xuICAgICAgICAgIC8vIGZ1bmN0aW9uLnNlbnQgaW1wbGVtZW50YXRpb24uXG4gICAgICAgICAgY29udGV4dC5zZW50ID0gY29udGV4dC5fc2VudCA9IGNvbnRleHQuYXJnO1xuXG4gICAgICAgIH0gZWxzZSBpZiAoY29udGV4dC5tZXRob2QgPT09IFwidGhyb3dcIikge1xuICAgICAgICAgIGlmIChzdGF0ZSA9PT0gR2VuU3RhdGVTdXNwZW5kZWRTdGFydCkge1xuICAgICAgICAgICAgc3RhdGUgPSBHZW5TdGF0ZUNvbXBsZXRlZDtcbiAgICAgICAgICAgIHRocm93IGNvbnRleHQuYXJnO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnRleHQuZGlzcGF0Y2hFeGNlcHRpb24oY29udGV4dC5hcmcpO1xuXG4gICAgICAgIH0gZWxzZSBpZiAoY29udGV4dC5tZXRob2QgPT09IFwicmV0dXJuXCIpIHtcbiAgICAgICAgICBjb250ZXh0LmFicnVwdChcInJldHVyblwiLCBjb250ZXh0LmFyZyk7XG4gICAgICAgIH1cblxuICAgICAgICBzdGF0ZSA9IEdlblN0YXRlRXhlY3V0aW5nO1xuXG4gICAgICAgIHZhciByZWNvcmQgPSB0cnlDYXRjaChpbm5lckZuLCBzZWxmLCBjb250ZXh0KTtcbiAgICAgICAgaWYgKHJlY29yZC50eXBlID09PSBcIm5vcm1hbFwiKSB7XG4gICAgICAgICAgLy8gSWYgYW4gZXhjZXB0aW9uIGlzIHRocm93biBmcm9tIGlubmVyRm4sIHdlIGxlYXZlIHN0YXRlID09PVxuICAgICAgICAgIC8vIEdlblN0YXRlRXhlY3V0aW5nIGFuZCBsb29wIGJhY2sgZm9yIGFub3RoZXIgaW52b2NhdGlvbi5cbiAgICAgICAgICBzdGF0ZSA9IGNvbnRleHQuZG9uZVxuICAgICAgICAgICAgPyBHZW5TdGF0ZUNvbXBsZXRlZFxuICAgICAgICAgICAgOiBHZW5TdGF0ZVN1c3BlbmRlZFlpZWxkO1xuXG4gICAgICAgICAgaWYgKHJlY29yZC5hcmcgPT09IENvbnRpbnVlU2VudGluZWwpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB2YWx1ZTogcmVjb3JkLmFyZyxcbiAgICAgICAgICAgIGRvbmU6IGNvbnRleHQuZG9uZVxuICAgICAgICAgIH07XG5cbiAgICAgICAgfSBlbHNlIGlmIChyZWNvcmQudHlwZSA9PT0gXCJ0aHJvd1wiKSB7XG4gICAgICAgICAgc3RhdGUgPSBHZW5TdGF0ZUNvbXBsZXRlZDtcbiAgICAgICAgICAvLyBEaXNwYXRjaCB0aGUgZXhjZXB0aW9uIGJ5IGxvb3BpbmcgYmFjayBhcm91bmQgdG8gdGhlXG4gICAgICAgICAgLy8gY29udGV4dC5kaXNwYXRjaEV4Y2VwdGlvbihjb250ZXh0LmFyZykgY2FsbCBhYm92ZS5cbiAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9IFwidGhyb3dcIjtcbiAgICAgICAgICBjb250ZXh0LmFyZyA9IHJlY29yZC5hcmc7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgLy8gQ2FsbCBkZWxlZ2F0ZS5pdGVyYXRvcltjb250ZXh0Lm1ldGhvZF0oY29udGV4dC5hcmcpIGFuZCBoYW5kbGUgdGhlXG4gIC8vIHJlc3VsdCwgZWl0aGVyIGJ5IHJldHVybmluZyBhIHsgdmFsdWUsIGRvbmUgfSByZXN1bHQgZnJvbSB0aGVcbiAgLy8gZGVsZWdhdGUgaXRlcmF0b3IsIG9yIGJ5IG1vZGlmeWluZyBjb250ZXh0Lm1ldGhvZCBhbmQgY29udGV4dC5hcmcsXG4gIC8vIHNldHRpbmcgY29udGV4dC5kZWxlZ2F0ZSB0byBudWxsLCBhbmQgcmV0dXJuaW5nIHRoZSBDb250aW51ZVNlbnRpbmVsLlxuICBmdW5jdGlvbiBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KSB7XG4gICAgdmFyIG1ldGhvZCA9IGRlbGVnYXRlLml0ZXJhdG9yW2NvbnRleHQubWV0aG9kXTtcbiAgICBpZiAobWV0aG9kID09PSB1bmRlZmluZWQpIHtcbiAgICAgIC8vIEEgLnRocm93IG9yIC5yZXR1cm4gd2hlbiB0aGUgZGVsZWdhdGUgaXRlcmF0b3IgaGFzIG5vIC50aHJvd1xuICAgICAgLy8gbWV0aG9kIGFsd2F5cyB0ZXJtaW5hdGVzIHRoZSB5aWVsZCogbG9vcC5cbiAgICAgIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsO1xuXG4gICAgICBpZiAoY29udGV4dC5tZXRob2QgPT09IFwidGhyb3dcIikge1xuICAgICAgICBpZiAoZGVsZWdhdGUuaXRlcmF0b3IucmV0dXJuKSB7XG4gICAgICAgICAgLy8gSWYgdGhlIGRlbGVnYXRlIGl0ZXJhdG9yIGhhcyBhIHJldHVybiBtZXRob2QsIGdpdmUgaXQgYVxuICAgICAgICAgIC8vIGNoYW5jZSB0byBjbGVhbiB1cC5cbiAgICAgICAgICBjb250ZXh0Lm1ldGhvZCA9IFwicmV0dXJuXCI7XG4gICAgICAgICAgY29udGV4dC5hcmcgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCk7XG5cbiAgICAgICAgICBpZiAoY29udGV4dC5tZXRob2QgPT09IFwidGhyb3dcIikge1xuICAgICAgICAgICAgLy8gSWYgbWF5YmVJbnZva2VEZWxlZ2F0ZShjb250ZXh0KSBjaGFuZ2VkIGNvbnRleHQubWV0aG9kIGZyb21cbiAgICAgICAgICAgIC8vIFwicmV0dXJuXCIgdG8gXCJ0aHJvd1wiLCBsZXQgdGhhdCBvdmVycmlkZSB0aGUgVHlwZUVycm9yIGJlbG93LlxuICAgICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgY29udGV4dC5tZXRob2QgPSBcInRocm93XCI7XG4gICAgICAgIGNvbnRleHQuYXJnID0gbmV3IFR5cGVFcnJvcihcbiAgICAgICAgICBcIlRoZSBpdGVyYXRvciBkb2VzIG5vdCBwcm92aWRlIGEgJ3Rocm93JyBtZXRob2RcIik7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsO1xuICAgIH1cblxuICAgIHZhciByZWNvcmQgPSB0cnlDYXRjaChtZXRob2QsIGRlbGVnYXRlLml0ZXJhdG9yLCBjb250ZXh0LmFyZyk7XG5cbiAgICBpZiAocmVjb3JkLnR5cGUgPT09IFwidGhyb3dcIikge1xuICAgICAgY29udGV4dC5tZXRob2QgPSBcInRocm93XCI7XG4gICAgICBjb250ZXh0LmFyZyA9IHJlY29yZC5hcmc7XG4gICAgICBjb250ZXh0LmRlbGVnYXRlID0gbnVsbDtcbiAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsO1xuICAgIH1cblxuICAgIHZhciBpbmZvID0gcmVjb3JkLmFyZztcblxuICAgIGlmICghIGluZm8pIHtcbiAgICAgIGNvbnRleHQubWV0aG9kID0gXCJ0aHJvd1wiO1xuICAgICAgY29udGV4dC5hcmcgPSBuZXcgVHlwZUVycm9yKFwiaXRlcmF0b3IgcmVzdWx0IGlzIG5vdCBhbiBvYmplY3RcIik7XG4gICAgICBjb250ZXh0LmRlbGVnYXRlID0gbnVsbDtcbiAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsO1xuICAgIH1cblxuICAgIGlmIChpbmZvLmRvbmUpIHtcbiAgICAgIC8vIEFzc2lnbiB0aGUgcmVzdWx0IG9mIHRoZSBmaW5pc2hlZCBkZWxlZ2F0ZSB0byB0aGUgdGVtcG9yYXJ5XG4gICAgICAvLyB2YXJpYWJsZSBzcGVjaWZpZWQgYnkgZGVsZWdhdGUucmVzdWx0TmFtZSAoc2VlIGRlbGVnYXRlWWllbGQpLlxuICAgICAgY29udGV4dFtkZWxlZ2F0ZS5yZXN1bHROYW1lXSA9IGluZm8udmFsdWU7XG5cbiAgICAgIC8vIFJlc3VtZSBleGVjdXRpb24gYXQgdGhlIGRlc2lyZWQgbG9jYXRpb24gKHNlZSBkZWxlZ2F0ZVlpZWxkKS5cbiAgICAgIGNvbnRleHQubmV4dCA9IGRlbGVnYXRlLm5leHRMb2M7XG5cbiAgICAgIC8vIElmIGNvbnRleHQubWV0aG9kIHdhcyBcInRocm93XCIgYnV0IHRoZSBkZWxlZ2F0ZSBoYW5kbGVkIHRoZVxuICAgICAgLy8gZXhjZXB0aW9uLCBsZXQgdGhlIG91dGVyIGdlbmVyYXRvciBwcm9jZWVkIG5vcm1hbGx5LiBJZlxuICAgICAgLy8gY29udGV4dC5tZXRob2Qgd2FzIFwibmV4dFwiLCBmb3JnZXQgY29udGV4dC5hcmcgc2luY2UgaXQgaGFzIGJlZW5cbiAgICAgIC8vIFwiY29uc3VtZWRcIiBieSB0aGUgZGVsZWdhdGUgaXRlcmF0b3IuIElmIGNvbnRleHQubWV0aG9kIHdhc1xuICAgICAgLy8gXCJyZXR1cm5cIiwgYWxsb3cgdGhlIG9yaWdpbmFsIC5yZXR1cm4gY2FsbCB0byBjb250aW51ZSBpbiB0aGVcbiAgICAgIC8vIG91dGVyIGdlbmVyYXRvci5cbiAgICAgIGlmIChjb250ZXh0Lm1ldGhvZCAhPT0gXCJyZXR1cm5cIikge1xuICAgICAgICBjb250ZXh0Lm1ldGhvZCA9IFwibmV4dFwiO1xuICAgICAgICBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZDtcbiAgICAgIH1cblxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBSZS15aWVsZCB0aGUgcmVzdWx0IHJldHVybmVkIGJ5IHRoZSBkZWxlZ2F0ZSBtZXRob2QuXG4gICAgICByZXR1cm4gaW5mbztcbiAgICB9XG5cbiAgICAvLyBUaGUgZGVsZWdhdGUgaXRlcmF0b3IgaXMgZmluaXNoZWQsIHNvIGZvcmdldCBpdCBhbmQgY29udGludWUgd2l0aFxuICAgIC8vIHRoZSBvdXRlciBnZW5lcmF0b3IuXG4gICAgY29udGV4dC5kZWxlZ2F0ZSA9IG51bGw7XG4gICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gIH1cblxuICAvLyBEZWZpbmUgR2VuZXJhdG9yLnByb3RvdHlwZS57bmV4dCx0aHJvdyxyZXR1cm59IGluIHRlcm1zIG9mIHRoZVxuICAvLyB1bmlmaWVkIC5faW52b2tlIGhlbHBlciBtZXRob2QuXG4gIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhHcCk7XG5cbiAgR3BbdG9TdHJpbmdUYWdTeW1ib2xdID0gXCJHZW5lcmF0b3JcIjtcblxuICAvLyBBIEdlbmVyYXRvciBzaG91bGQgYWx3YXlzIHJldHVybiBpdHNlbGYgYXMgdGhlIGl0ZXJhdG9yIG9iamVjdCB3aGVuIHRoZVxuICAvLyBAQGl0ZXJhdG9yIGZ1bmN0aW9uIGlzIGNhbGxlZCBvbiBpdC4gU29tZSBicm93c2VycycgaW1wbGVtZW50YXRpb25zIG9mIHRoZVxuICAvLyBpdGVyYXRvciBwcm90b3R5cGUgY2hhaW4gaW5jb3JyZWN0bHkgaW1wbGVtZW50IHRoaXMsIGNhdXNpbmcgdGhlIEdlbmVyYXRvclxuICAvLyBvYmplY3QgdG8gbm90IGJlIHJldHVybmVkIGZyb20gdGhpcyBjYWxsLiBUaGlzIGVuc3VyZXMgdGhhdCBkb2Vzbid0IGhhcHBlbi5cbiAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWdlbmVyYXRvci9pc3N1ZXMvMjc0IGZvciBtb3JlIGRldGFpbHMuXG4gIEdwW2l0ZXJhdG9yU3ltYm9sXSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEdwLnRvU3RyaW5nID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIFwiW29iamVjdCBHZW5lcmF0b3JdXCI7XG4gIH07XG5cbiAgZnVuY3Rpb24gcHVzaFRyeUVudHJ5KGxvY3MpIHtcbiAgICB2YXIgZW50cnkgPSB7IHRyeUxvYzogbG9jc1swXSB9O1xuXG4gICAgaWYgKDEgaW4gbG9jcykge1xuICAgICAgZW50cnkuY2F0Y2hMb2MgPSBsb2NzWzFdO1xuICAgIH1cblxuICAgIGlmICgyIGluIGxvY3MpIHtcbiAgICAgIGVudHJ5LmZpbmFsbHlMb2MgPSBsb2NzWzJdO1xuICAgICAgZW50cnkuYWZ0ZXJMb2MgPSBsb2NzWzNdO1xuICAgIH1cblxuICAgIHRoaXMudHJ5RW50cmllcy5wdXNoKGVudHJ5KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlc2V0VHJ5RW50cnkoZW50cnkpIHtcbiAgICB2YXIgcmVjb3JkID0gZW50cnkuY29tcGxldGlvbiB8fCB7fTtcbiAgICByZWNvcmQudHlwZSA9IFwibm9ybWFsXCI7XG4gICAgZGVsZXRlIHJlY29yZC5hcmc7XG4gICAgZW50cnkuY29tcGxldGlvbiA9IHJlY29yZDtcbiAgfVxuXG4gIGZ1bmN0aW9uIENvbnRleHQodHJ5TG9jc0xpc3QpIHtcbiAgICAvLyBUaGUgcm9vdCBlbnRyeSBvYmplY3QgKGVmZmVjdGl2ZWx5IGEgdHJ5IHN0YXRlbWVudCB3aXRob3V0IGEgY2F0Y2hcbiAgICAvLyBvciBhIGZpbmFsbHkgYmxvY2spIGdpdmVzIHVzIGEgcGxhY2UgdG8gc3RvcmUgdmFsdWVzIHRocm93biBmcm9tXG4gICAgLy8gbG9jYXRpb25zIHdoZXJlIHRoZXJlIGlzIG5vIGVuY2xvc2luZyB0cnkgc3RhdGVtZW50LlxuICAgIHRoaXMudHJ5RW50cmllcyA9IFt7IHRyeUxvYzogXCJyb290XCIgfV07XG4gICAgdHJ5TG9jc0xpc3QuZm9yRWFjaChwdXNoVHJ5RW50cnksIHRoaXMpO1xuICAgIHRoaXMucmVzZXQodHJ1ZSk7XG4gIH1cblxuICBydW50aW1lLmtleXMgPSBmdW5jdGlvbihvYmplY3QpIHtcbiAgICB2YXIga2V5cyA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvYmplY3QpIHtcbiAgICAgIGtleXMucHVzaChrZXkpO1xuICAgIH1cbiAgICBrZXlzLnJldmVyc2UoKTtcblxuICAgIC8vIFJhdGhlciB0aGFuIHJldHVybmluZyBhbiBvYmplY3Qgd2l0aCBhIG5leHQgbWV0aG9kLCB3ZSBrZWVwXG4gICAgLy8gdGhpbmdzIHNpbXBsZSBhbmQgcmV0dXJuIHRoZSBuZXh0IGZ1bmN0aW9uIGl0c2VsZi5cbiAgICByZXR1cm4gZnVuY3Rpb24gbmV4dCgpIHtcbiAgICAgIHdoaWxlIChrZXlzLmxlbmd0aCkge1xuICAgICAgICB2YXIga2V5ID0ga2V5cy5wb3AoKTtcbiAgICAgICAgaWYgKGtleSBpbiBvYmplY3QpIHtcbiAgICAgICAgICBuZXh0LnZhbHVlID0ga2V5O1xuICAgICAgICAgIG5leHQuZG9uZSA9IGZhbHNlO1xuICAgICAgICAgIHJldHVybiBuZXh0O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFRvIGF2b2lkIGNyZWF0aW5nIGFuIGFkZGl0aW9uYWwgb2JqZWN0LCB3ZSBqdXN0IGhhbmcgdGhlIC52YWx1ZVxuICAgICAgLy8gYW5kIC5kb25lIHByb3BlcnRpZXMgb2ZmIHRoZSBuZXh0IGZ1bmN0aW9uIG9iamVjdCBpdHNlbGYuIFRoaXNcbiAgICAgIC8vIGFsc28gZW5zdXJlcyB0aGF0IHRoZSBtaW5pZmllciB3aWxsIG5vdCBhbm9ueW1pemUgdGhlIGZ1bmN0aW9uLlxuICAgICAgbmV4dC5kb25lID0gdHJ1ZTtcbiAgICAgIHJldHVybiBuZXh0O1xuICAgIH07XG4gIH07XG5cbiAgZnVuY3Rpb24gdmFsdWVzKGl0ZXJhYmxlKSB7XG4gICAgaWYgKGl0ZXJhYmxlKSB7XG4gICAgICB2YXIgaXRlcmF0b3JNZXRob2QgPSBpdGVyYWJsZVtpdGVyYXRvclN5bWJvbF07XG4gICAgICBpZiAoaXRlcmF0b3JNZXRob2QpIHtcbiAgICAgICAgcmV0dXJuIGl0ZXJhdG9yTWV0aG9kLmNhbGwoaXRlcmFibGUpO1xuICAgICAgfVxuXG4gICAgICBpZiAodHlwZW9mIGl0ZXJhYmxlLm5leHQgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICByZXR1cm4gaXRlcmFibGU7XG4gICAgICB9XG5cbiAgICAgIGlmICghaXNOYU4oaXRlcmFibGUubGVuZ3RoKSkge1xuICAgICAgICB2YXIgaSA9IC0xLCBuZXh0ID0gZnVuY3Rpb24gbmV4dCgpIHtcbiAgICAgICAgICB3aGlsZSAoKytpIDwgaXRlcmFibGUubGVuZ3RoKSB7XG4gICAgICAgICAgICBpZiAoaGFzT3duLmNhbGwoaXRlcmFibGUsIGkpKSB7XG4gICAgICAgICAgICAgIG5leHQudmFsdWUgPSBpdGVyYWJsZVtpXTtcbiAgICAgICAgICAgICAgbmV4dC5kb25lID0gZmFsc2U7XG4gICAgICAgICAgICAgIHJldHVybiBuZXh0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIG5leHQudmFsdWUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgbmV4dC5kb25lID0gdHJ1ZTtcblxuICAgICAgICAgIHJldHVybiBuZXh0O1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBuZXh0Lm5leHQgPSBuZXh0O1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFJldHVybiBhbiBpdGVyYXRvciB3aXRoIG5vIHZhbHVlcy5cbiAgICByZXR1cm4geyBuZXh0OiBkb25lUmVzdWx0IH07XG4gIH1cbiAgcnVudGltZS52YWx1ZXMgPSB2YWx1ZXM7XG5cbiAgZnVuY3Rpb24gZG9uZVJlc3VsdCgpIHtcbiAgICByZXR1cm4geyB2YWx1ZTogdW5kZWZpbmVkLCBkb25lOiB0cnVlIH07XG4gIH1cblxuICBDb250ZXh0LnByb3RvdHlwZSA9IHtcbiAgICBjb25zdHJ1Y3RvcjogQ29udGV4dCxcblxuICAgIHJlc2V0OiBmdW5jdGlvbihza2lwVGVtcFJlc2V0KSB7XG4gICAgICB0aGlzLnByZXYgPSAwO1xuICAgICAgdGhpcy5uZXh0ID0gMDtcbiAgICAgIC8vIFJlc2V0dGluZyBjb250ZXh0Ll9zZW50IGZvciBsZWdhY3kgc3VwcG9ydCBvZiBCYWJlbCdzXG4gICAgICAvLyBmdW5jdGlvbi5zZW50IGltcGxlbWVudGF0aW9uLlxuICAgICAgdGhpcy5zZW50ID0gdGhpcy5fc2VudCA9IHVuZGVmaW5lZDtcbiAgICAgIHRoaXMuZG9uZSA9IGZhbHNlO1xuICAgICAgdGhpcy5kZWxlZ2F0ZSA9IG51bGw7XG5cbiAgICAgIHRoaXMubWV0aG9kID0gXCJuZXh0XCI7XG4gICAgICB0aGlzLmFyZyA9IHVuZGVmaW5lZDtcblxuICAgICAgdGhpcy50cnlFbnRyaWVzLmZvckVhY2gocmVzZXRUcnlFbnRyeSk7XG5cbiAgICAgIGlmICghc2tpcFRlbXBSZXNldCkge1xuICAgICAgICBmb3IgKHZhciBuYW1lIGluIHRoaXMpIHtcbiAgICAgICAgICAvLyBOb3Qgc3VyZSBhYm91dCB0aGUgb3B0aW1hbCBvcmRlciBvZiB0aGVzZSBjb25kaXRpb25zOlxuICAgICAgICAgIGlmIChuYW1lLmNoYXJBdCgwKSA9PT0gXCJ0XCIgJiZcbiAgICAgICAgICAgICAgaGFzT3duLmNhbGwodGhpcywgbmFtZSkgJiZcbiAgICAgICAgICAgICAgIWlzTmFOKCtuYW1lLnNsaWNlKDEpKSkge1xuICAgICAgICAgICAgdGhpc1tuYW1lXSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgc3RvcDogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmRvbmUgPSB0cnVlO1xuXG4gICAgICB2YXIgcm9vdEVudHJ5ID0gdGhpcy50cnlFbnRyaWVzWzBdO1xuICAgICAgdmFyIHJvb3RSZWNvcmQgPSByb290RW50cnkuY29tcGxldGlvbjtcbiAgICAgIGlmIChyb290UmVjb3JkLnR5cGUgPT09IFwidGhyb3dcIikge1xuICAgICAgICB0aHJvdyByb290UmVjb3JkLmFyZztcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMucnZhbDtcbiAgICB9LFxuXG4gICAgZGlzcGF0Y2hFeGNlcHRpb246IGZ1bmN0aW9uKGV4Y2VwdGlvbikge1xuICAgICAgaWYgKHRoaXMuZG9uZSkge1xuICAgICAgICB0aHJvdyBleGNlcHRpb247XG4gICAgICB9XG5cbiAgICAgIHZhciBjb250ZXh0ID0gdGhpcztcbiAgICAgIGZ1bmN0aW9uIGhhbmRsZShsb2MsIGNhdWdodCkge1xuICAgICAgICByZWNvcmQudHlwZSA9IFwidGhyb3dcIjtcbiAgICAgICAgcmVjb3JkLmFyZyA9IGV4Y2VwdGlvbjtcbiAgICAgICAgY29udGV4dC5uZXh0ID0gbG9jO1xuXG4gICAgICAgIGlmIChjYXVnaHQpIHtcbiAgICAgICAgICAvLyBJZiB0aGUgZGlzcGF0Y2hlZCBleGNlcHRpb24gd2FzIGNhdWdodCBieSBhIGNhdGNoIGJsb2NrLFxuICAgICAgICAgIC8vIHRoZW4gbGV0IHRoYXQgY2F0Y2ggYmxvY2sgaGFuZGxlIHRoZSBleGNlcHRpb24gbm9ybWFsbHkuXG4gICAgICAgICAgY29udGV4dC5tZXRob2QgPSBcIm5leHRcIjtcbiAgICAgICAgICBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAhISBjYXVnaHQ7XG4gICAgICB9XG5cbiAgICAgIGZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHtcbiAgICAgICAgdmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldO1xuICAgICAgICB2YXIgcmVjb3JkID0gZW50cnkuY29tcGxldGlvbjtcblxuICAgICAgICBpZiAoZW50cnkudHJ5TG9jID09PSBcInJvb3RcIikge1xuICAgICAgICAgIC8vIEV4Y2VwdGlvbiB0aHJvd24gb3V0c2lkZSBvZiBhbnkgdHJ5IGJsb2NrIHRoYXQgY291bGQgaGFuZGxlXG4gICAgICAgICAgLy8gaXQsIHNvIHNldCB0aGUgY29tcGxldGlvbiB2YWx1ZSBvZiB0aGUgZW50aXJlIGZ1bmN0aW9uIHRvXG4gICAgICAgICAgLy8gdGhyb3cgdGhlIGV4Y2VwdGlvbi5cbiAgICAgICAgICByZXR1cm4gaGFuZGxlKFwiZW5kXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGVudHJ5LnRyeUxvYyA8PSB0aGlzLnByZXYpIHtcbiAgICAgICAgICB2YXIgaGFzQ2F0Y2ggPSBoYXNPd24uY2FsbChlbnRyeSwgXCJjYXRjaExvY1wiKTtcbiAgICAgICAgICB2YXIgaGFzRmluYWxseSA9IGhhc093bi5jYWxsKGVudHJ5LCBcImZpbmFsbHlMb2NcIik7XG5cbiAgICAgICAgICBpZiAoaGFzQ2F0Y2ggJiYgaGFzRmluYWxseSkge1xuICAgICAgICAgICAgaWYgKHRoaXMucHJldiA8IGVudHJ5LmNhdGNoTG9jKSB7XG4gICAgICAgICAgICAgIHJldHVybiBoYW5kbGUoZW50cnkuY2F0Y2hMb2MsIHRydWUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSB7XG4gICAgICAgICAgICAgIHJldHVybiBoYW5kbGUoZW50cnkuZmluYWxseUxvYyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICB9IGVsc2UgaWYgKGhhc0NhdGNoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5wcmV2IDwgZW50cnkuY2F0Y2hMb2MpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZShlbnRyeS5jYXRjaExvYywgdHJ1ZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICB9IGVsc2UgaWYgKGhhc0ZpbmFsbHkpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSB7XG4gICAgICAgICAgICAgIHJldHVybiBoYW5kbGUoZW50cnkuZmluYWxseUxvYyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwidHJ5IHN0YXRlbWVudCB3aXRob3V0IGNhdGNoIG9yIGZpbmFsbHlcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcblxuICAgIGFicnVwdDogZnVuY3Rpb24odHlwZSwgYXJnKSB7XG4gICAgICBmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7XG4gICAgICAgIHZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTtcbiAgICAgICAgaWYgKGVudHJ5LnRyeUxvYyA8PSB0aGlzLnByZXYgJiZcbiAgICAgICAgICAgIGhhc093bi5jYWxsKGVudHJ5LCBcImZpbmFsbHlMb2NcIikgJiZcbiAgICAgICAgICAgIHRoaXMucHJldiA8IGVudHJ5LmZpbmFsbHlMb2MpIHtcbiAgICAgICAgICB2YXIgZmluYWxseUVudHJ5ID0gZW50cnk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKGZpbmFsbHlFbnRyeSAmJlxuICAgICAgICAgICh0eXBlID09PSBcImJyZWFrXCIgfHxcbiAgICAgICAgICAgdHlwZSA9PT0gXCJjb250aW51ZVwiKSAmJlxuICAgICAgICAgIGZpbmFsbHlFbnRyeS50cnlMb2MgPD0gYXJnICYmXG4gICAgICAgICAgYXJnIDw9IGZpbmFsbHlFbnRyeS5maW5hbGx5TG9jKSB7XG4gICAgICAgIC8vIElnbm9yZSB0aGUgZmluYWxseSBlbnRyeSBpZiBjb250cm9sIGlzIG5vdCBqdW1waW5nIHRvIGFcbiAgICAgICAgLy8gbG9jYXRpb24gb3V0c2lkZSB0aGUgdHJ5L2NhdGNoIGJsb2NrLlxuICAgICAgICBmaW5hbGx5RW50cnkgPSBudWxsO1xuICAgICAgfVxuXG4gICAgICB2YXIgcmVjb3JkID0gZmluYWxseUVudHJ5ID8gZmluYWxseUVudHJ5LmNvbXBsZXRpb24gOiB7fTtcbiAgICAgIHJlY29yZC50eXBlID0gdHlwZTtcbiAgICAgIHJlY29yZC5hcmcgPSBhcmc7XG5cbiAgICAgIGlmIChmaW5hbGx5RW50cnkpIHtcbiAgICAgICAgdGhpcy5tZXRob2QgPSBcIm5leHRcIjtcbiAgICAgICAgdGhpcy5uZXh0ID0gZmluYWxseUVudHJ5LmZpbmFsbHlMb2M7XG4gICAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy5jb21wbGV0ZShyZWNvcmQpO1xuICAgIH0sXG5cbiAgICBjb21wbGV0ZTogZnVuY3Rpb24ocmVjb3JkLCBhZnRlckxvYykge1xuICAgICAgaWYgKHJlY29yZC50eXBlID09PSBcInRocm93XCIpIHtcbiAgICAgICAgdGhyb3cgcmVjb3JkLmFyZztcbiAgICAgIH1cblxuICAgICAgaWYgKHJlY29yZC50eXBlID09PSBcImJyZWFrXCIgfHxcbiAgICAgICAgICByZWNvcmQudHlwZSA9PT0gXCJjb250aW51ZVwiKSB7XG4gICAgICAgIHRoaXMubmV4dCA9IHJlY29yZC5hcmc7XG4gICAgICB9IGVsc2UgaWYgKHJlY29yZC50eXBlID09PSBcInJldHVyblwiKSB7XG4gICAgICAgIHRoaXMucnZhbCA9IHRoaXMuYXJnID0gcmVjb3JkLmFyZztcbiAgICAgICAgdGhpcy5tZXRob2QgPSBcInJldHVyblwiO1xuICAgICAgICB0aGlzLm5leHQgPSBcImVuZFwiO1xuICAgICAgfSBlbHNlIGlmIChyZWNvcmQudHlwZSA9PT0gXCJub3JtYWxcIiAmJiBhZnRlckxvYykge1xuICAgICAgICB0aGlzLm5leHQgPSBhZnRlckxvYztcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gICAgfSxcblxuICAgIGZpbmlzaDogZnVuY3Rpb24oZmluYWxseUxvYykge1xuICAgICAgZm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICB2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07XG4gICAgICAgIGlmIChlbnRyeS5maW5hbGx5TG9jID09PSBmaW5hbGx5TG9jKSB7XG4gICAgICAgICAgdGhpcy5jb21wbGV0ZShlbnRyeS5jb21wbGV0aW9uLCBlbnRyeS5hZnRlckxvYyk7XG4gICAgICAgICAgcmVzZXRUcnlFbnRyeShlbnRyeSk7XG4gICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgXCJjYXRjaFwiOiBmdW5jdGlvbih0cnlMb2MpIHtcbiAgICAgIGZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHtcbiAgICAgICAgdmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldO1xuICAgICAgICBpZiAoZW50cnkudHJ5TG9jID09PSB0cnlMb2MpIHtcbiAgICAgICAgICB2YXIgcmVjb3JkID0gZW50cnkuY29tcGxldGlvbjtcbiAgICAgICAgICBpZiAocmVjb3JkLnR5cGUgPT09IFwidGhyb3dcIikge1xuICAgICAgICAgICAgdmFyIHRocm93biA9IHJlY29yZC5hcmc7XG4gICAgICAgICAgICByZXNldFRyeUVudHJ5KGVudHJ5KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHRocm93bjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBUaGUgY29udGV4dC5jYXRjaCBtZXRob2QgbXVzdCBvbmx5IGJlIGNhbGxlZCB3aXRoIGEgbG9jYXRpb25cbiAgICAgIC8vIGFyZ3VtZW50IHRoYXQgY29ycmVzcG9uZHMgdG8gYSBrbm93biBjYXRjaCBibG9jay5cbiAgICAgIHRocm93IG5ldyBFcnJvcihcImlsbGVnYWwgY2F0Y2ggYXR0ZW1wdFwiKTtcbiAgICB9LFxuXG4gICAgZGVsZWdhdGVZaWVsZDogZnVuY3Rpb24oaXRlcmFibGUsIHJlc3VsdE5hbWUsIG5leHRMb2MpIHtcbiAgICAgIHRoaXMuZGVsZWdhdGUgPSB7XG4gICAgICAgIGl0ZXJhdG9yOiB2YWx1ZXMoaXRlcmFibGUpLFxuICAgICAgICByZXN1bHROYW1lOiByZXN1bHROYW1lLFxuICAgICAgICBuZXh0TG9jOiBuZXh0TG9jXG4gICAgICB9O1xuXG4gICAgICBpZiAodGhpcy5tZXRob2QgPT09IFwibmV4dFwiKSB7XG4gICAgICAgIC8vIERlbGliZXJhdGVseSBmb3JnZXQgdGhlIGxhc3Qgc2VudCB2YWx1ZSBzbyB0aGF0IHdlIGRvbid0XG4gICAgICAgIC8vIGFjY2lkZW50YWxseSBwYXNzIGl0IG9uIHRvIHRoZSBkZWxlZ2F0ZS5cbiAgICAgICAgdGhpcy5hcmcgPSB1bmRlZmluZWQ7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBDb250aW51ZVNlbnRpbmVsO1xuICAgIH1cbiAgfTtcbn0pKFxuICAvLyBJbiBzbG9wcHkgbW9kZSwgdW5ib3VuZCBgdGhpc2AgcmVmZXJzIHRvIHRoZSBnbG9iYWwgb2JqZWN0LCBmYWxsYmFjayB0b1xuICAvLyBGdW5jdGlvbiBjb25zdHJ1Y3RvciBpZiB3ZSdyZSBpbiBnbG9iYWwgc3RyaWN0IG1vZGUuIFRoYXQgaXMgc2FkbHkgYSBmb3JtXG4gIC8vIG9mIGluZGlyZWN0IGV2YWwgd2hpY2ggdmlvbGF0ZXMgQ29udGVudCBTZWN1cml0eSBQb2xpY3kuXG4gIChmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMgfSkoKSB8fCBGdW5jdGlvbihcInJldHVybiB0aGlzXCIpKClcbik7XG4iLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJyZWdlbmVyYXRvci1ydW50aW1lXCIpO1xuIiwicmVxdWlyZSgnLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LmNyZWF0ZScpO1xudmFyICRPYmplY3QgPSByZXF1aXJlKCcuLi8uLi9tb2R1bGVzL19jb3JlJykuT2JqZWN0O1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBjcmVhdGUoUCwgRCkge1xuICByZXR1cm4gJE9iamVjdC5jcmVhdGUoUCwgRCk7XG59O1xuIiwicmVxdWlyZSgnLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LmRlZmluZS1wcm9wZXJ0eScpO1xudmFyICRPYmplY3QgPSByZXF1aXJlKCcuLi8uLi9tb2R1bGVzL19jb3JlJykuT2JqZWN0O1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0eShpdCwga2V5LCBkZXNjKSB7XG4gIHJldHVybiAkT2JqZWN0LmRlZmluZVByb3BlcnR5KGl0LCBrZXksIGRlc2MpO1xufTtcbiIsInJlcXVpcmUoJy4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC5nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3InKTtcbnZhciAkT2JqZWN0ID0gcmVxdWlyZSgnLi4vLi4vbW9kdWxlcy9fY29yZScpLk9iamVjdDtcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGl0LCBrZXkpIHtcbiAgcmV0dXJuICRPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGl0LCBrZXkpO1xufTtcbiIsInJlcXVpcmUoJy4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC5nZXQtcHJvdG90eXBlLW9mJyk7XG5tb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoJy4uLy4uL21vZHVsZXMvX2NvcmUnKS5PYmplY3QuZ2V0UHJvdG90eXBlT2Y7XG4iLCJyZXF1aXJlKCcuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3Quc2V0LXByb3RvdHlwZS1vZicpO1xubW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuLi8uLi9tb2R1bGVzL19jb3JlJykuT2JqZWN0LnNldFByb3RvdHlwZU9mO1xuIiwicmVxdWlyZSgnLi4vbW9kdWxlcy9lczYub2JqZWN0LnRvLXN0cmluZycpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczYuc3RyaW5nLml0ZXJhdG9yJyk7XG5yZXF1aXJlKCcuLi9tb2R1bGVzL3dlYi5kb20uaXRlcmFibGUnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LnByb21pc2UnKTtcbnJlcXVpcmUoJy4uL21vZHVsZXMvZXM3LnByb21pc2UuZmluYWxseScpO1xucmVxdWlyZSgnLi4vbW9kdWxlcy9lczcucHJvbWlzZS50cnknKTtcbm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi4vbW9kdWxlcy9fY29yZScpLlByb21pc2U7XG4iLCJyZXF1aXJlKCcuLi8uLi9tb2R1bGVzL2VzNi5zeW1ib2wnKTtcbnJlcXVpcmUoJy4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC50by1zdHJpbmcnKTtcbnJlcXVpcmUoJy4uLy4uL21vZHVsZXMvZXM3LnN5bWJvbC5hc3luYy1pdGVyYXRvcicpO1xucmVxdWlyZSgnLi4vLi4vbW9kdWxlcy9lczcuc3ltYm9sLm9ic2VydmFibGUnKTtcbm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi4vLi4vbW9kdWxlcy9fY29yZScpLlN5bWJvbDtcbiIsInJlcXVpcmUoJy4uLy4uL21vZHVsZXMvZXM2LnN0cmluZy5pdGVyYXRvcicpO1xucmVxdWlyZSgnLi4vLi4vbW9kdWxlcy93ZWIuZG9tLml0ZXJhYmxlJyk7XG5tb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoJy4uLy4uL21vZHVsZXMvX3drcy1leHQnKS5mKCdpdGVyYXRvcicpO1xuIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHtcbiAgaWYgKHR5cGVvZiBpdCAhPSAnZnVuY3Rpb24nKSB0aHJvdyBUeXBlRXJyb3IoaXQgKyAnIGlzIG5vdCBhIGZ1bmN0aW9uIScpO1xuICByZXR1cm4gaXQ7XG59O1xuIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoKSB7IC8qIGVtcHR5ICovIH07XG4iLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCwgQ29uc3RydWN0b3IsIG5hbWUsIGZvcmJpZGRlbkZpZWxkKSB7XG4gIGlmICghKGl0IGluc3RhbmNlb2YgQ29uc3RydWN0b3IpIHx8IChmb3JiaWRkZW5GaWVsZCAhPT0gdW5kZWZpbmVkICYmIGZvcmJpZGRlbkZpZWxkIGluIGl0KSkge1xuICAgIHRocm93IFR5cGVFcnJvcihuYW1lICsgJzogaW5jb3JyZWN0IGludm9jYXRpb24hJyk7XG4gIH0gcmV0dXJuIGl0O1xufTtcbiIsInZhciBpc09iamVjdCA9IHJlcXVpcmUoJy4vX2lzLW9iamVjdCcpO1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHtcbiAgaWYgKCFpc09iamVjdChpdCkpIHRocm93IFR5cGVFcnJvcihpdCArICcgaXMgbm90IGFuIG9iamVjdCEnKTtcbiAgcmV0dXJuIGl0O1xufTtcbiIsIi8vIGZhbHNlIC0+IEFycmF5I2luZGV4T2Zcbi8vIHRydWUgIC0+IEFycmF5I2luY2x1ZGVzXG52YXIgdG9JT2JqZWN0ID0gcmVxdWlyZSgnLi9fdG8taW9iamVjdCcpO1xudmFyIHRvTGVuZ3RoID0gcmVxdWlyZSgnLi9fdG8tbGVuZ3RoJyk7XG52YXIgdG9BYnNvbHV0ZUluZGV4ID0gcmVxdWlyZSgnLi9fdG8tYWJzb2x1dGUtaW5kZXgnKTtcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKElTX0lOQ0xVREVTKSB7XG4gIHJldHVybiBmdW5jdGlvbiAoJHRoaXMsIGVsLCBmcm9tSW5kZXgpIHtcbiAgICB2YXIgTyA9IHRvSU9iamVjdCgkdGhpcyk7XG4gICAgdmFyIGxlbmd0aCA9IHRvTGVuZ3RoKE8ubGVuZ3RoKTtcbiAgICB2YXIgaW5kZXggPSB0b0Fic29sdXRlSW5kZXgoZnJvbUluZGV4LCBsZW5ndGgpO1xuICAgIHZhciB2YWx1ZTtcbiAgICAvLyBBcnJheSNpbmNsdWRlcyB1c2VzIFNhbWVWYWx1ZVplcm8gZXF1YWxpdHkgYWxnb3JpdGhtXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXNlbGYtY29tcGFyZVxuICAgIGlmIChJU19JTkNMVURFUyAmJiBlbCAhPSBlbCkgd2hpbGUgKGxlbmd0aCA+IGluZGV4KSB7XG4gICAgICB2YWx1ZSA9IE9baW5kZXgrK107XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tc2VsZi1jb21wYXJlXG4gICAgICBpZiAodmFsdWUgIT0gdmFsdWUpIHJldHVybiB0cnVlO1xuICAgIC8vIEFycmF5I2luZGV4T2YgaWdub3JlcyBob2xlcywgQXJyYXkjaW5jbHVkZXMgLSBub3RcbiAgICB9IGVsc2UgZm9yICg7bGVuZ3RoID4gaW5kZXg7IGluZGV4KyspIGlmIChJU19JTkNMVURFUyB8fCBpbmRleCBpbiBPKSB7XG4gICAgICBpZiAoT1tpbmRleF0gPT09IGVsKSByZXR1cm4gSVNfSU5DTFVERVMgfHwgaW5kZXggfHwgMDtcbiAgICB9IHJldHVybiAhSVNfSU5DTFVERVMgJiYgLTE7XG4gIH07XG59O1xuIiwiLy8gZ2V0dGluZyB0YWcgZnJvbSAxOS4xLjMuNiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nKClcbnZhciBjb2YgPSByZXF1aXJlKCcuL19jb2YnKTtcbnZhciBUQUcgPSByZXF1aXJlKCcuL193a3MnKSgndG9TdHJpbmdUYWcnKTtcbi8vIEVTMyB3cm9uZyBoZXJlXG52YXIgQVJHID0gY29mKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGFyZ3VtZW50czsgfSgpKSA9PSAnQXJndW1lbnRzJztcblxuLy8gZmFsbGJhY2sgZm9yIElFMTEgU2NyaXB0IEFjY2VzcyBEZW5pZWQgZXJyb3JcbnZhciB0cnlHZXQgPSBmdW5jdGlvbiAoaXQsIGtleSkge1xuICB0cnkge1xuICAgIHJldHVybiBpdFtrZXldO1xuICB9IGNhdGNoIChlKSB7IC8qIGVtcHR5ICovIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7XG4gIHZhciBPLCBULCBCO1xuICByZXR1cm4gaXQgPT09IHVuZGVmaW5lZCA/ICdVbmRlZmluZWQnIDogaXQgPT09IG51bGwgPyAnTnVsbCdcbiAgICAvLyBAQHRvU3RyaW5nVGFnIGNhc2VcbiAgICA6IHR5cGVvZiAoVCA9IHRyeUdldChPID0gT2JqZWN0KGl0KSwgVEFHKSkgPT0gJ3N0cmluZycgPyBUXG4gICAgLy8gYnVpbHRpblRhZyBjYXNlXG4gICAgOiBBUkcgPyBjb2YoTylcbiAgICAvLyBFUzMgYXJndW1lbnRzIGZhbGxiYWNrXG4gICAgOiAoQiA9IGNvZihPKSkgPT0gJ09iamVjdCcgJiYgdHlwZW9mIE8uY2FsbGVlID09ICdmdW5jdGlvbicgPyAnQXJndW1lbnRzJyA6IEI7XG59O1xuIiwidmFyIHRvU3RyaW5nID0ge30udG9TdHJpbmc7XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7XG4gIHJldHVybiB0b1N0cmluZy5jYWxsKGl0KS5zbGljZSg4LCAtMSk7XG59O1xuIiwidmFyIGNvcmUgPSBtb2R1bGUuZXhwb3J0cyA9IHsgdmVyc2lvbjogJzIuNi4xMicgfTtcbmlmICh0eXBlb2YgX19lID09ICdudW1iZXInKSBfX2UgPSBjb3JlOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXVuZGVmXG4iLCIvLyBvcHRpb25hbCAvIHNpbXBsZSBjb250ZXh0IGJpbmRpbmdcbnZhciBhRnVuY3Rpb24gPSByZXF1aXJlKCcuL19hLWZ1bmN0aW9uJyk7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChmbiwgdGhhdCwgbGVuZ3RoKSB7XG4gIGFGdW5jdGlvbihmbik7XG4gIGlmICh0aGF0ID09PSB1bmRlZmluZWQpIHJldHVybiBmbjtcbiAgc3dpdGNoIChsZW5ndGgpIHtcbiAgICBjYXNlIDE6IHJldHVybiBmdW5jdGlvbiAoYSkge1xuICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCwgYSk7XG4gICAgfTtcbiAgICBjYXNlIDI6IHJldHVybiBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCwgYSwgYik7XG4gICAgfTtcbiAgICBjYXNlIDM6IHJldHVybiBmdW5jdGlvbiAoYSwgYiwgYykge1xuICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCwgYSwgYiwgYyk7XG4gICAgfTtcbiAgfVxuICByZXR1cm4gZnVuY3Rpb24gKC8qIC4uLmFyZ3MgKi8pIHtcbiAgICByZXR1cm4gZm4uYXBwbHkodGhhdCwgYXJndW1lbnRzKTtcbiAgfTtcbn07XG4iLCIvLyA3LjIuMSBSZXF1aXJlT2JqZWN0Q29lcmNpYmxlKGFyZ3VtZW50KVxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHtcbiAgaWYgKGl0ID09IHVuZGVmaW5lZCkgdGhyb3cgVHlwZUVycm9yKFwiQ2FuJ3QgY2FsbCBtZXRob2Qgb24gIFwiICsgaXQpO1xuICByZXR1cm4gaXQ7XG59O1xuIiwiLy8gVGhhbmsncyBJRTggZm9yIGhpcyBmdW5ueSBkZWZpbmVQcm9wZXJ0eVxubW9kdWxlLmV4cG9ydHMgPSAhcmVxdWlyZSgnLi9fZmFpbHMnKShmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkoe30sICdhJywgeyBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIDc7IH0gfSkuYSAhPSA3O1xufSk7XG4iLCJ2YXIgaXNPYmplY3QgPSByZXF1aXJlKCcuL19pcy1vYmplY3QnKTtcbnZhciBkb2N1bWVudCA9IHJlcXVpcmUoJy4vX2dsb2JhbCcpLmRvY3VtZW50O1xuLy8gdHlwZW9mIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgaXMgJ29iamVjdCcgaW4gb2xkIElFXG52YXIgaXMgPSBpc09iamVjdChkb2N1bWVudCkgJiYgaXNPYmplY3QoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCk7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkge1xuICByZXR1cm4gaXMgPyBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGl0KSA6IHt9O1xufTtcbiIsIi8vIElFIDgtIGRvbid0IGVudW0gYnVnIGtleXNcbm1vZHVsZS5leHBvcnRzID0gKFxuICAnY29uc3RydWN0b3IsaGFzT3duUHJvcGVydHksaXNQcm90b3R5cGVPZixwcm9wZXJ0eUlzRW51bWVyYWJsZSx0b0xvY2FsZVN0cmluZyx0b1N0cmluZyx2YWx1ZU9mJ1xuKS5zcGxpdCgnLCcpO1xuIiwiLy8gYWxsIGVudW1lcmFibGUgb2JqZWN0IGtleXMsIGluY2x1ZGVzIHN5bWJvbHNcbnZhciBnZXRLZXlzID0gcmVxdWlyZSgnLi9fb2JqZWN0LWtleXMnKTtcbnZhciBnT1BTID0gcmVxdWlyZSgnLi9fb2JqZWN0LWdvcHMnKTtcbnZhciBwSUUgPSByZXF1aXJlKCcuL19vYmplY3QtcGllJyk7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkge1xuICB2YXIgcmVzdWx0ID0gZ2V0S2V5cyhpdCk7XG4gIHZhciBnZXRTeW1ib2xzID0gZ09QUy5mO1xuICBpZiAoZ2V0U3ltYm9scykge1xuICAgIHZhciBzeW1ib2xzID0gZ2V0U3ltYm9scyhpdCk7XG4gICAgdmFyIGlzRW51bSA9IHBJRS5mO1xuICAgIHZhciBpID0gMDtcbiAgICB2YXIga2V5O1xuICAgIHdoaWxlIChzeW1ib2xzLmxlbmd0aCA+IGkpIGlmIChpc0VudW0uY2FsbChpdCwga2V5ID0gc3ltYm9sc1tpKytdKSkgcmVzdWx0LnB1c2goa2V5KTtcbiAgfSByZXR1cm4gcmVzdWx0O1xufTtcbiIsInZhciBnbG9iYWwgPSByZXF1aXJlKCcuL19nbG9iYWwnKTtcbnZhciBjb3JlID0gcmVxdWlyZSgnLi9fY29yZScpO1xudmFyIGN0eCA9IHJlcXVpcmUoJy4vX2N0eCcpO1xudmFyIGhpZGUgPSByZXF1aXJlKCcuL19oaWRlJyk7XG52YXIgaGFzID0gcmVxdWlyZSgnLi9faGFzJyk7XG52YXIgUFJPVE9UWVBFID0gJ3Byb3RvdHlwZSc7XG5cbnZhciAkZXhwb3J0ID0gZnVuY3Rpb24gKHR5cGUsIG5hbWUsIHNvdXJjZSkge1xuICB2YXIgSVNfRk9SQ0VEID0gdHlwZSAmICRleHBvcnQuRjtcbiAgdmFyIElTX0dMT0JBTCA9IHR5cGUgJiAkZXhwb3J0Lkc7XG4gIHZhciBJU19TVEFUSUMgPSB0eXBlICYgJGV4cG9ydC5TO1xuICB2YXIgSVNfUFJPVE8gPSB0eXBlICYgJGV4cG9ydC5QO1xuICB2YXIgSVNfQklORCA9IHR5cGUgJiAkZXhwb3J0LkI7XG4gIHZhciBJU19XUkFQID0gdHlwZSAmICRleHBvcnQuVztcbiAgdmFyIGV4cG9ydHMgPSBJU19HTE9CQUwgPyBjb3JlIDogY29yZVtuYW1lXSB8fCAoY29yZVtuYW1lXSA9IHt9KTtcbiAgdmFyIGV4cFByb3RvID0gZXhwb3J0c1tQUk9UT1RZUEVdO1xuICB2YXIgdGFyZ2V0ID0gSVNfR0xPQkFMID8gZ2xvYmFsIDogSVNfU1RBVElDID8gZ2xvYmFsW25hbWVdIDogKGdsb2JhbFtuYW1lXSB8fCB7fSlbUFJPVE9UWVBFXTtcbiAgdmFyIGtleSwgb3duLCBvdXQ7XG4gIGlmIChJU19HTE9CQUwpIHNvdXJjZSA9IG5hbWU7XG4gIGZvciAoa2V5IGluIHNvdXJjZSkge1xuICAgIC8vIGNvbnRhaW5zIGluIG5hdGl2ZVxuICAgIG93biA9ICFJU19GT1JDRUQgJiYgdGFyZ2V0ICYmIHRhcmdldFtrZXldICE9PSB1bmRlZmluZWQ7XG4gICAgaWYgKG93biAmJiBoYXMoZXhwb3J0cywga2V5KSkgY29udGludWU7XG4gICAgLy8gZXhwb3J0IG5hdGl2ZSBvciBwYXNzZWRcbiAgICBvdXQgPSBvd24gPyB0YXJnZXRba2V5XSA6IHNvdXJjZVtrZXldO1xuICAgIC8vIHByZXZlbnQgZ2xvYmFsIHBvbGx1dGlvbiBmb3IgbmFtZXNwYWNlc1xuICAgIGV4cG9ydHNba2V5XSA9IElTX0dMT0JBTCAmJiB0eXBlb2YgdGFyZ2V0W2tleV0gIT0gJ2Z1bmN0aW9uJyA/IHNvdXJjZVtrZXldXG4gICAgLy8gYmluZCB0aW1lcnMgdG8gZ2xvYmFsIGZvciBjYWxsIGZyb20gZXhwb3J0IGNvbnRleHRcbiAgICA6IElTX0JJTkQgJiYgb3duID8gY3R4KG91dCwgZ2xvYmFsKVxuICAgIC8vIHdyYXAgZ2xvYmFsIGNvbnN0cnVjdG9ycyBmb3IgcHJldmVudCBjaGFuZ2UgdGhlbSBpbiBsaWJyYXJ5XG4gICAgOiBJU19XUkFQICYmIHRhcmdldFtrZXldID09IG91dCA/IChmdW5jdGlvbiAoQykge1xuICAgICAgdmFyIEYgPSBmdW5jdGlvbiAoYSwgYiwgYykge1xuICAgICAgICBpZiAodGhpcyBpbnN0YW5jZW9mIEMpIHtcbiAgICAgICAgICBzd2l0Y2ggKGFyZ3VtZW50cy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGNhc2UgMDogcmV0dXJuIG5ldyBDKCk7XG4gICAgICAgICAgICBjYXNlIDE6IHJldHVybiBuZXcgQyhhKTtcbiAgICAgICAgICAgIGNhc2UgMjogcmV0dXJuIG5ldyBDKGEsIGIpO1xuICAgICAgICAgIH0gcmV0dXJuIG5ldyBDKGEsIGIsIGMpO1xuICAgICAgICB9IHJldHVybiBDLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgICAgRltQUk9UT1RZUEVdID0gQ1tQUk9UT1RZUEVdO1xuICAgICAgcmV0dXJuIEY7XG4gICAgLy8gbWFrZSBzdGF0aWMgdmVyc2lvbnMgZm9yIHByb3RvdHlwZSBtZXRob2RzXG4gICAgfSkob3V0KSA6IElTX1BST1RPICYmIHR5cGVvZiBvdXQgPT0gJ2Z1bmN0aW9uJyA/IGN0eChGdW5jdGlvbi5jYWxsLCBvdXQpIDogb3V0O1xuICAgIC8vIGV4cG9ydCBwcm90byBtZXRob2RzIHRvIGNvcmUuJUNPTlNUUlVDVE9SJS5tZXRob2RzLiVOQU1FJVxuICAgIGlmIChJU19QUk9UTykge1xuICAgICAgKGV4cG9ydHMudmlydHVhbCB8fCAoZXhwb3J0cy52aXJ0dWFsID0ge30pKVtrZXldID0gb3V0O1xuICAgICAgLy8gZXhwb3J0IHByb3RvIG1ldGhvZHMgdG8gY29yZS4lQ09OU1RSVUNUT1IlLnByb3RvdHlwZS4lTkFNRSVcbiAgICAgIGlmICh0eXBlICYgJGV4cG9ydC5SICYmIGV4cFByb3RvICYmICFleHBQcm90b1trZXldKSBoaWRlKGV4cFByb3RvLCBrZXksIG91dCk7XG4gICAgfVxuICB9XG59O1xuLy8gdHlwZSBiaXRtYXBcbiRleHBvcnQuRiA9IDE7ICAgLy8gZm9yY2VkXG4kZXhwb3J0LkcgPSAyOyAgIC8vIGdsb2JhbFxuJGV4cG9ydC5TID0gNDsgICAvLyBzdGF0aWNcbiRleHBvcnQuUCA9IDg7ICAgLy8gcHJvdG9cbiRleHBvcnQuQiA9IDE2OyAgLy8gYmluZFxuJGV4cG9ydC5XID0gMzI7ICAvLyB3cmFwXG4kZXhwb3J0LlUgPSA2NDsgIC8vIHNhZmVcbiRleHBvcnQuUiA9IDEyODsgLy8gcmVhbCBwcm90byBtZXRob2QgZm9yIGBsaWJyYXJ5YFxubW9kdWxlLmV4cG9ydHMgPSAkZXhwb3J0O1xuIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoZXhlYykge1xuICB0cnkge1xuICAgIHJldHVybiAhIWV4ZWMoKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG59O1xuIiwidmFyIGN0eCA9IHJlcXVpcmUoJy4vX2N0eCcpO1xudmFyIGNhbGwgPSByZXF1aXJlKCcuL19pdGVyLWNhbGwnKTtcbnZhciBpc0FycmF5SXRlciA9IHJlcXVpcmUoJy4vX2lzLWFycmF5LWl0ZXInKTtcbnZhciBhbk9iamVjdCA9IHJlcXVpcmUoJy4vX2FuLW9iamVjdCcpO1xudmFyIHRvTGVuZ3RoID0gcmVxdWlyZSgnLi9fdG8tbGVuZ3RoJyk7XG52YXIgZ2V0SXRlckZuID0gcmVxdWlyZSgnLi9jb3JlLmdldC1pdGVyYXRvci1tZXRob2QnKTtcbnZhciBCUkVBSyA9IHt9O1xudmFyIFJFVFVSTiA9IHt9O1xudmFyIGV4cG9ydHMgPSBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdGVyYWJsZSwgZW50cmllcywgZm4sIHRoYXQsIElURVJBVE9SKSB7XG4gIHZhciBpdGVyRm4gPSBJVEVSQVRPUiA/IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGl0ZXJhYmxlOyB9IDogZ2V0SXRlckZuKGl0ZXJhYmxlKTtcbiAgdmFyIGYgPSBjdHgoZm4sIHRoYXQsIGVudHJpZXMgPyAyIDogMSk7XG4gIHZhciBpbmRleCA9IDA7XG4gIHZhciBsZW5ndGgsIHN0ZXAsIGl0ZXJhdG9yLCByZXN1bHQ7XG4gIGlmICh0eXBlb2YgaXRlckZuICE9ICdmdW5jdGlvbicpIHRocm93IFR5cGVFcnJvcihpdGVyYWJsZSArICcgaXMgbm90IGl0ZXJhYmxlIScpO1xuICAvLyBmYXN0IGNhc2UgZm9yIGFycmF5cyB3aXRoIGRlZmF1bHQgaXRlcmF0b3JcbiAgaWYgKGlzQXJyYXlJdGVyKGl0ZXJGbikpIGZvciAobGVuZ3RoID0gdG9MZW5ndGgoaXRlcmFibGUubGVuZ3RoKTsgbGVuZ3RoID4gaW5kZXg7IGluZGV4KyspIHtcbiAgICByZXN1bHQgPSBlbnRyaWVzID8gZihhbk9iamVjdChzdGVwID0gaXRlcmFibGVbaW5kZXhdKVswXSwgc3RlcFsxXSkgOiBmKGl0ZXJhYmxlW2luZGV4XSk7XG4gICAgaWYgKHJlc3VsdCA9PT0gQlJFQUsgfHwgcmVzdWx0ID09PSBSRVRVUk4pIHJldHVybiByZXN1bHQ7XG4gIH0gZWxzZSBmb3IgKGl0ZXJhdG9yID0gaXRlckZuLmNhbGwoaXRlcmFibGUpOyAhKHN0ZXAgPSBpdGVyYXRvci5uZXh0KCkpLmRvbmU7KSB7XG4gICAgcmVzdWx0ID0gY2FsbChpdGVyYXRvciwgZiwgc3RlcC52YWx1ZSwgZW50cmllcyk7XG4gICAgaWYgKHJlc3VsdCA9PT0gQlJFQUsgfHwgcmVzdWx0ID09PSBSRVRVUk4pIHJldHVybiByZXN1bHQ7XG4gIH1cbn07XG5leHBvcnRzLkJSRUFLID0gQlJFQUs7XG5leHBvcnRzLlJFVFVSTiA9IFJFVFVSTjtcbiIsIi8vIGh0dHBzOi8vZ2l0aHViLmNvbS96bG9pcm9jay9jb3JlLWpzL2lzc3Vlcy84NiNpc3N1ZWNvbW1lbnQtMTE1NzU5MDI4XG52YXIgZ2xvYmFsID0gbW9kdWxlLmV4cG9ydHMgPSB0eXBlb2Ygd2luZG93ICE9ICd1bmRlZmluZWQnICYmIHdpbmRvdy5NYXRoID09IE1hdGhcbiAgPyB3aW5kb3cgOiB0eXBlb2Ygc2VsZiAhPSAndW5kZWZpbmVkJyAmJiBzZWxmLk1hdGggPT0gTWF0aCA/IHNlbGZcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLW5ldy1mdW5jXG4gIDogRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTtcbmlmICh0eXBlb2YgX19nID09ICdudW1iZXInKSBfX2cgPSBnbG9iYWw7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW5kZWZcbiIsInZhciBoYXNPd25Qcm9wZXJ0eSA9IHt9Lmhhc093blByb3BlcnR5O1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQsIGtleSkge1xuICByZXR1cm4gaGFzT3duUHJvcGVydHkuY2FsbChpdCwga2V5KTtcbn07XG4iLCJ2YXIgZFAgPSByZXF1aXJlKCcuL19vYmplY3QtZHAnKTtcbnZhciBjcmVhdGVEZXNjID0gcmVxdWlyZSgnLi9fcHJvcGVydHktZGVzYycpO1xubW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuL19kZXNjcmlwdG9ycycpID8gZnVuY3Rpb24gKG9iamVjdCwga2V5LCB2YWx1ZSkge1xuICByZXR1cm4gZFAuZihvYmplY3QsIGtleSwgY3JlYXRlRGVzYygxLCB2YWx1ZSkpO1xufSA6IGZ1bmN0aW9uIChvYmplY3QsIGtleSwgdmFsdWUpIHtcbiAgb2JqZWN0W2tleV0gPSB2YWx1ZTtcbiAgcmV0dXJuIG9iamVjdDtcbn07XG4iLCJ2YXIgZG9jdW1lbnQgPSByZXF1aXJlKCcuL19nbG9iYWwnKS5kb2N1bWVudDtcbm1vZHVsZS5leHBvcnRzID0gZG9jdW1lbnQgJiYgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuIiwibW9kdWxlLmV4cG9ydHMgPSAhcmVxdWlyZSgnLi9fZGVzY3JpcHRvcnMnKSAmJiAhcmVxdWlyZSgnLi9fZmFpbHMnKShmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkocmVxdWlyZSgnLi9fZG9tLWNyZWF0ZScpKCdkaXYnKSwgJ2EnLCB7IGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gNzsgfSB9KS5hICE9IDc7XG59KTtcbiIsIi8vIGZhc3QgYXBwbHksIGh0dHA6Ly9qc3BlcmYubG5raXQuY29tL2Zhc3QtYXBwbHkvNVxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoZm4sIGFyZ3MsIHRoYXQpIHtcbiAgdmFyIHVuID0gdGhhdCA9PT0gdW5kZWZpbmVkO1xuICBzd2l0Y2ggKGFyZ3MubGVuZ3RoKSB7XG4gICAgY2FzZSAwOiByZXR1cm4gdW4gPyBmbigpXG4gICAgICAgICAgICAgICAgICAgICAgOiBmbi5jYWxsKHRoYXQpO1xuICAgIGNhc2UgMTogcmV0dXJuIHVuID8gZm4oYXJnc1swXSlcbiAgICAgICAgICAgICAgICAgICAgICA6IGZuLmNhbGwodGhhdCwgYXJnc1swXSk7XG4gICAgY2FzZSAyOiByZXR1cm4gdW4gPyBmbihhcmdzWzBdLCBhcmdzWzFdKVxuICAgICAgICAgICAgICAgICAgICAgIDogZm4uY2FsbCh0aGF0LCBhcmdzWzBdLCBhcmdzWzFdKTtcbiAgICBjYXNlIDM6IHJldHVybiB1biA/IGZuKGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0pXG4gICAgICAgICAgICAgICAgICAgICAgOiBmbi5jYWxsKHRoYXQsIGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0pO1xuICAgIGNhc2UgNDogcmV0dXJuIHVuID8gZm4oYXJnc1swXSwgYXJnc1sxXSwgYXJnc1syXSwgYXJnc1szXSlcbiAgICAgICAgICAgICAgICAgICAgICA6IGZuLmNhbGwodGhhdCwgYXJnc1swXSwgYXJnc1sxXSwgYXJnc1syXSwgYXJnc1szXSk7XG4gIH0gcmV0dXJuIGZuLmFwcGx5KHRoYXQsIGFyZ3MpO1xufTtcbiIsIi8vIGZhbGxiYWNrIGZvciBub24tYXJyYXktbGlrZSBFUzMgYW5kIG5vbi1lbnVtZXJhYmxlIG9sZCBWOCBzdHJpbmdzXG52YXIgY29mID0gcmVxdWlyZSgnLi9fY29mJyk7XG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcHJvdG90eXBlLWJ1aWx0aW5zXG5tb2R1bGUuZXhwb3J0cyA9IE9iamVjdCgneicpLnByb3BlcnR5SXNFbnVtZXJhYmxlKDApID8gT2JqZWN0IDogZnVuY3Rpb24gKGl0KSB7XG4gIHJldHVybiBjb2YoaXQpID09ICdTdHJpbmcnID8gaXQuc3BsaXQoJycpIDogT2JqZWN0KGl0KTtcbn07XG4iLCIvLyBjaGVjayBvbiBkZWZhdWx0IEFycmF5IGl0ZXJhdG9yXG52YXIgSXRlcmF0b3JzID0gcmVxdWlyZSgnLi9faXRlcmF0b3JzJyk7XG52YXIgSVRFUkFUT1IgPSByZXF1aXJlKCcuL193a3MnKSgnaXRlcmF0b3InKTtcbnZhciBBcnJheVByb3RvID0gQXJyYXkucHJvdG90eXBlO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkge1xuICByZXR1cm4gaXQgIT09IHVuZGVmaW5lZCAmJiAoSXRlcmF0b3JzLkFycmF5ID09PSBpdCB8fCBBcnJheVByb3RvW0lURVJBVE9SXSA9PT0gaXQpO1xufTtcbiIsIi8vIDcuMi4yIElzQXJyYXkoYXJndW1lbnQpXG52YXIgY29mID0gcmVxdWlyZSgnLi9fY29mJyk7XG5tb2R1bGUuZXhwb3J0cyA9IEFycmF5LmlzQXJyYXkgfHwgZnVuY3Rpb24gaXNBcnJheShhcmcpIHtcbiAgcmV0dXJuIGNvZihhcmcpID09ICdBcnJheSc7XG59O1xuIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHtcbiAgcmV0dXJuIHR5cGVvZiBpdCA9PT0gJ29iamVjdCcgPyBpdCAhPT0gbnVsbCA6IHR5cGVvZiBpdCA9PT0gJ2Z1bmN0aW9uJztcbn07XG4iLCIvLyBjYWxsIHNvbWV0aGluZyBvbiBpdGVyYXRvciBzdGVwIHdpdGggc2FmZSBjbG9zaW5nIG9uIGVycm9yXG52YXIgYW5PYmplY3QgPSByZXF1aXJlKCcuL19hbi1vYmplY3QnKTtcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0ZXJhdG9yLCBmbiwgdmFsdWUsIGVudHJpZXMpIHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gZW50cmllcyA/IGZuKGFuT2JqZWN0KHZhbHVlKVswXSwgdmFsdWVbMV0pIDogZm4odmFsdWUpO1xuICAvLyA3LjQuNiBJdGVyYXRvckNsb3NlKGl0ZXJhdG9yLCBjb21wbGV0aW9uKVxuICB9IGNhdGNoIChlKSB7XG4gICAgdmFyIHJldCA9IGl0ZXJhdG9yWydyZXR1cm4nXTtcbiAgICBpZiAocmV0ICE9PSB1bmRlZmluZWQpIGFuT2JqZWN0KHJldC5jYWxsKGl0ZXJhdG9yKSk7XG4gICAgdGhyb3cgZTtcbiAgfVxufTtcbiIsIid1c2Ugc3RyaWN0JztcbnZhciBjcmVhdGUgPSByZXF1aXJlKCcuL19vYmplY3QtY3JlYXRlJyk7XG52YXIgZGVzY3JpcHRvciA9IHJlcXVpcmUoJy4vX3Byb3BlcnR5LWRlc2MnKTtcbnZhciBzZXRUb1N0cmluZ1RhZyA9IHJlcXVpcmUoJy4vX3NldC10by1zdHJpbmctdGFnJyk7XG52YXIgSXRlcmF0b3JQcm90b3R5cGUgPSB7fTtcblxuLy8gMjUuMS4yLjEuMSAlSXRlcmF0b3JQcm90b3R5cGUlW0BAaXRlcmF0b3JdKClcbnJlcXVpcmUoJy4vX2hpZGUnKShJdGVyYXRvclByb3RvdHlwZSwgcmVxdWlyZSgnLi9fd2tzJykoJ2l0ZXJhdG9yJyksIGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgTkFNRSwgbmV4dCkge1xuICBDb25zdHJ1Y3Rvci5wcm90b3R5cGUgPSBjcmVhdGUoSXRlcmF0b3JQcm90b3R5cGUsIHsgbmV4dDogZGVzY3JpcHRvcigxLCBuZXh0KSB9KTtcbiAgc2V0VG9TdHJpbmdUYWcoQ29uc3RydWN0b3IsIE5BTUUgKyAnIEl0ZXJhdG9yJyk7XG59O1xuIiwiJ3VzZSBzdHJpY3QnO1xudmFyIExJQlJBUlkgPSByZXF1aXJlKCcuL19saWJyYXJ5Jyk7XG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xudmFyIHJlZGVmaW5lID0gcmVxdWlyZSgnLi9fcmVkZWZpbmUnKTtcbnZhciBoaWRlID0gcmVxdWlyZSgnLi9faGlkZScpO1xudmFyIEl0ZXJhdG9ycyA9IHJlcXVpcmUoJy4vX2l0ZXJhdG9ycycpO1xudmFyICRpdGVyQ3JlYXRlID0gcmVxdWlyZSgnLi9faXRlci1jcmVhdGUnKTtcbnZhciBzZXRUb1N0cmluZ1RhZyA9IHJlcXVpcmUoJy4vX3NldC10by1zdHJpbmctdGFnJyk7XG52YXIgZ2V0UHJvdG90eXBlT2YgPSByZXF1aXJlKCcuL19vYmplY3QtZ3BvJyk7XG52YXIgSVRFUkFUT1IgPSByZXF1aXJlKCcuL193a3MnKSgnaXRlcmF0b3InKTtcbnZhciBCVUdHWSA9ICEoW10ua2V5cyAmJiAnbmV4dCcgaW4gW10ua2V5cygpKTsgLy8gU2FmYXJpIGhhcyBidWdneSBpdGVyYXRvcnMgdy9vIGBuZXh0YFxudmFyIEZGX0lURVJBVE9SID0gJ0BAaXRlcmF0b3InO1xudmFyIEtFWVMgPSAna2V5cyc7XG52YXIgVkFMVUVTID0gJ3ZhbHVlcyc7XG5cbnZhciByZXR1cm5UaGlzID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoQmFzZSwgTkFNRSwgQ29uc3RydWN0b3IsIG5leHQsIERFRkFVTFQsIElTX1NFVCwgRk9SQ0VEKSB7XG4gICRpdGVyQ3JlYXRlKENvbnN0cnVjdG9yLCBOQU1FLCBuZXh0KTtcbiAgdmFyIGdldE1ldGhvZCA9IGZ1bmN0aW9uIChraW5kKSB7XG4gICAgaWYgKCFCVUdHWSAmJiBraW5kIGluIHByb3RvKSByZXR1cm4gcHJvdG9ba2luZF07XG4gICAgc3dpdGNoIChraW5kKSB7XG4gICAgICBjYXNlIEtFWVM6IHJldHVybiBmdW5jdGlvbiBrZXlzKCkgeyByZXR1cm4gbmV3IENvbnN0cnVjdG9yKHRoaXMsIGtpbmQpOyB9O1xuICAgICAgY2FzZSBWQUxVRVM6IHJldHVybiBmdW5jdGlvbiB2YWx1ZXMoKSB7IHJldHVybiBuZXcgQ29uc3RydWN0b3IodGhpcywga2luZCk7IH07XG4gICAgfSByZXR1cm4gZnVuY3Rpb24gZW50cmllcygpIHsgcmV0dXJuIG5ldyBDb25zdHJ1Y3Rvcih0aGlzLCBraW5kKTsgfTtcbiAgfTtcbiAgdmFyIFRBRyA9IE5BTUUgKyAnIEl0ZXJhdG9yJztcbiAgdmFyIERFRl9WQUxVRVMgPSBERUZBVUxUID09IFZBTFVFUztcbiAgdmFyIFZBTFVFU19CVUcgPSBmYWxzZTtcbiAgdmFyIHByb3RvID0gQmFzZS5wcm90b3R5cGU7XG4gIHZhciAkbmF0aXZlID0gcHJvdG9bSVRFUkFUT1JdIHx8IHByb3RvW0ZGX0lURVJBVE9SXSB8fCBERUZBVUxUICYmIHByb3RvW0RFRkFVTFRdO1xuICB2YXIgJGRlZmF1bHQgPSAkbmF0aXZlIHx8IGdldE1ldGhvZChERUZBVUxUKTtcbiAgdmFyICRlbnRyaWVzID0gREVGQVVMVCA/ICFERUZfVkFMVUVTID8gJGRlZmF1bHQgOiBnZXRNZXRob2QoJ2VudHJpZXMnKSA6IHVuZGVmaW5lZDtcbiAgdmFyICRhbnlOYXRpdmUgPSBOQU1FID09ICdBcnJheScgPyBwcm90by5lbnRyaWVzIHx8ICRuYXRpdmUgOiAkbmF0aXZlO1xuICB2YXIgbWV0aG9kcywga2V5LCBJdGVyYXRvclByb3RvdHlwZTtcbiAgLy8gRml4IG5hdGl2ZVxuICBpZiAoJGFueU5hdGl2ZSkge1xuICAgIEl0ZXJhdG9yUHJvdG90eXBlID0gZ2V0UHJvdG90eXBlT2YoJGFueU5hdGl2ZS5jYWxsKG5ldyBCYXNlKCkpKTtcbiAgICBpZiAoSXRlcmF0b3JQcm90b3R5cGUgIT09IE9iamVjdC5wcm90b3R5cGUgJiYgSXRlcmF0b3JQcm90b3R5cGUubmV4dCkge1xuICAgICAgLy8gU2V0IEBAdG9TdHJpbmdUYWcgdG8gbmF0aXZlIGl0ZXJhdG9yc1xuICAgICAgc2V0VG9TdHJpbmdUYWcoSXRlcmF0b3JQcm90b3R5cGUsIFRBRywgdHJ1ZSk7XG4gICAgICAvLyBmaXggZm9yIHNvbWUgb2xkIGVuZ2luZXNcbiAgICAgIGlmICghTElCUkFSWSAmJiB0eXBlb2YgSXRlcmF0b3JQcm90b3R5cGVbSVRFUkFUT1JdICE9ICdmdW5jdGlvbicpIGhpZGUoSXRlcmF0b3JQcm90b3R5cGUsIElURVJBVE9SLCByZXR1cm5UaGlzKTtcbiAgICB9XG4gIH1cbiAgLy8gZml4IEFycmF5I3t2YWx1ZXMsIEBAaXRlcmF0b3J9Lm5hbWUgaW4gVjggLyBGRlxuICBpZiAoREVGX1ZBTFVFUyAmJiAkbmF0aXZlICYmICRuYXRpdmUubmFtZSAhPT0gVkFMVUVTKSB7XG4gICAgVkFMVUVTX0JVRyA9IHRydWU7XG4gICAgJGRlZmF1bHQgPSBmdW5jdGlvbiB2YWx1ZXMoKSB7IHJldHVybiAkbmF0aXZlLmNhbGwodGhpcyk7IH07XG4gIH1cbiAgLy8gRGVmaW5lIGl0ZXJhdG9yXG4gIGlmICgoIUxJQlJBUlkgfHwgRk9SQ0VEKSAmJiAoQlVHR1kgfHwgVkFMVUVTX0JVRyB8fCAhcHJvdG9bSVRFUkFUT1JdKSkge1xuICAgIGhpZGUocHJvdG8sIElURVJBVE9SLCAkZGVmYXVsdCk7XG4gIH1cbiAgLy8gUGx1ZyBmb3IgbGlicmFyeVxuICBJdGVyYXRvcnNbTkFNRV0gPSAkZGVmYXVsdDtcbiAgSXRlcmF0b3JzW1RBR10gPSByZXR1cm5UaGlzO1xuICBpZiAoREVGQVVMVCkge1xuICAgIG1ldGhvZHMgPSB7XG4gICAgICB2YWx1ZXM6IERFRl9WQUxVRVMgPyAkZGVmYXVsdCA6IGdldE1ldGhvZChWQUxVRVMpLFxuICAgICAga2V5czogSVNfU0VUID8gJGRlZmF1bHQgOiBnZXRNZXRob2QoS0VZUyksXG4gICAgICBlbnRyaWVzOiAkZW50cmllc1xuICAgIH07XG4gICAgaWYgKEZPUkNFRCkgZm9yIChrZXkgaW4gbWV0aG9kcykge1xuICAgICAgaWYgKCEoa2V5IGluIHByb3RvKSkgcmVkZWZpbmUocHJvdG8sIGtleSwgbWV0aG9kc1trZXldKTtcbiAgICB9IGVsc2UgJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LkYgKiAoQlVHR1kgfHwgVkFMVUVTX0JVRyksIE5BTUUsIG1ldGhvZHMpO1xuICB9XG4gIHJldHVybiBtZXRob2RzO1xufTtcbiIsInZhciBJVEVSQVRPUiA9IHJlcXVpcmUoJy4vX3drcycpKCdpdGVyYXRvcicpO1xudmFyIFNBRkVfQ0xPU0lORyA9IGZhbHNlO1xuXG50cnkge1xuICB2YXIgcml0ZXIgPSBbN11bSVRFUkFUT1JdKCk7XG4gIHJpdGVyWydyZXR1cm4nXSA9IGZ1bmN0aW9uICgpIHsgU0FGRV9DTE9TSU5HID0gdHJ1ZTsgfTtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXRocm93LWxpdGVyYWxcbiAgQXJyYXkuZnJvbShyaXRlciwgZnVuY3Rpb24gKCkgeyB0aHJvdyAyOyB9KTtcbn0gY2F0Y2ggKGUpIHsgLyogZW1wdHkgKi8gfVxuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChleGVjLCBza2lwQ2xvc2luZykge1xuICBpZiAoIXNraXBDbG9zaW5nICYmICFTQUZFX0NMT1NJTkcpIHJldHVybiBmYWxzZTtcbiAgdmFyIHNhZmUgPSBmYWxzZTtcbiAgdHJ5IHtcbiAgICB2YXIgYXJyID0gWzddO1xuICAgIHZhciBpdGVyID0gYXJyW0lURVJBVE9SXSgpO1xuICAgIGl0ZXIubmV4dCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHsgZG9uZTogc2FmZSA9IHRydWUgfTsgfTtcbiAgICBhcnJbSVRFUkFUT1JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gaXRlcjsgfTtcbiAgICBleGVjKGFycik7XG4gIH0gY2F0Y2ggKGUpIHsgLyogZW1wdHkgKi8gfVxuICByZXR1cm4gc2FmZTtcbn07XG4iLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChkb25lLCB2YWx1ZSkge1xuICByZXR1cm4geyB2YWx1ZTogdmFsdWUsIGRvbmU6ICEhZG9uZSB9O1xufTtcbiIsIm1vZHVsZS5leHBvcnRzID0ge307XG4iLCJtb2R1bGUuZXhwb3J0cyA9IHRydWU7XG4iLCJ2YXIgTUVUQSA9IHJlcXVpcmUoJy4vX3VpZCcpKCdtZXRhJyk7XG52YXIgaXNPYmplY3QgPSByZXF1aXJlKCcuL19pcy1vYmplY3QnKTtcbnZhciBoYXMgPSByZXF1aXJlKCcuL19oYXMnKTtcbnZhciBzZXREZXNjID0gcmVxdWlyZSgnLi9fb2JqZWN0LWRwJykuZjtcbnZhciBpZCA9IDA7XG52YXIgaXNFeHRlbnNpYmxlID0gT2JqZWN0LmlzRXh0ZW5zaWJsZSB8fCBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiB0cnVlO1xufTtcbnZhciBGUkVFWkUgPSAhcmVxdWlyZSgnLi9fZmFpbHMnKShmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBpc0V4dGVuc2libGUoT2JqZWN0LnByZXZlbnRFeHRlbnNpb25zKHt9KSk7XG59KTtcbnZhciBzZXRNZXRhID0gZnVuY3Rpb24gKGl0KSB7XG4gIHNldERlc2MoaXQsIE1FVEEsIHsgdmFsdWU6IHtcbiAgICBpOiAnTycgKyArK2lkLCAvLyBvYmplY3QgSURcbiAgICB3OiB7fSAgICAgICAgICAvLyB3ZWFrIGNvbGxlY3Rpb25zIElEc1xuICB9IH0pO1xufTtcbnZhciBmYXN0S2V5ID0gZnVuY3Rpb24gKGl0LCBjcmVhdGUpIHtcbiAgLy8gcmV0dXJuIHByaW1pdGl2ZSB3aXRoIHByZWZpeFxuICBpZiAoIWlzT2JqZWN0KGl0KSkgcmV0dXJuIHR5cGVvZiBpdCA9PSAnc3ltYm9sJyA/IGl0IDogKHR5cGVvZiBpdCA9PSAnc3RyaW5nJyA/ICdTJyA6ICdQJykgKyBpdDtcbiAgaWYgKCFoYXMoaXQsIE1FVEEpKSB7XG4gICAgLy8gY2FuJ3Qgc2V0IG1ldGFkYXRhIHRvIHVuY2F1Z2h0IGZyb3plbiBvYmplY3RcbiAgICBpZiAoIWlzRXh0ZW5zaWJsZShpdCkpIHJldHVybiAnRic7XG4gICAgLy8gbm90IG5lY2Vzc2FyeSB0byBhZGQgbWV0YWRhdGFcbiAgICBpZiAoIWNyZWF0ZSkgcmV0dXJuICdFJztcbiAgICAvLyBhZGQgbWlzc2luZyBtZXRhZGF0YVxuICAgIHNldE1ldGEoaXQpO1xuICAvLyByZXR1cm4gb2JqZWN0IElEXG4gIH0gcmV0dXJuIGl0W01FVEFdLmk7XG59O1xudmFyIGdldFdlYWsgPSBmdW5jdGlvbiAoaXQsIGNyZWF0ZSkge1xuICBpZiAoIWhhcyhpdCwgTUVUQSkpIHtcbiAgICAvLyBjYW4ndCBzZXQgbWV0YWRhdGEgdG8gdW5jYXVnaHQgZnJvemVuIG9iamVjdFxuICAgIGlmICghaXNFeHRlbnNpYmxlKGl0KSkgcmV0dXJuIHRydWU7XG4gICAgLy8gbm90IG5lY2Vzc2FyeSB0byBhZGQgbWV0YWRhdGFcbiAgICBpZiAoIWNyZWF0ZSkgcmV0dXJuIGZhbHNlO1xuICAgIC8vIGFkZCBtaXNzaW5nIG1ldGFkYXRhXG4gICAgc2V0TWV0YShpdCk7XG4gIC8vIHJldHVybiBoYXNoIHdlYWsgY29sbGVjdGlvbnMgSURzXG4gIH0gcmV0dXJuIGl0W01FVEFdLnc7XG59O1xuLy8gYWRkIG1ldGFkYXRhIG9uIGZyZWV6ZS1mYW1pbHkgbWV0aG9kcyBjYWxsaW5nXG52YXIgb25GcmVlemUgPSBmdW5jdGlvbiAoaXQpIHtcbiAgaWYgKEZSRUVaRSAmJiBtZXRhLk5FRUQgJiYgaXNFeHRlbnNpYmxlKGl0KSAmJiAhaGFzKGl0LCBNRVRBKSkgc2V0TWV0YShpdCk7XG4gIHJldHVybiBpdDtcbn07XG52YXIgbWV0YSA9IG1vZHVsZS5leHBvcnRzID0ge1xuICBLRVk6IE1FVEEsXG4gIE5FRUQ6IGZhbHNlLFxuICBmYXN0S2V5OiBmYXN0S2V5LFxuICBnZXRXZWFrOiBnZXRXZWFrLFxuICBvbkZyZWV6ZTogb25GcmVlemVcbn07XG4iLCJ2YXIgZ2xvYmFsID0gcmVxdWlyZSgnLi9fZ2xvYmFsJyk7XG52YXIgbWFjcm90YXNrID0gcmVxdWlyZSgnLi9fdGFzaycpLnNldDtcbnZhciBPYnNlcnZlciA9IGdsb2JhbC5NdXRhdGlvbk9ic2VydmVyIHx8IGdsb2JhbC5XZWJLaXRNdXRhdGlvbk9ic2VydmVyO1xudmFyIHByb2Nlc3MgPSBnbG9iYWwucHJvY2VzcztcbnZhciBQcm9taXNlID0gZ2xvYmFsLlByb21pc2U7XG52YXIgaXNOb2RlID0gcmVxdWlyZSgnLi9fY29mJykocHJvY2VzcykgPT0gJ3Byb2Nlc3MnO1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIGhlYWQsIGxhc3QsIG5vdGlmeTtcblxuICB2YXIgZmx1c2ggPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHBhcmVudCwgZm47XG4gICAgaWYgKGlzTm9kZSAmJiAocGFyZW50ID0gcHJvY2Vzcy5kb21haW4pKSBwYXJlbnQuZXhpdCgpO1xuICAgIHdoaWxlIChoZWFkKSB7XG4gICAgICBmbiA9IGhlYWQuZm47XG4gICAgICBoZWFkID0gaGVhZC5uZXh0O1xuICAgICAgdHJ5IHtcbiAgICAgICAgZm4oKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgaWYgKGhlYWQpIG5vdGlmeSgpO1xuICAgICAgICBlbHNlIGxhc3QgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRocm93IGU7XG4gICAgICB9XG4gICAgfSBsYXN0ID0gdW5kZWZpbmVkO1xuICAgIGlmIChwYXJlbnQpIHBhcmVudC5lbnRlcigpO1xuICB9O1xuXG4gIC8vIE5vZGUuanNcbiAgaWYgKGlzTm9kZSkge1xuICAgIG5vdGlmeSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHByb2Nlc3MubmV4dFRpY2soZmx1c2gpO1xuICAgIH07XG4gIC8vIGJyb3dzZXJzIHdpdGggTXV0YXRpb25PYnNlcnZlciwgZXhjZXB0IGlPUyBTYWZhcmkgLSBodHRwczovL2dpdGh1Yi5jb20vemxvaXJvY2svY29yZS1qcy9pc3N1ZXMvMzM5XG4gIH0gZWxzZSBpZiAoT2JzZXJ2ZXIgJiYgIShnbG9iYWwubmF2aWdhdG9yICYmIGdsb2JhbC5uYXZpZ2F0b3Iuc3RhbmRhbG9uZSkpIHtcbiAgICB2YXIgdG9nZ2xlID0gdHJ1ZTtcbiAgICB2YXIgbm9kZSA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnKTtcbiAgICBuZXcgT2JzZXJ2ZXIoZmx1c2gpLm9ic2VydmUobm9kZSwgeyBjaGFyYWN0ZXJEYXRhOiB0cnVlIH0pOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLW5ld1xuICAgIG5vdGlmeSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIG5vZGUuZGF0YSA9IHRvZ2dsZSA9ICF0b2dnbGU7XG4gICAgfTtcbiAgLy8gZW52aXJvbm1lbnRzIHdpdGggbWF5YmUgbm9uLWNvbXBsZXRlbHkgY29ycmVjdCwgYnV0IGV4aXN0ZW50IFByb21pc2VcbiAgfSBlbHNlIGlmIChQcm9taXNlICYmIFByb21pc2UucmVzb2x2ZSkge1xuICAgIC8vIFByb21pc2UucmVzb2x2ZSB3aXRob3V0IGFuIGFyZ3VtZW50IHRocm93cyBhbiBlcnJvciBpbiBMRyBXZWJPUyAyXG4gICAgdmFyIHByb21pc2UgPSBQcm9taXNlLnJlc29sdmUodW5kZWZpbmVkKTtcbiAgICBub3RpZnkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBwcm9taXNlLnRoZW4oZmx1c2gpO1xuICAgIH07XG4gIC8vIGZvciBvdGhlciBlbnZpcm9ubWVudHMgLSBtYWNyb3Rhc2sgYmFzZWQgb246XG4gIC8vIC0gc2V0SW1tZWRpYXRlXG4gIC8vIC0gTWVzc2FnZUNoYW5uZWxcbiAgLy8gLSB3aW5kb3cucG9zdE1lc3NhZ1xuICAvLyAtIG9ucmVhZHlzdGF0ZWNoYW5nZVxuICAvLyAtIHNldFRpbWVvdXRcbiAgfSBlbHNlIHtcbiAgICBub3RpZnkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAvLyBzdHJhbmdlIElFICsgd2VicGFjayBkZXYgc2VydmVyIGJ1ZyAtIHVzZSAuY2FsbChnbG9iYWwpXG4gICAgICBtYWNyb3Rhc2suY2FsbChnbG9iYWwsIGZsdXNoKTtcbiAgICB9O1xuICB9XG5cbiAgcmV0dXJuIGZ1bmN0aW9uIChmbikge1xuICAgIHZhciB0YXNrID0geyBmbjogZm4sIG5leHQ6IHVuZGVmaW5lZCB9O1xuICAgIGlmIChsYXN0KSBsYXN0Lm5leHQgPSB0YXNrO1xuICAgIGlmICghaGVhZCkge1xuICAgICAgaGVhZCA9IHRhc2s7XG4gICAgICBub3RpZnkoKTtcbiAgICB9IGxhc3QgPSB0YXNrO1xuICB9O1xufTtcbiIsIid1c2Ugc3RyaWN0Jztcbi8vIDI1LjQuMS41IE5ld1Byb21pc2VDYXBhYmlsaXR5KEMpXG52YXIgYUZ1bmN0aW9uID0gcmVxdWlyZSgnLi9fYS1mdW5jdGlvbicpO1xuXG5mdW5jdGlvbiBQcm9taXNlQ2FwYWJpbGl0eShDKSB7XG4gIHZhciByZXNvbHZlLCByZWplY3Q7XG4gIHRoaXMucHJvbWlzZSA9IG5ldyBDKGZ1bmN0aW9uICgkJHJlc29sdmUsICQkcmVqZWN0KSB7XG4gICAgaWYgKHJlc29sdmUgIT09IHVuZGVmaW5lZCB8fCByZWplY3QgIT09IHVuZGVmaW5lZCkgdGhyb3cgVHlwZUVycm9yKCdCYWQgUHJvbWlzZSBjb25zdHJ1Y3RvcicpO1xuICAgIHJlc29sdmUgPSAkJHJlc29sdmU7XG4gICAgcmVqZWN0ID0gJCRyZWplY3Q7XG4gIH0pO1xuICB0aGlzLnJlc29sdmUgPSBhRnVuY3Rpb24ocmVzb2x2ZSk7XG4gIHRoaXMucmVqZWN0ID0gYUZ1bmN0aW9uKHJlamVjdCk7XG59XG5cbm1vZHVsZS5leHBvcnRzLmYgPSBmdW5jdGlvbiAoQykge1xuICByZXR1cm4gbmV3IFByb21pc2VDYXBhYmlsaXR5KEMpO1xufTtcbiIsIi8vIDE5LjEuMi4yIC8gMTUuMi4zLjUgT2JqZWN0LmNyZWF0ZShPIFssIFByb3BlcnRpZXNdKVxudmFyIGFuT2JqZWN0ID0gcmVxdWlyZSgnLi9fYW4tb2JqZWN0Jyk7XG52YXIgZFBzID0gcmVxdWlyZSgnLi9fb2JqZWN0LWRwcycpO1xudmFyIGVudW1CdWdLZXlzID0gcmVxdWlyZSgnLi9fZW51bS1idWcta2V5cycpO1xudmFyIElFX1BST1RPID0gcmVxdWlyZSgnLi9fc2hhcmVkLWtleScpKCdJRV9QUk9UTycpO1xudmFyIEVtcHR5ID0gZnVuY3Rpb24gKCkgeyAvKiBlbXB0eSAqLyB9O1xudmFyIFBST1RPVFlQRSA9ICdwcm90b3R5cGUnO1xuXG4vLyBDcmVhdGUgb2JqZWN0IHdpdGggZmFrZSBgbnVsbGAgcHJvdG90eXBlOiB1c2UgaWZyYW1lIE9iamVjdCB3aXRoIGNsZWFyZWQgcHJvdG90eXBlXG52YXIgY3JlYXRlRGljdCA9IGZ1bmN0aW9uICgpIHtcbiAgLy8gVGhyYXNoLCB3YXN0ZSBhbmQgc29kb215OiBJRSBHQyBidWdcbiAgdmFyIGlmcmFtZSA9IHJlcXVpcmUoJy4vX2RvbS1jcmVhdGUnKSgnaWZyYW1lJyk7XG4gIHZhciBpID0gZW51bUJ1Z0tleXMubGVuZ3RoO1xuICB2YXIgbHQgPSAnPCc7XG4gIHZhciBndCA9ICc+JztcbiAgdmFyIGlmcmFtZURvY3VtZW50O1xuICBpZnJhbWUuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgcmVxdWlyZSgnLi9faHRtbCcpLmFwcGVuZENoaWxkKGlmcmFtZSk7XG4gIGlmcmFtZS5zcmMgPSAnamF2YXNjcmlwdDonOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXNjcmlwdC11cmxcbiAgLy8gY3JlYXRlRGljdCA9IGlmcmFtZS5jb250ZW50V2luZG93Lk9iamVjdDtcbiAgLy8gaHRtbC5yZW1vdmVDaGlsZChpZnJhbWUpO1xuICBpZnJhbWVEb2N1bWVudCA9IGlmcmFtZS5jb250ZW50V2luZG93LmRvY3VtZW50O1xuICBpZnJhbWVEb2N1bWVudC5vcGVuKCk7XG4gIGlmcmFtZURvY3VtZW50LndyaXRlKGx0ICsgJ3NjcmlwdCcgKyBndCArICdkb2N1bWVudC5GPU9iamVjdCcgKyBsdCArICcvc2NyaXB0JyArIGd0KTtcbiAgaWZyYW1lRG9jdW1lbnQuY2xvc2UoKTtcbiAgY3JlYXRlRGljdCA9IGlmcmFtZURvY3VtZW50LkY7XG4gIHdoaWxlIChpLS0pIGRlbGV0ZSBjcmVhdGVEaWN0W1BST1RPVFlQRV1bZW51bUJ1Z0tleXNbaV1dO1xuICByZXR1cm4gY3JlYXRlRGljdCgpO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBPYmplY3QuY3JlYXRlIHx8IGZ1bmN0aW9uIGNyZWF0ZShPLCBQcm9wZXJ0aWVzKSB7XG4gIHZhciByZXN1bHQ7XG4gIGlmIChPICE9PSBudWxsKSB7XG4gICAgRW1wdHlbUFJPVE9UWVBFXSA9IGFuT2JqZWN0KE8pO1xuICAgIHJlc3VsdCA9IG5ldyBFbXB0eSgpO1xuICAgIEVtcHR5W1BST1RPVFlQRV0gPSBudWxsO1xuICAgIC8vIGFkZCBcIl9fcHJvdG9fX1wiIGZvciBPYmplY3QuZ2V0UHJvdG90eXBlT2YgcG9seWZpbGxcbiAgICByZXN1bHRbSUVfUFJPVE9dID0gTztcbiAgfSBlbHNlIHJlc3VsdCA9IGNyZWF0ZURpY3QoKTtcbiAgcmV0dXJuIFByb3BlcnRpZXMgPT09IHVuZGVmaW5lZCA/IHJlc3VsdCA6IGRQcyhyZXN1bHQsIFByb3BlcnRpZXMpO1xufTtcbiIsInZhciBhbk9iamVjdCA9IHJlcXVpcmUoJy4vX2FuLW9iamVjdCcpO1xudmFyIElFOF9ET01fREVGSU5FID0gcmVxdWlyZSgnLi9faWU4LWRvbS1kZWZpbmUnKTtcbnZhciB0b1ByaW1pdGl2ZSA9IHJlcXVpcmUoJy4vX3RvLXByaW1pdGl2ZScpO1xudmFyIGRQID0gT2JqZWN0LmRlZmluZVByb3BlcnR5O1xuXG5leHBvcnRzLmYgPSByZXF1aXJlKCcuL19kZXNjcmlwdG9ycycpID8gT2JqZWN0LmRlZmluZVByb3BlcnR5IDogZnVuY3Rpb24gZGVmaW5lUHJvcGVydHkoTywgUCwgQXR0cmlidXRlcykge1xuICBhbk9iamVjdChPKTtcbiAgUCA9IHRvUHJpbWl0aXZlKFAsIHRydWUpO1xuICBhbk9iamVjdChBdHRyaWJ1dGVzKTtcbiAgaWYgKElFOF9ET01fREVGSU5FKSB0cnkge1xuICAgIHJldHVybiBkUChPLCBQLCBBdHRyaWJ1dGVzKTtcbiAgfSBjYXRjaCAoZSkgeyAvKiBlbXB0eSAqLyB9XG4gIGlmICgnZ2V0JyBpbiBBdHRyaWJ1dGVzIHx8ICdzZXQnIGluIEF0dHJpYnV0ZXMpIHRocm93IFR5cGVFcnJvcignQWNjZXNzb3JzIG5vdCBzdXBwb3J0ZWQhJyk7XG4gIGlmICgndmFsdWUnIGluIEF0dHJpYnV0ZXMpIE9bUF0gPSBBdHRyaWJ1dGVzLnZhbHVlO1xuICByZXR1cm4gTztcbn07XG4iLCJ2YXIgZFAgPSByZXF1aXJlKCcuL19vYmplY3QtZHAnKTtcbnZhciBhbk9iamVjdCA9IHJlcXVpcmUoJy4vX2FuLW9iamVjdCcpO1xudmFyIGdldEtleXMgPSByZXF1aXJlKCcuL19vYmplY3Qta2V5cycpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoJy4vX2Rlc2NyaXB0b3JzJykgPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyA6IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXMoTywgUHJvcGVydGllcykge1xuICBhbk9iamVjdChPKTtcbiAgdmFyIGtleXMgPSBnZXRLZXlzKFByb3BlcnRpZXMpO1xuICB2YXIgbGVuZ3RoID0ga2V5cy5sZW5ndGg7XG4gIHZhciBpID0gMDtcbiAgdmFyIFA7XG4gIHdoaWxlIChsZW5ndGggPiBpKSBkUC5mKE8sIFAgPSBrZXlzW2krK10sIFByb3BlcnRpZXNbUF0pO1xuICByZXR1cm4gTztcbn07XG4iLCJ2YXIgcElFID0gcmVxdWlyZSgnLi9fb2JqZWN0LXBpZScpO1xudmFyIGNyZWF0ZURlc2MgPSByZXF1aXJlKCcuL19wcm9wZXJ0eS1kZXNjJyk7XG52YXIgdG9JT2JqZWN0ID0gcmVxdWlyZSgnLi9fdG8taW9iamVjdCcpO1xudmFyIHRvUHJpbWl0aXZlID0gcmVxdWlyZSgnLi9fdG8tcHJpbWl0aXZlJyk7XG52YXIgaGFzID0gcmVxdWlyZSgnLi9faGFzJyk7XG52YXIgSUU4X0RPTV9ERUZJTkUgPSByZXF1aXJlKCcuL19pZTgtZG9tLWRlZmluZScpO1xudmFyIGdPUEQgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yO1xuXG5leHBvcnRzLmYgPSByZXF1aXJlKCcuL19kZXNjcmlwdG9ycycpID8gZ09QRCA6IGZ1bmN0aW9uIGdldE93blByb3BlcnR5RGVzY3JpcHRvcihPLCBQKSB7XG4gIE8gPSB0b0lPYmplY3QoTyk7XG4gIFAgPSB0b1ByaW1pdGl2ZShQLCB0cnVlKTtcbiAgaWYgKElFOF9ET01fREVGSU5FKSB0cnkge1xuICAgIHJldHVybiBnT1BEKE8sIFApO1xuICB9IGNhdGNoIChlKSB7IC8qIGVtcHR5ICovIH1cbiAgaWYgKGhhcyhPLCBQKSkgcmV0dXJuIGNyZWF0ZURlc2MoIXBJRS5mLmNhbGwoTywgUCksIE9bUF0pO1xufTtcbiIsIi8vIGZhbGxiYWNrIGZvciBJRTExIGJ1Z2d5IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzIHdpdGggaWZyYW1lIGFuZCB3aW5kb3dcbnZhciB0b0lPYmplY3QgPSByZXF1aXJlKCcuL190by1pb2JqZWN0Jyk7XG52YXIgZ09QTiA9IHJlcXVpcmUoJy4vX29iamVjdC1nb3BuJykuZjtcbnZhciB0b1N0cmluZyA9IHt9LnRvU3RyaW5nO1xuXG52YXIgd2luZG93TmFtZXMgPSB0eXBlb2Ygd2luZG93ID09ICdvYmplY3QnICYmIHdpbmRvdyAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lc1xuICA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHdpbmRvdykgOiBbXTtcblxudmFyIGdldFdpbmRvd05hbWVzID0gZnVuY3Rpb24gKGl0KSB7XG4gIHRyeSB7XG4gICAgcmV0dXJuIGdPUE4oaXQpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgcmV0dXJuIHdpbmRvd05hbWVzLnNsaWNlKCk7XG4gIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzLmYgPSBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eU5hbWVzKGl0KSB7XG4gIHJldHVybiB3aW5kb3dOYW1lcyAmJiB0b1N0cmluZy5jYWxsKGl0KSA9PSAnW29iamVjdCBXaW5kb3ddJyA/IGdldFdpbmRvd05hbWVzKGl0KSA6IGdPUE4odG9JT2JqZWN0KGl0KSk7XG59O1xuIiwiLy8gMTkuMS4yLjcgLyAxNS4yLjMuNCBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhPKVxudmFyICRrZXlzID0gcmVxdWlyZSgnLi9fb2JqZWN0LWtleXMtaW50ZXJuYWwnKTtcbnZhciBoaWRkZW5LZXlzID0gcmVxdWlyZSgnLi9fZW51bS1idWcta2V5cycpLmNvbmNhdCgnbGVuZ3RoJywgJ3Byb3RvdHlwZScpO1xuXG5leHBvcnRzLmYgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyB8fCBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eU5hbWVzKE8pIHtcbiAgcmV0dXJuICRrZXlzKE8sIGhpZGRlbktleXMpO1xufTtcbiIsImV4cG9ydHMuZiA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHM7XG4iLCIvLyAxOS4xLjIuOSAvIDE1LjIuMy4yIE9iamVjdC5nZXRQcm90b3R5cGVPZihPKVxudmFyIGhhcyA9IHJlcXVpcmUoJy4vX2hhcycpO1xudmFyIHRvT2JqZWN0ID0gcmVxdWlyZSgnLi9fdG8tb2JqZWN0Jyk7XG52YXIgSUVfUFJPVE8gPSByZXF1aXJlKCcuL19zaGFyZWQta2V5JykoJ0lFX1BST1RPJyk7XG52YXIgT2JqZWN0UHJvdG8gPSBPYmplY3QucHJvdG90eXBlO1xuXG5tb2R1bGUuZXhwb3J0cyA9IE9iamVjdC5nZXRQcm90b3R5cGVPZiB8fCBmdW5jdGlvbiAoTykge1xuICBPID0gdG9PYmplY3QoTyk7XG4gIGlmIChoYXMoTywgSUVfUFJPVE8pKSByZXR1cm4gT1tJRV9QUk9UT107XG4gIGlmICh0eXBlb2YgTy5jb25zdHJ1Y3RvciA9PSAnZnVuY3Rpb24nICYmIE8gaW5zdGFuY2VvZiBPLmNvbnN0cnVjdG9yKSB7XG4gICAgcmV0dXJuIE8uY29uc3RydWN0b3IucHJvdG90eXBlO1xuICB9IHJldHVybiBPIGluc3RhbmNlb2YgT2JqZWN0ID8gT2JqZWN0UHJvdG8gOiBudWxsO1xufTtcbiIsInZhciBoYXMgPSByZXF1aXJlKCcuL19oYXMnKTtcbnZhciB0b0lPYmplY3QgPSByZXF1aXJlKCcuL190by1pb2JqZWN0Jyk7XG52YXIgYXJyYXlJbmRleE9mID0gcmVxdWlyZSgnLi9fYXJyYXktaW5jbHVkZXMnKShmYWxzZSk7XG52YXIgSUVfUFJPVE8gPSByZXF1aXJlKCcuL19zaGFyZWQta2V5JykoJ0lFX1BST1RPJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKG9iamVjdCwgbmFtZXMpIHtcbiAgdmFyIE8gPSB0b0lPYmplY3Qob2JqZWN0KTtcbiAgdmFyIGkgPSAwO1xuICB2YXIgcmVzdWx0ID0gW107XG4gIHZhciBrZXk7XG4gIGZvciAoa2V5IGluIE8pIGlmIChrZXkgIT0gSUVfUFJPVE8pIGhhcyhPLCBrZXkpICYmIHJlc3VsdC5wdXNoKGtleSk7XG4gIC8vIERvbid0IGVudW0gYnVnICYgaGlkZGVuIGtleXNcbiAgd2hpbGUgKG5hbWVzLmxlbmd0aCA+IGkpIGlmIChoYXMoTywga2V5ID0gbmFtZXNbaSsrXSkpIHtcbiAgICB+YXJyYXlJbmRleE9mKHJlc3VsdCwga2V5KSB8fCByZXN1bHQucHVzaChrZXkpO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59O1xuIiwiLy8gMTkuMS4yLjE0IC8gMTUuMi4zLjE0IE9iamVjdC5rZXlzKE8pXG52YXIgJGtleXMgPSByZXF1aXJlKCcuL19vYmplY3Qta2V5cy1pbnRlcm5hbCcpO1xudmFyIGVudW1CdWdLZXlzID0gcmVxdWlyZSgnLi9fZW51bS1idWcta2V5cycpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IE9iamVjdC5rZXlzIHx8IGZ1bmN0aW9uIGtleXMoTykge1xuICByZXR1cm4gJGtleXMoTywgZW51bUJ1Z0tleXMpO1xufTtcbiIsImV4cG9ydHMuZiA9IHt9LnByb3BlcnR5SXNFbnVtZXJhYmxlO1xuIiwiLy8gbW9zdCBPYmplY3QgbWV0aG9kcyBieSBFUzYgc2hvdWxkIGFjY2VwdCBwcmltaXRpdmVzXG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xudmFyIGNvcmUgPSByZXF1aXJlKCcuL19jb3JlJyk7XG52YXIgZmFpbHMgPSByZXF1aXJlKCcuL19mYWlscycpO1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoS0VZLCBleGVjKSB7XG4gIHZhciBmbiA9IChjb3JlLk9iamVjdCB8fCB7fSlbS0VZXSB8fCBPYmplY3RbS0VZXTtcbiAgdmFyIGV4cCA9IHt9O1xuICBleHBbS0VZXSA9IGV4ZWMoZm4pO1xuICAkZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqIGZhaWxzKGZ1bmN0aW9uICgpIHsgZm4oMSk7IH0pLCAnT2JqZWN0JywgZXhwKTtcbn07XG4iLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChleGVjKSB7XG4gIHRyeSB7XG4gICAgcmV0dXJuIHsgZTogZmFsc2UsIHY6IGV4ZWMoKSB9O1xuICB9IGNhdGNoIChlKSB7XG4gICAgcmV0dXJuIHsgZTogdHJ1ZSwgdjogZSB9O1xuICB9XG59O1xuIiwidmFyIGFuT2JqZWN0ID0gcmVxdWlyZSgnLi9fYW4tb2JqZWN0Jyk7XG52YXIgaXNPYmplY3QgPSByZXF1aXJlKCcuL19pcy1vYmplY3QnKTtcbnZhciBuZXdQcm9taXNlQ2FwYWJpbGl0eSA9IHJlcXVpcmUoJy4vX25ldy1wcm9taXNlLWNhcGFiaWxpdHknKTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoQywgeCkge1xuICBhbk9iamVjdChDKTtcbiAgaWYgKGlzT2JqZWN0KHgpICYmIHguY29uc3RydWN0b3IgPT09IEMpIHJldHVybiB4O1xuICB2YXIgcHJvbWlzZUNhcGFiaWxpdHkgPSBuZXdQcm9taXNlQ2FwYWJpbGl0eS5mKEMpO1xuICB2YXIgcmVzb2x2ZSA9IHByb21pc2VDYXBhYmlsaXR5LnJlc29sdmU7XG4gIHJlc29sdmUoeCk7XG4gIHJldHVybiBwcm9taXNlQ2FwYWJpbGl0eS5wcm9taXNlO1xufTtcbiIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGJpdG1hcCwgdmFsdWUpIHtcbiAgcmV0dXJuIHtcbiAgICBlbnVtZXJhYmxlOiAhKGJpdG1hcCAmIDEpLFxuICAgIGNvbmZpZ3VyYWJsZTogIShiaXRtYXAgJiAyKSxcbiAgICB3cml0YWJsZTogIShiaXRtYXAgJiA0KSxcbiAgICB2YWx1ZTogdmFsdWVcbiAgfTtcbn07XG4iLCJ2YXIgaGlkZSA9IHJlcXVpcmUoJy4vX2hpZGUnKTtcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKHRhcmdldCwgc3JjLCBzYWZlKSB7XG4gIGZvciAodmFyIGtleSBpbiBzcmMpIHtcbiAgICBpZiAoc2FmZSAmJiB0YXJnZXRba2V5XSkgdGFyZ2V0W2tleV0gPSBzcmNba2V5XTtcbiAgICBlbHNlIGhpZGUodGFyZ2V0LCBrZXksIHNyY1trZXldKTtcbiAgfSByZXR1cm4gdGFyZ2V0O1xufTtcbiIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi9faGlkZScpO1xuIiwiLy8gV29ya3Mgd2l0aCBfX3Byb3RvX18gb25seS4gT2xkIHY4IGNhbid0IHdvcmsgd2l0aCBudWxsIHByb3RvIG9iamVjdHMuXG4vKiBlc2xpbnQtZGlzYWJsZSBuby1wcm90byAqL1xudmFyIGlzT2JqZWN0ID0gcmVxdWlyZSgnLi9faXMtb2JqZWN0Jyk7XG52YXIgYW5PYmplY3QgPSByZXF1aXJlKCcuL19hbi1vYmplY3QnKTtcbnZhciBjaGVjayA9IGZ1bmN0aW9uIChPLCBwcm90bykge1xuICBhbk9iamVjdChPKTtcbiAgaWYgKCFpc09iamVjdChwcm90bykgJiYgcHJvdG8gIT09IG51bGwpIHRocm93IFR5cGVFcnJvcihwcm90byArIFwiOiBjYW4ndCBzZXQgYXMgcHJvdG90eXBlIVwiKTtcbn07XG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgc2V0OiBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgKCdfX3Byb3RvX18nIGluIHt9ID8gLy8gZXNsaW50LWRpc2FibGUtbGluZVxuICAgIGZ1bmN0aW9uICh0ZXN0LCBidWdneSwgc2V0KSB7XG4gICAgICB0cnkge1xuICAgICAgICBzZXQgPSByZXF1aXJlKCcuL19jdHgnKShGdW5jdGlvbi5jYWxsLCByZXF1aXJlKCcuL19vYmplY3QtZ29wZCcpLmYoT2JqZWN0LnByb3RvdHlwZSwgJ19fcHJvdG9fXycpLnNldCwgMik7XG4gICAgICAgIHNldCh0ZXN0LCBbXSk7XG4gICAgICAgIGJ1Z2d5ID0gISh0ZXN0IGluc3RhbmNlb2YgQXJyYXkpO1xuICAgICAgfSBjYXRjaCAoZSkgeyBidWdneSA9IHRydWU7IH1cbiAgICAgIHJldHVybiBmdW5jdGlvbiBzZXRQcm90b3R5cGVPZihPLCBwcm90bykge1xuICAgICAgICBjaGVjayhPLCBwcm90byk7XG4gICAgICAgIGlmIChidWdneSkgTy5fX3Byb3RvX18gPSBwcm90bztcbiAgICAgICAgZWxzZSBzZXQoTywgcHJvdG8pO1xuICAgICAgICByZXR1cm4gTztcbiAgICAgIH07XG4gICAgfSh7fSwgZmFsc2UpIDogdW5kZWZpbmVkKSxcbiAgY2hlY2s6IGNoZWNrXG59O1xuIiwiJ3VzZSBzdHJpY3QnO1xudmFyIGdsb2JhbCA9IHJlcXVpcmUoJy4vX2dsb2JhbCcpO1xudmFyIGNvcmUgPSByZXF1aXJlKCcuL19jb3JlJyk7XG52YXIgZFAgPSByZXF1aXJlKCcuL19vYmplY3QtZHAnKTtcbnZhciBERVNDUklQVE9SUyA9IHJlcXVpcmUoJy4vX2Rlc2NyaXB0b3JzJyk7XG52YXIgU1BFQ0lFUyA9IHJlcXVpcmUoJy4vX3drcycpKCdzcGVjaWVzJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKEtFWSkge1xuICB2YXIgQyA9IHR5cGVvZiBjb3JlW0tFWV0gPT0gJ2Z1bmN0aW9uJyA/IGNvcmVbS0VZXSA6IGdsb2JhbFtLRVldO1xuICBpZiAoREVTQ1JJUFRPUlMgJiYgQyAmJiAhQ1tTUEVDSUVTXSkgZFAuZihDLCBTUEVDSUVTLCB7XG4gICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfVxuICB9KTtcbn07XG4iLCJ2YXIgZGVmID0gcmVxdWlyZSgnLi9fb2JqZWN0LWRwJykuZjtcbnZhciBoYXMgPSByZXF1aXJlKCcuL19oYXMnKTtcbnZhciBUQUcgPSByZXF1aXJlKCcuL193a3MnKSgndG9TdHJpbmdUYWcnKTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQsIHRhZywgc3RhdCkge1xuICBpZiAoaXQgJiYgIWhhcyhpdCA9IHN0YXQgPyBpdCA6IGl0LnByb3RvdHlwZSwgVEFHKSkgZGVmKGl0LCBUQUcsIHsgY29uZmlndXJhYmxlOiB0cnVlLCB2YWx1ZTogdGFnIH0pO1xufTtcbiIsInZhciBzaGFyZWQgPSByZXF1aXJlKCcuL19zaGFyZWQnKSgna2V5cycpO1xudmFyIHVpZCA9IHJlcXVpcmUoJy4vX3VpZCcpO1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoa2V5KSB7XG4gIHJldHVybiBzaGFyZWRba2V5XSB8fCAoc2hhcmVkW2tleV0gPSB1aWQoa2V5KSk7XG59O1xuIiwidmFyIGNvcmUgPSByZXF1aXJlKCcuL19jb3JlJyk7XG52YXIgZ2xvYmFsID0gcmVxdWlyZSgnLi9fZ2xvYmFsJyk7XG52YXIgU0hBUkVEID0gJ19fY29yZS1qc19zaGFyZWRfXyc7XG52YXIgc3RvcmUgPSBnbG9iYWxbU0hBUkVEXSB8fCAoZ2xvYmFsW1NIQVJFRF0gPSB7fSk7XG5cbihtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gIHJldHVybiBzdG9yZVtrZXldIHx8IChzdG9yZVtrZXldID0gdmFsdWUgIT09IHVuZGVmaW5lZCA/IHZhbHVlIDoge30pO1xufSkoJ3ZlcnNpb25zJywgW10pLnB1c2goe1xuICB2ZXJzaW9uOiBjb3JlLnZlcnNpb24sXG4gIG1vZGU6IHJlcXVpcmUoJy4vX2xpYnJhcnknKSA/ICdwdXJlJyA6ICdnbG9iYWwnLFxuICBjb3B5cmlnaHQ6ICfCqSAyMDIwIERlbmlzIFB1c2hrYXJldiAoemxvaXJvY2sucnUpJ1xufSk7XG4iLCIvLyA3LjMuMjAgU3BlY2llc0NvbnN0cnVjdG9yKE8sIGRlZmF1bHRDb25zdHJ1Y3RvcilcbnZhciBhbk9iamVjdCA9IHJlcXVpcmUoJy4vX2FuLW9iamVjdCcpO1xudmFyIGFGdW5jdGlvbiA9IHJlcXVpcmUoJy4vX2EtZnVuY3Rpb24nKTtcbnZhciBTUEVDSUVTID0gcmVxdWlyZSgnLi9fd2tzJykoJ3NwZWNpZXMnKTtcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKE8sIEQpIHtcbiAgdmFyIEMgPSBhbk9iamVjdChPKS5jb25zdHJ1Y3RvcjtcbiAgdmFyIFM7XG4gIHJldHVybiBDID09PSB1bmRlZmluZWQgfHwgKFMgPSBhbk9iamVjdChDKVtTUEVDSUVTXSkgPT0gdW5kZWZpbmVkID8gRCA6IGFGdW5jdGlvbihTKTtcbn07XG4iLCJ2YXIgdG9JbnRlZ2VyID0gcmVxdWlyZSgnLi9fdG8taW50ZWdlcicpO1xudmFyIGRlZmluZWQgPSByZXF1aXJlKCcuL19kZWZpbmVkJyk7XG4vLyB0cnVlICAtPiBTdHJpbmcjYXRcbi8vIGZhbHNlIC0+IFN0cmluZyNjb2RlUG9pbnRBdFxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoVE9fU1RSSU5HKSB7XG4gIHJldHVybiBmdW5jdGlvbiAodGhhdCwgcG9zKSB7XG4gICAgdmFyIHMgPSBTdHJpbmcoZGVmaW5lZCh0aGF0KSk7XG4gICAgdmFyIGkgPSB0b0ludGVnZXIocG9zKTtcbiAgICB2YXIgbCA9IHMubGVuZ3RoO1xuICAgIHZhciBhLCBiO1xuICAgIGlmIChpIDwgMCB8fCBpID49IGwpIHJldHVybiBUT19TVFJJTkcgPyAnJyA6IHVuZGVmaW5lZDtcbiAgICBhID0gcy5jaGFyQ29kZUF0KGkpO1xuICAgIHJldHVybiBhIDwgMHhkODAwIHx8IGEgPiAweGRiZmYgfHwgaSArIDEgPT09IGwgfHwgKGIgPSBzLmNoYXJDb2RlQXQoaSArIDEpKSA8IDB4ZGMwMCB8fCBiID4gMHhkZmZmXG4gICAgICA/IFRPX1NUUklORyA/IHMuY2hhckF0KGkpIDogYVxuICAgICAgOiBUT19TVFJJTkcgPyBzLnNsaWNlKGksIGkgKyAyKSA6IChhIC0gMHhkODAwIDw8IDEwKSArIChiIC0gMHhkYzAwKSArIDB4MTAwMDA7XG4gIH07XG59O1xuIiwidmFyIGN0eCA9IHJlcXVpcmUoJy4vX2N0eCcpO1xudmFyIGludm9rZSA9IHJlcXVpcmUoJy4vX2ludm9rZScpO1xudmFyIGh0bWwgPSByZXF1aXJlKCcuL19odG1sJyk7XG52YXIgY2VsID0gcmVxdWlyZSgnLi9fZG9tLWNyZWF0ZScpO1xudmFyIGdsb2JhbCA9IHJlcXVpcmUoJy4vX2dsb2JhbCcpO1xudmFyIHByb2Nlc3MgPSBnbG9iYWwucHJvY2VzcztcbnZhciBzZXRUYXNrID0gZ2xvYmFsLnNldEltbWVkaWF0ZTtcbnZhciBjbGVhclRhc2sgPSBnbG9iYWwuY2xlYXJJbW1lZGlhdGU7XG52YXIgTWVzc2FnZUNoYW5uZWwgPSBnbG9iYWwuTWVzc2FnZUNoYW5uZWw7XG52YXIgRGlzcGF0Y2ggPSBnbG9iYWwuRGlzcGF0Y2g7XG52YXIgY291bnRlciA9IDA7XG52YXIgcXVldWUgPSB7fTtcbnZhciBPTlJFQURZU1RBVEVDSEFOR0UgPSAnb25yZWFkeXN0YXRlY2hhbmdlJztcbnZhciBkZWZlciwgY2hhbm5lbCwgcG9ydDtcbnZhciBydW4gPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBpZCA9ICt0aGlzO1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcHJvdG90eXBlLWJ1aWx0aW5zXG4gIGlmIChxdWV1ZS5oYXNPd25Qcm9wZXJ0eShpZCkpIHtcbiAgICB2YXIgZm4gPSBxdWV1ZVtpZF07XG4gICAgZGVsZXRlIHF1ZXVlW2lkXTtcbiAgICBmbigpO1xuICB9XG59O1xudmFyIGxpc3RlbmVyID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gIHJ1bi5jYWxsKGV2ZW50LmRhdGEpO1xufTtcbi8vIE5vZGUuanMgMC45KyAmIElFMTArIGhhcyBzZXRJbW1lZGlhdGUsIG90aGVyd2lzZTpcbmlmICghc2V0VGFzayB8fCAhY2xlYXJUYXNrKSB7XG4gIHNldFRhc2sgPSBmdW5jdGlvbiBzZXRJbW1lZGlhdGUoZm4pIHtcbiAgICB2YXIgYXJncyA9IFtdO1xuICAgIHZhciBpID0gMTtcbiAgICB3aGlsZSAoYXJndW1lbnRzLmxlbmd0aCA+IGkpIGFyZ3MucHVzaChhcmd1bWVudHNbaSsrXSk7XG4gICAgcXVldWVbKytjb3VudGVyXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1uZXctZnVuY1xuICAgICAgaW52b2tlKHR5cGVvZiBmbiA9PSAnZnVuY3Rpb24nID8gZm4gOiBGdW5jdGlvbihmbiksIGFyZ3MpO1xuICAgIH07XG4gICAgZGVmZXIoY291bnRlcik7XG4gICAgcmV0dXJuIGNvdW50ZXI7XG4gIH07XG4gIGNsZWFyVGFzayA9IGZ1bmN0aW9uIGNsZWFySW1tZWRpYXRlKGlkKSB7XG4gICAgZGVsZXRlIHF1ZXVlW2lkXTtcbiAgfTtcbiAgLy8gTm9kZS5qcyAwLjgtXG4gIGlmIChyZXF1aXJlKCcuL19jb2YnKShwcm9jZXNzKSA9PSAncHJvY2VzcycpIHtcbiAgICBkZWZlciA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgcHJvY2Vzcy5uZXh0VGljayhjdHgocnVuLCBpZCwgMSkpO1xuICAgIH07XG4gIC8vIFNwaGVyZSAoSlMgZ2FtZSBlbmdpbmUpIERpc3BhdGNoIEFQSVxuICB9IGVsc2UgaWYgKERpc3BhdGNoICYmIERpc3BhdGNoLm5vdykge1xuICAgIGRlZmVyID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICBEaXNwYXRjaC5ub3coY3R4KHJ1biwgaWQsIDEpKTtcbiAgICB9O1xuICAvLyBCcm93c2VycyB3aXRoIE1lc3NhZ2VDaGFubmVsLCBpbmNsdWRlcyBXZWJXb3JrZXJzXG4gIH0gZWxzZSBpZiAoTWVzc2FnZUNoYW5uZWwpIHtcbiAgICBjaGFubmVsID0gbmV3IE1lc3NhZ2VDaGFubmVsKCk7XG4gICAgcG9ydCA9IGNoYW5uZWwucG9ydDI7XG4gICAgY2hhbm5lbC5wb3J0MS5vbm1lc3NhZ2UgPSBsaXN0ZW5lcjtcbiAgICBkZWZlciA9IGN0eChwb3J0LnBvc3RNZXNzYWdlLCBwb3J0LCAxKTtcbiAgLy8gQnJvd3NlcnMgd2l0aCBwb3N0TWVzc2FnZSwgc2tpcCBXZWJXb3JrZXJzXG4gIC8vIElFOCBoYXMgcG9zdE1lc3NhZ2UsIGJ1dCBpdCdzIHN5bmMgJiB0eXBlb2YgaXRzIHBvc3RNZXNzYWdlIGlzICdvYmplY3QnXG4gIH0gZWxzZSBpZiAoZ2xvYmFsLmFkZEV2ZW50TGlzdGVuZXIgJiYgdHlwZW9mIHBvc3RNZXNzYWdlID09ICdmdW5jdGlvbicgJiYgIWdsb2JhbC5pbXBvcnRTY3JpcHRzKSB7XG4gICAgZGVmZXIgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgIGdsb2JhbC5wb3N0TWVzc2FnZShpZCArICcnLCAnKicpO1xuICAgIH07XG4gICAgZ2xvYmFsLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBsaXN0ZW5lciwgZmFsc2UpO1xuICAvLyBJRTgtXG4gIH0gZWxzZSBpZiAoT05SRUFEWVNUQVRFQ0hBTkdFIGluIGNlbCgnc2NyaXB0JykpIHtcbiAgICBkZWZlciA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgaHRtbC5hcHBlbmRDaGlsZChjZWwoJ3NjcmlwdCcpKVtPTlJFQURZU1RBVEVDSEFOR0VdID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBodG1sLnJlbW92ZUNoaWxkKHRoaXMpO1xuICAgICAgICBydW4uY2FsbChpZCk7XG4gICAgICB9O1xuICAgIH07XG4gIC8vIFJlc3Qgb2xkIGJyb3dzZXJzXG4gIH0gZWxzZSB7XG4gICAgZGVmZXIgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgIHNldFRpbWVvdXQoY3R4KHJ1biwgaWQsIDEpLCAwKTtcbiAgICB9O1xuICB9XG59XG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgc2V0OiBzZXRUYXNrLFxuICBjbGVhcjogY2xlYXJUYXNrXG59O1xuIiwidmFyIHRvSW50ZWdlciA9IHJlcXVpcmUoJy4vX3RvLWludGVnZXInKTtcbnZhciBtYXggPSBNYXRoLm1heDtcbnZhciBtaW4gPSBNYXRoLm1pbjtcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGluZGV4LCBsZW5ndGgpIHtcbiAgaW5kZXggPSB0b0ludGVnZXIoaW5kZXgpO1xuICByZXR1cm4gaW5kZXggPCAwID8gbWF4KGluZGV4ICsgbGVuZ3RoLCAwKSA6IG1pbihpbmRleCwgbGVuZ3RoKTtcbn07XG4iLCIvLyA3LjEuNCBUb0ludGVnZXJcbnZhciBjZWlsID0gTWF0aC5jZWlsO1xudmFyIGZsb29yID0gTWF0aC5mbG9vcjtcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7XG4gIHJldHVybiBpc05hTihpdCA9ICtpdCkgPyAwIDogKGl0ID4gMCA/IGZsb29yIDogY2VpbCkoaXQpO1xufTtcbiIsIi8vIHRvIGluZGV4ZWQgb2JqZWN0LCB0b09iamVjdCB3aXRoIGZhbGxiYWNrIGZvciBub24tYXJyYXktbGlrZSBFUzMgc3RyaW5nc1xudmFyIElPYmplY3QgPSByZXF1aXJlKCcuL19pb2JqZWN0Jyk7XG52YXIgZGVmaW5lZCA9IHJlcXVpcmUoJy4vX2RlZmluZWQnKTtcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKGl0KSB7XG4gIHJldHVybiBJT2JqZWN0KGRlZmluZWQoaXQpKTtcbn07XG4iLCIvLyA3LjEuMTUgVG9MZW5ndGhcbnZhciB0b0ludGVnZXIgPSByZXF1aXJlKCcuL190by1pbnRlZ2VyJyk7XG52YXIgbWluID0gTWF0aC5taW47XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChpdCkge1xuICByZXR1cm4gaXQgPiAwID8gbWluKHRvSW50ZWdlcihpdCksIDB4MWZmZmZmZmZmZmZmZmYpIDogMDsgLy8gcG93KDIsIDUzKSAtIDEgPT0gOTAwNzE5OTI1NDc0MDk5MVxufTtcbiIsIi8vIDcuMS4xMyBUb09iamVjdChhcmd1bWVudClcbnZhciBkZWZpbmVkID0gcmVxdWlyZSgnLi9fZGVmaW5lZCcpO1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQpIHtcbiAgcmV0dXJuIE9iamVjdChkZWZpbmVkKGl0KSk7XG59O1xuIiwiLy8gNy4xLjEgVG9QcmltaXRpdmUoaW5wdXQgWywgUHJlZmVycmVkVHlwZV0pXG52YXIgaXNPYmplY3QgPSByZXF1aXJlKCcuL19pcy1vYmplY3QnKTtcbi8vIGluc3RlYWQgb2YgdGhlIEVTNiBzcGVjIHZlcnNpb24sIHdlIGRpZG4ndCBpbXBsZW1lbnQgQEB0b1ByaW1pdGl2ZSBjYXNlXG4vLyBhbmQgdGhlIHNlY29uZCBhcmd1bWVudCAtIGZsYWcgLSBwcmVmZXJyZWQgdHlwZSBpcyBhIHN0cmluZ1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoaXQsIFMpIHtcbiAgaWYgKCFpc09iamVjdChpdCkpIHJldHVybiBpdDtcbiAgdmFyIGZuLCB2YWw7XG4gIGlmIChTICYmIHR5cGVvZiAoZm4gPSBpdC50b1N0cmluZykgPT0gJ2Z1bmN0aW9uJyAmJiAhaXNPYmplY3QodmFsID0gZm4uY2FsbChpdCkpKSByZXR1cm4gdmFsO1xuICBpZiAodHlwZW9mIChmbiA9IGl0LnZhbHVlT2YpID09ICdmdW5jdGlvbicgJiYgIWlzT2JqZWN0KHZhbCA9IGZuLmNhbGwoaXQpKSkgcmV0dXJuIHZhbDtcbiAgaWYgKCFTICYmIHR5cGVvZiAoZm4gPSBpdC50b1N0cmluZykgPT0gJ2Z1bmN0aW9uJyAmJiAhaXNPYmplY3QodmFsID0gZm4uY2FsbChpdCkpKSByZXR1cm4gdmFsO1xuICB0aHJvdyBUeXBlRXJyb3IoXCJDYW4ndCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWVcIik7XG59O1xuIiwidmFyIGlkID0gMDtcbnZhciBweCA9IE1hdGgucmFuZG9tKCk7XG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChrZXkpIHtcbiAgcmV0dXJuICdTeW1ib2woJy5jb25jYXQoa2V5ID09PSB1bmRlZmluZWQgPyAnJyA6IGtleSwgJylfJywgKCsraWQgKyBweCkudG9TdHJpbmcoMzYpKTtcbn07XG4iLCJ2YXIgZ2xvYmFsID0gcmVxdWlyZSgnLi9fZ2xvYmFsJyk7XG52YXIgbmF2aWdhdG9yID0gZ2xvYmFsLm5hdmlnYXRvcjtcblxubW9kdWxlLmV4cG9ydHMgPSBuYXZpZ2F0b3IgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudCB8fCAnJztcbiIsInZhciBnbG9iYWwgPSByZXF1aXJlKCcuL19nbG9iYWwnKTtcbnZhciBjb3JlID0gcmVxdWlyZSgnLi9fY29yZScpO1xudmFyIExJQlJBUlkgPSByZXF1aXJlKCcuL19saWJyYXJ5Jyk7XG52YXIgd2tzRXh0ID0gcmVxdWlyZSgnLi9fd2tzLWV4dCcpO1xudmFyIGRlZmluZVByb3BlcnR5ID0gcmVxdWlyZSgnLi9fb2JqZWN0LWRwJykuZjtcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgdmFyICRTeW1ib2wgPSBjb3JlLlN5bWJvbCB8fCAoY29yZS5TeW1ib2wgPSBMSUJSQVJZID8ge30gOiBnbG9iYWwuU3ltYm9sIHx8IHt9KTtcbiAgaWYgKG5hbWUuY2hhckF0KDApICE9ICdfJyAmJiAhKG5hbWUgaW4gJFN5bWJvbCkpIGRlZmluZVByb3BlcnR5KCRTeW1ib2wsIG5hbWUsIHsgdmFsdWU6IHdrc0V4dC5mKG5hbWUpIH0pO1xufTtcbiIsImV4cG9ydHMuZiA9IHJlcXVpcmUoJy4vX3drcycpO1xuIiwidmFyIHN0b3JlID0gcmVxdWlyZSgnLi9fc2hhcmVkJykoJ3drcycpO1xudmFyIHVpZCA9IHJlcXVpcmUoJy4vX3VpZCcpO1xudmFyIFN5bWJvbCA9IHJlcXVpcmUoJy4vX2dsb2JhbCcpLlN5bWJvbDtcbnZhciBVU0VfU1lNQk9MID0gdHlwZW9mIFN5bWJvbCA9PSAnZnVuY3Rpb24nO1xuXG52YXIgJGV4cG9ydHMgPSBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gIHJldHVybiBzdG9yZVtuYW1lXSB8fCAoc3RvcmVbbmFtZV0gPVxuICAgIFVTRV9TWU1CT0wgJiYgU3ltYm9sW25hbWVdIHx8IChVU0VfU1lNQk9MID8gU3ltYm9sIDogdWlkKSgnU3ltYm9sLicgKyBuYW1lKSk7XG59O1xuXG4kZXhwb3J0cy5zdG9yZSA9IHN0b3JlO1xuIiwidmFyIGNsYXNzb2YgPSByZXF1aXJlKCcuL19jbGFzc29mJyk7XG52YXIgSVRFUkFUT1IgPSByZXF1aXJlKCcuL193a3MnKSgnaXRlcmF0b3InKTtcbnZhciBJdGVyYXRvcnMgPSByZXF1aXJlKCcuL19pdGVyYXRvcnMnKTtcbm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi9fY29yZScpLmdldEl0ZXJhdG9yTWV0aG9kID0gZnVuY3Rpb24gKGl0KSB7XG4gIGlmIChpdCAhPSB1bmRlZmluZWQpIHJldHVybiBpdFtJVEVSQVRPUl1cbiAgICB8fCBpdFsnQEBpdGVyYXRvciddXG4gICAgfHwgSXRlcmF0b3JzW2NsYXNzb2YoaXQpXTtcbn07XG4iLCIndXNlIHN0cmljdCc7XG52YXIgYWRkVG9VbnNjb3BhYmxlcyA9IHJlcXVpcmUoJy4vX2FkZC10by11bnNjb3BhYmxlcycpO1xudmFyIHN0ZXAgPSByZXF1aXJlKCcuL19pdGVyLXN0ZXAnKTtcbnZhciBJdGVyYXRvcnMgPSByZXF1aXJlKCcuL19pdGVyYXRvcnMnKTtcbnZhciB0b0lPYmplY3QgPSByZXF1aXJlKCcuL190by1pb2JqZWN0Jyk7XG5cbi8vIDIyLjEuMy40IEFycmF5LnByb3RvdHlwZS5lbnRyaWVzKClcbi8vIDIyLjEuMy4xMyBBcnJheS5wcm90b3R5cGUua2V5cygpXG4vLyAyMi4xLjMuMjkgQXJyYXkucHJvdG90eXBlLnZhbHVlcygpXG4vLyAyMi4xLjMuMzAgQXJyYXkucHJvdG90eXBlW0BAaXRlcmF0b3JdKClcbm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi9faXRlci1kZWZpbmUnKShBcnJheSwgJ0FycmF5JywgZnVuY3Rpb24gKGl0ZXJhdGVkLCBraW5kKSB7XG4gIHRoaXMuX3QgPSB0b0lPYmplY3QoaXRlcmF0ZWQpOyAvLyB0YXJnZXRcbiAgdGhpcy5faSA9IDA7ICAgICAgICAgICAgICAgICAgIC8vIG5leHQgaW5kZXhcbiAgdGhpcy5fayA9IGtpbmQ7ICAgICAgICAgICAgICAgIC8vIGtpbmRcbi8vIDIyLjEuNS4yLjEgJUFycmF5SXRlcmF0b3JQcm90b3R5cGUlLm5leHQoKVxufSwgZnVuY3Rpb24gKCkge1xuICB2YXIgTyA9IHRoaXMuX3Q7XG4gIHZhciBraW5kID0gdGhpcy5faztcbiAgdmFyIGluZGV4ID0gdGhpcy5faSsrO1xuICBpZiAoIU8gfHwgaW5kZXggPj0gTy5sZW5ndGgpIHtcbiAgICB0aGlzLl90ID0gdW5kZWZpbmVkO1xuICAgIHJldHVybiBzdGVwKDEpO1xuICB9XG4gIGlmIChraW5kID09ICdrZXlzJykgcmV0dXJuIHN0ZXAoMCwgaW5kZXgpO1xuICBpZiAoa2luZCA9PSAndmFsdWVzJykgcmV0dXJuIHN0ZXAoMCwgT1tpbmRleF0pO1xuICByZXR1cm4gc3RlcCgwLCBbaW5kZXgsIE9baW5kZXhdXSk7XG59LCAndmFsdWVzJyk7XG5cbi8vIGFyZ3VtZW50c0xpc3RbQEBpdGVyYXRvcl0gaXMgJUFycmF5UHJvdG9fdmFsdWVzJSAoOS40LjQuNiwgOS40LjQuNylcbkl0ZXJhdG9ycy5Bcmd1bWVudHMgPSBJdGVyYXRvcnMuQXJyYXk7XG5cbmFkZFRvVW5zY29wYWJsZXMoJ2tleXMnKTtcbmFkZFRvVW5zY29wYWJsZXMoJ3ZhbHVlcycpO1xuYWRkVG9VbnNjb3BhYmxlcygnZW50cmllcycpO1xuIiwidmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbi8vIDE5LjEuMi4yIC8gMTUuMi4zLjUgT2JqZWN0LmNyZWF0ZShPIFssIFByb3BlcnRpZXNdKVxuJGV4cG9ydCgkZXhwb3J0LlMsICdPYmplY3QnLCB7IGNyZWF0ZTogcmVxdWlyZSgnLi9fb2JqZWN0LWNyZWF0ZScpIH0pO1xuIiwidmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbi8vIDE5LjEuMi40IC8gMTUuMi4zLjYgT2JqZWN0LmRlZmluZVByb3BlcnR5KE8sIFAsIEF0dHJpYnV0ZXMpXG4kZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqICFyZXF1aXJlKCcuL19kZXNjcmlwdG9ycycpLCAnT2JqZWN0JywgeyBkZWZpbmVQcm9wZXJ0eTogcmVxdWlyZSgnLi9fb2JqZWN0LWRwJykuZiB9KTtcbiIsIi8vIDE5LjEuMi42IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTywgUClcbnZhciB0b0lPYmplY3QgPSByZXF1aXJlKCcuL190by1pb2JqZWN0Jyk7XG52YXIgJGdldE93blByb3BlcnR5RGVzY3JpcHRvciA9IHJlcXVpcmUoJy4vX29iamVjdC1nb3BkJykuZjtcblxucmVxdWlyZSgnLi9fb2JqZWN0LXNhcCcpKCdnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3InLCBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoaXQsIGtleSkge1xuICAgIHJldHVybiAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRvSU9iamVjdChpdCksIGtleSk7XG4gIH07XG59KTtcbiIsIi8vIDE5LjEuMi45IE9iamVjdC5nZXRQcm90b3R5cGVPZihPKVxudmFyIHRvT2JqZWN0ID0gcmVxdWlyZSgnLi9fdG8tb2JqZWN0Jyk7XG52YXIgJGdldFByb3RvdHlwZU9mID0gcmVxdWlyZSgnLi9fb2JqZWN0LWdwbycpO1xuXG5yZXF1aXJlKCcuL19vYmplY3Qtc2FwJykoJ2dldFByb3RvdHlwZU9mJywgZnVuY3Rpb24gKCkge1xuICByZXR1cm4gZnVuY3Rpb24gZ2V0UHJvdG90eXBlT2YoaXQpIHtcbiAgICByZXR1cm4gJGdldFByb3RvdHlwZU9mKHRvT2JqZWN0KGl0KSk7XG4gIH07XG59KTtcbiIsIi8vIDE5LjEuMy4xOSBPYmplY3Quc2V0UHJvdG90eXBlT2YoTywgcHJvdG8pXG52YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vX2V4cG9ydCcpO1xuJGV4cG9ydCgkZXhwb3J0LlMsICdPYmplY3QnLCB7IHNldFByb3RvdHlwZU9mOiByZXF1aXJlKCcuL19zZXQtcHJvdG8nKS5zZXQgfSk7XG4iLCIiLCIndXNlIHN0cmljdCc7XG52YXIgTElCUkFSWSA9IHJlcXVpcmUoJy4vX2xpYnJhcnknKTtcbnZhciBnbG9iYWwgPSByZXF1aXJlKCcuL19nbG9iYWwnKTtcbnZhciBjdHggPSByZXF1aXJlKCcuL19jdHgnKTtcbnZhciBjbGFzc29mID0gcmVxdWlyZSgnLi9fY2xhc3NvZicpO1xudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciBpc09iamVjdCA9IHJlcXVpcmUoJy4vX2lzLW9iamVjdCcpO1xudmFyIGFGdW5jdGlvbiA9IHJlcXVpcmUoJy4vX2EtZnVuY3Rpb24nKTtcbnZhciBhbkluc3RhbmNlID0gcmVxdWlyZSgnLi9fYW4taW5zdGFuY2UnKTtcbnZhciBmb3JPZiA9IHJlcXVpcmUoJy4vX2Zvci1vZicpO1xudmFyIHNwZWNpZXNDb25zdHJ1Y3RvciA9IHJlcXVpcmUoJy4vX3NwZWNpZXMtY29uc3RydWN0b3InKTtcbnZhciB0YXNrID0gcmVxdWlyZSgnLi9fdGFzaycpLnNldDtcbnZhciBtaWNyb3Rhc2sgPSByZXF1aXJlKCcuL19taWNyb3Rhc2snKSgpO1xudmFyIG5ld1Byb21pc2VDYXBhYmlsaXR5TW9kdWxlID0gcmVxdWlyZSgnLi9fbmV3LXByb21pc2UtY2FwYWJpbGl0eScpO1xudmFyIHBlcmZvcm0gPSByZXF1aXJlKCcuL19wZXJmb3JtJyk7XG52YXIgdXNlckFnZW50ID0gcmVxdWlyZSgnLi9fdXNlci1hZ2VudCcpO1xudmFyIHByb21pc2VSZXNvbHZlID0gcmVxdWlyZSgnLi9fcHJvbWlzZS1yZXNvbHZlJyk7XG52YXIgUFJPTUlTRSA9ICdQcm9taXNlJztcbnZhciBUeXBlRXJyb3IgPSBnbG9iYWwuVHlwZUVycm9yO1xudmFyIHByb2Nlc3MgPSBnbG9iYWwucHJvY2VzcztcbnZhciB2ZXJzaW9ucyA9IHByb2Nlc3MgJiYgcHJvY2Vzcy52ZXJzaW9ucztcbnZhciB2OCA9IHZlcnNpb25zICYmIHZlcnNpb25zLnY4IHx8ICcnO1xudmFyICRQcm9taXNlID0gZ2xvYmFsW1BST01JU0VdO1xudmFyIGlzTm9kZSA9IGNsYXNzb2YocHJvY2VzcykgPT0gJ3Byb2Nlc3MnO1xudmFyIGVtcHR5ID0gZnVuY3Rpb24gKCkgeyAvKiBlbXB0eSAqLyB9O1xudmFyIEludGVybmFsLCBuZXdHZW5lcmljUHJvbWlzZUNhcGFiaWxpdHksIE93blByb21pc2VDYXBhYmlsaXR5LCBXcmFwcGVyO1xudmFyIG5ld1Byb21pc2VDYXBhYmlsaXR5ID0gbmV3R2VuZXJpY1Byb21pc2VDYXBhYmlsaXR5ID0gbmV3UHJvbWlzZUNhcGFiaWxpdHlNb2R1bGUuZjtcblxudmFyIFVTRV9OQVRJVkUgPSAhIWZ1bmN0aW9uICgpIHtcbiAgdHJ5IHtcbiAgICAvLyBjb3JyZWN0IHN1YmNsYXNzaW5nIHdpdGggQEBzcGVjaWVzIHN1cHBvcnRcbiAgICB2YXIgcHJvbWlzZSA9ICRQcm9taXNlLnJlc29sdmUoMSk7XG4gICAgdmFyIEZha2VQcm9taXNlID0gKHByb21pc2UuY29uc3RydWN0b3IgPSB7fSlbcmVxdWlyZSgnLi9fd2tzJykoJ3NwZWNpZXMnKV0gPSBmdW5jdGlvbiAoZXhlYykge1xuICAgICAgZXhlYyhlbXB0eSwgZW1wdHkpO1xuICAgIH07XG4gICAgLy8gdW5oYW5kbGVkIHJlamVjdGlvbnMgdHJhY2tpbmcgc3VwcG9ydCwgTm9kZUpTIFByb21pc2Ugd2l0aG91dCBpdCBmYWlscyBAQHNwZWNpZXMgdGVzdFxuICAgIHJldHVybiAoaXNOb2RlIHx8IHR5cGVvZiBQcm9taXNlUmVqZWN0aW9uRXZlbnQgPT0gJ2Z1bmN0aW9uJylcbiAgICAgICYmIHByb21pc2UudGhlbihlbXB0eSkgaW5zdGFuY2VvZiBGYWtlUHJvbWlzZVxuICAgICAgLy8gdjggNi42IChOb2RlIDEwIGFuZCBDaHJvbWUgNjYpIGhhdmUgYSBidWcgd2l0aCByZXNvbHZpbmcgY3VzdG9tIHRoZW5hYmxlc1xuICAgICAgLy8gaHR0cHM6Ly9idWdzLmNocm9taXVtLm9yZy9wL2Nocm9taXVtL2lzc3Vlcy9kZXRhaWw/aWQ9ODMwNTY1XG4gICAgICAvLyB3ZSBjYW4ndCBkZXRlY3QgaXQgc3luY2hyb25vdXNseSwgc28ganVzdCBjaGVjayB2ZXJzaW9uc1xuICAgICAgJiYgdjguaW5kZXhPZignNi42JykgIT09IDBcbiAgICAgICYmIHVzZXJBZ2VudC5pbmRleE9mKCdDaHJvbWUvNjYnKSA9PT0gLTE7XG4gIH0gY2F0Y2ggKGUpIHsgLyogZW1wdHkgKi8gfVxufSgpO1xuXG4vLyBoZWxwZXJzXG52YXIgaXNUaGVuYWJsZSA9IGZ1bmN0aW9uIChpdCkge1xuICB2YXIgdGhlbjtcbiAgcmV0dXJuIGlzT2JqZWN0KGl0KSAmJiB0eXBlb2YgKHRoZW4gPSBpdC50aGVuKSA9PSAnZnVuY3Rpb24nID8gdGhlbiA6IGZhbHNlO1xufTtcbnZhciBub3RpZnkgPSBmdW5jdGlvbiAocHJvbWlzZSwgaXNSZWplY3QpIHtcbiAgaWYgKHByb21pc2UuX24pIHJldHVybjtcbiAgcHJvbWlzZS5fbiA9IHRydWU7XG4gIHZhciBjaGFpbiA9IHByb21pc2UuX2M7XG4gIG1pY3JvdGFzayhmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHZhbHVlID0gcHJvbWlzZS5fdjtcbiAgICB2YXIgb2sgPSBwcm9taXNlLl9zID09IDE7XG4gICAgdmFyIGkgPSAwO1xuICAgIHZhciBydW4gPSBmdW5jdGlvbiAocmVhY3Rpb24pIHtcbiAgICAgIHZhciBoYW5kbGVyID0gb2sgPyByZWFjdGlvbi5vayA6IHJlYWN0aW9uLmZhaWw7XG4gICAgICB2YXIgcmVzb2x2ZSA9IHJlYWN0aW9uLnJlc29sdmU7XG4gICAgICB2YXIgcmVqZWN0ID0gcmVhY3Rpb24ucmVqZWN0O1xuICAgICAgdmFyIGRvbWFpbiA9IHJlYWN0aW9uLmRvbWFpbjtcbiAgICAgIHZhciByZXN1bHQsIHRoZW4sIGV4aXRlZDtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmIChoYW5kbGVyKSB7XG4gICAgICAgICAgaWYgKCFvaykge1xuICAgICAgICAgICAgaWYgKHByb21pc2UuX2ggPT0gMikgb25IYW5kbGVVbmhhbmRsZWQocHJvbWlzZSk7XG4gICAgICAgICAgICBwcm9taXNlLl9oID0gMTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGhhbmRsZXIgPT09IHRydWUpIHJlc3VsdCA9IHZhbHVlO1xuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKGRvbWFpbikgZG9tYWluLmVudGVyKCk7XG4gICAgICAgICAgICByZXN1bHQgPSBoYW5kbGVyKHZhbHVlKTsgLy8gbWF5IHRocm93XG4gICAgICAgICAgICBpZiAoZG9tYWluKSB7XG4gICAgICAgICAgICAgIGRvbWFpbi5leGl0KCk7XG4gICAgICAgICAgICAgIGV4aXRlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChyZXN1bHQgPT09IHJlYWN0aW9uLnByb21pc2UpIHtcbiAgICAgICAgICAgIHJlamVjdChUeXBlRXJyb3IoJ1Byb21pc2UtY2hhaW4gY3ljbGUnKSk7XG4gICAgICAgICAgfSBlbHNlIGlmICh0aGVuID0gaXNUaGVuYWJsZShyZXN1bHQpKSB7XG4gICAgICAgICAgICB0aGVuLmNhbGwocmVzdWx0LCByZXNvbHZlLCByZWplY3QpO1xuICAgICAgICAgIH0gZWxzZSByZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgIH0gZWxzZSByZWplY3QodmFsdWUpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBpZiAoZG9tYWluICYmICFleGl0ZWQpIGRvbWFpbi5leGl0KCk7XG4gICAgICAgIHJlamVjdChlKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHdoaWxlIChjaGFpbi5sZW5ndGggPiBpKSBydW4oY2hhaW5baSsrXSk7IC8vIHZhcmlhYmxlIGxlbmd0aCAtIGNhbid0IHVzZSBmb3JFYWNoXG4gICAgcHJvbWlzZS5fYyA9IFtdO1xuICAgIHByb21pc2UuX24gPSBmYWxzZTtcbiAgICBpZiAoaXNSZWplY3QgJiYgIXByb21pc2UuX2gpIG9uVW5oYW5kbGVkKHByb21pc2UpO1xuICB9KTtcbn07XG52YXIgb25VbmhhbmRsZWQgPSBmdW5jdGlvbiAocHJvbWlzZSkge1xuICB0YXNrLmNhbGwoZ2xvYmFsLCBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHZhbHVlID0gcHJvbWlzZS5fdjtcbiAgICB2YXIgdW5oYW5kbGVkID0gaXNVbmhhbmRsZWQocHJvbWlzZSk7XG4gICAgdmFyIHJlc3VsdCwgaGFuZGxlciwgY29uc29sZTtcbiAgICBpZiAodW5oYW5kbGVkKSB7XG4gICAgICByZXN1bHQgPSBwZXJmb3JtKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGlzTm9kZSkge1xuICAgICAgICAgIHByb2Nlc3MuZW1pdCgndW5oYW5kbGVkUmVqZWN0aW9uJywgdmFsdWUsIHByb21pc2UpO1xuICAgICAgICB9IGVsc2UgaWYgKGhhbmRsZXIgPSBnbG9iYWwub251bmhhbmRsZWRyZWplY3Rpb24pIHtcbiAgICAgICAgICBoYW5kbGVyKHsgcHJvbWlzZTogcHJvbWlzZSwgcmVhc29uOiB2YWx1ZSB9KTtcbiAgICAgICAgfSBlbHNlIGlmICgoY29uc29sZSA9IGdsb2JhbC5jb25zb2xlKSAmJiBjb25zb2xlLmVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignVW5oYW5kbGVkIHByb21pc2UgcmVqZWN0aW9uJywgdmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIC8vIEJyb3dzZXJzIHNob3VsZCBub3QgdHJpZ2dlciBgcmVqZWN0aW9uSGFuZGxlZGAgZXZlbnQgaWYgaXQgd2FzIGhhbmRsZWQgaGVyZSwgTm9kZUpTIC0gc2hvdWxkXG4gICAgICBwcm9taXNlLl9oID0gaXNOb2RlIHx8IGlzVW5oYW5kbGVkKHByb21pc2UpID8gMiA6IDE7XG4gICAgfSBwcm9taXNlLl9hID0gdW5kZWZpbmVkO1xuICAgIGlmICh1bmhhbmRsZWQgJiYgcmVzdWx0LmUpIHRocm93IHJlc3VsdC52O1xuICB9KTtcbn07XG52YXIgaXNVbmhhbmRsZWQgPSBmdW5jdGlvbiAocHJvbWlzZSkge1xuICByZXR1cm4gcHJvbWlzZS5faCAhPT0gMSAmJiAocHJvbWlzZS5fYSB8fCBwcm9taXNlLl9jKS5sZW5ndGggPT09IDA7XG59O1xudmFyIG9uSGFuZGxlVW5oYW5kbGVkID0gZnVuY3Rpb24gKHByb21pc2UpIHtcbiAgdGFzay5jYWxsKGdsb2JhbCwgZnVuY3Rpb24gKCkge1xuICAgIHZhciBoYW5kbGVyO1xuICAgIGlmIChpc05vZGUpIHtcbiAgICAgIHByb2Nlc3MuZW1pdCgncmVqZWN0aW9uSGFuZGxlZCcsIHByb21pc2UpO1xuICAgIH0gZWxzZSBpZiAoaGFuZGxlciA9IGdsb2JhbC5vbnJlamVjdGlvbmhhbmRsZWQpIHtcbiAgICAgIGhhbmRsZXIoeyBwcm9taXNlOiBwcm9taXNlLCByZWFzb246IHByb21pc2UuX3YgfSk7XG4gICAgfVxuICB9KTtcbn07XG52YXIgJHJlamVjdCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICB2YXIgcHJvbWlzZSA9IHRoaXM7XG4gIGlmIChwcm9taXNlLl9kKSByZXR1cm47XG4gIHByb21pc2UuX2QgPSB0cnVlO1xuICBwcm9taXNlID0gcHJvbWlzZS5fdyB8fCBwcm9taXNlOyAvLyB1bndyYXBcbiAgcHJvbWlzZS5fdiA9IHZhbHVlO1xuICBwcm9taXNlLl9zID0gMjtcbiAgaWYgKCFwcm9taXNlLl9hKSBwcm9taXNlLl9hID0gcHJvbWlzZS5fYy5zbGljZSgpO1xuICBub3RpZnkocHJvbWlzZSwgdHJ1ZSk7XG59O1xudmFyICRyZXNvbHZlID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gIHZhciBwcm9taXNlID0gdGhpcztcbiAgdmFyIHRoZW47XG4gIGlmIChwcm9taXNlLl9kKSByZXR1cm47XG4gIHByb21pc2UuX2QgPSB0cnVlO1xuICBwcm9taXNlID0gcHJvbWlzZS5fdyB8fCBwcm9taXNlOyAvLyB1bndyYXBcbiAgdHJ5IHtcbiAgICBpZiAocHJvbWlzZSA9PT0gdmFsdWUpIHRocm93IFR5cGVFcnJvcihcIlByb21pc2UgY2FuJ3QgYmUgcmVzb2x2ZWQgaXRzZWxmXCIpO1xuICAgIGlmICh0aGVuID0gaXNUaGVuYWJsZSh2YWx1ZSkpIHtcbiAgICAgIG1pY3JvdGFzayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB3cmFwcGVyID0geyBfdzogcHJvbWlzZSwgX2Q6IGZhbHNlIH07IC8vIHdyYXBcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB0aGVuLmNhbGwodmFsdWUsIGN0eCgkcmVzb2x2ZSwgd3JhcHBlciwgMSksIGN0eCgkcmVqZWN0LCB3cmFwcGVyLCAxKSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAkcmVqZWN0LmNhbGwod3JhcHBlciwgZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBwcm9taXNlLl92ID0gdmFsdWU7XG4gICAgICBwcm9taXNlLl9zID0gMTtcbiAgICAgIG5vdGlmeShwcm9taXNlLCBmYWxzZSk7XG4gICAgfVxuICB9IGNhdGNoIChlKSB7XG4gICAgJHJlamVjdC5jYWxsKHsgX3c6IHByb21pc2UsIF9kOiBmYWxzZSB9LCBlKTsgLy8gd3JhcFxuICB9XG59O1xuXG4vLyBjb25zdHJ1Y3RvciBwb2x5ZmlsbFxuaWYgKCFVU0VfTkFUSVZFKSB7XG4gIC8vIDI1LjQuMy4xIFByb21pc2UoZXhlY3V0b3IpXG4gICRQcm9taXNlID0gZnVuY3Rpb24gUHJvbWlzZShleGVjdXRvcikge1xuICAgIGFuSW5zdGFuY2UodGhpcywgJFByb21pc2UsIFBST01JU0UsICdfaCcpO1xuICAgIGFGdW5jdGlvbihleGVjdXRvcik7XG4gICAgSW50ZXJuYWwuY2FsbCh0aGlzKTtcbiAgICB0cnkge1xuICAgICAgZXhlY3V0b3IoY3R4KCRyZXNvbHZlLCB0aGlzLCAxKSwgY3R4KCRyZWplY3QsIHRoaXMsIDEpKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICRyZWplY3QuY2FsbCh0aGlzLCBlcnIpO1xuICAgIH1cbiAgfTtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzXG4gIEludGVybmFsID0gZnVuY3Rpb24gUHJvbWlzZShleGVjdXRvcikge1xuICAgIHRoaXMuX2MgPSBbXTsgICAgICAgICAgICAgLy8gPC0gYXdhaXRpbmcgcmVhY3Rpb25zXG4gICAgdGhpcy5fYSA9IHVuZGVmaW5lZDsgICAgICAvLyA8LSBjaGVja2VkIGluIGlzVW5oYW5kbGVkIHJlYWN0aW9uc1xuICAgIHRoaXMuX3MgPSAwOyAgICAgICAgICAgICAgLy8gPC0gc3RhdGVcbiAgICB0aGlzLl9kID0gZmFsc2U7ICAgICAgICAgIC8vIDwtIGRvbmVcbiAgICB0aGlzLl92ID0gdW5kZWZpbmVkOyAgICAgIC8vIDwtIHZhbHVlXG4gICAgdGhpcy5faCA9IDA7ICAgICAgICAgICAgICAvLyA8LSByZWplY3Rpb24gc3RhdGUsIDAgLSBkZWZhdWx0LCAxIC0gaGFuZGxlZCwgMiAtIHVuaGFuZGxlZFxuICAgIHRoaXMuX24gPSBmYWxzZTsgICAgICAgICAgLy8gPC0gbm90aWZ5XG4gIH07XG4gIEludGVybmFsLnByb3RvdHlwZSA9IHJlcXVpcmUoJy4vX3JlZGVmaW5lLWFsbCcpKCRQcm9taXNlLnByb3RvdHlwZSwge1xuICAgIC8vIDI1LjQuNS4zIFByb21pc2UucHJvdG90eXBlLnRoZW4ob25GdWxmaWxsZWQsIG9uUmVqZWN0ZWQpXG4gICAgdGhlbjogZnVuY3Rpb24gdGhlbihvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCkge1xuICAgICAgdmFyIHJlYWN0aW9uID0gbmV3UHJvbWlzZUNhcGFiaWxpdHkoc3BlY2llc0NvbnN0cnVjdG9yKHRoaXMsICRQcm9taXNlKSk7XG4gICAgICByZWFjdGlvbi5vayA9IHR5cGVvZiBvbkZ1bGZpbGxlZCA9PSAnZnVuY3Rpb24nID8gb25GdWxmaWxsZWQgOiB0cnVlO1xuICAgICAgcmVhY3Rpb24uZmFpbCA9IHR5cGVvZiBvblJlamVjdGVkID09ICdmdW5jdGlvbicgJiYgb25SZWplY3RlZDtcbiAgICAgIHJlYWN0aW9uLmRvbWFpbiA9IGlzTm9kZSA/IHByb2Nlc3MuZG9tYWluIDogdW5kZWZpbmVkO1xuICAgICAgdGhpcy5fYy5wdXNoKHJlYWN0aW9uKTtcbiAgICAgIGlmICh0aGlzLl9hKSB0aGlzLl9hLnB1c2gocmVhY3Rpb24pO1xuICAgICAgaWYgKHRoaXMuX3MpIG5vdGlmeSh0aGlzLCBmYWxzZSk7XG4gICAgICByZXR1cm4gcmVhY3Rpb24ucHJvbWlzZTtcbiAgICB9LFxuICAgIC8vIDI1LjQuNS4xIFByb21pc2UucHJvdG90eXBlLmNhdGNoKG9uUmVqZWN0ZWQpXG4gICAgJ2NhdGNoJzogZnVuY3Rpb24gKG9uUmVqZWN0ZWQpIHtcbiAgICAgIHJldHVybiB0aGlzLnRoZW4odW5kZWZpbmVkLCBvblJlamVjdGVkKTtcbiAgICB9XG4gIH0pO1xuICBPd25Qcm9taXNlQ2FwYWJpbGl0eSA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgcHJvbWlzZSA9IG5ldyBJbnRlcm5hbCgpO1xuICAgIHRoaXMucHJvbWlzZSA9IHByb21pc2U7XG4gICAgdGhpcy5yZXNvbHZlID0gY3R4KCRyZXNvbHZlLCBwcm9taXNlLCAxKTtcbiAgICB0aGlzLnJlamVjdCA9IGN0eCgkcmVqZWN0LCBwcm9taXNlLCAxKTtcbiAgfTtcbiAgbmV3UHJvbWlzZUNhcGFiaWxpdHlNb2R1bGUuZiA9IG5ld1Byb21pc2VDYXBhYmlsaXR5ID0gZnVuY3Rpb24gKEMpIHtcbiAgICByZXR1cm4gQyA9PT0gJFByb21pc2UgfHwgQyA9PT0gV3JhcHBlclxuICAgICAgPyBuZXcgT3duUHJvbWlzZUNhcGFiaWxpdHkoQylcbiAgICAgIDogbmV3R2VuZXJpY1Byb21pc2VDYXBhYmlsaXR5KEMpO1xuICB9O1xufVxuXG4kZXhwb3J0KCRleHBvcnQuRyArICRleHBvcnQuVyArICRleHBvcnQuRiAqICFVU0VfTkFUSVZFLCB7IFByb21pc2U6ICRQcm9taXNlIH0pO1xucmVxdWlyZSgnLi9fc2V0LXRvLXN0cmluZy10YWcnKSgkUHJvbWlzZSwgUFJPTUlTRSk7XG5yZXF1aXJlKCcuL19zZXQtc3BlY2llcycpKFBST01JU0UpO1xuV3JhcHBlciA9IHJlcXVpcmUoJy4vX2NvcmUnKVtQUk9NSVNFXTtcblxuLy8gc3RhdGljc1xuJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAhVVNFX05BVElWRSwgUFJPTUlTRSwge1xuICAvLyAyNS40LjQuNSBQcm9taXNlLnJlamVjdChyKVxuICByZWplY3Q6IGZ1bmN0aW9uIHJlamVjdChyKSB7XG4gICAgdmFyIGNhcGFiaWxpdHkgPSBuZXdQcm9taXNlQ2FwYWJpbGl0eSh0aGlzKTtcbiAgICB2YXIgJCRyZWplY3QgPSBjYXBhYmlsaXR5LnJlamVjdDtcbiAgICAkJHJlamVjdChyKTtcbiAgICByZXR1cm4gY2FwYWJpbGl0eS5wcm9taXNlO1xuICB9XG59KTtcbiRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogKExJQlJBUlkgfHwgIVVTRV9OQVRJVkUpLCBQUk9NSVNFLCB7XG4gIC8vIDI1LjQuNC42IFByb21pc2UucmVzb2x2ZSh4KVxuICByZXNvbHZlOiBmdW5jdGlvbiByZXNvbHZlKHgpIHtcbiAgICByZXR1cm4gcHJvbWlzZVJlc29sdmUoTElCUkFSWSAmJiB0aGlzID09PSBXcmFwcGVyID8gJFByb21pc2UgOiB0aGlzLCB4KTtcbiAgfVxufSk7XG4kZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqICEoVVNFX05BVElWRSAmJiByZXF1aXJlKCcuL19pdGVyLWRldGVjdCcpKGZ1bmN0aW9uIChpdGVyKSB7XG4gICRQcm9taXNlLmFsbChpdGVyKVsnY2F0Y2gnXShlbXB0eSk7XG59KSksIFBST01JU0UsIHtcbiAgLy8gMjUuNC40LjEgUHJvbWlzZS5hbGwoaXRlcmFibGUpXG4gIGFsbDogZnVuY3Rpb24gYWxsKGl0ZXJhYmxlKSB7XG4gICAgdmFyIEMgPSB0aGlzO1xuICAgIHZhciBjYXBhYmlsaXR5ID0gbmV3UHJvbWlzZUNhcGFiaWxpdHkoQyk7XG4gICAgdmFyIHJlc29sdmUgPSBjYXBhYmlsaXR5LnJlc29sdmU7XG4gICAgdmFyIHJlamVjdCA9IGNhcGFiaWxpdHkucmVqZWN0O1xuICAgIHZhciByZXN1bHQgPSBwZXJmb3JtKGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciB2YWx1ZXMgPSBbXTtcbiAgICAgIHZhciBpbmRleCA9IDA7XG4gICAgICB2YXIgcmVtYWluaW5nID0gMTtcbiAgICAgIGZvck9mKGl0ZXJhYmxlLCBmYWxzZSwgZnVuY3Rpb24gKHByb21pc2UpIHtcbiAgICAgICAgdmFyICRpbmRleCA9IGluZGV4Kys7XG4gICAgICAgIHZhciBhbHJlYWR5Q2FsbGVkID0gZmFsc2U7XG4gICAgICAgIHZhbHVlcy5wdXNoKHVuZGVmaW5lZCk7XG4gICAgICAgIHJlbWFpbmluZysrO1xuICAgICAgICBDLnJlc29sdmUocHJvbWlzZSkudGhlbihmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICBpZiAoYWxyZWFkeUNhbGxlZCkgcmV0dXJuO1xuICAgICAgICAgIGFscmVhZHlDYWxsZWQgPSB0cnVlO1xuICAgICAgICAgIHZhbHVlc1skaW5kZXhdID0gdmFsdWU7XG4gICAgICAgICAgLS1yZW1haW5pbmcgfHwgcmVzb2x2ZSh2YWx1ZXMpO1xuICAgICAgICB9LCByZWplY3QpO1xuICAgICAgfSk7XG4gICAgICAtLXJlbWFpbmluZyB8fCByZXNvbHZlKHZhbHVlcyk7XG4gICAgfSk7XG4gICAgaWYgKHJlc3VsdC5lKSByZWplY3QocmVzdWx0LnYpO1xuICAgIHJldHVybiBjYXBhYmlsaXR5LnByb21pc2U7XG4gIH0sXG4gIC8vIDI1LjQuNC40IFByb21pc2UucmFjZShpdGVyYWJsZSlcbiAgcmFjZTogZnVuY3Rpb24gcmFjZShpdGVyYWJsZSkge1xuICAgIHZhciBDID0gdGhpcztcbiAgICB2YXIgY2FwYWJpbGl0eSA9IG5ld1Byb21pc2VDYXBhYmlsaXR5KEMpO1xuICAgIHZhciByZWplY3QgPSBjYXBhYmlsaXR5LnJlamVjdDtcbiAgICB2YXIgcmVzdWx0ID0gcGVyZm9ybShmdW5jdGlvbiAoKSB7XG4gICAgICBmb3JPZihpdGVyYWJsZSwgZmFsc2UsIGZ1bmN0aW9uIChwcm9taXNlKSB7XG4gICAgICAgIEMucmVzb2x2ZShwcm9taXNlKS50aGVuKGNhcGFiaWxpdHkucmVzb2x2ZSwgcmVqZWN0KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGlmIChyZXN1bHQuZSkgcmVqZWN0KHJlc3VsdC52KTtcbiAgICByZXR1cm4gY2FwYWJpbGl0eS5wcm9taXNlO1xuICB9XG59KTtcbiIsIid1c2Ugc3RyaWN0JztcbnZhciAkYXQgPSByZXF1aXJlKCcuL19zdHJpbmctYXQnKSh0cnVlKTtcblxuLy8gMjEuMS4zLjI3IFN0cmluZy5wcm90b3R5cGVbQEBpdGVyYXRvcl0oKVxucmVxdWlyZSgnLi9faXRlci1kZWZpbmUnKShTdHJpbmcsICdTdHJpbmcnLCBmdW5jdGlvbiAoaXRlcmF0ZWQpIHtcbiAgdGhpcy5fdCA9IFN0cmluZyhpdGVyYXRlZCk7IC8vIHRhcmdldFxuICB0aGlzLl9pID0gMDsgICAgICAgICAgICAgICAgLy8gbmV4dCBpbmRleFxuLy8gMjEuMS41LjIuMSAlU3RyaW5nSXRlcmF0b3JQcm90b3R5cGUlLm5leHQoKVxufSwgZnVuY3Rpb24gKCkge1xuICB2YXIgTyA9IHRoaXMuX3Q7XG4gIHZhciBpbmRleCA9IHRoaXMuX2k7XG4gIHZhciBwb2ludDtcbiAgaWYgKGluZGV4ID49IE8ubGVuZ3RoKSByZXR1cm4geyB2YWx1ZTogdW5kZWZpbmVkLCBkb25lOiB0cnVlIH07XG4gIHBvaW50ID0gJGF0KE8sIGluZGV4KTtcbiAgdGhpcy5faSArPSBwb2ludC5sZW5ndGg7XG4gIHJldHVybiB7IHZhbHVlOiBwb2ludCwgZG9uZTogZmFsc2UgfTtcbn0pO1xuIiwiJ3VzZSBzdHJpY3QnO1xuLy8gRUNNQVNjcmlwdCA2IHN5bWJvbHMgc2hpbVxudmFyIGdsb2JhbCA9IHJlcXVpcmUoJy4vX2dsb2JhbCcpO1xudmFyIGhhcyA9IHJlcXVpcmUoJy4vX2hhcycpO1xudmFyIERFU0NSSVBUT1JTID0gcmVxdWlyZSgnLi9fZGVzY3JpcHRvcnMnKTtcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG52YXIgcmVkZWZpbmUgPSByZXF1aXJlKCcuL19yZWRlZmluZScpO1xudmFyIE1FVEEgPSByZXF1aXJlKCcuL19tZXRhJykuS0VZO1xudmFyICRmYWlscyA9IHJlcXVpcmUoJy4vX2ZhaWxzJyk7XG52YXIgc2hhcmVkID0gcmVxdWlyZSgnLi9fc2hhcmVkJyk7XG52YXIgc2V0VG9TdHJpbmdUYWcgPSByZXF1aXJlKCcuL19zZXQtdG8tc3RyaW5nLXRhZycpO1xudmFyIHVpZCA9IHJlcXVpcmUoJy4vX3VpZCcpO1xudmFyIHdrcyA9IHJlcXVpcmUoJy4vX3drcycpO1xudmFyIHdrc0V4dCA9IHJlcXVpcmUoJy4vX3drcy1leHQnKTtcbnZhciB3a3NEZWZpbmUgPSByZXF1aXJlKCcuL193a3MtZGVmaW5lJyk7XG52YXIgZW51bUtleXMgPSByZXF1aXJlKCcuL19lbnVtLWtleXMnKTtcbnZhciBpc0FycmF5ID0gcmVxdWlyZSgnLi9faXMtYXJyYXknKTtcbnZhciBhbk9iamVjdCA9IHJlcXVpcmUoJy4vX2FuLW9iamVjdCcpO1xudmFyIGlzT2JqZWN0ID0gcmVxdWlyZSgnLi9faXMtb2JqZWN0Jyk7XG52YXIgdG9PYmplY3QgPSByZXF1aXJlKCcuL190by1vYmplY3QnKTtcbnZhciB0b0lPYmplY3QgPSByZXF1aXJlKCcuL190by1pb2JqZWN0Jyk7XG52YXIgdG9QcmltaXRpdmUgPSByZXF1aXJlKCcuL190by1wcmltaXRpdmUnKTtcbnZhciBjcmVhdGVEZXNjID0gcmVxdWlyZSgnLi9fcHJvcGVydHktZGVzYycpO1xudmFyIF9jcmVhdGUgPSByZXF1aXJlKCcuL19vYmplY3QtY3JlYXRlJyk7XG52YXIgZ09QTkV4dCA9IHJlcXVpcmUoJy4vX29iamVjdC1nb3BuLWV4dCcpO1xudmFyICRHT1BEID0gcmVxdWlyZSgnLi9fb2JqZWN0LWdvcGQnKTtcbnZhciAkR09QUyA9IHJlcXVpcmUoJy4vX29iamVjdC1nb3BzJyk7XG52YXIgJERQID0gcmVxdWlyZSgnLi9fb2JqZWN0LWRwJyk7XG52YXIgJGtleXMgPSByZXF1aXJlKCcuL19vYmplY3Qta2V5cycpO1xudmFyIGdPUEQgPSAkR09QRC5mO1xudmFyIGRQID0gJERQLmY7XG52YXIgZ09QTiA9IGdPUE5FeHQuZjtcbnZhciAkU3ltYm9sID0gZ2xvYmFsLlN5bWJvbDtcbnZhciAkSlNPTiA9IGdsb2JhbC5KU09OO1xudmFyIF9zdHJpbmdpZnkgPSAkSlNPTiAmJiAkSlNPTi5zdHJpbmdpZnk7XG52YXIgUFJPVE9UWVBFID0gJ3Byb3RvdHlwZSc7XG52YXIgSElEREVOID0gd2tzKCdfaGlkZGVuJyk7XG52YXIgVE9fUFJJTUlUSVZFID0gd2tzKCd0b1ByaW1pdGl2ZScpO1xudmFyIGlzRW51bSA9IHt9LnByb3BlcnR5SXNFbnVtZXJhYmxlO1xudmFyIFN5bWJvbFJlZ2lzdHJ5ID0gc2hhcmVkKCdzeW1ib2wtcmVnaXN0cnknKTtcbnZhciBBbGxTeW1ib2xzID0gc2hhcmVkKCdzeW1ib2xzJyk7XG52YXIgT1BTeW1ib2xzID0gc2hhcmVkKCdvcC1zeW1ib2xzJyk7XG52YXIgT2JqZWN0UHJvdG8gPSBPYmplY3RbUFJPVE9UWVBFXTtcbnZhciBVU0VfTkFUSVZFID0gdHlwZW9mICRTeW1ib2wgPT0gJ2Z1bmN0aW9uJyAmJiAhISRHT1BTLmY7XG52YXIgUU9iamVjdCA9IGdsb2JhbC5RT2JqZWN0O1xuLy8gRG9uJ3QgdXNlIHNldHRlcnMgaW4gUXQgU2NyaXB0LCBodHRwczovL2dpdGh1Yi5jb20vemxvaXJvY2svY29yZS1qcy9pc3N1ZXMvMTczXG52YXIgc2V0dGVyID0gIVFPYmplY3QgfHwgIVFPYmplY3RbUFJPVE9UWVBFXSB8fCAhUU9iamVjdFtQUk9UT1RZUEVdLmZpbmRDaGlsZDtcblxuLy8gZmFsbGJhY2sgZm9yIG9sZCBBbmRyb2lkLCBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9Njg3XG52YXIgc2V0U3ltYm9sRGVzYyA9IERFU0NSSVBUT1JTICYmICRmYWlscyhmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBfY3JlYXRlKGRQKHt9LCAnYScsIHtcbiAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGRQKHRoaXMsICdhJywgeyB2YWx1ZTogNyB9KS5hOyB9XG4gIH0pKS5hICE9IDc7XG59KSA/IGZ1bmN0aW9uIChpdCwga2V5LCBEKSB7XG4gIHZhciBwcm90b0Rlc2MgPSBnT1BEKE9iamVjdFByb3RvLCBrZXkpO1xuICBpZiAocHJvdG9EZXNjKSBkZWxldGUgT2JqZWN0UHJvdG9ba2V5XTtcbiAgZFAoaXQsIGtleSwgRCk7XG4gIGlmIChwcm90b0Rlc2MgJiYgaXQgIT09IE9iamVjdFByb3RvKSBkUChPYmplY3RQcm90bywga2V5LCBwcm90b0Rlc2MpO1xufSA6IGRQO1xuXG52YXIgd3JhcCA9IGZ1bmN0aW9uICh0YWcpIHtcbiAgdmFyIHN5bSA9IEFsbFN5bWJvbHNbdGFnXSA9IF9jcmVhdGUoJFN5bWJvbFtQUk9UT1RZUEVdKTtcbiAgc3ltLl9rID0gdGFnO1xuICByZXR1cm4gc3ltO1xufTtcblxudmFyIGlzU3ltYm9sID0gVVNFX05BVElWRSAmJiB0eXBlb2YgJFN5bWJvbC5pdGVyYXRvciA9PSAnc3ltYm9sJyA/IGZ1bmN0aW9uIChpdCkge1xuICByZXR1cm4gdHlwZW9mIGl0ID09ICdzeW1ib2wnO1xufSA6IGZ1bmN0aW9uIChpdCkge1xuICByZXR1cm4gaXQgaW5zdGFuY2VvZiAkU3ltYm9sO1xufTtcblxudmFyICRkZWZpbmVQcm9wZXJ0eSA9IGZ1bmN0aW9uIGRlZmluZVByb3BlcnR5KGl0LCBrZXksIEQpIHtcbiAgaWYgKGl0ID09PSBPYmplY3RQcm90bykgJGRlZmluZVByb3BlcnR5KE9QU3ltYm9scywga2V5LCBEKTtcbiAgYW5PYmplY3QoaXQpO1xuICBrZXkgPSB0b1ByaW1pdGl2ZShrZXksIHRydWUpO1xuICBhbk9iamVjdChEKTtcbiAgaWYgKGhhcyhBbGxTeW1ib2xzLCBrZXkpKSB7XG4gICAgaWYgKCFELmVudW1lcmFibGUpIHtcbiAgICAgIGlmICghaGFzKGl0LCBISURERU4pKSBkUChpdCwgSElEREVOLCBjcmVhdGVEZXNjKDEsIHt9KSk7XG4gICAgICBpdFtISURERU5dW2tleV0gPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoaGFzKGl0LCBISURERU4pICYmIGl0W0hJRERFTl1ba2V5XSkgaXRbSElEREVOXVtrZXldID0gZmFsc2U7XG4gICAgICBEID0gX2NyZWF0ZShELCB7IGVudW1lcmFibGU6IGNyZWF0ZURlc2MoMCwgZmFsc2UpIH0pO1xuICAgIH0gcmV0dXJuIHNldFN5bWJvbERlc2MoaXQsIGtleSwgRCk7XG4gIH0gcmV0dXJuIGRQKGl0LCBrZXksIEQpO1xufTtcbnZhciAkZGVmaW5lUHJvcGVydGllcyA9IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXMoaXQsIFApIHtcbiAgYW5PYmplY3QoaXQpO1xuICB2YXIga2V5cyA9IGVudW1LZXlzKFAgPSB0b0lPYmplY3QoUCkpO1xuICB2YXIgaSA9IDA7XG4gIHZhciBsID0ga2V5cy5sZW5ndGg7XG4gIHZhciBrZXk7XG4gIHdoaWxlIChsID4gaSkgJGRlZmluZVByb3BlcnR5KGl0LCBrZXkgPSBrZXlzW2krK10sIFBba2V5XSk7XG4gIHJldHVybiBpdDtcbn07XG52YXIgJGNyZWF0ZSA9IGZ1bmN0aW9uIGNyZWF0ZShpdCwgUCkge1xuICByZXR1cm4gUCA9PT0gdW5kZWZpbmVkID8gX2NyZWF0ZShpdCkgOiAkZGVmaW5lUHJvcGVydGllcyhfY3JlYXRlKGl0KSwgUCk7XG59O1xudmFyICRwcm9wZXJ0eUlzRW51bWVyYWJsZSA9IGZ1bmN0aW9uIHByb3BlcnR5SXNFbnVtZXJhYmxlKGtleSkge1xuICB2YXIgRSA9IGlzRW51bS5jYWxsKHRoaXMsIGtleSA9IHRvUHJpbWl0aXZlKGtleSwgdHJ1ZSkpO1xuICBpZiAodGhpcyA9PT0gT2JqZWN0UHJvdG8gJiYgaGFzKEFsbFN5bWJvbHMsIGtleSkgJiYgIWhhcyhPUFN5bWJvbHMsIGtleSkpIHJldHVybiBmYWxzZTtcbiAgcmV0dXJuIEUgfHwgIWhhcyh0aGlzLCBrZXkpIHx8ICFoYXMoQWxsU3ltYm9scywga2V5KSB8fCBoYXModGhpcywgSElEREVOKSAmJiB0aGlzW0hJRERFTl1ba2V5XSA/IEUgOiB0cnVlO1xufTtcbnZhciAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGl0LCBrZXkpIHtcbiAgaXQgPSB0b0lPYmplY3QoaXQpO1xuICBrZXkgPSB0b1ByaW1pdGl2ZShrZXksIHRydWUpO1xuICBpZiAoaXQgPT09IE9iamVjdFByb3RvICYmIGhhcyhBbGxTeW1ib2xzLCBrZXkpICYmICFoYXMoT1BTeW1ib2xzLCBrZXkpKSByZXR1cm47XG4gIHZhciBEID0gZ09QRChpdCwga2V5KTtcbiAgaWYgKEQgJiYgaGFzKEFsbFN5bWJvbHMsIGtleSkgJiYgIShoYXMoaXQsIEhJRERFTikgJiYgaXRbSElEREVOXVtrZXldKSkgRC5lbnVtZXJhYmxlID0gdHJ1ZTtcbiAgcmV0dXJuIEQ7XG59O1xudmFyICRnZXRPd25Qcm9wZXJ0eU5hbWVzID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlOYW1lcyhpdCkge1xuICB2YXIgbmFtZXMgPSBnT1BOKHRvSU9iamVjdChpdCkpO1xuICB2YXIgcmVzdWx0ID0gW107XG4gIHZhciBpID0gMDtcbiAgdmFyIGtleTtcbiAgd2hpbGUgKG5hbWVzLmxlbmd0aCA+IGkpIHtcbiAgICBpZiAoIWhhcyhBbGxTeW1ib2xzLCBrZXkgPSBuYW1lc1tpKytdKSAmJiBrZXkgIT0gSElEREVOICYmIGtleSAhPSBNRVRBKSByZXN1bHQucHVzaChrZXkpO1xuICB9IHJldHVybiByZXN1bHQ7XG59O1xudmFyICRnZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPSBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMoaXQpIHtcbiAgdmFyIElTX09QID0gaXQgPT09IE9iamVjdFByb3RvO1xuICB2YXIgbmFtZXMgPSBnT1BOKElTX09QID8gT1BTeW1ib2xzIDogdG9JT2JqZWN0KGl0KSk7XG4gIHZhciByZXN1bHQgPSBbXTtcbiAgdmFyIGkgPSAwO1xuICB2YXIga2V5O1xuICB3aGlsZSAobmFtZXMubGVuZ3RoID4gaSkge1xuICAgIGlmIChoYXMoQWxsU3ltYm9scywga2V5ID0gbmFtZXNbaSsrXSkgJiYgKElTX09QID8gaGFzKE9iamVjdFByb3RvLCBrZXkpIDogdHJ1ZSkpIHJlc3VsdC5wdXNoKEFsbFN5bWJvbHNba2V5XSk7XG4gIH0gcmV0dXJuIHJlc3VsdDtcbn07XG5cbi8vIDE5LjQuMS4xIFN5bWJvbChbZGVzY3JpcHRpb25dKVxuaWYgKCFVU0VfTkFUSVZFKSB7XG4gICRTeW1ib2wgPSBmdW5jdGlvbiBTeW1ib2woKSB7XG4gICAgaWYgKHRoaXMgaW5zdGFuY2VvZiAkU3ltYm9sKSB0aHJvdyBUeXBlRXJyb3IoJ1N5bWJvbCBpcyBub3QgYSBjb25zdHJ1Y3RvciEnKTtcbiAgICB2YXIgdGFnID0gdWlkKGFyZ3VtZW50cy5sZW5ndGggPiAwID8gYXJndW1lbnRzWzBdIDogdW5kZWZpbmVkKTtcbiAgICB2YXIgJHNldCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgaWYgKHRoaXMgPT09IE9iamVjdFByb3RvKSAkc2V0LmNhbGwoT1BTeW1ib2xzLCB2YWx1ZSk7XG4gICAgICBpZiAoaGFzKHRoaXMsIEhJRERFTikgJiYgaGFzKHRoaXNbSElEREVOXSwgdGFnKSkgdGhpc1tISURERU5dW3RhZ10gPSBmYWxzZTtcbiAgICAgIHNldFN5bWJvbERlc2ModGhpcywgdGFnLCBjcmVhdGVEZXNjKDEsIHZhbHVlKSk7XG4gICAgfTtcbiAgICBpZiAoREVTQ1JJUFRPUlMgJiYgc2V0dGVyKSBzZXRTeW1ib2xEZXNjKE9iamVjdFByb3RvLCB0YWcsIHsgY29uZmlndXJhYmxlOiB0cnVlLCBzZXQ6ICRzZXQgfSk7XG4gICAgcmV0dXJuIHdyYXAodGFnKTtcbiAgfTtcbiAgcmVkZWZpbmUoJFN5bWJvbFtQUk9UT1RZUEVdLCAndG9TdHJpbmcnLCBmdW5jdGlvbiB0b1N0cmluZygpIHtcbiAgICByZXR1cm4gdGhpcy5faztcbiAgfSk7XG5cbiAgJEdPUEQuZiA9ICRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7XG4gICREUC5mID0gJGRlZmluZVByb3BlcnR5O1xuICByZXF1aXJlKCcuL19vYmplY3QtZ29wbicpLmYgPSBnT1BORXh0LmYgPSAkZ2V0T3duUHJvcGVydHlOYW1lcztcbiAgcmVxdWlyZSgnLi9fb2JqZWN0LXBpZScpLmYgPSAkcHJvcGVydHlJc0VudW1lcmFibGU7XG4gICRHT1BTLmYgPSAkZ2V0T3duUHJvcGVydHlTeW1ib2xzO1xuXG4gIGlmIChERVNDUklQVE9SUyAmJiAhcmVxdWlyZSgnLi9fbGlicmFyeScpKSB7XG4gICAgcmVkZWZpbmUoT2JqZWN0UHJvdG8sICdwcm9wZXJ0eUlzRW51bWVyYWJsZScsICRwcm9wZXJ0eUlzRW51bWVyYWJsZSwgdHJ1ZSk7XG4gIH1cblxuICB3a3NFeHQuZiA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgcmV0dXJuIHdyYXAod2tzKG5hbWUpKTtcbiAgfTtcbn1cblxuJGV4cG9ydCgkZXhwb3J0LkcgKyAkZXhwb3J0LlcgKyAkZXhwb3J0LkYgKiAhVVNFX05BVElWRSwgeyBTeW1ib2w6ICRTeW1ib2wgfSk7XG5cbmZvciAodmFyIGVzNlN5bWJvbHMgPSAoXG4gIC8vIDE5LjQuMi4yLCAxOS40LjIuMywgMTkuNC4yLjQsIDE5LjQuMi42LCAxOS40LjIuOCwgMTkuNC4yLjksIDE5LjQuMi4xMCwgMTkuNC4yLjExLCAxOS40LjIuMTIsIDE5LjQuMi4xMywgMTkuNC4yLjE0XG4gICdoYXNJbnN0YW5jZSxpc0NvbmNhdFNwcmVhZGFibGUsaXRlcmF0b3IsbWF0Y2gscmVwbGFjZSxzZWFyY2gsc3BlY2llcyxzcGxpdCx0b1ByaW1pdGl2ZSx0b1N0cmluZ1RhZyx1bnNjb3BhYmxlcydcbikuc3BsaXQoJywnKSwgaiA9IDA7IGVzNlN5bWJvbHMubGVuZ3RoID4gajspd2tzKGVzNlN5bWJvbHNbaisrXSk7XG5cbmZvciAodmFyIHdlbGxLbm93blN5bWJvbHMgPSAka2V5cyh3a3Muc3RvcmUpLCBrID0gMDsgd2VsbEtub3duU3ltYm9scy5sZW5ndGggPiBrOykgd2tzRGVmaW5lKHdlbGxLbm93blN5bWJvbHNbaysrXSk7XG5cbiRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogIVVTRV9OQVRJVkUsICdTeW1ib2wnLCB7XG4gIC8vIDE5LjQuMi4xIFN5bWJvbC5mb3Ioa2V5KVxuICAnZm9yJzogZnVuY3Rpb24gKGtleSkge1xuICAgIHJldHVybiBoYXMoU3ltYm9sUmVnaXN0cnksIGtleSArPSAnJylcbiAgICAgID8gU3ltYm9sUmVnaXN0cnlba2V5XVxuICAgICAgOiBTeW1ib2xSZWdpc3RyeVtrZXldID0gJFN5bWJvbChrZXkpO1xuICB9LFxuICAvLyAxOS40LjIuNSBTeW1ib2wua2V5Rm9yKHN5bSlcbiAga2V5Rm9yOiBmdW5jdGlvbiBrZXlGb3Ioc3ltKSB7XG4gICAgaWYgKCFpc1N5bWJvbChzeW0pKSB0aHJvdyBUeXBlRXJyb3Ioc3ltICsgJyBpcyBub3QgYSBzeW1ib2whJyk7XG4gICAgZm9yICh2YXIga2V5IGluIFN5bWJvbFJlZ2lzdHJ5KSBpZiAoU3ltYm9sUmVnaXN0cnlba2V5XSA9PT0gc3ltKSByZXR1cm4ga2V5O1xuICB9LFxuICB1c2VTZXR0ZXI6IGZ1bmN0aW9uICgpIHsgc2V0dGVyID0gdHJ1ZTsgfSxcbiAgdXNlU2ltcGxlOiBmdW5jdGlvbiAoKSB7IHNldHRlciA9IGZhbHNlOyB9XG59KTtcblxuJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAhVVNFX05BVElWRSwgJ09iamVjdCcsIHtcbiAgLy8gMTkuMS4yLjIgT2JqZWN0LmNyZWF0ZShPIFssIFByb3BlcnRpZXNdKVxuICBjcmVhdGU6ICRjcmVhdGUsXG4gIC8vIDE5LjEuMi40IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShPLCBQLCBBdHRyaWJ1dGVzKVxuICBkZWZpbmVQcm9wZXJ0eTogJGRlZmluZVByb3BlcnR5LFxuICAvLyAxOS4xLjIuMyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhPLCBQcm9wZXJ0aWVzKVxuICBkZWZpbmVQcm9wZXJ0aWVzOiAkZGVmaW5lUHJvcGVydGllcyxcbiAgLy8gMTkuMS4yLjYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihPLCBQKVxuICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I6ICRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsXG4gIC8vIDE5LjEuMi43IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKE8pXG4gIGdldE93blByb3BlcnR5TmFtZXM6ICRnZXRPd25Qcm9wZXJ0eU5hbWVzLFxuICAvLyAxOS4xLjIuOCBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKE8pXG4gIGdldE93blByb3BlcnR5U3ltYm9sczogJGdldE93blByb3BlcnR5U3ltYm9sc1xufSk7XG5cbi8vIENocm9tZSAzOCBhbmQgMzkgYE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHNgIGZhaWxzIG9uIHByaW1pdGl2ZXNcbi8vIGh0dHBzOi8vYnVncy5jaHJvbWl1bS5vcmcvcC92OC9pc3N1ZXMvZGV0YWlsP2lkPTM0NDNcbnZhciBGQUlMU19PTl9QUklNSVRJVkVTID0gJGZhaWxzKGZ1bmN0aW9uICgpIHsgJEdPUFMuZigxKTsgfSk7XG5cbiRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogRkFJTFNfT05fUFJJTUlUSVZFUywgJ09iamVjdCcsIHtcbiAgZ2V0T3duUHJvcGVydHlTeW1ib2xzOiBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eVN5bWJvbHMoaXQpIHtcbiAgICByZXR1cm4gJEdPUFMuZih0b09iamVjdChpdCkpO1xuICB9XG59KTtcblxuLy8gMjQuMy4yIEpTT04uc3RyaW5naWZ5KHZhbHVlIFssIHJlcGxhY2VyIFssIHNwYWNlXV0pXG4kSlNPTiAmJiAkZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqICghVVNFX05BVElWRSB8fCAkZmFpbHMoZnVuY3Rpb24gKCkge1xuICB2YXIgUyA9ICRTeW1ib2woKTtcbiAgLy8gTVMgRWRnZSBjb252ZXJ0cyBzeW1ib2wgdmFsdWVzIHRvIEpTT04gYXMge31cbiAgLy8gV2ViS2l0IGNvbnZlcnRzIHN5bWJvbCB2YWx1ZXMgdG8gSlNPTiBhcyBudWxsXG4gIC8vIFY4IHRocm93cyBvbiBib3hlZCBzeW1ib2xzXG4gIHJldHVybiBfc3RyaW5naWZ5KFtTXSkgIT0gJ1tudWxsXScgfHwgX3N0cmluZ2lmeSh7IGE6IFMgfSkgIT0gJ3t9JyB8fCBfc3RyaW5naWZ5KE9iamVjdChTKSkgIT0gJ3t9Jztcbn0pKSwgJ0pTT04nLCB7XG4gIHN0cmluZ2lmeTogZnVuY3Rpb24gc3RyaW5naWZ5KGl0KSB7XG4gICAgdmFyIGFyZ3MgPSBbaXRdO1xuICAgIHZhciBpID0gMTtcbiAgICB2YXIgcmVwbGFjZXIsICRyZXBsYWNlcjtcbiAgICB3aGlsZSAoYXJndW1lbnRzLmxlbmd0aCA+IGkpIGFyZ3MucHVzaChhcmd1bWVudHNbaSsrXSk7XG4gICAgJHJlcGxhY2VyID0gcmVwbGFjZXIgPSBhcmdzWzFdO1xuICAgIGlmICghaXNPYmplY3QocmVwbGFjZXIpICYmIGl0ID09PSB1bmRlZmluZWQgfHwgaXNTeW1ib2woaXQpKSByZXR1cm47IC8vIElFOCByZXR1cm5zIHN0cmluZyBvbiB1bmRlZmluZWRcbiAgICBpZiAoIWlzQXJyYXkocmVwbGFjZXIpKSByZXBsYWNlciA9IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgICBpZiAodHlwZW9mICRyZXBsYWNlciA9PSAnZnVuY3Rpb24nKSB2YWx1ZSA9ICRyZXBsYWNlci5jYWxsKHRoaXMsIGtleSwgdmFsdWUpO1xuICAgICAgaWYgKCFpc1N5bWJvbCh2YWx1ZSkpIHJldHVybiB2YWx1ZTtcbiAgICB9O1xuICAgIGFyZ3NbMV0gPSByZXBsYWNlcjtcbiAgICByZXR1cm4gX3N0cmluZ2lmeS5hcHBseSgkSlNPTiwgYXJncyk7XG4gIH1cbn0pO1xuXG4vLyAxOS40LjMuNCBTeW1ib2wucHJvdG90eXBlW0BAdG9QcmltaXRpdmVdKGhpbnQpXG4kU3ltYm9sW1BST1RPVFlQRV1bVE9fUFJJTUlUSVZFXSB8fCByZXF1aXJlKCcuL19oaWRlJykoJFN5bWJvbFtQUk9UT1RZUEVdLCBUT19QUklNSVRJVkUsICRTeW1ib2xbUFJPVE9UWVBFXS52YWx1ZU9mKTtcbi8vIDE5LjQuMy41IFN5bWJvbC5wcm90b3R5cGVbQEB0b1N0cmluZ1RhZ11cbnNldFRvU3RyaW5nVGFnKCRTeW1ib2wsICdTeW1ib2wnKTtcbi8vIDIwLjIuMS45IE1hdGhbQEB0b1N0cmluZ1RhZ11cbnNldFRvU3RyaW5nVGFnKE1hdGgsICdNYXRoJywgdHJ1ZSk7XG4vLyAyNC4zLjMgSlNPTltAQHRvU3RyaW5nVGFnXVxuc2V0VG9TdHJpbmdUYWcoZ2xvYmFsLkpTT04sICdKU09OJywgdHJ1ZSk7XG4iLCIvLyBodHRwczovL2dpdGh1Yi5jb20vdGMzOS9wcm9wb3NhbC1wcm9taXNlLWZpbmFsbHlcbid1c2Ugc3RyaWN0JztcbnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi9fZXhwb3J0Jyk7XG52YXIgY29yZSA9IHJlcXVpcmUoJy4vX2NvcmUnKTtcbnZhciBnbG9iYWwgPSByZXF1aXJlKCcuL19nbG9iYWwnKTtcbnZhciBzcGVjaWVzQ29uc3RydWN0b3IgPSByZXF1aXJlKCcuL19zcGVjaWVzLWNvbnN0cnVjdG9yJyk7XG52YXIgcHJvbWlzZVJlc29sdmUgPSByZXF1aXJlKCcuL19wcm9taXNlLXJlc29sdmUnKTtcblxuJGV4cG9ydCgkZXhwb3J0LlAgKyAkZXhwb3J0LlIsICdQcm9taXNlJywgeyAnZmluYWxseSc6IGZ1bmN0aW9uIChvbkZpbmFsbHkpIHtcbiAgdmFyIEMgPSBzcGVjaWVzQ29uc3RydWN0b3IodGhpcywgY29yZS5Qcm9taXNlIHx8IGdsb2JhbC5Qcm9taXNlKTtcbiAgdmFyIGlzRnVuY3Rpb24gPSB0eXBlb2Ygb25GaW5hbGx5ID09ICdmdW5jdGlvbic7XG4gIHJldHVybiB0aGlzLnRoZW4oXG4gICAgaXNGdW5jdGlvbiA/IGZ1bmN0aW9uICh4KSB7XG4gICAgICByZXR1cm4gcHJvbWlzZVJlc29sdmUoQywgb25GaW5hbGx5KCkpLnRoZW4oZnVuY3Rpb24gKCkgeyByZXR1cm4geDsgfSk7XG4gICAgfSA6IG9uRmluYWxseSxcbiAgICBpc0Z1bmN0aW9uID8gZnVuY3Rpb24gKGUpIHtcbiAgICAgIHJldHVybiBwcm9taXNlUmVzb2x2ZShDLCBvbkZpbmFsbHkoKSkudGhlbihmdW5jdGlvbiAoKSB7IHRocm93IGU7IH0pO1xuICAgIH0gOiBvbkZpbmFsbHlcbiAgKTtcbn0gfSk7XG4iLCIndXNlIHN0cmljdCc7XG4vLyBodHRwczovL2dpdGh1Yi5jb20vdGMzOS9wcm9wb3NhbC1wcm9taXNlLXRyeVxudmFyICRleHBvcnQgPSByZXF1aXJlKCcuL19leHBvcnQnKTtcbnZhciBuZXdQcm9taXNlQ2FwYWJpbGl0eSA9IHJlcXVpcmUoJy4vX25ldy1wcm9taXNlLWNhcGFiaWxpdHknKTtcbnZhciBwZXJmb3JtID0gcmVxdWlyZSgnLi9fcGVyZm9ybScpO1xuXG4kZXhwb3J0KCRleHBvcnQuUywgJ1Byb21pc2UnLCB7ICd0cnknOiBmdW5jdGlvbiAoY2FsbGJhY2tmbikge1xuICB2YXIgcHJvbWlzZUNhcGFiaWxpdHkgPSBuZXdQcm9taXNlQ2FwYWJpbGl0eS5mKHRoaXMpO1xuICB2YXIgcmVzdWx0ID0gcGVyZm9ybShjYWxsYmFja2ZuKTtcbiAgKHJlc3VsdC5lID8gcHJvbWlzZUNhcGFiaWxpdHkucmVqZWN0IDogcHJvbWlzZUNhcGFiaWxpdHkucmVzb2x2ZSkocmVzdWx0LnYpO1xuICByZXR1cm4gcHJvbWlzZUNhcGFiaWxpdHkucHJvbWlzZTtcbn0gfSk7XG4iLCJyZXF1aXJlKCcuL193a3MtZGVmaW5lJykoJ2FzeW5jSXRlcmF0b3InKTtcbiIsInJlcXVpcmUoJy4vX3drcy1kZWZpbmUnKSgnb2JzZXJ2YWJsZScpO1xuIiwicmVxdWlyZSgnLi9lczYuYXJyYXkuaXRlcmF0b3InKTtcbnZhciBnbG9iYWwgPSByZXF1aXJlKCcuL19nbG9iYWwnKTtcbnZhciBoaWRlID0gcmVxdWlyZSgnLi9faGlkZScpO1xudmFyIEl0ZXJhdG9ycyA9IHJlcXVpcmUoJy4vX2l0ZXJhdG9ycycpO1xudmFyIFRPX1NUUklOR19UQUcgPSByZXF1aXJlKCcuL193a3MnKSgndG9TdHJpbmdUYWcnKTtcblxudmFyIERPTUl0ZXJhYmxlcyA9ICgnQ1NTUnVsZUxpc3QsQ1NTU3R5bGVEZWNsYXJhdGlvbixDU1NWYWx1ZUxpc3QsQ2xpZW50UmVjdExpc3QsRE9NUmVjdExpc3QsRE9NU3RyaW5nTGlzdCwnICtcbiAgJ0RPTVRva2VuTGlzdCxEYXRhVHJhbnNmZXJJdGVtTGlzdCxGaWxlTGlzdCxIVE1MQWxsQ29sbGVjdGlvbixIVE1MQ29sbGVjdGlvbixIVE1MRm9ybUVsZW1lbnQsSFRNTFNlbGVjdEVsZW1lbnQsJyArXG4gICdNZWRpYUxpc3QsTWltZVR5cGVBcnJheSxOYW1lZE5vZGVNYXAsTm9kZUxpc3QsUGFpbnRSZXF1ZXN0TGlzdCxQbHVnaW4sUGx1Z2luQXJyYXksU1ZHTGVuZ3RoTGlzdCxTVkdOdW1iZXJMaXN0LCcgK1xuICAnU1ZHUGF0aFNlZ0xpc3QsU1ZHUG9pbnRMaXN0LFNWR1N0cmluZ0xpc3QsU1ZHVHJhbnNmb3JtTGlzdCxTb3VyY2VCdWZmZXJMaXN0LFN0eWxlU2hlZXRMaXN0LFRleHRUcmFja0N1ZUxpc3QsJyArXG4gICdUZXh0VHJhY2tMaXN0LFRvdWNoTGlzdCcpLnNwbGl0KCcsJyk7XG5cbmZvciAodmFyIGkgPSAwOyBpIDwgRE9NSXRlcmFibGVzLmxlbmd0aDsgaSsrKSB7XG4gIHZhciBOQU1FID0gRE9NSXRlcmFibGVzW2ldO1xuICB2YXIgQ29sbGVjdGlvbiA9IGdsb2JhbFtOQU1FXTtcbiAgdmFyIHByb3RvID0gQ29sbGVjdGlvbiAmJiBDb2xsZWN0aW9uLnByb3RvdHlwZTtcbiAgaWYgKHByb3RvICYmICFwcm90b1tUT19TVFJJTkdfVEFHXSkgaGlkZShwcm90bywgVE9fU1RSSU5HX1RBRywgTkFNRSk7XG4gIEl0ZXJhdG9yc1tOQU1FXSA9IEl0ZXJhdG9ycy5BcnJheTtcbn1cbiIsIi8qXG4gKiAgQ29weXJpZ2h0IChjKSAyMDE3IFRoZSBXZWJSVEMgcHJvamVjdCBhdXRob3JzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqICBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhIEJTRC1zdHlsZSBsaWNlbnNlXG4gKiAgdGhhdCBjYW4gYmUgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBvZiB0aGUgc291cmNlXG4gKiAgdHJlZS5cbiAqL1xuIC8qIGVzbGludC1lbnYgbm9kZSAqL1xuJ3VzZSBzdHJpY3QnO1xuXG52YXIgU0RQVXRpbHMgPSByZXF1aXJlKCdzZHAnKTtcblxuZnVuY3Rpb24gZml4U3RhdHNUeXBlKHN0YXQpIHtcbiAgcmV0dXJuIHtcbiAgICBpbmJvdW5kcnRwOiAnaW5ib3VuZC1ydHAnLFxuICAgIG91dGJvdW5kcnRwOiAnb3V0Ym91bmQtcnRwJyxcbiAgICBjYW5kaWRhdGVwYWlyOiAnY2FuZGlkYXRlLXBhaXInLFxuICAgIGxvY2FsY2FuZGlkYXRlOiAnbG9jYWwtY2FuZGlkYXRlJyxcbiAgICByZW1vdGVjYW5kaWRhdGU6ICdyZW1vdGUtY2FuZGlkYXRlJ1xuICB9W3N0YXQudHlwZV0gfHwgc3RhdC50eXBlO1xufVxuXG5mdW5jdGlvbiB3cml0ZU1lZGlhU2VjdGlvbih0cmFuc2NlaXZlciwgY2FwcywgdHlwZSwgc3RyZWFtLCBkdGxzUm9sZSkge1xuICB2YXIgc2RwID0gU0RQVXRpbHMud3JpdGVSdHBEZXNjcmlwdGlvbih0cmFuc2NlaXZlci5raW5kLCBjYXBzKTtcblxuICAvLyBNYXAgSUNFIHBhcmFtZXRlcnMgKHVmcmFnLCBwd2QpIHRvIFNEUC5cbiAgc2RwICs9IFNEUFV0aWxzLndyaXRlSWNlUGFyYW1ldGVycyhcbiAgICAgIHRyYW5zY2VpdmVyLmljZUdhdGhlcmVyLmdldExvY2FsUGFyYW1ldGVycygpKTtcblxuICAvLyBNYXAgRFRMUyBwYXJhbWV0ZXJzIHRvIFNEUC5cbiAgc2RwICs9IFNEUFV0aWxzLndyaXRlRHRsc1BhcmFtZXRlcnMoXG4gICAgICB0cmFuc2NlaXZlci5kdGxzVHJhbnNwb3J0LmdldExvY2FsUGFyYW1ldGVycygpLFxuICAgICAgdHlwZSA9PT0gJ29mZmVyJyA/ICdhY3RwYXNzJyA6IGR0bHNSb2xlIHx8ICdhY3RpdmUnKTtcblxuICBzZHAgKz0gJ2E9bWlkOicgKyB0cmFuc2NlaXZlci5taWQgKyAnXFxyXFxuJztcblxuICBpZiAodHJhbnNjZWl2ZXIucnRwU2VuZGVyICYmIHRyYW5zY2VpdmVyLnJ0cFJlY2VpdmVyKSB7XG4gICAgc2RwICs9ICdhPXNlbmRyZWN2XFxyXFxuJztcbiAgfSBlbHNlIGlmICh0cmFuc2NlaXZlci5ydHBTZW5kZXIpIHtcbiAgICBzZHAgKz0gJ2E9c2VuZG9ubHlcXHJcXG4nO1xuICB9IGVsc2UgaWYgKHRyYW5zY2VpdmVyLnJ0cFJlY2VpdmVyKSB7XG4gICAgc2RwICs9ICdhPXJlY3Zvbmx5XFxyXFxuJztcbiAgfSBlbHNlIHtcbiAgICBzZHAgKz0gJ2E9aW5hY3RpdmVcXHJcXG4nO1xuICB9XG5cbiAgaWYgKHRyYW5zY2VpdmVyLnJ0cFNlbmRlcikge1xuICAgIHZhciB0cmFja0lkID0gdHJhbnNjZWl2ZXIucnRwU2VuZGVyLl9pbml0aWFsVHJhY2tJZCB8fFxuICAgICAgICB0cmFuc2NlaXZlci5ydHBTZW5kZXIudHJhY2suaWQ7XG4gICAgdHJhbnNjZWl2ZXIucnRwU2VuZGVyLl9pbml0aWFsVHJhY2tJZCA9IHRyYWNrSWQ7XG4gICAgLy8gc3BlYy5cbiAgICB2YXIgbXNpZCA9ICdtc2lkOicgKyAoc3RyZWFtID8gc3RyZWFtLmlkIDogJy0nKSArICcgJyArXG4gICAgICAgIHRyYWNrSWQgKyAnXFxyXFxuJztcbiAgICBzZHAgKz0gJ2E9JyArIG1zaWQ7XG4gICAgLy8gZm9yIENocm9tZS4gTGVnYWN5IHNob3VsZCBubyBsb25nZXIgYmUgcmVxdWlyZWQuXG4gICAgc2RwICs9ICdhPXNzcmM6JyArIHRyYW5zY2VpdmVyLnNlbmRFbmNvZGluZ1BhcmFtZXRlcnNbMF0uc3NyYyArXG4gICAgICAgICcgJyArIG1zaWQ7XG5cbiAgICAvLyBSVFhcbiAgICBpZiAodHJhbnNjZWl2ZXIuc2VuZEVuY29kaW5nUGFyYW1ldGVyc1swXS5ydHgpIHtcbiAgICAgIHNkcCArPSAnYT1zc3JjOicgKyB0cmFuc2NlaXZlci5zZW5kRW5jb2RpbmdQYXJhbWV0ZXJzWzBdLnJ0eC5zc3JjICtcbiAgICAgICAgICAnICcgKyBtc2lkO1xuICAgICAgc2RwICs9ICdhPXNzcmMtZ3JvdXA6RklEICcgK1xuICAgICAgICAgIHRyYW5zY2VpdmVyLnNlbmRFbmNvZGluZ1BhcmFtZXRlcnNbMF0uc3NyYyArICcgJyArXG4gICAgICAgICAgdHJhbnNjZWl2ZXIuc2VuZEVuY29kaW5nUGFyYW1ldGVyc1swXS5ydHguc3NyYyArXG4gICAgICAgICAgJ1xcclxcbic7XG4gICAgfVxuICB9XG4gIC8vIEZJWE1FOiB0aGlzIHNob3VsZCBiZSB3cml0dGVuIGJ5IHdyaXRlUnRwRGVzY3JpcHRpb24uXG4gIHNkcCArPSAnYT1zc3JjOicgKyB0cmFuc2NlaXZlci5zZW5kRW5jb2RpbmdQYXJhbWV0ZXJzWzBdLnNzcmMgK1xuICAgICAgJyBjbmFtZTonICsgU0RQVXRpbHMubG9jYWxDTmFtZSArICdcXHJcXG4nO1xuICBpZiAodHJhbnNjZWl2ZXIucnRwU2VuZGVyICYmIHRyYW5zY2VpdmVyLnNlbmRFbmNvZGluZ1BhcmFtZXRlcnNbMF0ucnR4KSB7XG4gICAgc2RwICs9ICdhPXNzcmM6JyArIHRyYW5zY2VpdmVyLnNlbmRFbmNvZGluZ1BhcmFtZXRlcnNbMF0ucnR4LnNzcmMgK1xuICAgICAgICAnIGNuYW1lOicgKyBTRFBVdGlscy5sb2NhbENOYW1lICsgJ1xcclxcbic7XG4gIH1cbiAgcmV0dXJuIHNkcDtcbn1cblxuLy8gRWRnZSBkb2VzIG5vdCBsaWtlXG4vLyAxKSBzdHVuOiBmaWx0ZXJlZCBhZnRlciAxNDM5MyB1bmxlc3MgP3RyYW5zcG9ydD11ZHAgaXMgcHJlc2VudFxuLy8gMikgdHVybjogdGhhdCBkb2VzIG5vdCBoYXZlIGFsbCBvZiB0dXJuOmhvc3Q6cG9ydD90cmFuc3BvcnQ9dWRwXG4vLyAzKSB0dXJuOiB3aXRoIGlwdjYgYWRkcmVzc2VzXG4vLyA0KSB0dXJuOiBvY2N1cnJpbmcgbXVsaXBsZSB0aW1lc1xuZnVuY3Rpb24gZmlsdGVySWNlU2VydmVycyhpY2VTZXJ2ZXJzLCBlZGdlVmVyc2lvbikge1xuICB2YXIgaGFzVHVybiA9IGZhbHNlO1xuICBpY2VTZXJ2ZXJzID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShpY2VTZXJ2ZXJzKSk7XG4gIHJldHVybiBpY2VTZXJ2ZXJzLmZpbHRlcihmdW5jdGlvbihzZXJ2ZXIpIHtcbiAgICBpZiAoc2VydmVyICYmIChzZXJ2ZXIudXJscyB8fCBzZXJ2ZXIudXJsKSkge1xuICAgICAgdmFyIHVybHMgPSBzZXJ2ZXIudXJscyB8fCBzZXJ2ZXIudXJsO1xuICAgICAgaWYgKHNlcnZlci51cmwgJiYgIXNlcnZlci51cmxzKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignUlRDSWNlU2VydmVyLnVybCBpcyBkZXByZWNhdGVkISBVc2UgdXJscyBpbnN0ZWFkLicpO1xuICAgICAgfVxuICAgICAgdmFyIGlzU3RyaW5nID0gdHlwZW9mIHVybHMgPT09ICdzdHJpbmcnO1xuICAgICAgaWYgKGlzU3RyaW5nKSB7XG4gICAgICAgIHVybHMgPSBbdXJsc107XG4gICAgICB9XG4gICAgICB1cmxzID0gdXJscy5maWx0ZXIoZnVuY3Rpb24odXJsKSB7XG4gICAgICAgIHZhciB2YWxpZFR1cm4gPSB1cmwuaW5kZXhPZigndHVybjonKSA9PT0gMCAmJlxuICAgICAgICAgICAgdXJsLmluZGV4T2YoJ3RyYW5zcG9ydD11ZHAnKSAhPT0gLTEgJiZcbiAgICAgICAgICAgIHVybC5pbmRleE9mKCd0dXJuOlsnKSA9PT0gLTEgJiZcbiAgICAgICAgICAgICFoYXNUdXJuO1xuXG4gICAgICAgIGlmICh2YWxpZFR1cm4pIHtcbiAgICAgICAgICBoYXNUdXJuID0gdHJ1ZTtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdXJsLmluZGV4T2YoJ3N0dW46JykgPT09IDAgJiYgZWRnZVZlcnNpb24gPj0gMTQzOTMgJiZcbiAgICAgICAgICAgIHVybC5pbmRleE9mKCc/dHJhbnNwb3J0PXVkcCcpID09PSAtMTtcbiAgICAgIH0pO1xuXG4gICAgICBkZWxldGUgc2VydmVyLnVybDtcbiAgICAgIHNlcnZlci51cmxzID0gaXNTdHJpbmcgPyB1cmxzWzBdIDogdXJscztcbiAgICAgIHJldHVybiAhIXVybHMubGVuZ3RoO1xuICAgIH1cbiAgfSk7XG59XG5cbi8vIERldGVybWluZXMgdGhlIGludGVyc2VjdGlvbiBvZiBsb2NhbCBhbmQgcmVtb3RlIGNhcGFiaWxpdGllcy5cbmZ1bmN0aW9uIGdldENvbW1vbkNhcGFiaWxpdGllcyhsb2NhbENhcGFiaWxpdGllcywgcmVtb3RlQ2FwYWJpbGl0aWVzKSB7XG4gIHZhciBjb21tb25DYXBhYmlsaXRpZXMgPSB7XG4gICAgY29kZWNzOiBbXSxcbiAgICBoZWFkZXJFeHRlbnNpb25zOiBbXSxcbiAgICBmZWNNZWNoYW5pc21zOiBbXVxuICB9O1xuXG4gIHZhciBmaW5kQ29kZWNCeVBheWxvYWRUeXBlID0gZnVuY3Rpb24ocHQsIGNvZGVjcykge1xuICAgIHB0ID0gcGFyc2VJbnQocHQsIDEwKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvZGVjcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGNvZGVjc1tpXS5wYXlsb2FkVHlwZSA9PT0gcHQgfHxcbiAgICAgICAgICBjb2RlY3NbaV0ucHJlZmVycmVkUGF5bG9hZFR5cGUgPT09IHB0KSB7XG4gICAgICAgIHJldHVybiBjb2RlY3NbaV07XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIHZhciBydHhDYXBhYmlsaXR5TWF0Y2hlcyA9IGZ1bmN0aW9uKGxSdHgsIHJSdHgsIGxDb2RlY3MsIHJDb2RlY3MpIHtcbiAgICB2YXIgbENvZGVjID0gZmluZENvZGVjQnlQYXlsb2FkVHlwZShsUnR4LnBhcmFtZXRlcnMuYXB0LCBsQ29kZWNzKTtcbiAgICB2YXIgckNvZGVjID0gZmluZENvZGVjQnlQYXlsb2FkVHlwZShyUnR4LnBhcmFtZXRlcnMuYXB0LCByQ29kZWNzKTtcbiAgICByZXR1cm4gbENvZGVjICYmIHJDb2RlYyAmJlxuICAgICAgICBsQ29kZWMubmFtZS50b0xvd2VyQ2FzZSgpID09PSByQ29kZWMubmFtZS50b0xvd2VyQ2FzZSgpO1xuICB9O1xuXG4gIGxvY2FsQ2FwYWJpbGl0aWVzLmNvZGVjcy5mb3JFYWNoKGZ1bmN0aW9uKGxDb2RlYykge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVtb3RlQ2FwYWJpbGl0aWVzLmNvZGVjcy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIHJDb2RlYyA9IHJlbW90ZUNhcGFiaWxpdGllcy5jb2RlY3NbaV07XG4gICAgICBpZiAobENvZGVjLm5hbWUudG9Mb3dlckNhc2UoKSA9PT0gckNvZGVjLm5hbWUudG9Mb3dlckNhc2UoKSAmJlxuICAgICAgICAgIGxDb2RlYy5jbG9ja1JhdGUgPT09IHJDb2RlYy5jbG9ja1JhdGUpIHtcbiAgICAgICAgaWYgKGxDb2RlYy5uYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdydHgnICYmXG4gICAgICAgICAgICBsQ29kZWMucGFyYW1ldGVycyAmJiByQ29kZWMucGFyYW1ldGVycy5hcHQpIHtcbiAgICAgICAgICAvLyBmb3IgUlRYIHdlIG5lZWQgdG8gZmluZCB0aGUgbG9jYWwgcnR4IHRoYXQgaGFzIGEgYXB0XG4gICAgICAgICAgLy8gd2hpY2ggcG9pbnRzIHRvIHRoZSBzYW1lIGxvY2FsIGNvZGVjIGFzIHRoZSByZW1vdGUgb25lLlxuICAgICAgICAgIGlmICghcnR4Q2FwYWJpbGl0eU1hdGNoZXMobENvZGVjLCByQ29kZWMsXG4gICAgICAgICAgICAgIGxvY2FsQ2FwYWJpbGl0aWVzLmNvZGVjcywgcmVtb3RlQ2FwYWJpbGl0aWVzLmNvZGVjcykpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByQ29kZWMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHJDb2RlYykpOyAvLyBkZWVwY29weVxuICAgICAgICAvLyBudW1iZXIgb2YgY2hhbm5lbHMgaXMgdGhlIGhpZ2hlc3QgY29tbW9uIG51bWJlciBvZiBjaGFubmVsc1xuICAgICAgICByQ29kZWMubnVtQ2hhbm5lbHMgPSBNYXRoLm1pbihsQ29kZWMubnVtQ2hhbm5lbHMsXG4gICAgICAgICAgICByQ29kZWMubnVtQ2hhbm5lbHMpO1xuICAgICAgICAvLyBwdXNoIHJDb2RlYyBzbyB3ZSByZXBseSB3aXRoIG9mZmVyZXIgcGF5bG9hZCB0eXBlXG4gICAgICAgIGNvbW1vbkNhcGFiaWxpdGllcy5jb2RlY3MucHVzaChyQ29kZWMpO1xuXG4gICAgICAgIC8vIGRldGVybWluZSBjb21tb24gZmVlZGJhY2sgbWVjaGFuaXNtc1xuICAgICAgICByQ29kZWMucnRjcEZlZWRiYWNrID0gckNvZGVjLnJ0Y3BGZWVkYmFjay5maWx0ZXIoZnVuY3Rpb24oZmIpIHtcbiAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGxDb2RlYy5ydGNwRmVlZGJhY2subGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIGlmIChsQ29kZWMucnRjcEZlZWRiYWNrW2pdLnR5cGUgPT09IGZiLnR5cGUgJiZcbiAgICAgICAgICAgICAgICBsQ29kZWMucnRjcEZlZWRiYWNrW2pdLnBhcmFtZXRlciA9PT0gZmIucGFyYW1ldGVyKSB7XG4gICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBGSVhNRTogYWxzbyBuZWVkIHRvIGRldGVybWluZSAucGFyYW1ldGVyc1xuICAgICAgICAvLyAgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9vcGVucGVlci9vcnRjL2lzc3Vlcy81NjlcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICBsb2NhbENhcGFiaWxpdGllcy5oZWFkZXJFeHRlbnNpb25zLmZvckVhY2goZnVuY3Rpb24obEhlYWRlckV4dGVuc2lvbikge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVtb3RlQ2FwYWJpbGl0aWVzLmhlYWRlckV4dGVuc2lvbnMubGVuZ3RoO1xuICAgICAgICAgaSsrKSB7XG4gICAgICB2YXIgckhlYWRlckV4dGVuc2lvbiA9IHJlbW90ZUNhcGFiaWxpdGllcy5oZWFkZXJFeHRlbnNpb25zW2ldO1xuICAgICAgaWYgKGxIZWFkZXJFeHRlbnNpb24udXJpID09PSBySGVhZGVyRXh0ZW5zaW9uLnVyaSkge1xuICAgICAgICBjb21tb25DYXBhYmlsaXRpZXMuaGVhZGVyRXh0ZW5zaW9ucy5wdXNoKHJIZWFkZXJFeHRlbnNpb24pO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIC8vIEZJWE1FOiBmZWNNZWNoYW5pc21zXG4gIHJldHVybiBjb21tb25DYXBhYmlsaXRpZXM7XG59XG5cbi8vIGlzIGFjdGlvbj1zZXRMb2NhbERlc2NyaXB0aW9uIHdpdGggdHlwZSBhbGxvd2VkIGluIHNpZ25hbGluZ1N0YXRlXG5mdW5jdGlvbiBpc0FjdGlvbkFsbG93ZWRJblNpZ25hbGluZ1N0YXRlKGFjdGlvbiwgdHlwZSwgc2lnbmFsaW5nU3RhdGUpIHtcbiAgcmV0dXJuIHtcbiAgICBvZmZlcjoge1xuICAgICAgc2V0TG9jYWxEZXNjcmlwdGlvbjogWydzdGFibGUnLCAnaGF2ZS1sb2NhbC1vZmZlciddLFxuICAgICAgc2V0UmVtb3RlRGVzY3JpcHRpb246IFsnc3RhYmxlJywgJ2hhdmUtcmVtb3RlLW9mZmVyJ11cbiAgICB9LFxuICAgIGFuc3dlcjoge1xuICAgICAgc2V0TG9jYWxEZXNjcmlwdGlvbjogWydoYXZlLXJlbW90ZS1vZmZlcicsICdoYXZlLWxvY2FsLXByYW5zd2VyJ10sXG4gICAgICBzZXRSZW1vdGVEZXNjcmlwdGlvbjogWydoYXZlLWxvY2FsLW9mZmVyJywgJ2hhdmUtcmVtb3RlLXByYW5zd2VyJ11cbiAgICB9XG4gIH1bdHlwZV1bYWN0aW9uXS5pbmRleE9mKHNpZ25hbGluZ1N0YXRlKSAhPT0gLTE7XG59XG5cbmZ1bmN0aW9uIG1heWJlQWRkQ2FuZGlkYXRlKGljZVRyYW5zcG9ydCwgY2FuZGlkYXRlKSB7XG4gIC8vIEVkZ2UncyBpbnRlcm5hbCByZXByZXNlbnRhdGlvbiBhZGRzIHNvbWUgZmllbGRzIHRoZXJlZm9yZVxuICAvLyBub3QgYWxsIGZpZWxk0ZUgYXJlIHRha2VuIGludG8gYWNjb3VudC5cbiAgdmFyIGFscmVhZHlBZGRlZCA9IGljZVRyYW5zcG9ydC5nZXRSZW1vdGVDYW5kaWRhdGVzKClcbiAgICAgIC5maW5kKGZ1bmN0aW9uKHJlbW90ZUNhbmRpZGF0ZSkge1xuICAgICAgICByZXR1cm4gY2FuZGlkYXRlLmZvdW5kYXRpb24gPT09IHJlbW90ZUNhbmRpZGF0ZS5mb3VuZGF0aW9uICYmXG4gICAgICAgICAgICBjYW5kaWRhdGUuaXAgPT09IHJlbW90ZUNhbmRpZGF0ZS5pcCAmJlxuICAgICAgICAgICAgY2FuZGlkYXRlLnBvcnQgPT09IHJlbW90ZUNhbmRpZGF0ZS5wb3J0ICYmXG4gICAgICAgICAgICBjYW5kaWRhdGUucHJpb3JpdHkgPT09IHJlbW90ZUNhbmRpZGF0ZS5wcmlvcml0eSAmJlxuICAgICAgICAgICAgY2FuZGlkYXRlLnByb3RvY29sID09PSByZW1vdGVDYW5kaWRhdGUucHJvdG9jb2wgJiZcbiAgICAgICAgICAgIGNhbmRpZGF0ZS50eXBlID09PSByZW1vdGVDYW5kaWRhdGUudHlwZTtcbiAgICAgIH0pO1xuICBpZiAoIWFscmVhZHlBZGRlZCkge1xuICAgIGljZVRyYW5zcG9ydC5hZGRSZW1vdGVDYW5kaWRhdGUoY2FuZGlkYXRlKTtcbiAgfVxuICByZXR1cm4gIWFscmVhZHlBZGRlZDtcbn1cblxuXG5mdW5jdGlvbiBtYWtlRXJyb3IobmFtZSwgZGVzY3JpcHRpb24pIHtcbiAgdmFyIGUgPSBuZXcgRXJyb3IoZGVzY3JpcHRpb24pO1xuICBlLm5hbWUgPSBuYW1lO1xuICAvLyBsZWdhY3kgZXJyb3IgY29kZXMgZnJvbSBodHRwczovL2hleWNhbS5naXRodWIuaW8vd2ViaWRsLyNpZGwtRE9NRXhjZXB0aW9uLWVycm9yLW5hbWVzXG4gIGUuY29kZSA9IHtcbiAgICBOb3RTdXBwb3J0ZWRFcnJvcjogOSxcbiAgICBJbnZhbGlkU3RhdGVFcnJvcjogMTEsXG4gICAgSW52YWxpZEFjY2Vzc0Vycm9yOiAxNSxcbiAgICBUeXBlRXJyb3I6IHVuZGVmaW5lZCxcbiAgICBPcGVyYXRpb25FcnJvcjogdW5kZWZpbmVkXG4gIH1bbmFtZV07XG4gIHJldHVybiBlO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKHdpbmRvdywgZWRnZVZlcnNpb24pIHtcbiAgLy8gaHR0cHM6Ly93M2MuZ2l0aHViLmlvL21lZGlhY2FwdHVyZS1tYWluLyNtZWRpYXN0cmVhbVxuICAvLyBIZWxwZXIgZnVuY3Rpb24gdG8gYWRkIHRoZSB0cmFjayB0byB0aGUgc3RyZWFtIGFuZFxuICAvLyBkaXNwYXRjaCB0aGUgZXZlbnQgb3Vyc2VsdmVzLlxuICBmdW5jdGlvbiBhZGRUcmFja1RvU3RyZWFtQW5kRmlyZUV2ZW50KHRyYWNrLCBzdHJlYW0pIHtcbiAgICBzdHJlYW0uYWRkVHJhY2sodHJhY2spO1xuICAgIHN0cmVhbS5kaXNwYXRjaEV2ZW50KG5ldyB3aW5kb3cuTWVkaWFTdHJlYW1UcmFja0V2ZW50KCdhZGR0cmFjaycsXG4gICAgICAgIHt0cmFjazogdHJhY2t9KSk7XG4gIH1cblxuICBmdW5jdGlvbiByZW1vdmVUcmFja0Zyb21TdHJlYW1BbmRGaXJlRXZlbnQodHJhY2ssIHN0cmVhbSkge1xuICAgIHN0cmVhbS5yZW1vdmVUcmFjayh0cmFjayk7XG4gICAgc3RyZWFtLmRpc3BhdGNoRXZlbnQobmV3IHdpbmRvdy5NZWRpYVN0cmVhbVRyYWNrRXZlbnQoJ3JlbW92ZXRyYWNrJyxcbiAgICAgICAge3RyYWNrOiB0cmFja30pKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZpcmVBZGRUcmFjayhwYywgdHJhY2ssIHJlY2VpdmVyLCBzdHJlYW1zKSB7XG4gICAgdmFyIHRyYWNrRXZlbnQgPSBuZXcgRXZlbnQoJ3RyYWNrJyk7XG4gICAgdHJhY2tFdmVudC50cmFjayA9IHRyYWNrO1xuICAgIHRyYWNrRXZlbnQucmVjZWl2ZXIgPSByZWNlaXZlcjtcbiAgICB0cmFja0V2ZW50LnRyYW5zY2VpdmVyID0ge3JlY2VpdmVyOiByZWNlaXZlcn07XG4gICAgdHJhY2tFdmVudC5zdHJlYW1zID0gc3RyZWFtcztcbiAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgIHBjLl9kaXNwYXRjaEV2ZW50KCd0cmFjaycsIHRyYWNrRXZlbnQpO1xuICAgIH0pO1xuICB9XG5cbiAgdmFyIFJUQ1BlZXJDb25uZWN0aW9uID0gZnVuY3Rpb24oY29uZmlnKSB7XG4gICAgdmFyIHBjID0gdGhpcztcblxuICAgIHZhciBfZXZlbnRUYXJnZXQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgWydhZGRFdmVudExpc3RlbmVyJywgJ3JlbW92ZUV2ZW50TGlzdGVuZXInLCAnZGlzcGF0Y2hFdmVudCddXG4gICAgICAgIC5mb3JFYWNoKGZ1bmN0aW9uKG1ldGhvZCkge1xuICAgICAgICAgIHBjW21ldGhvZF0gPSBfZXZlbnRUYXJnZXRbbWV0aG9kXS5iaW5kKF9ldmVudFRhcmdldCk7XG4gICAgICAgIH0pO1xuXG4gICAgdGhpcy5jYW5Ucmlja2xlSWNlQ2FuZGlkYXRlcyA9IG51bGw7XG5cbiAgICB0aGlzLm5lZWROZWdvdGlhdGlvbiA9IGZhbHNlO1xuXG4gICAgdGhpcy5sb2NhbFN0cmVhbXMgPSBbXTtcbiAgICB0aGlzLnJlbW90ZVN0cmVhbXMgPSBbXTtcblxuICAgIHRoaXMuX2xvY2FsRGVzY3JpcHRpb24gPSBudWxsO1xuICAgIHRoaXMuX3JlbW90ZURlc2NyaXB0aW9uID0gbnVsbDtcblxuICAgIHRoaXMuc2lnbmFsaW5nU3RhdGUgPSAnc3RhYmxlJztcbiAgICB0aGlzLmljZUNvbm5lY3Rpb25TdGF0ZSA9ICduZXcnO1xuICAgIHRoaXMuY29ubmVjdGlvblN0YXRlID0gJ25ldyc7XG4gICAgdGhpcy5pY2VHYXRoZXJpbmdTdGF0ZSA9ICduZXcnO1xuXG4gICAgY29uZmlnID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjb25maWcgfHwge30pKTtcblxuICAgIHRoaXMudXNpbmdCdW5kbGUgPSBjb25maWcuYnVuZGxlUG9saWN5ID09PSAnbWF4LWJ1bmRsZSc7XG4gICAgaWYgKGNvbmZpZy5ydGNwTXV4UG9saWN5ID09PSAnbmVnb3RpYXRlJykge1xuICAgICAgdGhyb3cobWFrZUVycm9yKCdOb3RTdXBwb3J0ZWRFcnJvcicsXG4gICAgICAgICAgJ3J0Y3BNdXhQb2xpY3kgXFwnbmVnb3RpYXRlXFwnIGlzIG5vdCBzdXBwb3J0ZWQnKSk7XG4gICAgfSBlbHNlIGlmICghY29uZmlnLnJ0Y3BNdXhQb2xpY3kpIHtcbiAgICAgIGNvbmZpZy5ydGNwTXV4UG9saWN5ID0gJ3JlcXVpcmUnO1xuICAgIH1cblxuICAgIHN3aXRjaCAoY29uZmlnLmljZVRyYW5zcG9ydFBvbGljeSkge1xuICAgICAgY2FzZSAnYWxsJzpcbiAgICAgIGNhc2UgJ3JlbGF5JzpcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBjb25maWcuaWNlVHJhbnNwb3J0UG9saWN5ID0gJ2FsbCc7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIHN3aXRjaCAoY29uZmlnLmJ1bmRsZVBvbGljeSkge1xuICAgICAgY2FzZSAnYmFsYW5jZWQnOlxuICAgICAgY2FzZSAnbWF4LWNvbXBhdCc6XG4gICAgICBjYXNlICdtYXgtYnVuZGxlJzpcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBjb25maWcuYnVuZGxlUG9saWN5ID0gJ2JhbGFuY2VkJztcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgY29uZmlnLmljZVNlcnZlcnMgPSBmaWx0ZXJJY2VTZXJ2ZXJzKGNvbmZpZy5pY2VTZXJ2ZXJzIHx8IFtdLCBlZGdlVmVyc2lvbik7XG5cbiAgICB0aGlzLl9pY2VHYXRoZXJlcnMgPSBbXTtcbiAgICBpZiAoY29uZmlnLmljZUNhbmRpZGF0ZVBvb2xTaXplKSB7XG4gICAgICBmb3IgKHZhciBpID0gY29uZmlnLmljZUNhbmRpZGF0ZVBvb2xTaXplOyBpID4gMDsgaS0tKSB7XG4gICAgICAgIHRoaXMuX2ljZUdhdGhlcmVycy5wdXNoKG5ldyB3aW5kb3cuUlRDSWNlR2F0aGVyZXIoe1xuICAgICAgICAgIGljZVNlcnZlcnM6IGNvbmZpZy5pY2VTZXJ2ZXJzLFxuICAgICAgICAgIGdhdGhlclBvbGljeTogY29uZmlnLmljZVRyYW5zcG9ydFBvbGljeVxuICAgICAgICB9KSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbmZpZy5pY2VDYW5kaWRhdGVQb29sU2l6ZSA9IDA7XG4gICAgfVxuXG4gICAgdGhpcy5fY29uZmlnID0gY29uZmlnO1xuXG4gICAgLy8gcGVyLXRyYWNrIGljZUdhdGhlcnMsIGljZVRyYW5zcG9ydHMsIGR0bHNUcmFuc3BvcnRzLCBydHBTZW5kZXJzLCAuLi5cbiAgICAvLyBldmVyeXRoaW5nIHRoYXQgaXMgbmVlZGVkIHRvIGRlc2NyaWJlIGEgU0RQIG0tbGluZS5cbiAgICB0aGlzLnRyYW5zY2VpdmVycyA9IFtdO1xuXG4gICAgdGhpcy5fc2RwU2Vzc2lvbklkID0gU0RQVXRpbHMuZ2VuZXJhdGVTZXNzaW9uSWQoKTtcbiAgICB0aGlzLl9zZHBTZXNzaW9uVmVyc2lvbiA9IDA7XG5cbiAgICB0aGlzLl9kdGxzUm9sZSA9IHVuZGVmaW5lZDsgLy8gcm9sZSBmb3IgYT1zZXR1cCB0byB1c2UgaW4gYW5zd2Vycy5cblxuICAgIHRoaXMuX2lzQ2xvc2VkID0gZmFsc2U7XG4gIH07XG5cbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZSwgJ2xvY2FsRGVzY3JpcHRpb24nLCB7XG4gICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5fbG9jYWxEZXNjcmlwdGlvbjtcbiAgICB9XG4gIH0pO1xuICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLCAncmVtb3RlRGVzY3JpcHRpb24nLCB7XG4gICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5fcmVtb3RlRGVzY3JpcHRpb247XG4gICAgfVxuICB9KTtcblxuICAvLyBzZXQgdXAgZXZlbnQgaGFuZGxlcnMgb24gcHJvdG90eXBlXG4gIFJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5vbmljZWNhbmRpZGF0ZSA9IG51bGw7XG4gIFJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5vbmFkZHN0cmVhbSA9IG51bGw7XG4gIFJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5vbnRyYWNrID0gbnVsbDtcbiAgUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLm9ucmVtb3Zlc3RyZWFtID0gbnVsbDtcbiAgUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLm9uc2lnbmFsaW5nc3RhdGVjaGFuZ2UgPSBudWxsO1xuICBSVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUub25pY2Vjb25uZWN0aW9uc3RhdGVjaGFuZ2UgPSBudWxsO1xuICBSVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUub25jb25uZWN0aW9uc3RhdGVjaGFuZ2UgPSBudWxsO1xuICBSVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUub25pY2VnYXRoZXJpbmdzdGF0ZWNoYW5nZSA9IG51bGw7XG4gIFJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5vbm5lZ290aWF0aW9ubmVlZGVkID0gbnVsbDtcbiAgUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLm9uZGF0YWNoYW5uZWwgPSBudWxsO1xuXG4gIFJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5fZGlzcGF0Y2hFdmVudCA9IGZ1bmN0aW9uKG5hbWUsIGV2ZW50KSB7XG4gICAgaWYgKHRoaXMuX2lzQ2xvc2VkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuZGlzcGF0Y2hFdmVudChldmVudCk7XG4gICAgaWYgKHR5cGVvZiB0aGlzWydvbicgKyBuYW1lXSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdGhpc1snb24nICsgbmFtZV0oZXZlbnQpO1xuICAgIH1cbiAgfTtcblxuICBSVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuX2VtaXRHYXRoZXJpbmdTdGF0ZUNoYW5nZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBldmVudCA9IG5ldyBFdmVudCgnaWNlZ2F0aGVyaW5nc3RhdGVjaGFuZ2UnKTtcbiAgICB0aGlzLl9kaXNwYXRjaEV2ZW50KCdpY2VnYXRoZXJpbmdzdGF0ZWNoYW5nZScsIGV2ZW50KTtcbiAgfTtcblxuICBSVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuZ2V0Q29uZmlndXJhdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLl9jb25maWc7XG4gIH07XG5cbiAgUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmdldExvY2FsU3RyZWFtcyA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmxvY2FsU3RyZWFtcztcbiAgfTtcblxuICBSVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuZ2V0UmVtb3RlU3RyZWFtcyA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLnJlbW90ZVN0cmVhbXM7XG4gIH07XG5cbiAgLy8gaW50ZXJuYWwgaGVscGVyIHRvIGNyZWF0ZSBhIHRyYW5zY2VpdmVyIG9iamVjdC5cbiAgLy8gKHdoaWNoIGlzIG5vdCB5ZXQgdGhlIHNhbWUgYXMgdGhlIFdlYlJUQyAxLjAgdHJhbnNjZWl2ZXIpXG4gIFJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5fY3JlYXRlVHJhbnNjZWl2ZXIgPSBmdW5jdGlvbihraW5kLCBkb05vdEFkZCkge1xuICAgIHZhciBoYXNCdW5kbGVUcmFuc3BvcnQgPSB0aGlzLnRyYW5zY2VpdmVycy5sZW5ndGggPiAwO1xuICAgIHZhciB0cmFuc2NlaXZlciA9IHtcbiAgICAgIHRyYWNrOiBudWxsLFxuICAgICAgaWNlR2F0aGVyZXI6IG51bGwsXG4gICAgICBpY2VUcmFuc3BvcnQ6IG51bGwsXG4gICAgICBkdGxzVHJhbnNwb3J0OiBudWxsLFxuICAgICAgbG9jYWxDYXBhYmlsaXRpZXM6IG51bGwsXG4gICAgICByZW1vdGVDYXBhYmlsaXRpZXM6IG51bGwsXG4gICAgICBydHBTZW5kZXI6IG51bGwsXG4gICAgICBydHBSZWNlaXZlcjogbnVsbCxcbiAgICAgIGtpbmQ6IGtpbmQsXG4gICAgICBtaWQ6IG51bGwsXG4gICAgICBzZW5kRW5jb2RpbmdQYXJhbWV0ZXJzOiBudWxsLFxuICAgICAgcmVjdkVuY29kaW5nUGFyYW1ldGVyczogbnVsbCxcbiAgICAgIHN0cmVhbTogbnVsbCxcbiAgICAgIGFzc29jaWF0ZWRSZW1vdGVNZWRpYVN0cmVhbXM6IFtdLFxuICAgICAgd2FudFJlY2VpdmU6IHRydWVcbiAgICB9O1xuICAgIGlmICh0aGlzLnVzaW5nQnVuZGxlICYmIGhhc0J1bmRsZVRyYW5zcG9ydCkge1xuICAgICAgdHJhbnNjZWl2ZXIuaWNlVHJhbnNwb3J0ID0gdGhpcy50cmFuc2NlaXZlcnNbMF0uaWNlVHJhbnNwb3J0O1xuICAgICAgdHJhbnNjZWl2ZXIuZHRsc1RyYW5zcG9ydCA9IHRoaXMudHJhbnNjZWl2ZXJzWzBdLmR0bHNUcmFuc3BvcnQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciB0cmFuc3BvcnRzID0gdGhpcy5fY3JlYXRlSWNlQW5kRHRsc1RyYW5zcG9ydHMoKTtcbiAgICAgIHRyYW5zY2VpdmVyLmljZVRyYW5zcG9ydCA9IHRyYW5zcG9ydHMuaWNlVHJhbnNwb3J0O1xuICAgICAgdHJhbnNjZWl2ZXIuZHRsc1RyYW5zcG9ydCA9IHRyYW5zcG9ydHMuZHRsc1RyYW5zcG9ydDtcbiAgICB9XG4gICAgaWYgKCFkb05vdEFkZCkge1xuICAgICAgdGhpcy50cmFuc2NlaXZlcnMucHVzaCh0cmFuc2NlaXZlcik7XG4gICAgfVxuICAgIHJldHVybiB0cmFuc2NlaXZlcjtcbiAgfTtcblxuICBSVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuYWRkVHJhY2sgPSBmdW5jdGlvbih0cmFjaywgc3RyZWFtKSB7XG4gICAgaWYgKHRoaXMuX2lzQ2xvc2VkKSB7XG4gICAgICB0aHJvdyBtYWtlRXJyb3IoJ0ludmFsaWRTdGF0ZUVycm9yJyxcbiAgICAgICAgICAnQXR0ZW1wdGVkIHRvIGNhbGwgYWRkVHJhY2sgb24gYSBjbG9zZWQgcGVlcmNvbm5lY3Rpb24uJyk7XG4gICAgfVxuXG4gICAgdmFyIGFscmVhZHlFeGlzdHMgPSB0aGlzLnRyYW5zY2VpdmVycy5maW5kKGZ1bmN0aW9uKHMpIHtcbiAgICAgIHJldHVybiBzLnRyYWNrID09PSB0cmFjaztcbiAgICB9KTtcblxuICAgIGlmIChhbHJlYWR5RXhpc3RzKSB7XG4gICAgICB0aHJvdyBtYWtlRXJyb3IoJ0ludmFsaWRBY2Nlc3NFcnJvcicsICdUcmFjayBhbHJlYWR5IGV4aXN0cy4nKTtcbiAgICB9XG5cbiAgICB2YXIgdHJhbnNjZWl2ZXI7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnRyYW5zY2VpdmVycy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKCF0aGlzLnRyYW5zY2VpdmVyc1tpXS50cmFjayAmJlxuICAgICAgICAgIHRoaXMudHJhbnNjZWl2ZXJzW2ldLmtpbmQgPT09IHRyYWNrLmtpbmQpIHtcbiAgICAgICAgdHJhbnNjZWl2ZXIgPSB0aGlzLnRyYW5zY2VpdmVyc1tpXTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKCF0cmFuc2NlaXZlcikge1xuICAgICAgdHJhbnNjZWl2ZXIgPSB0aGlzLl9jcmVhdGVUcmFuc2NlaXZlcih0cmFjay5raW5kKTtcbiAgICB9XG5cbiAgICB0aGlzLl9tYXliZUZpcmVOZWdvdGlhdGlvbk5lZWRlZCgpO1xuXG4gICAgaWYgKHRoaXMubG9jYWxTdHJlYW1zLmluZGV4T2Yoc3RyZWFtKSA9PT0gLTEpIHtcbiAgICAgIHRoaXMubG9jYWxTdHJlYW1zLnB1c2goc3RyZWFtKTtcbiAgICB9XG5cbiAgICB0cmFuc2NlaXZlci50cmFjayA9IHRyYWNrO1xuICAgIHRyYW5zY2VpdmVyLnN0cmVhbSA9IHN0cmVhbTtcbiAgICB0cmFuc2NlaXZlci5ydHBTZW5kZXIgPSBuZXcgd2luZG93LlJUQ1J0cFNlbmRlcih0cmFjayxcbiAgICAgICAgdHJhbnNjZWl2ZXIuZHRsc1RyYW5zcG9ydCk7XG4gICAgcmV0dXJuIHRyYW5zY2VpdmVyLnJ0cFNlbmRlcjtcbiAgfTtcblxuICBSVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuYWRkU3RyZWFtID0gZnVuY3Rpb24oc3RyZWFtKSB7XG4gICAgdmFyIHBjID0gdGhpcztcbiAgICBpZiAoZWRnZVZlcnNpb24gPj0gMTUwMjUpIHtcbiAgICAgIHN0cmVhbS5nZXRUcmFja3MoKS5mb3JFYWNoKGZ1bmN0aW9uKHRyYWNrKSB7XG4gICAgICAgIHBjLmFkZFRyYWNrKHRyYWNrLCBzdHJlYW0pO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIENsb25lIGlzIG5lY2Vzc2FyeSBmb3IgbG9jYWwgZGVtb3MgbW9zdGx5LCBhdHRhY2hpbmcgZGlyZWN0bHlcbiAgICAgIC8vIHRvIHR3byBkaWZmZXJlbnQgc2VuZGVycyBkb2VzIG5vdCB3b3JrIChidWlsZCAxMDU0NykuXG4gICAgICAvLyBGaXhlZCBpbiAxNTAyNSAob3IgZWFybGllcilcbiAgICAgIHZhciBjbG9uZWRTdHJlYW0gPSBzdHJlYW0uY2xvbmUoKTtcbiAgICAgIHN0cmVhbS5nZXRUcmFja3MoKS5mb3JFYWNoKGZ1bmN0aW9uKHRyYWNrLCBpZHgpIHtcbiAgICAgICAgdmFyIGNsb25lZFRyYWNrID0gY2xvbmVkU3RyZWFtLmdldFRyYWNrcygpW2lkeF07XG4gICAgICAgIHRyYWNrLmFkZEV2ZW50TGlzdGVuZXIoJ2VuYWJsZWQnLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgIGNsb25lZFRyYWNrLmVuYWJsZWQgPSBldmVudC5lbmFibGVkO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgY2xvbmVkU3RyZWFtLmdldFRyYWNrcygpLmZvckVhY2goZnVuY3Rpb24odHJhY2spIHtcbiAgICAgICAgcGMuYWRkVHJhY2sodHJhY2ssIGNsb25lZFN0cmVhbSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLnJlbW92ZVRyYWNrID0gZnVuY3Rpb24oc2VuZGVyKSB7XG4gICAgaWYgKHRoaXMuX2lzQ2xvc2VkKSB7XG4gICAgICB0aHJvdyBtYWtlRXJyb3IoJ0ludmFsaWRTdGF0ZUVycm9yJyxcbiAgICAgICAgICAnQXR0ZW1wdGVkIHRvIGNhbGwgcmVtb3ZlVHJhY2sgb24gYSBjbG9zZWQgcGVlcmNvbm5lY3Rpb24uJyk7XG4gICAgfVxuXG4gICAgaWYgKCEoc2VuZGVyIGluc3RhbmNlb2Ygd2luZG93LlJUQ1J0cFNlbmRlcikpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0FyZ3VtZW50IDEgb2YgUlRDUGVlckNvbm5lY3Rpb24ucmVtb3ZlVHJhY2sgJyArXG4gICAgICAgICAgJ2RvZXMgbm90IGltcGxlbWVudCBpbnRlcmZhY2UgUlRDUnRwU2VuZGVyLicpO1xuICAgIH1cblxuICAgIHZhciB0cmFuc2NlaXZlciA9IHRoaXMudHJhbnNjZWl2ZXJzLmZpbmQoZnVuY3Rpb24odCkge1xuICAgICAgcmV0dXJuIHQucnRwU2VuZGVyID09PSBzZW5kZXI7XG4gICAgfSk7XG5cbiAgICBpZiAoIXRyYW5zY2VpdmVyKSB7XG4gICAgICB0aHJvdyBtYWtlRXJyb3IoJ0ludmFsaWRBY2Nlc3NFcnJvcicsXG4gICAgICAgICAgJ1NlbmRlciB3YXMgbm90IGNyZWF0ZWQgYnkgdGhpcyBjb25uZWN0aW9uLicpO1xuICAgIH1cbiAgICB2YXIgc3RyZWFtID0gdHJhbnNjZWl2ZXIuc3RyZWFtO1xuXG4gICAgdHJhbnNjZWl2ZXIucnRwU2VuZGVyLnN0b3AoKTtcbiAgICB0cmFuc2NlaXZlci5ydHBTZW5kZXIgPSBudWxsO1xuICAgIHRyYW5zY2VpdmVyLnRyYWNrID0gbnVsbDtcbiAgICB0cmFuc2NlaXZlci5zdHJlYW0gPSBudWxsO1xuXG4gICAgLy8gcmVtb3ZlIHRoZSBzdHJlYW0gZnJvbSB0aGUgc2V0IG9mIGxvY2FsIHN0cmVhbXNcbiAgICB2YXIgbG9jYWxTdHJlYW1zID0gdGhpcy50cmFuc2NlaXZlcnMubWFwKGZ1bmN0aW9uKHQpIHtcbiAgICAgIHJldHVybiB0LnN0cmVhbTtcbiAgICB9KTtcbiAgICBpZiAobG9jYWxTdHJlYW1zLmluZGV4T2Yoc3RyZWFtKSA9PT0gLTEgJiZcbiAgICAgICAgdGhpcy5sb2NhbFN0cmVhbXMuaW5kZXhPZihzdHJlYW0pID4gLTEpIHtcbiAgICAgIHRoaXMubG9jYWxTdHJlYW1zLnNwbGljZSh0aGlzLmxvY2FsU3RyZWFtcy5pbmRleE9mKHN0cmVhbSksIDEpO1xuICAgIH1cblxuICAgIHRoaXMuX21heWJlRmlyZU5lZ290aWF0aW9uTmVlZGVkKCk7XG4gIH07XG5cbiAgUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLnJlbW92ZVN0cmVhbSA9IGZ1bmN0aW9uKHN0cmVhbSkge1xuICAgIHZhciBwYyA9IHRoaXM7XG4gICAgc3RyZWFtLmdldFRyYWNrcygpLmZvckVhY2goZnVuY3Rpb24odHJhY2spIHtcbiAgICAgIHZhciBzZW5kZXIgPSBwYy5nZXRTZW5kZXJzKCkuZmluZChmdW5jdGlvbihzKSB7XG4gICAgICAgIHJldHVybiBzLnRyYWNrID09PSB0cmFjaztcbiAgICAgIH0pO1xuICAgICAgaWYgKHNlbmRlcikge1xuICAgICAgICBwYy5yZW1vdmVUcmFjayhzZW5kZXIpO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIFJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5nZXRTZW5kZXJzID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMudHJhbnNjZWl2ZXJzLmZpbHRlcihmdW5jdGlvbih0cmFuc2NlaXZlcikge1xuICAgICAgcmV0dXJuICEhdHJhbnNjZWl2ZXIucnRwU2VuZGVyO1xuICAgIH0pXG4gICAgLm1hcChmdW5jdGlvbih0cmFuc2NlaXZlcikge1xuICAgICAgcmV0dXJuIHRyYW5zY2VpdmVyLnJ0cFNlbmRlcjtcbiAgICB9KTtcbiAgfTtcblxuICBSVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuZ2V0UmVjZWl2ZXJzID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMudHJhbnNjZWl2ZXJzLmZpbHRlcihmdW5jdGlvbih0cmFuc2NlaXZlcikge1xuICAgICAgcmV0dXJuICEhdHJhbnNjZWl2ZXIucnRwUmVjZWl2ZXI7XG4gICAgfSlcbiAgICAubWFwKGZ1bmN0aW9uKHRyYW5zY2VpdmVyKSB7XG4gICAgICByZXR1cm4gdHJhbnNjZWl2ZXIucnRwUmVjZWl2ZXI7XG4gICAgfSk7XG4gIH07XG5cblxuICBSVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuX2NyZWF0ZUljZUdhdGhlcmVyID0gZnVuY3Rpb24oc2RwTUxpbmVJbmRleCxcbiAgICAgIHVzaW5nQnVuZGxlKSB7XG4gICAgdmFyIHBjID0gdGhpcztcbiAgICBpZiAodXNpbmdCdW5kbGUgJiYgc2RwTUxpbmVJbmRleCA+IDApIHtcbiAgICAgIHJldHVybiB0aGlzLnRyYW5zY2VpdmVyc1swXS5pY2VHYXRoZXJlcjtcbiAgICB9IGVsc2UgaWYgKHRoaXMuX2ljZUdhdGhlcmVycy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9pY2VHYXRoZXJlcnMuc2hpZnQoKTtcbiAgICB9XG4gICAgdmFyIGljZUdhdGhlcmVyID0gbmV3IHdpbmRvdy5SVENJY2VHYXRoZXJlcih7XG4gICAgICBpY2VTZXJ2ZXJzOiB0aGlzLl9jb25maWcuaWNlU2VydmVycyxcbiAgICAgIGdhdGhlclBvbGljeTogdGhpcy5fY29uZmlnLmljZVRyYW5zcG9ydFBvbGljeVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpY2VHYXRoZXJlciwgJ3N0YXRlJyxcbiAgICAgICAge3ZhbHVlOiAnbmV3Jywgd3JpdGFibGU6IHRydWV9XG4gICAgKTtcblxuICAgIHRoaXMudHJhbnNjZWl2ZXJzW3NkcE1MaW5lSW5kZXhdLmJ1ZmZlcmVkQ2FuZGlkYXRlRXZlbnRzID0gW107XG4gICAgdGhpcy50cmFuc2NlaXZlcnNbc2RwTUxpbmVJbmRleF0uYnVmZmVyQ2FuZGlkYXRlcyA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICB2YXIgZW5kID0gIWV2ZW50LmNhbmRpZGF0ZSB8fCBPYmplY3Qua2V5cyhldmVudC5jYW5kaWRhdGUpLmxlbmd0aCA9PT0gMDtcbiAgICAgIC8vIHBvbHlmaWxsIHNpbmNlIFJUQ0ljZUdhdGhlcmVyLnN0YXRlIGlzIG5vdCBpbXBsZW1lbnRlZCBpblxuICAgICAgLy8gRWRnZSAxMDU0NyB5ZXQuXG4gICAgICBpY2VHYXRoZXJlci5zdGF0ZSA9IGVuZCA/ICdjb21wbGV0ZWQnIDogJ2dhdGhlcmluZyc7XG4gICAgICBpZiAocGMudHJhbnNjZWl2ZXJzW3NkcE1MaW5lSW5kZXhdLmJ1ZmZlcmVkQ2FuZGlkYXRlRXZlbnRzICE9PSBudWxsKSB7XG4gICAgICAgIHBjLnRyYW5zY2VpdmVyc1tzZHBNTGluZUluZGV4XS5idWZmZXJlZENhbmRpZGF0ZUV2ZW50cy5wdXNoKGV2ZW50KTtcbiAgICAgIH1cbiAgICB9O1xuICAgIGljZUdhdGhlcmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2xvY2FsY2FuZGlkYXRlJyxcbiAgICAgIHRoaXMudHJhbnNjZWl2ZXJzW3NkcE1MaW5lSW5kZXhdLmJ1ZmZlckNhbmRpZGF0ZXMpO1xuICAgIHJldHVybiBpY2VHYXRoZXJlcjtcbiAgfTtcblxuICAvLyBzdGFydCBnYXRoZXJpbmcgZnJvbSBhbiBSVENJY2VHYXRoZXJlci5cbiAgUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLl9nYXRoZXIgPSBmdW5jdGlvbihtaWQsIHNkcE1MaW5lSW5kZXgpIHtcbiAgICB2YXIgcGMgPSB0aGlzO1xuICAgIHZhciBpY2VHYXRoZXJlciA9IHRoaXMudHJhbnNjZWl2ZXJzW3NkcE1MaW5lSW5kZXhdLmljZUdhdGhlcmVyO1xuICAgIGlmIChpY2VHYXRoZXJlci5vbmxvY2FsY2FuZGlkYXRlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBidWZmZXJlZENhbmRpZGF0ZUV2ZW50cyA9XG4gICAgICB0aGlzLnRyYW5zY2VpdmVyc1tzZHBNTGluZUluZGV4XS5idWZmZXJlZENhbmRpZGF0ZUV2ZW50cztcbiAgICB0aGlzLnRyYW5zY2VpdmVyc1tzZHBNTGluZUluZGV4XS5idWZmZXJlZENhbmRpZGF0ZUV2ZW50cyA9IG51bGw7XG4gICAgaWNlR2F0aGVyZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcignbG9jYWxjYW5kaWRhdGUnLFxuICAgICAgdGhpcy50cmFuc2NlaXZlcnNbc2RwTUxpbmVJbmRleF0uYnVmZmVyQ2FuZGlkYXRlcyk7XG4gICAgaWNlR2F0aGVyZXIub25sb2NhbGNhbmRpZGF0ZSA9IGZ1bmN0aW9uKGV2dCkge1xuICAgICAgaWYgKHBjLnVzaW5nQnVuZGxlICYmIHNkcE1MaW5lSW5kZXggPiAwKSB7XG4gICAgICAgIC8vIGlmIHdlIGtub3cgdGhhdCB3ZSB1c2UgYnVuZGxlIHdlIGNhbiBkcm9wIGNhbmRpZGF0ZXMgd2l0aFxuICAgICAgICAvLyDRlWRwTUxpbmVJbmRleCA+IDAuIElmIHdlIGRvbid0IGRvIHRoaXMgdGhlbiBvdXIgc3RhdGUgZ2V0c1xuICAgICAgICAvLyBjb25mdXNlZCBzaW5jZSB3ZSBkaXNwb3NlIHRoZSBleHRyYSBpY2UgZ2F0aGVyZXIuXG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHZhciBldmVudCA9IG5ldyBFdmVudCgnaWNlY2FuZGlkYXRlJyk7XG4gICAgICBldmVudC5jYW5kaWRhdGUgPSB7c2RwTWlkOiBtaWQsIHNkcE1MaW5lSW5kZXg6IHNkcE1MaW5lSW5kZXh9O1xuXG4gICAgICB2YXIgY2FuZCA9IGV2dC5jYW5kaWRhdGU7XG4gICAgICAvLyBFZGdlIGVtaXRzIGFuIGVtcHR5IG9iamVjdCBmb3IgUlRDSWNlQ2FuZGlkYXRlQ29tcGxldGXigKVcbiAgICAgIHZhciBlbmQgPSAhY2FuZCB8fCBPYmplY3Qua2V5cyhjYW5kKS5sZW5ndGggPT09IDA7XG4gICAgICBpZiAoZW5kKSB7XG4gICAgICAgIC8vIHBvbHlmaWxsIHNpbmNlIFJUQ0ljZUdhdGhlcmVyLnN0YXRlIGlzIG5vdCBpbXBsZW1lbnRlZCBpblxuICAgICAgICAvLyBFZGdlIDEwNTQ3IHlldC5cbiAgICAgICAgaWYgKGljZUdhdGhlcmVyLnN0YXRlID09PSAnbmV3JyB8fCBpY2VHYXRoZXJlci5zdGF0ZSA9PT0gJ2dhdGhlcmluZycpIHtcbiAgICAgICAgICBpY2VHYXRoZXJlci5zdGF0ZSA9ICdjb21wbGV0ZWQnO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoaWNlR2F0aGVyZXIuc3RhdGUgPT09ICduZXcnKSB7XG4gICAgICAgICAgaWNlR2F0aGVyZXIuc3RhdGUgPSAnZ2F0aGVyaW5nJztcbiAgICAgICAgfVxuICAgICAgICAvLyBSVENJY2VDYW5kaWRhdGUgZG9lc24ndCBoYXZlIGEgY29tcG9uZW50LCBuZWVkcyB0byBiZSBhZGRlZFxuICAgICAgICBjYW5kLmNvbXBvbmVudCA9IDE7XG4gICAgICAgIC8vIGFsc28gdGhlIHVzZXJuYW1lRnJhZ21lbnQuIFRPRE86IHVwZGF0ZSBTRFAgdG8gdGFrZSBib3RoIHZhcmlhbnRzLlxuICAgICAgICBjYW5kLnVmcmFnID0gaWNlR2F0aGVyZXIuZ2V0TG9jYWxQYXJhbWV0ZXJzKCkudXNlcm5hbWVGcmFnbWVudDtcblxuICAgICAgICB2YXIgc2VyaWFsaXplZENhbmRpZGF0ZSA9IFNEUFV0aWxzLndyaXRlQ2FuZGlkYXRlKGNhbmQpO1xuICAgICAgICBldmVudC5jYW5kaWRhdGUgPSBPYmplY3QuYXNzaWduKGV2ZW50LmNhbmRpZGF0ZSxcbiAgICAgICAgICAgIFNEUFV0aWxzLnBhcnNlQ2FuZGlkYXRlKHNlcmlhbGl6ZWRDYW5kaWRhdGUpKTtcblxuICAgICAgICBldmVudC5jYW5kaWRhdGUuY2FuZGlkYXRlID0gc2VyaWFsaXplZENhbmRpZGF0ZTtcbiAgICAgICAgZXZlbnQuY2FuZGlkYXRlLnRvSlNPTiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBjYW5kaWRhdGU6IGV2ZW50LmNhbmRpZGF0ZS5jYW5kaWRhdGUsXG4gICAgICAgICAgICBzZHBNaWQ6IGV2ZW50LmNhbmRpZGF0ZS5zZHBNaWQsXG4gICAgICAgICAgICBzZHBNTGluZUluZGV4OiBldmVudC5jYW5kaWRhdGUuc2RwTUxpbmVJbmRleCxcbiAgICAgICAgICAgIHVzZXJuYW1lRnJhZ21lbnQ6IGV2ZW50LmNhbmRpZGF0ZS51c2VybmFtZUZyYWdtZW50XG4gICAgICAgICAgfTtcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gdXBkYXRlIGxvY2FsIGRlc2NyaXB0aW9uLlxuICAgICAgdmFyIHNlY3Rpb25zID0gU0RQVXRpbHMuZ2V0TWVkaWFTZWN0aW9ucyhwYy5fbG9jYWxEZXNjcmlwdGlvbi5zZHApO1xuICAgICAgaWYgKCFlbmQpIHtcbiAgICAgICAgc2VjdGlvbnNbZXZlbnQuY2FuZGlkYXRlLnNkcE1MaW5lSW5kZXhdICs9XG4gICAgICAgICAgICAnYT0nICsgZXZlbnQuY2FuZGlkYXRlLmNhbmRpZGF0ZSArICdcXHJcXG4nO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2VjdGlvbnNbZXZlbnQuY2FuZGlkYXRlLnNkcE1MaW5lSW5kZXhdICs9XG4gICAgICAgICAgICAnYT1lbmQtb2YtY2FuZGlkYXRlc1xcclxcbic7XG4gICAgICB9XG4gICAgICBwYy5fbG9jYWxEZXNjcmlwdGlvbi5zZHAgPVxuICAgICAgICAgIFNEUFV0aWxzLmdldERlc2NyaXB0aW9uKHBjLl9sb2NhbERlc2NyaXB0aW9uLnNkcCkgK1xuICAgICAgICAgIHNlY3Rpb25zLmpvaW4oJycpO1xuICAgICAgdmFyIGNvbXBsZXRlID0gcGMudHJhbnNjZWl2ZXJzLmV2ZXJ5KGZ1bmN0aW9uKHRyYW5zY2VpdmVyKSB7XG4gICAgICAgIHJldHVybiB0cmFuc2NlaXZlci5pY2VHYXRoZXJlciAmJlxuICAgICAgICAgICAgdHJhbnNjZWl2ZXIuaWNlR2F0aGVyZXIuc3RhdGUgPT09ICdjb21wbGV0ZWQnO1xuICAgICAgfSk7XG5cbiAgICAgIGlmIChwYy5pY2VHYXRoZXJpbmdTdGF0ZSAhPT0gJ2dhdGhlcmluZycpIHtcbiAgICAgICAgcGMuaWNlR2F0aGVyaW5nU3RhdGUgPSAnZ2F0aGVyaW5nJztcbiAgICAgICAgcGMuX2VtaXRHYXRoZXJpbmdTdGF0ZUNoYW5nZSgpO1xuICAgICAgfVxuXG4gICAgICAvLyBFbWl0IGNhbmRpZGF0ZS4gQWxzbyBlbWl0IG51bGwgY2FuZGlkYXRlIHdoZW4gYWxsIGdhdGhlcmVycyBhcmVcbiAgICAgIC8vIGNvbXBsZXRlLlxuICAgICAgaWYgKCFlbmQpIHtcbiAgICAgICAgcGMuX2Rpc3BhdGNoRXZlbnQoJ2ljZWNhbmRpZGF0ZScsIGV2ZW50KTtcbiAgICAgIH1cbiAgICAgIGlmIChjb21wbGV0ZSkge1xuICAgICAgICBwYy5fZGlzcGF0Y2hFdmVudCgnaWNlY2FuZGlkYXRlJywgbmV3IEV2ZW50KCdpY2VjYW5kaWRhdGUnKSk7XG4gICAgICAgIHBjLmljZUdhdGhlcmluZ1N0YXRlID0gJ2NvbXBsZXRlJztcbiAgICAgICAgcGMuX2VtaXRHYXRoZXJpbmdTdGF0ZUNoYW5nZSgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBlbWl0IGFscmVhZHkgZ2F0aGVyZWQgY2FuZGlkYXRlcy5cbiAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgIGJ1ZmZlcmVkQ2FuZGlkYXRlRXZlbnRzLmZvckVhY2goZnVuY3Rpb24oZSkge1xuICAgICAgICBpY2VHYXRoZXJlci5vbmxvY2FsY2FuZGlkYXRlKGUpO1xuICAgICAgfSk7XG4gICAgfSwgMCk7XG4gIH07XG5cbiAgLy8gQ3JlYXRlIElDRSB0cmFuc3BvcnQgYW5kIERUTFMgdHJhbnNwb3J0LlxuICBSVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuX2NyZWF0ZUljZUFuZER0bHNUcmFuc3BvcnRzID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHBjID0gdGhpcztcbiAgICB2YXIgaWNlVHJhbnNwb3J0ID0gbmV3IHdpbmRvdy5SVENJY2VUcmFuc3BvcnQobnVsbCk7XG4gICAgaWNlVHJhbnNwb3J0Lm9uaWNlc3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgIHBjLl91cGRhdGVJY2VDb25uZWN0aW9uU3RhdGUoKTtcbiAgICAgIHBjLl91cGRhdGVDb25uZWN0aW9uU3RhdGUoKTtcbiAgICB9O1xuXG4gICAgdmFyIGR0bHNUcmFuc3BvcnQgPSBuZXcgd2luZG93LlJUQ0R0bHNUcmFuc3BvcnQoaWNlVHJhbnNwb3J0KTtcbiAgICBkdGxzVHJhbnNwb3J0Lm9uZHRsc3N0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7XG4gICAgICBwYy5fdXBkYXRlQ29ubmVjdGlvblN0YXRlKCk7XG4gICAgfTtcbiAgICBkdGxzVHJhbnNwb3J0Lm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgIC8vIG9uZXJyb3IgZG9lcyBub3Qgc2V0IHN0YXRlIHRvIGZhaWxlZCBieSBpdHNlbGYuXG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZHRsc1RyYW5zcG9ydCwgJ3N0YXRlJyxcbiAgICAgICAgICB7dmFsdWU6ICdmYWlsZWQnLCB3cml0YWJsZTogdHJ1ZX0pO1xuICAgICAgcGMuX3VwZGF0ZUNvbm5lY3Rpb25TdGF0ZSgpO1xuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgaWNlVHJhbnNwb3J0OiBpY2VUcmFuc3BvcnQsXG4gICAgICBkdGxzVHJhbnNwb3J0OiBkdGxzVHJhbnNwb3J0XG4gICAgfTtcbiAgfTtcblxuICAvLyBEZXN0cm95IElDRSBnYXRoZXJlciwgSUNFIHRyYW5zcG9ydCBhbmQgRFRMUyB0cmFuc3BvcnQuXG4gIC8vIFdpdGhvdXQgdHJpZ2dlcmluZyB0aGUgY2FsbGJhY2tzLlxuICBSVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuX2Rpc3Bvc2VJY2VBbmREdGxzVHJhbnNwb3J0cyA9IGZ1bmN0aW9uKFxuICAgICAgc2RwTUxpbmVJbmRleCkge1xuICAgIHZhciBpY2VHYXRoZXJlciA9IHRoaXMudHJhbnNjZWl2ZXJzW3NkcE1MaW5lSW5kZXhdLmljZUdhdGhlcmVyO1xuICAgIGlmIChpY2VHYXRoZXJlcikge1xuICAgICAgZGVsZXRlIGljZUdhdGhlcmVyLm9ubG9jYWxjYW5kaWRhdGU7XG4gICAgICBkZWxldGUgdGhpcy50cmFuc2NlaXZlcnNbc2RwTUxpbmVJbmRleF0uaWNlR2F0aGVyZXI7XG4gICAgfVxuICAgIHZhciBpY2VUcmFuc3BvcnQgPSB0aGlzLnRyYW5zY2VpdmVyc1tzZHBNTGluZUluZGV4XS5pY2VUcmFuc3BvcnQ7XG4gICAgaWYgKGljZVRyYW5zcG9ydCkge1xuICAgICAgZGVsZXRlIGljZVRyYW5zcG9ydC5vbmljZXN0YXRlY2hhbmdlO1xuICAgICAgZGVsZXRlIHRoaXMudHJhbnNjZWl2ZXJzW3NkcE1MaW5lSW5kZXhdLmljZVRyYW5zcG9ydDtcbiAgICB9XG4gICAgdmFyIGR0bHNUcmFuc3BvcnQgPSB0aGlzLnRyYW5zY2VpdmVyc1tzZHBNTGluZUluZGV4XS5kdGxzVHJhbnNwb3J0O1xuICAgIGlmIChkdGxzVHJhbnNwb3J0KSB7XG4gICAgICBkZWxldGUgZHRsc1RyYW5zcG9ydC5vbmR0bHNzdGF0ZWNoYW5nZTtcbiAgICAgIGRlbGV0ZSBkdGxzVHJhbnNwb3J0Lm9uZXJyb3I7XG4gICAgICBkZWxldGUgdGhpcy50cmFuc2NlaXZlcnNbc2RwTUxpbmVJbmRleF0uZHRsc1RyYW5zcG9ydDtcbiAgICB9XG4gIH07XG5cbiAgLy8gU3RhcnQgdGhlIFJUUCBTZW5kZXIgYW5kIFJlY2VpdmVyIGZvciBhIHRyYW5zY2VpdmVyLlxuICBSVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuX3RyYW5zY2VpdmUgPSBmdW5jdGlvbih0cmFuc2NlaXZlcixcbiAgICAgIHNlbmQsIHJlY3YpIHtcbiAgICB2YXIgcGFyYW1zID0gZ2V0Q29tbW9uQ2FwYWJpbGl0aWVzKHRyYW5zY2VpdmVyLmxvY2FsQ2FwYWJpbGl0aWVzLFxuICAgICAgICB0cmFuc2NlaXZlci5yZW1vdGVDYXBhYmlsaXRpZXMpO1xuICAgIGlmIChzZW5kICYmIHRyYW5zY2VpdmVyLnJ0cFNlbmRlcikge1xuICAgICAgcGFyYW1zLmVuY29kaW5ncyA9IHRyYW5zY2VpdmVyLnNlbmRFbmNvZGluZ1BhcmFtZXRlcnM7XG4gICAgICBwYXJhbXMucnRjcCA9IHtcbiAgICAgICAgY25hbWU6IFNEUFV0aWxzLmxvY2FsQ05hbWUsXG4gICAgICAgIGNvbXBvdW5kOiB0cmFuc2NlaXZlci5ydGNwUGFyYW1ldGVycy5jb21wb3VuZFxuICAgICAgfTtcbiAgICAgIGlmICh0cmFuc2NlaXZlci5yZWN2RW5jb2RpbmdQYXJhbWV0ZXJzLmxlbmd0aCkge1xuICAgICAgICBwYXJhbXMucnRjcC5zc3JjID0gdHJhbnNjZWl2ZXIucmVjdkVuY29kaW5nUGFyYW1ldGVyc1swXS5zc3JjO1xuICAgICAgfVxuICAgICAgdHJhbnNjZWl2ZXIucnRwU2VuZGVyLnNlbmQocGFyYW1zKTtcbiAgICB9XG4gICAgaWYgKHJlY3YgJiYgdHJhbnNjZWl2ZXIucnRwUmVjZWl2ZXIgJiYgcGFyYW1zLmNvZGVjcy5sZW5ndGggPiAwKSB7XG4gICAgICAvLyByZW1vdmUgUlRYIGZpZWxkIGluIEVkZ2UgMTQ5NDJcbiAgICAgIGlmICh0cmFuc2NlaXZlci5raW5kID09PSAndmlkZW8nXG4gICAgICAgICAgJiYgdHJhbnNjZWl2ZXIucmVjdkVuY29kaW5nUGFyYW1ldGVyc1xuICAgICAgICAgICYmIGVkZ2VWZXJzaW9uIDwgMTUwMTkpIHtcbiAgICAgICAgdHJhbnNjZWl2ZXIucmVjdkVuY29kaW5nUGFyYW1ldGVycy5mb3JFYWNoKGZ1bmN0aW9uKHApIHtcbiAgICAgICAgICBkZWxldGUgcC5ydHg7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaWYgKHRyYW5zY2VpdmVyLnJlY3ZFbmNvZGluZ1BhcmFtZXRlcnMubGVuZ3RoKSB7XG4gICAgICAgIHBhcmFtcy5lbmNvZGluZ3MgPSB0cmFuc2NlaXZlci5yZWN2RW5jb2RpbmdQYXJhbWV0ZXJzO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcGFyYW1zLmVuY29kaW5ncyA9IFt7fV07XG4gICAgICB9XG4gICAgICBwYXJhbXMucnRjcCA9IHtcbiAgICAgICAgY29tcG91bmQ6IHRyYW5zY2VpdmVyLnJ0Y3BQYXJhbWV0ZXJzLmNvbXBvdW5kXG4gICAgICB9O1xuICAgICAgaWYgKHRyYW5zY2VpdmVyLnJ0Y3BQYXJhbWV0ZXJzLmNuYW1lKSB7XG4gICAgICAgIHBhcmFtcy5ydGNwLmNuYW1lID0gdHJhbnNjZWl2ZXIucnRjcFBhcmFtZXRlcnMuY25hbWU7XG4gICAgICB9XG4gICAgICBpZiAodHJhbnNjZWl2ZXIuc2VuZEVuY29kaW5nUGFyYW1ldGVycy5sZW5ndGgpIHtcbiAgICAgICAgcGFyYW1zLnJ0Y3Auc3NyYyA9IHRyYW5zY2VpdmVyLnNlbmRFbmNvZGluZ1BhcmFtZXRlcnNbMF0uc3NyYztcbiAgICAgIH1cbiAgICAgIHRyYW5zY2VpdmVyLnJ0cFJlY2VpdmVyLnJlY2VpdmUocGFyYW1zKTtcbiAgICB9XG4gIH07XG5cbiAgUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLnNldExvY2FsRGVzY3JpcHRpb24gPSBmdW5jdGlvbihkZXNjcmlwdGlvbikge1xuICAgIHZhciBwYyA9IHRoaXM7XG5cbiAgICAvLyBOb3RlOiBwcmFuc3dlciBpcyBub3Qgc3VwcG9ydGVkLlxuICAgIGlmIChbJ29mZmVyJywgJ2Fuc3dlciddLmluZGV4T2YoZGVzY3JpcHRpb24udHlwZSkgPT09IC0xKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobWFrZUVycm9yKCdUeXBlRXJyb3InLFxuICAgICAgICAgICdVbnN1cHBvcnRlZCB0eXBlIFwiJyArIGRlc2NyaXB0aW9uLnR5cGUgKyAnXCInKSk7XG4gICAgfVxuXG4gICAgaWYgKCFpc0FjdGlvbkFsbG93ZWRJblNpZ25hbGluZ1N0YXRlKCdzZXRMb2NhbERlc2NyaXB0aW9uJyxcbiAgICAgICAgZGVzY3JpcHRpb24udHlwZSwgcGMuc2lnbmFsaW5nU3RhdGUpIHx8IHBjLl9pc0Nsb3NlZCkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG1ha2VFcnJvcignSW52YWxpZFN0YXRlRXJyb3InLFxuICAgICAgICAgICdDYW4gbm90IHNldCBsb2NhbCAnICsgZGVzY3JpcHRpb24udHlwZSArXG4gICAgICAgICAgJyBpbiBzdGF0ZSAnICsgcGMuc2lnbmFsaW5nU3RhdGUpKTtcbiAgICB9XG5cbiAgICB2YXIgc2VjdGlvbnM7XG4gICAgdmFyIHNlc3Npb25wYXJ0O1xuICAgIGlmIChkZXNjcmlwdGlvbi50eXBlID09PSAnb2ZmZXInKSB7XG4gICAgICAvLyBWRVJZIGxpbWl0ZWQgc3VwcG9ydCBmb3IgU0RQIG11bmdpbmcuIExpbWl0ZWQgdG86XG4gICAgICAvLyAqIGNoYW5naW5nIHRoZSBvcmRlciBvZiBjb2RlY3NcbiAgICAgIHNlY3Rpb25zID0gU0RQVXRpbHMuc3BsaXRTZWN0aW9ucyhkZXNjcmlwdGlvbi5zZHApO1xuICAgICAgc2Vzc2lvbnBhcnQgPSBzZWN0aW9ucy5zaGlmdCgpO1xuICAgICAgc2VjdGlvbnMuZm9yRWFjaChmdW5jdGlvbihtZWRpYVNlY3Rpb24sIHNkcE1MaW5lSW5kZXgpIHtcbiAgICAgICAgdmFyIGNhcHMgPSBTRFBVdGlscy5wYXJzZVJ0cFBhcmFtZXRlcnMobWVkaWFTZWN0aW9uKTtcbiAgICAgICAgcGMudHJhbnNjZWl2ZXJzW3NkcE1MaW5lSW5kZXhdLmxvY2FsQ2FwYWJpbGl0aWVzID0gY2FwcztcbiAgICAgIH0pO1xuXG4gICAgICBwYy50cmFuc2NlaXZlcnMuZm9yRWFjaChmdW5jdGlvbih0cmFuc2NlaXZlciwgc2RwTUxpbmVJbmRleCkge1xuICAgICAgICBwYy5fZ2F0aGVyKHRyYW5zY2VpdmVyLm1pZCwgc2RwTUxpbmVJbmRleCk7XG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGRlc2NyaXB0aW9uLnR5cGUgPT09ICdhbnN3ZXInKSB7XG4gICAgICBzZWN0aW9ucyA9IFNEUFV0aWxzLnNwbGl0U2VjdGlvbnMocGMuX3JlbW90ZURlc2NyaXB0aW9uLnNkcCk7XG4gICAgICBzZXNzaW9ucGFydCA9IHNlY3Rpb25zLnNoaWZ0KCk7XG4gICAgICB2YXIgaXNJY2VMaXRlID0gU0RQVXRpbHMubWF0Y2hQcmVmaXgoc2Vzc2lvbnBhcnQsXG4gICAgICAgICAgJ2E9aWNlLWxpdGUnKS5sZW5ndGggPiAwO1xuICAgICAgc2VjdGlvbnMuZm9yRWFjaChmdW5jdGlvbihtZWRpYVNlY3Rpb24sIHNkcE1MaW5lSW5kZXgpIHtcbiAgICAgICAgdmFyIHRyYW5zY2VpdmVyID0gcGMudHJhbnNjZWl2ZXJzW3NkcE1MaW5lSW5kZXhdO1xuICAgICAgICB2YXIgaWNlR2F0aGVyZXIgPSB0cmFuc2NlaXZlci5pY2VHYXRoZXJlcjtcbiAgICAgICAgdmFyIGljZVRyYW5zcG9ydCA9IHRyYW5zY2VpdmVyLmljZVRyYW5zcG9ydDtcbiAgICAgICAgdmFyIGR0bHNUcmFuc3BvcnQgPSB0cmFuc2NlaXZlci5kdGxzVHJhbnNwb3J0O1xuICAgICAgICB2YXIgbG9jYWxDYXBhYmlsaXRpZXMgPSB0cmFuc2NlaXZlci5sb2NhbENhcGFiaWxpdGllcztcbiAgICAgICAgdmFyIHJlbW90ZUNhcGFiaWxpdGllcyA9IHRyYW5zY2VpdmVyLnJlbW90ZUNhcGFiaWxpdGllcztcblxuICAgICAgICAvLyB0cmVhdCBidW5kbGUtb25seSBhcyBub3QtcmVqZWN0ZWQuXG4gICAgICAgIHZhciByZWplY3RlZCA9IFNEUFV0aWxzLmlzUmVqZWN0ZWQobWVkaWFTZWN0aW9uKSAmJlxuICAgICAgICAgICAgU0RQVXRpbHMubWF0Y2hQcmVmaXgobWVkaWFTZWN0aW9uLCAnYT1idW5kbGUtb25seScpLmxlbmd0aCA9PT0gMDtcblxuICAgICAgICBpZiAoIXJlamVjdGVkICYmICF0cmFuc2NlaXZlci5yZWplY3RlZCkge1xuICAgICAgICAgIHZhciByZW1vdGVJY2VQYXJhbWV0ZXJzID0gU0RQVXRpbHMuZ2V0SWNlUGFyYW1ldGVycyhcbiAgICAgICAgICAgICAgbWVkaWFTZWN0aW9uLCBzZXNzaW9ucGFydCk7XG4gICAgICAgICAgdmFyIHJlbW90ZUR0bHNQYXJhbWV0ZXJzID0gU0RQVXRpbHMuZ2V0RHRsc1BhcmFtZXRlcnMoXG4gICAgICAgICAgICAgIG1lZGlhU2VjdGlvbiwgc2Vzc2lvbnBhcnQpO1xuICAgICAgICAgIGlmIChpc0ljZUxpdGUpIHtcbiAgICAgICAgICAgIHJlbW90ZUR0bHNQYXJhbWV0ZXJzLnJvbGUgPSAnc2VydmVyJztcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoIXBjLnVzaW5nQnVuZGxlIHx8IHNkcE1MaW5lSW5kZXggPT09IDApIHtcbiAgICAgICAgICAgIHBjLl9nYXRoZXIodHJhbnNjZWl2ZXIubWlkLCBzZHBNTGluZUluZGV4KTtcbiAgICAgICAgICAgIGlmIChpY2VUcmFuc3BvcnQuc3RhdGUgPT09ICduZXcnKSB7XG4gICAgICAgICAgICAgIGljZVRyYW5zcG9ydC5zdGFydChpY2VHYXRoZXJlciwgcmVtb3RlSWNlUGFyYW1ldGVycyxcbiAgICAgICAgICAgICAgICAgIGlzSWNlTGl0ZSA/ICdjb250cm9sbGluZycgOiAnY29udHJvbGxlZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGR0bHNUcmFuc3BvcnQuc3RhdGUgPT09ICduZXcnKSB7XG4gICAgICAgICAgICAgIGR0bHNUcmFuc3BvcnQuc3RhcnQocmVtb3RlRHRsc1BhcmFtZXRlcnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIENhbGN1bGF0ZSBpbnRlcnNlY3Rpb24gb2YgY2FwYWJpbGl0aWVzLlxuICAgICAgICAgIHZhciBwYXJhbXMgPSBnZXRDb21tb25DYXBhYmlsaXRpZXMobG9jYWxDYXBhYmlsaXRpZXMsXG4gICAgICAgICAgICAgIHJlbW90ZUNhcGFiaWxpdGllcyk7XG5cbiAgICAgICAgICAvLyBTdGFydCB0aGUgUlRDUnRwU2VuZGVyLiBUaGUgUlRDUnRwUmVjZWl2ZXIgZm9yIHRoaXNcbiAgICAgICAgICAvLyB0cmFuc2NlaXZlciBoYXMgYWxyZWFkeSBiZWVuIHN0YXJ0ZWQgaW4gc2V0UmVtb3RlRGVzY3JpcHRpb24uXG4gICAgICAgICAgcGMuX3RyYW5zY2VpdmUodHJhbnNjZWl2ZXIsXG4gICAgICAgICAgICAgIHBhcmFtcy5jb2RlY3MubGVuZ3RoID4gMCxcbiAgICAgICAgICAgICAgZmFsc2UpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBwYy5fbG9jYWxEZXNjcmlwdGlvbiA9IHtcbiAgICAgIHR5cGU6IGRlc2NyaXB0aW9uLnR5cGUsXG4gICAgICBzZHA6IGRlc2NyaXB0aW9uLnNkcFxuICAgIH07XG4gICAgaWYgKGRlc2NyaXB0aW9uLnR5cGUgPT09ICdvZmZlcicpIHtcbiAgICAgIHBjLl91cGRhdGVTaWduYWxpbmdTdGF0ZSgnaGF2ZS1sb2NhbC1vZmZlcicpO1xuICAgIH0gZWxzZSB7XG4gICAgICBwYy5fdXBkYXRlU2lnbmFsaW5nU3RhdGUoJ3N0YWJsZScpO1xuICAgIH1cblxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgfTtcblxuICBSVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuc2V0UmVtb3RlRGVzY3JpcHRpb24gPSBmdW5jdGlvbihkZXNjcmlwdGlvbikge1xuICAgIHZhciBwYyA9IHRoaXM7XG5cbiAgICAvLyBOb3RlOiBwcmFuc3dlciBpcyBub3Qgc3VwcG9ydGVkLlxuICAgIGlmIChbJ29mZmVyJywgJ2Fuc3dlciddLmluZGV4T2YoZGVzY3JpcHRpb24udHlwZSkgPT09IC0xKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobWFrZUVycm9yKCdUeXBlRXJyb3InLFxuICAgICAgICAgICdVbnN1cHBvcnRlZCB0eXBlIFwiJyArIGRlc2NyaXB0aW9uLnR5cGUgKyAnXCInKSk7XG4gICAgfVxuXG4gICAgaWYgKCFpc0FjdGlvbkFsbG93ZWRJblNpZ25hbGluZ1N0YXRlKCdzZXRSZW1vdGVEZXNjcmlwdGlvbicsXG4gICAgICAgIGRlc2NyaXB0aW9uLnR5cGUsIHBjLnNpZ25hbGluZ1N0YXRlKSB8fCBwYy5faXNDbG9zZWQpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChtYWtlRXJyb3IoJ0ludmFsaWRTdGF0ZUVycm9yJyxcbiAgICAgICAgICAnQ2FuIG5vdCBzZXQgcmVtb3RlICcgKyBkZXNjcmlwdGlvbi50eXBlICtcbiAgICAgICAgICAnIGluIHN0YXRlICcgKyBwYy5zaWduYWxpbmdTdGF0ZSkpO1xuICAgIH1cblxuICAgIHZhciBzdHJlYW1zID0ge307XG4gICAgcGMucmVtb3RlU3RyZWFtcy5mb3JFYWNoKGZ1bmN0aW9uKHN0cmVhbSkge1xuICAgICAgc3RyZWFtc1tzdHJlYW0uaWRdID0gc3RyZWFtO1xuICAgIH0pO1xuICAgIHZhciByZWNlaXZlckxpc3QgPSBbXTtcbiAgICB2YXIgc2VjdGlvbnMgPSBTRFBVdGlscy5zcGxpdFNlY3Rpb25zKGRlc2NyaXB0aW9uLnNkcCk7XG4gICAgdmFyIHNlc3Npb25wYXJ0ID0gc2VjdGlvbnMuc2hpZnQoKTtcbiAgICB2YXIgaXNJY2VMaXRlID0gU0RQVXRpbHMubWF0Y2hQcmVmaXgoc2Vzc2lvbnBhcnQsXG4gICAgICAgICdhPWljZS1saXRlJykubGVuZ3RoID4gMDtcbiAgICB2YXIgdXNpbmdCdW5kbGUgPSBTRFBVdGlscy5tYXRjaFByZWZpeChzZXNzaW9ucGFydCxcbiAgICAgICAgJ2E9Z3JvdXA6QlVORExFICcpLmxlbmd0aCA+IDA7XG4gICAgcGMudXNpbmdCdW5kbGUgPSB1c2luZ0J1bmRsZTtcbiAgICB2YXIgaWNlT3B0aW9ucyA9IFNEUFV0aWxzLm1hdGNoUHJlZml4KHNlc3Npb25wYXJ0LFxuICAgICAgICAnYT1pY2Utb3B0aW9uczonKVswXTtcbiAgICBpZiAoaWNlT3B0aW9ucykge1xuICAgICAgcGMuY2FuVHJpY2tsZUljZUNhbmRpZGF0ZXMgPSBpY2VPcHRpb25zLnN1YnN0cigxNCkuc3BsaXQoJyAnKVxuICAgICAgICAgIC5pbmRleE9mKCd0cmlja2xlJykgPj0gMDtcbiAgICB9IGVsc2Uge1xuICAgICAgcGMuY2FuVHJpY2tsZUljZUNhbmRpZGF0ZXMgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBzZWN0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKG1lZGlhU2VjdGlvbiwgc2RwTUxpbmVJbmRleCkge1xuICAgICAgdmFyIGxpbmVzID0gU0RQVXRpbHMuc3BsaXRMaW5lcyhtZWRpYVNlY3Rpb24pO1xuICAgICAgdmFyIGtpbmQgPSBTRFBVdGlscy5nZXRLaW5kKG1lZGlhU2VjdGlvbik7XG4gICAgICAvLyB0cmVhdCBidW5kbGUtb25seSBhcyBub3QtcmVqZWN0ZWQuXG4gICAgICB2YXIgcmVqZWN0ZWQgPSBTRFBVdGlscy5pc1JlamVjdGVkKG1lZGlhU2VjdGlvbikgJiZcbiAgICAgICAgICBTRFBVdGlscy5tYXRjaFByZWZpeChtZWRpYVNlY3Rpb24sICdhPWJ1bmRsZS1vbmx5JykubGVuZ3RoID09PSAwO1xuICAgICAgdmFyIHByb3RvY29sID0gbGluZXNbMF0uc3Vic3RyKDIpLnNwbGl0KCcgJylbMl07XG5cbiAgICAgIHZhciBkaXJlY3Rpb24gPSBTRFBVdGlscy5nZXREaXJlY3Rpb24obWVkaWFTZWN0aW9uLCBzZXNzaW9ucGFydCk7XG4gICAgICB2YXIgcmVtb3RlTXNpZCA9IFNEUFV0aWxzLnBhcnNlTXNpZChtZWRpYVNlY3Rpb24pO1xuXG4gICAgICB2YXIgbWlkID0gU0RQVXRpbHMuZ2V0TWlkKG1lZGlhU2VjdGlvbikgfHwgU0RQVXRpbHMuZ2VuZXJhdGVJZGVudGlmaWVyKCk7XG5cbiAgICAgIC8vIFJlamVjdCBkYXRhY2hhbm5lbHMgd2hpY2ggYXJlIG5vdCBpbXBsZW1lbnRlZCB5ZXQuXG4gICAgICBpZiAocmVqZWN0ZWQgfHwgKGtpbmQgPT09ICdhcHBsaWNhdGlvbicgJiYgKHByb3RvY29sID09PSAnRFRMUy9TQ1RQJyB8fFxuICAgICAgICAgIHByb3RvY29sID09PSAnVURQL0RUTFMvU0NUUCcpKSkge1xuICAgICAgICAvLyBUT0RPOiB0aGlzIGlzIGRhbmdlcm91cyBpbiB0aGUgY2FzZSB3aGVyZSBhIG5vbi1yZWplY3RlZCBtLWxpbmVcbiAgICAgICAgLy8gICAgIGJlY29tZXMgcmVqZWN0ZWQuXG4gICAgICAgIHBjLnRyYW5zY2VpdmVyc1tzZHBNTGluZUluZGV4XSA9IHtcbiAgICAgICAgICBtaWQ6IG1pZCxcbiAgICAgICAgICBraW5kOiBraW5kLFxuICAgICAgICAgIHByb3RvY29sOiBwcm90b2NvbCxcbiAgICAgICAgICByZWplY3RlZDogdHJ1ZVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmICghcmVqZWN0ZWQgJiYgcGMudHJhbnNjZWl2ZXJzW3NkcE1MaW5lSW5kZXhdICYmXG4gICAgICAgICAgcGMudHJhbnNjZWl2ZXJzW3NkcE1MaW5lSW5kZXhdLnJlamVjdGVkKSB7XG4gICAgICAgIC8vIHJlY3ljbGUgYSByZWplY3RlZCB0cmFuc2NlaXZlci5cbiAgICAgICAgcGMudHJhbnNjZWl2ZXJzW3NkcE1MaW5lSW5kZXhdID0gcGMuX2NyZWF0ZVRyYW5zY2VpdmVyKGtpbmQsIHRydWUpO1xuICAgICAgfVxuXG4gICAgICB2YXIgdHJhbnNjZWl2ZXI7XG4gICAgICB2YXIgaWNlR2F0aGVyZXI7XG4gICAgICB2YXIgaWNlVHJhbnNwb3J0O1xuICAgICAgdmFyIGR0bHNUcmFuc3BvcnQ7XG4gICAgICB2YXIgcnRwUmVjZWl2ZXI7XG4gICAgICB2YXIgc2VuZEVuY29kaW5nUGFyYW1ldGVycztcbiAgICAgIHZhciByZWN2RW5jb2RpbmdQYXJhbWV0ZXJzO1xuICAgICAgdmFyIGxvY2FsQ2FwYWJpbGl0aWVzO1xuXG4gICAgICB2YXIgdHJhY2s7XG4gICAgICAvLyBGSVhNRTogZW5zdXJlIHRoZSBtZWRpYVNlY3Rpb24gaGFzIHJ0Y3AtbXV4IHNldC5cbiAgICAgIHZhciByZW1vdGVDYXBhYmlsaXRpZXMgPSBTRFBVdGlscy5wYXJzZVJ0cFBhcmFtZXRlcnMobWVkaWFTZWN0aW9uKTtcbiAgICAgIHZhciByZW1vdGVJY2VQYXJhbWV0ZXJzO1xuICAgICAgdmFyIHJlbW90ZUR0bHNQYXJhbWV0ZXJzO1xuICAgICAgaWYgKCFyZWplY3RlZCkge1xuICAgICAgICByZW1vdGVJY2VQYXJhbWV0ZXJzID0gU0RQVXRpbHMuZ2V0SWNlUGFyYW1ldGVycyhtZWRpYVNlY3Rpb24sXG4gICAgICAgICAgICBzZXNzaW9ucGFydCk7XG4gICAgICAgIHJlbW90ZUR0bHNQYXJhbWV0ZXJzID0gU0RQVXRpbHMuZ2V0RHRsc1BhcmFtZXRlcnMobWVkaWFTZWN0aW9uLFxuICAgICAgICAgICAgc2Vzc2lvbnBhcnQpO1xuICAgICAgICByZW1vdGVEdGxzUGFyYW1ldGVycy5yb2xlID0gJ2NsaWVudCc7XG4gICAgICB9XG4gICAgICByZWN2RW5jb2RpbmdQYXJhbWV0ZXJzID1cbiAgICAgICAgICBTRFBVdGlscy5wYXJzZVJ0cEVuY29kaW5nUGFyYW1ldGVycyhtZWRpYVNlY3Rpb24pO1xuXG4gICAgICB2YXIgcnRjcFBhcmFtZXRlcnMgPSBTRFBVdGlscy5wYXJzZVJ0Y3BQYXJhbWV0ZXJzKG1lZGlhU2VjdGlvbik7XG5cbiAgICAgIHZhciBpc0NvbXBsZXRlID0gU0RQVXRpbHMubWF0Y2hQcmVmaXgobWVkaWFTZWN0aW9uLFxuICAgICAgICAgICdhPWVuZC1vZi1jYW5kaWRhdGVzJywgc2Vzc2lvbnBhcnQpLmxlbmd0aCA+IDA7XG4gICAgICB2YXIgY2FuZHMgPSBTRFBVdGlscy5tYXRjaFByZWZpeChtZWRpYVNlY3Rpb24sICdhPWNhbmRpZGF0ZTonKVxuICAgICAgICAgIC5tYXAoZnVuY3Rpb24oY2FuZCkge1xuICAgICAgICAgICAgcmV0dXJuIFNEUFV0aWxzLnBhcnNlQ2FuZGlkYXRlKGNhbmQpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZpbHRlcihmdW5jdGlvbihjYW5kKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FuZC5jb21wb25lbnQgPT09IDE7XG4gICAgICAgICAgfSk7XG5cbiAgICAgIC8vIENoZWNrIGlmIHdlIGNhbiB1c2UgQlVORExFIGFuZCBkaXNwb3NlIHRyYW5zcG9ydHMuXG4gICAgICBpZiAoKGRlc2NyaXB0aW9uLnR5cGUgPT09ICdvZmZlcicgfHwgZGVzY3JpcHRpb24udHlwZSA9PT0gJ2Fuc3dlcicpICYmXG4gICAgICAgICAgIXJlamVjdGVkICYmIHVzaW5nQnVuZGxlICYmIHNkcE1MaW5lSW5kZXggPiAwICYmXG4gICAgICAgICAgcGMudHJhbnNjZWl2ZXJzW3NkcE1MaW5lSW5kZXhdKSB7XG4gICAgICAgIHBjLl9kaXNwb3NlSWNlQW5kRHRsc1RyYW5zcG9ydHMoc2RwTUxpbmVJbmRleCk7XG4gICAgICAgIHBjLnRyYW5zY2VpdmVyc1tzZHBNTGluZUluZGV4XS5pY2VHYXRoZXJlciA9XG4gICAgICAgICAgICBwYy50cmFuc2NlaXZlcnNbMF0uaWNlR2F0aGVyZXI7XG4gICAgICAgIHBjLnRyYW5zY2VpdmVyc1tzZHBNTGluZUluZGV4XS5pY2VUcmFuc3BvcnQgPVxuICAgICAgICAgICAgcGMudHJhbnNjZWl2ZXJzWzBdLmljZVRyYW5zcG9ydDtcbiAgICAgICAgcGMudHJhbnNjZWl2ZXJzW3NkcE1MaW5lSW5kZXhdLmR0bHNUcmFuc3BvcnQgPVxuICAgICAgICAgICAgcGMudHJhbnNjZWl2ZXJzWzBdLmR0bHNUcmFuc3BvcnQ7XG4gICAgICAgIGlmIChwYy50cmFuc2NlaXZlcnNbc2RwTUxpbmVJbmRleF0ucnRwU2VuZGVyKSB7XG4gICAgICAgICAgcGMudHJhbnNjZWl2ZXJzW3NkcE1MaW5lSW5kZXhdLnJ0cFNlbmRlci5zZXRUcmFuc3BvcnQoXG4gICAgICAgICAgICAgIHBjLnRyYW5zY2VpdmVyc1swXS5kdGxzVHJhbnNwb3J0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocGMudHJhbnNjZWl2ZXJzW3NkcE1MaW5lSW5kZXhdLnJ0cFJlY2VpdmVyKSB7XG4gICAgICAgICAgcGMudHJhbnNjZWl2ZXJzW3NkcE1MaW5lSW5kZXhdLnJ0cFJlY2VpdmVyLnNldFRyYW5zcG9ydChcbiAgICAgICAgICAgICAgcGMudHJhbnNjZWl2ZXJzWzBdLmR0bHNUcmFuc3BvcnQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoZGVzY3JpcHRpb24udHlwZSA9PT0gJ29mZmVyJyAmJiAhcmVqZWN0ZWQpIHtcbiAgICAgICAgdHJhbnNjZWl2ZXIgPSBwYy50cmFuc2NlaXZlcnNbc2RwTUxpbmVJbmRleF0gfHxcbiAgICAgICAgICAgIHBjLl9jcmVhdGVUcmFuc2NlaXZlcihraW5kKTtcbiAgICAgICAgdHJhbnNjZWl2ZXIubWlkID0gbWlkO1xuXG4gICAgICAgIGlmICghdHJhbnNjZWl2ZXIuaWNlR2F0aGVyZXIpIHtcbiAgICAgICAgICB0cmFuc2NlaXZlci5pY2VHYXRoZXJlciA9IHBjLl9jcmVhdGVJY2VHYXRoZXJlcihzZHBNTGluZUluZGV4LFxuICAgICAgICAgICAgICB1c2luZ0J1bmRsZSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY2FuZHMubGVuZ3RoICYmIHRyYW5zY2VpdmVyLmljZVRyYW5zcG9ydC5zdGF0ZSA9PT0gJ25ldycpIHtcbiAgICAgICAgICBpZiAoaXNDb21wbGV0ZSAmJiAoIXVzaW5nQnVuZGxlIHx8IHNkcE1MaW5lSW5kZXggPT09IDApKSB7XG4gICAgICAgICAgICB0cmFuc2NlaXZlci5pY2VUcmFuc3BvcnQuc2V0UmVtb3RlQ2FuZGlkYXRlcyhjYW5kcyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNhbmRzLmZvckVhY2goZnVuY3Rpb24oY2FuZGlkYXRlKSB7XG4gICAgICAgICAgICAgIG1heWJlQWRkQ2FuZGlkYXRlKHRyYW5zY2VpdmVyLmljZVRyYW5zcG9ydCwgY2FuZGlkYXRlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGxvY2FsQ2FwYWJpbGl0aWVzID0gd2luZG93LlJUQ1J0cFJlY2VpdmVyLmdldENhcGFiaWxpdGllcyhraW5kKTtcblxuICAgICAgICAvLyBmaWx0ZXIgUlRYIHVudGlsIGFkZGl0aW9uYWwgc3R1ZmYgbmVlZGVkIGZvciBSVFggaXMgaW1wbGVtZW50ZWRcbiAgICAgICAgLy8gaW4gYWRhcHRlci5qc1xuICAgICAgICBpZiAoZWRnZVZlcnNpb24gPCAxNTAxOSkge1xuICAgICAgICAgIGxvY2FsQ2FwYWJpbGl0aWVzLmNvZGVjcyA9IGxvY2FsQ2FwYWJpbGl0aWVzLmNvZGVjcy5maWx0ZXIoXG4gICAgICAgICAgICAgIGZ1bmN0aW9uKGNvZGVjKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvZGVjLm5hbWUgIT09ICdydHgnO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNlbmRFbmNvZGluZ1BhcmFtZXRlcnMgPSB0cmFuc2NlaXZlci5zZW5kRW5jb2RpbmdQYXJhbWV0ZXJzIHx8IFt7XG4gICAgICAgICAgc3NyYzogKDIgKiBzZHBNTGluZUluZGV4ICsgMikgKiAxMDAxXG4gICAgICAgIH1dO1xuXG4gICAgICAgIC8vIFRPRE86IHJld3JpdGUgdG8gdXNlIGh0dHA6Ly93M2MuZ2l0aHViLmlvL3dlYnJ0Yy1wYy8jc2V0LWFzc29jaWF0ZWQtcmVtb3RlLXN0cmVhbXNcbiAgICAgICAgdmFyIGlzTmV3VHJhY2sgPSBmYWxzZTtcbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gJ3NlbmRyZWN2JyB8fCBkaXJlY3Rpb24gPT09ICdzZW5kb25seScpIHtcbiAgICAgICAgICBpc05ld1RyYWNrID0gIXRyYW5zY2VpdmVyLnJ0cFJlY2VpdmVyO1xuICAgICAgICAgIHJ0cFJlY2VpdmVyID0gdHJhbnNjZWl2ZXIucnRwUmVjZWl2ZXIgfHxcbiAgICAgICAgICAgICAgbmV3IHdpbmRvdy5SVENSdHBSZWNlaXZlcih0cmFuc2NlaXZlci5kdGxzVHJhbnNwb3J0LCBraW5kKTtcblxuICAgICAgICAgIGlmIChpc05ld1RyYWNrKSB7XG4gICAgICAgICAgICB2YXIgc3RyZWFtO1xuICAgICAgICAgICAgdHJhY2sgPSBydHBSZWNlaXZlci50cmFjaztcbiAgICAgICAgICAgIC8vIEZJWE1FOiBkb2VzIG5vdCB3b3JrIHdpdGggUGxhbiBCLlxuICAgICAgICAgICAgaWYgKHJlbW90ZU1zaWQgJiYgcmVtb3RlTXNpZC5zdHJlYW0gPT09ICctJykge1xuICAgICAgICAgICAgICAvLyBuby1vcC4gYSBzdHJlYW0gaWQgb2YgJy0nIG1lYW5zOiBubyBhc3NvY2lhdGVkIHN0cmVhbS5cbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVtb3RlTXNpZCkge1xuICAgICAgICAgICAgICBpZiAoIXN0cmVhbXNbcmVtb3RlTXNpZC5zdHJlYW1dKSB7XG4gICAgICAgICAgICAgICAgc3RyZWFtc1tyZW1vdGVNc2lkLnN0cmVhbV0gPSBuZXcgd2luZG93Lk1lZGlhU3RyZWFtKCk7XG4gICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHN0cmVhbXNbcmVtb3RlTXNpZC5zdHJlYW1dLCAnaWQnLCB7XG4gICAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVtb3RlTXNpZC5zdHJlYW07XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRyYWNrLCAnaWQnLCB7XG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiByZW1vdGVNc2lkLnRyYWNrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIHN0cmVhbSA9IHN0cmVhbXNbcmVtb3RlTXNpZC5zdHJlYW1dO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgaWYgKCFzdHJlYW1zLmRlZmF1bHQpIHtcbiAgICAgICAgICAgICAgICBzdHJlYW1zLmRlZmF1bHQgPSBuZXcgd2luZG93Lk1lZGlhU3RyZWFtKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgc3RyZWFtID0gc3RyZWFtcy5kZWZhdWx0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHN0cmVhbSkge1xuICAgICAgICAgICAgICBhZGRUcmFja1RvU3RyZWFtQW5kRmlyZUV2ZW50KHRyYWNrLCBzdHJlYW0pO1xuICAgICAgICAgICAgICB0cmFuc2NlaXZlci5hc3NvY2lhdGVkUmVtb3RlTWVkaWFTdHJlYW1zLnB1c2goc3RyZWFtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlY2VpdmVyTGlzdC5wdXNoKFt0cmFjaywgcnRwUmVjZWl2ZXIsIHN0cmVhbV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0cmFuc2NlaXZlci5ydHBSZWNlaXZlciAmJiB0cmFuc2NlaXZlci5ydHBSZWNlaXZlci50cmFjaykge1xuICAgICAgICAgIHRyYW5zY2VpdmVyLmFzc29jaWF0ZWRSZW1vdGVNZWRpYVN0cmVhbXMuZm9yRWFjaChmdW5jdGlvbihzKSB7XG4gICAgICAgICAgICB2YXIgbmF0aXZlVHJhY2sgPSBzLmdldFRyYWNrcygpLmZpbmQoZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgICByZXR1cm4gdC5pZCA9PT0gdHJhbnNjZWl2ZXIucnRwUmVjZWl2ZXIudHJhY2suaWQ7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChuYXRpdmVUcmFjaykge1xuICAgICAgICAgICAgICByZW1vdmVUcmFja0Zyb21TdHJlYW1BbmRGaXJlRXZlbnQobmF0aXZlVHJhY2ssIHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHRyYW5zY2VpdmVyLmFzc29jaWF0ZWRSZW1vdGVNZWRpYVN0cmVhbXMgPSBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyYW5zY2VpdmVyLmxvY2FsQ2FwYWJpbGl0aWVzID0gbG9jYWxDYXBhYmlsaXRpZXM7XG4gICAgICAgIHRyYW5zY2VpdmVyLnJlbW90ZUNhcGFiaWxpdGllcyA9IHJlbW90ZUNhcGFiaWxpdGllcztcbiAgICAgICAgdHJhbnNjZWl2ZXIucnRwUmVjZWl2ZXIgPSBydHBSZWNlaXZlcjtcbiAgICAgICAgdHJhbnNjZWl2ZXIucnRjcFBhcmFtZXRlcnMgPSBydGNwUGFyYW1ldGVycztcbiAgICAgICAgdHJhbnNjZWl2ZXIuc2VuZEVuY29kaW5nUGFyYW1ldGVycyA9IHNlbmRFbmNvZGluZ1BhcmFtZXRlcnM7XG4gICAgICAgIHRyYW5zY2VpdmVyLnJlY3ZFbmNvZGluZ1BhcmFtZXRlcnMgPSByZWN2RW5jb2RpbmdQYXJhbWV0ZXJzO1xuXG4gICAgICAgIC8vIFN0YXJ0IHRoZSBSVENSdHBSZWNlaXZlciBub3cuIFRoZSBSVFBTZW5kZXIgaXMgc3RhcnRlZCBpblxuICAgICAgICAvLyBzZXRMb2NhbERlc2NyaXB0aW9uLlxuICAgICAgICBwYy5fdHJhbnNjZWl2ZShwYy50cmFuc2NlaXZlcnNbc2RwTUxpbmVJbmRleF0sXG4gICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgIGlzTmV3VHJhY2spO1xuICAgICAgfSBlbHNlIGlmIChkZXNjcmlwdGlvbi50eXBlID09PSAnYW5zd2VyJyAmJiAhcmVqZWN0ZWQpIHtcbiAgICAgICAgdHJhbnNjZWl2ZXIgPSBwYy50cmFuc2NlaXZlcnNbc2RwTUxpbmVJbmRleF07XG4gICAgICAgIGljZUdhdGhlcmVyID0gdHJhbnNjZWl2ZXIuaWNlR2F0aGVyZXI7XG4gICAgICAgIGljZVRyYW5zcG9ydCA9IHRyYW5zY2VpdmVyLmljZVRyYW5zcG9ydDtcbiAgICAgICAgZHRsc1RyYW5zcG9ydCA9IHRyYW5zY2VpdmVyLmR0bHNUcmFuc3BvcnQ7XG4gICAgICAgIHJ0cFJlY2VpdmVyID0gdHJhbnNjZWl2ZXIucnRwUmVjZWl2ZXI7XG4gICAgICAgIHNlbmRFbmNvZGluZ1BhcmFtZXRlcnMgPSB0cmFuc2NlaXZlci5zZW5kRW5jb2RpbmdQYXJhbWV0ZXJzO1xuICAgICAgICBsb2NhbENhcGFiaWxpdGllcyA9IHRyYW5zY2VpdmVyLmxvY2FsQ2FwYWJpbGl0aWVzO1xuXG4gICAgICAgIHBjLnRyYW5zY2VpdmVyc1tzZHBNTGluZUluZGV4XS5yZWN2RW5jb2RpbmdQYXJhbWV0ZXJzID1cbiAgICAgICAgICAgIHJlY3ZFbmNvZGluZ1BhcmFtZXRlcnM7XG4gICAgICAgIHBjLnRyYW5zY2VpdmVyc1tzZHBNTGluZUluZGV4XS5yZW1vdGVDYXBhYmlsaXRpZXMgPVxuICAgICAgICAgICAgcmVtb3RlQ2FwYWJpbGl0aWVzO1xuICAgICAgICBwYy50cmFuc2NlaXZlcnNbc2RwTUxpbmVJbmRleF0ucnRjcFBhcmFtZXRlcnMgPSBydGNwUGFyYW1ldGVycztcblxuICAgICAgICBpZiAoY2FuZHMubGVuZ3RoICYmIGljZVRyYW5zcG9ydC5zdGF0ZSA9PT0gJ25ldycpIHtcbiAgICAgICAgICBpZiAoKGlzSWNlTGl0ZSB8fCBpc0NvbXBsZXRlKSAmJlxuICAgICAgICAgICAgICAoIXVzaW5nQnVuZGxlIHx8IHNkcE1MaW5lSW5kZXggPT09IDApKSB7XG4gICAgICAgICAgICBpY2VUcmFuc3BvcnQuc2V0UmVtb3RlQ2FuZGlkYXRlcyhjYW5kcyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNhbmRzLmZvckVhY2goZnVuY3Rpb24oY2FuZGlkYXRlKSB7XG4gICAgICAgICAgICAgIG1heWJlQWRkQ2FuZGlkYXRlKHRyYW5zY2VpdmVyLmljZVRyYW5zcG9ydCwgY2FuZGlkYXRlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdXNpbmdCdW5kbGUgfHwgc2RwTUxpbmVJbmRleCA9PT0gMCkge1xuICAgICAgICAgIGlmIChpY2VUcmFuc3BvcnQuc3RhdGUgPT09ICduZXcnKSB7XG4gICAgICAgICAgICBpY2VUcmFuc3BvcnQuc3RhcnQoaWNlR2F0aGVyZXIsIHJlbW90ZUljZVBhcmFtZXRlcnMsXG4gICAgICAgICAgICAgICAgJ2NvbnRyb2xsaW5nJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChkdGxzVHJhbnNwb3J0LnN0YXRlID09PSAnbmV3Jykge1xuICAgICAgICAgICAgZHRsc1RyYW5zcG9ydC5zdGFydChyZW1vdGVEdGxzUGFyYW1ldGVycyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gSWYgdGhlIG9mZmVyIGNvbnRhaW5lZCBSVFggYnV0IHRoZSBhbnN3ZXIgZGlkIG5vdCxcbiAgICAgICAgLy8gcmVtb3ZlIFJUWCBmcm9tIHNlbmRFbmNvZGluZ1BhcmFtZXRlcnMuXG4gICAgICAgIHZhciBjb21tb25DYXBhYmlsaXRpZXMgPSBnZXRDb21tb25DYXBhYmlsaXRpZXMoXG4gICAgICAgICAgdHJhbnNjZWl2ZXIubG9jYWxDYXBhYmlsaXRpZXMsXG4gICAgICAgICAgdHJhbnNjZWl2ZXIucmVtb3RlQ2FwYWJpbGl0aWVzKTtcblxuICAgICAgICB2YXIgaGFzUnR4ID0gY29tbW9uQ2FwYWJpbGl0aWVzLmNvZGVjcy5maWx0ZXIoZnVuY3Rpb24oYykge1xuICAgICAgICAgIHJldHVybiBjLm5hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ3J0eCc7XG4gICAgICAgIH0pLmxlbmd0aDtcbiAgICAgICAgaWYgKCFoYXNSdHggJiYgdHJhbnNjZWl2ZXIuc2VuZEVuY29kaW5nUGFyYW1ldGVyc1swXS5ydHgpIHtcbiAgICAgICAgICBkZWxldGUgdHJhbnNjZWl2ZXIuc2VuZEVuY29kaW5nUGFyYW1ldGVyc1swXS5ydHg7XG4gICAgICAgIH1cblxuICAgICAgICBwYy5fdHJhbnNjZWl2ZSh0cmFuc2NlaXZlcixcbiAgICAgICAgICAgIGRpcmVjdGlvbiA9PT0gJ3NlbmRyZWN2JyB8fCBkaXJlY3Rpb24gPT09ICdyZWN2b25seScsXG4gICAgICAgICAgICBkaXJlY3Rpb24gPT09ICdzZW5kcmVjdicgfHwgZGlyZWN0aW9uID09PSAnc2VuZG9ubHknKTtcblxuICAgICAgICAvLyBUT0RPOiByZXdyaXRlIHRvIHVzZSBodHRwOi8vdzNjLmdpdGh1Yi5pby93ZWJydGMtcGMvI3NldC1hc3NvY2lhdGVkLXJlbW90ZS1zdHJlYW1zXG4gICAgICAgIGlmIChydHBSZWNlaXZlciAmJlxuICAgICAgICAgICAgKGRpcmVjdGlvbiA9PT0gJ3NlbmRyZWN2JyB8fCBkaXJlY3Rpb24gPT09ICdzZW5kb25seScpKSB7XG4gICAgICAgICAgdHJhY2sgPSBydHBSZWNlaXZlci50cmFjaztcbiAgICAgICAgICBpZiAocmVtb3RlTXNpZCkge1xuICAgICAgICAgICAgaWYgKCFzdHJlYW1zW3JlbW90ZU1zaWQuc3RyZWFtXSkge1xuICAgICAgICAgICAgICBzdHJlYW1zW3JlbW90ZU1zaWQuc3RyZWFtXSA9IG5ldyB3aW5kb3cuTWVkaWFTdHJlYW0oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFkZFRyYWNrVG9TdHJlYW1BbmRGaXJlRXZlbnQodHJhY2ssIHN0cmVhbXNbcmVtb3RlTXNpZC5zdHJlYW1dKTtcbiAgICAgICAgICAgIHJlY2VpdmVyTGlzdC5wdXNoKFt0cmFjaywgcnRwUmVjZWl2ZXIsIHN0cmVhbXNbcmVtb3RlTXNpZC5zdHJlYW1dXSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICghc3RyZWFtcy5kZWZhdWx0KSB7XG4gICAgICAgICAgICAgIHN0cmVhbXMuZGVmYXVsdCA9IG5ldyB3aW5kb3cuTWVkaWFTdHJlYW0oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFkZFRyYWNrVG9TdHJlYW1BbmRGaXJlRXZlbnQodHJhY2ssIHN0cmVhbXMuZGVmYXVsdCk7XG4gICAgICAgICAgICByZWNlaXZlckxpc3QucHVzaChbdHJhY2ssIHJ0cFJlY2VpdmVyLCBzdHJlYW1zLmRlZmF1bHRdKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gRklYTUU6IGFjdHVhbGx5IHRoZSByZWNlaXZlciBzaG91bGQgYmUgY3JlYXRlZCBsYXRlci5cbiAgICAgICAgICBkZWxldGUgdHJhbnNjZWl2ZXIucnRwUmVjZWl2ZXI7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGlmIChwYy5fZHRsc1JvbGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgcGMuX2R0bHNSb2xlID0gZGVzY3JpcHRpb24udHlwZSA9PT0gJ29mZmVyJyA/ICdhY3RpdmUnIDogJ3Bhc3NpdmUnO1xuICAgIH1cblxuICAgIHBjLl9yZW1vdGVEZXNjcmlwdGlvbiA9IHtcbiAgICAgIHR5cGU6IGRlc2NyaXB0aW9uLnR5cGUsXG4gICAgICBzZHA6IGRlc2NyaXB0aW9uLnNkcFxuICAgIH07XG4gICAgaWYgKGRlc2NyaXB0aW9uLnR5cGUgPT09ICdvZmZlcicpIHtcbiAgICAgIHBjLl91cGRhdGVTaWduYWxpbmdTdGF0ZSgnaGF2ZS1yZW1vdGUtb2ZmZXInKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcGMuX3VwZGF0ZVNpZ25hbGluZ1N0YXRlKCdzdGFibGUnKTtcbiAgICB9XG4gICAgT2JqZWN0LmtleXMoc3RyZWFtcykuZm9yRWFjaChmdW5jdGlvbihzaWQpIHtcbiAgICAgIHZhciBzdHJlYW0gPSBzdHJlYW1zW3NpZF07XG4gICAgICBpZiAoc3RyZWFtLmdldFRyYWNrcygpLmxlbmd0aCkge1xuICAgICAgICBpZiAocGMucmVtb3RlU3RyZWFtcy5pbmRleE9mKHN0cmVhbSkgPT09IC0xKSB7XG4gICAgICAgICAgcGMucmVtb3RlU3RyZWFtcy5wdXNoKHN0cmVhbSk7XG4gICAgICAgICAgdmFyIGV2ZW50ID0gbmV3IEV2ZW50KCdhZGRzdHJlYW0nKTtcbiAgICAgICAgICBldmVudC5zdHJlYW0gPSBzdHJlYW07XG4gICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBwYy5fZGlzcGF0Y2hFdmVudCgnYWRkc3RyZWFtJywgZXZlbnQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVjZWl2ZXJMaXN0LmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICAgIHZhciB0cmFjayA9IGl0ZW1bMF07XG4gICAgICAgICAgdmFyIHJlY2VpdmVyID0gaXRlbVsxXTtcbiAgICAgICAgICBpZiAoc3RyZWFtLmlkICE9PSBpdGVtWzJdLmlkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGZpcmVBZGRUcmFjayhwYywgdHJhY2ssIHJlY2VpdmVyLCBbc3RyZWFtXSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJlY2VpdmVyTGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgIGlmIChpdGVtWzJdKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGZpcmVBZGRUcmFjayhwYywgaXRlbVswXSwgaXRlbVsxXSwgW10pO1xuICAgIH0pO1xuXG4gICAgLy8gY2hlY2sgd2hldGhlciBhZGRJY2VDYW5kaWRhdGUoe30pIHdhcyBjYWxsZWQgd2l0aGluIGZvdXIgc2Vjb25kcyBhZnRlclxuICAgIC8vIHNldFJlbW90ZURlc2NyaXB0aW9uLlxuICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKCEocGMgJiYgcGMudHJhbnNjZWl2ZXJzKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBwYy50cmFuc2NlaXZlcnMuZm9yRWFjaChmdW5jdGlvbih0cmFuc2NlaXZlcikge1xuICAgICAgICBpZiAodHJhbnNjZWl2ZXIuaWNlVHJhbnNwb3J0ICYmXG4gICAgICAgICAgICB0cmFuc2NlaXZlci5pY2VUcmFuc3BvcnQuc3RhdGUgPT09ICduZXcnICYmXG4gICAgICAgICAgICB0cmFuc2NlaXZlci5pY2VUcmFuc3BvcnQuZ2V0UmVtb3RlQ2FuZGlkYXRlcygpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ1RpbWVvdXQgZm9yIGFkZFJlbW90ZUNhbmRpZGF0ZS4gQ29uc2lkZXIgc2VuZGluZyAnICtcbiAgICAgICAgICAgICAgJ2FuIGVuZC1vZi1jYW5kaWRhdGVzIG5vdGlmaWNhdGlvbicpO1xuICAgICAgICAgIHRyYW5zY2VpdmVyLmljZVRyYW5zcG9ydC5hZGRSZW1vdGVDYW5kaWRhdGUoe30pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LCA0MDAwKTtcblxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgfTtcblxuICBSVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnRyYW5zY2VpdmVycy5mb3JFYWNoKGZ1bmN0aW9uKHRyYW5zY2VpdmVyKSB7XG4gICAgICAvKiBub3QgeWV0XG4gICAgICBpZiAodHJhbnNjZWl2ZXIuaWNlR2F0aGVyZXIpIHtcbiAgICAgICAgdHJhbnNjZWl2ZXIuaWNlR2F0aGVyZXIuY2xvc2UoKTtcbiAgICAgIH1cbiAgICAgICovXG4gICAgICBpZiAodHJhbnNjZWl2ZXIuaWNlVHJhbnNwb3J0KSB7XG4gICAgICAgIHRyYW5zY2VpdmVyLmljZVRyYW5zcG9ydC5zdG9wKCk7XG4gICAgICB9XG4gICAgICBpZiAodHJhbnNjZWl2ZXIuZHRsc1RyYW5zcG9ydCkge1xuICAgICAgICB0cmFuc2NlaXZlci5kdGxzVHJhbnNwb3J0LnN0b3AoKTtcbiAgICAgIH1cbiAgICAgIGlmICh0cmFuc2NlaXZlci5ydHBTZW5kZXIpIHtcbiAgICAgICAgdHJhbnNjZWl2ZXIucnRwU2VuZGVyLnN0b3AoKTtcbiAgICAgIH1cbiAgICAgIGlmICh0cmFuc2NlaXZlci5ydHBSZWNlaXZlcikge1xuICAgICAgICB0cmFuc2NlaXZlci5ydHBSZWNlaXZlci5zdG9wKCk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgLy8gRklYTUU6IGNsZWFuIHVwIHRyYWNrcywgbG9jYWwgc3RyZWFtcywgcmVtb3RlIHN0cmVhbXMsIGV0Y1xuICAgIHRoaXMuX2lzQ2xvc2VkID0gdHJ1ZTtcbiAgICB0aGlzLl91cGRhdGVTaWduYWxpbmdTdGF0ZSgnY2xvc2VkJyk7XG4gIH07XG5cbiAgLy8gVXBkYXRlIHRoZSBzaWduYWxpbmcgc3RhdGUuXG4gIFJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5fdXBkYXRlU2lnbmFsaW5nU3RhdGUgPSBmdW5jdGlvbihuZXdTdGF0ZSkge1xuICAgIHRoaXMuc2lnbmFsaW5nU3RhdGUgPSBuZXdTdGF0ZTtcbiAgICB2YXIgZXZlbnQgPSBuZXcgRXZlbnQoJ3NpZ25hbGluZ3N0YXRlY2hhbmdlJyk7XG4gICAgdGhpcy5fZGlzcGF0Y2hFdmVudCgnc2lnbmFsaW5nc3RhdGVjaGFuZ2UnLCBldmVudCk7XG4gIH07XG5cbiAgLy8gRGV0ZXJtaW5lIHdoZXRoZXIgdG8gZmlyZSB0aGUgbmVnb3RpYXRpb25uZWVkZWQgZXZlbnQuXG4gIFJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5fbWF5YmVGaXJlTmVnb3RpYXRpb25OZWVkZWQgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgcGMgPSB0aGlzO1xuICAgIGlmICh0aGlzLnNpZ25hbGluZ1N0YXRlICE9PSAnc3RhYmxlJyB8fCB0aGlzLm5lZWROZWdvdGlhdGlvbiA9PT0gdHJ1ZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLm5lZWROZWdvdGlhdGlvbiA9IHRydWU7XG4gICAgd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICBpZiAocGMubmVlZE5lZ290aWF0aW9uKSB7XG4gICAgICAgIHBjLm5lZWROZWdvdGlhdGlvbiA9IGZhbHNlO1xuICAgICAgICB2YXIgZXZlbnQgPSBuZXcgRXZlbnQoJ25lZ290aWF0aW9ubmVlZGVkJyk7XG4gICAgICAgIHBjLl9kaXNwYXRjaEV2ZW50KCduZWdvdGlhdGlvbm5lZWRlZCcsIGV2ZW50KTtcbiAgICAgIH1cbiAgICB9LCAwKTtcbiAgfTtcblxuICAvLyBVcGRhdGUgdGhlIGljZSBjb25uZWN0aW9uIHN0YXRlLlxuICBSVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuX3VwZGF0ZUljZUNvbm5lY3Rpb25TdGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBuZXdTdGF0ZTtcbiAgICB2YXIgc3RhdGVzID0ge1xuICAgICAgJ25ldyc6IDAsXG4gICAgICBjbG9zZWQ6IDAsXG4gICAgICBjaGVja2luZzogMCxcbiAgICAgIGNvbm5lY3RlZDogMCxcbiAgICAgIGNvbXBsZXRlZDogMCxcbiAgICAgIGRpc2Nvbm5lY3RlZDogMCxcbiAgICAgIGZhaWxlZDogMFxuICAgIH07XG4gICAgdGhpcy50cmFuc2NlaXZlcnMuZm9yRWFjaChmdW5jdGlvbih0cmFuc2NlaXZlcikge1xuICAgICAgaWYgKHRyYW5zY2VpdmVyLmljZVRyYW5zcG9ydCAmJiAhdHJhbnNjZWl2ZXIucmVqZWN0ZWQpIHtcbiAgICAgICAgc3RhdGVzW3RyYW5zY2VpdmVyLmljZVRyYW5zcG9ydC5zdGF0ZV0rKztcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIG5ld1N0YXRlID0gJ25ldyc7XG4gICAgaWYgKHN0YXRlcy5mYWlsZWQgPiAwKSB7XG4gICAgICBuZXdTdGF0ZSA9ICdmYWlsZWQnO1xuICAgIH0gZWxzZSBpZiAoc3RhdGVzLmNoZWNraW5nID4gMCkge1xuICAgICAgbmV3U3RhdGUgPSAnY2hlY2tpbmcnO1xuICAgIH0gZWxzZSBpZiAoc3RhdGVzLmRpc2Nvbm5lY3RlZCA+IDApIHtcbiAgICAgIG5ld1N0YXRlID0gJ2Rpc2Nvbm5lY3RlZCc7XG4gICAgfSBlbHNlIGlmIChzdGF0ZXMubmV3ID4gMCkge1xuICAgICAgbmV3U3RhdGUgPSAnbmV3JztcbiAgICB9IGVsc2UgaWYgKHN0YXRlcy5jb25uZWN0ZWQgPiAwKSB7XG4gICAgICBuZXdTdGF0ZSA9ICdjb25uZWN0ZWQnO1xuICAgIH0gZWxzZSBpZiAoc3RhdGVzLmNvbXBsZXRlZCA+IDApIHtcbiAgICAgIG5ld1N0YXRlID0gJ2NvbXBsZXRlZCc7XG4gICAgfVxuXG4gICAgaWYgKG5ld1N0YXRlICE9PSB0aGlzLmljZUNvbm5lY3Rpb25TdGF0ZSkge1xuICAgICAgdGhpcy5pY2VDb25uZWN0aW9uU3RhdGUgPSBuZXdTdGF0ZTtcbiAgICAgIHZhciBldmVudCA9IG5ldyBFdmVudCgnaWNlY29ubmVjdGlvbnN0YXRlY2hhbmdlJyk7XG4gICAgICB0aGlzLl9kaXNwYXRjaEV2ZW50KCdpY2Vjb25uZWN0aW9uc3RhdGVjaGFuZ2UnLCBldmVudCk7XG4gICAgfVxuICB9O1xuXG4gIC8vIFVwZGF0ZSB0aGUgY29ubmVjdGlvbiBzdGF0ZS5cbiAgUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLl91cGRhdGVDb25uZWN0aW9uU3RhdGUgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgbmV3U3RhdGU7XG4gICAgdmFyIHN0YXRlcyA9IHtcbiAgICAgICduZXcnOiAwLFxuICAgICAgY2xvc2VkOiAwLFxuICAgICAgY29ubmVjdGluZzogMCxcbiAgICAgIGNvbm5lY3RlZDogMCxcbiAgICAgIGNvbXBsZXRlZDogMCxcbiAgICAgIGRpc2Nvbm5lY3RlZDogMCxcbiAgICAgIGZhaWxlZDogMFxuICAgIH07XG4gICAgdGhpcy50cmFuc2NlaXZlcnMuZm9yRWFjaChmdW5jdGlvbih0cmFuc2NlaXZlcikge1xuICAgICAgaWYgKHRyYW5zY2VpdmVyLmljZVRyYW5zcG9ydCAmJiB0cmFuc2NlaXZlci5kdGxzVHJhbnNwb3J0ICYmXG4gICAgICAgICAgIXRyYW5zY2VpdmVyLnJlamVjdGVkKSB7XG4gICAgICAgIHN0YXRlc1t0cmFuc2NlaXZlci5pY2VUcmFuc3BvcnQuc3RhdGVdKys7XG4gICAgICAgIHN0YXRlc1t0cmFuc2NlaXZlci5kdGxzVHJhbnNwb3J0LnN0YXRlXSsrO1xuICAgICAgfVxuICAgIH0pO1xuICAgIC8vIElDRVRyYW5zcG9ydC5jb21wbGV0ZWQgYW5kIGNvbm5lY3RlZCBhcmUgdGhlIHNhbWUgZm9yIHRoaXMgcHVycG9zZS5cbiAgICBzdGF0ZXMuY29ubmVjdGVkICs9IHN0YXRlcy5jb21wbGV0ZWQ7XG5cbiAgICBuZXdTdGF0ZSA9ICduZXcnO1xuICAgIGlmIChzdGF0ZXMuZmFpbGVkID4gMCkge1xuICAgICAgbmV3U3RhdGUgPSAnZmFpbGVkJztcbiAgICB9IGVsc2UgaWYgKHN0YXRlcy5jb25uZWN0aW5nID4gMCkge1xuICAgICAgbmV3U3RhdGUgPSAnY29ubmVjdGluZyc7XG4gICAgfSBlbHNlIGlmIChzdGF0ZXMuZGlzY29ubmVjdGVkID4gMCkge1xuICAgICAgbmV3U3RhdGUgPSAnZGlzY29ubmVjdGVkJztcbiAgICB9IGVsc2UgaWYgKHN0YXRlcy5uZXcgPiAwKSB7XG4gICAgICBuZXdTdGF0ZSA9ICduZXcnO1xuICAgIH0gZWxzZSBpZiAoc3RhdGVzLmNvbm5lY3RlZCA+IDApIHtcbiAgICAgIG5ld1N0YXRlID0gJ2Nvbm5lY3RlZCc7XG4gICAgfVxuXG4gICAgaWYgKG5ld1N0YXRlICE9PSB0aGlzLmNvbm5lY3Rpb25TdGF0ZSkge1xuICAgICAgdGhpcy5jb25uZWN0aW9uU3RhdGUgPSBuZXdTdGF0ZTtcbiAgICAgIHZhciBldmVudCA9IG5ldyBFdmVudCgnY29ubmVjdGlvbnN0YXRlY2hhbmdlJyk7XG4gICAgICB0aGlzLl9kaXNwYXRjaEV2ZW50KCdjb25uZWN0aW9uc3RhdGVjaGFuZ2UnLCBldmVudCk7XG4gICAgfVxuICB9O1xuXG4gIFJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5jcmVhdGVPZmZlciA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBwYyA9IHRoaXM7XG5cbiAgICBpZiAocGMuX2lzQ2xvc2VkKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobWFrZUVycm9yKCdJbnZhbGlkU3RhdGVFcnJvcicsXG4gICAgICAgICAgJ0NhbiBub3QgY2FsbCBjcmVhdGVPZmZlciBhZnRlciBjbG9zZScpKTtcbiAgICB9XG5cbiAgICB2YXIgbnVtQXVkaW9UcmFja3MgPSBwYy50cmFuc2NlaXZlcnMuZmlsdGVyKGZ1bmN0aW9uKHQpIHtcbiAgICAgIHJldHVybiB0LmtpbmQgPT09ICdhdWRpbyc7XG4gICAgfSkubGVuZ3RoO1xuICAgIHZhciBudW1WaWRlb1RyYWNrcyA9IHBjLnRyYW5zY2VpdmVycy5maWx0ZXIoZnVuY3Rpb24odCkge1xuICAgICAgcmV0dXJuIHQua2luZCA9PT0gJ3ZpZGVvJztcbiAgICB9KS5sZW5ndGg7XG5cbiAgICAvLyBEZXRlcm1pbmUgbnVtYmVyIG9mIGF1ZGlvIGFuZCB2aWRlbyB0cmFja3Mgd2UgbmVlZCB0byBzZW5kL3JlY3YuXG4gICAgdmFyIG9mZmVyT3B0aW9ucyA9IGFyZ3VtZW50c1swXTtcbiAgICBpZiAob2ZmZXJPcHRpb25zKSB7XG4gICAgICAvLyBSZWplY3QgQ2hyb21lIGxlZ2FjeSBjb25zdHJhaW50cy5cbiAgICAgIGlmIChvZmZlck9wdGlvbnMubWFuZGF0b3J5IHx8IG9mZmVyT3B0aW9ucy5vcHRpb25hbCkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFxuICAgICAgICAgICAgJ0xlZ2FjeSBtYW5kYXRvcnkvb3B0aW9uYWwgY29uc3RyYWludHMgbm90IHN1cHBvcnRlZC4nKTtcbiAgICAgIH1cbiAgICAgIGlmIChvZmZlck9wdGlvbnMub2ZmZXJUb1JlY2VpdmVBdWRpbyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGlmIChvZmZlck9wdGlvbnMub2ZmZXJUb1JlY2VpdmVBdWRpbyA9PT0gdHJ1ZSkge1xuICAgICAgICAgIG51bUF1ZGlvVHJhY2tzID0gMTtcbiAgICAgICAgfSBlbHNlIGlmIChvZmZlck9wdGlvbnMub2ZmZXJUb1JlY2VpdmVBdWRpbyA9PT0gZmFsc2UpIHtcbiAgICAgICAgICBudW1BdWRpb1RyYWNrcyA9IDA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbnVtQXVkaW9UcmFja3MgPSBvZmZlck9wdGlvbnMub2ZmZXJUb1JlY2VpdmVBdWRpbztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKG9mZmVyT3B0aW9ucy5vZmZlclRvUmVjZWl2ZVZpZGVvICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgaWYgKG9mZmVyT3B0aW9ucy5vZmZlclRvUmVjZWl2ZVZpZGVvID09PSB0cnVlKSB7XG4gICAgICAgICAgbnVtVmlkZW9UcmFja3MgPSAxO1xuICAgICAgICB9IGVsc2UgaWYgKG9mZmVyT3B0aW9ucy5vZmZlclRvUmVjZWl2ZVZpZGVvID09PSBmYWxzZSkge1xuICAgICAgICAgIG51bVZpZGVvVHJhY2tzID0gMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBudW1WaWRlb1RyYWNrcyA9IG9mZmVyT3B0aW9ucy5vZmZlclRvUmVjZWl2ZVZpZGVvO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcGMudHJhbnNjZWl2ZXJzLmZvckVhY2goZnVuY3Rpb24odHJhbnNjZWl2ZXIpIHtcbiAgICAgIGlmICh0cmFuc2NlaXZlci5raW5kID09PSAnYXVkaW8nKSB7XG4gICAgICAgIG51bUF1ZGlvVHJhY2tzLS07XG4gICAgICAgIGlmIChudW1BdWRpb1RyYWNrcyA8IDApIHtcbiAgICAgICAgICB0cmFuc2NlaXZlci53YW50UmVjZWl2ZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHRyYW5zY2VpdmVyLmtpbmQgPT09ICd2aWRlbycpIHtcbiAgICAgICAgbnVtVmlkZW9UcmFja3MtLTtcbiAgICAgICAgaWYgKG51bVZpZGVvVHJhY2tzIDwgMCkge1xuICAgICAgICAgIHRyYW5zY2VpdmVyLndhbnRSZWNlaXZlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIENyZWF0ZSBNLWxpbmVzIGZvciByZWN2b25seSBzdHJlYW1zLlxuICAgIHdoaWxlIChudW1BdWRpb1RyYWNrcyA+IDAgfHwgbnVtVmlkZW9UcmFja3MgPiAwKSB7XG4gICAgICBpZiAobnVtQXVkaW9UcmFja3MgPiAwKSB7XG4gICAgICAgIHBjLl9jcmVhdGVUcmFuc2NlaXZlcignYXVkaW8nKTtcbiAgICAgICAgbnVtQXVkaW9UcmFja3MtLTtcbiAgICAgIH1cbiAgICAgIGlmIChudW1WaWRlb1RyYWNrcyA+IDApIHtcbiAgICAgICAgcGMuX2NyZWF0ZVRyYW5zY2VpdmVyKCd2aWRlbycpO1xuICAgICAgICBudW1WaWRlb1RyYWNrcy0tO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBzZHAgPSBTRFBVdGlscy53cml0ZVNlc3Npb25Cb2lsZXJwbGF0ZShwYy5fc2RwU2Vzc2lvbklkLFxuICAgICAgICBwYy5fc2RwU2Vzc2lvblZlcnNpb24rKyk7XG4gICAgcGMudHJhbnNjZWl2ZXJzLmZvckVhY2goZnVuY3Rpb24odHJhbnNjZWl2ZXIsIHNkcE1MaW5lSW5kZXgpIHtcbiAgICAgIC8vIEZvciBlYWNoIHRyYWNrLCBjcmVhdGUgYW4gaWNlIGdhdGhlcmVyLCBpY2UgdHJhbnNwb3J0LFxuICAgICAgLy8gZHRscyB0cmFuc3BvcnQsIHBvdGVudGlhbGx5IHJ0cHNlbmRlciBhbmQgcnRwcmVjZWl2ZXIuXG4gICAgICB2YXIgdHJhY2sgPSB0cmFuc2NlaXZlci50cmFjaztcbiAgICAgIHZhciBraW5kID0gdHJhbnNjZWl2ZXIua2luZDtcbiAgICAgIHZhciBtaWQgPSB0cmFuc2NlaXZlci5taWQgfHwgU0RQVXRpbHMuZ2VuZXJhdGVJZGVudGlmaWVyKCk7XG4gICAgICB0cmFuc2NlaXZlci5taWQgPSBtaWQ7XG5cbiAgICAgIGlmICghdHJhbnNjZWl2ZXIuaWNlR2F0aGVyZXIpIHtcbiAgICAgICAgdHJhbnNjZWl2ZXIuaWNlR2F0aGVyZXIgPSBwYy5fY3JlYXRlSWNlR2F0aGVyZXIoc2RwTUxpbmVJbmRleCxcbiAgICAgICAgICAgIHBjLnVzaW5nQnVuZGxlKTtcbiAgICAgIH1cblxuICAgICAgdmFyIGxvY2FsQ2FwYWJpbGl0aWVzID0gd2luZG93LlJUQ1J0cFNlbmRlci5nZXRDYXBhYmlsaXRpZXMoa2luZCk7XG4gICAgICAvLyBmaWx0ZXIgUlRYIHVudGlsIGFkZGl0aW9uYWwgc3R1ZmYgbmVlZGVkIGZvciBSVFggaXMgaW1wbGVtZW50ZWRcbiAgICAgIC8vIGluIGFkYXB0ZXIuanNcbiAgICAgIGlmIChlZGdlVmVyc2lvbiA8IDE1MDE5KSB7XG4gICAgICAgIGxvY2FsQ2FwYWJpbGl0aWVzLmNvZGVjcyA9IGxvY2FsQ2FwYWJpbGl0aWVzLmNvZGVjcy5maWx0ZXIoXG4gICAgICAgICAgICBmdW5jdGlvbihjb2RlYykge1xuICAgICAgICAgICAgICByZXR1cm4gY29kZWMubmFtZSAhPT0gJ3J0eCc7XG4gICAgICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGxvY2FsQ2FwYWJpbGl0aWVzLmNvZGVjcy5mb3JFYWNoKGZ1bmN0aW9uKGNvZGVjKSB7XG4gICAgICAgIC8vIHdvcmsgYXJvdW5kIGh0dHBzOi8vYnVncy5jaHJvbWl1bS5vcmcvcC93ZWJydGMvaXNzdWVzL2RldGFpbD9pZD02NTUyXG4gICAgICAgIC8vIGJ5IGFkZGluZyBsZXZlbC1hc3ltbWV0cnktYWxsb3dlZD0xXG4gICAgICAgIGlmIChjb2RlYy5uYW1lID09PSAnSDI2NCcgJiZcbiAgICAgICAgICAgIGNvZGVjLnBhcmFtZXRlcnNbJ2xldmVsLWFzeW1tZXRyeS1hbGxvd2VkJ10gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGNvZGVjLnBhcmFtZXRlcnNbJ2xldmVsLWFzeW1tZXRyeS1hbGxvd2VkJ10gPSAnMSc7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBmb3Igc3Vic2VxdWVudCBvZmZlcnMsIHdlIG1pZ2h0IGhhdmUgdG8gcmUtdXNlIHRoZSBwYXlsb2FkXG4gICAgICAgIC8vIHR5cGUgb2YgdGhlIGxhc3Qgb2ZmZXIuXG4gICAgICAgIGlmICh0cmFuc2NlaXZlci5yZW1vdGVDYXBhYmlsaXRpZXMgJiZcbiAgICAgICAgICAgIHRyYW5zY2VpdmVyLnJlbW90ZUNhcGFiaWxpdGllcy5jb2RlY3MpIHtcbiAgICAgICAgICB0cmFuc2NlaXZlci5yZW1vdGVDYXBhYmlsaXRpZXMuY29kZWNzLmZvckVhY2goZnVuY3Rpb24ocmVtb3RlQ29kZWMpIHtcbiAgICAgICAgICAgIGlmIChjb2RlYy5uYW1lLnRvTG93ZXJDYXNlKCkgPT09IHJlbW90ZUNvZGVjLm5hbWUudG9Mb3dlckNhc2UoKSAmJlxuICAgICAgICAgICAgICAgIGNvZGVjLmNsb2NrUmF0ZSA9PT0gcmVtb3RlQ29kZWMuY2xvY2tSYXRlKSB7XG4gICAgICAgICAgICAgIGNvZGVjLnByZWZlcnJlZFBheWxvYWRUeXBlID0gcmVtb3RlQ29kZWMucGF5bG9hZFR5cGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgbG9jYWxDYXBhYmlsaXRpZXMuaGVhZGVyRXh0ZW5zaW9ucy5mb3JFYWNoKGZ1bmN0aW9uKGhkckV4dCkge1xuICAgICAgICB2YXIgcmVtb3RlRXh0ZW5zaW9ucyA9IHRyYW5zY2VpdmVyLnJlbW90ZUNhcGFiaWxpdGllcyAmJlxuICAgICAgICAgICAgdHJhbnNjZWl2ZXIucmVtb3RlQ2FwYWJpbGl0aWVzLmhlYWRlckV4dGVuc2lvbnMgfHwgW107XG4gICAgICAgIHJlbW90ZUV4dGVuc2lvbnMuZm9yRWFjaChmdW5jdGlvbihySGRyRXh0KSB7XG4gICAgICAgICAgaWYgKGhkckV4dC51cmkgPT09IHJIZHJFeHQudXJpKSB7XG4gICAgICAgICAgICBoZHJFeHQuaWQgPSBySGRyRXh0LmlkO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgLy8gZ2VuZXJhdGUgYW4gc3NyYyBub3csIHRvIGJlIHVzZWQgbGF0ZXIgaW4gcnRwU2VuZGVyLnNlbmRcbiAgICAgIHZhciBzZW5kRW5jb2RpbmdQYXJhbWV0ZXJzID0gdHJhbnNjZWl2ZXIuc2VuZEVuY29kaW5nUGFyYW1ldGVycyB8fCBbe1xuICAgICAgICBzc3JjOiAoMiAqIHNkcE1MaW5lSW5kZXggKyAxKSAqIDEwMDFcbiAgICAgIH1dO1xuICAgICAgaWYgKHRyYWNrKSB7XG4gICAgICAgIC8vIGFkZCBSVFhcbiAgICAgICAgaWYgKGVkZ2VWZXJzaW9uID49IDE1MDE5ICYmIGtpbmQgPT09ICd2aWRlbycgJiZcbiAgICAgICAgICAgICFzZW5kRW5jb2RpbmdQYXJhbWV0ZXJzWzBdLnJ0eCkge1xuICAgICAgICAgIHNlbmRFbmNvZGluZ1BhcmFtZXRlcnNbMF0ucnR4ID0ge1xuICAgICAgICAgICAgc3NyYzogc2VuZEVuY29kaW5nUGFyYW1ldGVyc1swXS5zc3JjICsgMVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKHRyYW5zY2VpdmVyLndhbnRSZWNlaXZlKSB7XG4gICAgICAgIHRyYW5zY2VpdmVyLnJ0cFJlY2VpdmVyID0gbmV3IHdpbmRvdy5SVENSdHBSZWNlaXZlcihcbiAgICAgICAgICAgIHRyYW5zY2VpdmVyLmR0bHNUcmFuc3BvcnQsIGtpbmQpO1xuICAgICAgfVxuXG4gICAgICB0cmFuc2NlaXZlci5sb2NhbENhcGFiaWxpdGllcyA9IGxvY2FsQ2FwYWJpbGl0aWVzO1xuICAgICAgdHJhbnNjZWl2ZXIuc2VuZEVuY29kaW5nUGFyYW1ldGVycyA9IHNlbmRFbmNvZGluZ1BhcmFtZXRlcnM7XG4gICAgfSk7XG5cbiAgICAvLyBhbHdheXMgb2ZmZXIgQlVORExFIGFuZCBkaXNwb3NlIG9uIHJldHVybiBpZiBub3Qgc3VwcG9ydGVkLlxuICAgIGlmIChwYy5fY29uZmlnLmJ1bmRsZVBvbGljeSAhPT0gJ21heC1jb21wYXQnKSB7XG4gICAgICBzZHAgKz0gJ2E9Z3JvdXA6QlVORExFICcgKyBwYy50cmFuc2NlaXZlcnMubWFwKGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgcmV0dXJuIHQubWlkO1xuICAgICAgfSkuam9pbignICcpICsgJ1xcclxcbic7XG4gICAgfVxuICAgIHNkcCArPSAnYT1pY2Utb3B0aW9uczp0cmlja2xlXFxyXFxuJztcblxuICAgIHBjLnRyYW5zY2VpdmVycy5mb3JFYWNoKGZ1bmN0aW9uKHRyYW5zY2VpdmVyLCBzZHBNTGluZUluZGV4KSB7XG4gICAgICBzZHAgKz0gd3JpdGVNZWRpYVNlY3Rpb24odHJhbnNjZWl2ZXIsIHRyYW5zY2VpdmVyLmxvY2FsQ2FwYWJpbGl0aWVzLFxuICAgICAgICAgICdvZmZlcicsIHRyYW5zY2VpdmVyLnN0cmVhbSwgcGMuX2R0bHNSb2xlKTtcbiAgICAgIHNkcCArPSAnYT1ydGNwLXJzaXplXFxyXFxuJztcblxuICAgICAgaWYgKHRyYW5zY2VpdmVyLmljZUdhdGhlcmVyICYmIHBjLmljZUdhdGhlcmluZ1N0YXRlICE9PSAnbmV3JyAmJlxuICAgICAgICAgIChzZHBNTGluZUluZGV4ID09PSAwIHx8ICFwYy51c2luZ0J1bmRsZSkpIHtcbiAgICAgICAgdHJhbnNjZWl2ZXIuaWNlR2F0aGVyZXIuZ2V0TG9jYWxDYW5kaWRhdGVzKCkuZm9yRWFjaChmdW5jdGlvbihjYW5kKSB7XG4gICAgICAgICAgY2FuZC5jb21wb25lbnQgPSAxO1xuICAgICAgICAgIHNkcCArPSAnYT0nICsgU0RQVXRpbHMud3JpdGVDYW5kaWRhdGUoY2FuZCkgKyAnXFxyXFxuJztcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHRyYW5zY2VpdmVyLmljZUdhdGhlcmVyLnN0YXRlID09PSAnY29tcGxldGVkJykge1xuICAgICAgICAgIHNkcCArPSAnYT1lbmQtb2YtY2FuZGlkYXRlc1xcclxcbic7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHZhciBkZXNjID0gbmV3IHdpbmRvdy5SVENTZXNzaW9uRGVzY3JpcHRpb24oe1xuICAgICAgdHlwZTogJ29mZmVyJyxcbiAgICAgIHNkcDogc2RwXG4gICAgfSk7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShkZXNjKTtcbiAgfTtcblxuICBSVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuY3JlYXRlQW5zd2VyID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHBjID0gdGhpcztcblxuICAgIGlmIChwYy5faXNDbG9zZWQpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChtYWtlRXJyb3IoJ0ludmFsaWRTdGF0ZUVycm9yJyxcbiAgICAgICAgICAnQ2FuIG5vdCBjYWxsIGNyZWF0ZUFuc3dlciBhZnRlciBjbG9zZScpKTtcbiAgICB9XG5cbiAgICBpZiAoIShwYy5zaWduYWxpbmdTdGF0ZSA9PT0gJ2hhdmUtcmVtb3RlLW9mZmVyJyB8fFxuICAgICAgICBwYy5zaWduYWxpbmdTdGF0ZSA9PT0gJ2hhdmUtbG9jYWwtcHJhbnN3ZXInKSkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG1ha2VFcnJvcignSW52YWxpZFN0YXRlRXJyb3InLFxuICAgICAgICAgICdDYW4gbm90IGNhbGwgY3JlYXRlQW5zd2VyIGluIHNpZ25hbGluZ1N0YXRlICcgKyBwYy5zaWduYWxpbmdTdGF0ZSkpO1xuICAgIH1cblxuICAgIHZhciBzZHAgPSBTRFBVdGlscy53cml0ZVNlc3Npb25Cb2lsZXJwbGF0ZShwYy5fc2RwU2Vzc2lvbklkLFxuICAgICAgICBwYy5fc2RwU2Vzc2lvblZlcnNpb24rKyk7XG4gICAgaWYgKHBjLnVzaW5nQnVuZGxlKSB7XG4gICAgICBzZHAgKz0gJ2E9Z3JvdXA6QlVORExFICcgKyBwYy50cmFuc2NlaXZlcnMubWFwKGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgcmV0dXJuIHQubWlkO1xuICAgICAgfSkuam9pbignICcpICsgJ1xcclxcbic7XG4gICAgfVxuICAgIHNkcCArPSAnYT1pY2Utb3B0aW9uczp0cmlja2xlXFxyXFxuJztcblxuICAgIHZhciBtZWRpYVNlY3Rpb25zSW5PZmZlciA9IFNEUFV0aWxzLmdldE1lZGlhU2VjdGlvbnMoXG4gICAgICAgIHBjLl9yZW1vdGVEZXNjcmlwdGlvbi5zZHApLmxlbmd0aDtcbiAgICBwYy50cmFuc2NlaXZlcnMuZm9yRWFjaChmdW5jdGlvbih0cmFuc2NlaXZlciwgc2RwTUxpbmVJbmRleCkge1xuICAgICAgaWYgKHNkcE1MaW5lSW5kZXggKyAxID4gbWVkaWFTZWN0aW9uc0luT2ZmZXIpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKHRyYW5zY2VpdmVyLnJlamVjdGVkKSB7XG4gICAgICAgIGlmICh0cmFuc2NlaXZlci5raW5kID09PSAnYXBwbGljYXRpb24nKSB7XG4gICAgICAgICAgaWYgKHRyYW5zY2VpdmVyLnByb3RvY29sID09PSAnRFRMUy9TQ1RQJykgeyAvLyBsZWdhY3kgZm10XG4gICAgICAgICAgICBzZHAgKz0gJ209YXBwbGljYXRpb24gMCBEVExTL1NDVFAgNTAwMFxcclxcbic7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNkcCArPSAnbT1hcHBsaWNhdGlvbiAwICcgKyB0cmFuc2NlaXZlci5wcm90b2NvbCArXG4gICAgICAgICAgICAgICAgJyB3ZWJydGMtZGF0YWNoYW5uZWxcXHJcXG4nO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0cmFuc2NlaXZlci5raW5kID09PSAnYXVkaW8nKSB7XG4gICAgICAgICAgc2RwICs9ICdtPWF1ZGlvIDAgVURQL1RMUy9SVFAvU0FWUEYgMFxcclxcbicgK1xuICAgICAgICAgICAgICAnYT1ydHBtYXA6MCBQQ01VLzgwMDBcXHJcXG4nO1xuICAgICAgICB9IGVsc2UgaWYgKHRyYW5zY2VpdmVyLmtpbmQgPT09ICd2aWRlbycpIHtcbiAgICAgICAgICBzZHAgKz0gJ209dmlkZW8gMCBVRFAvVExTL1JUUC9TQVZQRiAxMjBcXHJcXG4nICtcbiAgICAgICAgICAgICAgJ2E9cnRwbWFwOjEyMCBWUDgvOTAwMDBcXHJcXG4nO1xuICAgICAgICB9XG4gICAgICAgIHNkcCArPSAnYz1JTiBJUDQgMC4wLjAuMFxcclxcbicgK1xuICAgICAgICAgICAgJ2E9aW5hY3RpdmVcXHJcXG4nICtcbiAgICAgICAgICAgICdhPW1pZDonICsgdHJhbnNjZWl2ZXIubWlkICsgJ1xcclxcbic7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gRklYTUU6IGxvb2sgYXQgZGlyZWN0aW9uLlxuICAgICAgaWYgKHRyYW5zY2VpdmVyLnN0cmVhbSkge1xuICAgICAgICB2YXIgbG9jYWxUcmFjaztcbiAgICAgICAgaWYgKHRyYW5zY2VpdmVyLmtpbmQgPT09ICdhdWRpbycpIHtcbiAgICAgICAgICBsb2NhbFRyYWNrID0gdHJhbnNjZWl2ZXIuc3RyZWFtLmdldEF1ZGlvVHJhY2tzKClbMF07XG4gICAgICAgIH0gZWxzZSBpZiAodHJhbnNjZWl2ZXIua2luZCA9PT0gJ3ZpZGVvJykge1xuICAgICAgICAgIGxvY2FsVHJhY2sgPSB0cmFuc2NlaXZlci5zdHJlYW0uZ2V0VmlkZW9UcmFja3MoKVswXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobG9jYWxUcmFjaykge1xuICAgICAgICAgIC8vIGFkZCBSVFhcbiAgICAgICAgICBpZiAoZWRnZVZlcnNpb24gPj0gMTUwMTkgJiYgdHJhbnNjZWl2ZXIua2luZCA9PT0gJ3ZpZGVvJyAmJlxuICAgICAgICAgICAgICAhdHJhbnNjZWl2ZXIuc2VuZEVuY29kaW5nUGFyYW1ldGVyc1swXS5ydHgpIHtcbiAgICAgICAgICAgIHRyYW5zY2VpdmVyLnNlbmRFbmNvZGluZ1BhcmFtZXRlcnNbMF0ucnR4ID0ge1xuICAgICAgICAgICAgICBzc3JjOiB0cmFuc2NlaXZlci5zZW5kRW5jb2RpbmdQYXJhbWV0ZXJzWzBdLnNzcmMgKyAxXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBDYWxjdWxhdGUgaW50ZXJzZWN0aW9uIG9mIGNhcGFiaWxpdGllcy5cbiAgICAgIHZhciBjb21tb25DYXBhYmlsaXRpZXMgPSBnZXRDb21tb25DYXBhYmlsaXRpZXMoXG4gICAgICAgICAgdHJhbnNjZWl2ZXIubG9jYWxDYXBhYmlsaXRpZXMsXG4gICAgICAgICAgdHJhbnNjZWl2ZXIucmVtb3RlQ2FwYWJpbGl0aWVzKTtcblxuICAgICAgdmFyIGhhc1J0eCA9IGNvbW1vbkNhcGFiaWxpdGllcy5jb2RlY3MuZmlsdGVyKGZ1bmN0aW9uKGMpIHtcbiAgICAgICAgcmV0dXJuIGMubmFtZS50b0xvd2VyQ2FzZSgpID09PSAncnR4JztcbiAgICAgIH0pLmxlbmd0aDtcbiAgICAgIGlmICghaGFzUnR4ICYmIHRyYW5zY2VpdmVyLnNlbmRFbmNvZGluZ1BhcmFtZXRlcnNbMF0ucnR4KSB7XG4gICAgICAgIGRlbGV0ZSB0cmFuc2NlaXZlci5zZW5kRW5jb2RpbmdQYXJhbWV0ZXJzWzBdLnJ0eDtcbiAgICAgIH1cblxuICAgICAgc2RwICs9IHdyaXRlTWVkaWFTZWN0aW9uKHRyYW5zY2VpdmVyLCBjb21tb25DYXBhYmlsaXRpZXMsXG4gICAgICAgICAgJ2Fuc3dlcicsIHRyYW5zY2VpdmVyLnN0cmVhbSwgcGMuX2R0bHNSb2xlKTtcbiAgICAgIGlmICh0cmFuc2NlaXZlci5ydGNwUGFyYW1ldGVycyAmJlxuICAgICAgICAgIHRyYW5zY2VpdmVyLnJ0Y3BQYXJhbWV0ZXJzLnJlZHVjZWRTaXplKSB7XG4gICAgICAgIHNkcCArPSAnYT1ydGNwLXJzaXplXFxyXFxuJztcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHZhciBkZXNjID0gbmV3IHdpbmRvdy5SVENTZXNzaW9uRGVzY3JpcHRpb24oe1xuICAgICAgdHlwZTogJ2Fuc3dlcicsXG4gICAgICBzZHA6IHNkcFxuICAgIH0pO1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZGVzYyk7XG4gIH07XG5cbiAgUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmFkZEljZUNhbmRpZGF0ZSA9IGZ1bmN0aW9uKGNhbmRpZGF0ZSkge1xuICAgIHZhciBwYyA9IHRoaXM7XG4gICAgdmFyIHNlY3Rpb25zO1xuICAgIGlmIChjYW5kaWRhdGUgJiYgIShjYW5kaWRhdGUuc2RwTUxpbmVJbmRleCAhPT0gdW5kZWZpbmVkIHx8XG4gICAgICAgIGNhbmRpZGF0ZS5zZHBNaWQpKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IFR5cGVFcnJvcignc2RwTUxpbmVJbmRleCBvciBzZHBNaWQgcmVxdWlyZWQnKSk7XG4gICAgfVxuXG4gICAgLy8gVE9ETzogbmVlZHMgdG8gZ28gaW50byBvcHMgcXVldWUuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgaWYgKCFwYy5fcmVtb3RlRGVzY3JpcHRpb24pIHtcbiAgICAgICAgcmV0dXJuIHJlamVjdChtYWtlRXJyb3IoJ0ludmFsaWRTdGF0ZUVycm9yJyxcbiAgICAgICAgICAgICdDYW4gbm90IGFkZCBJQ0UgY2FuZGlkYXRlIHdpdGhvdXQgYSByZW1vdGUgZGVzY3JpcHRpb24nKSk7XG4gICAgICB9IGVsc2UgaWYgKCFjYW5kaWRhdGUgfHwgY2FuZGlkYXRlLmNhbmRpZGF0ZSA9PT0gJycpIHtcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBwYy50cmFuc2NlaXZlcnMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICBpZiAocGMudHJhbnNjZWl2ZXJzW2pdLnJlamVjdGVkKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcGMudHJhbnNjZWl2ZXJzW2pdLmljZVRyYW5zcG9ydC5hZGRSZW1vdGVDYW5kaWRhdGUoe30pO1xuICAgICAgICAgIHNlY3Rpb25zID0gU0RQVXRpbHMuZ2V0TWVkaWFTZWN0aW9ucyhwYy5fcmVtb3RlRGVzY3JpcHRpb24uc2RwKTtcbiAgICAgICAgICBzZWN0aW9uc1tqXSArPSAnYT1lbmQtb2YtY2FuZGlkYXRlc1xcclxcbic7XG4gICAgICAgICAgcGMuX3JlbW90ZURlc2NyaXB0aW9uLnNkcCA9XG4gICAgICAgICAgICAgIFNEUFV0aWxzLmdldERlc2NyaXB0aW9uKHBjLl9yZW1vdGVEZXNjcmlwdGlvbi5zZHApICtcbiAgICAgICAgICAgICAgc2VjdGlvbnMuam9pbignJyk7XG4gICAgICAgICAgaWYgKHBjLnVzaW5nQnVuZGxlKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBzZHBNTGluZUluZGV4ID0gY2FuZGlkYXRlLnNkcE1MaW5lSW5kZXg7XG4gICAgICAgIGlmIChjYW5kaWRhdGUuc2RwTWlkKSB7XG4gICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYy50cmFuc2NlaXZlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChwYy50cmFuc2NlaXZlcnNbaV0ubWlkID09PSBjYW5kaWRhdGUuc2RwTWlkKSB7XG4gICAgICAgICAgICAgIHNkcE1MaW5lSW5kZXggPSBpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHRyYW5zY2VpdmVyID0gcGMudHJhbnNjZWl2ZXJzW3NkcE1MaW5lSW5kZXhdO1xuICAgICAgICBpZiAodHJhbnNjZWl2ZXIpIHtcbiAgICAgICAgICBpZiAodHJhbnNjZWl2ZXIucmVqZWN0ZWQpIHtcbiAgICAgICAgICAgIHJldHVybiByZXNvbHZlKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciBjYW5kID0gT2JqZWN0LmtleXMoY2FuZGlkYXRlLmNhbmRpZGF0ZSkubGVuZ3RoID4gMCA/XG4gICAgICAgICAgICAgIFNEUFV0aWxzLnBhcnNlQ2FuZGlkYXRlKGNhbmRpZGF0ZS5jYW5kaWRhdGUpIDoge307XG4gICAgICAgICAgLy8gSWdub3JlIENocm9tZSdzIGludmFsaWQgY2FuZGlkYXRlcyBzaW5jZSBFZGdlIGRvZXMgbm90IGxpa2UgdGhlbS5cbiAgICAgICAgICBpZiAoY2FuZC5wcm90b2NvbCA9PT0gJ3RjcCcgJiYgKGNhbmQucG9ydCA9PT0gMCB8fCBjYW5kLnBvcnQgPT09IDkpKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzb2x2ZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBJZ25vcmUgUlRDUCBjYW5kaWRhdGVzLCB3ZSBhc3N1bWUgUlRDUC1NVVguXG4gICAgICAgICAgaWYgKGNhbmQuY29tcG9uZW50ICYmIGNhbmQuY29tcG9uZW50ICE9PSAxKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzb2x2ZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvLyB3aGVuIHVzaW5nIGJ1bmRsZSwgYXZvaWQgYWRkaW5nIGNhbmRpZGF0ZXMgdG8gdGhlIHdyb25nXG4gICAgICAgICAgLy8gaWNlIHRyYW5zcG9ydC4gQW5kIGF2b2lkIGFkZGluZyBjYW5kaWRhdGVzIGFkZGVkIGluIHRoZSBTRFAuXG4gICAgICAgICAgaWYgKHNkcE1MaW5lSW5kZXggPT09IDAgfHwgKHNkcE1MaW5lSW5kZXggPiAwICYmXG4gICAgICAgICAgICAgIHRyYW5zY2VpdmVyLmljZVRyYW5zcG9ydCAhPT0gcGMudHJhbnNjZWl2ZXJzWzBdLmljZVRyYW5zcG9ydCkpIHtcbiAgICAgICAgICAgIGlmICghbWF5YmVBZGRDYW5kaWRhdGUodHJhbnNjZWl2ZXIuaWNlVHJhbnNwb3J0LCBjYW5kKSkge1xuICAgICAgICAgICAgICByZXR1cm4gcmVqZWN0KG1ha2VFcnJvcignT3BlcmF0aW9uRXJyb3InLFxuICAgICAgICAgICAgICAgICAgJ0NhbiBub3QgYWRkIElDRSBjYW5kaWRhdGUnKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gdXBkYXRlIHRoZSByZW1vdGVEZXNjcmlwdGlvbi5cbiAgICAgICAgICB2YXIgY2FuZGlkYXRlU3RyaW5nID0gY2FuZGlkYXRlLmNhbmRpZGF0ZS50cmltKCk7XG4gICAgICAgICAgaWYgKGNhbmRpZGF0ZVN0cmluZy5pbmRleE9mKCdhPScpID09PSAwKSB7XG4gICAgICAgICAgICBjYW5kaWRhdGVTdHJpbmcgPSBjYW5kaWRhdGVTdHJpbmcuc3Vic3RyKDIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBzZWN0aW9ucyA9IFNEUFV0aWxzLmdldE1lZGlhU2VjdGlvbnMocGMuX3JlbW90ZURlc2NyaXB0aW9uLnNkcCk7XG4gICAgICAgICAgc2VjdGlvbnNbc2RwTUxpbmVJbmRleF0gKz0gJ2E9JyArXG4gICAgICAgICAgICAgIChjYW5kLnR5cGUgPyBjYW5kaWRhdGVTdHJpbmcgOiAnZW5kLW9mLWNhbmRpZGF0ZXMnKVxuICAgICAgICAgICAgICArICdcXHJcXG4nO1xuICAgICAgICAgIHBjLl9yZW1vdGVEZXNjcmlwdGlvbi5zZHAgPVxuICAgICAgICAgICAgICBTRFBVdGlscy5nZXREZXNjcmlwdGlvbihwYy5fcmVtb3RlRGVzY3JpcHRpb24uc2RwKSArXG4gICAgICAgICAgICAgIHNlY3Rpb25zLmpvaW4oJycpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiByZWplY3QobWFrZUVycm9yKCdPcGVyYXRpb25FcnJvcicsXG4gICAgICAgICAgICAgICdDYW4gbm90IGFkZCBJQ0UgY2FuZGlkYXRlJykpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXNvbHZlKCk7XG4gICAgfSk7XG4gIH07XG5cbiAgUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmdldFN0YXRzID0gZnVuY3Rpb24oc2VsZWN0b3IpIHtcbiAgICBpZiAoc2VsZWN0b3IgJiYgc2VsZWN0b3IgaW5zdGFuY2VvZiB3aW5kb3cuTWVkaWFTdHJlYW1UcmFjaykge1xuICAgICAgdmFyIHNlbmRlck9yUmVjZWl2ZXIgPSBudWxsO1xuICAgICAgdGhpcy50cmFuc2NlaXZlcnMuZm9yRWFjaChmdW5jdGlvbih0cmFuc2NlaXZlcikge1xuICAgICAgICBpZiAodHJhbnNjZWl2ZXIucnRwU2VuZGVyICYmXG4gICAgICAgICAgICB0cmFuc2NlaXZlci5ydHBTZW5kZXIudHJhY2sgPT09IHNlbGVjdG9yKSB7XG4gICAgICAgICAgc2VuZGVyT3JSZWNlaXZlciA9IHRyYW5zY2VpdmVyLnJ0cFNlbmRlcjtcbiAgICAgICAgfSBlbHNlIGlmICh0cmFuc2NlaXZlci5ydHBSZWNlaXZlciAmJlxuICAgICAgICAgICAgdHJhbnNjZWl2ZXIucnRwUmVjZWl2ZXIudHJhY2sgPT09IHNlbGVjdG9yKSB7XG4gICAgICAgICAgc2VuZGVyT3JSZWNlaXZlciA9IHRyYW5zY2VpdmVyLnJ0cFJlY2VpdmVyO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGlmICghc2VuZGVyT3JSZWNlaXZlcikge1xuICAgICAgICB0aHJvdyBtYWtlRXJyb3IoJ0ludmFsaWRBY2Nlc3NFcnJvcicsICdJbnZhbGlkIHNlbGVjdG9yLicpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHNlbmRlck9yUmVjZWl2ZXIuZ2V0U3RhdHMoKTtcbiAgICB9XG5cbiAgICB2YXIgcHJvbWlzZXMgPSBbXTtcbiAgICB0aGlzLnRyYW5zY2VpdmVycy5mb3JFYWNoKGZ1bmN0aW9uKHRyYW5zY2VpdmVyKSB7XG4gICAgICBbJ3J0cFNlbmRlcicsICdydHBSZWNlaXZlcicsICdpY2VHYXRoZXJlcicsICdpY2VUcmFuc3BvcnQnLFxuICAgICAgICAgICdkdGxzVHJhbnNwb3J0J10uZm9yRWFjaChmdW5jdGlvbihtZXRob2QpIHtcbiAgICAgICAgICAgIGlmICh0cmFuc2NlaXZlclttZXRob2RdKSB7XG4gICAgICAgICAgICAgIHByb21pc2VzLnB1c2godHJhbnNjZWl2ZXJbbWV0aG9kXS5nZXRTdGF0cygpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICB9KTtcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24oYWxsU3RhdHMpIHtcbiAgICAgIHZhciByZXN1bHRzID0gbmV3IE1hcCgpO1xuICAgICAgYWxsU3RhdHMuZm9yRWFjaChmdW5jdGlvbihzdGF0cykge1xuICAgICAgICBzdGF0cy5mb3JFYWNoKGZ1bmN0aW9uKHN0YXQpIHtcbiAgICAgICAgICByZXN1bHRzLnNldChzdGF0LmlkLCBzdGF0KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH0pO1xuICB9O1xuXG4gIC8vIGZpeCBsb3ctbGV2ZWwgc3RhdCBuYW1lcyBhbmQgcmV0dXJuIE1hcCBpbnN0ZWFkIG9mIG9iamVjdC5cbiAgdmFyIG9ydGNPYmplY3RzID0gWydSVENSdHBTZW5kZXInLCAnUlRDUnRwUmVjZWl2ZXInLCAnUlRDSWNlR2F0aGVyZXInLFxuICAgICdSVENJY2VUcmFuc3BvcnQnLCAnUlRDRHRsc1RyYW5zcG9ydCddO1xuICBvcnRjT2JqZWN0cy5mb3JFYWNoKGZ1bmN0aW9uKG9ydGNPYmplY3ROYW1lKSB7XG4gICAgdmFyIG9iaiA9IHdpbmRvd1tvcnRjT2JqZWN0TmFtZV07XG4gICAgaWYgKG9iaiAmJiBvYmoucHJvdG90eXBlICYmIG9iai5wcm90b3R5cGUuZ2V0U3RhdHMpIHtcbiAgICAgIHZhciBuYXRpdmVHZXRzdGF0cyA9IG9iai5wcm90b3R5cGUuZ2V0U3RhdHM7XG4gICAgICBvYmoucHJvdG90eXBlLmdldFN0YXRzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBuYXRpdmVHZXRzdGF0cy5hcHBseSh0aGlzKVxuICAgICAgICAudGhlbihmdW5jdGlvbihuYXRpdmVTdGF0cykge1xuICAgICAgICAgIHZhciBtYXBTdGF0cyA9IG5ldyBNYXAoKTtcbiAgICAgICAgICBPYmplY3Qua2V5cyhuYXRpdmVTdGF0cykuZm9yRWFjaChmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgbmF0aXZlU3RhdHNbaWRdLnR5cGUgPSBmaXhTdGF0c1R5cGUobmF0aXZlU3RhdHNbaWRdKTtcbiAgICAgICAgICAgIG1hcFN0YXRzLnNldChpZCwgbmF0aXZlU3RhdHNbaWRdKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gbWFwU3RhdHM7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIGxlZ2FjeSBjYWxsYmFjayBzaGltcy4gU2hvdWxkIGJlIG1vdmVkIHRvIGFkYXB0ZXIuanMgc29tZSBkYXlzLlxuICB2YXIgbWV0aG9kcyA9IFsnY3JlYXRlT2ZmZXInLCAnY3JlYXRlQW5zd2VyJ107XG4gIG1ldGhvZHMuZm9yRWFjaChmdW5jdGlvbihtZXRob2QpIHtcbiAgICB2YXIgbmF0aXZlTWV0aG9kID0gUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlW21ldGhvZF07XG4gICAgUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlW21ldGhvZF0gPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSAnZnVuY3Rpb24nIHx8XG4gICAgICAgICAgdHlwZW9mIGFyZ3NbMV0gPT09ICdmdW5jdGlvbicpIHsgLy8gbGVnYWN5XG4gICAgICAgIHJldHVybiBuYXRpdmVNZXRob2QuYXBwbHkodGhpcywgW2FyZ3VtZW50c1syXV0pXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKGRlc2NyaXB0aW9uKSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBhcmdzWzBdID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBhcmdzWzBdLmFwcGx5KG51bGwsIFtkZXNjcmlwdGlvbl0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSwgZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICBpZiAodHlwZW9mIGFyZ3NbMV0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGFyZ3NbMV0uYXBwbHkobnVsbCwgW2Vycm9yXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBuYXRpdmVNZXRob2QuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9O1xuICB9KTtcblxuICBtZXRob2RzID0gWydzZXRMb2NhbERlc2NyaXB0aW9uJywgJ3NldFJlbW90ZURlc2NyaXB0aW9uJywgJ2FkZEljZUNhbmRpZGF0ZSddO1xuICBtZXRob2RzLmZvckVhY2goZnVuY3Rpb24obWV0aG9kKSB7XG4gICAgdmFyIG5hdGl2ZU1ldGhvZCA9IFJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZVttZXRob2RdO1xuICAgIFJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZVttZXRob2RdID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgIGlmICh0eXBlb2YgYXJnc1sxXSA9PT0gJ2Z1bmN0aW9uJyB8fFxuICAgICAgICAgIHR5cGVvZiBhcmdzWzJdID09PSAnZnVuY3Rpb24nKSB7IC8vIGxlZ2FjeVxuICAgICAgICByZXR1cm4gbmF0aXZlTWV0aG9kLmFwcGx5KHRoaXMsIGFyZ3VtZW50cylcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBhcmdzWzFdID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBhcmdzWzFdLmFwcGx5KG51bGwpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSwgZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICBpZiAodHlwZW9mIGFyZ3NbMl0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGFyZ3NbMl0uYXBwbHkobnVsbCwgW2Vycm9yXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBuYXRpdmVNZXRob2QuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9O1xuICB9KTtcblxuICAvLyBnZXRTdGF0cyBpcyBzcGVjaWFsLiBJdCBkb2Vzbid0IGhhdmUgYSBzcGVjIGxlZ2FjeSBtZXRob2QgeWV0IHdlIHN1cHBvcnRcbiAgLy8gZ2V0U3RhdHMoc29tZXRoaW5nLCBjYikgd2l0aG91dCBlcnJvciBjYWxsYmFja3MuXG4gIFsnZ2V0U3RhdHMnXS5mb3JFYWNoKGZ1bmN0aW9uKG1ldGhvZCkge1xuICAgIHZhciBuYXRpdmVNZXRob2QgPSBSVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGVbbWV0aG9kXTtcbiAgICBSVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGVbbWV0aG9kXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICBpZiAodHlwZW9mIGFyZ3NbMV0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgcmV0dXJuIG5hdGl2ZU1ldGhvZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmICh0eXBlb2YgYXJnc1sxXSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgYXJnc1sxXS5hcHBseShudWxsKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG5hdGl2ZU1ldGhvZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIH07XG4gIH0pO1xuXG4gIHJldHVybiBSVENQZWVyQ29ubmVjdGlvbjtcbn07XG4iLCIvKiBlc2xpbnQtZW52IG5vZGUgKi9cbid1c2Ugc3RyaWN0JztcblxuLy8gU0RQIGhlbHBlcnMuXG52YXIgU0RQVXRpbHMgPSB7fTtcblxuLy8gR2VuZXJhdGUgYW4gYWxwaGFudW1lcmljIGlkZW50aWZpZXIgZm9yIGNuYW1lIG9yIG1pZHMuXG4vLyBUT0RPOiB1c2UgVVVJRHMgaW5zdGVhZD8gaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vamVkLzk4Mjg4M1xuU0RQVXRpbHMuZ2VuZXJhdGVJZGVudGlmaWVyID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgMTApO1xufTtcblxuLy8gVGhlIFJUQ1AgQ05BTUUgdXNlZCBieSBhbGwgcGVlcmNvbm5lY3Rpb25zIGZyb20gdGhlIHNhbWUgSlMuXG5TRFBVdGlscy5sb2NhbENOYW1lID0gU0RQVXRpbHMuZ2VuZXJhdGVJZGVudGlmaWVyKCk7XG5cbi8vIFNwbGl0cyBTRFAgaW50byBsaW5lcywgZGVhbGluZyB3aXRoIGJvdGggQ1JMRiBhbmQgTEYuXG5TRFBVdGlscy5zcGxpdExpbmVzID0gZnVuY3Rpb24oYmxvYikge1xuICByZXR1cm4gYmxvYi50cmltKCkuc3BsaXQoJ1xcbicpLm1hcChmdW5jdGlvbihsaW5lKSB7XG4gICAgcmV0dXJuIGxpbmUudHJpbSgpO1xuICB9KTtcbn07XG4vLyBTcGxpdHMgU0RQIGludG8gc2Vzc2lvbnBhcnQgYW5kIG1lZGlhc2VjdGlvbnMuIEVuc3VyZXMgQ1JMRi5cblNEUFV0aWxzLnNwbGl0U2VjdGlvbnMgPSBmdW5jdGlvbihibG9iKSB7XG4gIHZhciBwYXJ0cyA9IGJsb2Iuc3BsaXQoJ1xcbm09Jyk7XG4gIHJldHVybiBwYXJ0cy5tYXAoZnVuY3Rpb24ocGFydCwgaW5kZXgpIHtcbiAgICByZXR1cm4gKGluZGV4ID4gMCA/ICdtPScgKyBwYXJ0IDogcGFydCkudHJpbSgpICsgJ1xcclxcbic7XG4gIH0pO1xufTtcblxuLy8gcmV0dXJucyB0aGUgc2Vzc2lvbiBkZXNjcmlwdGlvbi5cblNEUFV0aWxzLmdldERlc2NyaXB0aW9uID0gZnVuY3Rpb24oYmxvYikge1xuICB2YXIgc2VjdGlvbnMgPSBTRFBVdGlscy5zcGxpdFNlY3Rpb25zKGJsb2IpO1xuICByZXR1cm4gc2VjdGlvbnMgJiYgc2VjdGlvbnNbMF07XG59O1xuXG4vLyByZXR1cm5zIHRoZSBpbmRpdmlkdWFsIG1lZGlhIHNlY3Rpb25zLlxuU0RQVXRpbHMuZ2V0TWVkaWFTZWN0aW9ucyA9IGZ1bmN0aW9uKGJsb2IpIHtcbiAgdmFyIHNlY3Rpb25zID0gU0RQVXRpbHMuc3BsaXRTZWN0aW9ucyhibG9iKTtcbiAgc2VjdGlvbnMuc2hpZnQoKTtcbiAgcmV0dXJuIHNlY3Rpb25zO1xufTtcblxuLy8gUmV0dXJucyBsaW5lcyB0aGF0IHN0YXJ0IHdpdGggYSBjZXJ0YWluIHByZWZpeC5cblNEUFV0aWxzLm1hdGNoUHJlZml4ID0gZnVuY3Rpb24oYmxvYiwgcHJlZml4KSB7XG4gIHJldHVybiBTRFBVdGlscy5zcGxpdExpbmVzKGJsb2IpLmZpbHRlcihmdW5jdGlvbihsaW5lKSB7XG4gICAgcmV0dXJuIGxpbmUuaW5kZXhPZihwcmVmaXgpID09PSAwO1xuICB9KTtcbn07XG5cbi8vIFBhcnNlcyBhbiBJQ0UgY2FuZGlkYXRlIGxpbmUuIFNhbXBsZSBpbnB1dDpcbi8vIGNhbmRpZGF0ZTo3MDI3ODYzNTAgMiB1ZHAgNDE4MTk5MDIgOC44LjguOCA2MDc2OSB0eXAgcmVsYXkgcmFkZHIgOC44LjguOFxuLy8gcnBvcnQgNTU5OTZcIlxuU0RQVXRpbHMucGFyc2VDYW5kaWRhdGUgPSBmdW5jdGlvbihsaW5lKSB7XG4gIHZhciBwYXJ0cztcbiAgLy8gUGFyc2UgYm90aCB2YXJpYW50cy5cbiAgaWYgKGxpbmUuaW5kZXhPZignYT1jYW5kaWRhdGU6JykgPT09IDApIHtcbiAgICBwYXJ0cyA9IGxpbmUuc3Vic3RyaW5nKDEyKS5zcGxpdCgnICcpO1xuICB9IGVsc2Uge1xuICAgIHBhcnRzID0gbGluZS5zdWJzdHJpbmcoMTApLnNwbGl0KCcgJyk7XG4gIH1cblxuICB2YXIgY2FuZGlkYXRlID0ge1xuICAgIGZvdW5kYXRpb246IHBhcnRzWzBdLFxuICAgIGNvbXBvbmVudDogcGFyc2VJbnQocGFydHNbMV0sIDEwKSxcbiAgICBwcm90b2NvbDogcGFydHNbMl0udG9Mb3dlckNhc2UoKSxcbiAgICBwcmlvcml0eTogcGFyc2VJbnQocGFydHNbM10sIDEwKSxcbiAgICBpcDogcGFydHNbNF0sXG4gICAgYWRkcmVzczogcGFydHNbNF0sIC8vIGFkZHJlc3MgaXMgYW4gYWxpYXMgZm9yIGlwLlxuICAgIHBvcnQ6IHBhcnNlSW50KHBhcnRzWzVdLCAxMCksXG4gICAgLy8gc2tpcCBwYXJ0c1s2XSA9PSAndHlwJ1xuICAgIHR5cGU6IHBhcnRzWzddXG4gIH07XG5cbiAgZm9yICh2YXIgaSA9IDg7IGkgPCBwYXJ0cy5sZW5ndGg7IGkgKz0gMikge1xuICAgIHN3aXRjaCAocGFydHNbaV0pIHtcbiAgICAgIGNhc2UgJ3JhZGRyJzpcbiAgICAgICAgY2FuZGlkYXRlLnJlbGF0ZWRBZGRyZXNzID0gcGFydHNbaSArIDFdO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3Jwb3J0JzpcbiAgICAgICAgY2FuZGlkYXRlLnJlbGF0ZWRQb3J0ID0gcGFyc2VJbnQocGFydHNbaSArIDFdLCAxMCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAndGNwdHlwZSc6XG4gICAgICAgIGNhbmRpZGF0ZS50Y3BUeXBlID0gcGFydHNbaSArIDFdO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3VmcmFnJzpcbiAgICAgICAgY2FuZGlkYXRlLnVmcmFnID0gcGFydHNbaSArIDFdOyAvLyBmb3IgYmFja3dhcmQgY29tcGFiaWxpdHkuXG4gICAgICAgIGNhbmRpZGF0ZS51c2VybmFtZUZyYWdtZW50ID0gcGFydHNbaSArIDFdO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6IC8vIGV4dGVuc2lvbiBoYW5kbGluZywgaW4gcGFydGljdWxhciB1ZnJhZ1xuICAgICAgICBjYW5kaWRhdGVbcGFydHNbaV1dID0gcGFydHNbaSArIDFdO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGNhbmRpZGF0ZTtcbn07XG5cbi8vIFRyYW5zbGF0ZXMgYSBjYW5kaWRhdGUgb2JqZWN0IGludG8gU0RQIGNhbmRpZGF0ZSBhdHRyaWJ1dGUuXG5TRFBVdGlscy53cml0ZUNhbmRpZGF0ZSA9IGZ1bmN0aW9uKGNhbmRpZGF0ZSkge1xuICB2YXIgc2RwID0gW107XG4gIHNkcC5wdXNoKGNhbmRpZGF0ZS5mb3VuZGF0aW9uKTtcbiAgc2RwLnB1c2goY2FuZGlkYXRlLmNvbXBvbmVudCk7XG4gIHNkcC5wdXNoKGNhbmRpZGF0ZS5wcm90b2NvbC50b1VwcGVyQ2FzZSgpKTtcbiAgc2RwLnB1c2goY2FuZGlkYXRlLnByaW9yaXR5KTtcbiAgc2RwLnB1c2goY2FuZGlkYXRlLmFkZHJlc3MgfHwgY2FuZGlkYXRlLmlwKTtcbiAgc2RwLnB1c2goY2FuZGlkYXRlLnBvcnQpO1xuXG4gIHZhciB0eXBlID0gY2FuZGlkYXRlLnR5cGU7XG4gIHNkcC5wdXNoKCd0eXAnKTtcbiAgc2RwLnB1c2godHlwZSk7XG4gIGlmICh0eXBlICE9PSAnaG9zdCcgJiYgY2FuZGlkYXRlLnJlbGF0ZWRBZGRyZXNzICYmXG4gICAgICBjYW5kaWRhdGUucmVsYXRlZFBvcnQpIHtcbiAgICBzZHAucHVzaCgncmFkZHInKTtcbiAgICBzZHAucHVzaChjYW5kaWRhdGUucmVsYXRlZEFkZHJlc3MpO1xuICAgIHNkcC5wdXNoKCdycG9ydCcpO1xuICAgIHNkcC5wdXNoKGNhbmRpZGF0ZS5yZWxhdGVkUG9ydCk7XG4gIH1cbiAgaWYgKGNhbmRpZGF0ZS50Y3BUeXBlICYmIGNhbmRpZGF0ZS5wcm90b2NvbC50b0xvd2VyQ2FzZSgpID09PSAndGNwJykge1xuICAgIHNkcC5wdXNoKCd0Y3B0eXBlJyk7XG4gICAgc2RwLnB1c2goY2FuZGlkYXRlLnRjcFR5cGUpO1xuICB9XG4gIGlmIChjYW5kaWRhdGUudXNlcm5hbWVGcmFnbWVudCB8fCBjYW5kaWRhdGUudWZyYWcpIHtcbiAgICBzZHAucHVzaCgndWZyYWcnKTtcbiAgICBzZHAucHVzaChjYW5kaWRhdGUudXNlcm5hbWVGcmFnbWVudCB8fCBjYW5kaWRhdGUudWZyYWcpO1xuICB9XG4gIHJldHVybiAnY2FuZGlkYXRlOicgKyBzZHAuam9pbignICcpO1xufTtcblxuLy8gUGFyc2VzIGFuIGljZS1vcHRpb25zIGxpbmUsIHJldHVybnMgYW4gYXJyYXkgb2Ygb3B0aW9uIHRhZ3MuXG4vLyBhPWljZS1vcHRpb25zOmZvbyBiYXJcblNEUFV0aWxzLnBhcnNlSWNlT3B0aW9ucyA9IGZ1bmN0aW9uKGxpbmUpIHtcbiAgcmV0dXJuIGxpbmUuc3Vic3RyKDE0KS5zcGxpdCgnICcpO1xufTtcblxuLy8gUGFyc2VzIGFuIHJ0cG1hcCBsaW5lLCByZXR1cm5zIFJUQ1J0cENvZGRlY1BhcmFtZXRlcnMuIFNhbXBsZSBpbnB1dDpcbi8vIGE9cnRwbWFwOjExMSBvcHVzLzQ4MDAwLzJcblNEUFV0aWxzLnBhcnNlUnRwTWFwID0gZnVuY3Rpb24obGluZSkge1xuICB2YXIgcGFydHMgPSBsaW5lLnN1YnN0cig5KS5zcGxpdCgnICcpO1xuICB2YXIgcGFyc2VkID0ge1xuICAgIHBheWxvYWRUeXBlOiBwYXJzZUludChwYXJ0cy5zaGlmdCgpLCAxMCkgLy8gd2FzOiBpZFxuICB9O1xuXG4gIHBhcnRzID0gcGFydHNbMF0uc3BsaXQoJy8nKTtcblxuICBwYXJzZWQubmFtZSA9IHBhcnRzWzBdO1xuICBwYXJzZWQuY2xvY2tSYXRlID0gcGFyc2VJbnQocGFydHNbMV0sIDEwKTsgLy8gd2FzOiBjbG9ja3JhdGVcbiAgcGFyc2VkLmNoYW5uZWxzID0gcGFydHMubGVuZ3RoID09PSAzID8gcGFyc2VJbnQocGFydHNbMl0sIDEwKSA6IDE7XG4gIC8vIGxlZ2FjeSBhbGlhcywgZ290IHJlbmFtZWQgYmFjayB0byBjaGFubmVscyBpbiBPUlRDLlxuICBwYXJzZWQubnVtQ2hhbm5lbHMgPSBwYXJzZWQuY2hhbm5lbHM7XG4gIHJldHVybiBwYXJzZWQ7XG59O1xuXG4vLyBHZW5lcmF0ZSBhbiBhPXJ0cG1hcCBsaW5lIGZyb20gUlRDUnRwQ29kZWNDYXBhYmlsaXR5IG9yXG4vLyBSVENSdHBDb2RlY1BhcmFtZXRlcnMuXG5TRFBVdGlscy53cml0ZVJ0cE1hcCA9IGZ1bmN0aW9uKGNvZGVjKSB7XG4gIHZhciBwdCA9IGNvZGVjLnBheWxvYWRUeXBlO1xuICBpZiAoY29kZWMucHJlZmVycmVkUGF5bG9hZFR5cGUgIT09IHVuZGVmaW5lZCkge1xuICAgIHB0ID0gY29kZWMucHJlZmVycmVkUGF5bG9hZFR5cGU7XG4gIH1cbiAgdmFyIGNoYW5uZWxzID0gY29kZWMuY2hhbm5lbHMgfHwgY29kZWMubnVtQ2hhbm5lbHMgfHwgMTtcbiAgcmV0dXJuICdhPXJ0cG1hcDonICsgcHQgKyAnICcgKyBjb2RlYy5uYW1lICsgJy8nICsgY29kZWMuY2xvY2tSYXRlICtcbiAgICAgIChjaGFubmVscyAhPT0gMSA/ICcvJyArIGNoYW5uZWxzIDogJycpICsgJ1xcclxcbic7XG59O1xuXG4vLyBQYXJzZXMgYW4gYT1leHRtYXAgbGluZSAoaGVhZGVyZXh0ZW5zaW9uIGZyb20gUkZDIDUyODUpLiBTYW1wbGUgaW5wdXQ6XG4vLyBhPWV4dG1hcDoyIHVybjppZXRmOnBhcmFtczpydHAtaGRyZXh0OnRvZmZzZXRcbi8vIGE9ZXh0bWFwOjIvc2VuZG9ubHkgdXJuOmlldGY6cGFyYW1zOnJ0cC1oZHJleHQ6dG9mZnNldFxuU0RQVXRpbHMucGFyc2VFeHRtYXAgPSBmdW5jdGlvbihsaW5lKSB7XG4gIHZhciBwYXJ0cyA9IGxpbmUuc3Vic3RyKDkpLnNwbGl0KCcgJyk7XG4gIHJldHVybiB7XG4gICAgaWQ6IHBhcnNlSW50KHBhcnRzWzBdLCAxMCksXG4gICAgZGlyZWN0aW9uOiBwYXJ0c1swXS5pbmRleE9mKCcvJykgPiAwID8gcGFydHNbMF0uc3BsaXQoJy8nKVsxXSA6ICdzZW5kcmVjdicsXG4gICAgdXJpOiBwYXJ0c1sxXVxuICB9O1xufTtcblxuLy8gR2VuZXJhdGVzIGE9ZXh0bWFwIGxpbmUgZnJvbSBSVENSdHBIZWFkZXJFeHRlbnNpb25QYXJhbWV0ZXJzIG9yXG4vLyBSVENSdHBIZWFkZXJFeHRlbnNpb24uXG5TRFBVdGlscy53cml0ZUV4dG1hcCA9IGZ1bmN0aW9uKGhlYWRlckV4dGVuc2lvbikge1xuICByZXR1cm4gJ2E9ZXh0bWFwOicgKyAoaGVhZGVyRXh0ZW5zaW9uLmlkIHx8IGhlYWRlckV4dGVuc2lvbi5wcmVmZXJyZWRJZCkgK1xuICAgICAgKGhlYWRlckV4dGVuc2lvbi5kaXJlY3Rpb24gJiYgaGVhZGVyRXh0ZW5zaW9uLmRpcmVjdGlvbiAhPT0gJ3NlbmRyZWN2J1xuICAgICAgICA/ICcvJyArIGhlYWRlckV4dGVuc2lvbi5kaXJlY3Rpb25cbiAgICAgICAgOiAnJykgK1xuICAgICAgJyAnICsgaGVhZGVyRXh0ZW5zaW9uLnVyaSArICdcXHJcXG4nO1xufTtcblxuLy8gUGFyc2VzIGFuIGZ0bXAgbGluZSwgcmV0dXJucyBkaWN0aW9uYXJ5LiBTYW1wbGUgaW5wdXQ6XG4vLyBhPWZtdHA6OTYgdmJyPW9uO2NuZz1vblxuLy8gQWxzbyBkZWFscyB3aXRoIHZicj1vbjsgY25nPW9uXG5TRFBVdGlscy5wYXJzZUZtdHAgPSBmdW5jdGlvbihsaW5lKSB7XG4gIHZhciBwYXJzZWQgPSB7fTtcbiAgdmFyIGt2O1xuICB2YXIgcGFydHMgPSBsaW5lLnN1YnN0cihsaW5lLmluZGV4T2YoJyAnKSArIDEpLnNwbGl0KCc7Jyk7XG4gIGZvciAodmFyIGogPSAwOyBqIDwgcGFydHMubGVuZ3RoOyBqKyspIHtcbiAgICBrdiA9IHBhcnRzW2pdLnRyaW0oKS5zcGxpdCgnPScpO1xuICAgIHBhcnNlZFtrdlswXS50cmltKCldID0ga3ZbMV07XG4gIH1cbiAgcmV0dXJuIHBhcnNlZDtcbn07XG5cbi8vIEdlbmVyYXRlcyBhbiBhPWZ0bXAgbGluZSBmcm9tIFJUQ1J0cENvZGVjQ2FwYWJpbGl0eSBvciBSVENSdHBDb2RlY1BhcmFtZXRlcnMuXG5TRFBVdGlscy53cml0ZUZtdHAgPSBmdW5jdGlvbihjb2RlYykge1xuICB2YXIgbGluZSA9ICcnO1xuICB2YXIgcHQgPSBjb2RlYy5wYXlsb2FkVHlwZTtcbiAgaWYgKGNvZGVjLnByZWZlcnJlZFBheWxvYWRUeXBlICE9PSB1bmRlZmluZWQpIHtcbiAgICBwdCA9IGNvZGVjLnByZWZlcnJlZFBheWxvYWRUeXBlO1xuICB9XG4gIGlmIChjb2RlYy5wYXJhbWV0ZXJzICYmIE9iamVjdC5rZXlzKGNvZGVjLnBhcmFtZXRlcnMpLmxlbmd0aCkge1xuICAgIHZhciBwYXJhbXMgPSBbXTtcbiAgICBPYmplY3Qua2V5cyhjb2RlYy5wYXJhbWV0ZXJzKS5mb3JFYWNoKGZ1bmN0aW9uKHBhcmFtKSB7XG4gICAgICBpZiAoY29kZWMucGFyYW1ldGVyc1twYXJhbV0pIHtcbiAgICAgICAgcGFyYW1zLnB1c2gocGFyYW0gKyAnPScgKyBjb2RlYy5wYXJhbWV0ZXJzW3BhcmFtXSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwYXJhbXMucHVzaChwYXJhbSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgbGluZSArPSAnYT1mbXRwOicgKyBwdCArICcgJyArIHBhcmFtcy5qb2luKCc7JykgKyAnXFxyXFxuJztcbiAgfVxuICByZXR1cm4gbGluZTtcbn07XG5cbi8vIFBhcnNlcyBhbiBydGNwLWZiIGxpbmUsIHJldHVybnMgUlRDUFJ0Y3BGZWVkYmFjayBvYmplY3QuIFNhbXBsZSBpbnB1dDpcbi8vIGE9cnRjcC1mYjo5OCBuYWNrIHJwc2lcblNEUFV0aWxzLnBhcnNlUnRjcEZiID0gZnVuY3Rpb24obGluZSkge1xuICB2YXIgcGFydHMgPSBsaW5lLnN1YnN0cihsaW5lLmluZGV4T2YoJyAnKSArIDEpLnNwbGl0KCcgJyk7XG4gIHJldHVybiB7XG4gICAgdHlwZTogcGFydHMuc2hpZnQoKSxcbiAgICBwYXJhbWV0ZXI6IHBhcnRzLmpvaW4oJyAnKVxuICB9O1xufTtcbi8vIEdlbmVyYXRlIGE9cnRjcC1mYiBsaW5lcyBmcm9tIFJUQ1J0cENvZGVjQ2FwYWJpbGl0eSBvciBSVENSdHBDb2RlY1BhcmFtZXRlcnMuXG5TRFBVdGlscy53cml0ZVJ0Y3BGYiA9IGZ1bmN0aW9uKGNvZGVjKSB7XG4gIHZhciBsaW5lcyA9ICcnO1xuICB2YXIgcHQgPSBjb2RlYy5wYXlsb2FkVHlwZTtcbiAgaWYgKGNvZGVjLnByZWZlcnJlZFBheWxvYWRUeXBlICE9PSB1bmRlZmluZWQpIHtcbiAgICBwdCA9IGNvZGVjLnByZWZlcnJlZFBheWxvYWRUeXBlO1xuICB9XG4gIGlmIChjb2RlYy5ydGNwRmVlZGJhY2sgJiYgY29kZWMucnRjcEZlZWRiYWNrLmxlbmd0aCkge1xuICAgIC8vIEZJWE1FOiBzcGVjaWFsIGhhbmRsaW5nIGZvciB0cnItaW50P1xuICAgIGNvZGVjLnJ0Y3BGZWVkYmFjay5mb3JFYWNoKGZ1bmN0aW9uKGZiKSB7XG4gICAgICBsaW5lcyArPSAnYT1ydGNwLWZiOicgKyBwdCArICcgJyArIGZiLnR5cGUgK1xuICAgICAgKGZiLnBhcmFtZXRlciAmJiBmYi5wYXJhbWV0ZXIubGVuZ3RoID8gJyAnICsgZmIucGFyYW1ldGVyIDogJycpICtcbiAgICAgICAgICAnXFxyXFxuJztcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gbGluZXM7XG59O1xuXG4vLyBQYXJzZXMgYW4gUkZDIDU1NzYgc3NyYyBtZWRpYSBhdHRyaWJ1dGUuIFNhbXBsZSBpbnB1dDpcbi8vIGE9c3NyYzozNzM1OTI4NTU5IGNuYW1lOnNvbWV0aGluZ1xuU0RQVXRpbHMucGFyc2VTc3JjTWVkaWEgPSBmdW5jdGlvbihsaW5lKSB7XG4gIHZhciBzcCA9IGxpbmUuaW5kZXhPZignICcpO1xuICB2YXIgcGFydHMgPSB7XG4gICAgc3NyYzogcGFyc2VJbnQobGluZS5zdWJzdHIoNywgc3AgLSA3KSwgMTApXG4gIH07XG4gIHZhciBjb2xvbiA9IGxpbmUuaW5kZXhPZignOicsIHNwKTtcbiAgaWYgKGNvbG9uID4gLTEpIHtcbiAgICBwYXJ0cy5hdHRyaWJ1dGUgPSBsaW5lLnN1YnN0cihzcCArIDEsIGNvbG9uIC0gc3AgLSAxKTtcbiAgICBwYXJ0cy52YWx1ZSA9IGxpbmUuc3Vic3RyKGNvbG9uICsgMSk7XG4gIH0gZWxzZSB7XG4gICAgcGFydHMuYXR0cmlidXRlID0gbGluZS5zdWJzdHIoc3AgKyAxKTtcbiAgfVxuICByZXR1cm4gcGFydHM7XG59O1xuXG5TRFBVdGlscy5wYXJzZVNzcmNHcm91cCA9IGZ1bmN0aW9uKGxpbmUpIHtcbiAgdmFyIHBhcnRzID0gbGluZS5zdWJzdHIoMTMpLnNwbGl0KCcgJyk7XG4gIHJldHVybiB7XG4gICAgc2VtYW50aWNzOiBwYXJ0cy5zaGlmdCgpLFxuICAgIHNzcmNzOiBwYXJ0cy5tYXAoZnVuY3Rpb24oc3NyYykge1xuICAgICAgcmV0dXJuIHBhcnNlSW50KHNzcmMsIDEwKTtcbiAgICB9KVxuICB9O1xufTtcblxuLy8gRXh0cmFjdHMgdGhlIE1JRCAoUkZDIDU4ODgpIGZyb20gYSBtZWRpYSBzZWN0aW9uLlxuLy8gcmV0dXJucyB0aGUgTUlEIG9yIHVuZGVmaW5lZCBpZiBubyBtaWQgbGluZSB3YXMgZm91bmQuXG5TRFBVdGlscy5nZXRNaWQgPSBmdW5jdGlvbihtZWRpYVNlY3Rpb24pIHtcbiAgdmFyIG1pZCA9IFNEUFV0aWxzLm1hdGNoUHJlZml4KG1lZGlhU2VjdGlvbiwgJ2E9bWlkOicpWzBdO1xuICBpZiAobWlkKSB7XG4gICAgcmV0dXJuIG1pZC5zdWJzdHIoNik7XG4gIH1cbn07XG5cblNEUFV0aWxzLnBhcnNlRmluZ2VycHJpbnQgPSBmdW5jdGlvbihsaW5lKSB7XG4gIHZhciBwYXJ0cyA9IGxpbmUuc3Vic3RyKDE0KS5zcGxpdCgnICcpO1xuICByZXR1cm4ge1xuICAgIGFsZ29yaXRobTogcGFydHNbMF0udG9Mb3dlckNhc2UoKSwgLy8gYWxnb3JpdGhtIGlzIGNhc2Utc2Vuc2l0aXZlIGluIEVkZ2UuXG4gICAgdmFsdWU6IHBhcnRzWzFdXG4gIH07XG59O1xuXG4vLyBFeHRyYWN0cyBEVExTIHBhcmFtZXRlcnMgZnJvbSBTRFAgbWVkaWEgc2VjdGlvbiBvciBzZXNzaW9ucGFydC5cbi8vIEZJWE1FOiBmb3IgY29uc2lzdGVuY3kgd2l0aCBvdGhlciBmdW5jdGlvbnMgdGhpcyBzaG91bGQgb25seVxuLy8gICBnZXQgdGhlIGZpbmdlcnByaW50IGxpbmUgYXMgaW5wdXQuIFNlZSBhbHNvIGdldEljZVBhcmFtZXRlcnMuXG5TRFBVdGlscy5nZXREdGxzUGFyYW1ldGVycyA9IGZ1bmN0aW9uKG1lZGlhU2VjdGlvbiwgc2Vzc2lvbnBhcnQpIHtcbiAgdmFyIGxpbmVzID0gU0RQVXRpbHMubWF0Y2hQcmVmaXgobWVkaWFTZWN0aW9uICsgc2Vzc2lvbnBhcnQsXG4gICAgJ2E9ZmluZ2VycHJpbnQ6Jyk7XG4gIC8vIE5vdGU6IGE9c2V0dXAgbGluZSBpcyBpZ25vcmVkIHNpbmNlIHdlIHVzZSB0aGUgJ2F1dG8nIHJvbGUuXG4gIC8vIE5vdGUyOiAnYWxnb3JpdGhtJyBpcyBub3QgY2FzZSBzZW5zaXRpdmUgZXhjZXB0IGluIEVkZ2UuXG4gIHJldHVybiB7XG4gICAgcm9sZTogJ2F1dG8nLFxuICAgIGZpbmdlcnByaW50czogbGluZXMubWFwKFNEUFV0aWxzLnBhcnNlRmluZ2VycHJpbnQpXG4gIH07XG59O1xuXG4vLyBTZXJpYWxpemVzIERUTFMgcGFyYW1ldGVycyB0byBTRFAuXG5TRFBVdGlscy53cml0ZUR0bHNQYXJhbWV0ZXJzID0gZnVuY3Rpb24ocGFyYW1zLCBzZXR1cFR5cGUpIHtcbiAgdmFyIHNkcCA9ICdhPXNldHVwOicgKyBzZXR1cFR5cGUgKyAnXFxyXFxuJztcbiAgcGFyYW1zLmZpbmdlcnByaW50cy5mb3JFYWNoKGZ1bmN0aW9uKGZwKSB7XG4gICAgc2RwICs9ICdhPWZpbmdlcnByaW50OicgKyBmcC5hbGdvcml0aG0gKyAnICcgKyBmcC52YWx1ZSArICdcXHJcXG4nO1xuICB9KTtcbiAgcmV0dXJuIHNkcDtcbn07XG5cbi8vIFBhcnNlcyBhPWNyeXB0byBsaW5lcyBpbnRvXG4vLyAgIGh0dHBzOi8vcmF3Z2l0LmNvbS9hYm9iYS9lZGdlcnRjL21hc3Rlci9tc29ydGMtcnM0Lmh0bWwjZGljdGlvbmFyeS1ydGNzcnRwc2Rlc3BhcmFtZXRlcnMtbWVtYmVyc1xuU0RQVXRpbHMucGFyc2VDcnlwdG9MaW5lID0gZnVuY3Rpb24obGluZSkge1xuICB2YXIgcGFydHMgPSBsaW5lLnN1YnN0cig5KS5zcGxpdCgnICcpO1xuICByZXR1cm4ge1xuICAgIHRhZzogcGFyc2VJbnQocGFydHNbMF0sIDEwKSxcbiAgICBjcnlwdG9TdWl0ZTogcGFydHNbMV0sXG4gICAga2V5UGFyYW1zOiBwYXJ0c1syXSxcbiAgICBzZXNzaW9uUGFyYW1zOiBwYXJ0cy5zbGljZSgzKSxcbiAgfTtcbn07XG5cblNEUFV0aWxzLndyaXRlQ3J5cHRvTGluZSA9IGZ1bmN0aW9uKHBhcmFtZXRlcnMpIHtcbiAgcmV0dXJuICdhPWNyeXB0bzonICsgcGFyYW1ldGVycy50YWcgKyAnICcgK1xuICAgIHBhcmFtZXRlcnMuY3J5cHRvU3VpdGUgKyAnICcgK1xuICAgICh0eXBlb2YgcGFyYW1ldGVycy5rZXlQYXJhbXMgPT09ICdvYmplY3QnXG4gICAgICA/IFNEUFV0aWxzLndyaXRlQ3J5cHRvS2V5UGFyYW1zKHBhcmFtZXRlcnMua2V5UGFyYW1zKVxuICAgICAgOiBwYXJhbWV0ZXJzLmtleVBhcmFtcykgK1xuICAgIChwYXJhbWV0ZXJzLnNlc3Npb25QYXJhbXMgPyAnICcgKyBwYXJhbWV0ZXJzLnNlc3Npb25QYXJhbXMuam9pbignICcpIDogJycpICtcbiAgICAnXFxyXFxuJztcbn07XG5cbi8vIFBhcnNlcyB0aGUgY3J5cHRvIGtleSBwYXJhbWV0ZXJzIGludG9cbi8vICAgaHR0cHM6Ly9yYXdnaXQuY29tL2Fib2JhL2VkZ2VydGMvbWFzdGVyL21zb3J0Yy1yczQuaHRtbCNydGNzcnRwa2V5cGFyYW0qXG5TRFBVdGlscy5wYXJzZUNyeXB0b0tleVBhcmFtcyA9IGZ1bmN0aW9uKGtleVBhcmFtcykge1xuICBpZiAoa2V5UGFyYW1zLmluZGV4T2YoJ2lubGluZTonKSAhPT0gMCkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIHZhciBwYXJ0cyA9IGtleVBhcmFtcy5zdWJzdHIoNykuc3BsaXQoJ3wnKTtcbiAgcmV0dXJuIHtcbiAgICBrZXlNZXRob2Q6ICdpbmxpbmUnLFxuICAgIGtleVNhbHQ6IHBhcnRzWzBdLFxuICAgIGxpZmVUaW1lOiBwYXJ0c1sxXSxcbiAgICBta2lWYWx1ZTogcGFydHNbMl0gPyBwYXJ0c1syXS5zcGxpdCgnOicpWzBdIDogdW5kZWZpbmVkLFxuICAgIG1raUxlbmd0aDogcGFydHNbMl0gPyBwYXJ0c1syXS5zcGxpdCgnOicpWzFdIDogdW5kZWZpbmVkLFxuICB9O1xufTtcblxuU0RQVXRpbHMud3JpdGVDcnlwdG9LZXlQYXJhbXMgPSBmdW5jdGlvbihrZXlQYXJhbXMpIHtcbiAgcmV0dXJuIGtleVBhcmFtcy5rZXlNZXRob2QgKyAnOidcbiAgICArIGtleVBhcmFtcy5rZXlTYWx0ICtcbiAgICAoa2V5UGFyYW1zLmxpZmVUaW1lID8gJ3wnICsga2V5UGFyYW1zLmxpZmVUaW1lIDogJycpICtcbiAgICAoa2V5UGFyYW1zLm1raVZhbHVlICYmIGtleVBhcmFtcy5ta2lMZW5ndGhcbiAgICAgID8gJ3wnICsga2V5UGFyYW1zLm1raVZhbHVlICsgJzonICsga2V5UGFyYW1zLm1raUxlbmd0aFxuICAgICAgOiAnJyk7XG59O1xuXG4vLyBFeHRyYWN0cyBhbGwgU0RFUyBwYXJhbXRlcnMuXG5TRFBVdGlscy5nZXRDcnlwdG9QYXJhbWV0ZXJzID0gZnVuY3Rpb24obWVkaWFTZWN0aW9uLCBzZXNzaW9ucGFydCkge1xuICB2YXIgbGluZXMgPSBTRFBVdGlscy5tYXRjaFByZWZpeChtZWRpYVNlY3Rpb24gKyBzZXNzaW9ucGFydCxcbiAgICAnYT1jcnlwdG86Jyk7XG4gIHJldHVybiBsaW5lcy5tYXAoU0RQVXRpbHMucGFyc2VDcnlwdG9MaW5lKTtcbn07XG5cbi8vIFBhcnNlcyBJQ0UgaW5mb3JtYXRpb24gZnJvbSBTRFAgbWVkaWEgc2VjdGlvbiBvciBzZXNzaW9ucGFydC5cbi8vIEZJWE1FOiBmb3IgY29uc2lzdGVuY3kgd2l0aCBvdGhlciBmdW5jdGlvbnMgdGhpcyBzaG91bGQgb25seVxuLy8gICBnZXQgdGhlIGljZS11ZnJhZyBhbmQgaWNlLXB3ZCBsaW5lcyBhcyBpbnB1dC5cblNEUFV0aWxzLmdldEljZVBhcmFtZXRlcnMgPSBmdW5jdGlvbihtZWRpYVNlY3Rpb24sIHNlc3Npb25wYXJ0KSB7XG4gIHZhciB1ZnJhZyA9IFNEUFV0aWxzLm1hdGNoUHJlZml4KG1lZGlhU2VjdGlvbiArIHNlc3Npb25wYXJ0LFxuICAgICdhPWljZS11ZnJhZzonKVswXTtcbiAgdmFyIHB3ZCA9IFNEUFV0aWxzLm1hdGNoUHJlZml4KG1lZGlhU2VjdGlvbiArIHNlc3Npb25wYXJ0LFxuICAgICdhPWljZS1wd2Q6JylbMF07XG4gIGlmICghKHVmcmFnICYmIHB3ZCkpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICByZXR1cm4ge1xuICAgIHVzZXJuYW1lRnJhZ21lbnQ6IHVmcmFnLnN1YnN0cigxMiksXG4gICAgcGFzc3dvcmQ6IHB3ZC5zdWJzdHIoMTApLFxuICB9O1xufTtcblxuLy8gU2VyaWFsaXplcyBJQ0UgcGFyYW1ldGVycyB0byBTRFAuXG5TRFBVdGlscy53cml0ZUljZVBhcmFtZXRlcnMgPSBmdW5jdGlvbihwYXJhbXMpIHtcbiAgcmV0dXJuICdhPWljZS11ZnJhZzonICsgcGFyYW1zLnVzZXJuYW1lRnJhZ21lbnQgKyAnXFxyXFxuJyArXG4gICAgICAnYT1pY2UtcHdkOicgKyBwYXJhbXMucGFzc3dvcmQgKyAnXFxyXFxuJztcbn07XG5cbi8vIFBhcnNlcyB0aGUgU0RQIG1lZGlhIHNlY3Rpb24gYW5kIHJldHVybnMgUlRDUnRwUGFyYW1ldGVycy5cblNEUFV0aWxzLnBhcnNlUnRwUGFyYW1ldGVycyA9IGZ1bmN0aW9uKG1lZGlhU2VjdGlvbikge1xuICB2YXIgZGVzY3JpcHRpb24gPSB7XG4gICAgY29kZWNzOiBbXSxcbiAgICBoZWFkZXJFeHRlbnNpb25zOiBbXSxcbiAgICBmZWNNZWNoYW5pc21zOiBbXSxcbiAgICBydGNwOiBbXVxuICB9O1xuICB2YXIgbGluZXMgPSBTRFBVdGlscy5zcGxpdExpbmVzKG1lZGlhU2VjdGlvbik7XG4gIHZhciBtbGluZSA9IGxpbmVzWzBdLnNwbGl0KCcgJyk7XG4gIGZvciAodmFyIGkgPSAzOyBpIDwgbWxpbmUubGVuZ3RoOyBpKyspIHsgLy8gZmluZCBhbGwgY29kZWNzIGZyb20gbWxpbmVbMy4uXVxuICAgIHZhciBwdCA9IG1saW5lW2ldO1xuICAgIHZhciBydHBtYXBsaW5lID0gU0RQVXRpbHMubWF0Y2hQcmVmaXgoXG4gICAgICBtZWRpYVNlY3Rpb24sICdhPXJ0cG1hcDonICsgcHQgKyAnICcpWzBdO1xuICAgIGlmIChydHBtYXBsaW5lKSB7XG4gICAgICB2YXIgY29kZWMgPSBTRFBVdGlscy5wYXJzZVJ0cE1hcChydHBtYXBsaW5lKTtcbiAgICAgIHZhciBmbXRwcyA9IFNEUFV0aWxzLm1hdGNoUHJlZml4KFxuICAgICAgICBtZWRpYVNlY3Rpb24sICdhPWZtdHA6JyArIHB0ICsgJyAnKTtcbiAgICAgIC8vIE9ubHkgdGhlIGZpcnN0IGE9Zm10cDo8cHQ+IGlzIGNvbnNpZGVyZWQuXG4gICAgICBjb2RlYy5wYXJhbWV0ZXJzID0gZm10cHMubGVuZ3RoID8gU0RQVXRpbHMucGFyc2VGbXRwKGZtdHBzWzBdKSA6IHt9O1xuICAgICAgY29kZWMucnRjcEZlZWRiYWNrID0gU0RQVXRpbHMubWF0Y2hQcmVmaXgoXG4gICAgICAgIG1lZGlhU2VjdGlvbiwgJ2E9cnRjcC1mYjonICsgcHQgKyAnICcpXG4gICAgICAgIC5tYXAoU0RQVXRpbHMucGFyc2VSdGNwRmIpO1xuICAgICAgZGVzY3JpcHRpb24uY29kZWNzLnB1c2goY29kZWMpO1xuICAgICAgLy8gcGFyc2UgRkVDIG1lY2hhbmlzbXMgZnJvbSBydHBtYXAgbGluZXMuXG4gICAgICBzd2l0Y2ggKGNvZGVjLm5hbWUudG9VcHBlckNhc2UoKSkge1xuICAgICAgICBjYXNlICdSRUQnOlxuICAgICAgICBjYXNlICdVTFBGRUMnOlxuICAgICAgICAgIGRlc2NyaXB0aW9uLmZlY01lY2hhbmlzbXMucHVzaChjb2RlYy5uYW1lLnRvVXBwZXJDYXNlKCkpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OiAvLyBvbmx5IFJFRCBhbmQgVUxQRkVDIGFyZSByZWNvZ25pemVkIGFzIEZFQyBtZWNoYW5pc21zLlxuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBTRFBVdGlscy5tYXRjaFByZWZpeChtZWRpYVNlY3Rpb24sICdhPWV4dG1hcDonKS5mb3JFYWNoKGZ1bmN0aW9uKGxpbmUpIHtcbiAgICBkZXNjcmlwdGlvbi5oZWFkZXJFeHRlbnNpb25zLnB1c2goU0RQVXRpbHMucGFyc2VFeHRtYXAobGluZSkpO1xuICB9KTtcbiAgLy8gRklYTUU6IHBhcnNlIHJ0Y3AuXG4gIHJldHVybiBkZXNjcmlwdGlvbjtcbn07XG5cbi8vIEdlbmVyYXRlcyBwYXJ0cyBvZiB0aGUgU0RQIG1lZGlhIHNlY3Rpb24gZGVzY3JpYmluZyB0aGUgY2FwYWJpbGl0aWVzIC9cbi8vIHBhcmFtZXRlcnMuXG5TRFBVdGlscy53cml0ZVJ0cERlc2NyaXB0aW9uID0gZnVuY3Rpb24oa2luZCwgY2Fwcykge1xuICB2YXIgc2RwID0gJyc7XG5cbiAgLy8gQnVpbGQgdGhlIG1saW5lLlxuICBzZHAgKz0gJ209JyArIGtpbmQgKyAnICc7XG4gIHNkcCArPSBjYXBzLmNvZGVjcy5sZW5ndGggPiAwID8gJzknIDogJzAnOyAvLyByZWplY3QgaWYgbm8gY29kZWNzLlxuICBzZHAgKz0gJyBVRFAvVExTL1JUUC9TQVZQRiAnO1xuICBzZHAgKz0gY2Fwcy5jb2RlY3MubWFwKGZ1bmN0aW9uKGNvZGVjKSB7XG4gICAgaWYgKGNvZGVjLnByZWZlcnJlZFBheWxvYWRUeXBlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiBjb2RlYy5wcmVmZXJyZWRQYXlsb2FkVHlwZTtcbiAgICB9XG4gICAgcmV0dXJuIGNvZGVjLnBheWxvYWRUeXBlO1xuICB9KS5qb2luKCcgJykgKyAnXFxyXFxuJztcblxuICBzZHAgKz0gJ2M9SU4gSVA0IDAuMC4wLjBcXHJcXG4nO1xuICBzZHAgKz0gJ2E9cnRjcDo5IElOIElQNCAwLjAuMC4wXFxyXFxuJztcblxuICAvLyBBZGQgYT1ydHBtYXAgbGluZXMgZm9yIGVhY2ggY29kZWMuIEFsc28gZm10cCBhbmQgcnRjcC1mYi5cbiAgY2Fwcy5jb2RlY3MuZm9yRWFjaChmdW5jdGlvbihjb2RlYykge1xuICAgIHNkcCArPSBTRFBVdGlscy53cml0ZVJ0cE1hcChjb2RlYyk7XG4gICAgc2RwICs9IFNEUFV0aWxzLndyaXRlRm10cChjb2RlYyk7XG4gICAgc2RwICs9IFNEUFV0aWxzLndyaXRlUnRjcEZiKGNvZGVjKTtcbiAgfSk7XG4gIHZhciBtYXhwdGltZSA9IDA7XG4gIGNhcHMuY29kZWNzLmZvckVhY2goZnVuY3Rpb24oY29kZWMpIHtcbiAgICBpZiAoY29kZWMubWF4cHRpbWUgPiBtYXhwdGltZSkge1xuICAgICAgbWF4cHRpbWUgPSBjb2RlYy5tYXhwdGltZTtcbiAgICB9XG4gIH0pO1xuICBpZiAobWF4cHRpbWUgPiAwKSB7XG4gICAgc2RwICs9ICdhPW1heHB0aW1lOicgKyBtYXhwdGltZSArICdcXHJcXG4nO1xuICB9XG4gIHNkcCArPSAnYT1ydGNwLW11eFxcclxcbic7XG5cbiAgaWYgKGNhcHMuaGVhZGVyRXh0ZW5zaW9ucykge1xuICAgIGNhcHMuaGVhZGVyRXh0ZW5zaW9ucy5mb3JFYWNoKGZ1bmN0aW9uKGV4dGVuc2lvbikge1xuICAgICAgc2RwICs9IFNEUFV0aWxzLndyaXRlRXh0bWFwKGV4dGVuc2lvbik7XG4gICAgfSk7XG4gIH1cbiAgLy8gRklYTUU6IHdyaXRlIGZlY01lY2hhbmlzbXMuXG4gIHJldHVybiBzZHA7XG59O1xuXG4vLyBQYXJzZXMgdGhlIFNEUCBtZWRpYSBzZWN0aW9uIGFuZCByZXR1cm5zIGFuIGFycmF5IG9mXG4vLyBSVENSdHBFbmNvZGluZ1BhcmFtZXRlcnMuXG5TRFBVdGlscy5wYXJzZVJ0cEVuY29kaW5nUGFyYW1ldGVycyA9IGZ1bmN0aW9uKG1lZGlhU2VjdGlvbikge1xuICB2YXIgZW5jb2RpbmdQYXJhbWV0ZXJzID0gW107XG4gIHZhciBkZXNjcmlwdGlvbiA9IFNEUFV0aWxzLnBhcnNlUnRwUGFyYW1ldGVycyhtZWRpYVNlY3Rpb24pO1xuICB2YXIgaGFzUmVkID0gZGVzY3JpcHRpb24uZmVjTWVjaGFuaXNtcy5pbmRleE9mKCdSRUQnKSAhPT0gLTE7XG4gIHZhciBoYXNVbHBmZWMgPSBkZXNjcmlwdGlvbi5mZWNNZWNoYW5pc21zLmluZGV4T2YoJ1VMUEZFQycpICE9PSAtMTtcblxuICAvLyBmaWx0ZXIgYT1zc3JjOi4uLiBjbmFtZTosIGlnbm9yZSBQbGFuQi1tc2lkXG4gIHZhciBzc3JjcyA9IFNEUFV0aWxzLm1hdGNoUHJlZml4KG1lZGlhU2VjdGlvbiwgJ2E9c3NyYzonKVxuICAgIC5tYXAoZnVuY3Rpb24obGluZSkge1xuICAgICAgcmV0dXJuIFNEUFV0aWxzLnBhcnNlU3NyY01lZGlhKGxpbmUpO1xuICAgIH0pXG4gICAgLmZpbHRlcihmdW5jdGlvbihwYXJ0cykge1xuICAgICAgcmV0dXJuIHBhcnRzLmF0dHJpYnV0ZSA9PT0gJ2NuYW1lJztcbiAgICB9KTtcbiAgdmFyIHByaW1hcnlTc3JjID0gc3NyY3MubGVuZ3RoID4gMCAmJiBzc3Jjc1swXS5zc3JjO1xuICB2YXIgc2Vjb25kYXJ5U3NyYztcblxuICB2YXIgZmxvd3MgPSBTRFBVdGlscy5tYXRjaFByZWZpeChtZWRpYVNlY3Rpb24sICdhPXNzcmMtZ3JvdXA6RklEJylcbiAgICAubWFwKGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgIHZhciBwYXJ0cyA9IGxpbmUuc3Vic3RyKDE3KS5zcGxpdCgnICcpO1xuICAgICAgcmV0dXJuIHBhcnRzLm1hcChmdW5jdGlvbihwYXJ0KSB7XG4gICAgICAgIHJldHVybiBwYXJzZUludChwYXJ0LCAxMCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgaWYgKGZsb3dzLmxlbmd0aCA+IDAgJiYgZmxvd3NbMF0ubGVuZ3RoID4gMSAmJiBmbG93c1swXVswXSA9PT0gcHJpbWFyeVNzcmMpIHtcbiAgICBzZWNvbmRhcnlTc3JjID0gZmxvd3NbMF1bMV07XG4gIH1cblxuICBkZXNjcmlwdGlvbi5jb2RlY3MuZm9yRWFjaChmdW5jdGlvbihjb2RlYykge1xuICAgIGlmIChjb2RlYy5uYW1lLnRvVXBwZXJDYXNlKCkgPT09ICdSVFgnICYmIGNvZGVjLnBhcmFtZXRlcnMuYXB0KSB7XG4gICAgICB2YXIgZW5jUGFyYW0gPSB7XG4gICAgICAgIHNzcmM6IHByaW1hcnlTc3JjLFxuICAgICAgICBjb2RlY1BheWxvYWRUeXBlOiBwYXJzZUludChjb2RlYy5wYXJhbWV0ZXJzLmFwdCwgMTApXG4gICAgICB9O1xuICAgICAgaWYgKHByaW1hcnlTc3JjICYmIHNlY29uZGFyeVNzcmMpIHtcbiAgICAgICAgZW5jUGFyYW0ucnR4ID0ge3NzcmM6IHNlY29uZGFyeVNzcmN9O1xuICAgICAgfVxuICAgICAgZW5jb2RpbmdQYXJhbWV0ZXJzLnB1c2goZW5jUGFyYW0pO1xuICAgICAgaWYgKGhhc1JlZCkge1xuICAgICAgICBlbmNQYXJhbSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZW5jUGFyYW0pKTtcbiAgICAgICAgZW5jUGFyYW0uZmVjID0ge1xuICAgICAgICAgIHNzcmM6IHByaW1hcnlTc3JjLFxuICAgICAgICAgIG1lY2hhbmlzbTogaGFzVWxwZmVjID8gJ3JlZCt1bHBmZWMnIDogJ3JlZCdcbiAgICAgICAgfTtcbiAgICAgICAgZW5jb2RpbmdQYXJhbWV0ZXJzLnB1c2goZW5jUGFyYW0pO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIGlmIChlbmNvZGluZ1BhcmFtZXRlcnMubGVuZ3RoID09PSAwICYmIHByaW1hcnlTc3JjKSB7XG4gICAgZW5jb2RpbmdQYXJhbWV0ZXJzLnB1c2goe1xuICAgICAgc3NyYzogcHJpbWFyeVNzcmNcbiAgICB9KTtcbiAgfVxuXG4gIC8vIHdlIHN1cHBvcnQgYm90aCBiPUFTIGFuZCBiPVRJQVMgYnV0IGludGVycHJldCBBUyBhcyBUSUFTLlxuICB2YXIgYmFuZHdpZHRoID0gU0RQVXRpbHMubWF0Y2hQcmVmaXgobWVkaWFTZWN0aW9uLCAnYj0nKTtcbiAgaWYgKGJhbmR3aWR0aC5sZW5ndGgpIHtcbiAgICBpZiAoYmFuZHdpZHRoWzBdLmluZGV4T2YoJ2I9VElBUzonKSA9PT0gMCkge1xuICAgICAgYmFuZHdpZHRoID0gcGFyc2VJbnQoYmFuZHdpZHRoWzBdLnN1YnN0cig3KSwgMTApO1xuICAgIH0gZWxzZSBpZiAoYmFuZHdpZHRoWzBdLmluZGV4T2YoJ2I9QVM6JykgPT09IDApIHtcbiAgICAgIC8vIHVzZSBmb3JtdWxhIGZyb20gSlNFUCB0byBjb252ZXJ0IGI9QVMgdG8gVElBUyB2YWx1ZS5cbiAgICAgIGJhbmR3aWR0aCA9IHBhcnNlSW50KGJhbmR3aWR0aFswXS5zdWJzdHIoNSksIDEwKSAqIDEwMDAgKiAwLjk1XG4gICAgICAgICAgLSAoNTAgKiA0MCAqIDgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBiYW5kd2lkdGggPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGVuY29kaW5nUGFyYW1ldGVycy5mb3JFYWNoKGZ1bmN0aW9uKHBhcmFtcykge1xuICAgICAgcGFyYW1zLm1heEJpdHJhdGUgPSBiYW5kd2lkdGg7XG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIGVuY29kaW5nUGFyYW1ldGVycztcbn07XG5cbi8vIHBhcnNlcyBodHRwOi8vZHJhZnQub3J0Yy5vcmcvI3J0Y3J0Y3BwYXJhbWV0ZXJzKlxuU0RQVXRpbHMucGFyc2VSdGNwUGFyYW1ldGVycyA9IGZ1bmN0aW9uKG1lZGlhU2VjdGlvbikge1xuICB2YXIgcnRjcFBhcmFtZXRlcnMgPSB7fTtcblxuICAvLyBHZXRzIHRoZSBmaXJzdCBTU1JDLiBOb3RlIHRoYSB3aXRoIFJUWCB0aGVyZSBtaWdodCBiZSBtdWx0aXBsZVxuICAvLyBTU1JDcy5cbiAgdmFyIHJlbW90ZVNzcmMgPSBTRFBVdGlscy5tYXRjaFByZWZpeChtZWRpYVNlY3Rpb24sICdhPXNzcmM6JylcbiAgICAubWFwKGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgIHJldHVybiBTRFBVdGlscy5wYXJzZVNzcmNNZWRpYShsaW5lKTtcbiAgICB9KVxuICAgIC5maWx0ZXIoZnVuY3Rpb24ob2JqKSB7XG4gICAgICByZXR1cm4gb2JqLmF0dHJpYnV0ZSA9PT0gJ2NuYW1lJztcbiAgICB9KVswXTtcbiAgaWYgKHJlbW90ZVNzcmMpIHtcbiAgICBydGNwUGFyYW1ldGVycy5jbmFtZSA9IHJlbW90ZVNzcmMudmFsdWU7XG4gICAgcnRjcFBhcmFtZXRlcnMuc3NyYyA9IHJlbW90ZVNzcmMuc3NyYztcbiAgfVxuXG4gIC8vIEVkZ2UgdXNlcyB0aGUgY29tcG91bmQgYXR0cmlidXRlIGluc3RlYWQgb2YgcmVkdWNlZFNpemVcbiAgLy8gY29tcG91bmQgaXMgIXJlZHVjZWRTaXplXG4gIHZhciByc2l6ZSA9IFNEUFV0aWxzLm1hdGNoUHJlZml4KG1lZGlhU2VjdGlvbiwgJ2E9cnRjcC1yc2l6ZScpO1xuICBydGNwUGFyYW1ldGVycy5yZWR1Y2VkU2l6ZSA9IHJzaXplLmxlbmd0aCA+IDA7XG4gIHJ0Y3BQYXJhbWV0ZXJzLmNvbXBvdW5kID0gcnNpemUubGVuZ3RoID09PSAwO1xuXG4gIC8vIHBhcnNlcyB0aGUgcnRjcC1tdXggYXR0ctGWYnV0ZS5cbiAgLy8gTm90ZSB0aGF0IEVkZ2UgZG9lcyBub3Qgc3VwcG9ydCB1bm11eGVkIFJUQ1AuXG4gIHZhciBtdXggPSBTRFBVdGlscy5tYXRjaFByZWZpeChtZWRpYVNlY3Rpb24sICdhPXJ0Y3AtbXV4Jyk7XG4gIHJ0Y3BQYXJhbWV0ZXJzLm11eCA9IG11eC5sZW5ndGggPiAwO1xuXG4gIHJldHVybiBydGNwUGFyYW1ldGVycztcbn07XG5cbi8vIHBhcnNlcyBlaXRoZXIgYT1tc2lkOiBvciBhPXNzcmM6Li4uIG1zaWQgbGluZXMgYW5kIHJldHVybnNcbi8vIHRoZSBpZCBvZiB0aGUgTWVkaWFTdHJlYW0gYW5kIE1lZGlhU3RyZWFtVHJhY2suXG5TRFBVdGlscy5wYXJzZU1zaWQgPSBmdW5jdGlvbihtZWRpYVNlY3Rpb24pIHtcbiAgdmFyIHBhcnRzO1xuICB2YXIgc3BlYyA9IFNEUFV0aWxzLm1hdGNoUHJlZml4KG1lZGlhU2VjdGlvbiwgJ2E9bXNpZDonKTtcbiAgaWYgKHNwZWMubGVuZ3RoID09PSAxKSB7XG4gICAgcGFydHMgPSBzcGVjWzBdLnN1YnN0cig3KS5zcGxpdCgnICcpO1xuICAgIHJldHVybiB7c3RyZWFtOiBwYXJ0c1swXSwgdHJhY2s6IHBhcnRzWzFdfTtcbiAgfVxuICB2YXIgcGxhbkIgPSBTRFBVdGlscy5tYXRjaFByZWZpeChtZWRpYVNlY3Rpb24sICdhPXNzcmM6JylcbiAgICAubWFwKGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgIHJldHVybiBTRFBVdGlscy5wYXJzZVNzcmNNZWRpYShsaW5lKTtcbiAgICB9KVxuICAgIC5maWx0ZXIoZnVuY3Rpb24obXNpZFBhcnRzKSB7XG4gICAgICByZXR1cm4gbXNpZFBhcnRzLmF0dHJpYnV0ZSA9PT0gJ21zaWQnO1xuICAgIH0pO1xuICBpZiAocGxhbkIubGVuZ3RoID4gMCkge1xuICAgIHBhcnRzID0gcGxhbkJbMF0udmFsdWUuc3BsaXQoJyAnKTtcbiAgICByZXR1cm4ge3N0cmVhbTogcGFydHNbMF0sIHRyYWNrOiBwYXJ0c1sxXX07XG4gIH1cbn07XG5cbi8vIFNDVFBcbi8vIHBhcnNlcyBkcmFmdC1pZXRmLW1tdXNpYy1zY3RwLXNkcC0yNiBmaXJzdCBhbmQgZmFsbHMgYmFja1xuLy8gdG8gZHJhZnQtaWV0Zi1tbXVzaWMtc2N0cC1zZHAtMDVcblNEUFV0aWxzLnBhcnNlU2N0cERlc2NyaXB0aW9uID0gZnVuY3Rpb24obWVkaWFTZWN0aW9uKSB7XG4gIHZhciBtbGluZSA9IFNEUFV0aWxzLnBhcnNlTUxpbmUobWVkaWFTZWN0aW9uKTtcbiAgdmFyIG1heFNpemVMaW5lID0gU0RQVXRpbHMubWF0Y2hQcmVmaXgobWVkaWFTZWN0aW9uLCAnYT1tYXgtbWVzc2FnZS1zaXplOicpO1xuICB2YXIgbWF4TWVzc2FnZVNpemU7XG4gIGlmIChtYXhTaXplTGluZS5sZW5ndGggPiAwKSB7XG4gICAgbWF4TWVzc2FnZVNpemUgPSBwYXJzZUludChtYXhTaXplTGluZVswXS5zdWJzdHIoMTkpLCAxMCk7XG4gIH1cbiAgaWYgKGlzTmFOKG1heE1lc3NhZ2VTaXplKSkge1xuICAgIG1heE1lc3NhZ2VTaXplID0gNjU1MzY7XG4gIH1cbiAgdmFyIHNjdHBQb3J0ID0gU0RQVXRpbHMubWF0Y2hQcmVmaXgobWVkaWFTZWN0aW9uLCAnYT1zY3RwLXBvcnQ6Jyk7XG4gIGlmIChzY3RwUG9ydC5sZW5ndGggPiAwKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHBvcnQ6IHBhcnNlSW50KHNjdHBQb3J0WzBdLnN1YnN0cigxMiksIDEwKSxcbiAgICAgIHByb3RvY29sOiBtbGluZS5mbXQsXG4gICAgICBtYXhNZXNzYWdlU2l6ZTogbWF4TWVzc2FnZVNpemVcbiAgICB9O1xuICB9XG4gIHZhciBzY3RwTWFwTGluZXMgPSBTRFBVdGlscy5tYXRjaFByZWZpeChtZWRpYVNlY3Rpb24sICdhPXNjdHBtYXA6Jyk7XG4gIGlmIChzY3RwTWFwTGluZXMubGVuZ3RoID4gMCkge1xuICAgIHZhciBwYXJ0cyA9IFNEUFV0aWxzLm1hdGNoUHJlZml4KG1lZGlhU2VjdGlvbiwgJ2E9c2N0cG1hcDonKVswXVxuICAgICAgLnN1YnN0cigxMClcbiAgICAgIC5zcGxpdCgnICcpO1xuICAgIHJldHVybiB7XG4gICAgICBwb3J0OiBwYXJzZUludChwYXJ0c1swXSwgMTApLFxuICAgICAgcHJvdG9jb2w6IHBhcnRzWzFdLFxuICAgICAgbWF4TWVzc2FnZVNpemU6IG1heE1lc3NhZ2VTaXplXG4gICAgfTtcbiAgfVxufTtcblxuLy8gU0NUUFxuLy8gb3V0cHV0cyB0aGUgZHJhZnQtaWV0Zi1tbXVzaWMtc2N0cC1zZHAtMjYgdmVyc2lvbiB0aGF0IGFsbCBicm93c2Vyc1xuLy8gc3VwcG9ydCBieSBub3cgcmVjZWl2aW5nIGluIHRoaXMgZm9ybWF0LCB1bmxlc3Mgd2Ugb3JpZ2luYWxseSBwYXJzZWRcbi8vIGFzIHRoZSBkcmFmdC1pZXRmLW1tdXNpYy1zY3RwLXNkcC0wNSBmb3JtYXQgKGluZGljYXRlZCBieSB0aGUgbS1saW5lXG4vLyBwcm90b2NvbCBvZiBEVExTL1NDVFAgLS0gd2l0aG91dCBVRFAvIG9yIFRDUC8pXG5TRFBVdGlscy53cml0ZVNjdHBEZXNjcmlwdGlvbiA9IGZ1bmN0aW9uKG1lZGlhLCBzY3RwKSB7XG4gIHZhciBvdXRwdXQgPSBbXTtcbiAgaWYgKG1lZGlhLnByb3RvY29sICE9PSAnRFRMUy9TQ1RQJykge1xuICAgIG91dHB1dCA9IFtcbiAgICAgICdtPScgKyBtZWRpYS5raW5kICsgJyA5ICcgKyBtZWRpYS5wcm90b2NvbCArICcgJyArIHNjdHAucHJvdG9jb2wgKyAnXFxyXFxuJyxcbiAgICAgICdjPUlOIElQNCAwLjAuMC4wXFxyXFxuJyxcbiAgICAgICdhPXNjdHAtcG9ydDonICsgc2N0cC5wb3J0ICsgJ1xcclxcbidcbiAgICBdO1xuICB9IGVsc2Uge1xuICAgIG91dHB1dCA9IFtcbiAgICAgICdtPScgKyBtZWRpYS5raW5kICsgJyA5ICcgKyBtZWRpYS5wcm90b2NvbCArICcgJyArIHNjdHAucG9ydCArICdcXHJcXG4nLFxuICAgICAgJ2M9SU4gSVA0IDAuMC4wLjBcXHJcXG4nLFxuICAgICAgJ2E9c2N0cG1hcDonICsgc2N0cC5wb3J0ICsgJyAnICsgc2N0cC5wcm90b2NvbCArICcgNjU1MzVcXHJcXG4nXG4gICAgXTtcbiAgfVxuICBpZiAoc2N0cC5tYXhNZXNzYWdlU2l6ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgb3V0cHV0LnB1c2goJ2E9bWF4LW1lc3NhZ2Utc2l6ZTonICsgc2N0cC5tYXhNZXNzYWdlU2l6ZSArICdcXHJcXG4nKTtcbiAgfVxuICByZXR1cm4gb3V0cHV0LmpvaW4oJycpO1xufTtcblxuLy8gR2VuZXJhdGUgYSBzZXNzaW9uIElEIGZvciBTRFAuXG4vLyBodHRwczovL3Rvb2xzLmlldGYub3JnL2h0bWwvZHJhZnQtaWV0Zi1ydGN3ZWItanNlcC0yMCNzZWN0aW9uLTUuMi4xXG4vLyByZWNvbW1lbmRzIHVzaW5nIGEgY3J5cHRvZ3JhcGhpY2FsbHkgcmFuZG9tICt2ZSA2NC1iaXQgdmFsdWVcbi8vIGJ1dCByaWdodCBub3cgdGhpcyBzaG91bGQgYmUgYWNjZXB0YWJsZSBhbmQgd2l0aGluIHRoZSByaWdodCByYW5nZVxuU0RQVXRpbHMuZ2VuZXJhdGVTZXNzaW9uSWQgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoKS5zdWJzdHIoMiwgMjEpO1xufTtcblxuLy8gV3JpdGUgYm9pbGRlciBwbGF0ZSBmb3Igc3RhcnQgb2YgU0RQXG4vLyBzZXNzSWQgYXJndW1lbnQgaXMgb3B0aW9uYWwgLSBpZiBub3Qgc3VwcGxpZWQgaXQgd2lsbFxuLy8gYmUgZ2VuZXJhdGVkIHJhbmRvbWx5XG4vLyBzZXNzVmVyc2lvbiBpcyBvcHRpb25hbCBhbmQgZGVmYXVsdHMgdG8gMlxuLy8gc2Vzc1VzZXIgaXMgb3B0aW9uYWwgYW5kIGRlZmF1bHRzIHRvICd0aGlzaXNhZGFwdGVyb3J0YydcblNEUFV0aWxzLndyaXRlU2Vzc2lvbkJvaWxlcnBsYXRlID0gZnVuY3Rpb24oc2Vzc0lkLCBzZXNzVmVyLCBzZXNzVXNlcikge1xuICB2YXIgc2Vzc2lvbklkO1xuICB2YXIgdmVyc2lvbiA9IHNlc3NWZXIgIT09IHVuZGVmaW5lZCA/IHNlc3NWZXIgOiAyO1xuICBpZiAoc2Vzc0lkKSB7XG4gICAgc2Vzc2lvbklkID0gc2Vzc0lkO1xuICB9IGVsc2Uge1xuICAgIHNlc3Npb25JZCA9IFNEUFV0aWxzLmdlbmVyYXRlU2Vzc2lvbklkKCk7XG4gIH1cbiAgdmFyIHVzZXIgPSBzZXNzVXNlciB8fCAndGhpc2lzYWRhcHRlcm9ydGMnO1xuICAvLyBGSVhNRTogc2Vzcy1pZCBzaG91bGQgYmUgYW4gTlRQIHRpbWVzdGFtcC5cbiAgcmV0dXJuICd2PTBcXHJcXG4nICtcbiAgICAgICdvPScgKyB1c2VyICsgJyAnICsgc2Vzc2lvbklkICsgJyAnICsgdmVyc2lvbiArXG4gICAgICAgICcgSU4gSVA0IDEyNy4wLjAuMVxcclxcbicgK1xuICAgICAgJ3M9LVxcclxcbicgK1xuICAgICAgJ3Q9MCAwXFxyXFxuJztcbn07XG5cblNEUFV0aWxzLndyaXRlTWVkaWFTZWN0aW9uID0gZnVuY3Rpb24odHJhbnNjZWl2ZXIsIGNhcHMsIHR5cGUsIHN0cmVhbSkge1xuICB2YXIgc2RwID0gU0RQVXRpbHMud3JpdGVSdHBEZXNjcmlwdGlvbih0cmFuc2NlaXZlci5raW5kLCBjYXBzKTtcblxuICAvLyBNYXAgSUNFIHBhcmFtZXRlcnMgKHVmcmFnLCBwd2QpIHRvIFNEUC5cbiAgc2RwICs9IFNEUFV0aWxzLndyaXRlSWNlUGFyYW1ldGVycyhcbiAgICB0cmFuc2NlaXZlci5pY2VHYXRoZXJlci5nZXRMb2NhbFBhcmFtZXRlcnMoKSk7XG5cbiAgLy8gTWFwIERUTFMgcGFyYW1ldGVycyB0byBTRFAuXG4gIHNkcCArPSBTRFBVdGlscy53cml0ZUR0bHNQYXJhbWV0ZXJzKFxuICAgIHRyYW5zY2VpdmVyLmR0bHNUcmFuc3BvcnQuZ2V0TG9jYWxQYXJhbWV0ZXJzKCksXG4gICAgdHlwZSA9PT0gJ29mZmVyJyA/ICdhY3RwYXNzJyA6ICdhY3RpdmUnKTtcblxuICBzZHAgKz0gJ2E9bWlkOicgKyB0cmFuc2NlaXZlci5taWQgKyAnXFxyXFxuJztcblxuICBpZiAodHJhbnNjZWl2ZXIuZGlyZWN0aW9uKSB7XG4gICAgc2RwICs9ICdhPScgKyB0cmFuc2NlaXZlci5kaXJlY3Rpb24gKyAnXFxyXFxuJztcbiAgfSBlbHNlIGlmICh0cmFuc2NlaXZlci5ydHBTZW5kZXIgJiYgdHJhbnNjZWl2ZXIucnRwUmVjZWl2ZXIpIHtcbiAgICBzZHAgKz0gJ2E9c2VuZHJlY3ZcXHJcXG4nO1xuICB9IGVsc2UgaWYgKHRyYW5zY2VpdmVyLnJ0cFNlbmRlcikge1xuICAgIHNkcCArPSAnYT1zZW5kb25seVxcclxcbic7XG4gIH0gZWxzZSBpZiAodHJhbnNjZWl2ZXIucnRwUmVjZWl2ZXIpIHtcbiAgICBzZHAgKz0gJ2E9cmVjdm9ubHlcXHJcXG4nO1xuICB9IGVsc2Uge1xuICAgIHNkcCArPSAnYT1pbmFjdGl2ZVxcclxcbic7XG4gIH1cblxuICBpZiAodHJhbnNjZWl2ZXIucnRwU2VuZGVyKSB7XG4gICAgLy8gc3BlYy5cbiAgICB2YXIgbXNpZCA9ICdtc2lkOicgKyBzdHJlYW0uaWQgKyAnICcgK1xuICAgICAgICB0cmFuc2NlaXZlci5ydHBTZW5kZXIudHJhY2suaWQgKyAnXFxyXFxuJztcbiAgICBzZHAgKz0gJ2E9JyArIG1zaWQ7XG5cbiAgICAvLyBmb3IgQ2hyb21lLlxuICAgIHNkcCArPSAnYT1zc3JjOicgKyB0cmFuc2NlaXZlci5zZW5kRW5jb2RpbmdQYXJhbWV0ZXJzWzBdLnNzcmMgK1xuICAgICAgICAnICcgKyBtc2lkO1xuICAgIGlmICh0cmFuc2NlaXZlci5zZW5kRW5jb2RpbmdQYXJhbWV0ZXJzWzBdLnJ0eCkge1xuICAgICAgc2RwICs9ICdhPXNzcmM6JyArIHRyYW5zY2VpdmVyLnNlbmRFbmNvZGluZ1BhcmFtZXRlcnNbMF0ucnR4LnNzcmMgK1xuICAgICAgICAgICcgJyArIG1zaWQ7XG4gICAgICBzZHAgKz0gJ2E9c3NyYy1ncm91cDpGSUQgJyArXG4gICAgICAgICAgdHJhbnNjZWl2ZXIuc2VuZEVuY29kaW5nUGFyYW1ldGVyc1swXS5zc3JjICsgJyAnICtcbiAgICAgICAgICB0cmFuc2NlaXZlci5zZW5kRW5jb2RpbmdQYXJhbWV0ZXJzWzBdLnJ0eC5zc3JjICtcbiAgICAgICAgICAnXFxyXFxuJztcbiAgICB9XG4gIH1cbiAgLy8gRklYTUU6IHRoaXMgc2hvdWxkIGJlIHdyaXR0ZW4gYnkgd3JpdGVSdHBEZXNjcmlwdGlvbi5cbiAgc2RwICs9ICdhPXNzcmM6JyArIHRyYW5zY2VpdmVyLnNlbmRFbmNvZGluZ1BhcmFtZXRlcnNbMF0uc3NyYyArXG4gICAgICAnIGNuYW1lOicgKyBTRFBVdGlscy5sb2NhbENOYW1lICsgJ1xcclxcbic7XG4gIGlmICh0cmFuc2NlaXZlci5ydHBTZW5kZXIgJiYgdHJhbnNjZWl2ZXIuc2VuZEVuY29kaW5nUGFyYW1ldGVyc1swXS5ydHgpIHtcbiAgICBzZHAgKz0gJ2E9c3NyYzonICsgdHJhbnNjZWl2ZXIuc2VuZEVuY29kaW5nUGFyYW1ldGVyc1swXS5ydHguc3NyYyArXG4gICAgICAgICcgY25hbWU6JyArIFNEUFV0aWxzLmxvY2FsQ05hbWUgKyAnXFxyXFxuJztcbiAgfVxuICByZXR1cm4gc2RwO1xufTtcblxuLy8gR2V0cyB0aGUgZGlyZWN0aW9uIGZyb20gdGhlIG1lZGlhU2VjdGlvbiBvciB0aGUgc2Vzc2lvbnBhcnQuXG5TRFBVdGlscy5nZXREaXJlY3Rpb24gPSBmdW5jdGlvbihtZWRpYVNlY3Rpb24sIHNlc3Npb25wYXJ0KSB7XG4gIC8vIExvb2sgZm9yIHNlbmRyZWN2LCBzZW5kb25seSwgcmVjdm9ubHksIGluYWN0aXZlLCBkZWZhdWx0IHRvIHNlbmRyZWN2LlxuICB2YXIgbGluZXMgPSBTRFBVdGlscy5zcGxpdExpbmVzKG1lZGlhU2VjdGlvbik7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoOyBpKyspIHtcbiAgICBzd2l0Y2ggKGxpbmVzW2ldKSB7XG4gICAgICBjYXNlICdhPXNlbmRyZWN2JzpcbiAgICAgIGNhc2UgJ2E9c2VuZG9ubHknOlxuICAgICAgY2FzZSAnYT1yZWN2b25seSc6XG4gICAgICBjYXNlICdhPWluYWN0aXZlJzpcbiAgICAgICAgcmV0dXJuIGxpbmVzW2ldLnN1YnN0cigyKTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIC8vIEZJWE1FOiBXaGF0IHNob3VsZCBoYXBwZW4gaGVyZT9cbiAgICB9XG4gIH1cbiAgaWYgKHNlc3Npb25wYXJ0KSB7XG4gICAgcmV0dXJuIFNEUFV0aWxzLmdldERpcmVjdGlvbihzZXNzaW9ucGFydCk7XG4gIH1cbiAgcmV0dXJuICdzZW5kcmVjdic7XG59O1xuXG5TRFBVdGlscy5nZXRLaW5kID0gZnVuY3Rpb24obWVkaWFTZWN0aW9uKSB7XG4gIHZhciBsaW5lcyA9IFNEUFV0aWxzLnNwbGl0TGluZXMobWVkaWFTZWN0aW9uKTtcbiAgdmFyIG1saW5lID0gbGluZXNbMF0uc3BsaXQoJyAnKTtcbiAgcmV0dXJuIG1saW5lWzBdLnN1YnN0cigyKTtcbn07XG5cblNEUFV0aWxzLmlzUmVqZWN0ZWQgPSBmdW5jdGlvbihtZWRpYVNlY3Rpb24pIHtcbiAgcmV0dXJuIG1lZGlhU2VjdGlvbi5zcGxpdCgnICcsIDIpWzFdID09PSAnMCc7XG59O1xuXG5TRFBVdGlscy5wYXJzZU1MaW5lID0gZnVuY3Rpb24obWVkaWFTZWN0aW9uKSB7XG4gIHZhciBsaW5lcyA9IFNEUFV0aWxzLnNwbGl0TGluZXMobWVkaWFTZWN0aW9uKTtcbiAgdmFyIHBhcnRzID0gbGluZXNbMF0uc3Vic3RyKDIpLnNwbGl0KCcgJyk7XG4gIHJldHVybiB7XG4gICAga2luZDogcGFydHNbMF0sXG4gICAgcG9ydDogcGFyc2VJbnQocGFydHNbMV0sIDEwKSxcbiAgICBwcm90b2NvbDogcGFydHNbMl0sXG4gICAgZm10OiBwYXJ0cy5zbGljZSgzKS5qb2luKCcgJylcbiAgfTtcbn07XG5cblNEUFV0aWxzLnBhcnNlT0xpbmUgPSBmdW5jdGlvbihtZWRpYVNlY3Rpb24pIHtcbiAgdmFyIGxpbmUgPSBTRFBVdGlscy5tYXRjaFByZWZpeChtZWRpYVNlY3Rpb24sICdvPScpWzBdO1xuICB2YXIgcGFydHMgPSBsaW5lLnN1YnN0cigyKS5zcGxpdCgnICcpO1xuICByZXR1cm4ge1xuICAgIHVzZXJuYW1lOiBwYXJ0c1swXSxcbiAgICBzZXNzaW9uSWQ6IHBhcnRzWzFdLFxuICAgIHNlc3Npb25WZXJzaW9uOiBwYXJzZUludChwYXJ0c1syXSwgMTApLFxuICAgIG5ldFR5cGU6IHBhcnRzWzNdLFxuICAgIGFkZHJlc3NUeXBlOiBwYXJ0c1s0XSxcbiAgICBhZGRyZXNzOiBwYXJ0c1s1XVxuICB9O1xufTtcblxuLy8gYSB2ZXJ5IG5haXZlIGludGVycHJldGF0aW9uIG9mIGEgdmFsaWQgU0RQLlxuU0RQVXRpbHMuaXNWYWxpZFNEUCA9IGZ1bmN0aW9uKGJsb2IpIHtcbiAgaWYgKHR5cGVvZiBibG9iICE9PSAnc3RyaW5nJyB8fCBibG9iLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICB2YXIgbGluZXMgPSBTRFBVdGlscy5zcGxpdExpbmVzKGJsb2IpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmVzLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKGxpbmVzW2ldLmxlbmd0aCA8IDIgfHwgbGluZXNbaV0uY2hhckF0KDEpICE9PSAnPScpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLy8gVE9ETzogY2hlY2sgdGhlIG1vZGlmaWVyIGEgYml0IG1vcmUuXG4gIH1cbiAgcmV0dXJuIHRydWU7XG59O1xuXG4vLyBFeHBvc2UgcHVibGljIG1ldGhvZHMuXG5pZiAodHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpIHtcbiAgbW9kdWxlLmV4cG9ydHMgPSBTRFBVdGlscztcbn1cbiIsIi8qKlxuICogQ29udmVydCBhcnJheSBvZiAxNiBieXRlIHZhbHVlcyB0byBVVUlEIHN0cmluZyBmb3JtYXQgb2YgdGhlIGZvcm06XG4gKiBYWFhYWFhYWC1YWFhYLVhYWFgtWFhYWC1YWFhYWFhYWFhYWFhcbiAqL1xudmFyIGJ5dGVUb0hleCA9IFtdO1xuZm9yICh2YXIgaSA9IDA7IGkgPCAyNTY7ICsraSkge1xuICBieXRlVG9IZXhbaV0gPSAoaSArIDB4MTAwKS50b1N0cmluZygxNikuc3Vic3RyKDEpO1xufVxuXG5mdW5jdGlvbiBieXRlc1RvVXVpZChidWYsIG9mZnNldCkge1xuICB2YXIgaSA9IG9mZnNldCB8fCAwO1xuICB2YXIgYnRoID0gYnl0ZVRvSGV4O1xuICAvLyBqb2luIHVzZWQgdG8gZml4IG1lbW9yeSBpc3N1ZSBjYXVzZWQgYnkgY29uY2F0ZW5hdGlvbjogaHR0cHM6Ly9idWdzLmNocm9taXVtLm9yZy9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9MzE3NSNjNFxuICByZXR1cm4gKFtcbiAgICBidGhbYnVmW2krK11dLCBidGhbYnVmW2krK11dLFxuICAgIGJ0aFtidWZbaSsrXV0sIGJ0aFtidWZbaSsrXV0sICctJyxcbiAgICBidGhbYnVmW2krK11dLCBidGhbYnVmW2krK11dLCAnLScsXG4gICAgYnRoW2J1ZltpKytdXSwgYnRoW2J1ZltpKytdXSwgJy0nLFxuICAgIGJ0aFtidWZbaSsrXV0sIGJ0aFtidWZbaSsrXV0sICctJyxcbiAgICBidGhbYnVmW2krK11dLCBidGhbYnVmW2krK11dLFxuICAgIGJ0aFtidWZbaSsrXV0sIGJ0aFtidWZbaSsrXV0sXG4gICAgYnRoW2J1ZltpKytdXSwgYnRoW2J1ZltpKytdXVxuICBdKS5qb2luKCcnKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBieXRlc1RvVXVpZDtcbiIsIi8vIFVuaXF1ZSBJRCBjcmVhdGlvbiByZXF1aXJlcyBhIGhpZ2ggcXVhbGl0eSByYW5kb20gIyBnZW5lcmF0b3IuICBJbiB0aGVcbi8vIGJyb3dzZXIgdGhpcyBpcyBhIGxpdHRsZSBjb21wbGljYXRlZCBkdWUgdG8gdW5rbm93biBxdWFsaXR5IG9mIE1hdGgucmFuZG9tKClcbi8vIGFuZCBpbmNvbnNpc3RlbnQgc3VwcG9ydCBmb3IgdGhlIGBjcnlwdG9gIEFQSS4gIFdlIGRvIHRoZSBiZXN0IHdlIGNhbiB2aWFcbi8vIGZlYXR1cmUtZGV0ZWN0aW9uXG5cbi8vIGdldFJhbmRvbVZhbHVlcyBuZWVkcyB0byBiZSBpbnZva2VkIGluIGEgY29udGV4dCB3aGVyZSBcInRoaXNcIiBpcyBhIENyeXB0b1xuLy8gaW1wbGVtZW50YXRpb24uIEFsc28sIGZpbmQgdGhlIGNvbXBsZXRlIGltcGxlbWVudGF0aW9uIG9mIGNyeXB0byBvbiBJRTExLlxudmFyIGdldFJhbmRvbVZhbHVlcyA9ICh0eXBlb2YoY3J5cHRvKSAhPSAndW5kZWZpbmVkJyAmJiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzICYmIGNyeXB0by5nZXRSYW5kb21WYWx1ZXMuYmluZChjcnlwdG8pKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICh0eXBlb2YobXNDcnlwdG8pICE9ICd1bmRlZmluZWQnICYmIHR5cGVvZiB3aW5kb3cubXNDcnlwdG8uZ2V0UmFuZG9tVmFsdWVzID09ICdmdW5jdGlvbicgJiYgbXNDcnlwdG8uZ2V0UmFuZG9tVmFsdWVzLmJpbmQobXNDcnlwdG8pKTtcblxuaWYgKGdldFJhbmRvbVZhbHVlcykge1xuICAvLyBXSEFUV0cgY3J5cHRvIFJORyAtIGh0dHA6Ly93aWtpLndoYXR3Zy5vcmcvd2lraS9DcnlwdG9cbiAgdmFyIHJuZHM4ID0gbmV3IFVpbnQ4QXJyYXkoMTYpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXVuZGVmXG5cbiAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiB3aGF0d2dSTkcoKSB7XG4gICAgZ2V0UmFuZG9tVmFsdWVzKHJuZHM4KTtcbiAgICByZXR1cm4gcm5kczg7XG4gIH07XG59IGVsc2Uge1xuICAvLyBNYXRoLnJhbmRvbSgpLWJhc2VkIChSTkcpXG4gIC8vXG4gIC8vIElmIGFsbCBlbHNlIGZhaWxzLCB1c2UgTWF0aC5yYW5kb20oKS4gIEl0J3MgZmFzdCwgYnV0IGlzIG9mIHVuc3BlY2lmaWVkXG4gIC8vIHF1YWxpdHkuXG4gIHZhciBybmRzID0gbmV3IEFycmF5KDE2KTtcblxuICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIG1hdGhSTkcoKSB7XG4gICAgZm9yICh2YXIgaSA9IDAsIHI7IGkgPCAxNjsgaSsrKSB7XG4gICAgICBpZiAoKGkgJiAweDAzKSA9PT0gMCkgciA9IE1hdGgucmFuZG9tKCkgKiAweDEwMDAwMDAwMDtcbiAgICAgIHJuZHNbaV0gPSByID4+PiAoKGkgJiAweDAzKSA8PCAzKSAmIDB4ZmY7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJuZHM7XG4gIH07XG59XG4iLCJ2YXIgcm5nID0gcmVxdWlyZSgnLi9saWIvcm5nJyk7XG52YXIgYnl0ZXNUb1V1aWQgPSByZXF1aXJlKCcuL2xpYi9ieXRlc1RvVXVpZCcpO1xuXG5mdW5jdGlvbiB2NChvcHRpb25zLCBidWYsIG9mZnNldCkge1xuICB2YXIgaSA9IGJ1ZiAmJiBvZmZzZXQgfHwgMDtcblxuICBpZiAodHlwZW9mKG9wdGlvbnMpID09ICdzdHJpbmcnKSB7XG4gICAgYnVmID0gb3B0aW9ucyA9PT0gJ2JpbmFyeScgPyBuZXcgQXJyYXkoMTYpIDogbnVsbDtcbiAgICBvcHRpb25zID0gbnVsbDtcbiAgfVxuICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuICB2YXIgcm5kcyA9IG9wdGlvbnMucmFuZG9tIHx8IChvcHRpb25zLnJuZyB8fCBybmcpKCk7XG5cbiAgLy8gUGVyIDQuNCwgc2V0IGJpdHMgZm9yIHZlcnNpb24gYW5kIGBjbG9ja19zZXFfaGlfYW5kX3Jlc2VydmVkYFxuICBybmRzWzZdID0gKHJuZHNbNl0gJiAweDBmKSB8IDB4NDA7XG4gIHJuZHNbOF0gPSAocm5kc1s4XSAmIDB4M2YpIHwgMHg4MDtcblxuICAvLyBDb3B5IGJ5dGVzIHRvIGJ1ZmZlciwgaWYgcHJvdmlkZWRcbiAgaWYgKGJ1Zikge1xuICAgIGZvciAodmFyIGlpID0gMDsgaWkgPCAxNjsgKytpaSkge1xuICAgICAgYnVmW2kgKyBpaV0gPSBybmRzW2lpXTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gYnVmIHx8IGJ5dGVzVG9VdWlkKHJuZHMpO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHY0O1xuIiwiLypcbiAqICBDb3B5cmlnaHQgKGMpIDIwMTYgVGhlIFdlYlJUQyBwcm9qZWN0IGF1dGhvcnMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzIGdvdmVybmVkIGJ5IGEgQlNELXN0eWxlIGxpY2Vuc2VcbiAqICB0aGF0IGNhbiBiZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSByb290IG9mIHRoZSBzb3VyY2VcbiAqICB0cmVlLlxuICovXG4gLyogZXNsaW50LWVudiBub2RlICovXG5cbid1c2Ugc3RyaWN0JztcblxudmFyIGFkYXB0ZXJGYWN0b3J5ID0gcmVxdWlyZSgnLi9hZGFwdGVyX2ZhY3RvcnkuanMnKTtcbm1vZHVsZS5leHBvcnRzID0gYWRhcHRlckZhY3Rvcnkoe3dpbmRvdzogZ2xvYmFsLndpbmRvd30pO1xuIiwiLypcbiAqICBDb3B5cmlnaHQgKGMpIDIwMTYgVGhlIFdlYlJUQyBwcm9qZWN0IGF1dGhvcnMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzIGdvdmVybmVkIGJ5IGEgQlNELXN0eWxlIGxpY2Vuc2VcbiAqICB0aGF0IGNhbiBiZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSByb290IG9mIHRoZSBzb3VyY2VcbiAqICB0cmVlLlxuICovXG4gLyogZXNsaW50LWVudiBub2RlICovXG5cbid1c2Ugc3RyaWN0JztcblxudmFyIHV0aWxzID0gcmVxdWlyZSgnLi91dGlscycpO1xuLy8gU2hpbW1pbmcgc3RhcnRzIGhlcmUuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGRlcGVuZGVuY2llcywgb3B0cykge1xuICB2YXIgd2luZG93ID0gZGVwZW5kZW5jaWVzICYmIGRlcGVuZGVuY2llcy53aW5kb3c7XG5cbiAgdmFyIG9wdGlvbnMgPSB7XG4gICAgc2hpbUNocm9tZTogdHJ1ZSxcbiAgICBzaGltRmlyZWZveDogdHJ1ZSxcbiAgICBzaGltRWRnZTogdHJ1ZSxcbiAgICBzaGltU2FmYXJpOiB0cnVlLFxuICB9O1xuXG4gIGZvciAodmFyIGtleSBpbiBvcHRzKSB7XG4gICAgaWYgKGhhc093blByb3BlcnR5LmNhbGwob3B0cywga2V5KSkge1xuICAgICAgb3B0aW9uc1trZXldID0gb3B0c1trZXldO1xuICAgIH1cbiAgfVxuXG4gIC8vIFV0aWxzLlxuICB2YXIgbG9nZ2luZyA9IHV0aWxzLmxvZztcbiAgdmFyIGJyb3dzZXJEZXRhaWxzID0gdXRpbHMuZGV0ZWN0QnJvd3Nlcih3aW5kb3cpO1xuXG4gIC8vIFVuY29tbWVudCB0aGUgbGluZSBiZWxvdyBpZiB5b3Ugd2FudCBsb2dnaW5nIHRvIG9jY3VyLCBpbmNsdWRpbmcgbG9nZ2luZ1xuICAvLyBmb3IgdGhlIHN3aXRjaCBzdGF0ZW1lbnQgYmVsb3cuIENhbiBhbHNvIGJlIHR1cm5lZCBvbiBpbiB0aGUgYnJvd3NlciB2aWFcbiAgLy8gYWRhcHRlci5kaXNhYmxlTG9nKGZhbHNlKSwgYnV0IHRoZW4gbG9nZ2luZyBmcm9tIHRoZSBzd2l0Y2ggc3RhdGVtZW50IGJlbG93XG4gIC8vIHdpbGwgbm90IGFwcGVhci5cbiAgLy8gcmVxdWlyZSgnLi91dGlscycpLmRpc2FibGVMb2coZmFsc2UpO1xuXG4gIC8vIEJyb3dzZXIgc2hpbXMuXG4gIHZhciBjaHJvbWVTaGltID0gcmVxdWlyZSgnLi9jaHJvbWUvY2hyb21lX3NoaW0nKSB8fCBudWxsO1xuICB2YXIgZWRnZVNoaW0gPSByZXF1aXJlKCcuL2VkZ2UvZWRnZV9zaGltJykgfHwgbnVsbDtcbiAgdmFyIGZpcmVmb3hTaGltID0gcmVxdWlyZSgnLi9maXJlZm94L2ZpcmVmb3hfc2hpbScpIHx8IG51bGw7XG4gIHZhciBzYWZhcmlTaGltID0gcmVxdWlyZSgnLi9zYWZhcmkvc2FmYXJpX3NoaW0nKSB8fCBudWxsO1xuICB2YXIgY29tbW9uU2hpbSA9IHJlcXVpcmUoJy4vY29tbW9uX3NoaW0nKSB8fCBudWxsO1xuXG4gIC8vIEV4cG9ydCB0byB0aGUgYWRhcHRlciBnbG9iYWwgb2JqZWN0IHZpc2libGUgaW4gdGhlIGJyb3dzZXIuXG4gIHZhciBhZGFwdGVyID0ge1xuICAgIGJyb3dzZXJEZXRhaWxzOiBicm93c2VyRGV0YWlscyxcbiAgICBjb21tb25TaGltOiBjb21tb25TaGltLFxuICAgIGV4dHJhY3RWZXJzaW9uOiB1dGlscy5leHRyYWN0VmVyc2lvbixcbiAgICBkaXNhYmxlTG9nOiB1dGlscy5kaXNhYmxlTG9nLFxuICAgIGRpc2FibGVXYXJuaW5nczogdXRpbHMuZGlzYWJsZVdhcm5pbmdzXG4gIH07XG5cbiAgLy8gU2hpbSBicm93c2VyIGlmIGZvdW5kLlxuICBzd2l0Y2ggKGJyb3dzZXJEZXRhaWxzLmJyb3dzZXIpIHtcbiAgICBjYXNlICdjaHJvbWUnOlxuICAgICAgaWYgKCFjaHJvbWVTaGltIHx8ICFjaHJvbWVTaGltLnNoaW1QZWVyQ29ubmVjdGlvbiB8fFxuICAgICAgICAgICFvcHRpb25zLnNoaW1DaHJvbWUpIHtcbiAgICAgICAgbG9nZ2luZygnQ2hyb21lIHNoaW0gaXMgbm90IGluY2x1ZGVkIGluIHRoaXMgYWRhcHRlciByZWxlYXNlLicpO1xuICAgICAgICByZXR1cm4gYWRhcHRlcjtcbiAgICAgIH1cbiAgICAgIGxvZ2dpbmcoJ2FkYXB0ZXIuanMgc2hpbW1pbmcgY2hyb21lLicpO1xuICAgICAgLy8gRXhwb3J0IHRvIHRoZSBhZGFwdGVyIGdsb2JhbCBvYmplY3QgdmlzaWJsZSBpbiB0aGUgYnJvd3Nlci5cbiAgICAgIGFkYXB0ZXIuYnJvd3NlclNoaW0gPSBjaHJvbWVTaGltO1xuICAgICAgY29tbW9uU2hpbS5zaGltQ3JlYXRlT2JqZWN0VVJMKHdpbmRvdyk7XG5cbiAgICAgIGNocm9tZVNoaW0uc2hpbUdldFVzZXJNZWRpYSh3aW5kb3cpO1xuICAgICAgY2hyb21lU2hpbS5zaGltTWVkaWFTdHJlYW0od2luZG93KTtcbiAgICAgIGNocm9tZVNoaW0uc2hpbVNvdXJjZU9iamVjdCh3aW5kb3cpO1xuICAgICAgY2hyb21lU2hpbS5zaGltUGVlckNvbm5lY3Rpb24od2luZG93KTtcbiAgICAgIGNocm9tZVNoaW0uc2hpbU9uVHJhY2sod2luZG93KTtcbiAgICAgIGNocm9tZVNoaW0uc2hpbUFkZFRyYWNrUmVtb3ZlVHJhY2sod2luZG93KTtcbiAgICAgIGNocm9tZVNoaW0uc2hpbUdldFNlbmRlcnNXaXRoRHRtZih3aW5kb3cpO1xuICAgICAgY2hyb21lU2hpbS5zaGltU2VuZGVyUmVjZWl2ZXJHZXRTdGF0cyh3aW5kb3cpO1xuICAgICAgY2hyb21lU2hpbS5maXhOZWdvdGlhdGlvbk5lZWRlZCh3aW5kb3cpO1xuXG4gICAgICBjb21tb25TaGltLnNoaW1SVENJY2VDYW5kaWRhdGUod2luZG93KTtcbiAgICAgIGNvbW1vblNoaW0uc2hpbU1heE1lc3NhZ2VTaXplKHdpbmRvdyk7XG4gICAgICBjb21tb25TaGltLnNoaW1TZW5kVGhyb3dUeXBlRXJyb3Iod2luZG93KTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2ZpcmVmb3gnOlxuICAgICAgaWYgKCFmaXJlZm94U2hpbSB8fCAhZmlyZWZveFNoaW0uc2hpbVBlZXJDb25uZWN0aW9uIHx8XG4gICAgICAgICAgIW9wdGlvbnMuc2hpbUZpcmVmb3gpIHtcbiAgICAgICAgbG9nZ2luZygnRmlyZWZveCBzaGltIGlzIG5vdCBpbmNsdWRlZCBpbiB0aGlzIGFkYXB0ZXIgcmVsZWFzZS4nKTtcbiAgICAgICAgcmV0dXJuIGFkYXB0ZXI7XG4gICAgICB9XG4gICAgICBsb2dnaW5nKCdhZGFwdGVyLmpzIHNoaW1taW5nIGZpcmVmb3guJyk7XG4gICAgICAvLyBFeHBvcnQgdG8gdGhlIGFkYXB0ZXIgZ2xvYmFsIG9iamVjdCB2aXNpYmxlIGluIHRoZSBicm93c2VyLlxuICAgICAgYWRhcHRlci5icm93c2VyU2hpbSA9IGZpcmVmb3hTaGltO1xuICAgICAgY29tbW9uU2hpbS5zaGltQ3JlYXRlT2JqZWN0VVJMKHdpbmRvdyk7XG5cbiAgICAgIGZpcmVmb3hTaGltLnNoaW1HZXRVc2VyTWVkaWEod2luZG93KTtcbiAgICAgIGZpcmVmb3hTaGltLnNoaW1Tb3VyY2VPYmplY3Qod2luZG93KTtcbiAgICAgIGZpcmVmb3hTaGltLnNoaW1QZWVyQ29ubmVjdGlvbih3aW5kb3cpO1xuICAgICAgZmlyZWZveFNoaW0uc2hpbU9uVHJhY2sod2luZG93KTtcbiAgICAgIGZpcmVmb3hTaGltLnNoaW1SZW1vdmVTdHJlYW0od2luZG93KTtcbiAgICAgIGZpcmVmb3hTaGltLnNoaW1TZW5kZXJHZXRTdGF0cyh3aW5kb3cpO1xuICAgICAgZmlyZWZveFNoaW0uc2hpbVJlY2VpdmVyR2V0U3RhdHMod2luZG93KTtcbiAgICAgIGZpcmVmb3hTaGltLnNoaW1SVENEYXRhQ2hhbm5lbCh3aW5kb3cpO1xuXG4gICAgICBjb21tb25TaGltLnNoaW1SVENJY2VDYW5kaWRhdGUod2luZG93KTtcbiAgICAgIGNvbW1vblNoaW0uc2hpbU1heE1lc3NhZ2VTaXplKHdpbmRvdyk7XG4gICAgICBjb21tb25TaGltLnNoaW1TZW5kVGhyb3dUeXBlRXJyb3Iod2luZG93KTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2VkZ2UnOlxuICAgICAgaWYgKCFlZGdlU2hpbSB8fCAhZWRnZVNoaW0uc2hpbVBlZXJDb25uZWN0aW9uIHx8ICFvcHRpb25zLnNoaW1FZGdlKSB7XG4gICAgICAgIGxvZ2dpbmcoJ01TIGVkZ2Ugc2hpbSBpcyBub3QgaW5jbHVkZWQgaW4gdGhpcyBhZGFwdGVyIHJlbGVhc2UuJyk7XG4gICAgICAgIHJldHVybiBhZGFwdGVyO1xuICAgICAgfVxuICAgICAgbG9nZ2luZygnYWRhcHRlci5qcyBzaGltbWluZyBlZGdlLicpO1xuICAgICAgLy8gRXhwb3J0IHRvIHRoZSBhZGFwdGVyIGdsb2JhbCBvYmplY3QgdmlzaWJsZSBpbiB0aGUgYnJvd3Nlci5cbiAgICAgIGFkYXB0ZXIuYnJvd3NlclNoaW0gPSBlZGdlU2hpbTtcbiAgICAgIGNvbW1vblNoaW0uc2hpbUNyZWF0ZU9iamVjdFVSTCh3aW5kb3cpO1xuXG4gICAgICBlZGdlU2hpbS5zaGltR2V0VXNlck1lZGlhKHdpbmRvdyk7XG4gICAgICBlZGdlU2hpbS5zaGltUGVlckNvbm5lY3Rpb24od2luZG93KTtcbiAgICAgIGVkZ2VTaGltLnNoaW1SZXBsYWNlVHJhY2sod2luZG93KTtcbiAgICAgIGVkZ2VTaGltLnNoaW1HZXREaXNwbGF5TWVkaWEod2luZG93KTtcblxuICAgICAgLy8gdGhlIGVkZ2Ugc2hpbSBpbXBsZW1lbnRzIHRoZSBmdWxsIFJUQ0ljZUNhbmRpZGF0ZSBvYmplY3QuXG5cbiAgICAgIGNvbW1vblNoaW0uc2hpbU1heE1lc3NhZ2VTaXplKHdpbmRvdyk7XG4gICAgICBjb21tb25TaGltLnNoaW1TZW5kVGhyb3dUeXBlRXJyb3Iod2luZG93KTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ3NhZmFyaSc6XG4gICAgICBpZiAoIXNhZmFyaVNoaW0gfHwgIW9wdGlvbnMuc2hpbVNhZmFyaSkge1xuICAgICAgICBsb2dnaW5nKCdTYWZhcmkgc2hpbSBpcyBub3QgaW5jbHVkZWQgaW4gdGhpcyBhZGFwdGVyIHJlbGVhc2UuJyk7XG4gICAgICAgIHJldHVybiBhZGFwdGVyO1xuICAgICAgfVxuICAgICAgbG9nZ2luZygnYWRhcHRlci5qcyBzaGltbWluZyBzYWZhcmkuJyk7XG4gICAgICAvLyBFeHBvcnQgdG8gdGhlIGFkYXB0ZXIgZ2xvYmFsIG9iamVjdCB2aXNpYmxlIGluIHRoZSBicm93c2VyLlxuICAgICAgYWRhcHRlci5icm93c2VyU2hpbSA9IHNhZmFyaVNoaW07XG4gICAgICBjb21tb25TaGltLnNoaW1DcmVhdGVPYmplY3RVUkwod2luZG93KTtcblxuICAgICAgc2FmYXJpU2hpbS5zaGltUlRDSWNlU2VydmVyVXJscyh3aW5kb3cpO1xuICAgICAgc2FmYXJpU2hpbS5zaGltQ3JlYXRlT2ZmZXJMZWdhY3kod2luZG93KTtcbiAgICAgIHNhZmFyaVNoaW0uc2hpbUNhbGxiYWNrc0FQSSh3aW5kb3cpO1xuICAgICAgc2FmYXJpU2hpbS5zaGltTG9jYWxTdHJlYW1zQVBJKHdpbmRvdyk7XG4gICAgICBzYWZhcmlTaGltLnNoaW1SZW1vdGVTdHJlYW1zQVBJKHdpbmRvdyk7XG4gICAgICBzYWZhcmlTaGltLnNoaW1UcmFja0V2ZW50VHJhbnNjZWl2ZXIod2luZG93KTtcbiAgICAgIHNhZmFyaVNoaW0uc2hpbUdldFVzZXJNZWRpYSh3aW5kb3cpO1xuXG4gICAgICBjb21tb25TaGltLnNoaW1SVENJY2VDYW5kaWRhdGUod2luZG93KTtcbiAgICAgIGNvbW1vblNoaW0uc2hpbU1heE1lc3NhZ2VTaXplKHdpbmRvdyk7XG4gICAgICBjb21tb25TaGltLnNoaW1TZW5kVGhyb3dUeXBlRXJyb3Iod2luZG93KTtcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6XG4gICAgICBsb2dnaW5nKCdVbnN1cHBvcnRlZCBicm93c2VyIScpO1xuICAgICAgYnJlYWs7XG4gIH1cblxuICByZXR1cm4gYWRhcHRlcjtcbn07XG4iLCJcbi8qXG4gKiAgQ29weXJpZ2h0IChjKSAyMDE2IFRoZSBXZWJSVEMgcHJvamVjdCBhdXRob3JzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqICBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhIEJTRC1zdHlsZSBsaWNlbnNlXG4gKiAgdGhhdCBjYW4gYmUgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBvZiB0aGUgc291cmNlXG4gKiAgdHJlZS5cbiAqL1xuIC8qIGVzbGludC1lbnYgbm9kZSAqL1xuJ3VzZSBzdHJpY3QnO1xudmFyIHV0aWxzID0gcmVxdWlyZSgnLi4vdXRpbHMuanMnKTtcbnZhciBsb2dnaW5nID0gdXRpbHMubG9nO1xuXG4vKiBpdGVyYXRlcyB0aGUgc3RhdHMgZ3JhcGggcmVjdXJzaXZlbHkuICovXG5mdW5jdGlvbiB3YWxrU3RhdHMoc3RhdHMsIGJhc2UsIHJlc3VsdFNldCkge1xuICBpZiAoIWJhc2UgfHwgcmVzdWx0U2V0LmhhcyhiYXNlLmlkKSkge1xuICAgIHJldHVybjtcbiAgfVxuICByZXN1bHRTZXQuc2V0KGJhc2UuaWQsIGJhc2UpO1xuICBPYmplY3Qua2V5cyhiYXNlKS5mb3JFYWNoKGZ1bmN0aW9uKG5hbWUpIHtcbiAgICBpZiAobmFtZS5lbmRzV2l0aCgnSWQnKSkge1xuICAgICAgd2Fsa1N0YXRzKHN0YXRzLCBzdGF0cy5nZXQoYmFzZVtuYW1lXSksIHJlc3VsdFNldCk7XG4gICAgfSBlbHNlIGlmIChuYW1lLmVuZHNXaXRoKCdJZHMnKSkge1xuICAgICAgYmFzZVtuYW1lXS5mb3JFYWNoKGZ1bmN0aW9uKGlkKSB7XG4gICAgICAgIHdhbGtTdGF0cyhzdGF0cywgc3RhdHMuZ2V0KGlkKSwgcmVzdWx0U2V0KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG59XG5cbi8qIGZpbHRlciBnZXRTdGF0cyBmb3IgYSBzZW5kZXIvcmVjZWl2ZXIgdHJhY2suICovXG5mdW5jdGlvbiBmaWx0ZXJTdGF0cyhyZXN1bHQsIHRyYWNrLCBvdXRib3VuZCkge1xuICB2YXIgc3RyZWFtU3RhdHNUeXBlID0gb3V0Ym91bmQgPyAnb3V0Ym91bmQtcnRwJyA6ICdpbmJvdW5kLXJ0cCc7XG4gIHZhciBmaWx0ZXJlZFJlc3VsdCA9IG5ldyBNYXAoKTtcbiAgaWYgKHRyYWNrID09PSBudWxsKSB7XG4gICAgcmV0dXJuIGZpbHRlcmVkUmVzdWx0O1xuICB9XG4gIHZhciB0cmFja1N0YXRzID0gW107XG4gIHJlc3VsdC5mb3JFYWNoKGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgaWYgKHZhbHVlLnR5cGUgPT09ICd0cmFjaycgJiZcbiAgICAgICAgdmFsdWUudHJhY2tJZGVudGlmaWVyID09PSB0cmFjay5pZCkge1xuICAgICAgdHJhY2tTdGF0cy5wdXNoKHZhbHVlKTtcbiAgICB9XG4gIH0pO1xuICB0cmFja1N0YXRzLmZvckVhY2goZnVuY3Rpb24odHJhY2tTdGF0KSB7XG4gICAgcmVzdWx0LmZvckVhY2goZnVuY3Rpb24oc3RhdHMpIHtcbiAgICAgIGlmIChzdGF0cy50eXBlID09PSBzdHJlYW1TdGF0c1R5cGUgJiYgc3RhdHMudHJhY2tJZCA9PT0gdHJhY2tTdGF0LmlkKSB7XG4gICAgICAgIHdhbGtTdGF0cyhyZXN1bHQsIHN0YXRzLCBmaWx0ZXJlZFJlc3VsdCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuICByZXR1cm4gZmlsdGVyZWRSZXN1bHQ7XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBzaGltR2V0VXNlck1lZGlhOiByZXF1aXJlKCcuL2dldHVzZXJtZWRpYScpLFxuICBzaGltTWVkaWFTdHJlYW06IGZ1bmN0aW9uKHdpbmRvdykge1xuICAgIHdpbmRvdy5NZWRpYVN0cmVhbSA9IHdpbmRvdy5NZWRpYVN0cmVhbSB8fCB3aW5kb3cud2Via2l0TWVkaWFTdHJlYW07XG4gIH0sXG5cbiAgc2hpbU9uVHJhY2s6IGZ1bmN0aW9uKHdpbmRvdykge1xuICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JyAmJiB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24gJiYgISgnb250cmFjaycgaW5cbiAgICAgICAgd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZSkpIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLCAnb250cmFjaycsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5fb250cmFjaztcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbihmKSB7XG4gICAgICAgICAgaWYgKHRoaXMuX29udHJhY2spIHtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcigndHJhY2snLCB0aGlzLl9vbnRyYWNrKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5hZGRFdmVudExpc3RlbmVyKCd0cmFjaycsIHRoaXMuX29udHJhY2sgPSBmKTtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgICB9KTtcbiAgICAgIHZhciBvcmlnU2V0UmVtb3RlRGVzY3JpcHRpb24gPVxuICAgICAgICAgIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuc2V0UmVtb3RlRGVzY3JpcHRpb247XG4gICAgICB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLnNldFJlbW90ZURlc2NyaXB0aW9uID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwYyA9IHRoaXM7XG4gICAgICAgIGlmICghcGMuX29udHJhY2twb2x5KSB7XG4gICAgICAgICAgcGMuX29udHJhY2twb2x5ID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgLy8gb25hZGRzdHJlYW0gZG9lcyBub3QgZmlyZSB3aGVuIGEgdHJhY2sgaXMgYWRkZWQgdG8gYW4gZXhpc3RpbmdcbiAgICAgICAgICAgIC8vIHN0cmVhbS4gQnV0IHN0cmVhbS5vbmFkZHRyYWNrIGlzIGltcGxlbWVudGVkIHNvIHdlIHVzZSB0aGF0LlxuICAgICAgICAgICAgZS5zdHJlYW0uYWRkRXZlbnRMaXN0ZW5lcignYWRkdHJhY2snLCBmdW5jdGlvbih0ZSkge1xuICAgICAgICAgICAgICB2YXIgcmVjZWl2ZXI7XG4gICAgICAgICAgICAgIGlmICh3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmdldFJlY2VpdmVycykge1xuICAgICAgICAgICAgICAgIHJlY2VpdmVyID0gcGMuZ2V0UmVjZWl2ZXJzKCkuZmluZChmdW5jdGlvbihyKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gci50cmFjayAmJiByLnRyYWNrLmlkID09PSB0ZS50cmFjay5pZDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZWNlaXZlciA9IHt0cmFjazogdGUudHJhY2t9O1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgdmFyIGV2ZW50ID0gbmV3IEV2ZW50KCd0cmFjaycpO1xuICAgICAgICAgICAgICBldmVudC50cmFjayA9IHRlLnRyYWNrO1xuICAgICAgICAgICAgICBldmVudC5yZWNlaXZlciA9IHJlY2VpdmVyO1xuICAgICAgICAgICAgICBldmVudC50cmFuc2NlaXZlciA9IHtyZWNlaXZlcjogcmVjZWl2ZXJ9O1xuICAgICAgICAgICAgICBldmVudC5zdHJlYW1zID0gW2Uuc3RyZWFtXTtcbiAgICAgICAgICAgICAgcGMuZGlzcGF0Y2hFdmVudChldmVudCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGUuc3RyZWFtLmdldFRyYWNrcygpLmZvckVhY2goZnVuY3Rpb24odHJhY2spIHtcbiAgICAgICAgICAgICAgdmFyIHJlY2VpdmVyO1xuICAgICAgICAgICAgICBpZiAod2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5nZXRSZWNlaXZlcnMpIHtcbiAgICAgICAgICAgICAgICByZWNlaXZlciA9IHBjLmdldFJlY2VpdmVycygpLmZpbmQoZnVuY3Rpb24ocikge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIHIudHJhY2sgJiYgci50cmFjay5pZCA9PT0gdHJhY2suaWQ7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVjZWl2ZXIgPSB7dHJhY2s6IHRyYWNrfTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB2YXIgZXZlbnQgPSBuZXcgRXZlbnQoJ3RyYWNrJyk7XG4gICAgICAgICAgICAgIGV2ZW50LnRyYWNrID0gdHJhY2s7XG4gICAgICAgICAgICAgIGV2ZW50LnJlY2VpdmVyID0gcmVjZWl2ZXI7XG4gICAgICAgICAgICAgIGV2ZW50LnRyYW5zY2VpdmVyID0ge3JlY2VpdmVyOiByZWNlaXZlcn07XG4gICAgICAgICAgICAgIGV2ZW50LnN0cmVhbXMgPSBbZS5zdHJlYW1dO1xuICAgICAgICAgICAgICBwYy5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH07XG4gICAgICAgICAgcGMuYWRkRXZlbnRMaXN0ZW5lcignYWRkc3RyZWFtJywgcGMuX29udHJhY2twb2x5KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb3JpZ1NldFJlbW90ZURlc2NyaXB0aW9uLmFwcGx5KHBjLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gZXZlbiBpZiBSVENSdHBUcmFuc2NlaXZlciBpcyBpbiB3aW5kb3csIGl0IGlzIG9ubHkgdXNlZCBhbmRcbiAgICAgIC8vIGVtaXR0ZWQgaW4gdW5pZmllZC1wbGFuLiBVbmZvcnR1bmF0ZWx5IHRoaXMgbWVhbnMgd2UgbmVlZFxuICAgICAgLy8gdG8gdW5jb25kaXRpb25hbGx5IHdyYXAgdGhlIGV2ZW50LlxuICAgICAgdXRpbHMud3JhcFBlZXJDb25uZWN0aW9uRXZlbnQod2luZG93LCAndHJhY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmICghZS50cmFuc2NlaXZlcikge1xuICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCAndHJhbnNjZWl2ZXInLFxuICAgICAgICAgICAge3ZhbHVlOiB7cmVjZWl2ZXI6IGUucmVjZWl2ZXJ9fSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGU7XG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG5cbiAgc2hpbUdldFNlbmRlcnNXaXRoRHRtZjogZnVuY3Rpb24od2luZG93KSB7XG4gICAgLy8gT3ZlcnJpZGVzIGFkZFRyYWNrL3JlbW92ZVRyYWNrLCBkZXBlbmRzIG9uIHNoaW1BZGRUcmFja1JlbW92ZVRyYWNrLlxuICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JyAmJiB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24gJiZcbiAgICAgICAgISgnZ2V0U2VuZGVycycgaW4gd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZSkgJiZcbiAgICAgICAgJ2NyZWF0ZURUTUZTZW5kZXInIGluIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUpIHtcbiAgICAgIHZhciBzaGltU2VuZGVyV2l0aER0bWYgPSBmdW5jdGlvbihwYywgdHJhY2spIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0cmFjazogdHJhY2ssXG4gICAgICAgICAgZ2V0IGR0bWYoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fZHRtZiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgIGlmICh0cmFjay5raW5kID09PSAnYXVkaW8nKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZHRtZiA9IHBjLmNyZWF0ZURUTUZTZW5kZXIodHJhY2spO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX2R0bWYgPSBudWxsO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fZHRtZjtcbiAgICAgICAgICB9LFxuICAgICAgICAgIF9wYzogcGNcbiAgICAgICAgfTtcbiAgICAgIH07XG5cbiAgICAgIC8vIGF1Z21lbnQgYWRkVHJhY2sgd2hlbiBnZXRTZW5kZXJzIGlzIG5vdCBhdmFpbGFibGUuXG4gICAgICBpZiAoIXdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuZ2V0U2VuZGVycykge1xuICAgICAgICB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmdldFNlbmRlcnMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICB0aGlzLl9zZW5kZXJzID0gdGhpcy5fc2VuZGVycyB8fCBbXTtcbiAgICAgICAgICByZXR1cm4gdGhpcy5fc2VuZGVycy5zbGljZSgpOyAvLyByZXR1cm4gYSBjb3B5IG9mIHRoZSBpbnRlcm5hbCBzdGF0ZS5cbiAgICAgICAgfTtcbiAgICAgICAgdmFyIG9yaWdBZGRUcmFjayA9IHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuYWRkVHJhY2s7XG4gICAgICAgIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuYWRkVHJhY2sgPSBmdW5jdGlvbih0cmFjaywgc3RyZWFtKSB7XG4gICAgICAgICAgdmFyIHBjID0gdGhpcztcbiAgICAgICAgICB2YXIgc2VuZGVyID0gb3JpZ0FkZFRyYWNrLmFwcGx5KHBjLCBhcmd1bWVudHMpO1xuICAgICAgICAgIGlmICghc2VuZGVyKSB7XG4gICAgICAgICAgICBzZW5kZXIgPSBzaGltU2VuZGVyV2l0aER0bWYocGMsIHRyYWNrKTtcbiAgICAgICAgICAgIHBjLl9zZW5kZXJzLnB1c2goc2VuZGVyKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHNlbmRlcjtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgb3JpZ1JlbW92ZVRyYWNrID0gd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5yZW1vdmVUcmFjaztcbiAgICAgICAgd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5yZW1vdmVUcmFjayA9IGZ1bmN0aW9uKHNlbmRlcikge1xuICAgICAgICAgIHZhciBwYyA9IHRoaXM7XG4gICAgICAgICAgb3JpZ1JlbW92ZVRyYWNrLmFwcGx5KHBjLCBhcmd1bWVudHMpO1xuICAgICAgICAgIHZhciBpZHggPSBwYy5fc2VuZGVycy5pbmRleE9mKHNlbmRlcik7XG4gICAgICAgICAgaWYgKGlkeCAhPT0gLTEpIHtcbiAgICAgICAgICAgIHBjLl9zZW5kZXJzLnNwbGljZShpZHgsIDEpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHZhciBvcmlnQWRkU3RyZWFtID0gd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5hZGRTdHJlYW07XG4gICAgICB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmFkZFN0cmVhbSA9IGZ1bmN0aW9uKHN0cmVhbSkge1xuICAgICAgICB2YXIgcGMgPSB0aGlzO1xuICAgICAgICBwYy5fc2VuZGVycyA9IHBjLl9zZW5kZXJzIHx8IFtdO1xuICAgICAgICBvcmlnQWRkU3RyZWFtLmFwcGx5KHBjLCBbc3RyZWFtXSk7XG4gICAgICAgIHN0cmVhbS5nZXRUcmFja3MoKS5mb3JFYWNoKGZ1bmN0aW9uKHRyYWNrKSB7XG4gICAgICAgICAgcGMuX3NlbmRlcnMucHVzaChzaGltU2VuZGVyV2l0aER0bWYocGMsIHRyYWNrKSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgdmFyIG9yaWdSZW1vdmVTdHJlYW0gPSB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLnJlbW92ZVN0cmVhbTtcbiAgICAgIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUucmVtb3ZlU3RyZWFtID0gZnVuY3Rpb24oc3RyZWFtKSB7XG4gICAgICAgIHZhciBwYyA9IHRoaXM7XG4gICAgICAgIHBjLl9zZW5kZXJzID0gcGMuX3NlbmRlcnMgfHwgW107XG4gICAgICAgIG9yaWdSZW1vdmVTdHJlYW0uYXBwbHkocGMsIFtzdHJlYW1dKTtcblxuICAgICAgICBzdHJlYW0uZ2V0VHJhY2tzKCkuZm9yRWFjaChmdW5jdGlvbih0cmFjaykge1xuICAgICAgICAgIHZhciBzZW5kZXIgPSBwYy5fc2VuZGVycy5maW5kKGZ1bmN0aW9uKHMpIHtcbiAgICAgICAgICAgIHJldHVybiBzLnRyYWNrID09PSB0cmFjaztcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBpZiAoc2VuZGVyKSB7XG4gICAgICAgICAgICBwYy5fc2VuZGVycy5zcGxpY2UocGMuX3NlbmRlcnMuaW5kZXhPZihzZW5kZXIpLCAxKTsgLy8gcmVtb3ZlIHNlbmRlclxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ29iamVjdCcgJiYgd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uICYmXG4gICAgICAgICAgICAgICAnZ2V0U2VuZGVycycgaW4gd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZSAmJlxuICAgICAgICAgICAgICAgJ2NyZWF0ZURUTUZTZW5kZXInIGluIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUgJiZcbiAgICAgICAgICAgICAgIHdpbmRvdy5SVENSdHBTZW5kZXIgJiZcbiAgICAgICAgICAgICAgICEoJ2R0bWYnIGluIHdpbmRvdy5SVENSdHBTZW5kZXIucHJvdG90eXBlKSkge1xuICAgICAgdmFyIG9yaWdHZXRTZW5kZXJzID0gd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5nZXRTZW5kZXJzO1xuICAgICAgd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5nZXRTZW5kZXJzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwYyA9IHRoaXM7XG4gICAgICAgIHZhciBzZW5kZXJzID0gb3JpZ0dldFNlbmRlcnMuYXBwbHkocGMsIFtdKTtcbiAgICAgICAgc2VuZGVycy5mb3JFYWNoKGZ1bmN0aW9uKHNlbmRlcikge1xuICAgICAgICAgIHNlbmRlci5fcGMgPSBwYztcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBzZW5kZXJzO1xuICAgICAgfTtcblxuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdy5SVENSdHBTZW5kZXIucHJvdG90eXBlLCAnZHRtZicsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZiAodGhpcy5fZHRtZiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZiAodGhpcy50cmFjay5raW5kID09PSAnYXVkaW8nKSB7XG4gICAgICAgICAgICAgIHRoaXMuX2R0bWYgPSB0aGlzLl9wYy5jcmVhdGVEVE1GU2VuZGVyKHRoaXMudHJhY2spO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy5fZHRtZiA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB0aGlzLl9kdG1mO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG5cbiAgc2hpbVNlbmRlclJlY2VpdmVyR2V0U3RhdHM6IGZ1bmN0aW9uKHdpbmRvdykge1xuICAgIGlmICghKHR5cGVvZiB3aW5kb3cgPT09ICdvYmplY3QnICYmIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbiAmJlxuICAgICAgICB3aW5kb3cuUlRDUnRwU2VuZGVyICYmIHdpbmRvdy5SVENSdHBSZWNlaXZlcikpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBzaGltIHNlbmRlciBzdGF0cy5cbiAgICBpZiAoISgnZ2V0U3RhdHMnIGluIHdpbmRvdy5SVENSdHBTZW5kZXIucHJvdG90eXBlKSkge1xuICAgICAgdmFyIG9yaWdHZXRTZW5kZXJzID0gd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5nZXRTZW5kZXJzO1xuICAgICAgaWYgKG9yaWdHZXRTZW5kZXJzKSB7XG4gICAgICAgIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuZ2V0U2VuZGVycyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHZhciBwYyA9IHRoaXM7XG4gICAgICAgICAgdmFyIHNlbmRlcnMgPSBvcmlnR2V0U2VuZGVycy5hcHBseShwYywgW10pO1xuICAgICAgICAgIHNlbmRlcnMuZm9yRWFjaChmdW5jdGlvbihzZW5kZXIpIHtcbiAgICAgICAgICAgIHNlbmRlci5fcGMgPSBwYztcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gc2VuZGVycztcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgdmFyIG9yaWdBZGRUcmFjayA9IHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuYWRkVHJhY2s7XG4gICAgICBpZiAob3JpZ0FkZFRyYWNrKSB7XG4gICAgICAgIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuYWRkVHJhY2sgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgc2VuZGVyID0gb3JpZ0FkZFRyYWNrLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgc2VuZGVyLl9wYyA9IHRoaXM7XG4gICAgICAgICAgcmV0dXJuIHNlbmRlcjtcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHdpbmRvdy5SVENSdHBTZW5kZXIucHJvdG90eXBlLmdldFN0YXRzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzZW5kZXIgPSB0aGlzO1xuICAgICAgICByZXR1cm4gdGhpcy5fcGMuZ2V0U3RhdHMoKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgICAgICAgIC8qIE5vdGU6IHRoaXMgd2lsbCBpbmNsdWRlIHN0YXRzIG9mIGFsbCBzZW5kZXJzIHRoYXRcbiAgICAgICAgICAgKiAgIHNlbmQgYSB0cmFjayB3aXRoIHRoZSBzYW1lIGlkIGFzIHNlbmRlci50cmFjayBhc1xuICAgICAgICAgICAqICAgaXQgaXMgbm90IHBvc3NpYmxlIHRvIGlkZW50aWZ5IHRoZSBSVENSdHBTZW5kZXIuXG4gICAgICAgICAgICovXG4gICAgICAgICAgcmV0dXJuIGZpbHRlclN0YXRzKHJlc3VsdCwgc2VuZGVyLnRyYWNrLCB0cnVlKTtcbiAgICAgICAgfSk7XG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIHNoaW0gcmVjZWl2ZXIgc3RhdHMuXG4gICAgaWYgKCEoJ2dldFN0YXRzJyBpbiB3aW5kb3cuUlRDUnRwUmVjZWl2ZXIucHJvdG90eXBlKSkge1xuICAgICAgdmFyIG9yaWdHZXRSZWNlaXZlcnMgPSB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmdldFJlY2VpdmVycztcbiAgICAgIGlmIChvcmlnR2V0UmVjZWl2ZXJzKSB7XG4gICAgICAgIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuZ2V0UmVjZWl2ZXJzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyIHBjID0gdGhpcztcbiAgICAgICAgICB2YXIgcmVjZWl2ZXJzID0gb3JpZ0dldFJlY2VpdmVycy5hcHBseShwYywgW10pO1xuICAgICAgICAgIHJlY2VpdmVycy5mb3JFYWNoKGZ1bmN0aW9uKHJlY2VpdmVyKSB7XG4gICAgICAgICAgICByZWNlaXZlci5fcGMgPSBwYztcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gcmVjZWl2ZXJzO1xuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgdXRpbHMud3JhcFBlZXJDb25uZWN0aW9uRXZlbnQod2luZG93LCAndHJhY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGUucmVjZWl2ZXIuX3BjID0gZS5zcmNFbGVtZW50O1xuICAgICAgICByZXR1cm4gZTtcbiAgICAgIH0pO1xuICAgICAgd2luZG93LlJUQ1J0cFJlY2VpdmVyLnByb3RvdHlwZS5nZXRTdGF0cyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcmVjZWl2ZXIgPSB0aGlzO1xuICAgICAgICByZXR1cm4gdGhpcy5fcGMuZ2V0U3RhdHMoKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgICAgICAgIHJldHVybiBmaWx0ZXJTdGF0cyhyZXN1bHQsIHJlY2VpdmVyLnRyYWNrLCBmYWxzZSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICB9XG5cbiAgICBpZiAoISgnZ2V0U3RhdHMnIGluIHdpbmRvdy5SVENSdHBTZW5kZXIucHJvdG90eXBlICYmXG4gICAgICAgICdnZXRTdGF0cycgaW4gd2luZG93LlJUQ1J0cFJlY2VpdmVyLnByb3RvdHlwZSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBzaGltIFJUQ1BlZXJDb25uZWN0aW9uLmdldFN0YXRzKHRyYWNrKS5cbiAgICB2YXIgb3JpZ0dldFN0YXRzID0gd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5nZXRTdGF0cztcbiAgICB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmdldFN0YXRzID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcGMgPSB0aGlzO1xuICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAwICYmXG4gICAgICAgICAgYXJndW1lbnRzWzBdIGluc3RhbmNlb2Ygd2luZG93Lk1lZGlhU3RyZWFtVHJhY2spIHtcbiAgICAgICAgdmFyIHRyYWNrID0gYXJndW1lbnRzWzBdO1xuICAgICAgICB2YXIgc2VuZGVyO1xuICAgICAgICB2YXIgcmVjZWl2ZXI7XG4gICAgICAgIHZhciBlcnI7XG4gICAgICAgIHBjLmdldFNlbmRlcnMoKS5mb3JFYWNoKGZ1bmN0aW9uKHMpIHtcbiAgICAgICAgICBpZiAocy50cmFjayA9PT0gdHJhY2spIHtcbiAgICAgICAgICAgIGlmIChzZW5kZXIpIHtcbiAgICAgICAgICAgICAgZXJyID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHNlbmRlciA9IHM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcGMuZ2V0UmVjZWl2ZXJzKCkuZm9yRWFjaChmdW5jdGlvbihyKSB7XG4gICAgICAgICAgaWYgKHIudHJhY2sgPT09IHRyYWNrKSB7XG4gICAgICAgICAgICBpZiAocmVjZWl2ZXIpIHtcbiAgICAgICAgICAgICAgZXJyID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJlY2VpdmVyID0gcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHIudHJhY2sgPT09IHRyYWNrO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGVyciB8fCAoc2VuZGVyICYmIHJlY2VpdmVyKSkge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRE9NRXhjZXB0aW9uKFxuICAgICAgICAgICAgJ1RoZXJlIGFyZSBtb3JlIHRoYW4gb25lIHNlbmRlciBvciByZWNlaXZlciBmb3IgdGhlIHRyYWNrLicsXG4gICAgICAgICAgICAnSW52YWxpZEFjY2Vzc0Vycm9yJykpO1xuICAgICAgICB9IGVsc2UgaWYgKHNlbmRlcikge1xuICAgICAgICAgIHJldHVybiBzZW5kZXIuZ2V0U3RhdHMoKTtcbiAgICAgICAgfSBlbHNlIGlmIChyZWNlaXZlcikge1xuICAgICAgICAgIHJldHVybiByZWNlaXZlci5nZXRTdGF0cygpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRE9NRXhjZXB0aW9uKFxuICAgICAgICAgICdUaGVyZSBpcyBubyBzZW5kZXIgb3IgcmVjZWl2ZXIgZm9yIHRoZSB0cmFjay4nLFxuICAgICAgICAgICdJbnZhbGlkQWNjZXNzRXJyb3InKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gb3JpZ0dldFN0YXRzLmFwcGx5KHBjLCBhcmd1bWVudHMpO1xuICAgIH07XG4gIH0sXG5cbiAgc2hpbVNvdXJjZU9iamVjdDogZnVuY3Rpb24od2luZG93KSB7XG4gICAgdmFyIFVSTCA9IHdpbmRvdyAmJiB3aW5kb3cuVVJMO1xuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICdvYmplY3QnKSB7XG4gICAgICBpZiAod2luZG93LkhUTUxNZWRpYUVsZW1lbnQgJiZcbiAgICAgICAgISgnc3JjT2JqZWN0JyBpbiB3aW5kb3cuSFRNTE1lZGlhRWxlbWVudC5wcm90b3R5cGUpKSB7XG4gICAgICAgIC8vIFNoaW0gdGhlIHNyY09iamVjdCBwcm9wZXJ0eSwgb25jZSwgd2hlbiBIVE1MTWVkaWFFbGVtZW50IGlzIGZvdW5kLlxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LkhUTUxNZWRpYUVsZW1lbnQucHJvdG90eXBlLCAnc3JjT2JqZWN0Jywge1xuICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fc3JjT2JqZWN0O1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2V0OiBmdW5jdGlvbihzdHJlYW0pIHtcbiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgICAgIC8vIFVzZSBfc3JjT2JqZWN0IGFzIGEgcHJpdmF0ZSBwcm9wZXJ0eSBmb3IgdGhpcyBzaGltXG4gICAgICAgICAgICB0aGlzLl9zcmNPYmplY3QgPSBzdHJlYW07XG4gICAgICAgICAgICBpZiAodGhpcy5zcmMpIHtcbiAgICAgICAgICAgICAgVVJMLnJldm9rZU9iamVjdFVSTCh0aGlzLnNyYyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghc3RyZWFtKSB7XG4gICAgICAgICAgICAgIHRoaXMuc3JjID0gJyc7XG4gICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnNyYyA9IFVSTC5jcmVhdGVPYmplY3RVUkwoc3RyZWFtKTtcbiAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gcmVjcmVhdGUgdGhlIGJsb2IgdXJsIHdoZW4gYSB0cmFjayBpcyBhZGRlZCBvclxuICAgICAgICAgICAgLy8gcmVtb3ZlZC4gRG9pbmcgaXQgbWFudWFsbHkgc2luY2Ugd2Ugd2FudCB0byBhdm9pZCBhIHJlY3Vyc2lvbi5cbiAgICAgICAgICAgIHN0cmVhbS5hZGRFdmVudExpc3RlbmVyKCdhZGR0cmFjaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICBpZiAoc2VsZi5zcmMpIHtcbiAgICAgICAgICAgICAgICBVUkwucmV2b2tlT2JqZWN0VVJMKHNlbGYuc3JjKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBzZWxmLnNyYyA9IFVSTC5jcmVhdGVPYmplY3RVUkwoc3RyZWFtKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc3RyZWFtLmFkZEV2ZW50TGlzdGVuZXIoJ3JlbW92ZXRyYWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIGlmIChzZWxmLnNyYykge1xuICAgICAgICAgICAgICAgIFVSTC5yZXZva2VPYmplY3RVUkwoc2VsZi5zcmMpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHNlbGYuc3JjID0gVVJMLmNyZWF0ZU9iamVjdFVSTChzdHJlYW0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgc2hpbUFkZFRyYWNrUmVtb3ZlVHJhY2tXaXRoTmF0aXZlOiBmdW5jdGlvbih3aW5kb3cpIHtcbiAgICAvLyBzaGltIGFkZFRyYWNrL3JlbW92ZVRyYWNrIHdpdGggbmF0aXZlIHZhcmlhbnRzIGluIG9yZGVyIHRvIG1ha2VcbiAgICAvLyB0aGUgaW50ZXJhY3Rpb25zIHdpdGggbGVnYWN5IGdldExvY2FsU3RyZWFtcyBiZWhhdmUgYXMgaW4gb3RoZXIgYnJvd3NlcnMuXG4gICAgLy8gS2VlcHMgYSBtYXBwaW5nIHN0cmVhbS5pZCA9PiBbc3RyZWFtLCBydHBzZW5kZXJzLi4uXVxuICAgIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuZ2V0TG9jYWxTdHJlYW1zID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcGMgPSB0aGlzO1xuICAgICAgdGhpcy5fc2hpbW1lZExvY2FsU3RyZWFtcyA9IHRoaXMuX3NoaW1tZWRMb2NhbFN0cmVhbXMgfHwge307XG4gICAgICByZXR1cm4gT2JqZWN0LmtleXModGhpcy5fc2hpbW1lZExvY2FsU3RyZWFtcykubWFwKGZ1bmN0aW9uKHN0cmVhbUlkKSB7XG4gICAgICAgIHJldHVybiBwYy5fc2hpbW1lZExvY2FsU3RyZWFtc1tzdHJlYW1JZF1bMF07XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgdmFyIG9yaWdBZGRUcmFjayA9IHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuYWRkVHJhY2s7XG4gICAgd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5hZGRUcmFjayA9IGZ1bmN0aW9uKHRyYWNrLCBzdHJlYW0pIHtcbiAgICAgIGlmICghc3RyZWFtKSB7XG4gICAgICAgIHJldHVybiBvcmlnQWRkVHJhY2suYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX3NoaW1tZWRMb2NhbFN0cmVhbXMgPSB0aGlzLl9zaGltbWVkTG9jYWxTdHJlYW1zIHx8IHt9O1xuXG4gICAgICB2YXIgc2VuZGVyID0gb3JpZ0FkZFRyYWNrLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAoIXRoaXMuX3NoaW1tZWRMb2NhbFN0cmVhbXNbc3RyZWFtLmlkXSkge1xuICAgICAgICB0aGlzLl9zaGltbWVkTG9jYWxTdHJlYW1zW3N0cmVhbS5pZF0gPSBbc3RyZWFtLCBzZW5kZXJdO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLl9zaGltbWVkTG9jYWxTdHJlYW1zW3N0cmVhbS5pZF0uaW5kZXhPZihzZW5kZXIpID09PSAtMSkge1xuICAgICAgICB0aGlzLl9zaGltbWVkTG9jYWxTdHJlYW1zW3N0cmVhbS5pZF0ucHVzaChzZW5kZXIpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHNlbmRlcjtcbiAgICB9O1xuXG4gICAgdmFyIG9yaWdBZGRTdHJlYW0gPSB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmFkZFN0cmVhbTtcbiAgICB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmFkZFN0cmVhbSA9IGZ1bmN0aW9uKHN0cmVhbSkge1xuICAgICAgdmFyIHBjID0gdGhpcztcbiAgICAgIHRoaXMuX3NoaW1tZWRMb2NhbFN0cmVhbXMgPSB0aGlzLl9zaGltbWVkTG9jYWxTdHJlYW1zIHx8IHt9O1xuXG4gICAgICBzdHJlYW0uZ2V0VHJhY2tzKCkuZm9yRWFjaChmdW5jdGlvbih0cmFjaykge1xuICAgICAgICB2YXIgYWxyZWFkeUV4aXN0cyA9IHBjLmdldFNlbmRlcnMoKS5maW5kKGZ1bmN0aW9uKHMpIHtcbiAgICAgICAgICByZXR1cm4gcy50cmFjayA9PT0gdHJhY2s7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoYWxyZWFkeUV4aXN0cykge1xuICAgICAgICAgIHRocm93IG5ldyBET01FeGNlcHRpb24oJ1RyYWNrIGFscmVhZHkgZXhpc3RzLicsXG4gICAgICAgICAgICAgICdJbnZhbGlkQWNjZXNzRXJyb3InKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB2YXIgZXhpc3RpbmdTZW5kZXJzID0gcGMuZ2V0U2VuZGVycygpO1xuICAgICAgb3JpZ0FkZFN0cmVhbS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgdmFyIG5ld1NlbmRlcnMgPSBwYy5nZXRTZW5kZXJzKCkuZmlsdGVyKGZ1bmN0aW9uKG5ld1NlbmRlcikge1xuICAgICAgICByZXR1cm4gZXhpc3RpbmdTZW5kZXJzLmluZGV4T2YobmV3U2VuZGVyKSA9PT0gLTE7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuX3NoaW1tZWRMb2NhbFN0cmVhbXNbc3RyZWFtLmlkXSA9IFtzdHJlYW1dLmNvbmNhdChuZXdTZW5kZXJzKTtcbiAgICB9O1xuXG4gICAgdmFyIG9yaWdSZW1vdmVTdHJlYW0gPSB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLnJlbW92ZVN0cmVhbTtcbiAgICB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLnJlbW92ZVN0cmVhbSA9IGZ1bmN0aW9uKHN0cmVhbSkge1xuICAgICAgdGhpcy5fc2hpbW1lZExvY2FsU3RyZWFtcyA9IHRoaXMuX3NoaW1tZWRMb2NhbFN0cmVhbXMgfHwge307XG4gICAgICBkZWxldGUgdGhpcy5fc2hpbW1lZExvY2FsU3RyZWFtc1tzdHJlYW0uaWRdO1xuICAgICAgcmV0dXJuIG9yaWdSZW1vdmVTdHJlYW0uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9O1xuXG4gICAgdmFyIG9yaWdSZW1vdmVUcmFjayA9IHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUucmVtb3ZlVHJhY2s7XG4gICAgd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5yZW1vdmVUcmFjayA9IGZ1bmN0aW9uKHNlbmRlcikge1xuICAgICAgdmFyIHBjID0gdGhpcztcbiAgICAgIHRoaXMuX3NoaW1tZWRMb2NhbFN0cmVhbXMgPSB0aGlzLl9zaGltbWVkTG9jYWxTdHJlYW1zIHx8IHt9O1xuICAgICAgaWYgKHNlbmRlcikge1xuICAgICAgICBPYmplY3Qua2V5cyh0aGlzLl9zaGltbWVkTG9jYWxTdHJlYW1zKS5mb3JFYWNoKGZ1bmN0aW9uKHN0cmVhbUlkKSB7XG4gICAgICAgICAgdmFyIGlkeCA9IHBjLl9zaGltbWVkTG9jYWxTdHJlYW1zW3N0cmVhbUlkXS5pbmRleE9mKHNlbmRlcik7XG4gICAgICAgICAgaWYgKGlkeCAhPT0gLTEpIHtcbiAgICAgICAgICAgIHBjLl9zaGltbWVkTG9jYWxTdHJlYW1zW3N0cmVhbUlkXS5zcGxpY2UoaWR4LCAxKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHBjLl9zaGltbWVkTG9jYWxTdHJlYW1zW3N0cmVhbUlkXS5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgIGRlbGV0ZSBwYy5fc2hpbW1lZExvY2FsU3RyZWFtc1tzdHJlYW1JZF07XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBvcmlnUmVtb3ZlVHJhY2suYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9O1xuICB9LFxuXG4gIHNoaW1BZGRUcmFja1JlbW92ZVRyYWNrOiBmdW5jdGlvbih3aW5kb3cpIHtcbiAgICBpZiAoIXdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgYnJvd3NlckRldGFpbHMgPSB1dGlscy5kZXRlY3RCcm93c2VyKHdpbmRvdyk7XG4gICAgLy8gc2hpbSBhZGRUcmFjayBhbmQgcmVtb3ZlVHJhY2suXG4gICAgaWYgKHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuYWRkVHJhY2sgJiZcbiAgICAgICAgYnJvd3NlckRldGFpbHMudmVyc2lvbiA+PSA2NSkge1xuICAgICAgcmV0dXJuIHRoaXMuc2hpbUFkZFRyYWNrUmVtb3ZlVHJhY2tXaXRoTmF0aXZlKHdpbmRvdyk7XG4gICAgfVxuXG4gICAgLy8gYWxzbyBzaGltIHBjLmdldExvY2FsU3RyZWFtcyB3aGVuIGFkZFRyYWNrIGlzIHNoaW1tZWRcbiAgICAvLyB0byByZXR1cm4gdGhlIG9yaWdpbmFsIHN0cmVhbXMuXG4gICAgdmFyIG9yaWdHZXRMb2NhbFN0cmVhbXMgPSB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlXG4gICAgICAgIC5nZXRMb2NhbFN0cmVhbXM7XG4gICAgd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5nZXRMb2NhbFN0cmVhbXMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBwYyA9IHRoaXM7XG4gICAgICB2YXIgbmF0aXZlU3RyZWFtcyA9IG9yaWdHZXRMb2NhbFN0cmVhbXMuYXBwbHkodGhpcyk7XG4gICAgICBwYy5fcmV2ZXJzZVN0cmVhbXMgPSBwYy5fcmV2ZXJzZVN0cmVhbXMgfHwge307XG4gICAgICByZXR1cm4gbmF0aXZlU3RyZWFtcy5tYXAoZnVuY3Rpb24oc3RyZWFtKSB7XG4gICAgICAgIHJldHVybiBwYy5fcmV2ZXJzZVN0cmVhbXNbc3RyZWFtLmlkXTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgb3JpZ0FkZFN0cmVhbSA9IHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuYWRkU3RyZWFtO1xuICAgIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuYWRkU3RyZWFtID0gZnVuY3Rpb24oc3RyZWFtKSB7XG4gICAgICB2YXIgcGMgPSB0aGlzO1xuICAgICAgcGMuX3N0cmVhbXMgPSBwYy5fc3RyZWFtcyB8fCB7fTtcbiAgICAgIHBjLl9yZXZlcnNlU3RyZWFtcyA9IHBjLl9yZXZlcnNlU3RyZWFtcyB8fCB7fTtcblxuICAgICAgc3RyZWFtLmdldFRyYWNrcygpLmZvckVhY2goZnVuY3Rpb24odHJhY2spIHtcbiAgICAgICAgdmFyIGFscmVhZHlFeGlzdHMgPSBwYy5nZXRTZW5kZXJzKCkuZmluZChmdW5jdGlvbihzKSB7XG4gICAgICAgICAgcmV0dXJuIHMudHJhY2sgPT09IHRyYWNrO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGFscmVhZHlFeGlzdHMpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRE9NRXhjZXB0aW9uKCdUcmFjayBhbHJlYWR5IGV4aXN0cy4nLFxuICAgICAgICAgICAgICAnSW52YWxpZEFjY2Vzc0Vycm9yJyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgLy8gQWRkIGlkZW50aXR5IG1hcHBpbmcgZm9yIGNvbnNpc3RlbmN5IHdpdGggYWRkVHJhY2suXG4gICAgICAvLyBVbmxlc3MgdGhpcyBpcyBiZWluZyB1c2VkIHdpdGggYSBzdHJlYW0gZnJvbSBhZGRUcmFjay5cbiAgICAgIGlmICghcGMuX3JldmVyc2VTdHJlYW1zW3N0cmVhbS5pZF0pIHtcbiAgICAgICAgdmFyIG5ld1N0cmVhbSA9IG5ldyB3aW5kb3cuTWVkaWFTdHJlYW0oc3RyZWFtLmdldFRyYWNrcygpKTtcbiAgICAgICAgcGMuX3N0cmVhbXNbc3RyZWFtLmlkXSA9IG5ld1N0cmVhbTtcbiAgICAgICAgcGMuX3JldmVyc2VTdHJlYW1zW25ld1N0cmVhbS5pZF0gPSBzdHJlYW07XG4gICAgICAgIHN0cmVhbSA9IG5ld1N0cmVhbTtcbiAgICAgIH1cbiAgICAgIG9yaWdBZGRTdHJlYW0uYXBwbHkocGMsIFtzdHJlYW1dKTtcbiAgICB9O1xuXG4gICAgdmFyIG9yaWdSZW1vdmVTdHJlYW0gPSB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLnJlbW92ZVN0cmVhbTtcbiAgICB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLnJlbW92ZVN0cmVhbSA9IGZ1bmN0aW9uKHN0cmVhbSkge1xuICAgICAgdmFyIHBjID0gdGhpcztcbiAgICAgIHBjLl9zdHJlYW1zID0gcGMuX3N0cmVhbXMgfHwge307XG4gICAgICBwYy5fcmV2ZXJzZVN0cmVhbXMgPSBwYy5fcmV2ZXJzZVN0cmVhbXMgfHwge307XG5cbiAgICAgIG9yaWdSZW1vdmVTdHJlYW0uYXBwbHkocGMsIFsocGMuX3N0cmVhbXNbc3RyZWFtLmlkXSB8fCBzdHJlYW0pXSk7XG4gICAgICBkZWxldGUgcGMuX3JldmVyc2VTdHJlYW1zWyhwYy5fc3RyZWFtc1tzdHJlYW0uaWRdID9cbiAgICAgICAgICBwYy5fc3RyZWFtc1tzdHJlYW0uaWRdLmlkIDogc3RyZWFtLmlkKV07XG4gICAgICBkZWxldGUgcGMuX3N0cmVhbXNbc3RyZWFtLmlkXTtcbiAgICB9O1xuXG4gICAgd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5hZGRUcmFjayA9IGZ1bmN0aW9uKHRyYWNrLCBzdHJlYW0pIHtcbiAgICAgIHZhciBwYyA9IHRoaXM7XG4gICAgICBpZiAocGMuc2lnbmFsaW5nU3RhdGUgPT09ICdjbG9zZWQnKSB7XG4gICAgICAgIHRocm93IG5ldyBET01FeGNlcHRpb24oXG4gICAgICAgICAgJ1RoZSBSVENQZWVyQ29ubmVjdGlvblxcJ3Mgc2lnbmFsaW5nU3RhdGUgaXMgXFwnY2xvc2VkXFwnLicsXG4gICAgICAgICAgJ0ludmFsaWRTdGF0ZUVycm9yJyk7XG4gICAgICB9XG4gICAgICB2YXIgc3RyZWFtcyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTtcbiAgICAgIGlmIChzdHJlYW1zLmxlbmd0aCAhPT0gMSB8fFxuICAgICAgICAgICFzdHJlYW1zWzBdLmdldFRyYWNrcygpLmZpbmQoZnVuY3Rpb24odCkge1xuICAgICAgICAgICAgcmV0dXJuIHQgPT09IHRyYWNrO1xuICAgICAgICAgIH0pKSB7XG4gICAgICAgIC8vIHRoaXMgaXMgbm90IGZ1bGx5IGNvcnJlY3QgYnV0IGFsbCB3ZSBjYW4gbWFuYWdlIHdpdGhvdXRcbiAgICAgICAgLy8gW1thc3NvY2lhdGVkIE1lZGlhU3RyZWFtc11dIGludGVybmFsIHNsb3QuXG4gICAgICAgIHRocm93IG5ldyBET01FeGNlcHRpb24oXG4gICAgICAgICAgJ1RoZSBhZGFwdGVyLmpzIGFkZFRyYWNrIHBvbHlmaWxsIG9ubHkgc3VwcG9ydHMgYSBzaW5nbGUgJyArXG4gICAgICAgICAgJyBzdHJlYW0gd2hpY2ggaXMgYXNzb2NpYXRlZCB3aXRoIHRoZSBzcGVjaWZpZWQgdHJhY2suJyxcbiAgICAgICAgICAnTm90U3VwcG9ydGVkRXJyb3InKTtcbiAgICAgIH1cblxuICAgICAgdmFyIGFscmVhZHlFeGlzdHMgPSBwYy5nZXRTZW5kZXJzKCkuZmluZChmdW5jdGlvbihzKSB7XG4gICAgICAgIHJldHVybiBzLnRyYWNrID09PSB0cmFjaztcbiAgICAgIH0pO1xuICAgICAgaWYgKGFscmVhZHlFeGlzdHMpIHtcbiAgICAgICAgdGhyb3cgbmV3IERPTUV4Y2VwdGlvbignVHJhY2sgYWxyZWFkeSBleGlzdHMuJyxcbiAgICAgICAgICAgICdJbnZhbGlkQWNjZXNzRXJyb3InKTtcbiAgICAgIH1cblxuICAgICAgcGMuX3N0cmVhbXMgPSBwYy5fc3RyZWFtcyB8fCB7fTtcbiAgICAgIHBjLl9yZXZlcnNlU3RyZWFtcyA9IHBjLl9yZXZlcnNlU3RyZWFtcyB8fCB7fTtcbiAgICAgIHZhciBvbGRTdHJlYW0gPSBwYy5fc3RyZWFtc1tzdHJlYW0uaWRdO1xuICAgICAgaWYgKG9sZFN0cmVhbSkge1xuICAgICAgICAvLyB0aGlzIGlzIHVzaW5nIG9kZCBDaHJvbWUgYmVoYXZpb3VyLCB1c2Ugd2l0aCBjYXV0aW9uOlxuICAgICAgICAvLyBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3Avd2VicnRjL2lzc3Vlcy9kZXRhaWw/aWQ9NzgxNVxuICAgICAgICAvLyBOb3RlOiB3ZSByZWx5IG9uIHRoZSBoaWdoLWxldmVsIGFkZFRyYWNrL2R0bWYgc2hpbSB0b1xuICAgICAgICAvLyBjcmVhdGUgdGhlIHNlbmRlciB3aXRoIGEgZHRtZiBzZW5kZXIuXG4gICAgICAgIG9sZFN0cmVhbS5hZGRUcmFjayh0cmFjayk7XG5cbiAgICAgICAgLy8gVHJpZ2dlciBPTk4gYXN5bmMuXG4gICAgICAgIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcGMuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ25lZ290aWF0aW9ubmVlZGVkJykpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBuZXdTdHJlYW0gPSBuZXcgd2luZG93Lk1lZGlhU3RyZWFtKFt0cmFja10pO1xuICAgICAgICBwYy5fc3RyZWFtc1tzdHJlYW0uaWRdID0gbmV3U3RyZWFtO1xuICAgICAgICBwYy5fcmV2ZXJzZVN0cmVhbXNbbmV3U3RyZWFtLmlkXSA9IHN0cmVhbTtcbiAgICAgICAgcGMuYWRkU3RyZWFtKG5ld1N0cmVhbSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcGMuZ2V0U2VuZGVycygpLmZpbmQoZnVuY3Rpb24ocykge1xuICAgICAgICByZXR1cm4gcy50cmFjayA9PT0gdHJhY2s7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgLy8gcmVwbGFjZSB0aGUgaW50ZXJuYWwgc3RyZWFtIGlkIHdpdGggdGhlIGV4dGVybmFsIG9uZSBhbmRcbiAgICAvLyB2aWNlIHZlcnNhLlxuICAgIGZ1bmN0aW9uIHJlcGxhY2VJbnRlcm5hbFN0cmVhbUlkKHBjLCBkZXNjcmlwdGlvbikge1xuICAgICAgdmFyIHNkcCA9IGRlc2NyaXB0aW9uLnNkcDtcbiAgICAgIE9iamVjdC5rZXlzKHBjLl9yZXZlcnNlU3RyZWFtcyB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbihpbnRlcm5hbElkKSB7XG4gICAgICAgIHZhciBleHRlcm5hbFN0cmVhbSA9IHBjLl9yZXZlcnNlU3RyZWFtc1tpbnRlcm5hbElkXTtcbiAgICAgICAgdmFyIGludGVybmFsU3RyZWFtID0gcGMuX3N0cmVhbXNbZXh0ZXJuYWxTdHJlYW0uaWRdO1xuICAgICAgICBzZHAgPSBzZHAucmVwbGFjZShuZXcgUmVnRXhwKGludGVybmFsU3RyZWFtLmlkLCAnZycpLFxuICAgICAgICAgICAgZXh0ZXJuYWxTdHJlYW0uaWQpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gbmV3IFJUQ1Nlc3Npb25EZXNjcmlwdGlvbih7XG4gICAgICAgIHR5cGU6IGRlc2NyaXB0aW9uLnR5cGUsXG4gICAgICAgIHNkcDogc2RwXG4gICAgICB9KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gcmVwbGFjZUV4dGVybmFsU3RyZWFtSWQocGMsIGRlc2NyaXB0aW9uKSB7XG4gICAgICB2YXIgc2RwID0gZGVzY3JpcHRpb24uc2RwO1xuICAgICAgT2JqZWN0LmtleXMocGMuX3JldmVyc2VTdHJlYW1zIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKGludGVybmFsSWQpIHtcbiAgICAgICAgdmFyIGV4dGVybmFsU3RyZWFtID0gcGMuX3JldmVyc2VTdHJlYW1zW2ludGVybmFsSWRdO1xuICAgICAgICB2YXIgaW50ZXJuYWxTdHJlYW0gPSBwYy5fc3RyZWFtc1tleHRlcm5hbFN0cmVhbS5pZF07XG4gICAgICAgIHNkcCA9IHNkcC5yZXBsYWNlKG5ldyBSZWdFeHAoZXh0ZXJuYWxTdHJlYW0uaWQsICdnJyksXG4gICAgICAgICAgICBpbnRlcm5hbFN0cmVhbS5pZCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBuZXcgUlRDU2Vzc2lvbkRlc2NyaXB0aW9uKHtcbiAgICAgICAgdHlwZTogZGVzY3JpcHRpb24udHlwZSxcbiAgICAgICAgc2RwOiBzZHBcbiAgICAgIH0pO1xuICAgIH1cbiAgICBbJ2NyZWF0ZU9mZmVyJywgJ2NyZWF0ZUFuc3dlciddLmZvckVhY2goZnVuY3Rpb24obWV0aG9kKSB7XG4gICAgICB2YXIgbmF0aXZlTWV0aG9kID0gd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZVttZXRob2RdO1xuICAgICAgd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZVttZXRob2RdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwYyA9IHRoaXM7XG4gICAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgICB2YXIgaXNMZWdhY3lDYWxsID0gYXJndW1lbnRzLmxlbmd0aCAmJlxuICAgICAgICAgICAgdHlwZW9mIGFyZ3VtZW50c1swXSA9PT0gJ2Z1bmN0aW9uJztcbiAgICAgICAgaWYgKGlzTGVnYWN5Q2FsbCkge1xuICAgICAgICAgIHJldHVybiBuYXRpdmVNZXRob2QuYXBwbHkocGMsIFtcbiAgICAgICAgICAgIGZ1bmN0aW9uKGRlc2NyaXB0aW9uKSB7XG4gICAgICAgICAgICAgIHZhciBkZXNjID0gcmVwbGFjZUludGVybmFsU3RyZWFtSWQocGMsIGRlc2NyaXB0aW9uKTtcbiAgICAgICAgICAgICAgYXJnc1swXS5hcHBseShudWxsLCBbZGVzY10pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgICBpZiAoYXJnc1sxXSkge1xuICAgICAgICAgICAgICAgIGFyZ3NbMV0uYXBwbHkobnVsbCwgZXJyKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgYXJndW1lbnRzWzJdXG4gICAgICAgICAgXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5hdGl2ZU1ldGhvZC5hcHBseShwYywgYXJndW1lbnRzKVxuICAgICAgICAudGhlbihmdW5jdGlvbihkZXNjcmlwdGlvbikge1xuICAgICAgICAgIHJldHVybiByZXBsYWNlSW50ZXJuYWxTdHJlYW1JZChwYywgZGVzY3JpcHRpb24pO1xuICAgICAgICB9KTtcbiAgICAgIH07XG4gICAgfSk7XG5cbiAgICB2YXIgb3JpZ1NldExvY2FsRGVzY3JpcHRpb24gPVxuICAgICAgICB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLnNldExvY2FsRGVzY3JpcHRpb247XG4gICAgd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5zZXRMb2NhbERlc2NyaXB0aW9uID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcGMgPSB0aGlzO1xuICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoIHx8ICFhcmd1bWVudHNbMF0udHlwZSkge1xuICAgICAgICByZXR1cm4gb3JpZ1NldExvY2FsRGVzY3JpcHRpb24uYXBwbHkocGMsIGFyZ3VtZW50cyk7XG4gICAgICB9XG4gICAgICBhcmd1bWVudHNbMF0gPSByZXBsYWNlRXh0ZXJuYWxTdHJlYW1JZChwYywgYXJndW1lbnRzWzBdKTtcbiAgICAgIHJldHVybiBvcmlnU2V0TG9jYWxEZXNjcmlwdGlvbi5hcHBseShwYywgYXJndW1lbnRzKTtcbiAgICB9O1xuXG4gICAgLy8gVE9ETzogbWFuZ2xlIGdldFN0YXRzOiBodHRwczovL3czYy5naXRodWIuaW8vd2VicnRjLXN0YXRzLyNkb20tcnRjbWVkaWFzdHJlYW1zdGF0cy1zdHJlYW1pZGVudGlmaWVyXG5cbiAgICB2YXIgb3JpZ0xvY2FsRGVzY3JpcHRpb24gPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKFxuICAgICAgICB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLCAnbG9jYWxEZXNjcmlwdGlvbicpO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLFxuICAgICAgICAnbG9jYWxEZXNjcmlwdGlvbicsIHtcbiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIHBjID0gdGhpcztcbiAgICAgICAgICAgIHZhciBkZXNjcmlwdGlvbiA9IG9yaWdMb2NhbERlc2NyaXB0aW9uLmdldC5hcHBseSh0aGlzKTtcbiAgICAgICAgICAgIGlmIChkZXNjcmlwdGlvbi50eXBlID09PSAnJykge1xuICAgICAgICAgICAgICByZXR1cm4gZGVzY3JpcHRpb247XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVwbGFjZUludGVybmFsU3RyZWFtSWQocGMsIGRlc2NyaXB0aW9uKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5yZW1vdmVUcmFjayA9IGZ1bmN0aW9uKHNlbmRlcikge1xuICAgICAgdmFyIHBjID0gdGhpcztcbiAgICAgIGlmIChwYy5zaWduYWxpbmdTdGF0ZSA9PT0gJ2Nsb3NlZCcpIHtcbiAgICAgICAgdGhyb3cgbmV3IERPTUV4Y2VwdGlvbihcbiAgICAgICAgICAnVGhlIFJUQ1BlZXJDb25uZWN0aW9uXFwncyBzaWduYWxpbmdTdGF0ZSBpcyBcXCdjbG9zZWRcXCcuJyxcbiAgICAgICAgICAnSW52YWxpZFN0YXRlRXJyb3InKTtcbiAgICAgIH1cbiAgICAgIC8vIFdlIGNhbiBub3QgeWV0IGNoZWNrIGZvciBzZW5kZXIgaW5zdGFuY2VvZiBSVENSdHBTZW5kZXJcbiAgICAgIC8vIHNpbmNlIHdlIHNoaW0gUlRQU2VuZGVyLiBTbyB3ZSBjaGVjayBpZiBzZW5kZXIuX3BjIGlzIHNldC5cbiAgICAgIGlmICghc2VuZGVyLl9wYykge1xuICAgICAgICB0aHJvdyBuZXcgRE9NRXhjZXB0aW9uKCdBcmd1bWVudCAxIG9mIFJUQ1BlZXJDb25uZWN0aW9uLnJlbW92ZVRyYWNrICcgK1xuICAgICAgICAgICAgJ2RvZXMgbm90IGltcGxlbWVudCBpbnRlcmZhY2UgUlRDUnRwU2VuZGVyLicsICdUeXBlRXJyb3InKTtcbiAgICAgIH1cbiAgICAgIHZhciBpc0xvY2FsID0gc2VuZGVyLl9wYyA9PT0gcGM7XG4gICAgICBpZiAoIWlzTG9jYWwpIHtcbiAgICAgICAgdGhyb3cgbmV3IERPTUV4Y2VwdGlvbignU2VuZGVyIHdhcyBub3QgY3JlYXRlZCBieSB0aGlzIGNvbm5lY3Rpb24uJyxcbiAgICAgICAgICAgICdJbnZhbGlkQWNjZXNzRXJyb3InKTtcbiAgICAgIH1cblxuICAgICAgLy8gU2VhcmNoIGZvciB0aGUgbmF0aXZlIHN0cmVhbSB0aGUgc2VuZGVycyB0cmFjayBiZWxvbmdzIHRvLlxuICAgICAgcGMuX3N0cmVhbXMgPSBwYy5fc3RyZWFtcyB8fCB7fTtcbiAgICAgIHZhciBzdHJlYW07XG4gICAgICBPYmplY3Qua2V5cyhwYy5fc3RyZWFtcykuZm9yRWFjaChmdW5jdGlvbihzdHJlYW1pZCkge1xuICAgICAgICB2YXIgaGFzVHJhY2sgPSBwYy5fc3RyZWFtc1tzdHJlYW1pZF0uZ2V0VHJhY2tzKCkuZmluZChmdW5jdGlvbih0cmFjaykge1xuICAgICAgICAgIHJldHVybiBzZW5kZXIudHJhY2sgPT09IHRyYWNrO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGhhc1RyYWNrKSB7XG4gICAgICAgICAgc3RyZWFtID0gcGMuX3N0cmVhbXNbc3RyZWFtaWRdO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgaWYgKHN0cmVhbSkge1xuICAgICAgICBpZiAoc3RyZWFtLmdldFRyYWNrcygpLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgIC8vIGlmIHRoaXMgaXMgdGhlIGxhc3QgdHJhY2sgb2YgdGhlIHN0cmVhbSwgcmVtb3ZlIHRoZSBzdHJlYW0uIFRoaXNcbiAgICAgICAgICAvLyB0YWtlcyBjYXJlIG9mIGFueSBzaGltbWVkIF9zZW5kZXJzLlxuICAgICAgICAgIHBjLnJlbW92ZVN0cmVhbShwYy5fcmV2ZXJzZVN0cmVhbXNbc3RyZWFtLmlkXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gcmVseWluZyBvbiB0aGUgc2FtZSBvZGQgY2hyb21lIGJlaGF2aW91ciBhcyBhYm92ZS5cbiAgICAgICAgICBzdHJlYW0ucmVtb3ZlVHJhY2soc2VuZGVyLnRyYWNrKTtcbiAgICAgICAgfVxuICAgICAgICBwYy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnbmVnb3RpYXRpb25uZWVkZWQnKSk7XG4gICAgICB9XG4gICAgfTtcbiAgfSxcblxuICBzaGltUGVlckNvbm5lY3Rpb246IGZ1bmN0aW9uKHdpbmRvdykge1xuICAgIHZhciBicm93c2VyRGV0YWlscyA9IHV0aWxzLmRldGVjdEJyb3dzZXIod2luZG93KTtcblxuICAgIC8vIFRoZSBSVENQZWVyQ29ubmVjdGlvbiBvYmplY3QuXG4gICAgaWYgKCF3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24gJiYgd2luZG93LndlYmtpdFJUQ1BlZXJDb25uZWN0aW9uKSB7XG4gICAgICB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24gPSBmdW5jdGlvbihwY0NvbmZpZywgcGNDb25zdHJhaW50cykge1xuICAgICAgICAvLyBUcmFuc2xhdGUgaWNlVHJhbnNwb3J0UG9saWN5IHRvIGljZVRyYW5zcG9ydHMsXG4gICAgICAgIC8vIHNlZSBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL3dlYnJ0Yy9pc3N1ZXMvZGV0YWlsP2lkPTQ4NjlcbiAgICAgICAgLy8gdGhpcyB3YXMgZml4ZWQgaW4gTTU2IGFsb25nIHdpdGggdW5wcmVmaXhpbmcgUlRDUGVlckNvbm5lY3Rpb24uXG4gICAgICAgIGxvZ2dpbmcoJ1BlZXJDb25uZWN0aW9uJyk7XG4gICAgICAgIGlmIChwY0NvbmZpZyAmJiBwY0NvbmZpZy5pY2VUcmFuc3BvcnRQb2xpY3kpIHtcbiAgICAgICAgICBwY0NvbmZpZy5pY2VUcmFuc3BvcnRzID0gcGNDb25maWcuaWNlVHJhbnNwb3J0UG9saWN5O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5ldyB3aW5kb3cud2Via2l0UlRDUGVlckNvbm5lY3Rpb24ocGNDb25maWcsIHBjQ29uc3RyYWludHMpO1xuICAgICAgfTtcbiAgICAgIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUgPVxuICAgICAgICAgIHdpbmRvdy53ZWJraXRSVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGU7XG4gICAgICAvLyB3cmFwIHN0YXRpYyBtZXRob2RzLiBDdXJyZW50bHkganVzdCBnZW5lcmF0ZUNlcnRpZmljYXRlLlxuICAgICAgaWYgKHdpbmRvdy53ZWJraXRSVENQZWVyQ29ubmVjdGlvbi5nZW5lcmF0ZUNlcnRpZmljYXRlKSB7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24sICdnZW5lcmF0ZUNlcnRpZmljYXRlJywge1xuICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gd2luZG93LndlYmtpdFJUQ1BlZXJDb25uZWN0aW9uLmdlbmVyYXRlQ2VydGlmaWNhdGU7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKCF3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgb3JpZ0dldFN0YXRzID0gd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5nZXRTdGF0cztcbiAgICB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmdldFN0YXRzID0gZnVuY3Rpb24oc2VsZWN0b3IsXG4gICAgICAgIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykge1xuICAgICAgdmFyIHBjID0gdGhpcztcbiAgICAgIHZhciBhcmdzID0gYXJndW1lbnRzO1xuXG4gICAgICAvLyBJZiBzZWxlY3RvciBpcyBhIGZ1bmN0aW9uIHRoZW4gd2UgYXJlIGluIHRoZSBvbGQgc3R5bGUgc3RhdHMgc28ganVzdFxuICAgICAgLy8gcGFzcyBiYWNrIHRoZSBvcmlnaW5hbCBnZXRTdGF0cyBmb3JtYXQgdG8gYXZvaWQgYnJlYWtpbmcgb2xkIHVzZXJzLlxuICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIHR5cGVvZiBzZWxlY3RvciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICByZXR1cm4gb3JpZ0dldFN0YXRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICB9XG5cbiAgICAgIC8vIFdoZW4gc3BlYy1zdHlsZSBnZXRTdGF0cyBpcyBzdXBwb3J0ZWQsIHJldHVybiB0aG9zZSB3aGVuIGNhbGxlZCB3aXRoXG4gICAgICAvLyBlaXRoZXIgbm8gYXJndW1lbnRzIG9yIHRoZSBzZWxlY3RvciBhcmd1bWVudCBpcyBudWxsLlxuICAgICAgaWYgKG9yaWdHZXRTdGF0cy5sZW5ndGggPT09IDAgJiYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDAgfHxcbiAgICAgICAgICB0eXBlb2YgYXJndW1lbnRzWzBdICE9PSAnZnVuY3Rpb24nKSkge1xuICAgICAgICByZXR1cm4gb3JpZ0dldFN0YXRzLmFwcGx5KHRoaXMsIFtdKTtcbiAgICAgIH1cblxuICAgICAgdmFyIGZpeENocm9tZVN0YXRzXyA9IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgIHZhciBzdGFuZGFyZFJlcG9ydCA9IHt9O1xuICAgICAgICB2YXIgcmVwb3J0cyA9IHJlc3BvbnNlLnJlc3VsdCgpO1xuICAgICAgICByZXBvcnRzLmZvckVhY2goZnVuY3Rpb24ocmVwb3J0KSB7XG4gICAgICAgICAgdmFyIHN0YW5kYXJkU3RhdHMgPSB7XG4gICAgICAgICAgICBpZDogcmVwb3J0LmlkLFxuICAgICAgICAgICAgdGltZXN0YW1wOiByZXBvcnQudGltZXN0YW1wLFxuICAgICAgICAgICAgdHlwZToge1xuICAgICAgICAgICAgICBsb2NhbGNhbmRpZGF0ZTogJ2xvY2FsLWNhbmRpZGF0ZScsXG4gICAgICAgICAgICAgIHJlbW90ZWNhbmRpZGF0ZTogJ3JlbW90ZS1jYW5kaWRhdGUnXG4gICAgICAgICAgICB9W3JlcG9ydC50eXBlXSB8fCByZXBvcnQudHlwZVxuICAgICAgICAgIH07XG4gICAgICAgICAgcmVwb3J0Lm5hbWVzKCkuZm9yRWFjaChmdW5jdGlvbihuYW1lKSB7XG4gICAgICAgICAgICBzdGFuZGFyZFN0YXRzW25hbWVdID0gcmVwb3J0LnN0YXQobmFtZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgc3RhbmRhcmRSZXBvcnRbc3RhbmRhcmRTdGF0cy5pZF0gPSBzdGFuZGFyZFN0YXRzO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gc3RhbmRhcmRSZXBvcnQ7XG4gICAgICB9O1xuXG4gICAgICAvLyBzaGltIGdldFN0YXRzIHdpdGggbWFwbGlrZSBzdXBwb3J0XG4gICAgICB2YXIgbWFrZU1hcFN0YXRzID0gZnVuY3Rpb24oc3RhdHMpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNYXAoT2JqZWN0LmtleXMoc3RhdHMpLm1hcChmdW5jdGlvbihrZXkpIHtcbiAgICAgICAgICByZXR1cm4gW2tleSwgc3RhdHNba2V5XV07XG4gICAgICAgIH0pKTtcbiAgICAgIH07XG5cbiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID49IDIpIHtcbiAgICAgICAgdmFyIHN1Y2Nlc3NDYWxsYmFja1dyYXBwZXJfID0gZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICBhcmdzWzFdKG1ha2VNYXBTdGF0cyhmaXhDaHJvbWVTdGF0c18ocmVzcG9uc2UpKSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIG9yaWdHZXRTdGF0cy5hcHBseSh0aGlzLCBbc3VjY2Vzc0NhbGxiYWNrV3JhcHBlcl8sXG4gICAgICAgICAgYXJndW1lbnRzWzBdXSk7XG4gICAgICB9XG5cbiAgICAgIC8vIHByb21pc2Utc3VwcG9ydFxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICBvcmlnR2V0U3RhdHMuYXBwbHkocGMsIFtcbiAgICAgICAgICBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgcmVzb2x2ZShtYWtlTWFwU3RhdHMoZml4Q2hyb21lU3RhdHNfKHJlc3BvbnNlKSkpO1xuICAgICAgICAgIH0sIHJlamVjdF0pO1xuICAgICAgfSkudGhlbihzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spO1xuICAgIH07XG5cbiAgICAvLyBhZGQgcHJvbWlzZSBzdXBwb3J0IC0tIG5hdGl2ZWx5IGF2YWlsYWJsZSBpbiBDaHJvbWUgNTFcbiAgICBpZiAoYnJvd3NlckRldGFpbHMudmVyc2lvbiA8IDUxKSB7XG4gICAgICBbJ3NldExvY2FsRGVzY3JpcHRpb24nLCAnc2V0UmVtb3RlRGVzY3JpcHRpb24nLCAnYWRkSWNlQ2FuZGlkYXRlJ11cbiAgICAgICAgICAuZm9yRWFjaChmdW5jdGlvbihtZXRob2QpIHtcbiAgICAgICAgICAgIHZhciBuYXRpdmVNZXRob2QgPSB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlW21ldGhvZF07XG4gICAgICAgICAgICB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlW21ldGhvZF0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICAgICAgICAgIHZhciBwYyA9IHRoaXM7XG4gICAgICAgICAgICAgIHZhciBwcm9taXNlID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgbmF0aXZlTWV0aG9kLmFwcGx5KHBjLCBbYXJnc1swXSwgcmVzb2x2ZSwgcmVqZWN0XSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBpZiAoYXJncy5sZW5ndGggPCAyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2UudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBhcmdzWzFdLmFwcGx5KG51bGwsIFtdKTtcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID49IDMpIHtcbiAgICAgICAgICAgICAgICAgIGFyZ3NbMl0uYXBwbHkobnVsbCwgW2Vycl0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIHByb21pc2Ugc3VwcG9ydCBmb3IgY3JlYXRlT2ZmZXIgYW5kIGNyZWF0ZUFuc3dlci4gQXZhaWxhYmxlICh3aXRob3V0XG4gICAgLy8gYnVncykgc2luY2UgTTUyOiBjcmJ1Zy82MTkyODlcbiAgICBpZiAoYnJvd3NlckRldGFpbHMudmVyc2lvbiA8IDUyKSB7XG4gICAgICBbJ2NyZWF0ZU9mZmVyJywgJ2NyZWF0ZUFuc3dlciddLmZvckVhY2goZnVuY3Rpb24obWV0aG9kKSB7XG4gICAgICAgIHZhciBuYXRpdmVNZXRob2QgPSB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlW21ldGhvZF07XG4gICAgICAgIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGVbbWV0aG9kXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHZhciBwYyA9IHRoaXM7XG4gICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAxIHx8IChhcmd1bWVudHMubGVuZ3RoID09PSAxICYmXG4gICAgICAgICAgICAgIHR5cGVvZiBhcmd1bWVudHNbMF0gPT09ICdvYmplY3QnKSkge1xuICAgICAgICAgICAgdmFyIG9wdHMgPSBhcmd1bWVudHMubGVuZ3RoID09PSAxID8gYXJndW1lbnRzWzBdIDogdW5kZWZpbmVkO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgICBuYXRpdmVNZXRob2QuYXBwbHkocGMsIFtyZXNvbHZlLCByZWplY3QsIG9wdHNdKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gbmF0aXZlTWV0aG9kLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBzaGltIGltcGxpY2l0IGNyZWF0aW9uIG9mIFJUQ1Nlc3Npb25EZXNjcmlwdGlvbi9SVENJY2VDYW5kaWRhdGVcbiAgICBbJ3NldExvY2FsRGVzY3JpcHRpb24nLCAnc2V0UmVtb3RlRGVzY3JpcHRpb24nLCAnYWRkSWNlQ2FuZGlkYXRlJ11cbiAgICAgICAgLmZvckVhY2goZnVuY3Rpb24obWV0aG9kKSB7XG4gICAgICAgICAgdmFyIG5hdGl2ZU1ldGhvZCA9IHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGVbbWV0aG9kXTtcbiAgICAgICAgICB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlW21ldGhvZF0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGFyZ3VtZW50c1swXSA9IG5ldyAoKG1ldGhvZCA9PT0gJ2FkZEljZUNhbmRpZGF0ZScpID9cbiAgICAgICAgICAgICAgICB3aW5kb3cuUlRDSWNlQ2FuZGlkYXRlIDpcbiAgICAgICAgICAgICAgICB3aW5kb3cuUlRDU2Vzc2lvbkRlc2NyaXB0aW9uKShhcmd1bWVudHNbMF0pO1xuICAgICAgICAgICAgcmV0dXJuIG5hdGl2ZU1ldGhvZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuXG4gICAgLy8gc3VwcG9ydCBmb3IgYWRkSWNlQ2FuZGlkYXRlKG51bGwgb3IgdW5kZWZpbmVkKVxuICAgIHZhciBuYXRpdmVBZGRJY2VDYW5kaWRhdGUgPVxuICAgICAgICB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmFkZEljZUNhbmRpZGF0ZTtcbiAgICB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmFkZEljZUNhbmRpZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKCFhcmd1bWVudHNbMF0pIHtcbiAgICAgICAgaWYgKGFyZ3VtZW50c1sxXSkge1xuICAgICAgICAgIGFyZ3VtZW50c1sxXS5hcHBseShudWxsKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbmF0aXZlQWRkSWNlQ2FuZGlkYXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgfTtcbiAgfSxcblxuICBmaXhOZWdvdGlhdGlvbk5lZWRlZDogZnVuY3Rpb24od2luZG93KSB7XG4gICAgdXRpbHMud3JhcFBlZXJDb25uZWN0aW9uRXZlbnQod2luZG93LCAnbmVnb3RpYXRpb25uZWVkZWQnLCBmdW5jdGlvbihlKSB7XG4gICAgICB2YXIgcGMgPSBlLnRhcmdldDtcbiAgICAgIGlmIChwYy5zaWduYWxpbmdTdGF0ZSAhPT0gJ3N0YWJsZScpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGU7XG4gICAgfSk7XG4gIH0sXG5cbiAgc2hpbUdldERpc3BsYXlNZWRpYTogZnVuY3Rpb24od2luZG93LCBnZXRTb3VyY2VJZCkge1xuICAgIGlmICghd2luZG93Lm5hdmlnYXRvciB8fCAhd2luZG93Lm5hdmlnYXRvci5tZWRpYURldmljZXMgfHxcbiAgICAgICAgJ2dldERpc3BsYXlNZWRpYScgaW4gd2luZG93Lm5hdmlnYXRvci5tZWRpYURldmljZXMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gZ2V0U291cmNlSWQgaXMgYSBmdW5jdGlvbiB0aGF0IHJldHVybnMgYSBwcm9taXNlIHJlc29sdmluZyB3aXRoXG4gICAgLy8gdGhlIHNvdXJjZUlkIG9mIHRoZSBzY3JlZW4vd2luZG93L3RhYiB0byBiZSBzaGFyZWQuXG4gICAgaWYgKHR5cGVvZiBnZXRTb3VyY2VJZCAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgY29uc29sZS5lcnJvcignc2hpbUdldERpc3BsYXlNZWRpYTogZ2V0U291cmNlSWQgYXJndW1lbnQgaXMgbm90ICcgK1xuICAgICAgICAgICdhIGZ1bmN0aW9uJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHdpbmRvdy5uYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldERpc3BsYXlNZWRpYSA9IGZ1bmN0aW9uKGNvbnN0cmFpbnRzKSB7XG4gICAgICByZXR1cm4gZ2V0U291cmNlSWQoY29uc3RyYWludHMpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKHNvdXJjZUlkKSB7XG4gICAgICAgICAgdmFyIHdpZHRoU3BlY2lmaWVkID0gY29uc3RyYWludHMudmlkZW8gJiYgY29uc3RyYWludHMudmlkZW8ud2lkdGg7XG4gICAgICAgICAgdmFyIGhlaWdodFNwZWNpZmllZCA9IGNvbnN0cmFpbnRzLnZpZGVvICYmIGNvbnN0cmFpbnRzLnZpZGVvLmhlaWdodDtcbiAgICAgICAgICB2YXIgZnJhbWVSYXRlU3BlY2lmaWVkID0gY29uc3RyYWludHMudmlkZW8gJiZcbiAgICAgICAgICAgIGNvbnN0cmFpbnRzLnZpZGVvLmZyYW1lUmF0ZTtcbiAgICAgICAgICBjb25zdHJhaW50cy52aWRlbyA9IHtcbiAgICAgICAgICAgIG1hbmRhdG9yeToge1xuICAgICAgICAgICAgICBjaHJvbWVNZWRpYVNvdXJjZTogJ2Rlc2t0b3AnLFxuICAgICAgICAgICAgICBjaHJvbWVNZWRpYVNvdXJjZUlkOiBzb3VyY2VJZCxcbiAgICAgICAgICAgICAgbWF4RnJhbWVSYXRlOiBmcmFtZVJhdGVTcGVjaWZpZWQgfHwgM1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgICAgaWYgKHdpZHRoU3BlY2lmaWVkKSB7XG4gICAgICAgICAgICBjb25zdHJhaW50cy52aWRlby5tYW5kYXRvcnkubWF4V2lkdGggPSB3aWR0aFNwZWNpZmllZDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGhlaWdodFNwZWNpZmllZCkge1xuICAgICAgICAgICAgY29uc3RyYWludHMudmlkZW8ubWFuZGF0b3J5Lm1heEhlaWdodCA9IGhlaWdodFNwZWNpZmllZDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHdpbmRvdy5uYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYShjb25zdHJhaW50cyk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgd2luZG93Lm5hdmlnYXRvci5nZXREaXNwbGF5TWVkaWEgPSBmdW5jdGlvbihjb25zdHJhaW50cykge1xuICAgICAgdXRpbHMuZGVwcmVjYXRlZCgnbmF2aWdhdG9yLmdldERpc3BsYXlNZWRpYScsXG4gICAgICAgICAgJ25hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0RGlzcGxheU1lZGlhJyk7XG4gICAgICByZXR1cm4gd2luZG93Lm5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0RGlzcGxheU1lZGlhKGNvbnN0cmFpbnRzKTtcbiAgICB9O1xuICB9XG59O1xuIiwiLypcbiAqICBDb3B5cmlnaHQgKGMpIDIwMTYgVGhlIFdlYlJUQyBwcm9qZWN0IGF1dGhvcnMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzIGdvdmVybmVkIGJ5IGEgQlNELXN0eWxlIGxpY2Vuc2VcbiAqICB0aGF0IGNhbiBiZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSByb290IG9mIHRoZSBzb3VyY2VcbiAqICB0cmVlLlxuICovXG4gLyogZXNsaW50LWVudiBub2RlICovXG4ndXNlIHN0cmljdCc7XG52YXIgdXRpbHMgPSByZXF1aXJlKCcuLi91dGlscy5qcycpO1xudmFyIGxvZ2dpbmcgPSB1dGlscy5sb2c7XG5cbi8vIEV4cG9zZSBwdWJsaWMgbWV0aG9kcy5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24od2luZG93KSB7XG4gIHZhciBicm93c2VyRGV0YWlscyA9IHV0aWxzLmRldGVjdEJyb3dzZXIod2luZG93KTtcbiAgdmFyIG5hdmlnYXRvciA9IHdpbmRvdyAmJiB3aW5kb3cubmF2aWdhdG9yO1xuXG4gIHZhciBjb25zdHJhaW50c1RvQ2hyb21lXyA9IGZ1bmN0aW9uKGMpIHtcbiAgICBpZiAodHlwZW9mIGMgIT09ICdvYmplY3QnIHx8IGMubWFuZGF0b3J5IHx8IGMub3B0aW9uYWwpIHtcbiAgICAgIHJldHVybiBjO1xuICAgIH1cbiAgICB2YXIgY2MgPSB7fTtcbiAgICBPYmplY3Qua2V5cyhjKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuICAgICAgaWYgKGtleSA9PT0gJ3JlcXVpcmUnIHx8IGtleSA9PT0gJ2FkdmFuY2VkJyB8fCBrZXkgPT09ICdtZWRpYVNvdXJjZScpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdmFyIHIgPSAodHlwZW9mIGNba2V5XSA9PT0gJ29iamVjdCcpID8gY1trZXldIDoge2lkZWFsOiBjW2tleV19O1xuICAgICAgaWYgKHIuZXhhY3QgIT09IHVuZGVmaW5lZCAmJiB0eXBlb2Ygci5leGFjdCA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgci5taW4gPSByLm1heCA9IHIuZXhhY3Q7XG4gICAgICB9XG4gICAgICB2YXIgb2xkbmFtZV8gPSBmdW5jdGlvbihwcmVmaXgsIG5hbWUpIHtcbiAgICAgICAgaWYgKHByZWZpeCkge1xuICAgICAgICAgIHJldHVybiBwcmVmaXggKyBuYW1lLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgbmFtZS5zbGljZSgxKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKG5hbWUgPT09ICdkZXZpY2VJZCcpID8gJ3NvdXJjZUlkJyA6IG5hbWU7XG4gICAgICB9O1xuICAgICAgaWYgKHIuaWRlYWwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjYy5vcHRpb25hbCA9IGNjLm9wdGlvbmFsIHx8IFtdO1xuICAgICAgICB2YXIgb2MgPSB7fTtcbiAgICAgICAgaWYgKHR5cGVvZiByLmlkZWFsID09PSAnbnVtYmVyJykge1xuICAgICAgICAgIG9jW29sZG5hbWVfKCdtaW4nLCBrZXkpXSA9IHIuaWRlYWw7XG4gICAgICAgICAgY2Mub3B0aW9uYWwucHVzaChvYyk7XG4gICAgICAgICAgb2MgPSB7fTtcbiAgICAgICAgICBvY1tvbGRuYW1lXygnbWF4Jywga2V5KV0gPSByLmlkZWFsO1xuICAgICAgICAgIGNjLm9wdGlvbmFsLnB1c2gob2MpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG9jW29sZG5hbWVfKCcnLCBrZXkpXSA9IHIuaWRlYWw7XG4gICAgICAgICAgY2Mub3B0aW9uYWwucHVzaChvYyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChyLmV4YWN0ICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIHIuZXhhY3QgIT09ICdudW1iZXInKSB7XG4gICAgICAgIGNjLm1hbmRhdG9yeSA9IGNjLm1hbmRhdG9yeSB8fCB7fTtcbiAgICAgICAgY2MubWFuZGF0b3J5W29sZG5hbWVfKCcnLCBrZXkpXSA9IHIuZXhhY3Q7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBbJ21pbicsICdtYXgnXS5mb3JFYWNoKGZ1bmN0aW9uKG1peCkge1xuICAgICAgICAgIGlmIChyW21peF0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgY2MubWFuZGF0b3J5ID0gY2MubWFuZGF0b3J5IHx8IHt9O1xuICAgICAgICAgICAgY2MubWFuZGF0b3J5W29sZG5hbWVfKG1peCwga2V5KV0gPSByW21peF07XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAoYy5hZHZhbmNlZCkge1xuICAgICAgY2Mub3B0aW9uYWwgPSAoY2Mub3B0aW9uYWwgfHwgW10pLmNvbmNhdChjLmFkdmFuY2VkKTtcbiAgICB9XG4gICAgcmV0dXJuIGNjO1xuICB9O1xuXG4gIHZhciBzaGltQ29uc3RyYWludHNfID0gZnVuY3Rpb24oY29uc3RyYWludHMsIGZ1bmMpIHtcbiAgICBpZiAoYnJvd3NlckRldGFpbHMudmVyc2lvbiA+PSA2MSkge1xuICAgICAgcmV0dXJuIGZ1bmMoY29uc3RyYWludHMpO1xuICAgIH1cbiAgICBjb25zdHJhaW50cyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY29uc3RyYWludHMpKTtcbiAgICBpZiAoY29uc3RyYWludHMgJiYgdHlwZW9mIGNvbnN0cmFpbnRzLmF1ZGlvID09PSAnb2JqZWN0Jykge1xuICAgICAgdmFyIHJlbWFwID0gZnVuY3Rpb24ob2JqLCBhLCBiKSB7XG4gICAgICAgIGlmIChhIGluIG9iaiAmJiAhKGIgaW4gb2JqKSkge1xuICAgICAgICAgIG9ialtiXSA9IG9ialthXTtcbiAgICAgICAgICBkZWxldGUgb2JqW2FdO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgY29uc3RyYWludHMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNvbnN0cmFpbnRzKSk7XG4gICAgICByZW1hcChjb25zdHJhaW50cy5hdWRpbywgJ2F1dG9HYWluQ29udHJvbCcsICdnb29nQXV0b0dhaW5Db250cm9sJyk7XG4gICAgICByZW1hcChjb25zdHJhaW50cy5hdWRpbywgJ25vaXNlU3VwcHJlc3Npb24nLCAnZ29vZ05vaXNlU3VwcHJlc3Npb24nKTtcbiAgICAgIGNvbnN0cmFpbnRzLmF1ZGlvID0gY29uc3RyYWludHNUb0Nocm9tZV8oY29uc3RyYWludHMuYXVkaW8pO1xuICAgIH1cbiAgICBpZiAoY29uc3RyYWludHMgJiYgdHlwZW9mIGNvbnN0cmFpbnRzLnZpZGVvID09PSAnb2JqZWN0Jykge1xuICAgICAgLy8gU2hpbSBmYWNpbmdNb2RlIGZvciBtb2JpbGUgJiBzdXJmYWNlIHByby5cbiAgICAgIHZhciBmYWNlID0gY29uc3RyYWludHMudmlkZW8uZmFjaW5nTW9kZTtcbiAgICAgIGZhY2UgPSBmYWNlICYmICgodHlwZW9mIGZhY2UgPT09ICdvYmplY3QnKSA/IGZhY2UgOiB7aWRlYWw6IGZhY2V9KTtcbiAgICAgIHZhciBnZXRTdXBwb3J0ZWRGYWNpbmdNb2RlTGllcyA9IGJyb3dzZXJEZXRhaWxzLnZlcnNpb24gPCA2NjtcblxuICAgICAgaWYgKChmYWNlICYmIChmYWNlLmV4YWN0ID09PSAndXNlcicgfHwgZmFjZS5leGFjdCA9PT0gJ2Vudmlyb25tZW50JyB8fFxuICAgICAgICAgICAgICAgICAgICBmYWNlLmlkZWFsID09PSAndXNlcicgfHwgZmFjZS5pZGVhbCA9PT0gJ2Vudmlyb25tZW50JykpICYmXG4gICAgICAgICAgIShuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFN1cHBvcnRlZENvbnN0cmFpbnRzICYmXG4gICAgICAgICAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFN1cHBvcnRlZENvbnN0cmFpbnRzKCkuZmFjaW5nTW9kZSAmJlxuICAgICAgICAgICAgIWdldFN1cHBvcnRlZEZhY2luZ01vZGVMaWVzKSkge1xuICAgICAgICBkZWxldGUgY29uc3RyYWludHMudmlkZW8uZmFjaW5nTW9kZTtcbiAgICAgICAgdmFyIG1hdGNoZXM7XG4gICAgICAgIGlmIChmYWNlLmV4YWN0ID09PSAnZW52aXJvbm1lbnQnIHx8IGZhY2UuaWRlYWwgPT09ICdlbnZpcm9ubWVudCcpIHtcbiAgICAgICAgICBtYXRjaGVzID0gWydiYWNrJywgJ3JlYXInXTtcbiAgICAgICAgfSBlbHNlIGlmIChmYWNlLmV4YWN0ID09PSAndXNlcicgfHwgZmFjZS5pZGVhbCA9PT0gJ3VzZXInKSB7XG4gICAgICAgICAgbWF0Y2hlcyA9IFsnZnJvbnQnXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobWF0Y2hlcykge1xuICAgICAgICAgIC8vIExvb2sgZm9yIG1hdGNoZXMgaW4gbGFiZWwsIG9yIHVzZSBsYXN0IGNhbSBmb3IgYmFjayAodHlwaWNhbCkuXG4gICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci5tZWRpYURldmljZXMuZW51bWVyYXRlRGV2aWNlcygpXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGV2aWNlcykge1xuICAgICAgICAgICAgZGV2aWNlcyA9IGRldmljZXMuZmlsdGVyKGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGQua2luZCA9PT0gJ3ZpZGVvaW5wdXQnO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2YXIgZGV2ID0gZGV2aWNlcy5maW5kKGZ1bmN0aW9uKGQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXMuc29tZShmdW5jdGlvbihtYXRjaCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBkLmxhYmVsLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihtYXRjaCkgIT09IC0xO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKCFkZXYgJiYgZGV2aWNlcy5sZW5ndGggJiYgbWF0Y2hlcy5pbmRleE9mKCdiYWNrJykgIT09IC0xKSB7XG4gICAgICAgICAgICAgIGRldiA9IGRldmljZXNbZGV2aWNlcy5sZW5ndGggLSAxXTsgLy8gbW9yZSBsaWtlbHkgdGhlIGJhY2sgY2FtXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZGV2KSB7XG4gICAgICAgICAgICAgIGNvbnN0cmFpbnRzLnZpZGVvLmRldmljZUlkID0gZmFjZS5leGFjdCA/IHtleGFjdDogZGV2LmRldmljZUlkfSA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtpZGVhbDogZGV2LmRldmljZUlkfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0cmFpbnRzLnZpZGVvID0gY29uc3RyYWludHNUb0Nocm9tZV8oY29uc3RyYWludHMudmlkZW8pO1xuICAgICAgICAgICAgbG9nZ2luZygnY2hyb21lOiAnICsgSlNPTi5zdHJpbmdpZnkoY29uc3RyYWludHMpKTtcbiAgICAgICAgICAgIHJldHVybiBmdW5jKGNvbnN0cmFpbnRzKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY29uc3RyYWludHMudmlkZW8gPSBjb25zdHJhaW50c1RvQ2hyb21lXyhjb25zdHJhaW50cy52aWRlbyk7XG4gICAgfVxuICAgIGxvZ2dpbmcoJ2Nocm9tZTogJyArIEpTT04uc3RyaW5naWZ5KGNvbnN0cmFpbnRzKSk7XG4gICAgcmV0dXJuIGZ1bmMoY29uc3RyYWludHMpO1xuICB9O1xuXG4gIHZhciBzaGltRXJyb3JfID0gZnVuY3Rpb24oZSkge1xuICAgIGlmIChicm93c2VyRGV0YWlscy52ZXJzaW9uID49IDY0KSB7XG4gICAgICByZXR1cm4gZTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IHtcbiAgICAgICAgUGVybWlzc2lvbkRlbmllZEVycm9yOiAnTm90QWxsb3dlZEVycm9yJyxcbiAgICAgICAgUGVybWlzc2lvbkRpc21pc3NlZEVycm9yOiAnTm90QWxsb3dlZEVycm9yJyxcbiAgICAgICAgSW52YWxpZFN0YXRlRXJyb3I6ICdOb3RBbGxvd2VkRXJyb3InLFxuICAgICAgICBEZXZpY2VzTm90Rm91bmRFcnJvcjogJ05vdEZvdW5kRXJyb3InLFxuICAgICAgICBDb25zdHJhaW50Tm90U2F0aXNmaWVkRXJyb3I6ICdPdmVyY29uc3RyYWluZWRFcnJvcicsXG4gICAgICAgIFRyYWNrU3RhcnRFcnJvcjogJ05vdFJlYWRhYmxlRXJyb3InLFxuICAgICAgICBNZWRpYURldmljZUZhaWxlZER1ZVRvU2h1dGRvd246ICdOb3RBbGxvd2VkRXJyb3InLFxuICAgICAgICBNZWRpYURldmljZUtpbGxTd2l0Y2hPbjogJ05vdEFsbG93ZWRFcnJvcicsXG4gICAgICAgIFRhYkNhcHR1cmVFcnJvcjogJ0Fib3J0RXJyb3InLFxuICAgICAgICBTY3JlZW5DYXB0dXJlRXJyb3I6ICdBYm9ydEVycm9yJyxcbiAgICAgICAgRGV2aWNlQ2FwdHVyZUVycm9yOiAnQWJvcnRFcnJvcidcbiAgICAgIH1bZS5uYW1lXSB8fCBlLm5hbWUsXG4gICAgICBtZXNzYWdlOiBlLm1lc3NhZ2UsXG4gICAgICBjb25zdHJhaW50OiBlLmNvbnN0cmFpbnQgfHwgZS5jb25zdHJhaW50TmFtZSxcbiAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubmFtZSArICh0aGlzLm1lc3NhZ2UgJiYgJzogJykgKyB0aGlzLm1lc3NhZ2U7XG4gICAgICB9XG4gICAgfTtcbiAgfTtcblxuICB2YXIgZ2V0VXNlck1lZGlhXyA9IGZ1bmN0aW9uKGNvbnN0cmFpbnRzLCBvblN1Y2Nlc3MsIG9uRXJyb3IpIHtcbiAgICBzaGltQ29uc3RyYWludHNfKGNvbnN0cmFpbnRzLCBmdW5jdGlvbihjKSB7XG4gICAgICBuYXZpZ2F0b3Iud2Via2l0R2V0VXNlck1lZGlhKGMsIG9uU3VjY2VzcywgZnVuY3Rpb24oZSkge1xuICAgICAgICBpZiAob25FcnJvcikge1xuICAgICAgICAgIG9uRXJyb3Ioc2hpbUVycm9yXyhlKSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuXG4gIG5hdmlnYXRvci5nZXRVc2VyTWVkaWEgPSBnZXRVc2VyTWVkaWFfO1xuXG4gIC8vIFJldHVybnMgdGhlIHJlc3VsdCBvZiBnZXRVc2VyTWVkaWEgYXMgYSBQcm9taXNlLlxuICB2YXIgZ2V0VXNlck1lZGlhUHJvbWlzZV8gPSBmdW5jdGlvbihjb25zdHJhaW50cykge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIG5hdmlnYXRvci5nZXRVc2VyTWVkaWEoY29uc3RyYWludHMsIHJlc29sdmUsIHJlamVjdCk7XG4gICAgfSk7XG4gIH07XG5cbiAgaWYgKCFuYXZpZ2F0b3IubWVkaWFEZXZpY2VzKSB7XG4gICAgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcyA9IHtcbiAgICAgIGdldFVzZXJNZWRpYTogZ2V0VXNlck1lZGlhUHJvbWlzZV8sXG4gICAgICBlbnVtZXJhdGVEZXZpY2VzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHtcbiAgICAgICAgICB2YXIga2luZHMgPSB7YXVkaW86ICdhdWRpb2lucHV0JywgdmlkZW86ICd2aWRlb2lucHV0J307XG4gICAgICAgICAgcmV0dXJuIHdpbmRvdy5NZWRpYVN0cmVhbVRyYWNrLmdldFNvdXJjZXMoZnVuY3Rpb24oZGV2aWNlcykge1xuICAgICAgICAgICAgcmVzb2x2ZShkZXZpY2VzLm1hcChmdW5jdGlvbihkZXZpY2UpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHtsYWJlbDogZGV2aWNlLmxhYmVsLFxuICAgICAgICAgICAgICAgIGtpbmQ6IGtpbmRzW2RldmljZS5raW5kXSxcbiAgICAgICAgICAgICAgICBkZXZpY2VJZDogZGV2aWNlLmlkLFxuICAgICAgICAgICAgICAgIGdyb3VwSWQ6ICcnfTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgZ2V0U3VwcG9ydGVkQ29uc3RyYWludHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGRldmljZUlkOiB0cnVlLCBlY2hvQ2FuY2VsbGF0aW9uOiB0cnVlLCBmYWNpbmdNb2RlOiB0cnVlLFxuICAgICAgICAgIGZyYW1lUmF0ZTogdHJ1ZSwgaGVpZ2h0OiB0cnVlLCB3aWR0aDogdHJ1ZVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuICAvLyBBIHNoaW0gZm9yIGdldFVzZXJNZWRpYSBtZXRob2Qgb24gdGhlIG1lZGlhRGV2aWNlcyBvYmplY3QuXG4gIC8vIFRPRE8oS2FwdGVuSmFuc3NvbikgcmVtb3ZlIG9uY2UgaW1wbGVtZW50ZWQgaW4gQ2hyb21lIHN0YWJsZS5cbiAgaWYgKCFuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSkge1xuICAgIG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhID0gZnVuY3Rpb24oY29uc3RyYWludHMpIHtcbiAgICAgIHJldHVybiBnZXRVc2VyTWVkaWFQcm9taXNlXyhjb25zdHJhaW50cyk7XG4gICAgfTtcbiAgfSBlbHNlIHtcbiAgICAvLyBFdmVuIHRob3VnaCBDaHJvbWUgNDUgaGFzIG5hdmlnYXRvci5tZWRpYURldmljZXMgYW5kIGEgZ2V0VXNlck1lZGlhXG4gICAgLy8gZnVuY3Rpb24gd2hpY2ggcmV0dXJucyBhIFByb21pc2UsIGl0IGRvZXMgbm90IGFjY2VwdCBzcGVjLXN0eWxlXG4gICAgLy8gY29uc3RyYWludHMuXG4gICAgdmFyIG9yaWdHZXRVc2VyTWVkaWEgPSBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYS5cbiAgICAgICAgYmluZChuYXZpZ2F0b3IubWVkaWFEZXZpY2VzKTtcbiAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSA9IGZ1bmN0aW9uKGNzKSB7XG4gICAgICByZXR1cm4gc2hpbUNvbnN0cmFpbnRzXyhjcywgZnVuY3Rpb24oYykge1xuICAgICAgICByZXR1cm4gb3JpZ0dldFVzZXJNZWRpYShjKS50aGVuKGZ1bmN0aW9uKHN0cmVhbSkge1xuICAgICAgICAgIGlmIChjLmF1ZGlvICYmICFzdHJlYW0uZ2V0QXVkaW9UcmFja3MoKS5sZW5ndGggfHxcbiAgICAgICAgICAgICAgYy52aWRlbyAmJiAhc3RyZWFtLmdldFZpZGVvVHJhY2tzKCkubGVuZ3RoKSB7XG4gICAgICAgICAgICBzdHJlYW0uZ2V0VHJhY2tzKCkuZm9yRWFjaChmdW5jdGlvbih0cmFjaykge1xuICAgICAgICAgICAgICB0cmFjay5zdG9wKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRocm93IG5ldyBET01FeGNlcHRpb24oJycsICdOb3RGb3VuZEVycm9yJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBzdHJlYW07XG4gICAgICAgIH0sIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3Qoc2hpbUVycm9yXyhlKSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfVxuXG4gIC8vIER1bW15IGRldmljZWNoYW5nZSBldmVudCBtZXRob2RzLlxuICAvLyBUT0RPKEthcHRlbkphbnNzb24pIHJlbW92ZSBvbmNlIGltcGxlbWVudGVkIGluIENocm9tZSBzdGFibGUuXG4gIGlmICh0eXBlb2YgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5hZGRFdmVudExpc3RlbmVyID09PSAndW5kZWZpbmVkJykge1xuICAgIG5hdmlnYXRvci5tZWRpYURldmljZXMuYWRkRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uKCkge1xuICAgICAgbG9nZ2luZygnRHVtbXkgbWVkaWFEZXZpY2VzLmFkZEV2ZW50TGlzdGVuZXIgY2FsbGVkLicpO1xuICAgIH07XG4gIH1cbiAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLnJlbW92ZUV2ZW50TGlzdGVuZXIgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5yZW1vdmVFdmVudExpc3RlbmVyID0gZnVuY3Rpb24oKSB7XG4gICAgICBsb2dnaW5nKCdEdW1teSBtZWRpYURldmljZXMucmVtb3ZlRXZlbnRMaXN0ZW5lciBjYWxsZWQuJyk7XG4gICAgfTtcbiAgfVxufTtcbiIsIi8qXG4gKiAgQ29weXJpZ2h0IChjKSAyMDE3IFRoZSBXZWJSVEMgcHJvamVjdCBhdXRob3JzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqICBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhIEJTRC1zdHlsZSBsaWNlbnNlXG4gKiAgdGhhdCBjYW4gYmUgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBvZiB0aGUgc291cmNlXG4gKiAgdHJlZS5cbiAqL1xuIC8qIGVzbGludC1lbnYgbm9kZSAqL1xuJ3VzZSBzdHJpY3QnO1xuXG52YXIgU0RQVXRpbHMgPSByZXF1aXJlKCdzZHAnKTtcbnZhciB1dGlscyA9IHJlcXVpcmUoJy4vdXRpbHMnKTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIHNoaW1SVENJY2VDYW5kaWRhdGU6IGZ1bmN0aW9uKHdpbmRvdykge1xuICAgIC8vIGZvdW5kYXRpb24gaXMgYXJiaXRyYXJpbHkgY2hvc2VuIGFzIGFuIGluZGljYXRvciBmb3IgZnVsbCBzdXBwb3J0IGZvclxuICAgIC8vIGh0dHBzOi8vdzNjLmdpdGh1Yi5pby93ZWJydGMtcGMvI3J0Y2ljZWNhbmRpZGF0ZS1pbnRlcmZhY2VcbiAgICBpZiAoIXdpbmRvdy5SVENJY2VDYW5kaWRhdGUgfHwgKHdpbmRvdy5SVENJY2VDYW5kaWRhdGUgJiYgJ2ZvdW5kYXRpb24nIGluXG4gICAgICAgIHdpbmRvdy5SVENJY2VDYW5kaWRhdGUucHJvdG90eXBlKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBOYXRpdmVSVENJY2VDYW5kaWRhdGUgPSB3aW5kb3cuUlRDSWNlQ2FuZGlkYXRlO1xuICAgIHdpbmRvdy5SVENJY2VDYW5kaWRhdGUgPSBmdW5jdGlvbihhcmdzKSB7XG4gICAgICAvLyBSZW1vdmUgdGhlIGE9IHdoaWNoIHNob3VsZG4ndCBiZSBwYXJ0IG9mIHRoZSBjYW5kaWRhdGUgc3RyaW5nLlxuICAgICAgaWYgKHR5cGVvZiBhcmdzID09PSAnb2JqZWN0JyAmJiBhcmdzLmNhbmRpZGF0ZSAmJlxuICAgICAgICAgIGFyZ3MuY2FuZGlkYXRlLmluZGV4T2YoJ2E9JykgPT09IDApIHtcbiAgICAgICAgYXJncyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoYXJncykpO1xuICAgICAgICBhcmdzLmNhbmRpZGF0ZSA9IGFyZ3MuY2FuZGlkYXRlLnN1YnN0cigyKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGFyZ3MuY2FuZGlkYXRlICYmIGFyZ3MuY2FuZGlkYXRlLmxlbmd0aCkge1xuICAgICAgICAvLyBBdWdtZW50IHRoZSBuYXRpdmUgY2FuZGlkYXRlIHdpdGggdGhlIHBhcnNlZCBmaWVsZHMuXG4gICAgICAgIHZhciBuYXRpdmVDYW5kaWRhdGUgPSBuZXcgTmF0aXZlUlRDSWNlQ2FuZGlkYXRlKGFyZ3MpO1xuICAgICAgICB2YXIgcGFyc2VkQ2FuZGlkYXRlID0gU0RQVXRpbHMucGFyc2VDYW5kaWRhdGUoYXJncy5jYW5kaWRhdGUpO1xuICAgICAgICB2YXIgYXVnbWVudGVkQ2FuZGlkYXRlID0gT2JqZWN0LmFzc2lnbihuYXRpdmVDYW5kaWRhdGUsXG4gICAgICAgICAgICBwYXJzZWRDYW5kaWRhdGUpO1xuXG4gICAgICAgIC8vIEFkZCBhIHNlcmlhbGl6ZXIgdGhhdCBkb2VzIG5vdCBzZXJpYWxpemUgdGhlIGV4dHJhIGF0dHJpYnV0ZXMuXG4gICAgICAgIGF1Z21lbnRlZENhbmRpZGF0ZS50b0pTT04gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY2FuZGlkYXRlOiBhdWdtZW50ZWRDYW5kaWRhdGUuY2FuZGlkYXRlLFxuICAgICAgICAgICAgc2RwTWlkOiBhdWdtZW50ZWRDYW5kaWRhdGUuc2RwTWlkLFxuICAgICAgICAgICAgc2RwTUxpbmVJbmRleDogYXVnbWVudGVkQ2FuZGlkYXRlLnNkcE1MaW5lSW5kZXgsXG4gICAgICAgICAgICB1c2VybmFtZUZyYWdtZW50OiBhdWdtZW50ZWRDYW5kaWRhdGUudXNlcm5hbWVGcmFnbWVudCxcbiAgICAgICAgICB9O1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gYXVnbWVudGVkQ2FuZGlkYXRlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG5ldyBOYXRpdmVSVENJY2VDYW5kaWRhdGUoYXJncyk7XG4gICAgfTtcbiAgICB3aW5kb3cuUlRDSWNlQ2FuZGlkYXRlLnByb3RvdHlwZSA9IE5hdGl2ZVJUQ0ljZUNhbmRpZGF0ZS5wcm90b3R5cGU7XG5cbiAgICAvLyBIb29rIHVwIHRoZSBhdWdtZW50ZWQgY2FuZGlkYXRlIGluIG9uaWNlY2FuZGlkYXRlIGFuZFxuICAgIC8vIGFkZEV2ZW50TGlzdGVuZXIoJ2ljZWNhbmRpZGF0ZScsIC4uLilcbiAgICB1dGlscy53cmFwUGVlckNvbm5lY3Rpb25FdmVudCh3aW5kb3csICdpY2VjYW5kaWRhdGUnLCBmdW5jdGlvbihlKSB7XG4gICAgICBpZiAoZS5jYW5kaWRhdGUpIHtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsICdjYW5kaWRhdGUnLCB7XG4gICAgICAgICAgdmFsdWU6IG5ldyB3aW5kb3cuUlRDSWNlQ2FuZGlkYXRlKGUuY2FuZGlkYXRlKSxcbiAgICAgICAgICB3cml0YWJsZTogJ2ZhbHNlJ1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBlO1xuICAgIH0pO1xuICB9LFxuXG4gIC8vIHNoaW1DcmVhdGVPYmplY3RVUkwgbXVzdCBiZSBjYWxsZWQgYmVmb3JlIHNoaW1Tb3VyY2VPYmplY3QgdG8gYXZvaWQgbG9vcC5cblxuICBzaGltQ3JlYXRlT2JqZWN0VVJMOiBmdW5jdGlvbih3aW5kb3cpIHtcbiAgICB2YXIgVVJMID0gd2luZG93ICYmIHdpbmRvdy5VUkw7XG5cbiAgICBpZiAoISh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JyAmJiB3aW5kb3cuSFRNTE1lZGlhRWxlbWVudCAmJlxuICAgICAgICAgICdzcmNPYmplY3QnIGluIHdpbmRvdy5IVE1MTWVkaWFFbGVtZW50LnByb3RvdHlwZSAmJlxuICAgICAgICBVUkwuY3JlYXRlT2JqZWN0VVJMICYmIFVSTC5yZXZva2VPYmplY3RVUkwpKSB7XG4gICAgICAvLyBPbmx5IHNoaW0gQ3JlYXRlT2JqZWN0VVJMIHVzaW5nIHNyY09iamVjdCBpZiBzcmNPYmplY3QgZXhpc3RzLlxuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICB2YXIgbmF0aXZlQ3JlYXRlT2JqZWN0VVJMID0gVVJMLmNyZWF0ZU9iamVjdFVSTC5iaW5kKFVSTCk7XG4gICAgdmFyIG5hdGl2ZVJldm9rZU9iamVjdFVSTCA9IFVSTC5yZXZva2VPYmplY3RVUkwuYmluZChVUkwpO1xuICAgIHZhciBzdHJlYW1zID0gbmV3IE1hcCgpLCBuZXdJZCA9IDA7XG5cbiAgICBVUkwuY3JlYXRlT2JqZWN0VVJMID0gZnVuY3Rpb24oc3RyZWFtKSB7XG4gICAgICBpZiAoJ2dldFRyYWNrcycgaW4gc3RyZWFtKSB7XG4gICAgICAgIHZhciB1cmwgPSAncG9seWJsb2I6JyArICgrK25ld0lkKTtcbiAgICAgICAgc3RyZWFtcy5zZXQodXJsLCBzdHJlYW0pO1xuICAgICAgICB1dGlscy5kZXByZWNhdGVkKCdVUkwuY3JlYXRlT2JqZWN0VVJMKHN0cmVhbSknLFxuICAgICAgICAgICAgJ2VsZW0uc3JjT2JqZWN0ID0gc3RyZWFtJyk7XG4gICAgICAgIHJldHVybiB1cmw7XG4gICAgICB9XG4gICAgICByZXR1cm4gbmF0aXZlQ3JlYXRlT2JqZWN0VVJMKHN0cmVhbSk7XG4gICAgfTtcbiAgICBVUkwucmV2b2tlT2JqZWN0VVJMID0gZnVuY3Rpb24odXJsKSB7XG4gICAgICBuYXRpdmVSZXZva2VPYmplY3RVUkwodXJsKTtcbiAgICAgIHN0cmVhbXMuZGVsZXRlKHVybCk7XG4gICAgfTtcblxuICAgIHZhciBkc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHdpbmRvdy5IVE1MTWVkaWFFbGVtZW50LnByb3RvdHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3JjJyk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdy5IVE1MTWVkaWFFbGVtZW50LnByb3RvdHlwZSwgJ3NyYycsIHtcbiAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBkc2MuZ2V0LmFwcGx5KHRoaXMpO1xuICAgICAgfSxcbiAgICAgIHNldDogZnVuY3Rpb24odXJsKSB7XG4gICAgICAgIHRoaXMuc3JjT2JqZWN0ID0gc3RyZWFtcy5nZXQodXJsKSB8fCBudWxsO1xuICAgICAgICByZXR1cm4gZHNjLnNldC5hcHBseSh0aGlzLCBbdXJsXSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgbmF0aXZlU2V0QXR0cmlidXRlID0gd2luZG93LkhUTUxNZWRpYUVsZW1lbnQucHJvdG90eXBlLnNldEF0dHJpYnV0ZTtcbiAgICB3aW5kb3cuSFRNTE1lZGlhRWxlbWVudC5wcm90b3R5cGUuc2V0QXR0cmlidXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMiAmJlxuICAgICAgICAgICgnJyArIGFyZ3VtZW50c1swXSkudG9Mb3dlckNhc2UoKSA9PT0gJ3NyYycpIHtcbiAgICAgICAgdGhpcy5zcmNPYmplY3QgPSBzdHJlYW1zLmdldChhcmd1bWVudHNbMV0pIHx8IG51bGw7XG4gICAgICB9XG4gICAgICByZXR1cm4gbmF0aXZlU2V0QXR0cmlidXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgfTtcbiAgfSxcblxuICBzaGltTWF4TWVzc2FnZVNpemU6IGZ1bmN0aW9uKHdpbmRvdykge1xuICAgIGlmICh3aW5kb3cuUlRDU2N0cFRyYW5zcG9ydCB8fCAhd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBicm93c2VyRGV0YWlscyA9IHV0aWxzLmRldGVjdEJyb3dzZXIod2luZG93KTtcblxuICAgIGlmICghKCdzY3RwJyBpbiB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlKSkge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUsICdzY3RwJywge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB0eXBlb2YgdGhpcy5fc2N0cCA9PT0gJ3VuZGVmaW5lZCcgPyBudWxsIDogdGhpcy5fc2N0cDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdmFyIHNjdHBJbkRlc2NyaXB0aW9uID0gZnVuY3Rpb24oZGVzY3JpcHRpb24pIHtcbiAgICAgIHZhciBzZWN0aW9ucyA9IFNEUFV0aWxzLnNwbGl0U2VjdGlvbnMoZGVzY3JpcHRpb24uc2RwKTtcbiAgICAgIHNlY3Rpb25zLnNoaWZ0KCk7XG4gICAgICByZXR1cm4gc2VjdGlvbnMuc29tZShmdW5jdGlvbihtZWRpYVNlY3Rpb24pIHtcbiAgICAgICAgdmFyIG1MaW5lID0gU0RQVXRpbHMucGFyc2VNTGluZShtZWRpYVNlY3Rpb24pO1xuICAgICAgICByZXR1cm4gbUxpbmUgJiYgbUxpbmUua2luZCA9PT0gJ2FwcGxpY2F0aW9uJ1xuICAgICAgICAgICAgJiYgbUxpbmUucHJvdG9jb2wuaW5kZXhPZignU0NUUCcpICE9PSAtMTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICB2YXIgZ2V0UmVtb3RlRmlyZWZveFZlcnNpb24gPSBmdW5jdGlvbihkZXNjcmlwdGlvbikge1xuICAgICAgLy8gVE9ETzogSXMgdGhlcmUgYSBiZXR0ZXIgc29sdXRpb24gZm9yIGRldGVjdGluZyBGaXJlZm94P1xuICAgICAgdmFyIG1hdGNoID0gZGVzY3JpcHRpb24uc2RwLm1hdGNoKC9tb3ppbGxhLi4uVEhJU19JU19TRFBBUlRBLShcXGQrKS8pO1xuICAgICAgaWYgKG1hdGNoID09PSBudWxsIHx8IG1hdGNoLmxlbmd0aCA8IDIpIHtcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgfVxuICAgICAgdmFyIHZlcnNpb24gPSBwYXJzZUludChtYXRjaFsxXSwgMTApO1xuICAgICAgLy8gVGVzdCBmb3IgTmFOICh5ZXMsIHRoaXMgaXMgdWdseSlcbiAgICAgIHJldHVybiB2ZXJzaW9uICE9PSB2ZXJzaW9uID8gLTEgOiB2ZXJzaW9uO1xuICAgIH07XG5cbiAgICB2YXIgZ2V0Q2FuU2VuZE1heE1lc3NhZ2VTaXplID0gZnVuY3Rpb24ocmVtb3RlSXNGaXJlZm94KSB7XG4gICAgICAvLyBFdmVyeSBpbXBsZW1lbnRhdGlvbiB3ZSBrbm93IGNhbiBzZW5kIGF0IGxlYXN0IDY0IEtpQi5cbiAgICAgIC8vIE5vdGU6IEFsdGhvdWdoIENocm9tZSBpcyB0ZWNobmljYWxseSBhYmxlIHRvIHNlbmQgdXAgdG8gMjU2IEtpQiwgdGhlXG4gICAgICAvLyAgICAgICBkYXRhIGRvZXMgbm90IHJlYWNoIHRoZSBvdGhlciBwZWVyIHJlbGlhYmx5LlxuICAgICAgLy8gICAgICAgU2VlOiBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3Avd2VicnRjL2lzc3Vlcy9kZXRhaWw/aWQ9ODQxOVxuICAgICAgdmFyIGNhblNlbmRNYXhNZXNzYWdlU2l6ZSA9IDY1NTM2O1xuICAgICAgaWYgKGJyb3dzZXJEZXRhaWxzLmJyb3dzZXIgPT09ICdmaXJlZm94Jykge1xuICAgICAgICBpZiAoYnJvd3NlckRldGFpbHMudmVyc2lvbiA8IDU3KSB7XG4gICAgICAgICAgaWYgKHJlbW90ZUlzRmlyZWZveCA9PT0gLTEpIHtcbiAgICAgICAgICAgIC8vIEZGIDwgNTcgd2lsbCBzZW5kIGluIDE2IEtpQiBjaHVua3MgdXNpbmcgdGhlIGRlcHJlY2F0ZWQgUFBJRFxuICAgICAgICAgICAgLy8gZnJhZ21lbnRhdGlvbi5cbiAgICAgICAgICAgIGNhblNlbmRNYXhNZXNzYWdlU2l6ZSA9IDE2Mzg0O1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBIb3dldmVyLCBvdGhlciBGRiAoYW5kIFJBV1JUQykgY2FuIHJlYXNzZW1ibGUgUFBJRC1mcmFnbWVudGVkXG4gICAgICAgICAgICAvLyBtZXNzYWdlcy4gVGh1cywgc3VwcG9ydGluZyB+MiBHaUIgd2hlbiBzZW5kaW5nLlxuICAgICAgICAgICAgY2FuU2VuZE1heE1lc3NhZ2VTaXplID0gMjE0NzQ4MzYzNztcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoYnJvd3NlckRldGFpbHMudmVyc2lvbiA8IDYwKSB7XG4gICAgICAgICAgLy8gQ3VycmVudGx5LCBhbGwgRkYgPj0gNTcgd2lsbCByZXNldCB0aGUgcmVtb3RlIG1heGltdW0gbWVzc2FnZSBzaXplXG4gICAgICAgICAgLy8gdG8gdGhlIGRlZmF1bHQgdmFsdWUgd2hlbiBhIGRhdGEgY2hhbm5lbCBpcyBjcmVhdGVkIGF0IGEgbGF0ZXJcbiAgICAgICAgICAvLyBzdGFnZS4gOihcbiAgICAgICAgICAvLyBTZWU6IGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTE0MjY4MzFcbiAgICAgICAgICBjYW5TZW5kTWF4TWVzc2FnZVNpemUgPVxuICAgICAgICAgICAgYnJvd3NlckRldGFpbHMudmVyc2lvbiA9PT0gNTcgPyA2NTUzNSA6IDY1NTM2O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIEZGID49IDYwIHN1cHBvcnRzIHNlbmRpbmcgfjIgR2lCXG4gICAgICAgICAgY2FuU2VuZE1heE1lc3NhZ2VTaXplID0gMjE0NzQ4MzYzNztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGNhblNlbmRNYXhNZXNzYWdlU2l6ZTtcbiAgICB9O1xuXG4gICAgdmFyIGdldE1heE1lc3NhZ2VTaXplID0gZnVuY3Rpb24oZGVzY3JpcHRpb24sIHJlbW90ZUlzRmlyZWZveCkge1xuICAgICAgLy8gTm90ZTogNjU1MzYgYnl0ZXMgaXMgdGhlIGRlZmF1bHQgdmFsdWUgZnJvbSB0aGUgU0RQIHNwZWMuIEFsc28sXG4gICAgICAvLyAgICAgICBldmVyeSBpbXBsZW1lbnRhdGlvbiB3ZSBrbm93IHN1cHBvcnRzIHJlY2VpdmluZyA2NTUzNiBieXRlcy5cbiAgICAgIHZhciBtYXhNZXNzYWdlU2l6ZSA9IDY1NTM2O1xuXG4gICAgICAvLyBGRiA1NyBoYXMgYSBzbGlnaHRseSBpbmNvcnJlY3QgZGVmYXVsdCByZW1vdGUgbWF4IG1lc3NhZ2Ugc2l6ZSwgc29cbiAgICAgIC8vIHdlIG5lZWQgdG8gYWRqdXN0IGl0IGhlcmUgdG8gYXZvaWQgYSBmYWlsdXJlIHdoZW4gc2VuZGluZy5cbiAgICAgIC8vIFNlZTogaHR0cHM6Ly9idWd6aWxsYS5tb3ppbGxhLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTQyNTY5N1xuICAgICAgaWYgKGJyb3dzZXJEZXRhaWxzLmJyb3dzZXIgPT09ICdmaXJlZm94J1xuICAgICAgICAgICAmJiBicm93c2VyRGV0YWlscy52ZXJzaW9uID09PSA1Nykge1xuICAgICAgICBtYXhNZXNzYWdlU2l6ZSA9IDY1NTM1O1xuICAgICAgfVxuXG4gICAgICB2YXIgbWF0Y2ggPSBTRFBVdGlscy5tYXRjaFByZWZpeChkZXNjcmlwdGlvbi5zZHAsICdhPW1heC1tZXNzYWdlLXNpemU6Jyk7XG4gICAgICBpZiAobWF0Y2gubGVuZ3RoID4gMCkge1xuICAgICAgICBtYXhNZXNzYWdlU2l6ZSA9IHBhcnNlSW50KG1hdGNoWzBdLnN1YnN0cigxOSksIDEwKTtcbiAgICAgIH0gZWxzZSBpZiAoYnJvd3NlckRldGFpbHMuYnJvd3NlciA9PT0gJ2ZpcmVmb3gnICYmXG4gICAgICAgICAgICAgICAgICByZW1vdGVJc0ZpcmVmb3ggIT09IC0xKSB7XG4gICAgICAgIC8vIElmIHRoZSBtYXhpbXVtIG1lc3NhZ2Ugc2l6ZSBpcyBub3QgcHJlc2VudCBpbiB0aGUgcmVtb3RlIFNEUCBhbmRcbiAgICAgICAgLy8gYm90aCBsb2NhbCBhbmQgcmVtb3RlIGFyZSBGaXJlZm94LCB0aGUgcmVtb3RlIHBlZXIgY2FuIHJlY2VpdmVcbiAgICAgICAgLy8gfjIgR2lCLlxuICAgICAgICBtYXhNZXNzYWdlU2l6ZSA9IDIxNDc0ODM2Mzc7XG4gICAgICB9XG4gICAgICByZXR1cm4gbWF4TWVzc2FnZVNpemU7XG4gICAgfTtcblxuICAgIHZhciBvcmlnU2V0UmVtb3RlRGVzY3JpcHRpb24gPVxuICAgICAgICB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLnNldFJlbW90ZURlc2NyaXB0aW9uO1xuICAgIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuc2V0UmVtb3RlRGVzY3JpcHRpb24gPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBwYyA9IHRoaXM7XG4gICAgICBwYy5fc2N0cCA9IG51bGw7XG5cbiAgICAgIGlmIChzY3RwSW5EZXNjcmlwdGlvbihhcmd1bWVudHNbMF0pKSB7XG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSByZW1vdGUgaXMgRkYuXG4gICAgICAgIHZhciBpc0ZpcmVmb3ggPSBnZXRSZW1vdGVGaXJlZm94VmVyc2lvbihhcmd1bWVudHNbMF0pO1xuXG4gICAgICAgIC8vIEdldCB0aGUgbWF4aW11bSBtZXNzYWdlIHNpemUgdGhlIGxvY2FsIHBlZXIgaXMgY2FwYWJsZSBvZiBzZW5kaW5nXG4gICAgICAgIHZhciBjYW5TZW5kTU1TID0gZ2V0Q2FuU2VuZE1heE1lc3NhZ2VTaXplKGlzRmlyZWZveCk7XG5cbiAgICAgICAgLy8gR2V0IHRoZSBtYXhpbXVtIG1lc3NhZ2Ugc2l6ZSBvZiB0aGUgcmVtb3RlIHBlZXIuXG4gICAgICAgIHZhciByZW1vdGVNTVMgPSBnZXRNYXhNZXNzYWdlU2l6ZShhcmd1bWVudHNbMF0sIGlzRmlyZWZveCk7XG5cbiAgICAgICAgLy8gRGV0ZXJtaW5lIGZpbmFsIG1heGltdW0gbWVzc2FnZSBzaXplXG4gICAgICAgIHZhciBtYXhNZXNzYWdlU2l6ZTtcbiAgICAgICAgaWYgKGNhblNlbmRNTVMgPT09IDAgJiYgcmVtb3RlTU1TID09PSAwKSB7XG4gICAgICAgICAgbWF4TWVzc2FnZVNpemUgPSBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFk7XG4gICAgICAgIH0gZWxzZSBpZiAoY2FuU2VuZE1NUyA9PT0gMCB8fCByZW1vdGVNTVMgPT09IDApIHtcbiAgICAgICAgICBtYXhNZXNzYWdlU2l6ZSA9IE1hdGgubWF4KGNhblNlbmRNTVMsIHJlbW90ZU1NUyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbWF4TWVzc2FnZVNpemUgPSBNYXRoLm1pbihjYW5TZW5kTU1TLCByZW1vdGVNTVMpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ3JlYXRlIGEgZHVtbXkgUlRDU2N0cFRyYW5zcG9ydCBvYmplY3QgYW5kIHRoZSAnbWF4TWVzc2FnZVNpemUnXG4gICAgICAgIC8vIGF0dHJpYnV0ZS5cbiAgICAgICAgdmFyIHNjdHAgPSB7fTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHNjdHAsICdtYXhNZXNzYWdlU2l6ZScsIHtcbiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIG1heE1lc3NhZ2VTaXplO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHBjLl9zY3RwID0gc2N0cDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG9yaWdTZXRSZW1vdGVEZXNjcmlwdGlvbi5hcHBseShwYywgYXJndW1lbnRzKTtcbiAgICB9O1xuICB9LFxuXG4gIHNoaW1TZW5kVGhyb3dUeXBlRXJyb3I6IGZ1bmN0aW9uKHdpbmRvdykge1xuICAgIGlmICghKHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbiAmJlxuICAgICAgICAnY3JlYXRlRGF0YUNoYW5uZWwnIGluIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gTm90ZTogQWx0aG91Z2ggRmlyZWZveCA+PSA1NyBoYXMgYSBuYXRpdmUgaW1wbGVtZW50YXRpb24sIHRoZSBtYXhpbXVtXG4gICAgLy8gICAgICAgbWVzc2FnZSBzaXplIGNhbiBiZSByZXNldCBmb3IgYWxsIGRhdGEgY2hhbm5lbHMgYXQgYSBsYXRlciBzdGFnZS5cbiAgICAvLyAgICAgICBTZWU6IGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTE0MjY4MzFcblxuICAgIGZ1bmN0aW9uIHdyYXBEY1NlbmQoZGMsIHBjKSB7XG4gICAgICB2YXIgb3JpZ0RhdGFDaGFubmVsU2VuZCA9IGRjLnNlbmQ7XG4gICAgICBkYy5zZW5kID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBkYXRhID0gYXJndW1lbnRzWzBdO1xuICAgICAgICB2YXIgbGVuZ3RoID0gZGF0YS5sZW5ndGggfHwgZGF0YS5zaXplIHx8IGRhdGEuYnl0ZUxlbmd0aDtcbiAgICAgICAgaWYgKGRjLnJlYWR5U3RhdGUgPT09ICdvcGVuJyAmJlxuICAgICAgICAgICAgcGMuc2N0cCAmJiBsZW5ndGggPiBwYy5zY3RwLm1heE1lc3NhZ2VTaXplKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignTWVzc2FnZSB0b28gbGFyZ2UgKGNhbiBzZW5kIGEgbWF4aW11bSBvZiAnICtcbiAgICAgICAgICAgIHBjLnNjdHAubWF4TWVzc2FnZVNpemUgKyAnIGJ5dGVzKScpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvcmlnRGF0YUNoYW5uZWxTZW5kLmFwcGx5KGRjLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9XG4gICAgdmFyIG9yaWdDcmVhdGVEYXRhQ2hhbm5lbCA9XG4gICAgICB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmNyZWF0ZURhdGFDaGFubmVsO1xuICAgIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuY3JlYXRlRGF0YUNoYW5uZWwgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBwYyA9IHRoaXM7XG4gICAgICB2YXIgZGF0YUNoYW5uZWwgPSBvcmlnQ3JlYXRlRGF0YUNoYW5uZWwuYXBwbHkocGMsIGFyZ3VtZW50cyk7XG4gICAgICB3cmFwRGNTZW5kKGRhdGFDaGFubmVsLCBwYyk7XG4gICAgICByZXR1cm4gZGF0YUNoYW5uZWw7XG4gICAgfTtcbiAgICB1dGlscy53cmFwUGVlckNvbm5lY3Rpb25FdmVudCh3aW5kb3csICdkYXRhY2hhbm5lbCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIHdyYXBEY1NlbmQoZS5jaGFubmVsLCBlLnRhcmdldCk7XG4gICAgICByZXR1cm4gZTtcbiAgICB9KTtcbiAgfVxufTtcbiIsIi8qXG4gKiAgQ29weXJpZ2h0IChjKSAyMDE2IFRoZSBXZWJSVEMgcHJvamVjdCBhdXRob3JzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqICBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhIEJTRC1zdHlsZSBsaWNlbnNlXG4gKiAgdGhhdCBjYW4gYmUgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBvZiB0aGUgc291cmNlXG4gKiAgdHJlZS5cbiAqL1xuIC8qIGVzbGludC1lbnYgbm9kZSAqL1xuJ3VzZSBzdHJpY3QnO1xuXG52YXIgdXRpbHMgPSByZXF1aXJlKCcuLi91dGlscycpO1xudmFyIGZpbHRlckljZVNlcnZlcnMgPSByZXF1aXJlKCcuL2ZpbHRlcmljZXNlcnZlcnMnKTtcbnZhciBzaGltUlRDUGVlckNvbm5lY3Rpb24gPSByZXF1aXJlKCdydGNwZWVyY29ubmVjdGlvbi1zaGltJyk7XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBzaGltR2V0VXNlck1lZGlhOiByZXF1aXJlKCcuL2dldHVzZXJtZWRpYScpLFxuICBzaGltUGVlckNvbm5lY3Rpb246IGZ1bmN0aW9uKHdpbmRvdykge1xuICAgIHZhciBicm93c2VyRGV0YWlscyA9IHV0aWxzLmRldGVjdEJyb3dzZXIod2luZG93KTtcblxuICAgIGlmICh3aW5kb3cuUlRDSWNlR2F0aGVyZXIpIHtcbiAgICAgIGlmICghd2luZG93LlJUQ0ljZUNhbmRpZGF0ZSkge1xuICAgICAgICB3aW5kb3cuUlRDSWNlQ2FuZGlkYXRlID0gZnVuY3Rpb24oYXJncykge1xuICAgICAgICAgIHJldHVybiBhcmdzO1xuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgaWYgKCF3aW5kb3cuUlRDU2Vzc2lvbkRlc2NyaXB0aW9uKSB7XG4gICAgICAgIHdpbmRvdy5SVENTZXNzaW9uRGVzY3JpcHRpb24gPSBmdW5jdGlvbihhcmdzKSB7XG4gICAgICAgICAgcmV0dXJuIGFyZ3M7XG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICAvLyB0aGlzIGFkZHMgYW4gYWRkaXRpb25hbCBldmVudCBsaXN0ZW5lciB0byBNZWRpYVN0cmFja1RyYWNrIHRoYXQgc2lnbmFsc1xuICAgICAgLy8gd2hlbiBhIHRyYWNrcyBlbmFibGVkIHByb3BlcnR5IHdhcyBjaGFuZ2VkLiBXb3JrYXJvdW5kIGZvciBhIGJ1ZyBpblxuICAgICAgLy8gYWRkU3RyZWFtLCBzZWUgYmVsb3cuIE5vIGxvbmdlciByZXF1aXJlZCBpbiAxNTAyNStcbiAgICAgIGlmIChicm93c2VyRGV0YWlscy52ZXJzaW9uIDwgMTUwMjUpIHtcbiAgICAgICAgdmFyIG9yaWdNU1RFbmFibGVkID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihcbiAgICAgICAgICAgIHdpbmRvdy5NZWRpYVN0cmVhbVRyYWNrLnByb3RvdHlwZSwgJ2VuYWJsZWQnKTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdy5NZWRpYVN0cmVhbVRyYWNrLnByb3RvdHlwZSwgJ2VuYWJsZWQnLCB7XG4gICAgICAgICAgc2V0OiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgb3JpZ01TVEVuYWJsZWQuc2V0LmNhbGwodGhpcywgdmFsdWUpO1xuICAgICAgICAgICAgdmFyIGV2ID0gbmV3IEV2ZW50KCdlbmFibGVkJyk7XG4gICAgICAgICAgICBldi5lbmFibGVkID0gdmFsdWU7XG4gICAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZXYpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gT1JUQyBkZWZpbmVzIHRoZSBEVE1GIHNlbmRlciBhIGJpdCBkaWZmZXJlbnQuXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3czYy9vcnRjL2lzc3Vlcy83MTRcbiAgICBpZiAod2luZG93LlJUQ1J0cFNlbmRlciAmJiAhKCdkdG1mJyBpbiB3aW5kb3cuUlRDUnRwU2VuZGVyLnByb3RvdHlwZSkpIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3cuUlRDUnRwU2VuZGVyLnByb3RvdHlwZSwgJ2R0bWYnLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYgKHRoaXMuX2R0bWYgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaWYgKHRoaXMudHJhY2sua2luZCA9PT0gJ2F1ZGlvJykge1xuICAgICAgICAgICAgICB0aGlzLl9kdG1mID0gbmV3IHdpbmRvdy5SVENEdG1mU2VuZGVyKHRoaXMpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnRyYWNrLmtpbmQgPT09ICd2aWRlbycpIHtcbiAgICAgICAgICAgICAgdGhpcy5fZHRtZiA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB0aGlzLl9kdG1mO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgLy8gRWRnZSBjdXJyZW50bHkgb25seSBpbXBsZW1lbnRzIHRoZSBSVENEdG1mU2VuZGVyLCBub3QgdGhlXG4gICAgLy8gUlRDRFRNRlNlbmRlciBhbGlhcy4gU2VlIGh0dHA6Ly9kcmFmdC5vcnRjLm9yZy8jcnRjZHRtZnNlbmRlcjIqXG4gICAgaWYgKHdpbmRvdy5SVENEdG1mU2VuZGVyICYmICF3aW5kb3cuUlRDRFRNRlNlbmRlcikge1xuICAgICAgd2luZG93LlJUQ0RUTUZTZW5kZXIgPSB3aW5kb3cuUlRDRHRtZlNlbmRlcjtcbiAgICB9XG5cbiAgICB2YXIgUlRDUGVlckNvbm5lY3Rpb25TaGltID0gc2hpbVJUQ1BlZXJDb25uZWN0aW9uKHdpbmRvdyxcbiAgICAgICAgYnJvd3NlckRldGFpbHMudmVyc2lvbik7XG4gICAgd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uID0gZnVuY3Rpb24oY29uZmlnKSB7XG4gICAgICBpZiAoY29uZmlnICYmIGNvbmZpZy5pY2VTZXJ2ZXJzKSB7XG4gICAgICAgIGNvbmZpZy5pY2VTZXJ2ZXJzID0gZmlsdGVySWNlU2VydmVycyhjb25maWcuaWNlU2VydmVycyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbmV3IFJUQ1BlZXJDb25uZWN0aW9uU2hpbShjb25maWcpO1xuICAgIH07XG4gICAgd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZSA9IFJUQ1BlZXJDb25uZWN0aW9uU2hpbS5wcm90b3R5cGU7XG4gIH0sXG4gIHNoaW1SZXBsYWNlVHJhY2s6IGZ1bmN0aW9uKHdpbmRvdykge1xuICAgIC8vIE9SVEMgaGFzIHJlcGxhY2VUcmFjayAtLSBodHRwczovL2dpdGh1Yi5jb20vdzNjL29ydGMvaXNzdWVzLzYxNFxuICAgIGlmICh3aW5kb3cuUlRDUnRwU2VuZGVyICYmXG4gICAgICAgICEoJ3JlcGxhY2VUcmFjaycgaW4gd2luZG93LlJUQ1J0cFNlbmRlci5wcm90b3R5cGUpKSB7XG4gICAgICB3aW5kb3cuUlRDUnRwU2VuZGVyLnByb3RvdHlwZS5yZXBsYWNlVHJhY2sgPVxuICAgICAgICAgIHdpbmRvdy5SVENSdHBTZW5kZXIucHJvdG90eXBlLnNldFRyYWNrO1xuICAgIH1cbiAgfSxcbiAgc2hpbUdldERpc3BsYXlNZWRpYTogZnVuY3Rpb24od2luZG93LCBwcmVmZXJyZWRNZWRpYVNvdXJjZSkge1xuICAgIGlmICghKCdnZXREaXNwbGF5TWVkaWEnIGluIHdpbmRvdy5uYXZpZ2F0b3IpIHx8XG4gICAgICAgICF3aW5kb3cubmF2aWdhdG9yLm1lZGlhRGV2aWNlcyB8fFxuICAgICAgICAnZ2V0RGlzcGxheU1lZGlhJyBpbiB3aW5kb3cubmF2aWdhdG9yLm1lZGlhRGV2aWNlcykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgb3JpZ0dldERpc3BsYXlNZWRpYSA9IHdpbmRvdy5uYXZpZ2F0b3IuZ2V0RGlzcGxheU1lZGlhO1xuICAgIHdpbmRvdy5uYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldERpc3BsYXlNZWRpYSA9IGZ1bmN0aW9uKGNvbnN0cmFpbnRzKSB7XG4gICAgICByZXR1cm4gb3JpZ0dldERpc3BsYXlNZWRpYS5jYWxsKHdpbmRvdy5uYXZpZ2F0b3IsIGNvbnN0cmFpbnRzKTtcbiAgICB9O1xuICAgIHdpbmRvdy5uYXZpZ2F0b3IuZ2V0RGlzcGxheU1lZGlhID0gZnVuY3Rpb24oY29uc3RyYWludHMpIHtcbiAgICAgIHV0aWxzLmRlcHJlY2F0ZWQoJ25hdmlnYXRvci5nZXREaXNwbGF5TWVkaWEnLFxuICAgICAgICAgICduYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldERpc3BsYXlNZWRpYScpO1xuICAgICAgcmV0dXJuIG9yaWdHZXREaXNwbGF5TWVkaWEuY2FsbCh3aW5kb3cubmF2aWdhdG9yLCBjb25zdHJhaW50cyk7XG4gICAgfTtcbiAgfVxufTtcbiIsIi8qXG4gKiAgQ29weXJpZ2h0IChjKSAyMDE4IFRoZSBXZWJSVEMgcHJvamVjdCBhdXRob3JzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqICBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhIEJTRC1zdHlsZSBsaWNlbnNlXG4gKiAgdGhhdCBjYW4gYmUgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBvZiB0aGUgc291cmNlXG4gKiAgdHJlZS5cbiAqL1xuIC8qIGVzbGludC1lbnYgbm9kZSAqL1xuJ3VzZSBzdHJpY3QnO1xuXG52YXIgdXRpbHMgPSByZXF1aXJlKCcuLi91dGlscycpO1xuLy8gRWRnZSBkb2VzIG5vdCBsaWtlXG4vLyAxKSBzdHVuOiBmaWx0ZXJlZCBhZnRlciAxNDM5MyB1bmxlc3MgP3RyYW5zcG9ydD11ZHAgaXMgcHJlc2VudFxuLy8gMikgdHVybjogdGhhdCBkb2VzIG5vdCBoYXZlIGFsbCBvZiB0dXJuOmhvc3Q6cG9ydD90cmFuc3BvcnQ9dWRwXG4vLyAzKSB0dXJuOiB3aXRoIGlwdjYgYWRkcmVzc2VzXG4vLyA0KSB0dXJuOiBvY2N1cnJpbmcgbXVsaXBsZSB0aW1lc1xubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpY2VTZXJ2ZXJzLCBlZGdlVmVyc2lvbikge1xuICB2YXIgaGFzVHVybiA9IGZhbHNlO1xuICBpY2VTZXJ2ZXJzID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShpY2VTZXJ2ZXJzKSk7XG4gIHJldHVybiBpY2VTZXJ2ZXJzLmZpbHRlcihmdW5jdGlvbihzZXJ2ZXIpIHtcbiAgICBpZiAoc2VydmVyICYmIChzZXJ2ZXIudXJscyB8fCBzZXJ2ZXIudXJsKSkge1xuICAgICAgdmFyIHVybHMgPSBzZXJ2ZXIudXJscyB8fCBzZXJ2ZXIudXJsO1xuICAgICAgaWYgKHNlcnZlci51cmwgJiYgIXNlcnZlci51cmxzKSB7XG4gICAgICAgIHV0aWxzLmRlcHJlY2F0ZWQoJ1JUQ0ljZVNlcnZlci51cmwnLCAnUlRDSWNlU2VydmVyLnVybHMnKTtcbiAgICAgIH1cbiAgICAgIHZhciBpc1N0cmluZyA9IHR5cGVvZiB1cmxzID09PSAnc3RyaW5nJztcbiAgICAgIGlmIChpc1N0cmluZykge1xuICAgICAgICB1cmxzID0gW3VybHNdO1xuICAgICAgfVxuICAgICAgdXJscyA9IHVybHMuZmlsdGVyKGZ1bmN0aW9uKHVybCkge1xuICAgICAgICB2YXIgdmFsaWRUdXJuID0gdXJsLmluZGV4T2YoJ3R1cm46JykgPT09IDAgJiZcbiAgICAgICAgICAgIHVybC5pbmRleE9mKCd0cmFuc3BvcnQ9dWRwJykgIT09IC0xICYmXG4gICAgICAgICAgICB1cmwuaW5kZXhPZigndHVybjpbJykgPT09IC0xICYmXG4gICAgICAgICAgICAhaGFzVHVybjtcblxuICAgICAgICBpZiAodmFsaWRUdXJuKSB7XG4gICAgICAgICAgaGFzVHVybiA9IHRydWU7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHVybC5pbmRleE9mKCdzdHVuOicpID09PSAwICYmIGVkZ2VWZXJzaW9uID49IDE0MzkzICYmXG4gICAgICAgICAgICB1cmwuaW5kZXhPZignP3RyYW5zcG9ydD11ZHAnKSA9PT0gLTE7XG4gICAgICB9KTtcblxuICAgICAgZGVsZXRlIHNlcnZlci51cmw7XG4gICAgICBzZXJ2ZXIudXJscyA9IGlzU3RyaW5nID8gdXJsc1swXSA6IHVybHM7XG4gICAgICByZXR1cm4gISF1cmxzLmxlbmd0aDtcbiAgICB9XG4gIH0pO1xufTtcbiIsIi8qXG4gKiAgQ29weXJpZ2h0IChjKSAyMDE2IFRoZSBXZWJSVEMgcHJvamVjdCBhdXRob3JzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqICBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhIEJTRC1zdHlsZSBsaWNlbnNlXG4gKiAgdGhhdCBjYW4gYmUgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBvZiB0aGUgc291cmNlXG4gKiAgdHJlZS5cbiAqL1xuIC8qIGVzbGludC1lbnYgbm9kZSAqL1xuJ3VzZSBzdHJpY3QnO1xuXG4vLyBFeHBvc2UgcHVibGljIG1ldGhvZHMuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKHdpbmRvdykge1xuICB2YXIgbmF2aWdhdG9yID0gd2luZG93ICYmIHdpbmRvdy5uYXZpZ2F0b3I7XG5cbiAgdmFyIHNoaW1FcnJvcl8gPSBmdW5jdGlvbihlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IHtQZXJtaXNzaW9uRGVuaWVkRXJyb3I6ICdOb3RBbGxvd2VkRXJyb3InfVtlLm5hbWVdIHx8IGUubmFtZSxcbiAgICAgIG1lc3NhZ2U6IGUubWVzc2FnZSxcbiAgICAgIGNvbnN0cmFpbnQ6IGUuY29uc3RyYWludCxcbiAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubmFtZTtcbiAgICAgIH1cbiAgICB9O1xuICB9O1xuXG4gIC8vIGdldFVzZXJNZWRpYSBlcnJvciBzaGltLlxuICB2YXIgb3JpZ0dldFVzZXJNZWRpYSA9IG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhLlxuICAgICAgYmluZChuYXZpZ2F0b3IubWVkaWFEZXZpY2VzKTtcbiAgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEgPSBmdW5jdGlvbihjKSB7XG4gICAgcmV0dXJuIG9yaWdHZXRVc2VyTWVkaWEoYykuY2F0Y2goZnVuY3Rpb24oZSkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KHNoaW1FcnJvcl8oZSkpO1xuICAgIH0pO1xuICB9O1xufTtcbiIsIi8qXG4gKiAgQ29weXJpZ2h0IChjKSAyMDE2IFRoZSBXZWJSVEMgcHJvamVjdCBhdXRob3JzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqICBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhIEJTRC1zdHlsZSBsaWNlbnNlXG4gKiAgdGhhdCBjYW4gYmUgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBvZiB0aGUgc291cmNlXG4gKiAgdHJlZS5cbiAqL1xuIC8qIGVzbGludC1lbnYgbm9kZSAqL1xuJ3VzZSBzdHJpY3QnO1xuXG52YXIgdXRpbHMgPSByZXF1aXJlKCcuLi91dGlscycpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgc2hpbUdldFVzZXJNZWRpYTogcmVxdWlyZSgnLi9nZXR1c2VybWVkaWEnKSxcbiAgc2hpbU9uVHJhY2s6IGZ1bmN0aW9uKHdpbmRvdykge1xuICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JyAmJiB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24gJiYgISgnb250cmFjaycgaW5cbiAgICAgICAgd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZSkpIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLCAnb250cmFjaycsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5fb250cmFjaztcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbihmKSB7XG4gICAgICAgICAgaWYgKHRoaXMuX29udHJhY2spIHtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcigndHJhY2snLCB0aGlzLl9vbnRyYWNrKTtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcignYWRkc3RyZWFtJywgdGhpcy5fb250cmFja3BvbHkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIoJ3RyYWNrJywgdGhpcy5fb250cmFjayA9IGYpO1xuICAgICAgICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcignYWRkc3RyZWFtJywgdGhpcy5fb250cmFja3BvbHkgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBlLnN0cmVhbS5nZXRUcmFja3MoKS5mb3JFYWNoKGZ1bmN0aW9uKHRyYWNrKSB7XG4gICAgICAgICAgICAgIHZhciBldmVudCA9IG5ldyBFdmVudCgndHJhY2snKTtcbiAgICAgICAgICAgICAgZXZlbnQudHJhY2sgPSB0cmFjaztcbiAgICAgICAgICAgICAgZXZlbnQucmVjZWl2ZXIgPSB7dHJhY2s6IHRyYWNrfTtcbiAgICAgICAgICAgICAgZXZlbnQudHJhbnNjZWl2ZXIgPSB7cmVjZWl2ZXI6IGV2ZW50LnJlY2VpdmVyfTtcbiAgICAgICAgICAgICAgZXZlbnQuc3RyZWFtcyA9IFtlLnN0cmVhbV07XG4gICAgICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChldmVudCk7XG4gICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JyAmJiB3aW5kb3cuUlRDVHJhY2tFdmVudCAmJlxuICAgICAgICAoJ3JlY2VpdmVyJyBpbiB3aW5kb3cuUlRDVHJhY2tFdmVudC5wcm90b3R5cGUpICYmXG4gICAgICAgICEoJ3RyYW5zY2VpdmVyJyBpbiB3aW5kb3cuUlRDVHJhY2tFdmVudC5wcm90b3R5cGUpKSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LlJUQ1RyYWNrRXZlbnQucHJvdG90eXBlLCAndHJhbnNjZWl2ZXInLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIHtyZWNlaXZlcjogdGhpcy5yZWNlaXZlcn07XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICBzaGltU291cmNlT2JqZWN0OiBmdW5jdGlvbih3aW5kb3cpIHtcbiAgICAvLyBGaXJlZm94IGhhcyBzdXBwb3J0ZWQgbW96U3JjT2JqZWN0IHNpbmNlIEZGMjIsIHVucHJlZml4ZWQgaW4gNDIuXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICdvYmplY3QnKSB7XG4gICAgICBpZiAod2luZG93LkhUTUxNZWRpYUVsZW1lbnQgJiZcbiAgICAgICAgISgnc3JjT2JqZWN0JyBpbiB3aW5kb3cuSFRNTE1lZGlhRWxlbWVudC5wcm90b3R5cGUpKSB7XG4gICAgICAgIC8vIFNoaW0gdGhlIHNyY09iamVjdCBwcm9wZXJ0eSwgb25jZSwgd2hlbiBIVE1MTWVkaWFFbGVtZW50IGlzIGZvdW5kLlxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LkhUTUxNZWRpYUVsZW1lbnQucHJvdG90eXBlLCAnc3JjT2JqZWN0Jywge1xuICAgICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5tb3pTcmNPYmplY3Q7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKHN0cmVhbSkge1xuICAgICAgICAgICAgdGhpcy5tb3pTcmNPYmplY3QgPSBzdHJlYW07XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgc2hpbVBlZXJDb25uZWN0aW9uOiBmdW5jdGlvbih3aW5kb3cpIHtcbiAgICB2YXIgYnJvd3NlckRldGFpbHMgPSB1dGlscy5kZXRlY3RCcm93c2VyKHdpbmRvdyk7XG5cbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ29iamVjdCcgfHwgISh3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24gfHxcbiAgICAgICAgd2luZG93Lm1velJUQ1BlZXJDb25uZWN0aW9uKSkge1xuICAgICAgcmV0dXJuOyAvLyBwcm9iYWJseSBtZWRpYS5wZWVyY29ubmVjdGlvbi5lbmFibGVkPWZhbHNlIGluIGFib3V0OmNvbmZpZ1xuICAgIH1cbiAgICAvLyBUaGUgUlRDUGVlckNvbm5lY3Rpb24gb2JqZWN0LlxuICAgIGlmICghd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uKSB7XG4gICAgICB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24gPSBmdW5jdGlvbihwY0NvbmZpZywgcGNDb25zdHJhaW50cykge1xuICAgICAgICBpZiAoYnJvd3NlckRldGFpbHMudmVyc2lvbiA8IDM4KSB7XG4gICAgICAgICAgLy8gLnVybHMgaXMgbm90IHN1cHBvcnRlZCBpbiBGRiA8IDM4LlxuICAgICAgICAgIC8vIGNyZWF0ZSBSVENJY2VTZXJ2ZXJzIHdpdGggYSBzaW5nbGUgdXJsLlxuICAgICAgICAgIGlmIChwY0NvbmZpZyAmJiBwY0NvbmZpZy5pY2VTZXJ2ZXJzKSB7XG4gICAgICAgICAgICB2YXIgbmV3SWNlU2VydmVycyA9IFtdO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwY0NvbmZpZy5pY2VTZXJ2ZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgIHZhciBzZXJ2ZXIgPSBwY0NvbmZpZy5pY2VTZXJ2ZXJzW2ldO1xuICAgICAgICAgICAgICBpZiAoc2VydmVyLmhhc093blByb3BlcnR5KCd1cmxzJykpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNlcnZlci51cmxzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICB2YXIgbmV3U2VydmVyID0ge1xuICAgICAgICAgICAgICAgICAgICB1cmw6IHNlcnZlci51cmxzW2pdXG4gICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgaWYgKHNlcnZlci51cmxzW2pdLmluZGV4T2YoJ3R1cm4nKSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBuZXdTZXJ2ZXIudXNlcm5hbWUgPSBzZXJ2ZXIudXNlcm5hbWU7XG4gICAgICAgICAgICAgICAgICAgIG5ld1NlcnZlci5jcmVkZW50aWFsID0gc2VydmVyLmNyZWRlbnRpYWw7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBuZXdJY2VTZXJ2ZXJzLnB1c2gobmV3U2VydmVyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbmV3SWNlU2VydmVycy5wdXNoKHBjQ29uZmlnLmljZVNlcnZlcnNbaV0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwY0NvbmZpZy5pY2VTZXJ2ZXJzID0gbmV3SWNlU2VydmVycztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyB3aW5kb3cubW96UlRDUGVlckNvbm5lY3Rpb24ocGNDb25maWcsIHBjQ29uc3RyYWludHMpO1xuICAgICAgfTtcbiAgICAgIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUgPVxuICAgICAgICAgIHdpbmRvdy5tb3pSVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGU7XG5cbiAgICAgIC8vIHdyYXAgc3RhdGljIG1ldGhvZHMuIEN1cnJlbnRseSBqdXN0IGdlbmVyYXRlQ2VydGlmaWNhdGUuXG4gICAgICBpZiAod2luZG93Lm1velJUQ1BlZXJDb25uZWN0aW9uLmdlbmVyYXRlQ2VydGlmaWNhdGUpIHtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbiwgJ2dlbmVyYXRlQ2VydGlmaWNhdGUnLCB7XG4gICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiB3aW5kb3cubW96UlRDUGVlckNvbm5lY3Rpb24uZ2VuZXJhdGVDZXJ0aWZpY2F0ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICB3aW5kb3cuUlRDU2Vzc2lvbkRlc2NyaXB0aW9uID0gd2luZG93Lm1velJUQ1Nlc3Npb25EZXNjcmlwdGlvbjtcbiAgICAgIHdpbmRvdy5SVENJY2VDYW5kaWRhdGUgPSB3aW5kb3cubW96UlRDSWNlQ2FuZGlkYXRlO1xuICAgIH1cblxuICAgIC8vIHNoaW0gYXdheSBuZWVkIGZvciBvYnNvbGV0ZSBSVENJY2VDYW5kaWRhdGUvUlRDU2Vzc2lvbkRlc2NyaXB0aW9uLlxuICAgIFsnc2V0TG9jYWxEZXNjcmlwdGlvbicsICdzZXRSZW1vdGVEZXNjcmlwdGlvbicsICdhZGRJY2VDYW5kaWRhdGUnXVxuICAgICAgICAuZm9yRWFjaChmdW5jdGlvbihtZXRob2QpIHtcbiAgICAgICAgICB2YXIgbmF0aXZlTWV0aG9kID0gd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZVttZXRob2RdO1xuICAgICAgICAgIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGVbbWV0aG9kXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgYXJndW1lbnRzWzBdID0gbmV3ICgobWV0aG9kID09PSAnYWRkSWNlQ2FuZGlkYXRlJykgP1xuICAgICAgICAgICAgICAgIHdpbmRvdy5SVENJY2VDYW5kaWRhdGUgOlxuICAgICAgICAgICAgICAgIHdpbmRvdy5SVENTZXNzaW9uRGVzY3JpcHRpb24pKGFyZ3VtZW50c1swXSk7XG4gICAgICAgICAgICByZXR1cm4gbmF0aXZlTWV0aG9kLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG5cbiAgICAvLyBzdXBwb3J0IGZvciBhZGRJY2VDYW5kaWRhdGUobnVsbCBvciB1bmRlZmluZWQpXG4gICAgdmFyIG5hdGl2ZUFkZEljZUNhbmRpZGF0ZSA9XG4gICAgICAgIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuYWRkSWNlQ2FuZGlkYXRlO1xuICAgIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuYWRkSWNlQ2FuZGlkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoIWFyZ3VtZW50c1swXSkge1xuICAgICAgICBpZiAoYXJndW1lbnRzWzFdKSB7XG4gICAgICAgICAgYXJndW1lbnRzWzFdLmFwcGx5KG51bGwpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBuYXRpdmVBZGRJY2VDYW5kaWRhdGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9O1xuXG4gICAgLy8gc2hpbSBnZXRTdGF0cyB3aXRoIG1hcGxpa2Ugc3VwcG9ydFxuICAgIHZhciBtYWtlTWFwU3RhdHMgPSBmdW5jdGlvbihzdGF0cykge1xuICAgICAgdmFyIG1hcCA9IG5ldyBNYXAoKTtcbiAgICAgIE9iamVjdC5rZXlzKHN0YXRzKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuICAgICAgICBtYXAuc2V0KGtleSwgc3RhdHNba2V5XSk7XG4gICAgICAgIG1hcFtrZXldID0gc3RhdHNba2V5XTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG1hcDtcbiAgICB9O1xuXG4gICAgdmFyIG1vZGVyblN0YXRzVHlwZXMgPSB7XG4gICAgICBpbmJvdW5kcnRwOiAnaW5ib3VuZC1ydHAnLFxuICAgICAgb3V0Ym91bmRydHA6ICdvdXRib3VuZC1ydHAnLFxuICAgICAgY2FuZGlkYXRlcGFpcjogJ2NhbmRpZGF0ZS1wYWlyJyxcbiAgICAgIGxvY2FsY2FuZGlkYXRlOiAnbG9jYWwtY2FuZGlkYXRlJyxcbiAgICAgIHJlbW90ZWNhbmRpZGF0ZTogJ3JlbW90ZS1jYW5kaWRhdGUnXG4gICAgfTtcblxuICAgIHZhciBuYXRpdmVHZXRTdGF0cyA9IHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuZ2V0U3RhdHM7XG4gICAgd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5nZXRTdGF0cyA9IGZ1bmN0aW9uKFxuICAgICAgc2VsZWN0b3IsXG4gICAgICBvblN1Y2MsXG4gICAgICBvbkVyclxuICAgICkge1xuICAgICAgcmV0dXJuIG5hdGl2ZUdldFN0YXRzLmFwcGx5KHRoaXMsIFtzZWxlY3RvciB8fCBudWxsXSlcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24oc3RhdHMpIHtcbiAgICAgICAgICBpZiAoYnJvd3NlckRldGFpbHMudmVyc2lvbiA8IDQ4KSB7XG4gICAgICAgICAgICBzdGF0cyA9IG1ha2VNYXBTdGF0cyhzdGF0cyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChicm93c2VyRGV0YWlscy52ZXJzaW9uIDwgNTMgJiYgIW9uU3VjYykge1xuICAgICAgICAgICAgLy8gU2hpbSBvbmx5IHByb21pc2UgZ2V0U3RhdHMgd2l0aCBzcGVjLWh5cGhlbnMgaW4gdHlwZSBuYW1lc1xuICAgICAgICAgICAgLy8gTGVhdmUgY2FsbGJhY2sgdmVyc2lvbiBhbG9uZTsgbWlzYyBvbGQgdXNlcyBvZiBmb3JFYWNoIGJlZm9yZSBNYXBcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIHN0YXRzLmZvckVhY2goZnVuY3Rpb24oc3RhdCkge1xuICAgICAgICAgICAgICAgIHN0YXQudHlwZSA9IG1vZGVyblN0YXRzVHlwZXNbc3RhdC50eXBlXSB8fCBzdGF0LnR5cGU7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICBpZiAoZS5uYW1lICE9PSAnVHlwZUVycm9yJykge1xuICAgICAgICAgICAgICAgIHRocm93IGU7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgLy8gQXZvaWQgVHlwZUVycm9yOiBcInR5cGVcIiBpcyByZWFkLW9ubHksIGluIG9sZCB2ZXJzaW9ucy4gMzQtNDNpc2hcbiAgICAgICAgICAgICAgc3RhdHMuZm9yRWFjaChmdW5jdGlvbihzdGF0LCBpKSB7XG4gICAgICAgICAgICAgICAgc3RhdHMuc2V0KGksIE9iamVjdC5hc3NpZ24oe30sIHN0YXQsIHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IG1vZGVyblN0YXRzVHlwZXNbc3RhdC50eXBlXSB8fCBzdGF0LnR5cGVcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gc3RhdHM7XG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKG9uU3VjYywgb25FcnIpO1xuICAgIH07XG4gIH0sXG5cbiAgc2hpbVNlbmRlckdldFN0YXRzOiBmdW5jdGlvbih3aW5kb3cpIHtcbiAgICBpZiAoISh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JyAmJiB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24gJiZcbiAgICAgICAgd2luZG93LlJUQ1J0cFNlbmRlcikpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHdpbmRvdy5SVENSdHBTZW5kZXIgJiYgJ2dldFN0YXRzJyBpbiB3aW5kb3cuUlRDUnRwU2VuZGVyLnByb3RvdHlwZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgb3JpZ0dldFNlbmRlcnMgPSB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmdldFNlbmRlcnM7XG4gICAgaWYgKG9yaWdHZXRTZW5kZXJzKSB7XG4gICAgICB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmdldFNlbmRlcnMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHBjID0gdGhpcztcbiAgICAgICAgdmFyIHNlbmRlcnMgPSBvcmlnR2V0U2VuZGVycy5hcHBseShwYywgW10pO1xuICAgICAgICBzZW5kZXJzLmZvckVhY2goZnVuY3Rpb24oc2VuZGVyKSB7XG4gICAgICAgICAgc2VuZGVyLl9wYyA9IHBjO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHNlbmRlcnM7XG4gICAgICB9O1xuICAgIH1cblxuICAgIHZhciBvcmlnQWRkVHJhY2sgPSB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmFkZFRyYWNrO1xuICAgIGlmIChvcmlnQWRkVHJhY2spIHtcbiAgICAgIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuYWRkVHJhY2sgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHNlbmRlciA9IG9yaWdBZGRUcmFjay5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICBzZW5kZXIuX3BjID0gdGhpcztcbiAgICAgICAgcmV0dXJuIHNlbmRlcjtcbiAgICAgIH07XG4gICAgfVxuICAgIHdpbmRvdy5SVENSdHBTZW5kZXIucHJvdG90eXBlLmdldFN0YXRzID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy50cmFjayA/IHRoaXMuX3BjLmdldFN0YXRzKHRoaXMudHJhY2spIDpcbiAgICAgICAgICBQcm9taXNlLnJlc29sdmUobmV3IE1hcCgpKTtcbiAgICB9O1xuICB9LFxuXG4gIHNoaW1SZWNlaXZlckdldFN0YXRzOiBmdW5jdGlvbih3aW5kb3cpIHtcbiAgICBpZiAoISh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JyAmJiB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24gJiZcbiAgICAgICAgd2luZG93LlJUQ1J0cFNlbmRlcikpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHdpbmRvdy5SVENSdHBTZW5kZXIgJiYgJ2dldFN0YXRzJyBpbiB3aW5kb3cuUlRDUnRwUmVjZWl2ZXIucHJvdG90eXBlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBvcmlnR2V0UmVjZWl2ZXJzID0gd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5nZXRSZWNlaXZlcnM7XG4gICAgaWYgKG9yaWdHZXRSZWNlaXZlcnMpIHtcbiAgICAgIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuZ2V0UmVjZWl2ZXJzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBwYyA9IHRoaXM7XG4gICAgICAgIHZhciByZWNlaXZlcnMgPSBvcmlnR2V0UmVjZWl2ZXJzLmFwcGx5KHBjLCBbXSk7XG4gICAgICAgIHJlY2VpdmVycy5mb3JFYWNoKGZ1bmN0aW9uKHJlY2VpdmVyKSB7XG4gICAgICAgICAgcmVjZWl2ZXIuX3BjID0gcGM7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmVjZWl2ZXJzO1xuICAgICAgfTtcbiAgICB9XG4gICAgdXRpbHMud3JhcFBlZXJDb25uZWN0aW9uRXZlbnQod2luZG93LCAndHJhY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICBlLnJlY2VpdmVyLl9wYyA9IGUuc3JjRWxlbWVudDtcbiAgICAgIHJldHVybiBlO1xuICAgIH0pO1xuICAgIHdpbmRvdy5SVENSdHBSZWNlaXZlci5wcm90b3R5cGUuZ2V0U3RhdHMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLl9wYy5nZXRTdGF0cyh0aGlzLnRyYWNrKTtcbiAgICB9O1xuICB9LFxuXG4gIHNoaW1SZW1vdmVTdHJlYW06IGZ1bmN0aW9uKHdpbmRvdykge1xuICAgIGlmICghd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uIHx8XG4gICAgICAgICdyZW1vdmVTdHJlYW0nIGluIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5yZW1vdmVTdHJlYW0gPSBmdW5jdGlvbihzdHJlYW0pIHtcbiAgICAgIHZhciBwYyA9IHRoaXM7XG4gICAgICB1dGlscy5kZXByZWNhdGVkKCdyZW1vdmVTdHJlYW0nLCAncmVtb3ZlVHJhY2snKTtcbiAgICAgIHRoaXMuZ2V0U2VuZGVycygpLmZvckVhY2goZnVuY3Rpb24oc2VuZGVyKSB7XG4gICAgICAgIGlmIChzZW5kZXIudHJhY2sgJiYgc3RyZWFtLmdldFRyYWNrcygpLmluZGV4T2Yoc2VuZGVyLnRyYWNrKSAhPT0gLTEpIHtcbiAgICAgICAgICBwYy5yZW1vdmVUcmFjayhzZW5kZXIpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuICB9LFxuXG4gIHNoaW1SVENEYXRhQ2hhbm5lbDogZnVuY3Rpb24od2luZG93KSB7XG4gICAgLy8gcmVuYW1lIERhdGFDaGFubmVsIHRvIFJUQ0RhdGFDaGFubmVsIChuYXRpdmUgZml4IGluIEZGNjApOlxuICAgIC8vIGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTExNzM4NTFcbiAgICBpZiAod2luZG93LkRhdGFDaGFubmVsICYmICF3aW5kb3cuUlRDRGF0YUNoYW5uZWwpIHtcbiAgICAgIHdpbmRvdy5SVENEYXRhQ2hhbm5lbCA9IHdpbmRvdy5EYXRhQ2hhbm5lbDtcbiAgICB9XG4gIH0sXG5cbiAgc2hpbUdldERpc3BsYXlNZWRpYTogZnVuY3Rpb24od2luZG93LCBwcmVmZXJyZWRNZWRpYVNvdXJjZSkge1xuICAgIGlmICghd2luZG93Lm5hdmlnYXRvciB8fCAhd2luZG93Lm5hdmlnYXRvci5tZWRpYURldmljZXMgfHxcbiAgICAgICAgJ2dldERpc3BsYXlNZWRpYScgaW4gd2luZG93Lm5hdmlnYXRvci5tZWRpYURldmljZXMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgd2luZG93Lm5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0RGlzcGxheU1lZGlhID0gZnVuY3Rpb24oY29uc3RyYWludHMpIHtcbiAgICAgIGlmICghKGNvbnN0cmFpbnRzICYmIGNvbnN0cmFpbnRzLnZpZGVvKSkge1xuICAgICAgICB2YXIgZXJyID0gbmV3IERPTUV4Y2VwdGlvbignZ2V0RGlzcGxheU1lZGlhIHdpdGhvdXQgdmlkZW8gJyArXG4gICAgICAgICAgICAnY29uc3RyYWludHMgaXMgdW5kZWZpbmVkJyk7XG4gICAgICAgIGVyci5uYW1lID0gJ05vdEZvdW5kRXJyb3InO1xuICAgICAgICAvLyBmcm9tIGh0dHBzOi8vaGV5Y2FtLmdpdGh1Yi5pby93ZWJpZGwvI2lkbC1ET01FeGNlcHRpb24tZXJyb3ItbmFtZXNcbiAgICAgICAgZXJyLmNvZGUgPSA4O1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyKTtcbiAgICAgIH1cbiAgICAgIGlmIChjb25zdHJhaW50cy52aWRlbyA9PT0gdHJ1ZSkge1xuICAgICAgICBjb25zdHJhaW50cy52aWRlbyA9IHttZWRpYVNvdXJjZTogcHJlZmVycmVkTWVkaWFTb3VyY2V9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3RyYWludHMudmlkZW8ubWVkaWFTb3VyY2UgPSBwcmVmZXJyZWRNZWRpYVNvdXJjZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB3aW5kb3cubmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoY29uc3RyYWludHMpO1xuICAgIH07XG4gICAgd2luZG93Lm5hdmlnYXRvci5nZXREaXNwbGF5TWVkaWEgPSBmdW5jdGlvbihjb25zdHJhaW50cykge1xuICAgICAgdXRpbHMuZGVwcmVjYXRlZCgnbmF2aWdhdG9yLmdldERpc3BsYXlNZWRpYScsXG4gICAgICAgICAgJ25hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0RGlzcGxheU1lZGlhJyk7XG4gICAgICByZXR1cm4gd2luZG93Lm5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0RGlzcGxheU1lZGlhKGNvbnN0cmFpbnRzKTtcbiAgICB9O1xuICB9XG59O1xuIiwiLypcbiAqICBDb3B5cmlnaHQgKGMpIDIwMTYgVGhlIFdlYlJUQyBwcm9qZWN0IGF1dGhvcnMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzIGdvdmVybmVkIGJ5IGEgQlNELXN0eWxlIGxpY2Vuc2VcbiAqICB0aGF0IGNhbiBiZSBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlIGluIHRoZSByb290IG9mIHRoZSBzb3VyY2VcbiAqICB0cmVlLlxuICovXG4gLyogZXNsaW50LWVudiBub2RlICovXG4ndXNlIHN0cmljdCc7XG5cbnZhciB1dGlscyA9IHJlcXVpcmUoJy4uL3V0aWxzJyk7XG52YXIgbG9nZ2luZyA9IHV0aWxzLmxvZztcblxuLy8gRXhwb3NlIHB1YmxpYyBtZXRob2RzLlxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbih3aW5kb3cpIHtcbiAgdmFyIGJyb3dzZXJEZXRhaWxzID0gdXRpbHMuZGV0ZWN0QnJvd3Nlcih3aW5kb3cpO1xuICB2YXIgbmF2aWdhdG9yID0gd2luZG93ICYmIHdpbmRvdy5uYXZpZ2F0b3I7XG4gIHZhciBNZWRpYVN0cmVhbVRyYWNrID0gd2luZG93ICYmIHdpbmRvdy5NZWRpYVN0cmVhbVRyYWNrO1xuXG4gIHZhciBzaGltRXJyb3JfID0gZnVuY3Rpb24oZSkge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiB7XG4gICAgICAgIEludGVybmFsRXJyb3I6ICdOb3RSZWFkYWJsZUVycm9yJyxcbiAgICAgICAgTm90U3VwcG9ydGVkRXJyb3I6ICdUeXBlRXJyb3InLFxuICAgICAgICBQZXJtaXNzaW9uRGVuaWVkRXJyb3I6ICdOb3RBbGxvd2VkRXJyb3InLFxuICAgICAgICBTZWN1cml0eUVycm9yOiAnTm90QWxsb3dlZEVycm9yJ1xuICAgICAgfVtlLm5hbWVdIHx8IGUubmFtZSxcbiAgICAgIG1lc3NhZ2U6IHtcbiAgICAgICAgJ1RoZSBvcGVyYXRpb24gaXMgaW5zZWN1cmUuJzogJ1RoZSByZXF1ZXN0IGlzIG5vdCBhbGxvd2VkIGJ5IHRoZSAnICtcbiAgICAgICAgJ3VzZXIgYWdlbnQgb3IgdGhlIHBsYXRmb3JtIGluIHRoZSBjdXJyZW50IGNvbnRleHQuJ1xuICAgICAgfVtlLm1lc3NhZ2VdIHx8IGUubWVzc2FnZSxcbiAgICAgIGNvbnN0cmFpbnQ6IGUuY29uc3RyYWludCxcbiAgICAgIHRvU3RyaW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubmFtZSArICh0aGlzLm1lc3NhZ2UgJiYgJzogJykgKyB0aGlzLm1lc3NhZ2U7XG4gICAgICB9XG4gICAgfTtcbiAgfTtcblxuICAvLyBnZXRVc2VyTWVkaWEgY29uc3RyYWludHMgc2hpbS5cbiAgdmFyIGdldFVzZXJNZWRpYV8gPSBmdW5jdGlvbihjb25zdHJhaW50cywgb25TdWNjZXNzLCBvbkVycm9yKSB7XG4gICAgdmFyIGNvbnN0cmFpbnRzVG9GRjM3XyA9IGZ1bmN0aW9uKGMpIHtcbiAgICAgIGlmICh0eXBlb2YgYyAhPT0gJ29iamVjdCcgfHwgYy5yZXF1aXJlKSB7XG4gICAgICAgIHJldHVybiBjO1xuICAgICAgfVxuICAgICAgdmFyIHJlcXVpcmUgPSBbXTtcbiAgICAgIE9iamVjdC5rZXlzKGMpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgIGlmIChrZXkgPT09ICdyZXF1aXJlJyB8fCBrZXkgPT09ICdhZHZhbmNlZCcgfHwga2V5ID09PSAnbWVkaWFTb3VyY2UnKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciByID0gY1trZXldID0gKHR5cGVvZiBjW2tleV0gPT09ICdvYmplY3QnKSA/XG4gICAgICAgICAgICBjW2tleV0gOiB7aWRlYWw6IGNba2V5XX07XG4gICAgICAgIGlmIChyLm1pbiAhPT0gdW5kZWZpbmVkIHx8XG4gICAgICAgICAgICByLm1heCAhPT0gdW5kZWZpbmVkIHx8IHIuZXhhY3QgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHJlcXVpcmUucHVzaChrZXkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyLmV4YWN0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBpZiAodHlwZW9mIHIuZXhhY3QgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICByLiBtaW4gPSByLm1heCA9IHIuZXhhY3Q7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNba2V5XSA9IHIuZXhhY3Q7XG4gICAgICAgICAgfVxuICAgICAgICAgIGRlbGV0ZSByLmV4YWN0O1xuICAgICAgICB9XG4gICAgICAgIGlmIChyLmlkZWFsICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBjLmFkdmFuY2VkID0gYy5hZHZhbmNlZCB8fCBbXTtcbiAgICAgICAgICB2YXIgb2MgPSB7fTtcbiAgICAgICAgICBpZiAodHlwZW9mIHIuaWRlYWwgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICBvY1trZXldID0ge21pbjogci5pZGVhbCwgbWF4OiByLmlkZWFsfTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgb2Nba2V5XSA9IHIuaWRlYWw7XG4gICAgICAgICAgfVxuICAgICAgICAgIGMuYWR2YW5jZWQucHVzaChvYyk7XG4gICAgICAgICAgZGVsZXRlIHIuaWRlYWw7XG4gICAgICAgICAgaWYgKCFPYmplY3Qua2V5cyhyKS5sZW5ndGgpIHtcbiAgICAgICAgICAgIGRlbGV0ZSBjW2tleV07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGlmIChyZXF1aXJlLmxlbmd0aCkge1xuICAgICAgICBjLnJlcXVpcmUgPSByZXF1aXJlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGM7XG4gICAgfTtcbiAgICBjb25zdHJhaW50cyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY29uc3RyYWludHMpKTtcbiAgICBpZiAoYnJvd3NlckRldGFpbHMudmVyc2lvbiA8IDM4KSB7XG4gICAgICBsb2dnaW5nKCdzcGVjOiAnICsgSlNPTi5zdHJpbmdpZnkoY29uc3RyYWludHMpKTtcbiAgICAgIGlmIChjb25zdHJhaW50cy5hdWRpbykge1xuICAgICAgICBjb25zdHJhaW50cy5hdWRpbyA9IGNvbnN0cmFpbnRzVG9GRjM3Xyhjb25zdHJhaW50cy5hdWRpbyk7XG4gICAgICB9XG4gICAgICBpZiAoY29uc3RyYWludHMudmlkZW8pIHtcbiAgICAgICAgY29uc3RyYWludHMudmlkZW8gPSBjb25zdHJhaW50c1RvRkYzN18oY29uc3RyYWludHMudmlkZW8pO1xuICAgICAgfVxuICAgICAgbG9nZ2luZygnZmYzNzogJyArIEpTT04uc3RyaW5naWZ5KGNvbnN0cmFpbnRzKSk7XG4gICAgfVxuICAgIHJldHVybiBuYXZpZ2F0b3IubW96R2V0VXNlck1lZGlhKGNvbnN0cmFpbnRzLCBvblN1Y2Nlc3MsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIG9uRXJyb3Ioc2hpbUVycm9yXyhlKSk7XG4gICAgfSk7XG4gIH07XG5cbiAgLy8gUmV0dXJucyB0aGUgcmVzdWx0IG9mIGdldFVzZXJNZWRpYSBhcyBhIFByb21pc2UuXG4gIHZhciBnZXRVc2VyTWVkaWFQcm9taXNlXyA9IGZ1bmN0aW9uKGNvbnN0cmFpbnRzKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgZ2V0VXNlck1lZGlhXyhjb25zdHJhaW50cywgcmVzb2x2ZSwgcmVqZWN0KTtcbiAgICB9KTtcbiAgfTtcblxuICAvLyBTaGltIGZvciBtZWRpYURldmljZXMgb24gb2xkZXIgdmVyc2lvbnMuXG4gIGlmICghbmF2aWdhdG9yLm1lZGlhRGV2aWNlcykge1xuICAgIG5hdmlnYXRvci5tZWRpYURldmljZXMgPSB7Z2V0VXNlck1lZGlhOiBnZXRVc2VyTWVkaWFQcm9taXNlXyxcbiAgICAgIGFkZEV2ZW50TGlzdGVuZXI6IGZ1bmN0aW9uKCkgeyB9LFxuICAgICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcjogZnVuY3Rpb24oKSB7IH1cbiAgICB9O1xuICB9XG4gIG5hdmlnYXRvci5tZWRpYURldmljZXMuZW51bWVyYXRlRGV2aWNlcyA9XG4gICAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmVudW1lcmF0ZURldmljZXMgfHwgZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlKSB7XG4gICAgICAgICAgdmFyIGluZm9zID0gW1xuICAgICAgICAgICAge2tpbmQ6ICdhdWRpb2lucHV0JywgZGV2aWNlSWQ6ICdkZWZhdWx0JywgbGFiZWw6ICcnLCBncm91cElkOiAnJ30sXG4gICAgICAgICAgICB7a2luZDogJ3ZpZGVvaW5wdXQnLCBkZXZpY2VJZDogJ2RlZmF1bHQnLCBsYWJlbDogJycsIGdyb3VwSWQ6ICcnfVxuICAgICAgICAgIF07XG4gICAgICAgICAgcmVzb2x2ZShpbmZvcyk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcblxuICBpZiAoYnJvd3NlckRldGFpbHMudmVyc2lvbiA8IDQxKSB7XG4gICAgLy8gV29yayBhcm91bmQgaHR0cDovL2J1Z3ppbC5sYS8xMTY5NjY1XG4gICAgdmFyIG9yZ0VudW1lcmF0ZURldmljZXMgPVxuICAgICAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmVudW1lcmF0ZURldmljZXMuYmluZChuYXZpZ2F0b3IubWVkaWFEZXZpY2VzKTtcbiAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmVudW1lcmF0ZURldmljZXMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBvcmdFbnVtZXJhdGVEZXZpY2VzKCkudGhlbih1bmRlZmluZWQsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgaWYgKGUubmFtZSA9PT0gJ05vdEZvdW5kRXJyb3InKSB7XG4gICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IGU7XG4gICAgICB9KTtcbiAgICB9O1xuICB9XG4gIGlmIChicm93c2VyRGV0YWlscy52ZXJzaW9uIDwgNDkpIHtcbiAgICB2YXIgb3JpZ0dldFVzZXJNZWRpYSA9IG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhLlxuICAgICAgICBiaW5kKG5hdmlnYXRvci5tZWRpYURldmljZXMpO1xuICAgIG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhID0gZnVuY3Rpb24oYykge1xuICAgICAgcmV0dXJuIG9yaWdHZXRVc2VyTWVkaWEoYykudGhlbihmdW5jdGlvbihzdHJlYW0pIHtcbiAgICAgICAgLy8gV29yayBhcm91bmQgaHR0cHM6Ly9idWd6aWwubGEvODAyMzI2XG4gICAgICAgIGlmIChjLmF1ZGlvICYmICFzdHJlYW0uZ2V0QXVkaW9UcmFja3MoKS5sZW5ndGggfHxcbiAgICAgICAgICAgIGMudmlkZW8gJiYgIXN0cmVhbS5nZXRWaWRlb1RyYWNrcygpLmxlbmd0aCkge1xuICAgICAgICAgIHN0cmVhbS5nZXRUcmFja3MoKS5mb3JFYWNoKGZ1bmN0aW9uKHRyYWNrKSB7XG4gICAgICAgICAgICB0cmFjay5zdG9wKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdGhyb3cgbmV3IERPTUV4Y2VwdGlvbignVGhlIG9iamVjdCBjYW4gbm90IGJlIGZvdW5kIGhlcmUuJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdOb3RGb3VuZEVycm9yJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHN0cmVhbTtcbiAgICAgIH0sIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KHNoaW1FcnJvcl8oZSkpO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfVxuICBpZiAoIShicm93c2VyRGV0YWlscy52ZXJzaW9uID4gNTUgJiZcbiAgICAgICdhdXRvR2FpbkNvbnRyb2wnIGluIG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0U3VwcG9ydGVkQ29uc3RyYWludHMoKSkpIHtcbiAgICB2YXIgcmVtYXAgPSBmdW5jdGlvbihvYmosIGEsIGIpIHtcbiAgICAgIGlmIChhIGluIG9iaiAmJiAhKGIgaW4gb2JqKSkge1xuICAgICAgICBvYmpbYl0gPSBvYmpbYV07XG4gICAgICAgIGRlbGV0ZSBvYmpbYV07XG4gICAgICB9XG4gICAgfTtcblxuICAgIHZhciBuYXRpdmVHZXRVc2VyTWVkaWEgPSBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYS5cbiAgICAgICAgYmluZChuYXZpZ2F0b3IubWVkaWFEZXZpY2VzKTtcbiAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSA9IGZ1bmN0aW9uKGMpIHtcbiAgICAgIGlmICh0eXBlb2YgYyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIGMuYXVkaW8gPT09ICdvYmplY3QnKSB7XG4gICAgICAgIGMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGMpKTtcbiAgICAgICAgcmVtYXAoYy5hdWRpbywgJ2F1dG9HYWluQ29udHJvbCcsICdtb3pBdXRvR2FpbkNvbnRyb2wnKTtcbiAgICAgICAgcmVtYXAoYy5hdWRpbywgJ25vaXNlU3VwcHJlc3Npb24nLCAnbW96Tm9pc2VTdXBwcmVzc2lvbicpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG5hdGl2ZUdldFVzZXJNZWRpYShjKTtcbiAgICB9O1xuXG4gICAgaWYgKE1lZGlhU3RyZWFtVHJhY2sgJiYgTWVkaWFTdHJlYW1UcmFjay5wcm90b3R5cGUuZ2V0U2V0dGluZ3MpIHtcbiAgICAgIHZhciBuYXRpdmVHZXRTZXR0aW5ncyA9IE1lZGlhU3RyZWFtVHJhY2sucHJvdG90eXBlLmdldFNldHRpbmdzO1xuICAgICAgTWVkaWFTdHJlYW1UcmFjay5wcm90b3R5cGUuZ2V0U2V0dGluZ3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIG9iaiA9IG5hdGl2ZUdldFNldHRpbmdzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgIHJlbWFwKG9iaiwgJ21vekF1dG9HYWluQ29udHJvbCcsICdhdXRvR2FpbkNvbnRyb2wnKTtcbiAgICAgICAgcmVtYXAob2JqLCAnbW96Tm9pc2VTdXBwcmVzc2lvbicsICdub2lzZVN1cHByZXNzaW9uJyk7XG4gICAgICAgIHJldHVybiBvYmo7XG4gICAgICB9O1xuICAgIH1cblxuICAgIGlmIChNZWRpYVN0cmVhbVRyYWNrICYmIE1lZGlhU3RyZWFtVHJhY2sucHJvdG90eXBlLmFwcGx5Q29uc3RyYWludHMpIHtcbiAgICAgIHZhciBuYXRpdmVBcHBseUNvbnN0cmFpbnRzID0gTWVkaWFTdHJlYW1UcmFjay5wcm90b3R5cGUuYXBwbHlDb25zdHJhaW50cztcbiAgICAgIE1lZGlhU3RyZWFtVHJhY2sucHJvdG90eXBlLmFwcGx5Q29uc3RyYWludHMgPSBmdW5jdGlvbihjKSB7XG4gICAgICAgIGlmICh0aGlzLmtpbmQgPT09ICdhdWRpbycgJiYgdHlwZW9mIGMgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgYyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoYykpO1xuICAgICAgICAgIHJlbWFwKGMsICdhdXRvR2FpbkNvbnRyb2wnLCAnbW96QXV0b0dhaW5Db250cm9sJyk7XG4gICAgICAgICAgcmVtYXAoYywgJ25vaXNlU3VwcHJlc3Npb24nLCAnbW96Tm9pc2VTdXBwcmVzc2lvbicpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuYXRpdmVBcHBseUNvbnN0cmFpbnRzLmFwcGx5KHRoaXMsIFtjXSk7XG4gICAgICB9O1xuICAgIH1cbiAgfVxuICBuYXZpZ2F0b3IuZ2V0VXNlck1lZGlhID0gZnVuY3Rpb24oY29uc3RyYWludHMsIG9uU3VjY2Vzcywgb25FcnJvcikge1xuICAgIGlmIChicm93c2VyRGV0YWlscy52ZXJzaW9uIDwgNDQpIHtcbiAgICAgIHJldHVybiBnZXRVc2VyTWVkaWFfKGNvbnN0cmFpbnRzLCBvblN1Y2Nlc3MsIG9uRXJyb3IpO1xuICAgIH1cbiAgICAvLyBSZXBsYWNlIEZpcmVmb3ggNDQrJ3MgZGVwcmVjYXRpb24gd2FybmluZyB3aXRoIHVucHJlZml4ZWQgdmVyc2lvbi5cbiAgICB1dGlscy5kZXByZWNhdGVkKCduYXZpZ2F0b3IuZ2V0VXNlck1lZGlhJyxcbiAgICAgICAgJ25hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhJyk7XG4gICAgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoY29uc3RyYWludHMpLnRoZW4ob25TdWNjZXNzLCBvbkVycm9yKTtcbiAgfTtcbn07XG4iLCIvKlxuICogIENvcHlyaWdodCAoYykgMjAxNiBUaGUgV2ViUlRDIHByb2plY3QgYXV0aG9ycy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiAgVXNlIG9mIHRoaXMgc291cmNlIGNvZGUgaXMgZ292ZXJuZWQgYnkgYSBCU0Qtc3R5bGUgbGljZW5zZVxuICogIHRoYXQgY2FuIGJlIGZvdW5kIGluIHRoZSBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3Qgb2YgdGhlIHNvdXJjZVxuICogIHRyZWUuXG4gKi9cbid1c2Ugc3RyaWN0JztcbnZhciB1dGlscyA9IHJlcXVpcmUoJy4uL3V0aWxzJyk7XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBzaGltTG9jYWxTdHJlYW1zQVBJOiBmdW5jdGlvbih3aW5kb3cpIHtcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ29iamVjdCcgfHwgIXdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoISgnZ2V0TG9jYWxTdHJlYW1zJyBpbiB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlKSkge1xuICAgICAgd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5nZXRMb2NhbFN0cmVhbXMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9sb2NhbFN0cmVhbXMpIHtcbiAgICAgICAgICB0aGlzLl9sb2NhbFN0cmVhbXMgPSBbXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fbG9jYWxTdHJlYW1zO1xuICAgICAgfTtcbiAgICB9XG4gICAgaWYgKCEoJ2dldFN0cmVhbUJ5SWQnIGluIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUpKSB7XG4gICAgICB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmdldFN0cmVhbUJ5SWQgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICB2YXIgcmVzdWx0ID0gbnVsbDtcbiAgICAgICAgaWYgKHRoaXMuX2xvY2FsU3RyZWFtcykge1xuICAgICAgICAgIHRoaXMuX2xvY2FsU3RyZWFtcy5mb3JFYWNoKGZ1bmN0aW9uKHN0cmVhbSkge1xuICAgICAgICAgICAgaWYgKHN0cmVhbS5pZCA9PT0gaWQpIHtcbiAgICAgICAgICAgICAgcmVzdWx0ID0gc3RyZWFtO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9yZW1vdGVTdHJlYW1zKSB7XG4gICAgICAgICAgdGhpcy5fcmVtb3RlU3RyZWFtcy5mb3JFYWNoKGZ1bmN0aW9uKHN0cmVhbSkge1xuICAgICAgICAgICAgaWYgKHN0cmVhbS5pZCA9PT0gaWQpIHtcbiAgICAgICAgICAgICAgcmVzdWx0ID0gc3RyZWFtO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9O1xuICAgIH1cbiAgICBpZiAoISgnYWRkU3RyZWFtJyBpbiB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlKSkge1xuICAgICAgdmFyIF9hZGRUcmFjayA9IHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuYWRkVHJhY2s7XG4gICAgICB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmFkZFN0cmVhbSA9IGZ1bmN0aW9uKHN0cmVhbSkge1xuICAgICAgICBpZiAoIXRoaXMuX2xvY2FsU3RyZWFtcykge1xuICAgICAgICAgIHRoaXMuX2xvY2FsU3RyZWFtcyA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9sb2NhbFN0cmVhbXMuaW5kZXhPZihzdHJlYW0pID09PSAtMSkge1xuICAgICAgICAgIHRoaXMuX2xvY2FsU3RyZWFtcy5wdXNoKHN0cmVhbSk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHBjID0gdGhpcztcbiAgICAgICAgc3RyZWFtLmdldFRyYWNrcygpLmZvckVhY2goZnVuY3Rpb24odHJhY2spIHtcbiAgICAgICAgICBfYWRkVHJhY2suY2FsbChwYywgdHJhY2ssIHN0cmVhbSk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5hZGRUcmFjayA9IGZ1bmN0aW9uKHRyYWNrLCBzdHJlYW0pIHtcbiAgICAgICAgaWYgKHN0cmVhbSkge1xuICAgICAgICAgIGlmICghdGhpcy5fbG9jYWxTdHJlYW1zKSB7XG4gICAgICAgICAgICB0aGlzLl9sb2NhbFN0cmVhbXMgPSBbc3RyZWFtXTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuX2xvY2FsU3RyZWFtcy5pbmRleE9mKHN0cmVhbSkgPT09IC0xKSB7XG4gICAgICAgICAgICB0aGlzLl9sb2NhbFN0cmVhbXMucHVzaChzdHJlYW0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gX2FkZFRyYWNrLmNhbGwodGhpcywgdHJhY2ssIHN0cmVhbSk7XG4gICAgICB9O1xuICAgIH1cbiAgICBpZiAoISgncmVtb3ZlU3RyZWFtJyBpbiB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlKSkge1xuICAgICAgd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5yZW1vdmVTdHJlYW0gPSBmdW5jdGlvbihzdHJlYW0pIHtcbiAgICAgICAgaWYgKCF0aGlzLl9sb2NhbFN0cmVhbXMpIHtcbiAgICAgICAgICB0aGlzLl9sb2NhbFN0cmVhbXMgPSBbXTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgaW5kZXggPSB0aGlzLl9sb2NhbFN0cmVhbXMuaW5kZXhPZihzdHJlYW0pO1xuICAgICAgICBpZiAoaW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2xvY2FsU3RyZWFtcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICB2YXIgcGMgPSB0aGlzO1xuICAgICAgICB2YXIgdHJhY2tzID0gc3RyZWFtLmdldFRyYWNrcygpO1xuICAgICAgICB0aGlzLmdldFNlbmRlcnMoKS5mb3JFYWNoKGZ1bmN0aW9uKHNlbmRlcikge1xuICAgICAgICAgIGlmICh0cmFja3MuaW5kZXhPZihzZW5kZXIudHJhY2spICE9PSAtMSkge1xuICAgICAgICAgICAgcGMucmVtb3ZlVHJhY2soc2VuZGVyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICB9XG4gIH0sXG4gIHNoaW1SZW1vdGVTdHJlYW1zQVBJOiBmdW5jdGlvbih3aW5kb3cpIHtcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ29iamVjdCcgfHwgIXdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoISgnZ2V0UmVtb3RlU3RyZWFtcycgaW4gd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZSkpIHtcbiAgICAgIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuZ2V0UmVtb3RlU3RyZWFtcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcmVtb3RlU3RyZWFtcyA/IHRoaXMuX3JlbW90ZVN0cmVhbXMgOiBbXTtcbiAgICAgIH07XG4gICAgfVxuICAgIGlmICghKCdvbmFkZHN0cmVhbScgaW4gd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZSkpIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLCAnb25hZGRzdHJlYW0nLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuX29uYWRkc3RyZWFtO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKGYpIHtcbiAgICAgICAgICBpZiAodGhpcy5fb25hZGRzdHJlYW0pIHtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcignYWRkc3RyZWFtJywgdGhpcy5fb25hZGRzdHJlYW0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIoJ2FkZHN0cmVhbScsIHRoaXMuX29uYWRkc3RyZWFtID0gZik7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgdmFyIG9yaWdTZXRSZW1vdGVEZXNjcmlwdGlvbiA9XG4gICAgICAgICAgd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZS5zZXRSZW1vdGVEZXNjcmlwdGlvbjtcbiAgICAgIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuc2V0UmVtb3RlRGVzY3JpcHRpb24gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIHBjID0gdGhpcztcbiAgICAgICAgaWYgKCF0aGlzLl9vbmFkZHN0cmVhbXBvbHkpIHtcbiAgICAgICAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIoJ3RyYWNrJywgdGhpcy5fb25hZGRzdHJlYW1wb2x5ID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgZS5zdHJlYW1zLmZvckVhY2goZnVuY3Rpb24oc3RyZWFtKSB7XG4gICAgICAgICAgICAgIGlmICghcGMuX3JlbW90ZVN0cmVhbXMpIHtcbiAgICAgICAgICAgICAgICBwYy5fcmVtb3RlU3RyZWFtcyA9IFtdO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmIChwYy5fcmVtb3RlU3RyZWFtcy5pbmRleE9mKHN0cmVhbSkgPj0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBwYy5fcmVtb3RlU3RyZWFtcy5wdXNoKHN0cmVhbSk7XG4gICAgICAgICAgICAgIHZhciBldmVudCA9IG5ldyBFdmVudCgnYWRkc3RyZWFtJyk7XG4gICAgICAgICAgICAgIGV2ZW50LnN0cmVhbSA9IHN0cmVhbTtcbiAgICAgICAgICAgICAgcGMuZGlzcGF0Y2hFdmVudChldmVudCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb3JpZ1NldFJlbW90ZURlc2NyaXB0aW9uLmFwcGx5KHBjLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9XG4gIH0sXG4gIHNoaW1DYWxsYmFja3NBUEk6IGZ1bmN0aW9uKHdpbmRvdykge1xuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAnb2JqZWN0JyB8fCAhd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBwcm90b3R5cGUgPSB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlO1xuICAgIHZhciBjcmVhdGVPZmZlciA9IHByb3RvdHlwZS5jcmVhdGVPZmZlcjtcbiAgICB2YXIgY3JlYXRlQW5zd2VyID0gcHJvdG90eXBlLmNyZWF0ZUFuc3dlcjtcbiAgICB2YXIgc2V0TG9jYWxEZXNjcmlwdGlvbiA9IHByb3RvdHlwZS5zZXRMb2NhbERlc2NyaXB0aW9uO1xuICAgIHZhciBzZXRSZW1vdGVEZXNjcmlwdGlvbiA9IHByb3RvdHlwZS5zZXRSZW1vdGVEZXNjcmlwdGlvbjtcbiAgICB2YXIgYWRkSWNlQ2FuZGlkYXRlID0gcHJvdG90eXBlLmFkZEljZUNhbmRpZGF0ZTtcblxuICAgIHByb3RvdHlwZS5jcmVhdGVPZmZlciA9IGZ1bmN0aW9uKHN1Y2Nlc3NDYWxsYmFjaywgZmFpbHVyZUNhbGxiYWNrKSB7XG4gICAgICB2YXIgb3B0aW9ucyA9IChhcmd1bWVudHMubGVuZ3RoID49IDIpID8gYXJndW1lbnRzWzJdIDogYXJndW1lbnRzWzBdO1xuICAgICAgdmFyIHByb21pc2UgPSBjcmVhdGVPZmZlci5hcHBseSh0aGlzLCBbb3B0aW9uc10pO1xuICAgICAgaWYgKCFmYWlsdXJlQ2FsbGJhY2spIHtcbiAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICB9XG4gICAgICBwcm9taXNlLnRoZW4oc3VjY2Vzc0NhbGxiYWNrLCBmYWlsdXJlQ2FsbGJhY2spO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH07XG5cbiAgICBwcm90b3R5cGUuY3JlYXRlQW5zd2VyID0gZnVuY3Rpb24oc3VjY2Vzc0NhbGxiYWNrLCBmYWlsdXJlQ2FsbGJhY2spIHtcbiAgICAgIHZhciBvcHRpb25zID0gKGFyZ3VtZW50cy5sZW5ndGggPj0gMikgPyBhcmd1bWVudHNbMl0gOiBhcmd1bWVudHNbMF07XG4gICAgICB2YXIgcHJvbWlzZSA9IGNyZWF0ZUFuc3dlci5hcHBseSh0aGlzLCBbb3B0aW9uc10pO1xuICAgICAgaWYgKCFmYWlsdXJlQ2FsbGJhY2spIHtcbiAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICB9XG4gICAgICBwcm9taXNlLnRoZW4oc3VjY2Vzc0NhbGxiYWNrLCBmYWlsdXJlQ2FsbGJhY2spO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH07XG5cbiAgICB2YXIgd2l0aENhbGxiYWNrID0gZnVuY3Rpb24oZGVzY3JpcHRpb24sIHN1Y2Nlc3NDYWxsYmFjaywgZmFpbHVyZUNhbGxiYWNrKSB7XG4gICAgICB2YXIgcHJvbWlzZSA9IHNldExvY2FsRGVzY3JpcHRpb24uYXBwbHkodGhpcywgW2Rlc2NyaXB0aW9uXSk7XG4gICAgICBpZiAoIWZhaWx1cmVDYWxsYmFjaykge1xuICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICAgIH1cbiAgICAgIHByb21pc2UudGhlbihzdWNjZXNzQ2FsbGJhY2ssIGZhaWx1cmVDYWxsYmFjayk7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfTtcbiAgICBwcm90b3R5cGUuc2V0TG9jYWxEZXNjcmlwdGlvbiA9IHdpdGhDYWxsYmFjaztcblxuICAgIHdpdGhDYWxsYmFjayA9IGZ1bmN0aW9uKGRlc2NyaXB0aW9uLCBzdWNjZXNzQ2FsbGJhY2ssIGZhaWx1cmVDYWxsYmFjaykge1xuICAgICAgdmFyIHByb21pc2UgPSBzZXRSZW1vdGVEZXNjcmlwdGlvbi5hcHBseSh0aGlzLCBbZGVzY3JpcHRpb25dKTtcbiAgICAgIGlmICghZmFpbHVyZUNhbGxiYWNrKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgfVxuICAgICAgcHJvbWlzZS50aGVuKHN1Y2Nlc3NDYWxsYmFjaywgZmFpbHVyZUNhbGxiYWNrKTtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9O1xuICAgIHByb3RvdHlwZS5zZXRSZW1vdGVEZXNjcmlwdGlvbiA9IHdpdGhDYWxsYmFjaztcblxuICAgIHdpdGhDYWxsYmFjayA9IGZ1bmN0aW9uKGNhbmRpZGF0ZSwgc3VjY2Vzc0NhbGxiYWNrLCBmYWlsdXJlQ2FsbGJhY2spIHtcbiAgICAgIHZhciBwcm9taXNlID0gYWRkSWNlQ2FuZGlkYXRlLmFwcGx5KHRoaXMsIFtjYW5kaWRhdGVdKTtcbiAgICAgIGlmICghZmFpbHVyZUNhbGxiYWNrKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgfVxuICAgICAgcHJvbWlzZS50aGVuKHN1Y2Nlc3NDYWxsYmFjaywgZmFpbHVyZUNhbGxiYWNrKTtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9O1xuICAgIHByb3RvdHlwZS5hZGRJY2VDYW5kaWRhdGUgPSB3aXRoQ2FsbGJhY2s7XG4gIH0sXG4gIHNoaW1HZXRVc2VyTWVkaWE6IGZ1bmN0aW9uKHdpbmRvdykge1xuICAgIHZhciBuYXZpZ2F0b3IgPSB3aW5kb3cgJiYgd2luZG93Lm5hdmlnYXRvcjtcblxuICAgIGlmICghbmF2aWdhdG9yLmdldFVzZXJNZWRpYSkge1xuICAgICAgaWYgKG5hdmlnYXRvci53ZWJraXRHZXRVc2VyTWVkaWEpIHtcbiAgICAgICAgbmF2aWdhdG9yLmdldFVzZXJNZWRpYSA9IG5hdmlnYXRvci53ZWJraXRHZXRVc2VyTWVkaWEuYmluZChuYXZpZ2F0b3IpO1xuICAgICAgfSBlbHNlIGlmIChuYXZpZ2F0b3IubWVkaWFEZXZpY2VzICYmXG4gICAgICAgICAgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEpIHtcbiAgICAgICAgbmF2aWdhdG9yLmdldFVzZXJNZWRpYSA9IGZ1bmN0aW9uKGNvbnN0cmFpbnRzLCBjYiwgZXJyY2IpIHtcbiAgICAgICAgICBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYShjb25zdHJhaW50cylcbiAgICAgICAgICAudGhlbihjYiwgZXJyY2IpO1xuICAgICAgICB9LmJpbmQobmF2aWdhdG9yKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHNoaW1SVENJY2VTZXJ2ZXJVcmxzOiBmdW5jdGlvbih3aW5kb3cpIHtcbiAgICAvLyBtaWdyYXRlIGZyb20gbm9uLXNwZWMgUlRDSWNlU2VydmVyLnVybCB0byBSVENJY2VTZXJ2ZXIudXJsc1xuICAgIHZhciBPcmlnUGVlckNvbm5lY3Rpb24gPSB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb247XG4gICAgd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uID0gZnVuY3Rpb24ocGNDb25maWcsIHBjQ29uc3RyYWludHMpIHtcbiAgICAgIGlmIChwY0NvbmZpZyAmJiBwY0NvbmZpZy5pY2VTZXJ2ZXJzKSB7XG4gICAgICAgIHZhciBuZXdJY2VTZXJ2ZXJzID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGNDb25maWcuaWNlU2VydmVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIHZhciBzZXJ2ZXIgPSBwY0NvbmZpZy5pY2VTZXJ2ZXJzW2ldO1xuICAgICAgICAgIGlmICghc2VydmVyLmhhc093blByb3BlcnR5KCd1cmxzJykgJiZcbiAgICAgICAgICAgICAgc2VydmVyLmhhc093blByb3BlcnR5KCd1cmwnKSkge1xuICAgICAgICAgICAgdXRpbHMuZGVwcmVjYXRlZCgnUlRDSWNlU2VydmVyLnVybCcsICdSVENJY2VTZXJ2ZXIudXJscycpO1xuICAgICAgICAgICAgc2VydmVyID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShzZXJ2ZXIpKTtcbiAgICAgICAgICAgIHNlcnZlci51cmxzID0gc2VydmVyLnVybDtcbiAgICAgICAgICAgIGRlbGV0ZSBzZXJ2ZXIudXJsO1xuICAgICAgICAgICAgbmV3SWNlU2VydmVycy5wdXNoKHNlcnZlcik7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5ld0ljZVNlcnZlcnMucHVzaChwY0NvbmZpZy5pY2VTZXJ2ZXJzW2ldKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcGNDb25maWcuaWNlU2VydmVycyA9IG5ld0ljZVNlcnZlcnM7XG4gICAgICB9XG4gICAgICByZXR1cm4gbmV3IE9yaWdQZWVyQ29ubmVjdGlvbihwY0NvbmZpZywgcGNDb25zdHJhaW50cyk7XG4gICAgfTtcbiAgICB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlID0gT3JpZ1BlZXJDb25uZWN0aW9uLnByb3RvdHlwZTtcbiAgICAvLyB3cmFwIHN0YXRpYyBtZXRob2RzLiBDdXJyZW50bHkganVzdCBnZW5lcmF0ZUNlcnRpZmljYXRlLlxuICAgIGlmICgnZ2VuZXJhdGVDZXJ0aWZpY2F0ZScgaW4gd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uKSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LlJUQ1BlZXJDb25uZWN0aW9uLCAnZ2VuZXJhdGVDZXJ0aWZpY2F0ZScsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gT3JpZ1BlZXJDb25uZWN0aW9uLmdlbmVyYXRlQ2VydGlmaWNhdGU7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcbiAgc2hpbVRyYWNrRXZlbnRUcmFuc2NlaXZlcjogZnVuY3Rpb24od2luZG93KSB7XG4gICAgLy8gQWRkIGV2ZW50LnRyYW5zY2VpdmVyIG1lbWJlciBvdmVyIGRlcHJlY2F0ZWQgZXZlbnQucmVjZWl2ZXJcbiAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ29iamVjdCcgJiYgd2luZG93LlJUQ1BlZXJDb25uZWN0aW9uICYmXG4gICAgICAgICgncmVjZWl2ZXInIGluIHdpbmRvdy5SVENUcmFja0V2ZW50LnByb3RvdHlwZSkgJiZcbiAgICAgICAgLy8gY2FuJ3QgY2hlY2sgJ3RyYW5zY2VpdmVyJyBpbiB3aW5kb3cuUlRDVHJhY2tFdmVudC5wcm90b3R5cGUsIGFzIGl0IGlzXG4gICAgICAgIC8vIGRlZmluZWQgZm9yIHNvbWUgcmVhc29uIGV2ZW4gd2hlbiB3aW5kb3cuUlRDVHJhbnNjZWl2ZXIgaXMgbm90LlxuICAgICAgICAhd2luZG93LlJUQ1RyYW5zY2VpdmVyKSB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LlJUQ1RyYWNrRXZlbnQucHJvdG90eXBlLCAndHJhbnNjZWl2ZXInLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIHtyZWNlaXZlcjogdGhpcy5yZWNlaXZlcn07XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICBzaGltQ3JlYXRlT2ZmZXJMZWdhY3k6IGZ1bmN0aW9uKHdpbmRvdykge1xuICAgIHZhciBvcmlnQ3JlYXRlT2ZmZXIgPSB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlLmNyZWF0ZU9mZmVyO1xuICAgIHdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbi5wcm90b3R5cGUuY3JlYXRlT2ZmZXIgPSBmdW5jdGlvbihvZmZlck9wdGlvbnMpIHtcbiAgICAgIHZhciBwYyA9IHRoaXM7XG4gICAgICBpZiAob2ZmZXJPcHRpb25zKSB7XG4gICAgICAgIGlmICh0eXBlb2Ygb2ZmZXJPcHRpb25zLm9mZmVyVG9SZWNlaXZlQXVkaW8gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgLy8gc3VwcG9ydCBiaXQgdmFsdWVzXG4gICAgICAgICAgb2ZmZXJPcHRpb25zLm9mZmVyVG9SZWNlaXZlQXVkaW8gPSAhIW9mZmVyT3B0aW9ucy5vZmZlclRvUmVjZWl2ZUF1ZGlvO1xuICAgICAgICB9XG4gICAgICAgIHZhciBhdWRpb1RyYW5zY2VpdmVyID0gcGMuZ2V0VHJhbnNjZWl2ZXJzKCkuZmluZChmdW5jdGlvbih0cmFuc2NlaXZlcikge1xuICAgICAgICAgIHJldHVybiB0cmFuc2NlaXZlci5zZW5kZXIudHJhY2sgJiZcbiAgICAgICAgICAgICAgdHJhbnNjZWl2ZXIuc2VuZGVyLnRyYWNrLmtpbmQgPT09ICdhdWRpbyc7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAob2ZmZXJPcHRpb25zLm9mZmVyVG9SZWNlaXZlQXVkaW8gPT09IGZhbHNlICYmIGF1ZGlvVHJhbnNjZWl2ZXIpIHtcbiAgICAgICAgICBpZiAoYXVkaW9UcmFuc2NlaXZlci5kaXJlY3Rpb24gPT09ICdzZW5kcmVjdicpIHtcbiAgICAgICAgICAgIGlmIChhdWRpb1RyYW5zY2VpdmVyLnNldERpcmVjdGlvbikge1xuICAgICAgICAgICAgICBhdWRpb1RyYW5zY2VpdmVyLnNldERpcmVjdGlvbignc2VuZG9ubHknKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGF1ZGlvVHJhbnNjZWl2ZXIuZGlyZWN0aW9uID0gJ3NlbmRvbmx5JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2UgaWYgKGF1ZGlvVHJhbnNjZWl2ZXIuZGlyZWN0aW9uID09PSAncmVjdm9ubHknKSB7XG4gICAgICAgICAgICBpZiAoYXVkaW9UcmFuc2NlaXZlci5zZXREaXJlY3Rpb24pIHtcbiAgICAgICAgICAgICAgYXVkaW9UcmFuc2NlaXZlci5zZXREaXJlY3Rpb24oJ2luYWN0aXZlJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBhdWRpb1RyYW5zY2VpdmVyLmRpcmVjdGlvbiA9ICdpbmFjdGl2ZSc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKG9mZmVyT3B0aW9ucy5vZmZlclRvUmVjZWl2ZUF1ZGlvID09PSB0cnVlICYmXG4gICAgICAgICAgICAhYXVkaW9UcmFuc2NlaXZlcikge1xuICAgICAgICAgIHBjLmFkZFRyYW5zY2VpdmVyKCdhdWRpbycpO1xuICAgICAgICB9XG5cblxuICAgICAgICBpZiAodHlwZW9mIG9mZmVyT3B0aW9ucy5vZmZlclRvUmVjZWl2ZVZpZGVvICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgIC8vIHN1cHBvcnQgYml0IHZhbHVlc1xuICAgICAgICAgIG9mZmVyT3B0aW9ucy5vZmZlclRvUmVjZWl2ZVZpZGVvID0gISFvZmZlck9wdGlvbnMub2ZmZXJUb1JlY2VpdmVWaWRlbztcbiAgICAgICAgfVxuICAgICAgICB2YXIgdmlkZW9UcmFuc2NlaXZlciA9IHBjLmdldFRyYW5zY2VpdmVycygpLmZpbmQoZnVuY3Rpb24odHJhbnNjZWl2ZXIpIHtcbiAgICAgICAgICByZXR1cm4gdHJhbnNjZWl2ZXIuc2VuZGVyLnRyYWNrICYmXG4gICAgICAgICAgICAgIHRyYW5zY2VpdmVyLnNlbmRlci50cmFjay5raW5kID09PSAndmlkZW8nO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKG9mZmVyT3B0aW9ucy5vZmZlclRvUmVjZWl2ZVZpZGVvID09PSBmYWxzZSAmJiB2aWRlb1RyYW5zY2VpdmVyKSB7XG4gICAgICAgICAgaWYgKHZpZGVvVHJhbnNjZWl2ZXIuZGlyZWN0aW9uID09PSAnc2VuZHJlY3YnKSB7XG4gICAgICAgICAgICB2aWRlb1RyYW5zY2VpdmVyLnNldERpcmVjdGlvbignc2VuZG9ubHknKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHZpZGVvVHJhbnNjZWl2ZXIuZGlyZWN0aW9uID09PSAncmVjdm9ubHknKSB7XG4gICAgICAgICAgICB2aWRlb1RyYW5zY2VpdmVyLnNldERpcmVjdGlvbignaW5hY3RpdmUnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAob2ZmZXJPcHRpb25zLm9mZmVyVG9SZWNlaXZlVmlkZW8gPT09IHRydWUgJiZcbiAgICAgICAgICAgICF2aWRlb1RyYW5zY2VpdmVyKSB7XG4gICAgICAgICAgcGMuYWRkVHJhbnNjZWl2ZXIoJ3ZpZGVvJyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBvcmlnQ3JlYXRlT2ZmZXIuYXBwbHkocGMsIGFyZ3VtZW50cyk7XG4gICAgfTtcbiAgfVxufTtcbiIsIi8qXG4gKiAgQ29weXJpZ2h0IChjKSAyMDE2IFRoZSBXZWJSVEMgcHJvamVjdCBhdXRob3JzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqICBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhIEJTRC1zdHlsZSBsaWNlbnNlXG4gKiAgdGhhdCBjYW4gYmUgZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBvZiB0aGUgc291cmNlXG4gKiAgdHJlZS5cbiAqL1xuIC8qIGVzbGludC1lbnYgbm9kZSAqL1xuJ3VzZSBzdHJpY3QnO1xuXG52YXIgbG9nRGlzYWJsZWRfID0gdHJ1ZTtcbnZhciBkZXByZWNhdGlvbldhcm5pbmdzXyA9IHRydWU7XG5cbi8qKlxuICogRXh0cmFjdCBicm93c2VyIHZlcnNpb24gb3V0IG9mIHRoZSBwcm92aWRlZCB1c2VyIGFnZW50IHN0cmluZy5cbiAqXG4gKiBAcGFyYW0geyFzdHJpbmd9IHVhc3RyaW5nIHVzZXJBZ2VudCBzdHJpbmcuXG4gKiBAcGFyYW0geyFzdHJpbmd9IGV4cHIgUmVndWxhciBleHByZXNzaW9uIHVzZWQgYXMgbWF0Y2ggY3JpdGVyaWEuXG4gKiBAcGFyYW0geyFudW1iZXJ9IHBvcyBwb3NpdGlvbiBpbiB0aGUgdmVyc2lvbiBzdHJpbmcgdG8gYmUgcmV0dXJuZWQuXG4gKiBAcmV0dXJuIHshbnVtYmVyfSBicm93c2VyIHZlcnNpb24uXG4gKi9cbmZ1bmN0aW9uIGV4dHJhY3RWZXJzaW9uKHVhc3RyaW5nLCBleHByLCBwb3MpIHtcbiAgdmFyIG1hdGNoID0gdWFzdHJpbmcubWF0Y2goZXhwcik7XG4gIHJldHVybiBtYXRjaCAmJiBtYXRjaC5sZW5ndGggPj0gcG9zICYmIHBhcnNlSW50KG1hdGNoW3Bvc10sIDEwKTtcbn1cblxuLy8gV3JhcHMgdGhlIHBlZXJjb25uZWN0aW9uIGV2ZW50IGV2ZW50TmFtZVRvV3JhcCBpbiBhIGZ1bmN0aW9uXG4vLyB3aGljaCByZXR1cm5zIHRoZSBtb2RpZmllZCBldmVudCBvYmplY3QgKG9yIGZhbHNlIHRvIHByZXZlbnRcbi8vIHRoZSBldmVudCkuXG5mdW5jdGlvbiB3cmFwUGVlckNvbm5lY3Rpb25FdmVudCh3aW5kb3csIGV2ZW50TmFtZVRvV3JhcCwgd3JhcHBlcikge1xuICBpZiAoIXdpbmRvdy5SVENQZWVyQ29ubmVjdGlvbikge1xuICAgIHJldHVybjtcbiAgfVxuICB2YXIgcHJvdG8gPSB3aW5kb3cuUlRDUGVlckNvbm5lY3Rpb24ucHJvdG90eXBlO1xuICB2YXIgbmF0aXZlQWRkRXZlbnRMaXN0ZW5lciA9IHByb3RvLmFkZEV2ZW50TGlzdGVuZXI7XG4gIHByb3RvLmFkZEV2ZW50TGlzdGVuZXIgPSBmdW5jdGlvbihuYXRpdmVFdmVudE5hbWUsIGNiKSB7XG4gICAgaWYgKG5hdGl2ZUV2ZW50TmFtZSAhPT0gZXZlbnROYW1lVG9XcmFwKSB7XG4gICAgICByZXR1cm4gbmF0aXZlQWRkRXZlbnRMaXN0ZW5lci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIH1cbiAgICB2YXIgd3JhcHBlZENhbGxiYWNrID0gZnVuY3Rpb24oZSkge1xuICAgICAgdmFyIG1vZGlmaWVkRXZlbnQgPSB3cmFwcGVyKGUpO1xuICAgICAgaWYgKG1vZGlmaWVkRXZlbnQpIHtcbiAgICAgICAgY2IobW9kaWZpZWRFdmVudCk7XG4gICAgICB9XG4gICAgfTtcbiAgICB0aGlzLl9ldmVudE1hcCA9IHRoaXMuX2V2ZW50TWFwIHx8IHt9O1xuICAgIHRoaXMuX2V2ZW50TWFwW2NiXSA9IHdyYXBwZWRDYWxsYmFjaztcbiAgICByZXR1cm4gbmF0aXZlQWRkRXZlbnRMaXN0ZW5lci5hcHBseSh0aGlzLCBbbmF0aXZlRXZlbnROYW1lLFxuICAgICAgd3JhcHBlZENhbGxiYWNrXSk7XG4gIH07XG5cbiAgdmFyIG5hdGl2ZVJlbW92ZUV2ZW50TGlzdGVuZXIgPSBwcm90by5yZW1vdmVFdmVudExpc3RlbmVyO1xuICBwcm90by5yZW1vdmVFdmVudExpc3RlbmVyID0gZnVuY3Rpb24obmF0aXZlRXZlbnROYW1lLCBjYikge1xuICAgIGlmIChuYXRpdmVFdmVudE5hbWUgIT09IGV2ZW50TmFtZVRvV3JhcCB8fCAhdGhpcy5fZXZlbnRNYXBcbiAgICAgICAgfHwgIXRoaXMuX2V2ZW50TWFwW2NiXSkge1xuICAgICAgcmV0dXJuIG5hdGl2ZVJlbW92ZUV2ZW50TGlzdGVuZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9XG4gICAgdmFyIHVud3JhcHBlZENiID0gdGhpcy5fZXZlbnRNYXBbY2JdO1xuICAgIGRlbGV0ZSB0aGlzLl9ldmVudE1hcFtjYl07XG4gICAgcmV0dXJuIG5hdGl2ZVJlbW92ZUV2ZW50TGlzdGVuZXIuYXBwbHkodGhpcywgW25hdGl2ZUV2ZW50TmFtZSxcbiAgICAgIHVud3JhcHBlZENiXSk7XG4gIH07XG5cbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb3RvLCAnb24nICsgZXZlbnROYW1lVG9XcmFwLCB7XG4gICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzWydfb24nICsgZXZlbnROYW1lVG9XcmFwXTtcbiAgICB9LFxuICAgIHNldDogZnVuY3Rpb24oY2IpIHtcbiAgICAgIGlmICh0aGlzWydfb24nICsgZXZlbnROYW1lVG9XcmFwXSkge1xuICAgICAgICB0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lVG9XcmFwLFxuICAgICAgICAgICAgdGhpc1snX29uJyArIGV2ZW50TmFtZVRvV3JhcF0pO1xuICAgICAgICBkZWxldGUgdGhpc1snX29uJyArIGV2ZW50TmFtZVRvV3JhcF07XG4gICAgICB9XG4gICAgICBpZiAoY2IpIHtcbiAgICAgICAgdGhpcy5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZVRvV3JhcCxcbiAgICAgICAgICAgIHRoaXNbJ19vbicgKyBldmVudE5hbWVUb1dyYXBdID0gY2IpO1xuICAgICAgfVxuICAgIH0sXG4gICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICBjb25maWd1cmFibGU6IHRydWVcbiAgfSk7XG59XG5cbi8vIFV0aWxpdHkgbWV0aG9kcy5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBleHRyYWN0VmVyc2lvbjogZXh0cmFjdFZlcnNpb24sXG4gIHdyYXBQZWVyQ29ubmVjdGlvbkV2ZW50OiB3cmFwUGVlckNvbm5lY3Rpb25FdmVudCxcbiAgZGlzYWJsZUxvZzogZnVuY3Rpb24oYm9vbCkge1xuICAgIGlmICh0eXBlb2YgYm9vbCAhPT0gJ2Jvb2xlYW4nKSB7XG4gICAgICByZXR1cm4gbmV3IEVycm9yKCdBcmd1bWVudCB0eXBlOiAnICsgdHlwZW9mIGJvb2wgK1xuICAgICAgICAgICcuIFBsZWFzZSB1c2UgYSBib29sZWFuLicpO1xuICAgIH1cbiAgICBsb2dEaXNhYmxlZF8gPSBib29sO1xuICAgIHJldHVybiAoYm9vbCkgPyAnYWRhcHRlci5qcyBsb2dnaW5nIGRpc2FibGVkJyA6XG4gICAgICAgICdhZGFwdGVyLmpzIGxvZ2dpbmcgZW5hYmxlZCc7XG4gIH0sXG5cbiAgLyoqXG4gICAqIERpc2FibGUgb3IgZW5hYmxlIGRlcHJlY2F0aW9uIHdhcm5pbmdzXG4gICAqIEBwYXJhbSB7IWJvb2xlYW59IGJvb2wgc2V0IHRvIHRydWUgdG8gZGlzYWJsZSB3YXJuaW5ncy5cbiAgICovXG4gIGRpc2FibGVXYXJuaW5nczogZnVuY3Rpb24oYm9vbCkge1xuICAgIGlmICh0eXBlb2YgYm9vbCAhPT0gJ2Jvb2xlYW4nKSB7XG4gICAgICByZXR1cm4gbmV3IEVycm9yKCdBcmd1bWVudCB0eXBlOiAnICsgdHlwZW9mIGJvb2wgK1xuICAgICAgICAgICcuIFBsZWFzZSB1c2UgYSBib29sZWFuLicpO1xuICAgIH1cbiAgICBkZXByZWNhdGlvbldhcm5pbmdzXyA9ICFib29sO1xuICAgIHJldHVybiAnYWRhcHRlci5qcyBkZXByZWNhdGlvbiB3YXJuaW5ncyAnICsgKGJvb2wgPyAnZGlzYWJsZWQnIDogJ2VuYWJsZWQnKTtcbiAgfSxcblxuICBsb2c6IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0Jykge1xuICAgICAgaWYgKGxvZ0Rpc2FibGVkXykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBjb25zb2xlLmxvZyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBjb25zb2xlLmxvZy5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xuICAgICAgfVxuICAgIH1cbiAgfSxcblxuICAvKipcbiAgICogU2hvd3MgYSBkZXByZWNhdGlvbiB3YXJuaW5nIHN1Z2dlc3RpbmcgdGhlIG1vZGVybiBhbmQgc3BlYy1jb21wYXRpYmxlIEFQSS5cbiAgICovXG4gIGRlcHJlY2F0ZWQ6IGZ1bmN0aW9uKG9sZE1ldGhvZCwgbmV3TWV0aG9kKSB7XG4gICAgaWYgKCFkZXByZWNhdGlvbldhcm5pbmdzXykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zb2xlLndhcm4ob2xkTWV0aG9kICsgJyBpcyBkZXByZWNhdGVkLCBwbGVhc2UgdXNlICcgKyBuZXdNZXRob2QgK1xuICAgICAgICAnIGluc3RlYWQuJyk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEJyb3dzZXIgZGV0ZWN0b3IuXG4gICAqXG4gICAqIEByZXR1cm4ge29iamVjdH0gcmVzdWx0IGNvbnRhaW5pbmcgYnJvd3NlciBhbmQgdmVyc2lvblxuICAgKiAgICAgcHJvcGVydGllcy5cbiAgICovXG4gIGRldGVjdEJyb3dzZXI6IGZ1bmN0aW9uKHdpbmRvdykge1xuICAgIHZhciBuYXZpZ2F0b3IgPSB3aW5kb3cgJiYgd2luZG93Lm5hdmlnYXRvcjtcblxuICAgIC8vIFJldHVybmVkIHJlc3VsdCBvYmplY3QuXG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIHJlc3VsdC5icm93c2VyID0gbnVsbDtcbiAgICByZXN1bHQudmVyc2lvbiA9IG51bGw7XG5cbiAgICAvLyBGYWlsIGVhcmx5IGlmIGl0J3Mgbm90IGEgYnJvd3NlclxuICAgIGlmICh0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJyB8fCAhd2luZG93Lm5hdmlnYXRvcikge1xuICAgICAgcmVzdWx0LmJyb3dzZXIgPSAnTm90IGEgYnJvd3Nlci4nO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICBpZiAobmF2aWdhdG9yLm1vekdldFVzZXJNZWRpYSkgeyAvLyBGaXJlZm94LlxuICAgICAgcmVzdWx0LmJyb3dzZXIgPSAnZmlyZWZveCc7XG4gICAgICByZXN1bHQudmVyc2lvbiA9IGV4dHJhY3RWZXJzaW9uKG5hdmlnYXRvci51c2VyQWdlbnQsXG4gICAgICAgICAgL0ZpcmVmb3hcXC8oXFxkKylcXC4vLCAxKTtcbiAgICB9IGVsc2UgaWYgKG5hdmlnYXRvci53ZWJraXRHZXRVc2VyTWVkaWEpIHtcbiAgICAgIC8vIENocm9tZSwgQ2hyb21pdW0sIFdlYnZpZXcsIE9wZXJhLlxuICAgICAgLy8gVmVyc2lvbiBtYXRjaGVzIENocm9tZS9XZWJSVEMgdmVyc2lvbi5cbiAgICAgIHJlc3VsdC5icm93c2VyID0gJ2Nocm9tZSc7XG4gICAgICByZXN1bHQudmVyc2lvbiA9IGV4dHJhY3RWZXJzaW9uKG5hdmlnYXRvci51c2VyQWdlbnQsXG4gICAgICAgICAgL0Nocm9tKGV8aXVtKVxcLyhcXGQrKVxcLi8sIDIpO1xuICAgIH0gZWxzZSBpZiAobmF2aWdhdG9yLm1lZGlhRGV2aWNlcyAmJlxuICAgICAgICBuYXZpZ2F0b3IudXNlckFnZW50Lm1hdGNoKC9FZGdlXFwvKFxcZCspLihcXGQrKSQvKSkgeyAvLyBFZGdlLlxuICAgICAgcmVzdWx0LmJyb3dzZXIgPSAnZWRnZSc7XG4gICAgICByZXN1bHQudmVyc2lvbiA9IGV4dHJhY3RWZXJzaW9uKG5hdmlnYXRvci51c2VyQWdlbnQsXG4gICAgICAgICAgL0VkZ2VcXC8oXFxkKykuKFxcZCspJC8sIDIpO1xuICAgIH0gZWxzZSBpZiAod2luZG93LlJUQ1BlZXJDb25uZWN0aW9uICYmXG4gICAgICAgIG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL0FwcGxlV2ViS2l0XFwvKFxcZCspXFwuLykpIHsgLy8gU2FmYXJpLlxuICAgICAgcmVzdWx0LmJyb3dzZXIgPSAnc2FmYXJpJztcbiAgICAgIHJlc3VsdC52ZXJzaW9uID0gZXh0cmFjdFZlcnNpb24obmF2aWdhdG9yLnVzZXJBZ2VudCxcbiAgICAgICAgICAvQXBwbGVXZWJLaXRcXC8oXFxkKylcXC4vLCAxKTtcbiAgICB9IGVsc2UgeyAvLyBEZWZhdWx0IGZhbGx0aHJvdWdoOiBub3Qgc3VwcG9ydGVkLlxuICAgICAgcmVzdWx0LmJyb3dzZXIgPSAnTm90IGEgc3VwcG9ydGVkIGJyb3dzZXIuJztcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxufTtcbiIsIi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuLyoqXG4gKiBAbGljZW5zZVxuICogTGljZW5zZSBpbmZvIGZvciB3ZWJydGMtYWRhcHRlciBtb2R1bGUgYXNzZW1ibGVkIGludG8ganMgYnVuZGxlOlxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxNCwgVGhlIFdlYlJUQyBwcm9qZWN0IGF1dGhvcnMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0IG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OlxuICpcbiAqIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci5cbiAqXG4gKiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlIGRvY3VtZW50YXRpb24gYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uXG4gKlxuICogTmVpdGhlciB0aGUgbmFtZSBvZiBHb29nbGUgbm9yIHRoZSBuYW1lcyBvZiBpdHMgY29udHJpYnV0b3JzIG1heSBiZSB1c2VkIHRvIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0cyBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi5cbiAqXG4gKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTIFwiQVMgSVNcIiBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRSBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQ09QWVJJR0hUIEhPTERFUiBPUiBDT05UUklCVVRPUlMgQkUgTElBQkxFIEZPUiBBTlkgRElSRUNULCBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQgKElOQ0xVRElORyBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVMgU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuXG4gKi9cbi8qKlxuICogQGxpY2Vuc2VcbiAqIExpY2Vuc2UgaW5mbyBmb3Igc2RwIG1vZHVsZSBhc3NlbWJsZWQgaW50byBqcyBidW5kbGU6XG4gKlxuICogU2VlIGh0dHBzOi8vd3d3Lm5wbWpzLmNvbS9wYWNrYWdlL3NkcFxuICovXG5pbXBvcnQgJ3dlYnJ0Yy1hZGFwdGVyJztcbi8qKlxuICogQGxpY2Vuc2VcbiAqIExpY2Vuc2UgaW5mbyBmb3IgdXVpZCBtb2R1bGUgYXNzZW1ibGVkIGludG8ganMgYnVuZGxlOlxuICpcbiAqIFRoZSBNSVQgTGljZW5zZSAoTUlUKVxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxMC0yMDE2IFJvYmVydCBLaWVmZmVyIGFuZCBvdGhlciBjb250cmlidXRvcnNcbiAqXG4gKiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWwgaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuICpcbiAqIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuICpcbiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLlxuICovXG5pbXBvcnQgUnRjU2Vzc2lvbiBmcm9tICcuL3J0Y19zZXNzaW9uJztcbmltcG9ydCB7UlRDX0VSUk9SU30gZnJvbSAnLi9ydGNfY29uc3QnO1xuaW1wb3J0IFJ0Y1BlZXJDb25uZWN0aW9uRmFjdG9yeSBmcm9tICcuL3J0Y19wZWVyX2Nvbm5lY3Rpb25fZmFjdG9yeSdcbmltcG9ydCB1dWlkIGZyb20gJ3V1aWQvdjQnO1xuaW1wb3J0IFN0YW5kYXJkU3RyYXRlZ3kgZnJvbSBcIi4vc3RyYXRlZ2llcy9TdGFuZGFyZFN0cmF0ZWd5XCI7XG5pbXBvcnQgQ2l0cml4VkRJU3RyYXRlZ3kgZnJvbSBcIi4vc3RyYXRlZ2llcy9DaXRyaXhWRElTdHJhdGVneVwiO1xuXG5nbG9iYWwuY29ubmVjdCA9IGdsb2JhbC5jb25uZWN0IHx8IHt9O1xuZ2xvYmFsLmNvbm5lY3QuUlRDU2Vzc2lvbiA9IFJ0Y1Nlc3Npb247XG5nbG9iYWwuY29ubmVjdC5SVENFcnJvcnMgPSBSVENfRVJST1JTO1xuZ2xvYmFsLmNvbm5lY3QuUnRjUGVlckNvbm5lY3Rpb25GYWN0b3J5ID0gUnRjUGVlckNvbm5lY3Rpb25GYWN0b3J5O1xuZ2xvYmFsLmNvbm5lY3QudXVpZCA9IHV1aWQ7XG5nbG9iYWwuY29ubmVjdC5TdGFuZGFyZFN0cmF0ZWd5ID0gU3RhbmRhcmRTdHJhdGVneTtcbmdsb2JhbC5jb25uZWN0LkNpdHJpeFZESVN0cmF0ZWd5ID0gQ2l0cml4VkRJU3RyYXRlZ3k7XG5cbmdsb2JhbC5saWx5ID0gZ2xvYmFsLmxpbHkgfHwge307XG5nbG9iYWwubGlseS5SVENTZXNzaW9uID0gUnRjU2Vzc2lvbjtcbmdsb2JhbC5saWx5LlJUQ0Vycm9ycyA9IFJUQ19FUlJPUlM7XG4iLCIvKipcbiAqIENvcHlyaWdodCAyMDE3IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuZXhwb3J0IGNvbnN0IFRpbWVvdXRFeGNlcHRpb25OYW1lID0gJ1RpbWVvdXQnO1xuZXhwb3J0IGNsYXNzIFRpbWVvdXQgZXh0ZW5kcyBFcnJvciB7XG4gICAgY29uc3RydWN0b3IobXNnKSB7XG4gICAgICAgIHN1cGVyKG1zZyk7XG4gICAgICAgIHRoaXMubmFtZSA9IFRpbWVvdXRFeGNlcHRpb25OYW1lO1xuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IEd1bVRpbWVvdXRFeGNlcHRpb25OYW1lID0gJ0d1bVRpbWVvdXQnO1xuZXhwb3J0IGNsYXNzIEd1bVRpbWVvdXQgZXh0ZW5kcyBUaW1lb3V0IHtcbiAgICBjb25zdHJ1Y3Rvcihtc2cpIHtcbiAgICAgICAgc3VwZXIobXNnKTtcbiAgICAgICAgdGhpcy5uYW1lID0gR3VtVGltZW91dEV4Y2VwdGlvbk5hbWU7XG4gICAgfVxufVxuXG5leHBvcnQgY29uc3QgSWxsZWdhbFBhcmFtZXRlcnNFeGNlcHRpb25OYW1lID0gJ0lsbGVnYWxQYXJhbWV0ZXJzJztcbmV4cG9ydCBjbGFzcyBJbGxlZ2FsUGFyYW1ldGVycyBleHRlbmRzIEVycm9yIHtcbiAgICBjb25zdHJ1Y3Rvcihtc2cpIHtcbiAgICAgICAgc3VwZXIobXNnKTtcbiAgICAgICAgdGhpcy5uYW1lID0gSWxsZWdhbFBhcmFtZXRlcnNFeGNlcHRpb25OYW1lO1xuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbk5hbWUgPSAnSWxsZWdhbFN0YXRlJztcbmV4cG9ydCBjbGFzcyBJbGxlZ2FsU3RhdGUgZXh0ZW5kcyBFcnJvciB7XG4gICAgY29uc3RydWN0b3IobXNnKSB7XG4gICAgICAgIHN1cGVyKG1zZyk7XG4gICAgICAgIHRoaXMubmFtZSA9IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbk5hbWU7XG4gICAgfVxufVxuXG5leHBvcnQgY29uc3QgVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25OYW1lID0gJ1Vuc3VwcG9ydGVkT3BlcmF0aW9uJztcbmV4cG9ydCBjbGFzcyBVbnN1cHBvcnRlZE9wZXJhdGlvbiBleHRlbmRzIEVycm9yIHtcbiAgICBjb25zdHJ1Y3Rvcihtc2cpIHtcbiAgICAgICAgc3VwZXIobXNnKTtcbiAgICAgICAgdGhpcy5uYW1lID0gVW5zdXBwb3J0ZWRPcGVyYXRpb25FeGNlcHRpb25OYW1lO1xuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IEJ1c3lFeGNlcHRpb25OYW1lID0gJ0J1c3lFeGNlcHRpb24nO1xuZXhwb3J0IGNsYXNzIEJ1c3lFeGNlcHRpb24gZXh0ZW5kcyBFcnJvciB7XG4gICAgY29uc3RydWN0b3IobXNnKSB7XG4gICAgICAgIHN1cGVyKG1zZyk7XG4gICAgICAgIHRoaXMubmFtZSA9IEJ1c3lFeGNlcHRpb25OYW1lO1xuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IENhbGxOb3RGb3VuZEV4Y2VwdGlvbk5hbWUgPSAnQ2FsbE5vdEZvdW5kRXhjZXB0aW9uJztcbmV4cG9ydCBjbGFzcyBDYWxsTm90Rm91bmRFeGNlcHRpb24gZXh0ZW5kcyBFcnJvciB7XG4gICAgY29uc3RydWN0b3IobXNnKSB7XG4gICAgICAgIHN1cGVyKG1zZyk7XG4gICAgICAgIHRoaXMubmFtZSA9IENhbGxOb3RGb3VuZEV4Y2VwdGlvbk5hbWU7XG4gICAgfVxufVxuXG5leHBvcnQgY29uc3QgVW5rbm93blNpZ25hbGluZ0Vycm9yTmFtZSA9ICdVbmtub3duU2lnbmFsaW5nRXJyb3InO1xuZXhwb3J0IGNsYXNzIFVua25vd25TaWduYWxpbmdFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5uYW1lID0gVW5rbm93blNpZ25hbGluZ0Vycm9yTmFtZTtcbiAgICB9XG59XG4iLCIvKipcbiAqIENvcHlyaWdodCAyMDE3IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG4vKipcbiAqIFRpbWVvdXQgd2FpdGluZyBmb3Igc2VydmVyIHJlc3BvbnNlIHRvIGFjY2VwdC9oYW5ndXAgcmVxdWVzdC5cbiAqL1xuZXhwb3J0IGNvbnN0IE1BWF9BQ0NFUFRfQllFX0RFTEFZX01TID0gMjAwMDtcbi8qKlxuICogVGltZW91dCB3YWl0aW5nIGZvciBzZXJ2ZXIgcmVzcG9uc2UgdG8gaW52aXRlLlxuICovXG5leHBvcnQgY29uc3QgTUFYX0lOVklURV9ERUxBWV9NUyA9IDUwMDA7XG4vKipcbiAqICBEZWZhdWx0IHRpbWVvdXQgb24gb3BlbmluZyBXZWJTb2NrZXQgY29ubmVjdGlvbi5cbiAqL1xuZXhwb3J0IGNvbnN0IERFRkFVTFRfQ09OTkVDVF9USU1FT1VUX01TID0gMTAwMDA7XG4vKipcbiAqIERlZmF1bHQgaWNlIGNvbGxlY3Rpb24gdGltZW91dCBpbiBtaWxsaXNlY29uZHMuXG4gKi9cbmV4cG9ydCBjb25zdCBERUZBVUxUX0lDRV9USU1FT1VUX01TID0gODAwMDtcbi8qKlxuICogRGVmYXVsdCBndW0gdGltZW91dCBpbiBtaWxsaXNlY29uZHMgdG8gYmUgZW5mb3JjZWQgZHVyaW5nIHN0YXJ0IG9mIGEgY2FsbC5cbiAqL1xuZXhwb3J0IGNvbnN0IERFRkFVTFRfR1VNX1RJTUVPVVRfTVMgPSAxMDAwMDtcblxuZXhwb3J0IGNvbnN0IFNPRlRQSE9ORV9ST1VURV9LRVkgPSBcImF3cy9zb2Z0cGhvbmVcIjtcblxuZXhwb3J0IGNvbnN0IElOVklURV9NRVRIT0RfTkFNRSA9IFwiaW52aXRlXCI7XG5leHBvcnQgY29uc3QgQUNDRVBUX01FVEhPRF9OQU1FID0gXCJhY2NlcHRcIjtcbmV4cG9ydCBjb25zdCBCWUVfTUVUSE9EX05BTUUgPSBcImJ5ZVwiO1xuXG5leHBvcnQgY29uc3QgUlRDX1BFRVJfQ09OTkVDVElPTl9DT05GSUcgPSB7XG4gICAgaWNlVHJhbnNwb3J0UG9saWN5OiAncmVsYXknLFxuICAgIHJ0Y3BNdXhQb2xpY3k6ICdyZXF1aXJlJyxcbiAgICBidW5kbGVQb2xpY3k6ICdiYWxhbmNlZCcsXG4gICAgc2RwU2VtYW50aWNzOiAndW5pZmllZCcsXG4gICAgZW5hYmxlRHRsc1NydHA6IHRydWVcbn07XG5cbmV4cG9ydCBjb25zdCBSVENfUEVFUl9DT05ORUNUSU9OX09QVElPTkFMX0NPTkZJRyA9IHtcbiAgICBvcHRpb25hbDogW1xuICAgICAgICB7XG4gICAgICAgICAgICBnb29nRHNjcDogdHJ1ZVxuXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIER0bHNTcnRwS2V5QWdyZWVtZW50OiB0cnVlXG4gICAgICAgIH1cbiAgICBdXG59O1xuXG5leHBvcnQgY29uc3QgREVGQVVMVF9JQ0VfQ0FORElEQVRFX1BPT0xfU0laRSA9IDE7XG5cbmV4cG9ydCBjb25zdCBSVENfUEVFUl9DT05ORUNUSU9OX0lETEVfVElNRU9VVF9NUyA9IDEqNjAqMTAwMDtcblxuZXhwb3J0IGNvbnN0IE5FVFdPUktfQ09OTkVDVElWSVRZX0NIRUNLX0lOVEVSVkFMX01TID0gMjUwO1xuXG5leHBvcnQgY29uc3QgQ0hST01FX1NVUFBPUlRFRF9WRVJTSU9OID0gNTk7XG5cbi8qKlxuICogUlRDIGVycm9yIG5hbWVzLlxuICovXG5leHBvcnQgY29uc3QgUlRDX0VSUk9SUyA9IHtcbiAgICBJQ0VfQ09MTEVDVElPTl9USU1FT1VUIDogJ0ljZSBDb2xsZWN0aW9uIFRpbWVvdXQnLFxuICAgIFVTRVJfQlVTWSA6ICdVc2VyIEJ1c3knLFxuICAgIFNJR05BTExJTkdfQ09OTkVDVElPTl9GQUlMVVJFIDogJ1NpZ25hbGxpbmcgQ29ubmVjdGlvbiBGYWlsdXJlJyxcbiAgICBTSUdOQUxMSU5HX0hBTkRTSEFLRV9GQUlMVVJFIDogJ1NpZ25hbGxpbmcgSGFuZHNoYWtlIEZhaWx1cmUnLFxuICAgIFNFVF9SRU1PVEVfREVTQ1JJUFRJT05fRkFJTFVSRSA6ICdTZXQgUmVtb3RlIERlc2NyaXB0aW9uIEZhaWx1cmUnLFxuICAgIENSRUFURV9PRkZFUl9GQUlMVVJFIDogJ0NyZWF0ZSBPZmZlciBGYWlsdXJlJyxcbiAgICBTRVRfTE9DQUxfREVTQ1JJUFRJT05fRkFJTFVSRSA6ICdTZXQgTG9jYWwgRGVzY3JpcHRpb24gRmFpbHVyZScsXG4gICAgSU5WQUxJRF9SRU1PVEVfU0RQIDogJ0ludmFsaWQgUmVtb3RlIFNEUCcsXG4gICAgTk9fUkVNT1RFX0lDRV9DQU5ESURBVEUgOiAnTm8gUmVtb3RlIElDRSBDYW5kaWRhdGUnLFxuICAgIEdVTV9USU1FT1VUX0ZBSUxVUkUgOiAnR1VNIFRpbWVvdXQgRmFpbHVyZScsXG4gICAgR1VNX09USEVSX0ZBSUxVUkUgOiAnR1VNIE90aGVyIEZhaWx1cmUnLFxuICAgIENBTExfTk9UX0ZPVU5EOiAnQ2FsbCBOb3QgRm91bmQnXG59O1xuXG5leHBvcnQgY29uc3QgSUNFX0NPTk5FQ1RJT05fU1RBVEUgPSB7XG4gICAgTkVXIDogJ25ldycsXG4gICAgQ0hFQ0tJTkcgOiAnY2hlY2tpbmcnLFxuICAgIENPTk5FQ1RFRCA6ICdjb25uZWN0ZWQnLFxuICAgIENPTVBMRVRFRCA6ICdjb21wbGV0ZWQnLFxuICAgIEZBSUxFRCA6ICdmYWlsZWQnLFxuICAgIERJU0NPTk5FQ1RFRCA6ICdkaXNjb25uZWN0ZWQnLFxuICAgIENMT1NFRCA6ICdjbG9zZWQnXG59O1xuXG5leHBvcnQgY29uc3QgUEVFUl9DT05ORUNUSU9OX1NUQVRFID0ge1xuICAgIE5FVyA6ICduZXcnLFxuICAgIENPTk5FQ1RJTkcgOiAnY29ubmVjdGluZycsXG4gICAgQ09OTkVDVEVEIDogJ2Nvbm5lY3RlZCcsXG4gICAgRkFJTEVEIDogJ2ZhaWxlZCcsXG4gICAgRElTQ09OTkVDVEVEIDogJ2Rpc2Nvbm5lY3RlZCcsXG4gICAgQ0xPU0VEIDogJ2Nsb3NlZCdcbn07IiwiaW1wb3J0IHthc3NlcnRUcnVlLCBoaXRjaCwgaXNGdW5jdGlvbn0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQge1xuICAgIERFRkFVTFRfSUNFX0NBTkRJREFURV9QT09MX1NJWkUsXG4gICAgTkVUV09SS19DT05ORUNUSVZJVFlfQ0hFQ0tfSU5URVJWQUxfTVMsXG4gICAgUlRDX1BFRVJfQ09OTkVDVElPTl9DT05GSUcsXG4gICAgUlRDX1BFRVJfQ09OTkVDVElPTl9JRExFX1RJTUVPVVRfTVMsXG4gICAgUlRDX1BFRVJfQ09OTkVDVElPTl9PUFRJT05BTF9DT05GSUcsXG4gICAgU09GVFBIT05FX1JPVVRFX0tFWVxufSBmcm9tICcuL3J0Y19jb25zdCdcbmltcG9ydCBDQ1BJbml0aWF0aW9uU3RyYXRlZ3lJbnRlcmZhY2UgZnJvbSBcIi4vc3RyYXRlZ2llcy9DQ1BJbml0aWF0aW9uU3RyYXRlZ3lJbnRlcmZhY2VcIjtcbmltcG9ydCBTdGFuZGFyZFN0cmF0ZWd5IGZyb20gXCIuL3N0cmF0ZWdpZXMvU3RhbmRhcmRTdHJhdGVneVwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSdGNQZWVyQ29ubmVjdGlvbkZhY3Rvcnkge1xuXG4gICAgLy90cmFuc3BvcnRIYW5kbGUgbXVzdCBiZSBhIGNhbGxiYWNrIGZ1bmN0aW9uIHdoaWNoIHNob3VsZCByZXR1cm4gYSBwcm9taXNlIHdoaWNoIGlzIGdvaW5nIHRvIHJldHVybiB0aGUgaWNlU2VydmVycy4gUGxlYXNlIHJlZmVyIGh0dHBzOi8vd3d3LnczLm9yZy9UUi93ZWJydGMvI3J0Y2ljZXNlcnZlci1kaWN0aW9uYXJ5IGZvciBpY2VTZXJ2ZXIgZXhhbXBsZVxuICAgIC8vcHVibGlzaEVycm9yKGVycm9yVHlwZSwgZXJyb3JNZXNzYWdlKSBtdXN0IGJlIGEgY2FsbGJhY2sgZnVuY3Rpb24gd2hpY2ggd2lsbCBwdWJsaXNoIHRoZSBwYXNzZWQgZXJyb3IgbWVzc2FnZSB0byBjbGllbnQgYnJvd3NlclxuICAgIGNvbnN0cnVjdG9yKGxvZ2dlciwgd3NzTWFuYWdlciwgY2xpZW50SWQsIHRyYW5zcG9ydEhhbmRsZSwgcHVibGlzaEVycm9yLCBzdHJhdGVneSA9IG5ldyBTdGFuZGFyZFN0cmF0ZWd5KCkpIHtcbiAgICAgICAgaWYgKCEoc3RyYXRlZ3kgaW5zdGFuY2VvZiBDQ1BJbml0aWF0aW9uU3RyYXRlZ3lJbnRlcmZhY2UpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0V4cGVjdGVkIGEgc3RyYXRlZ3kgb2YgdHlwZSBDQ1BJbml0aWF0aW9uU3RyYXRlZ3lJbnRlcmZhY2UnKTtcbiAgICAgICAgfVxuICAgICAgICBhc3NlcnRUcnVlKGlzRnVuY3Rpb24odHJhbnNwb3J0SGFuZGxlKSwgJ3RyYW5zcG9ydEhhbmRsZSBtdXN0IGJlIGEgZnVuY3Rpb24nKTtcbiAgICAgICAgYXNzZXJ0VHJ1ZShpc0Z1bmN0aW9uKHB1Ymxpc2hFcnJvciksICdwdWJsaXNoRXJyb3IgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7XG4gICAgICAgIHRoaXMuX3N0cmF0ZWd5ID0gc3RyYXRlZ3k7XG4gICAgICAgIHRoaXMuX2xvZ2dlciA9IGxvZ2dlcjtcbiAgICAgICAgdGhpcy5fY2xpZW50SWQgPSBjbGllbnRJZDtcbiAgICAgICAgdGhpcy5fd3NzTWFuYWdlciA9IHdzc01hbmFnZXI7XG4gICAgICAgIHRoaXMuX3JlcXVlc3RJY2VBY2Nlc3MgPSB0cmFuc3BvcnRIYW5kbGU7XG4gICAgICAgIHRoaXMuX3B1Ymxpc2hFcnJvciA9IHB1Ymxpc2hFcnJvcjtcbiAgICAgICAgdGhpcy5fYnJvd3NlclN1cHBvcnRlZCA9IHRoaXMuX2lzQnJvd3NlclN1cHBvcnRlZCgpO1xuICAgICAgICB0aGlzLl9pbml0aWFsaXplV2ViU29ja2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICAgICAgdGhpcy5fcmVxdWVzdFBlZXJDb25uZWN0aW9uKCk7XG4gICAgICAgIHRoaXMuX25ldHdvcmtDb25uZWN0aXZpdHlDaGVja2VyKCk7XG5cbiAgICAgICAgdGhpcy5fbG9nZ2VyLmxvZyhcIlJUQy5qcyBpcyB1c2luZyBcIiArIHN0cmF0ZWd5LmdldE5hbWUoKSk7XG4gICAgfVxuXG4gICAgX2lzQnJvd3NlclN1cHBvcnRlZCgpIHtcbiAgICAgICAgdGhpcy5fc3RyYXRlZ3kuX2lzQnJvd3NlclN1cHBvcnRlZCgpO1xuICAgIH1cblxuICAgIC8vVGhpcyB3aWxsIGhhbmRsZSB0aGUgaWRsZUNvbm5lY3Rpb24gYW5kIHF1b3RhIGxpbWl0cyBub3RpZmljYXRpb24gZnJvbSB0aGUgc2VydmVyXG4gICAgX3dlYlNvY2tldE1hbmFnZXJPbk1lc3NhZ2UoZXZlbnQpIHtcbiAgICAgICAgbGV0IGNvbnRlbnQ7XG4gICAgICAgIGlmIChldmVudC5jb250ZW50KSB7XG4gICAgICAgICAgICBjb250ZW50ID0gSlNPTi5wYXJzZShldmVudC5jb250ZW50KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29udGVudCAmJiB0aGlzLl9jbGllbnRJZCA9PT0gY29udGVudC5jbGllbnRJZCkge1xuICAgICAgICAgICAgaWYgKGNvbnRlbnQuanNvblJwY01zZy5tZXRob2QgPT09IFwiaWRsZUNvbm5lY3Rpb25cIikge1xuICAgICAgICAgICAgICAgIHRoaXMuX2NsZWFySWRsZVJ0Y1BlZXJDb25uZWN0aW9uKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGNvbnRlbnQuanNvblJwY01zZy5tZXRob2QgPT09IFwicXVvdGFCcmVhY2hlZFwiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbG9nZ2VyLmxvZyhcIk51bWJlciBvZiBhY3RpdmUgc2Vzc2lvbnMgYXJlIG1vcmUgdGhlbiBhbGxvd2VkIGxpbWl0IGZvciB0aGUgY2xpZW50IFwiICsgdGhpcy5fY2xpZW50SWQpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2Nsb3NlUlRDUGVlckNvbm5lY3Rpb24oKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9wdWJsaXNoRXJyb3IoXCJtdWx0aXBsZV9zb2Z0cGhvbmVfYWN0aXZlX3Nlc3Npb25zXCIsIFwiTnVtYmVyIG9mIGFjdGl2ZSBzZXNzaW9ucyBhcmUgbW9yZSB0aGVuIGFsbG93ZWQgbGltaXQuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgX2luaXRpYWxpemVXZWJTb2NrZXRFdmVudExpc3RlbmVycygpIHtcbiAgICAgICAgdGhpcy5fd3NzTWFuYWdlci5zdWJzY3JpYmVUb3BpY3MoW1NPRlRQSE9ORV9ST1VURV9LRVldKTtcbiAgICAgICAgdGhpcy5fdW5TdWJzY3JpYmUgPSB0aGlzLl93c3NNYW5hZ2VyLm9uTWVzc2FnZShTT0ZUUEhPTkVfUk9VVEVfS0VZLCBoaXRjaCh0aGlzLCB0aGlzLl93ZWJTb2NrZXRNYW5hZ2VyT25NZXNzYWdlKSk7XG4gICAgfVxuXG4gICAgLy8gVGhpcyBtZXRob2Qgd2lsbCBjcmVhdGUgYW5kIHJldHVybiBuZXcgcGVlciBjb25uZWN0aW9uIGlmIGJyb3dzZXIgaXMgbm90IHN1cHBvcnRpbmcgZWFybHkgaWNlIGNvbGxlY3Rpb24uXG4gICAgLy8gRm9yIHRoZSBzdXBwb3J0ZWQgYnJvd3NlciwgdGhpcyBtZXRob2Qgd2lsbCByZXF1ZXN0IGZvciBuZXcgcGVlckNvbm5lY3Rpb24gYWZ0ZXIgcmV0dXJuaW5nIHRoZSBleGlzdGluZyBwZWVyQ29ubmVjdGlvblxuICAgIGdldChpY2VTZXJ2ZXJzKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgdmFyIHBjID0gc2VsZi5fcGM7XG4gICAgICAgIHNlbGYuX3BjID0gbnVsbDtcbiAgICAgICAgaWYgKHBjID09IG51bGwpIHtcbiAgICAgICAgICAgIHBjID0gc2VsZi5fY3JlYXRlUnRjUGVlckNvbm5lY3Rpb24oaWNlU2VydmVycyk7XG4gICAgICAgIH1cbiAgICAgICAgc2VsZi5jbGVhcklkbGVSdGNQZWVyQ29ubmVjdGlvblRpbWVySWQoKTtcbiAgICAgICAgc2VsZi5fcmVxdWVzdFBlZXJDb25uZWN0aW9uKCk7XG4gICAgICAgIHJldHVybiBwYztcbiAgICB9XG5cbiAgICBjbGVhcklkbGVSdGNQZWVyQ29ubmVjdGlvblRpbWVySWQoKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgaWYgKHNlbGYuX2lkbGVSdGNQZWVyQ29ubmVjdGlvblRpbWVySWQpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChzZWxmLl9pZGxlUnRjUGVlckNvbm5lY3Rpb25UaW1lcklkKTtcbiAgICAgICAgICAgIHNlbGYuX2lkbGVSdGNQZWVyQ29ubmVjdGlvblRpbWVySWQgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX3JlcXVlc3RQZWVyQ29ubmVjdGlvbigpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICBpZiAoIXNlbGYuX3BlZXJDb25uZWN0aW9uUmVxdWVzdEluRmxpZ2h0ICYmIHNlbGYuX2Jyb3dzZXJTdXBwb3J0ZWQpIHtcbiAgICAgICAgICAgIHNlbGYuX3BlZXJDb25uZWN0aW9uUmVxdWVzdEluRmxpZ2h0ID0gdHJ1ZTtcbiAgICAgICAgICAgIHNlbGYuX3JlcXVlc3RJY2VBY2Nlc3MoKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLl9wYyA9IHNlbGYuX2NyZWF0ZVJ0Y1BlZXJDb25uZWN0aW9uKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5fcGVlckNvbm5lY3Rpb25SZXF1ZXN0SW5GbGlnaHQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5faWRsZVJ0Y1BlZXJDb25uZWN0aW9uVGltZXJJZCA9IHNldFRpbWVvdXQoaGl0Y2goc2VsZiwgc2VsZi5fcmVmcmVzaFJ0Y1BlZXJDb25uZWN0aW9uKSwgUlRDX1BFRVJfQ09OTkVDVElPTl9JRExFX1RJTUVPVVRfTVMpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKHJlYXNvbikge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLl9wZWVyQ29ubmVjdGlvblJlcXVlc3RJbkZsaWdodCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX25ldHdvcmtDb25uZWN0aXZpdHlDaGVja2VyKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghbmF2aWdhdG9yLm9uTGluZSAmJiBzZWxmLl9wYykge1xuICAgICAgICAgICAgICAgIHNlbGYuX2xvZ2dlci5sb2coXCJOZXR3b3JrIG9mZmxpbmUuIENsZWFuaW5nIHVwIGVhcmx5IGNvbm5lY3Rpb25cIik7XG4gICAgICAgICAgICAgICAgc2VsZi5fcGMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICBzZWxmLl9wYyA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIE5FVFdPUktfQ09OTkVDVElWSVRZX0NIRUNLX0lOVEVSVkFMX01TKTtcbiAgICB9XG5cbiAgICBfY3JlYXRlUnRjUGVlckNvbm5lY3Rpb24oaWNlU2VydmVycykge1xuICAgICAgICB2YXIgcnRjUGVlckNvbm5lY3Rpb25Db25maWcgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KFJUQ19QRUVSX0NPTk5FQ1RJT05fQ09ORklHKSk7XG4gICAgICAgIHJ0Y1BlZXJDb25uZWN0aW9uQ29uZmlnLmljZVNlcnZlcnMgPSBpY2VTZXJ2ZXJzO1xuICAgICAgICBydGNQZWVyQ29ubmVjdGlvbkNvbmZpZy5pY2VDYW5kaWRhdGVQb29sU2l6ZSA9IERFRkFVTFRfSUNFX0NBTkRJREFURV9QT09MX1NJWkU7XG4gICAgICAgIHJldHVybiB0aGlzLl9zdHJhdGVneS5fY3JlYXRlUnRjUGVlckNvbm5lY3Rpb24ocnRjUGVlckNvbm5lY3Rpb25Db25maWcsIFJUQ19QRUVSX0NPTk5FQ1RJT05fT1BUSU9OQUxfQ09ORklHKTtcbiAgICB9XG5cbiAgICBfY2xlYXJJZGxlUnRjUGVlckNvbm5lY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuX2xvZ2dlci5sb2coXCJzZXNzaW9uIGlzIGlkbGUgZnJvbSBsb25nIHRpbWUuIGNsb3NpbmcgdGhlIHBlZXIgY29ubmVjdGlvbiBmb3IgY2xpZW50IFwiICsgdGhpcy5fY2xpZW50SWQpO1xuICAgICAgICB0aGlzLl9jbG9zZVJUQ1BlZXJDb25uZWN0aW9uKCk7XG4gICAgfVxuXG4gICAgX3JlZnJlc2hSdGNQZWVyQ29ubmVjdGlvbigpIHtcbiAgICAgICAgdGhpcy5faWRsZVJ0Y1BlZXJDb25uZWN0aW9uVGltZXJJZCA9IG51bGw7XG4gICAgICAgIHRoaXMuX2NsZWFySWRsZVJ0Y1BlZXJDb25uZWN0aW9uKCk7XG4gICAgICAgIHRoaXMuX2xvZ2dlci5sb2coXCJyZWZyZXNoaW5nIHBlZXIgY29ubmVjdGlvbiBmb3IgY2xpZW50IFwiICsgdGhpcy5fY2xpZW50SWQpO1xuICAgICAgICB0aGlzLl9yZXF1ZXN0UGVlckNvbm5lY3Rpb24oKTtcbiAgICB9XG5cbiAgICBfY2xvc2VSVENQZWVyQ29ubmVjdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuX3BjKSB7XG4gICAgICAgICAgICB0aGlzLl9wYy5jbG9zZSgpO1xuICAgICAgICAgICAgdGhpcy5fcGMgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxufSIsIi8qKlxuICogQ29weXJpZ2h0IDIwMTcgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5pbXBvcnQge2Nsb3NlU3RyZWFtLCBoaXRjaCwgaXNMZWdhY3lTdGF0c1JlcG9ydFN1cHBvcnRlZCwgU2RwT3B0aW9ucywgdHJhbnNmb3JtU2RwLCB3cmFwTG9nZ2VyfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCB7U2Vzc2lvblJlcG9ydH0gZnJvbSAnLi9zZXNzaW9uX3JlcG9ydCc7XG5pbXBvcnQge1xuICAgIERFRkFVTFRfR1VNX1RJTUVPVVRfTVMsXG4gICAgREVGQVVMVF9JQ0VfVElNRU9VVF9NUyxcbiAgICBSVENfRVJST1JTLFxuICAgIFJUQ19QRUVSX0NPTk5FQ1RJT05fQ09ORklHLFxuICAgIFJUQ19QRUVSX0NPTk5FQ1RJT05fT1BUSU9OQUxfQ09ORklHLFxuICAgIElDRV9DT05ORUNUSU9OX1NUQVRFLFxuICAgIFBFRVJfQ09OTkVDVElPTl9TVEFURVxufSBmcm9tICcuL3J0Y19jb25zdCc7XG5pbXBvcnQge1xuICAgIEJ1c3lFeGNlcHRpb25OYW1lLFxuICAgIENhbGxOb3RGb3VuZEV4Y2VwdGlvbk5hbWUsXG4gICAgR3VtVGltZW91dCxcbiAgICBJbGxlZ2FsUGFyYW1ldGVycyxcbiAgICBJbGxlZ2FsU3RhdGUsXG4gICAgVW5zdXBwb3J0ZWRPcGVyYXRpb25cbn0gZnJvbSAnLi9leGNlcHRpb25zJztcbmltcG9ydCBSdGNTaWduYWxpbmcgZnJvbSAnLi9zaWduYWxpbmcnO1xuaW1wb3J0IHV1aWQgZnJvbSAndXVpZC92NCc7XG5pbXBvcnQge2V4dHJhY3RNZWRpYVN0YXRzRnJvbVN0YXRzfSBmcm9tICcuL3J0cC1zdGF0cyc7XG5pbXBvcnQge3BhcnNlQ2FuZGlkYXRlfSBmcm9tICdzZHAnO1xuaW1wb3J0IENDUEluaXRpYXRpb25TdHJhdGVneUludGVyZmFjZSBmcm9tIFwiLi9zdHJhdGVnaWVzL0NDUEluaXRpYXRpb25TdHJhdGVneUludGVyZmFjZVwiO1xuaW1wb3J0IFN0YW5kYXJkU3RyYXRlZ3kgZnJvbSBcIi4vc3RyYXRlZ2llcy9TdGFuZGFyZFN0cmF0ZWd5XCI7XG5cbmV4cG9ydCBjbGFzcyBSVENTZXNzaW9uU3RhdGUge1xuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIHtSdGNTZXNzaW9ufSBydGNTZXNzaW9uXG4gICAgICovXG4gICAgY29uc3RydWN0b3IocnRjU2Vzc2lvbikge1xuICAgICAgICB0aGlzLl9ydGNTZXNzaW9uID0gcnRjU2Vzc2lvbjtcbiAgICB9XG4gICAgb25FbnRlcigpIHtcbiAgICB9XG4gICAgb25FeGl0KCkge1xuICAgIH1cbiAgICBfaXNDdXJyZW50U3RhdGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9ydGNTZXNzaW9uLl9zdGF0ZSA9PT0gdGhpcztcbiAgICB9XG4gICAgdHJhbnNpdChuZXh0U3RhdGUpIHtcbiAgICAgICAgaWYgKHRoaXMuX2lzQ3VycmVudFN0YXRlKCkpIHtcbiAgICAgICAgICAgIHRoaXMuX3J0Y1Nlc3Npb24udHJhbnNpdChuZXh0U3RhdGUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBsb2dnZXIoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9ydGNTZXNzaW9uLl9sb2dnZXI7XG4gICAgfVxuICAgIGhhbmd1cCgpIHtcbiAgICAgICAgdGhpcy50cmFuc2l0KG5ldyBGYWlsZWRTdGF0ZSh0aGlzLl9ydGNTZXNzaW9uKSk7XG4gICAgfVxuICAgIG9uSWNlQ2FuZGlkYXRlKGV2dCkgey8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW51c2VkLXZhcnNcbiAgICAgICAgLy9pZ25vcmUgY2FuZGlkYXRlIGJ5IGRlZmF1bHQsIENvbm5lY3RTaWduYWxpbmdBbmRJY2VDb2xsZWN0aW9uU3RhdGUgd2lsbCBvdmVycmlkZSB0byBjb2xsZWN0IGNhbmRpZGF0ZXMsIGJ1dCBjb2xsZWN0aW5nIHByb2Nlc3MgY291bGQgbGFzdCBtdWNoIGxvbmdlciB0aGFuIENvbm5lY3RTaWduYWxpbmdBbmRJY2VDb2xsZWN0aW9uU3RhdGVcbiAgICAgICAgLy93ZSBkb24ndCB3YW50IHRvIHNwYW0gdGhlIGNvbnNvbGUgbG9nXG4gICAgfVxuICAgIG9uUmVtb3RlSHVuZ3VwKCkge1xuICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb24oJ29uUmVtb3RlSHVuZ3VwIG5vdCBpbXBsZW1lbnRlZCBieSAnICsgdGhpcy5uYW1lKTtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiBcIlJUQ1Nlc3Npb25TdGF0ZVwiO1xuICAgIH1cbiAgICBvblNpZ25hbGluZ0Nvbm5lY3RlZCgpIHtcbiAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uKCdvblNpZ25hbGluZ0Nvbm5lY3RlZCBub3QgaW1wbGVtZW50ZWQgYnkgJyArIHRoaXMubmFtZSk7XG4gICAgfVxuICAgIG9uU2lnbmFsaW5nSGFuZHNoYWtlZCgpIHtcbiAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uKCdvblNpZ25hbGluZ0hhbmRzaGFrZWQgbm90IGltcGxlbWVudGVkIGJ5ICcgKyB0aGlzLm5hbWUpO1xuICAgIH1cbiAgICBvblNpZ25hbGluZ0ZhaWxlZChlKSB7Ly8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bnVzZWQtdmFyc1xuICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb24oJ29uU2lnbmFsaW5nRmFpbGVkIG5vdCBpbXBsZW1lbnRlZCBieSAnICsgdGhpcy5uYW1lKTtcbiAgICB9XG4gICAgb25JY2VTdGF0ZUNoYW5nZShldnQpIHsvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXVudXNlZC12YXJzXG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIEdyYWJMb2NhbE1lZGlhU3RhdGUgZXh0ZW5kcyBSVENTZXNzaW9uU3RhdGUge1xuICAgIG9uRW50ZXIoKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgdmFyIHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgICAgIGlmIChzZWxmLl9ydGNTZXNzaW9uLl9pc1VzZXJQcm92aWRlZFN0cmVhbSkge1xuICAgICAgICAgICAgc2VsZi50cmFuc2l0KG5ldyBDcmVhdGVPZmZlclN0YXRlKHNlbGYuX3J0Y1Nlc3Npb24pKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBndW1UaW1lb3V0UHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBHdW1UaW1lb3V0KCdMb2NhbCBtZWRpYSBoYXMgbm90IGJlZW4gaW5pdGlhbGl6ZWQgeWV0LicpKTtcbiAgICAgICAgICAgICAgICB9LCBzZWxmLl9ydGNTZXNzaW9uLl9ndW1UaW1lb3V0TWlsbGlzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIHNlc3Npb25HdW1Qcm9taXNlID0gc2VsZi5fZ1VNKHNlbGYuX3J0Y1Nlc3Npb24uX2J1aWxkTWVkaWFDb25zdHJhaW50cygpKTtcblxuICAgICAgICAgICAgUHJvbWlzZS5yYWNlKFtzZXNzaW9uR3VtUHJvbWlzZSwgZ3VtVGltZW91dFByb21pc2VdKVxuICAgICAgICAgICAgICAgIC50aGVuKHN0cmVhbSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuX3J0Y1Nlc3Npb24uX3Nlc3Npb25SZXBvcnQuZ3VtVGltZU1pbGxpcyA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuX3J0Y1Nlc3Npb24uX29uR3VtU3VjY2VzcyhzZWxmLl9ydGNTZXNzaW9uKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5fcnRjU2Vzc2lvbi5fbG9jYWxTdHJlYW0gPSBzdHJlYW07XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuX3J0Y1Nlc3Npb24uX3Nlc3Npb25SZXBvcnQuZ3VtT3RoZXJGYWlsdXJlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuX3J0Y1Nlc3Npb24uX3Nlc3Npb25SZXBvcnQuZ3VtVGltZW91dEZhaWx1cmUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi50cmFuc2l0KG5ldyBDcmVhdGVPZmZlclN0YXRlKHNlbGYuX3J0Y1Nlc3Npb24pKTtcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5fcnRjU2Vzc2lvbi5fc2Vzc2lvblJlcG9ydC5ndW1UaW1lTWlsbGlzID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yUmVhc29uO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIEd1bVRpbWVvdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yUmVhc29uID0gUlRDX0VSUk9SUy5HVU1fVElNRU9VVF9GQUlMVVJFO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fcnRjU2Vzc2lvbi5fc2Vzc2lvblJlcG9ydC5ndW1UaW1lb3V0RmFpbHVyZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9ydGNTZXNzaW9uLl9zZXNzaW9uUmVwb3J0Lmd1bU90aGVyRmFpbHVyZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JSZWFzb24gPSBSVENfRVJST1JTLkdVTV9PVEhFUl9GQUlMVVJFO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fcnRjU2Vzc2lvbi5fc2Vzc2lvblJlcG9ydC5ndW1PdGhlckZhaWx1cmUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fcnRjU2Vzc2lvbi5fc2Vzc2lvblJlcG9ydC5ndW1UaW1lb3V0RmFpbHVyZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmVycm9yKCdMb2NhbCBtZWRpYSBpbml0aWFsaXphdGlvbiBmYWlsZWQnLCBlKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5fcnRjU2Vzc2lvbi5fb25HdW1FcnJvcihzZWxmLl9ydGNTZXNzaW9uKTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi50cmFuc2l0KG5ldyBGYWlsZWRTdGF0ZShzZWxmLl9ydGNTZXNzaW9uLCBlcnJvclJlYXNvbikpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gXCJHcmFiTG9jYWxNZWRpYVN0YXRlXCI7XG4gICAgfVxuICAgIF9nVU0oY29uc3RyYWludHMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3J0Y1Nlc3Npb24uX3N0cmF0ZWd5Ll9nVU0oY29uc3RyYWludHMpO1xuICAgIH1cbn1cbmV4cG9ydCBjbGFzcyBDcmVhdGVPZmZlclN0YXRlIGV4dGVuZHMgUlRDU2Vzc2lvblN0YXRlIHtcbiAgICBvbkVudGVyKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHZhciBzdHJlYW0gPSBzZWxmLl9ydGNTZXNzaW9uLl9sb2NhbFN0cmVhbTtcbiAgICAgICAgc2VsZi5fcnRjU2Vzc2lvbi5fc3RyYXRlZ3kuY3JlYXRlT2ZmZXJTdGF0ZU9uRW50ZXIoc2VsZi5fcnRjU2Vzc2lvbi5fcGMsIHN0cmVhbSk7XG4gICAgICAgIHNlbGYuX3J0Y1Nlc3Npb24uX29uTG9jYWxTdHJlYW1BZGRlZChzZWxmLl9ydGNTZXNzaW9uLCBzdHJlYW0pO1xuICAgICAgICBzZWxmLl9ydGNTZXNzaW9uLl9wYy5jcmVhdGVPZmZlcigpLnRoZW4ocnRjU2Vzc2lvbkRlc2NyaXB0aW9uID0+IHtcbiAgICAgICAgICAgIHNlbGYuX3J0Y1Nlc3Npb24uX2xvY2FsU2Vzc2lvbkRlc2NyaXB0aW9uID0gcnRjU2Vzc2lvbkRlc2NyaXB0aW9uO1xuICAgICAgICAgICAgc2VsZi5fcnRjU2Vzc2lvbi5fc2Vzc2lvblJlcG9ydC5jcmVhdGVPZmZlckZhaWx1cmUgPSBmYWxzZTtcbiAgICAgICAgICAgIHNlbGYudHJhbnNpdChuZXcgU2V0TG9jYWxTZXNzaW9uRGVzY3JpcHRpb25TdGF0ZShzZWxmLl9ydGNTZXNzaW9uKSk7XG4gICAgICAgIH0pLmNhdGNoKGUgPT4ge1xuICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoJ0NyZWF0ZU9mZmVyIGZhaWxlZCcsIGUpO1xuICAgICAgICAgICAgc2VsZi5fcnRjU2Vzc2lvbi5fc2Vzc2lvblJlcG9ydC5jcmVhdGVPZmZlckZhaWx1cmUgPSB0cnVlO1xuICAgICAgICAgICAgc2VsZi50cmFuc2l0KG5ldyBGYWlsZWRTdGF0ZShzZWxmLl9ydGNTZXNzaW9uLCBSVENfRVJST1JTLkNSRUFURV9PRkZFUl9GQUlMVVJFKSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuIFwiQ3JlYXRlT2ZmZXJTdGF0ZVwiO1xuICAgIH1cbn1cbmV4cG9ydCBjbGFzcyBTZXRMb2NhbFNlc3Npb25EZXNjcmlwdGlvblN0YXRlIGV4dGVuZHMgUlRDU2Vzc2lvblN0YXRlIHtcbiAgICBvbkVudGVyKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICAgLy8gZml4L21vZGlmeSBTRFAgYXMgbmVlZGVkIGhlcmUsIGJlZm9yZSBzZXRMb2NhbERlc2NyaXB0aW9uXG4gICAgICAgIHZhciBsb2NhbERlc2NyaXB0aW9uID0gc2VsZi5fcnRjU2Vzc2lvbi5fbG9jYWxTZXNzaW9uRGVzY3JpcHRpb247XG4gICAgICAgIHZhciBzZHBPcHRpb25zID0gbmV3IFNkcE9wdGlvbnMoKTtcbiAgICAgICAgLy8gU2V0IGF1ZGlvIGNvZGVjLlxuICAgICAgICBpZiAoc2VsZi5fcnRjU2Vzc2lvbi5fZm9yY2VBdWRpb0NvZGVjKSB7XG4gICAgICAgICAgICBzZHBPcHRpb25zLmZvcmNlQ29kZWNbJ2F1ZGlvJ10gPSBzZWxmLl9ydGNTZXNzaW9uLl9mb3JjZUF1ZGlvQ29kZWM7XG4gICAgICAgIH1cbiAgICAgICAgLy8gU2V0IHZpZGVvIGNvZGVjLlxuICAgICAgICBpZiAoc2VsZi5fcnRjU2Vzc2lvbi5fZm9yY2VWaWRlb0NvZGVjKSB7XG4gICAgICAgICAgICBzZHBPcHRpb25zLmZvcmNlQ29kZWNbJ3ZpZGVvJ10gPSBzZWxmLl9ydGNTZXNzaW9uLl9mb3JjZVZpZGVvQ29kZWM7XG4gICAgICAgIH1cbiAgICAgICAgc2RwT3B0aW9ucy5lbmFibGVPcHVzRHR4ID0gc2VsZi5fcnRjU2Vzc2lvbi5fZW5hYmxlT3B1c0R0eDtcblxuICAgICAgICB2YXIgdHJhbnNmb3JtZWRTZHAgPSB0cmFuc2Zvcm1TZHAobG9jYWxEZXNjcmlwdGlvbi5zZHAsIHNkcE9wdGlvbnMpO1xuICAgICAgICBsb2NhbERlc2NyaXB0aW9uLnNkcCA9IHRyYW5zZm9ybWVkU2RwLnNkcDtcbiAgICAgICAgbG9jYWxEZXNjcmlwdGlvbi5zZHAgKz0gJ2E9cHRpbWU6MjBcXHJcXG4nO1xuICAgICAgICBsb2NhbERlc2NyaXB0aW9uLnNkcCArPSAnYT1tYXhwdGltZToyMFxcclxcbic7XG4gICAgICAgIGxvY2FsRGVzY3JpcHRpb24uc2RwID0gbG9jYWxEZXNjcmlwdGlvbi5zZHAucmVwbGFjZShcIm1pbnB0aW1lPTEwXCIsIFwibWlucHRpbWU9MjBcIik7XG5cbiAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygnTG9jYWxTRCcsIHNlbGYuX3J0Y1Nlc3Npb24uX2xvY2FsU2Vzc2lvbkRlc2NyaXB0aW9uKTtcbiAgICAgICAgc2VsZi5fcnRjU2Vzc2lvbi5fcGMuc2V0TG9jYWxEZXNjcmlwdGlvbihzZWxmLl9ydGNTZXNzaW9uLl9sb2NhbFNlc3Npb25EZXNjcmlwdGlvbikudGhlbigoKSA9PiB7XG4gICAgICAgICAgICB2YXIgaW5pdGlhbGl6YXRpb25UaW1lID0gRGF0ZS5ub3coKSAtIHNlbGYuX3J0Y1Nlc3Npb24uX2Nvbm5lY3RUaW1lU3RhbXA7XG4gICAgICAgICAgICBzZWxmLl9ydGNTZXNzaW9uLl9zZXNzaW9uUmVwb3J0LmluaXRpYWxpemF0aW9uVGltZU1pbGxpcyA9IGluaXRpYWxpemF0aW9uVGltZTtcbiAgICAgICAgICAgIHNlbGYuX3J0Y1Nlc3Npb24uX29uU2Vzc2lvbkluaXRpYWxpemVkKHNlbGYuX3J0Y1Nlc3Npb24sIGluaXRpYWxpemF0aW9uVGltZSk7XG4gICAgICAgICAgICBzZWxmLl9ydGNTZXNzaW9uLl9zZXNzaW9uUmVwb3J0LnNldExvY2FsRGVzY3JpcHRpb25GYWlsdXJlID0gZmFsc2U7XG4gICAgICAgICAgICBzZWxmLnRyYW5zaXQobmV3IENvbm5lY3RTaWduYWxpbmdBbmRJY2VDb2xsZWN0aW9uU3RhdGUoc2VsZi5fcnRjU2Vzc2lvbiwgdHJhbnNmb3JtZWRTZHAubUxpbmVzKSk7XG4gICAgICAgIH0pLmNhdGNoKGUgPT4ge1xuICAgICAgICAgICAgc2VsZi5sb2dnZXIuZXJyb3IoJ1NldExvY2FsRGVzY3JpcHRpb24gZmFpbGVkJywgZSk7XG4gICAgICAgICAgICBzZWxmLl9ydGNTZXNzaW9uLl9zZXNzaW9uUmVwb3J0LnNldExvY2FsRGVzY3JpcHRpb25GYWlsdXJlID0gdHJ1ZTtcbiAgICAgICAgICAgIHNlbGYudHJhbnNpdChuZXcgRmFpbGVkU3RhdGUoc2VsZi5fcnRjU2Vzc2lvbiwgUlRDX0VSUk9SUy5TRVRfTE9DQUxfREVTQ1JJUFRJT05fRkFJTFVSRSkpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiBcIlNldExvY2FsU2Vzc2lvbkRlc2NyaXB0aW9uU3RhdGVcIjtcbiAgICB9XG59XG5cbi8qKlxuICogS2ljayBvZmYgc2lnbmFsaW5nIGNvbm5lY3Rpb24uIFdhaXQgdW50aWwgc2lnbmFsaW5nIGNvbm5lY3RzIGFuZCBJQ0UgY29sbGVjdGlvbiAod2hpY2ggYWxyZWFkeSBzdGFydGVkIGluIHByZXZpb3VzIHN0YXRlKSBjb21wbGV0ZXMuXG4gKiBJQ0UgY29sbGVjdGlvbiB0aW1lcyBvdXQgYWZ0ZXIgdXNlciBzcGVjaWZpZWQgYW1vdW50IG9mIHRpbWUgKGRlZmF1bHQgdG8gREVGQVVMVF9JQ0VfVElNRU9VVF9NUykgaW4gY2FzZSB1c2VyIGhhcyBjb21wbGV4IG5ldHdvcmsgZW52aXJvbm1lbnQgdGhhdCBibGFja2hvbGVzIFNUVU4vVFVSTiByZXF1ZXN0cy4gSW4gdGhpcyBjYXNlIGF0IGxlYXN0IG9uZSBjYW5kaWRhdGUgaXMgcmVxdWlyZWQgdG8gbW92ZSBmb3J3YXJkLlxuICogSUNFIGNvbGxlY3Rpb24gY291bGQgYWxzbyB3cmFwIHVwIGJlZm9yZSB0aW1lb3V0IGlmIGl0J3MgZGV0ZXJtaW5lZCB0aGF0IFJUUCBjYW5kaWRhdGVzIGZyb20gc2FtZSBUVVJOIHNlcnZlciBoYXZlIGJlZW4gY29sbGVjdGVkIGZvciBhbGwgbSBsaW5lcy5cbiAqL1xuZXhwb3J0IGNsYXNzIENvbm5lY3RTaWduYWxpbmdBbmRJY2VDb2xsZWN0aW9uU3RhdGUgZXh0ZW5kcyBSVENTZXNzaW9uU3RhdGUge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBDb25uZWN0U2lnbmFsaW5nQW5kSWNlQ29sbGVjdGlvblN0YXRlIG9iamVjdC5cbiAgICAgKiBAcGFyYW0ge1J0Y1Nlc3Npb259IHJ0Y1Nlc3Npb25cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gbUxpbmVzIE51bWJlciBvZiBtIGxpbmVzIGluIFNEUFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHJ0Y1Nlc3Npb24sIG1MaW5lcykge1xuICAgICAgICBzdXBlcihydGNTZXNzaW9uKTtcbiAgICAgICAgdGhpcy5faWNlQ2FuZGlkYXRlcyA9IFtdO1xuICAgICAgICB0aGlzLl9pY2VDYW5kaWRhdGVGb3VuZGF0aW9uc01hcCA9IHt9O1xuICAgICAgICB0aGlzLl9tTGluZXMgPSBtTGluZXM7XG4gICAgfVxuICAgIG9uRW50ZXIoKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgc2VsZi5fc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBpZiAoc2VsZi5faXNDdXJyZW50U3RhdGUoKSAmJiAhc2VsZi5faWNlQ29tcGxldGVkKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybignSUNFIGNvbGxlY3Rpb24gdGltZWQgb3V0Jyk7XG4gICAgICAgICAgICAgICAgc2VsZi5fcmVwb3J0SWNlQ29tcGxldGVkKHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBzZWxmLl9ydGNTZXNzaW9uLl9pY2VUaW1lb3V0TWlsbGlzKTtcbiAgICAgICAgc2VsZi5fcnRjU2Vzc2lvbi5fY3JlYXRlU2lnbmFsaW5nQ2hhbm5lbCgpLmNvbm5lY3QoKTtcbiAgICB9XG4gICAgb25TaWduYWxpbmdDb25uZWN0ZWQoKSB7XG4gICAgICAgIHRoaXMuX3J0Y1Nlc3Npb24uX3NpZ25hbGxpbmdDb25uZWN0VGltZXN0YW1wID0gRGF0ZS5ub3coKTtcbiAgICAgICAgdGhpcy5fcnRjU2Vzc2lvbi5fc2Vzc2lvblJlcG9ydC5zaWduYWxsaW5nQ29ubmVjdFRpbWVNaWxsaXMgPSB0aGlzLl9ydGNTZXNzaW9uLl9zaWduYWxsaW5nQ29ubmVjdFRpbWVzdGFtcCAtIHRoaXMuX3N0YXJ0VGltZTtcbiAgICAgICAgdGhpcy5fc2lnbmFsaW5nQ29ubmVjdGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fcnRjU2Vzc2lvbi5fb25TaWduYWxpbmdDb25uZWN0ZWQodGhpcy5fcnRjU2Vzc2lvbik7XG4gICAgICAgIHRoaXMuX3J0Y1Nlc3Npb24uX3Nlc3Npb25SZXBvcnQuc2lnbmFsbGluZ0Nvbm5lY3Rpb25GYWlsdXJlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX2NoZWNrQW5kVHJhbnNpdCgpO1xuICAgIH1cbiAgICBvblNpZ25hbGluZ0ZhaWxlZChlKSB7XG4gICAgICAgIHRoaXMuX3J0Y1Nlc3Npb24uX3Nlc3Npb25SZXBvcnQuc2lnbmFsbGluZ0Nvbm5lY3RUaW1lTWlsbGlzID0gRGF0ZS5ub3coKSAtIHRoaXMuX3N0YXJ0VGltZTtcbiAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoJ0ZhaWxlZCBjb25uZWN0aW5nIHRvIHNpZ25hbGluZyBzZXJ2ZXInLCBlKTtcbiAgICAgICAgdGhpcy5fcnRjU2Vzc2lvbi5fc2Vzc2lvblJlcG9ydC5zaWduYWxsaW5nQ29ubmVjdGlvbkZhaWx1cmUgPSB0cnVlO1xuICAgICAgICB0aGlzLnRyYW5zaXQobmV3IEZhaWxlZFN0YXRlKHRoaXMuX3J0Y1Nlc3Npb24sIFJUQ19FUlJPUlMuU0lHTkFMTElOR19DT05ORUNUSU9OX0ZBSUxVUkUpKTtcbiAgICB9XG4gICAgX2NyZWF0ZUxvY2FsQ2FuZGlkYXRlKGluaXREaWN0KSB7XG4gICAgICAgIHJldHVybiBuZXcgUlRDSWNlQ2FuZGlkYXRlKGluaXREaWN0KTtcbiAgICB9XG4gICAgb25JY2VDYW5kaWRhdGUoZXZ0KSB7XG4gICAgICAgIHZhciBjYW5kaWRhdGUgPSBldnQuY2FuZGlkYXRlO1xuICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ29uaWNlY2FuZGlkYXRlICcgKyBKU09OLnN0cmluZ2lmeShjYW5kaWRhdGUpKTtcbiAgICAgICAgaWYgKGNhbmRpZGF0ZSkge1xuICAgICAgICAgICAgaWYgKGNhbmRpZGF0ZS5jYW5kaWRhdGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9pY2VDYW5kaWRhdGVzLnB1c2godGhpcy5fY3JlYXRlTG9jYWxDYW5kaWRhdGUoY2FuZGlkYXRlKSk7XG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9pY2VDb21wbGV0ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2hlY2tDYW5kaWRhdGVzU3VmZmljaWVudChjYW5kaWRhdGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fcmVwb3J0SWNlQ29tcGxldGVkKGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBfY2hlY2tDYW5kaWRhdGVzU3VmZmljaWVudChjYW5kaWRhdGUpIHtcbiAgICAgICAgLy9jaGVjayBpZiB3ZSBjb2xsZWN0ZWQgc3VmZmljaWVudCBjYW5kaWRhdGVzIGZyb20gc2luZ2xlIG1lZGlhIHNlcnZlciB0byBzdGFydCB0aGUgY2FsbFxuICAgICAgICB2YXIgY2FuZGlkYXRlT2JqID0gcGFyc2VDYW5kaWRhdGUoY2FuZGlkYXRlLmNhbmRpZGF0ZSk7XG4gICAgICAgIGlmIChjYW5kaWRhdGVPYmouY29tcG9uZW50ICE9IDEpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgY2FuZGlkYXRlRm91bmRhdGlvbiA9IGNhbmRpZGF0ZU9iai5mb3VuZGF0aW9uO1xuICAgICAgICB2YXIgY2FuZGlkYXRlTUxpbmVJbmRleCA9IGNhbmRpZGF0ZS5zZHBNTGluZUluZGV4O1xuICAgICAgICBpZiAoY2FuZGlkYXRlRm91bmRhdGlvbiAmJiBjYW5kaWRhdGVNTGluZUluZGV4ID49IDAgJiYgY2FuZGlkYXRlTUxpbmVJbmRleCA8IHRoaXMuX21MaW5lcykge1xuICAgICAgICAgICAgdmFyIG1JbmRleExpc3QgPSB0aGlzLl9pY2VDYW5kaWRhdGVGb3VuZGF0aW9uc01hcFtjYW5kaWRhdGVGb3VuZGF0aW9uXSB8fCBbXTtcbiAgICAgICAgICAgIGlmICghbUluZGV4TGlzdC5pbmNsdWRlcyhjYW5kaWRhdGVNTGluZUluZGV4KSkge1xuICAgICAgICAgICAgICAgIG1JbmRleExpc3QucHVzaChjYW5kaWRhdGVNTGluZUluZGV4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2ljZUNhbmRpZGF0ZUZvdW5kYXRpb25zTWFwW2NhbmRpZGF0ZUZvdW5kYXRpb25dID0gbUluZGV4TGlzdDtcblxuICAgICAgICAgICAgaWYgKHRoaXMuX21MaW5lcyA9PSBtSW5kZXhMaXN0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3JlcG9ydEljZUNvbXBsZXRlZChmYWxzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgX3JlcG9ydEljZUNvbXBsZXRlZChpc1RpbWVvdXQpIHtcbiAgICAgICAgdGhpcy5fcnRjU2Vzc2lvbi5fc2Vzc2lvblJlcG9ydC5pY2VDb2xsZWN0aW9uVGltZU1pbGxpcyA9IERhdGUubm93KCkgLSB0aGlzLl9zdGFydFRpbWU7XG4gICAgICAgIHRoaXMuX2ljZUNvbXBsZXRlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuX3J0Y1Nlc3Npb24uX29uSWNlQ29sbGVjdGlvbkNvbXBsZXRlKHRoaXMuX3J0Y1Nlc3Npb24sIGlzVGltZW91dCwgdGhpcy5faWNlQ2FuZGlkYXRlcy5sZW5ndGgpO1xuICAgICAgICBpZiAodGhpcy5faWNlQ2FuZGlkYXRlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0aGlzLl9ydGNTZXNzaW9uLl9zZXNzaW9uUmVwb3J0LmljZUNvbGxlY3Rpb25GYWlsdXJlID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLl9jaGVja0FuZFRyYW5zaXQoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdObyBJQ0UgY2FuZGlkYXRlJyk7XG4gICAgICAgICAgICB0aGlzLl9ydGNTZXNzaW9uLl9zZXNzaW9uUmVwb3J0LmljZUNvbGxlY3Rpb25GYWlsdXJlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMudHJhbnNpdChuZXcgRmFpbGVkU3RhdGUodGhpcy5fcnRjU2Vzc2lvbiwgUlRDX0VSUk9SUy5JQ0VfQ09MTEVDVElPTl9USU1FT1VUKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgX2NoZWNrQW5kVHJhbnNpdCgpIHtcbiAgICAgICAgaWYgKHRoaXMuX2ljZUNvbXBsZXRlZCAmJiB0aGlzLl9zaWduYWxpbmdDb25uZWN0ZWQpIHtcbiAgICAgICAgICAgIHRoaXMudHJhbnNpdChuZXcgSW52aXRlQW5zd2VyU3RhdGUodGhpcy5fcnRjU2Vzc2lvbiwgdGhpcy5faWNlQ2FuZGlkYXRlcykpO1xuICAgICAgICB9IGVsc2UgaWYgKCF0aGlzLl9pY2VDb21wbGV0ZWQpIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZygnUGVuZGluZyBJQ0UgY29sbGVjdGlvbicpO1xuICAgICAgICB9IGVsc2Ugey8vaW1wbGllcyBfc2lnbmFsaW5nQ29ubmVjdGVkID09IGZhbHNlXG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5sb2coJ1BlbmRpbmcgc2lnbmFsaW5nIGNvbm5lY3Rpb24nKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuIFwiQ29ubmVjdFNpZ25hbGluZ0FuZEljZUNvbGxlY3Rpb25TdGF0ZVwiO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIEludml0ZUFuc3dlclN0YXRlIGV4dGVuZHMgUlRDU2Vzc2lvblN0YXRlIHtcbiAgICBjb25zdHJ1Y3RvcihydGNTZXNzaW9uLCBpY2VDYW5kaWRhdGVzKSB7XG4gICAgICAgIHN1cGVyKHJ0Y1Nlc3Npb24pO1xuICAgICAgICB0aGlzLl9pY2VDYW5kaWRhdGVzID0gaWNlQ2FuZGlkYXRlcztcbiAgICB9XG4gICAgb25FbnRlcigpIHtcbiAgICAgICAgdmFyIHJ0Y1Nlc3Npb24gPSB0aGlzLl9ydGNTZXNzaW9uO1xuICAgICAgICBydGNTZXNzaW9uLl9vblNpZ25hbGluZ1N0YXJ0ZWQocnRjU2Vzc2lvbik7XG4gICAgICAgIHJ0Y1Nlc3Npb24uX3NpZ25hbGluZ0NoYW5uZWwuaW52aXRlKHJ0Y1Nlc3Npb24uX2xvY2FsU2Vzc2lvbkRlc2NyaXB0aW9uLnNkcCxcbiAgICAgICAgICAgIHRoaXMuX2ljZUNhbmRpZGF0ZXMpO1xuICAgIH1cbiAgICBvblNpZ25hbGluZ0Fuc3dlcmVkKHNkcCwgY2FuZGlkYXRlcykge1xuICAgICAgICB0aGlzLl9ydGNTZXNzaW9uLl9zZXNzaW9uUmVwb3J0LnVzZXJCdXN5RmFpbHVyZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9ydGNTZXNzaW9uLl9zZXNzaW9uUmVwb3J0LmhhbmRzaGFraW5nRmFpbHVyZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLnRyYW5zaXQobmV3IEFjY2VwdFN0YXRlKHRoaXMuX3J0Y1Nlc3Npb24sIHNkcCwgY2FuZGlkYXRlcykpO1xuICAgIH1cbiAgICBvblNpZ25hbGluZ0ZhaWxlZChlKSB7XG4gICAgICAgIHZhciByZWFzb247XG4gICAgICAgIGlmIChlLm5hbWUgPT0gQnVzeUV4Y2VwdGlvbk5hbWUpIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdVc2VyIEJ1c3ksIHBvc3NpYmx5IG11bHRpcGxlIENDUCB3aW5kb3dzIG9wZW4nLCBlKTtcbiAgICAgICAgICAgIHRoaXMuX3J0Y1Nlc3Npb24uX3Nlc3Npb25SZXBvcnQudXNlckJ1c3lGYWlsdXJlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuX3J0Y1Nlc3Npb24uX3Nlc3Npb25SZXBvcnQuaGFuZHNoYWtpbmdGYWlsdXJlID0gdHJ1ZTtcbiAgICAgICAgICAgIHJlYXNvbiA9IFJUQ19FUlJPUlMuVVNFUl9CVVNZO1xuICAgICAgICB9IGVsc2UgaWYgKGUubmFtZSA9PSBDYWxsTm90Rm91bmRFeGNlcHRpb25OYW1lKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ2dlci5lcnJvcignQ2FsbCBub3QgZm91bmQuIE9uZSBvZiB0aGUgcGFydGljaXBhbnQgcHJvYmFibHkgaHVuZ3VwLicsIGUpO1xuICAgICAgICAgICAgcmVhc29uID0gUlRDX0VSUk9SUy5DQUxMX05PVF9GT1VORDtcbiAgICAgICAgICAgIHRoaXMuX3J0Y1Nlc3Npb24uX3Nlc3Npb25SZXBvcnQuaGFuZHNoYWtpbmdGYWlsdXJlID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmVycm9yKCdGYWlsZWQgaGFuZHNoYWtpbmcgd2l0aCBzaWduYWxpbmcgc2VydmVyJywgZSk7XG4gICAgICAgICAgICB0aGlzLl9ydGNTZXNzaW9uLl9zZXNzaW9uUmVwb3J0LnVzZXJCdXN5RmFpbHVyZSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5fcnRjU2Vzc2lvbi5fc2Vzc2lvblJlcG9ydC5oYW5kc2hha2luZ0ZhaWx1cmUgPSB0cnVlO1xuICAgICAgICAgICAgcmVhc29uID0gUlRDX0VSUk9SUy5TSUdOQUxMSU5HX0hBTkRTSEFLRV9GQUlMVVJFO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudHJhbnNpdChuZXcgRmFpbGVkU3RhdGUodGhpcy5fcnRjU2Vzc2lvbiwgcmVhc29uKSk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gXCJJbnZpdGVBbnN3ZXJTdGF0ZVwiO1xuICAgIH1cbn1cbmV4cG9ydCBjbGFzcyBBY2NlcHRTdGF0ZSBleHRlbmRzIFJUQ1Nlc3Npb25TdGF0ZSB7XG4gICAgY29uc3RydWN0b3IocnRjU2Vzc2lvbiwgc2RwLCBjYW5kaWRhdGVzKSB7XG4gICAgICAgIHN1cGVyKHJ0Y1Nlc3Npb24pO1xuICAgICAgICB0aGlzLl9zZHAgPSBzZHA7XG4gICAgICAgIHRoaXMuX2NhbmRpZGF0ZXMgPSBjYW5kaWRhdGVzO1xuICAgIH1cbiAgICBfY3JlYXRlU2Vzc2lvbkRlc2NyaXB0aW9uKGluaXREaWN0KSB7XG4gICAgICAgIHJldHVybiBuZXcgUlRDU2Vzc2lvbkRlc2NyaXB0aW9uKGluaXREaWN0KTtcbiAgICB9XG4gICAgX2NyZWF0ZVJlbW90ZUNhbmRpZGF0ZShpbml0RGljdCkge1xuICAgICAgICByZXR1cm4gbmV3IFJUQ0ljZUNhbmRpZGF0ZShpbml0RGljdCk7XG4gICAgfVxuICAgIG9uRW50ZXIoKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgdmFyIHJ0Y1Nlc3Npb24gPSBzZWxmLl9ydGNTZXNzaW9uO1xuXG4gICAgICAgIGlmICghc2VsZi5fc2RwKSB7XG4gICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcignSW52YWxpZCByZW1vdGUgU0RQJyk7XG4gICAgICAgICAgICBydGNTZXNzaW9uLl9zdG9wU2Vzc2lvbigpO1xuICAgICAgICAgICAgcnRjU2Vzc2lvbi5fc2Vzc2lvblJlcG9ydC5pbnZhbGlkUmVtb3RlU0RQRmFpbHVyZSA9IHRydWU7XG4gICAgICAgICAgICBzZWxmLnRyYW5zaXQobmV3IEZhaWxlZFN0YXRlKHJ0Y1Nlc3Npb24sIFJUQ19FUlJPUlMuSU5WQUxJRF9SRU1PVEVfU0RQKSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gZWxzZSBpZiAoIXNlbGYuX2NhbmRpZGF0ZXMgfHwgc2VsZi5fY2FuZGlkYXRlcy5sZW5ndGggPCAxKSB7XG4gICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcignTm8gcmVtb3RlIElDRSBjYW5kaWRhdGUnKTtcbiAgICAgICAgICAgIHJ0Y1Nlc3Npb24uX3N0b3BTZXNzaW9uKCk7XG4gICAgICAgICAgICBydGNTZXNzaW9uLl9zZXNzaW9uUmVwb3J0Lm5vUmVtb3RlSWNlQ2FuZGlkYXRlRmFpbHVyZSA9IHRydWU7XG4gICAgICAgICAgICBzZWxmLnRyYW5zaXQobmV3IEZhaWxlZFN0YXRlKHJ0Y1Nlc3Npb24sIFJUQ19FUlJPUlMuTk9fUkVNT1RFX0lDRV9DQU5ESURBVEUpKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJ0Y1Nlc3Npb24uX3Nlc3Npb25SZXBvcnQuaW52YWxpZFJlbW90ZVNEUEZhaWx1cmUgPSBmYWxzZTtcbiAgICAgICAgcnRjU2Vzc2lvbi5fc2Vzc2lvblJlcG9ydC5ub1JlbW90ZUljZUNhbmRpZGF0ZUZhaWx1cmUgPSBmYWxzZTtcbiAgICAgICAgc2VsZi5fcnRjU2Vzc2lvbi5fc3RyYXRlZ3kuYWNjZXB0U3RhdGVPbkVudGVyKHNlbGYsIHJ0Y1Nlc3Npb24pO1xuICAgIH1cbiAgICBvblNpZ25hbGluZ0hhbmRzaGFrZWQoKSB7XG4gICAgICAgIHRoaXMuX3J0Y1Nlc3Npb24uX3Nlc3Npb25SZXBvcnQuaGFuZHNoYWtpbmdUaW1lTWlsbGlzID0gRGF0ZS5ub3coKSAtIHRoaXMuX3J0Y1Nlc3Npb24uX3NpZ25hbGxpbmdDb25uZWN0VGltZXN0YW1wO1xuICAgICAgICB0aGlzLl9zaWduYWxpbmdIYW5kc2hha2VkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fY2hlY2tBbmRUcmFuc2l0KCk7XG4gICAgfVxuICAgIF9jaGVja0FuZFRyYW5zaXQoKSB7XG4gICAgICAgIGlmICh0aGlzLl9zaWduYWxpbmdIYW5kc2hha2VkICYmIHRoaXMuX3JlbW90ZURlc2NyaXB0aW9uU2V0KSB7XG4gICAgICAgICAgICB0aGlzLnRyYW5zaXQobmV3IFRhbGtpbmdTdGF0ZSh0aGlzLl9ydGNTZXNzaW9uKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoIXRoaXMuX3NpZ25hbGluZ0hhbmRzaGFrZWQpIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZygnUGVuZGluZyBoYW5kc2hha2luZycpO1xuICAgICAgICB9IGVsc2Ugey8vaW1wbGllcyBfcmVtb3RlRGVzY3JpcHRpb25TZXQgPT0gZmFsc2VcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmxvZygnUGVuZGluZyBzZXR0aW5nIHJlbW90ZSBkZXNjcmlwdGlvbicpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gXCJBY2NlcHRTdGF0ZVwiO1xuICAgIH1cbn1cbmV4cG9ydCBjbGFzcyBUYWxraW5nU3RhdGUgZXh0ZW5kcyBSVENTZXNzaW9uU3RhdGUge1xuXG4gICAgb25FbnRlcigpIHtcbiAgICAgICAgdGhpcy5fc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgdGhpcy5fcnRjU2Vzc2lvbi5fc2Vzc2lvblJlcG9ydC5wcmVUYWxraW5nVGltZU1pbGxpcyA9IHRoaXMuX3N0YXJ0VGltZSAtIHRoaXMuX3J0Y1Nlc3Npb24uX2Nvbm5lY3RUaW1lU3RhbXA7XG4gICAgICAgIHRoaXMuX3J0Y1Nlc3Npb24uX29uU2Vzc2lvbkNvbm5lY3RlZCh0aGlzLl9ydGNTZXNzaW9uKTtcbiAgICB9XG4gICAgb25TaWduYWxpbmdSZWNvbm5lY3RlZCgpIHtcbiAgICB9XG4gICAgb25SZW1vdGVIdW5ndXAoKSB7XG4gICAgICAgIHRoaXMuX3J0Y1Nlc3Npb24uX3NpZ25hbGluZ0NoYW5uZWwuaGFuZ3VwKCk7XG4gICAgICAgIHRoaXMudHJhbnNpdChuZXcgRGlzY29ubmVjdGVkU3RhdGUodGhpcy5fcnRjU2Vzc2lvbikpO1xuICAgIH1cbiAgICBoYW5ndXAoKSB7XG4gICAgICAgIHRoaXMuX3J0Y1Nlc3Npb24uX3NpZ25hbGluZ0NoYW5uZWwuaGFuZ3VwKCk7XG4gICAgICAgIHRoaXMudHJhbnNpdChuZXcgRGlzY29ubmVjdGVkU3RhdGUodGhpcy5fcnRjU2Vzc2lvbikpO1xuICAgIH1cbiAgICBvbkljZVN0YXRlQ2hhbmdlKGV2dCkge1xuICAgICAgICB2YXIgaWNlU3RhdGUgPSB0aGlzLl9ydGNTZXNzaW9uLl9zdHJhdGVneS5vbkljZVN0YXRlQ2hhbmdlKGV2dCwgdGhpcy5fcnRjU2Vzc2lvbi5fcGMpO1xuICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKCdJQ0UgQ29ubmVjdGlvbiBTdGF0ZTogJywgaWNlU3RhdGUpO1xuXG4gICAgICAgIGlmIChpY2VTdGF0ZSA9PSBJQ0VfQ09OTkVDVElPTl9TVEFURS5ESVNDT05ORUNURUQpIHtcbiAgICAgICAgICAgIHRoaXMubG9nZ2VyLmluZm8oJ0xvc3QgSUNFIGNvbm5lY3Rpb24nKTtcbiAgICAgICAgICAgIHRoaXMuX3J0Y1Nlc3Npb24uX3Nlc3Npb25SZXBvcnQuaWNlQ29ubmVjdGlvbnNMb3N0ICs9IDE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGljZVN0YXRlID09IElDRV9DT05ORUNUSU9OX1NUQVRFLkZBSUxFRCkge1xuICAgICAgICAgICAgdGhpcy5fcnRjU2Vzc2lvbi5fc2Vzc2lvblJlcG9ydC5pY2VDb25uZWN0aW9uc0ZhaWxlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvblBlZXJDb25uZWN0aW9uU3RhdGVDaGFuZ2UoKSB7XG4gICAgICAgIHZhciBwZWVyQ29ubmVjdGlvblN0YXRlID0gdGhpcy5fcnRjU2Vzc2lvbi5fc3RyYXRlZ3kub25QZWVyQ29ubmVjdGlvblN0YXRlQ2hhbmdlKHRoaXMuX3J0Y1Nlc3Npb24uX3BjKTtcbiAgICAgICAgdGhpcy5sb2dnZXIuaW5mbygnUGVlciBDb25uZWN0aW9uIFN0YXRlOiAnLCBwZWVyQ29ubmVjdGlvblN0YXRlKTtcblxuICAgICAgICBpZiAocGVlckNvbm5lY3Rpb25TdGF0ZSA9PSBQRUVSX0NPTk5FQ1RJT05fU1RBVEUuRkFJTEVEKSB7XG4gICAgICAgICAgICB0aGlzLl9ydGNTZXNzaW9uLl9zZXNzaW9uUmVwb3J0LnBlZXJDb25uZWN0aW9uRmFpbGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIG9uRXhpdCgpIHtcbiAgICAgICAgdGhpcy5fcnRjU2Vzc2lvbi5fc2Vzc2lvblJlcG9ydC50YWxraW5nVGltZU1pbGxpcyA9IERhdGUubm93KCkgLSB0aGlzLl9zdGFydFRpbWU7XG4gICAgICAgIHRoaXMuX3J0Y1Nlc3Npb24uX2RldGFjaE1lZGlhKCk7XG4gICAgICAgIHRoaXMuX3J0Y1Nlc3Npb24uX3Nlc3Npb25SZXBvcnQuc2Vzc2lvbkVuZFRpbWUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICB0aGlzLl9ydGNTZXNzaW9uLl9vblNlc3Npb25Db21wbGV0ZWQodGhpcy5fcnRjU2Vzc2lvbik7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gXCJUYWxraW5nU3RhdGVcIjtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgQ2xlYW5VcFN0YXRlIGV4dGVuZHMgUlRDU2Vzc2lvblN0YXRlIHtcbiAgICBvbkVudGVyKCkge1xuICAgICAgICB0aGlzLl9zdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICB0aGlzLl9ydGNTZXNzaW9uLl9zdG9wU2Vzc2lvbigpO1xuICAgICAgICB0aGlzLl9ydGNTZXNzaW9uLl9zZXNzaW9uUmVwb3J0LmNsZWFudXBUaW1lTWlsbGlzID0gRGF0ZS5ub3coKSAtIHRoaXMuX3N0YXJ0VGltZTtcbiAgICAgICAgdGhpcy5fcnRjU2Vzc2lvbi5fb25TZXNzaW9uRGVzdHJveWVkKHRoaXMuX3J0Y1Nlc3Npb24sIHRoaXMuX3J0Y1Nlc3Npb24uX3Nlc3Npb25SZXBvcnQpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuIFwiQ2xlYW5VcFN0YXRlXCI7XG4gICAgfVxuICAgIGhhbmd1cCgpIHtcbiAgICAgICAgLy9kbyBub3RoaW5nLCBhbHJlYWR5IGF0IHRoZSBlbmQgb2YgbGlmZWN5Y2xlXG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIERpc2Nvbm5lY3RlZFN0YXRlIGV4dGVuZHMgQ2xlYW5VcFN0YXRlIHtcbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuIFwiRGlzY29ubmVjdGVkU3RhdGVcIjtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgRmFpbGVkU3RhdGUgZXh0ZW5kcyBDbGVhblVwU3RhdGUge1xuICAgIGNvbnN0cnVjdG9yKHJ0Y1Nlc3Npb24sIGZhaWx1cmVSZWFzb24pIHtcbiAgICAgICAgc3VwZXIocnRjU2Vzc2lvbik7XG4gICAgICAgIHRoaXMuX2ZhaWx1cmVSZWFzb24gPSBmYWlsdXJlUmVhc29uO1xuICAgIH1cbiAgICBvbkVudGVyKCkge1xuICAgICAgICB0aGlzLl9ydGNTZXNzaW9uLl9zZXNzaW9uUmVwb3J0LnNlc3Npb25FbmRUaW1lID0gbmV3IERhdGUoKTtcbiAgICAgICAgdGhpcy5fcnRjU2Vzc2lvbi5fb25TZXNzaW9uRmFpbGVkKHRoaXMuX3J0Y1Nlc3Npb24sIHRoaXMuX2ZhaWx1cmVSZWFzb24pO1xuICAgICAgICBzdXBlci5vbkVudGVyKCk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gXCJGYWlsZWRTdGF0ZVwiO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUnRjU2Vzc2lvbiB7XG4gICAgLyoqXG4gICAgICogQnVpbGQgYW4gQW1hem9uQ29ubmVjdCBSVEMgc2Vzc2lvbi5cbiAgICAgKiBAcGFyYW0geyp9IHNpZ25hbGluZ1VyaVxuICAgICAqIEBwYXJhbSB7Kn0gaWNlU2VydmVycyBBcnJheSBvZiBpY2Ugc2VydmVyc1xuICAgICAqIEBwYXJhbSB7Kn0gY29udGFjdFRva2VuIEEgc3RyaW5nIHJlcHJlc2VudGluZyB0aGUgY29udGFjdCB0b2tlbiAob3B0aW9uYWwpXG4gICAgICogQHBhcmFtIHsqfSBsb2dnZXIgQW4gb2JqZWN0IHByb3ZpZGVzIGxvZ2dpbmcgZnVuY3Rpb25zLCBzdWNoIGFzIGNvbnNvbGVcbiAgICAgKiBAcGFyYW0geyp9IGNvbnRhY3RJZCBNdXN0IGJlIFVVSUQsIHVuaXF1ZWx5IGlkZW50aWZpZXMgdGhlIHNlc3Npb24uXG4gICAgICovXG4gICAgY29uc3RydWN0b3Ioc2lnbmFsaW5nVXJpLCBpY2VTZXJ2ZXJzLCBjb250YWN0VG9rZW4sIGxvZ2dlciwgY29udGFjdElkLCBjb25uZWN0aW9uSWQsIHdzc01hbmFnZXIsIHN0cmF0ZWd5ID0gbmV3IFN0YW5kYXJkU3RyYXRlZ3koKSkge1xuICAgICAgICBpZiAoIShzdHJhdGVneSBpbnN0YW5jZW9mIENDUEluaXRpYXRpb25TdHJhdGVneUludGVyZmFjZSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRXhwZWN0ZWQgYSBzdHJhdGVneSBvZiB0eXBlIENDUEluaXRpYXRpb25TdHJhdGVneUludGVyZmFjZScpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2Ygc2lnbmFsaW5nVXJpICE9PSAnc3RyaW5nJyB8fCBzaWduYWxpbmdVcmkudHJpbSgpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxQYXJhbWV0ZXJzKCdzaWduYWxpbmdVcmkgcmVxdWlyZWQnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWljZVNlcnZlcnMpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsUGFyYW1ldGVycygnaWNlU2VydmVycyByZXF1aXJlZCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgbG9nZ2VyICE9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxQYXJhbWV0ZXJzKCdsb2dnZXIgcmVxdWlyZWQnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWNvbnRhY3RJZCkge1xuICAgICAgICAgICAgdGhpcy5fY2FsbElkID0gdXVpZCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fY2FsbElkID0gY29udGFjdElkO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3N0cmF0ZWd5ID0gc3RyYXRlZ3k7XG4gICAgICAgIHRoaXMuX2Nvbm5lY3Rpb25JZCA9IGNvbm5lY3Rpb25JZDtcbiAgICAgICAgdGhpcy5fd3NzTWFuYWdlciA9IHdzc01hbmFnZXI7XG4gICAgICAgIHRoaXMuX3Nlc3Npb25SZXBvcnQgPSBuZXcgU2Vzc2lvblJlcG9ydCgpO1xuICAgICAgICB0aGlzLl9zaWduYWxpbmdVcmkgPSBzaWduYWxpbmdVcmk7XG4gICAgICAgIHRoaXMuX2ljZVNlcnZlcnMgPSBpY2VTZXJ2ZXJzO1xuICAgICAgICB0aGlzLl9jb250YWN0VG9rZW4gPSBjb250YWN0VG9rZW47XG4gICAgICAgIHRoaXMuX29yaWdpbmFsTG9nZ2VyID0gbG9nZ2VyO1xuICAgICAgICB0aGlzLl9sb2dnZXIgPSB3cmFwTG9nZ2VyKHRoaXMuX29yaWdpbmFsTG9nZ2VyLCB0aGlzLl9jYWxsSWQsICdTRVNTSU9OJyk7XG4gICAgICAgIHRoaXMuX2ljZVRpbWVvdXRNaWxsaXMgPSBERUZBVUxUX0lDRV9USU1FT1VUX01TO1xuICAgICAgICB0aGlzLl9ndW1UaW1lb3V0TWlsbGlzID0gREVGQVVMVF9HVU1fVElNRU9VVF9NUztcblxuICAgICAgICB0aGlzLl9lbmFibGVBdWRpbyA9IHRydWU7XG4gICAgICAgIHRoaXMuX2VuYWJsZVZpZGVvID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX2ZhY2luZ01vZGUgPSAndXNlcic7XG4gICAgICAgIHRoaXMuX2xlZ2FjeVN0YXRzUmVwb3J0U3VwcG9ydCA9IGZhbHNlO1xuICAgICAgICAvKipcbiAgICAgICAgICogdXNlciBtYXkgcHJvdmlkZSB0aGUgc3RyZWFtIHRvIHRoZSBSdGNTZXNzaW9uIGRpcmVjdGx5IHRvIGNvbm5lY3QgdG8gdGhlIG90aGVyIGVuZC5cbiAgICAgICAgICogdXNlciBtYXkgYWxzbyBhY3F1aXJlIHRoZSBzdHJlYW0gZnJvbSB0aGUgbG9jYWwgZGV2aWNlLlxuICAgICAgICAgKiBUaGlzIGZsYWcgaXMgdXNlZCB0byB0cmFjayB3aGVyZSB0aGUgc3RyZWFtIGlzIGFjcXVpcmVkLlxuICAgICAgICAgKiBJZiBpdCdzIGFjcXVpcmVkIGZyb20gbG9jYWwgZGV2aWNlcywgdGhlbiB3ZSBtdXN0IGNsb3NlIHRoZSBzdHJlYW0gd2hlbiB0aGUgc2Vzc2lvbiBlbmRzLlxuICAgICAgICAgKiBJZiBpdCdzIHByb3ZpZGVkIGJ5IHVzZXIgKHJhdGhlciB0aGFuIGxvY2FsIGNhbWVyYS9taWNyb3Bob25lKSwgdGhlbiB3ZSBzaG91bGQgbGVhdmUgaXQgb3BlbiB3aGVuIHRoZVxuICAgICAgICAgKiBzZXNzaW9uIGVuZHMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLl9pc1VzZXJQcm92aWRlZFN0cmVhbSA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMuX29uR3VtRXJyb3IgPVxuICAgICAgICB0aGlzLl9vbkd1bVN1Y2Nlc3MgPVxuICAgICAgICB0aGlzLl9vbkxvY2FsU3RyZWFtQWRkZWQgPVxuICAgICAgICB0aGlzLl9vblNlc3Npb25GYWlsZWQgPVxuICAgICAgICB0aGlzLl9vblNlc3Npb25Jbml0aWFsaXplZCA9XG4gICAgICAgIHRoaXMuX29uU2lnbmFsaW5nQ29ubmVjdGVkID1cbiAgICAgICAgdGhpcy5fb25JY2VDb2xsZWN0aW9uQ29tcGxldGUgPVxuICAgICAgICB0aGlzLl9vblNpZ25hbGluZ1N0YXJ0ZWQgPVxuICAgICAgICB0aGlzLl9vblNlc3Npb25Db25uZWN0ZWQgPVxuICAgICAgICB0aGlzLl9vblJlbW90ZVN0cmVhbUFkZGVkID1cbiAgICAgICAgdGhpcy5fb25TZXNzaW9uQ29tcGxldGVkID1cbiAgICAgICAgdGhpcy5fb25TZXNzaW9uRGVzdHJveWVkID0gKCkgPT4ge1xuICAgICAgICB9O1xuICAgIH1cbiAgICBnZXQgc2Vzc2lvblJlcG9ydCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Nlc3Npb25SZXBvcnQ7XG4gICAgfVxuICAgIGdldCBjYWxsSWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jYWxsSWQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIGdldE1lZGlhU3RyZWFtIHJldHVybnMgdGhlIGxvY2FsIHN0cmVhbSwgd2hpY2ggbWF5IGJlIGFjcXVpcmVkIGZyb20gbG9jYWwgZGV2aWNlIG9yIGZyb20gdXNlciBwcm92aWRlZCBzdHJlYW0uXG4gICAgICogUmF0aGVyIHRoYW4gZ2V0dGluZyBhIHN0cmVhbSBieSBjYWxsaW5nIGdldFVzZXJNZWRpYSAod2hpY2ggZ2V0cyBhIHN0cmVhbSBmcm9tIGxvY2FsIGRldmljZSBzdWNoIGFzIGNhbWVyYSksXG4gICAgICogdXNlciBjb3VsZCBhbHNvIHByb3ZpZGUgdGhlIHN0cmVhbSB0byB0aGUgUnRjU2Vzc2lvbiBkaXJlY3RseSB0byBjb25uZWN0IHRvIHRoZSBvdGhlciBlbmQuXG4gICAgICovXG4gICAgZ2V0IG1lZGlhU3RyZWFtKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbG9jYWxTdHJlYW07XG4gICAgfVxuICAgIGdldCByZW1vdGVWaWRlb1N0cmVhbSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3JlbW90ZVZpZGVvU3RyZWFtO1xuICAgIH1cbiAgICBwYXVzZUxvY2FsVmlkZW8oKSB7XG4gICAgICAgIGlmKHRoaXMuX2xvY2FsU3RyZWFtKSB7XG4gICAgICAgICAgICB2YXIgdmlkZW9UcmFjayA9IHRoaXMuX2xvY2FsU3RyZWFtLmdldFZpZGVvVHJhY2tzKClbMF07XG4gICAgICAgICAgICBpZih2aWRlb1RyYWNrKSB7XG4gICAgICAgICAgICAgICAgdmlkZW9UcmFjay5lbmFibGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVzdW1lTG9jYWxWaWRlbygpIHtcbiAgICAgICAgaWYodGhpcy5fbG9jYWxTdHJlYW0pIHtcbiAgICAgICAgICAgIHZhciB2aWRlb1RyYWNrID0gdGhpcy5fbG9jYWxTdHJlYW0uZ2V0VmlkZW9UcmFja3MoKVswXTtcbiAgICAgICAgICAgIGlmKHZpZGVvVHJhY2spIHtcbiAgICAgICAgICAgICAgICB2aWRlb1RyYWNrLmVuYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHBhdXNlUmVtb3RlVmlkZW8oKSB7XG4gICAgICAgIGlmICh0aGlzLl9yZW1vdGVWaWRlb1N0cmVhbSkge1xuICAgICAgICAgICAgdmFyIHZpZGVvVHJhY2sgPSB0aGlzLl9yZW1vdGVWaWRlb1N0cmVhbS5nZXRUcmFja3MoKVsxXTtcbiAgICAgICAgICAgIGlmKHZpZGVvVHJhY2spIHtcbiAgICAgICAgICAgICAgICB2aWRlb1RyYWNrLmVuYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXN1bWVSZW1vdGVWaWRlbygpIHtcbiAgICAgICAgaWYgKHRoaXMuX3JlbW90ZVZpZGVvU3RyZWFtKSB7XG4gICAgICAgICAgICB2YXIgdmlkZW9UcmFjayA9IHRoaXMuX3JlbW90ZVZpZGVvU3RyZWFtLmdldFRyYWNrcygpWzFdO1xuICAgICAgICAgICAgaWYodmlkZW9UcmFjaykge1xuICAgICAgICAgICAgICAgIHZpZGVvVHJhY2suZW5hYmxlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcGF1c2VMb2NhbEF1ZGlvKCkge1xuICAgICAgICBpZiAodGhpcy5fbG9jYWxTdHJlYW0pIHtcbiAgICAgICAgICAgIHZhciBhdWRpb1RyYWNrID0gdGhpcy5fbG9jYWxTdHJlYW0uZ2V0QXVkaW9UcmFja3MoKVswXTtcbiAgICAgICAgICAgIGlmKGF1ZGlvVHJhY2spIHtcbiAgICAgICAgICAgICAgICBhdWRpb1RyYWNrLmVuYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXN1bWVMb2NhbEF1ZGlvKCkge1xuICAgICAgICBpZiAodGhpcy5fbG9jYWxTdHJlYW0pIHtcbiAgICAgICAgICAgIHZhciBhdWRpb1RyYWNrID0gdGhpcy5fbG9jYWxTdHJlYW0uZ2V0QXVkaW9UcmFja3MoKVswXTtcbiAgICAgICAgICAgIGlmKGF1ZGlvVHJhY2spIHtcbiAgICAgICAgICAgICAgICBhdWRpb1RyYWNrLmVuYWJsZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHBhdXNlUmVtb3RlQXVkaW8oKSB7XG4gICAgICAgIGlmICh0aGlzLl9yZW1vdGVBdWRpb1N0cmVhbSkge1xuICAgICAgICAgICAgdmFyIGF1ZGlvVHJhY2sgPSB0aGlzLl9yZW1vdGVBdWRpb1N0cmVhbS5nZXRUcmFja3MoKVswXTtcbiAgICAgICAgICAgIGlmKGF1ZGlvVHJhY2spIHtcbiAgICAgICAgICAgICAgICBhdWRpb1RyYWNrLmVuYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXN1bWVSZW1vdGVBdWRpbygpIHtcbiAgICAgICAgaWYgKHRoaXMuX3JlbW90ZUF1ZGlvU3RyZWFtKSB7XG4gICAgICAgICAgICB2YXIgYXVkaW9UcmFjayA9IHRoaXMuX3JlbW90ZUF1ZGlvU3RyZWFtLmdldFRyYWNrcygpWzBdO1xuICAgICAgICAgICAgaWYoYXVkaW9UcmFjaykge1xuICAgICAgICAgICAgICAgIGF1ZGlvVHJhY2suZW5hYmxlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2FsbGJhY2sgd2hlbiBnVU0gc3VjY2VlZHMuXG4gICAgICogRmlyc3QgcGFyYW0gaXMgUnRjU2Vzc2lvbiBvYmplY3QuXG4gICAgICovXG4gICAgc2V0IG9uR3VtU3VjY2VzcyhoYW5kbGVyKSB7XG4gICAgICAgIHRoaXMuX29uR3VtU3VjY2VzcyA9IGhhbmRsZXI7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENhbGxiYWNrIHdoZW4gZ1VNIGZhaWxzLlxuICAgICAqIEZpcnN0IHBhcmFtIGlzIFJ0Y1Nlc3Npb24gb2JqZWN0LlxuICAgICAqIFNlY29uZCBwYXJhbSBpcyB0aGUgZXJyb3IuXG4gICAgICovXG4gICAgc2V0IG9uR3VtRXJyb3IoaGFuZGxlcikge1xuICAgICAgICB0aGlzLl9vbkd1bUVycm9yID0gaGFuZGxlcjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2FsbGJhY2sgaWYgZmFpbGVkIGluaXRpYWxpemluZyBsb2NhbCByZXNvdXJjZXNcbiAgICAgKiBGaXJzdCBwYXJhbSBpcyBSdGNTZXNzaW9uIG9iamVjdC5cbiAgICAgKi9cbiAgICBzZXQgb25TZXNzaW9uRmFpbGVkKGhhbmRsZXIpIHtcbiAgICAgICAgdGhpcy5fb25TZXNzaW9uRmFpbGVkID0gaGFuZGxlcjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2FsbGJhY2sgYWZ0ZXIgbG9jYWwgdXNlciBtZWRpYSBzdHJlYW0gaXMgYWRkZWQgdG8gdGhlIHNlc3Npb24uXG4gICAgICogRmlyc3QgcGFyYW0gaXMgUnRjU2Vzc2lvbiBvYmplY3QuXG4gICAgICogU2Vjb25kIHBhcmFtIGlzIG1lZGlhIHN0cmVhbVxuICAgICAqL1xuICAgIHNldCBvbkxvY2FsU3RyZWFtQWRkZWQoaGFuZGxlcikge1xuICAgICAgICB0aGlzLl9vbkxvY2FsU3RyZWFtQWRkZWQgPSBoYW5kbGVyO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDYWxsYmFjayB3aGVuIGFsbCBsb2NhbCByZXNvdXJjZXMgYXJlIHJlYWR5LiBFc3RhYmxpc2hpbmcgc2lnbmFsaW5nIGNoYW5lbCBhbmQgSUNFIGNvbGxlY3Rpb24gaGFwcGVucyBhdCB0aGUgc2FtZSB0aW1lIGFmdGVyIHRoaXMuXG4gICAgICogRmlyc3QgcGFyYW0gaXMgUnRjU2Vzc2lvbiBvYmplY3QuXG4gICAgICovXG4gICAgc2V0IG9uU2Vzc2lvbkluaXRpYWxpemVkKGhhbmRsZXIpIHtcbiAgICAgICAgdGhpcy5fb25TZXNzaW9uSW5pdGlhbGl6ZWQgPSBoYW5kbGVyO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDYWxsYmFjayB3aGVuIHNpZ25hbGluZyBjaGFubmVsIGlzIGVzdGFibGlzaGVkLlxuICAgICAqIFJUQyBzZXNzaW9uIHdpbGwgbW92ZSBmb3J3YXJkIG9ubHkgaWYgb25TaWduYWxpbmdDb25uZWN0ZWQgYW5kIG9uSWNlQ29sbGVjdGlvbkNvbXBsZXRlIGFyZSBib3RoIGNhbGxlZC5cbiAgICAgKlxuICAgICAqIEZpcnN0IHBhcmFtIGlzIFJ0Y1Nlc3Npb24gb2JqZWN0LlxuICAgICAqL1xuICAgIHNldCBvblNpZ25hbGluZ0Nvbm5lY3RlZChoYW5kbGVyKSB7XG4gICAgICAgIHRoaXMuX29uU2lnbmFsaW5nQ29ubmVjdGVkID0gaGFuZGxlcjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2FsbGJhY2sgd2hlbiBJQ0UgY29sbGVjdGlvbiBjb21wbGV0ZXMgZWl0aGVyIGJlY2F1c2UgdGhlcmUgaXMgbm8gbW9yZSBjYW5kaWRhdGUgb3IgY29sbGVjdGlvbiB0aW1lZCBvdXQuXG4gICAgICogUlRDIHNlc3Npb24gd2lsbCBtb3ZlIGZvcndhcmQgb25seSBpZiBvblNpZ25hbGluZ0Nvbm5lY3RlZCBhbmQgb25JY2VDb2xsZWN0aW9uQ29tcGxldGUgYXJlIGJvdGggY2FsbGVkLlxuICAgICAqXG4gICAgICogRmlyc3QgcGFyYW0gaXMgUnRjU2Vzc2lvbiBvYmplY3QuXG4gICAgICogU2Vjb25kIHBhcmFtIGlzIGJvb2xlYW4sIFRSVUUgLSBJQ0UgY29sbGVjdGlvbiB0aW1lZCBvdXQuXG4gICAgICogVGhpcmQgcGFyYW0gaXMgbnVtYmVyIG9mIGNhbmRpZGF0ZXMgY29sbGVjdGVkLlxuICAgICAqL1xuICAgIHNldCBvbkljZUNvbGxlY3Rpb25Db21wbGV0ZShoYW5kbGVyKSB7XG4gICAgICAgIHRoaXMuX29uSWNlQ29sbGVjdGlvbkNvbXBsZXRlID0gaGFuZGxlcjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2FsbGJhY2sgd2hlbiBzaWduYWxpbmcgY2hhbm5lbCBpcyBlc3RhYmxpc2hlZCBhbmQgSUNFIGNvbGxlY3Rpb24gY29tcGxldGVkIHdpdGggYXQgbGVhc3Qgb25lIGNhbmRpZGF0ZS5cbiAgICAgKiBGaXJzdCBwYXJhbSBpcyBSdGNTZXNzaW9uIG9iamVjdC5cbiAgICAgKi9cbiAgICBzZXQgb25TaWduYWxpbmdTdGFydGVkKGhhbmRsZXIpIHtcbiAgICAgICAgdGhpcy5fb25TaWduYWxpbmdTdGFydGVkID0gaGFuZGxlcjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2FsbGJhY2sgd2hlbiB0aGUgY2FsbCBpcyBlc3RhYmxpc2hlZCAoaGFuZHNoYWtlZCBhbmQgbWVkaWEgc3RyZWFtIHNob3VsZCBiZSBmbG93aW5nKVxuICAgICAqIEZpcnN0IHBhcmFtIGlzIFJ0Y1Nlc3Npb24gb2JqZWN0LlxuICAgICAqL1xuICAgIHNldCBvblNlc3Npb25Db25uZWN0ZWQoaGFuZGxlcikge1xuICAgICAgICB0aGlzLl9vblNlc3Npb25Db25uZWN0ZWQgPSBoYW5kbGVyO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDYWxsYmFjayBhZnRlciByZW1vdGUgbWVkaWEgc3RyZWFtIGlzIGFkZGVkIHRvIHRoZSBzZXNzaW9uLlxuICAgICAqIFRoaXMgY291bGQgYmUgY2FsbGVkIG11bHRpcGxlIHRpbWVzIHdpdGggdGhlIHNhbWUgc3RyZWFtIGlmIG11bHRpcGxlIHRyYWNrcyBhcmUgaW5jbHVkZWQgaW4gdGhlIHNhbWUgc3RyZWFtLlxuICAgICAqXG4gICAgICogRmlyc3QgcGFyYW0gaXMgUnRjU2Vzc2lvbiBvYmplY3QuXG4gICAgICogU2Vjb25kIHBhcmFtIGlzIG1lZGlhIHN0cmVhbSB0cmFjay5cbiAgICAgKi9cbiAgICBzZXQgb25SZW1vdGVTdHJlYW1BZGRlZChoYW5kbGVyKSB7XG4gICAgICAgIHRoaXMuX29uUmVtb3RlU3RyZWFtQWRkZWQgPSBoYW5kbGVyO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDYWxsYmFjayB3aGVuIHRoZSBoYW5ndXAgaXMgaW5pdGlhdGVkIChpbXBsaWVzIHRoZSBjYWxsIHdhcyBzdWNjZXNzZnVsbHkgZXN0YWJsaXNoZWQpLlxuICAgICAqIEZpcnN0IHBhcmFtIGlzIFJ0Y1Nlc3Npb24gb2JqZWN0LlxuICAgICAqL1xuICAgIHNldCBvblNlc3Npb25Db21wbGV0ZWQoaGFuZGxlcikge1xuICAgICAgICB0aGlzLl9vblNlc3Npb25Db21wbGV0ZWQgPSBoYW5kbGVyO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDYWxsYmFjayBhZnRlciBzZXNzaW9uIGlzIGNsZWFuZWQgdXAsIG5vIG1hdHRlciBpZiB0aGUgY2FsbCB3YXMgc3VjY2Vzc2Z1bGx5IGVzdGFibGlzaGVkIG9yIG5vdC5cbiAgICAgKiBGaXJzdCBwYXJhbSBpcyBSdGNTZXNzaW9uIG9iamVjdC5cbiAgICAgKiBTZWNvbmQgcGFyYW0gaXMgU2Vzc2lvblJlcG9ydCBvYmplY3QuXG4gICAgICovXG4gICAgc2V0IG9uU2Vzc2lvbkRlc3Ryb3llZChoYW5kbGVyKSB7XG4gICAgICAgIHRoaXMuX29uU2Vzc2lvbkRlc3Ryb3llZCA9IGhhbmRsZXI7XG4gICAgfVxuICAgIHNldCBlbmFibGVBdWRpbyhmbGFnKSB7XG4gICAgICAgIHRoaXMuX2VuYWJsZUF1ZGlvID0gZmxhZztcbiAgICB9XG4gICAgc2V0IGVjaG9DYW5jZWxsYXRpb24oZmxhZykge1xuICAgICAgICB0aGlzLl9lY2hvQ2FuY2VsbGF0aW9uID0gZmxhZztcbiAgICB9XG4gICAgc2V0IGVuYWJsZVZpZGVvKGZsYWcpIHtcbiAgICAgICAgdGhpcy5fZW5hYmxlVmlkZW8gPSBmbGFnO1xuICAgIH1cbiAgICBzZXQgbWF4VmlkZW9GcmFtZVJhdGUoZnJhbWVSYXRlKSB7XG4gICAgICAgIHRoaXMuX21heFZpZGVvRnJhbWVSYXRlID0gZnJhbWVSYXRlO1xuICAgIH1cbiAgICBzZXQgbWluVmlkZW9GcmFtZVJhdGUoZnJhbWVSYXRlKSB7XG4gICAgICAgIHRoaXMuX21pblZpZGVvRnJhbWVSYXRlID0gZnJhbWVSYXRlO1xuICAgIH1cbiAgICBzZXQgdmlkZW9GcmFtZVJhdGUoZnJhbWVSYXRlKSB7XG4gICAgICAgIHRoaXMuX3ZpZGVvRnJhbWVSYXRlID0gZnJhbWVSYXRlO1xuICAgIH1cbiAgICBzZXQgbWF4VmlkZW9XaWR0aCh3aWR0aCkge1xuICAgICAgICB0aGlzLl9tYXhWaWRlb1dpZHRoID0gd2lkdGg7XG4gICAgfVxuICAgIHNldCBtaW5WaWRlb1dpZHRoKHdpZHRoKSB7XG4gICAgICAgIHRoaXMuX21pblZpZGVvV2lkdGggPSB3aWR0aDtcbiAgICB9XG4gICAgc2V0IGlkZWFsVmlkZW9XaWR0aCh3aWR0aCkge1xuICAgICAgICB0aGlzLl9pZGVhbFZpZGVvV2lkdGggPSB3aWR0aDtcbiAgICB9XG4gICAgc2V0IG1heFZpZGVvSGVpZ2h0KGhlaWdodCkge1xuICAgICAgICB0aGlzLl9tYXhWaWRlb0hlaWdodCA9IGhlaWdodDtcbiAgICB9XG4gICAgc2V0IG1pblZpZGVvSGVpZ2h0KGhlaWdodCkge1xuICAgICAgICB0aGlzLl9taW5WaWRlb0hlaWdodCA9IGhlaWdodDtcbiAgICB9XG4gICAgc2V0IGlkZWFsVmlkZW9IZWlnaHQoaGVpZ2h0KSB7XG4gICAgICAgIHRoaXMuX2lkZWFsVmlkZW9IZWlnaHQgPSBoZWlnaHQ7XG4gICAgfVxuICAgIHNldCBmYWNpbmdNb2RlKG1vZGUpIHtcbiAgICAgICAgdGhpcy5fZmFjaW5nTW9kZSA9IG1vZGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE9wdGlvbmFsLiBSdGNTZXNzaW9uIHdpbGwgZ3JhYiBpbnB1dCBkZXZpY2UgaWYgdGhpcyBpcyBub3Qgc3BlY2lmaWVkLlxuICAgICAqIFBsZWFzZSBub3RlOiB0aGlzIFJ0Y1Nlc3Npb24gY2xhc3Mgb25seSBzdXBwb3J0IHNpbmdsZSBhdWRpbyB0cmFjayBhbmQvb3Igc2luZ2xlIHZpZGVvIHRyYWNrLlxuICAgICAqL1xuICAgIHNldCBtZWRpYVN0cmVhbShpbnB1dCkge1xuICAgICAgICB0aGlzLl9sb2NhbFN0cmVhbSA9IGlucHV0O1xuICAgICAgICB0aGlzLl9pc1VzZXJQcm92aWRlZFN0cmVhbSA9IHRydWU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE5lZWRlZCwgZXhwZWN0IGFuIGF1ZGlvIGVsZW1lbnQgdGhhdCBjYW4gYmUgdXNlZCB0byBwbGF5IHJlbW90ZSBhdWRpbyBzdHJlYW0uXG4gICAgICovXG4gICAgc2V0IHJlbW90ZUF1ZGlvRWxlbWVudChlbGVtZW50KSB7XG4gICAgICAgIHRoaXMuX3JlbW90ZUF1ZGlvRWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgfVxuICAgIHNldCByZW1vdGVWaWRlb0VsZW1lbnQoZWxlbWVudCkge1xuICAgICAgICB0aGlzLl9yZW1vdGVWaWRlb0VsZW1lbnQgPSBlbGVtZW50O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBPdmVycmlkZSB0aGUgZGVmYXVsdCBzaWduYWxpbmcgY29ubmVjdCB0aW1lIG91dC5cbiAgICAgKi9cbiAgICBzZXQgc2lnbmFsaW5nQ29ubmVjdFRpbWVvdXQobXMpIHtcbiAgICAgICAgdGhpcy5fc2lnbmFsaW5nQ29ubmVjdFRpbWVvdXQgPSBtcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogT3ZlcnJpZGUgdGhlIGRlZmF1bHQgSUNFIGNvbGxlY3Rpb24gdGltZSBsaW1pdC5cbiAgICAgKi9cbiAgICBzZXQgaWNlVGltZW91dE1pbGxpcyh0aW1lb3V0TWlsbGlzKSB7XG4gICAgICAgIHRoaXMuX2ljZVRpbWVvdXRNaWxsaXMgPSB0aW1lb3V0TWlsbGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBPdmVycmlkZSB0aGUgZGVmYXVsdCBHVU0gdGltZW91dCB0aW1lIGxpbWl0LlxuICAgICAqL1xuICAgIHNldCBndW1UaW1lb3V0TWlsbGlzKHRpbWVvdXRNaWxsaXMpIHtcbiAgICAgICAgdGhpcy5fZ3VtVGltZW91dE1pbGxpcyA9IHRpbWVvdXRNaWxsaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIGNvbm5lY3QtcnRjLWpzIGluaXRpYXRlIHRoZSBoYW5kc2hha2luZyB3aXRoIGFsbCBicm93c2VyIHN1cHBvcnRlZCBjb2RlYyBieSBkZWZhdWx0LCBBbWF6b24gQ29ubmVjdCBzZXJ2aWNlIHdpbGwgY2hvb3NlIHRoZSBjb2RlYyBhY2NvcmRpbmcgdG8gaXRzIHByZWZlcmVuY2Ugc2V0dGluZy5cbiAgICAgKiBTZXR0aW5nIHRoaXMgYXR0cmlidXRlIHdpbGwgZm9yY2UgY29ubmVjdC1ydGMtanMgdG8gb25seSB1c2Ugc3BlY2lmaWVkIGNvZGVjLlxuICAgICAqIFdBUk5JTkc6IFNldHRpbmcgdGhpcyB0byB1bnN1cHBvcnRlZCBjb2RlYyB3aWxsIGNhdXNlIHRoZSBmYWlsdXJlIG9mIGhhbmRzaGFraW5nLlxuICAgICAqIFN1cHBvcnRlZCBhdWRpbyBjb2RlY3M6IG9wdXMuXG4gICAgICovXG4gICAgc2V0IGZvcmNlQXVkaW9Db2RlYyhhdWRpb0NvZGVjKSB7XG4gICAgICAgIHRoaXMuX2ZvcmNlQXVkaW9Db2RlYyA9IGF1ZGlvQ29kZWM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogY29ubmVjdC1ydGMtanMgaW5pdGlhdGUgdGhlIGhhbmRzaGFraW5nIHdpdGggYWxsIGJyb3dzZXIgc3VwcG9ydGVkIGNvZGVjIGJ5IGRlZmF1bHQsIEFtYXpvbiBDb25uZWN0IHNlcnZpY2Ugd2lsbCBjaG9vc2UgdGhlIGNvZGVjIGFjY29yZGluZyB0byBpdHMgcHJlZmVyZW5jZSBzZXR0aW5nLlxuICAgICAqIFNldHRpbmcgdGhpcyBhdHRyaWJ1dGUgd2lsbCBmb3JjZSBjb25uZWN0LXJ0Yy1qcyB0byBvbmx5IHVzZSBzcGVjaWZpZWQgY29kZWMuXG4gICAgICogV0FSTklORzogU2V0dGluZyB0aGlzIHRvIHVuc3VwcG9ydGVkIGNvZGVjIHdpbGwgY2F1c2UgdGhlIGZhaWx1cmUgb2YgaGFuZHNoYWtpbmcuXG4gICAgICogU3VwcG9ydGVkIHZpZGVvIGNvZGVjczogVlA4LCBWUDksIEgyNjQuXG4gICAgICovXG4gICAgc2V0IGZvcmNlVmlkZW9Db2RlYyh2aWRlb0NvZGVjKSB7XG4gICAgICAgIHRoaXMuX2ZvcmNlVmlkZW9Db2RlYyA9IHZpZGVvQ29kZWM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogY29ubmVjdC1ydGMtanMgZGlzYWJsZXMgT1BVUyBEVFggYnkgZGVmYXVsdCBiZWNhdXNlIGl0IGhhcm1zIGF1ZGlvIHF1YWxpdHkuXG4gICAgICogQHBhcmFtIGZsYWcgYm9vbGVhblxuICAgICAqL1xuICAgIHNldCBlbmFibGVPcHVzRHR4KGZsYWcpIHtcbiAgICAgICAgdGhpcy5fZW5hYmxlT3B1c0R0eCA9IGZsYWc7XG4gICAgfVxuXG4gICAgdHJhbnNpdChuZXh0U3RhdGUpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMuX2xvZ2dlci5pbmZvKCh0aGlzLl9zdGF0ZSA/IHRoaXMuX3N0YXRlLm5hbWUgOiAnbnVsbCcpICsgJyA9PiAnICsgbmV4dFN0YXRlLm5hbWUpO1xuICAgICAgICAgICAgaWYgKHRoaXMuX3N0YXRlICYmIHRoaXMuX3N0YXRlLm9uRXhpdCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3N0YXRlLm9uRXhpdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgICAgdGhpcy5fc3RhdGUgPSBuZXh0U3RhdGU7XG4gICAgICAgICAgICBpZiAobmV4dFN0YXRlLm9uRW50ZXIpIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBuZXh0U3RhdGUub25FbnRlcigpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbG9nZ2VyLndhcm4obmV4dFN0YXRlLm5hbWUgKyAnI29uRW50ZXIgZmFpbGVkJywgZSk7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IGU7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW5zYWZlLWZpbmFsbHlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfY3JlYXRlU2lnbmFsaW5nQ2hhbm5lbCgpIHtcbiAgICAgICAgdmFyIHNpZ25hbGluZ0NoYW5uZWwgPSBuZXcgUnRjU2lnbmFsaW5nKHRoaXMuX2NhbGxJZCwgdGhpcy5fc2lnbmFsaW5nVXJpLCB0aGlzLl9jb250YWN0VG9rZW4sIHRoaXMuX29yaWdpbmFsTG9nZ2VyLCB0aGlzLl9zaWduYWxpbmdDb25uZWN0VGltZW91dCwgdGhpcy5fY29ubmVjdGlvbklkLCB0aGlzLl93c3NNYW5hZ2VyKTtcbiAgICAgICAgc2lnbmFsaW5nQ2hhbm5lbC5vbkNvbm5lY3RlZCA9IGhpdGNoKHRoaXMsIHRoaXMuX3NpZ25hbGluZ0Nvbm5lY3RlZCk7XG4gICAgICAgIHNpZ25hbGluZ0NoYW5uZWwub25BbnN3ZXJlZCA9IGhpdGNoKHRoaXMsIHRoaXMuX3NpZ25hbGluZ0Fuc3dlcmVkKTtcbiAgICAgICAgc2lnbmFsaW5nQ2hhbm5lbC5vbkhhbmRzaGFrZWQgPSBoaXRjaCh0aGlzLCB0aGlzLl9zaWduYWxpbmdIYW5kc2hha2VkKTtcbiAgICAgICAgc2lnbmFsaW5nQ2hhbm5lbC5vblJlbW90ZUh1bmd1cCA9IGhpdGNoKHRoaXMsIHRoaXMuX3NpZ25hbGluZ1JlbW90ZUh1bmd1cCk7XG4gICAgICAgIHNpZ25hbGluZ0NoYW5uZWwub25GYWlsZWQgPSBoaXRjaCh0aGlzLCB0aGlzLl9zaWduYWxpbmdGYWlsZWQpO1xuICAgICAgICBzaWduYWxpbmdDaGFubmVsLm9uRGlzY29ubmVjdGVkID0gaGl0Y2godGhpcywgdGhpcy5fc2lnbmFsaW5nRGlzY29ubmVjdGVkKTtcblxuICAgICAgICB0aGlzLl9zaWduYWxpbmdDaGFubmVsID0gc2lnbmFsaW5nQ2hhbm5lbDtcblxuICAgICAgICByZXR1cm4gc2lnbmFsaW5nQ2hhbm5lbDtcbiAgICB9XG5cbiAgICBfc2lnbmFsaW5nQ29ubmVjdGVkKCkge1xuICAgICAgICB0aGlzLl9zdGF0ZS5vblNpZ25hbGluZ0Nvbm5lY3RlZCgpO1xuICAgIH1cbiAgICBfc2lnbmFsaW5nQW5zd2VyZWQoc2RwLCBjYW5kaWRhdGVzKSB7XG4gICAgICAgIHRoaXMuX3N0YXRlLm9uU2lnbmFsaW5nQW5zd2VyZWQoc2RwLCBjYW5kaWRhdGVzKTtcbiAgICB9XG4gICAgX3NpZ25hbGluZ0hhbmRzaGFrZWQoKSB7XG4gICAgICAgIHRoaXMuX3N0YXRlLm9uU2lnbmFsaW5nSGFuZHNoYWtlZCgpO1xuICAgIH1cbiAgICBfc2lnbmFsaW5nUmVtb3RlSHVuZ3VwKCkge1xuICAgICAgICB0aGlzLl9zdGF0ZS5vblJlbW90ZUh1bmd1cCgpO1xuICAgIH1cbiAgICBfc2lnbmFsaW5nRmFpbGVkKGUpIHtcbiAgICAgICAgdGhpcy5fc3RhdGUub25TaWduYWxpbmdGYWlsZWQoZSk7XG4gICAgfVxuICAgIF9zaWduYWxpbmdEaXNjb25uZWN0ZWQoKSB7XG4gICAgfVxuICAgIF9jcmVhdGVQZWVyQ29ubmVjdGlvbihjb25maWd1cmF0aW9uLCBvcHRpb25hbENvbmZpZ3VyYXRpb24pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0cmF0ZWd5Ll9jcmVhdGVQZWVyQ29ubmVjdGlvbihjb25maWd1cmF0aW9uLCBvcHRpb25hbENvbmZpZ3VyYXRpb24pO1xuICAgIH1cbiAgICBjb25uZWN0KHBjKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgdmFyIG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIHNlbGYuX3Nlc3Npb25SZXBvcnQuc2Vzc2lvblN0YXJ0VGltZSA9IG5vdztcbiAgICAgICAgc2VsZi5fY29ubmVjdFRpbWVTdGFtcCA9IG5vdy5nZXRUaW1lKCk7XG4gICAgICAgIGlmIChwYyAmJiBwYy5zaWduYWxpbmdTdGF0ZSAhPSAnY2xvc2VkJykge1xuICAgICAgICAgICAgc2VsZi5fcGMgPSBwYztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChwYykge1xuICAgICAgICAgICAgICAgIHBjLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgcGMgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgUlRDX1BFRVJfQ09OTkVDVElPTl9DT05GSUcuaWNlU2VydmVycyA9IHNlbGYuX2ljZVNlcnZlcnM7XG4gICAgICAgICAgICBzZWxmLl9wYyA9IHNlbGYuX2NyZWF0ZVBlZXJDb25uZWN0aW9uKFJUQ19QRUVSX0NPTk5FQ1RJT05fQ09ORklHLCBSVENfUEVFUl9DT05ORUNUSU9OX09QVElPTkFMX0NPTkZJRyk7XG4gICAgICAgIH1cbiAgICAgICAgc2VsZi5fc3RyYXRlZ3kuY29ubmVjdChzZWxmKTtcbiAgICAgICAgc2VsZi5fcGMub25pY2VjYW5kaWRhdGUgPSBoaXRjaChzZWxmLCBzZWxmLl9vbkljZUNhbmRpZGF0ZSk7XG4gICAgICAgIHNlbGYuX3BjLm9uY29ubmVjdGlvbnN0YXRlY2hhbmdlID0gaGl0Y2goc2VsZiwgc2VsZi5fb25QZWVyQ29ubmVjdGlvblN0YXRlQ2hhbmdlKTtcbiAgICAgICAgc2VsZi5fcGMub25pY2Vjb25uZWN0aW9uc3RhdGVjaGFuZ2UgPSBoaXRjaChzZWxmLCBzZWxmLl9vbkljZVN0YXRlQ2hhbmdlKTtcblxuICAgICAgICBpc0xlZ2FjeVN0YXRzUmVwb3J0U3VwcG9ydGVkKHNlbGYuX3BjKS50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICBzZWxmLl9sZWdhY3lTdGF0c1JlcG9ydFN1cHBvcnQgPSByZXN1bHQ7XG4gICAgICAgICAgICBzZWxmLnRyYW5zaXQobmV3IEdyYWJMb2NhbE1lZGlhU3RhdGUoc2VsZikpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgYWNjZXB0KCkge1xuICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb24oJ2FjY2VwdCBkb2VzIG5vdCBnbyB0aHJvdWdoIHNpZ25hbGluZyBjaGFubmVsIGF0IHRoaXMgbW9tZW50Jyk7XG4gICAgfVxuICAgIGhhbmd1cCgpIHtcbiAgICAgICAgdGhpcy5fc3RhdGUuaGFuZ3VwKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGEgcHJvbWlzZSBjb250YWluaW5nIGFuIG9iamVjdCB3aXRoIHR3byBuYW1lZCBsaXN0cyBvZiBhdWRpbyBzdGF0cywgb25lIGZvciBlYWNoIGNoYW5uZWwgb24gZWFjaFxuICAgICAqIG1lZGlhIHR5cGUgb2YgJ3ZpZGVvJyBhbmQgJ2F1ZGlvJy5cbiAgICAgKiBAcmV0dXJuIFJlamVjdGVkIHByb21pc2UgaWYgZmFpbGVkIHRvIGdldCBNZWRpYVJ0cFN0YXRzLiBUaGUgcHJvbWlzZSBpcyBuZXZlciByZXNvbHZlZCB3aXRoIG51bGwgdmFsdWUuXG4gICAgICovXG4gICAgYXN5bmMgZ2V0U3RhdHMoKSB7XG4gICAgICAgIHZhciB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpO1xuXG4gICAgICAgIHZhciBpbXBsID0gYXN5bmMgKHN0cmVhbSwgc3RyZWFtVHlwZSkgPT4ge1xuICAgICAgICAgICAgdmFyIHRyYWNrcyA9IFtdO1xuXG4gICAgICAgICAgICBpZiAoIXN0cmVhbSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc3dpdGNoIChzdHJlYW1UeXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnYXVkaW9faW5wdXQnOlxuICAgICAgICAgICAgICAgIGNhc2UgJ2F1ZGlvX291dHB1dCc6XG4gICAgICAgICAgICAgICAgICAgIHRyYWNrcyA9IHN0cmVhbS5nZXRBdWRpb1RyYWNrcygpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICd2aWRlb19pbnB1dCc6XG4gICAgICAgICAgICAgICAgY2FzZSAndmlkZW9fb3V0cHV0JzpcbiAgICAgICAgICAgICAgICAgICAgdHJhY2tzID0gc3RyZWFtLmdldFZpZGVvVHJhY2tzKCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVW5zdXBwb3J0ZWQgc3RyZWFtIHR5cGUgd2hpbGUgdHJ5aW5nIHRvIGdldCBzdGF0czogJyArIHN0cmVhbVR5cGUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgUHJvbWlzZS5hbGwodHJhY2tzLm1hcChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgLy8gZ2V0IHN0YW5kYXJkaXplZCByZXBvcnRcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcGMuZ2V0U3RhdHMoKS50aGVuKGZ1bmN0aW9uIChyYXdTdGF0cykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGlnZXN0ZWRTdGF0cyA9IGV4dHJhY3RNZWRpYVN0YXRzRnJvbVN0YXRzKHRpbWVzdGFtcCwgcmF3U3RhdHMsIHN0cmVhbVR5cGUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWRpZ2VzdGVkU3RhdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGV4dHJhY3QgTWVkaWFSdHBTdGF0cyBmcm9tIFJUQ1N0YXRzUmVwb3J0IGZvciBzdHJlYW0gdHlwZSAnICsgc3RyZWFtVHlwZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRpZ2VzdGVkU3RhdHM7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAodGhpcy5fcGMgJiYgdGhpcy5fcGMuc2lnbmFsaW5nU3RhdGUgPT09ICdzdGFibGUnKSB7XG4gICAgICAgICAgICB2YXIgc3RhdHNSZXN1bHQgPSB7XG4gICAgICAgICAgICAgICAgYXVkaW86IHtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQ6IGF3YWl0IGltcGwodGhpcy5fcmVtb3RlQXVkaW9TdHJlYW0sICdhdWRpb19pbnB1dCcpLFxuICAgICAgICAgICAgICAgICAgICBvdXRwdXQ6IGF3YWl0IGltcGwodGhpcy5fbG9jYWxTdHJlYW0sICdhdWRpb19vdXRwdXQnKVxuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICB2aWRlbzoge1xuICAgICAgICAgICAgICAgICAgICBpbnB1dDogYXdhaXQgaW1wbCh0aGlzLl9yZW1vdGVWaWRlb1N0cmVhbSwgJ3ZpZGVvX2lucHV0JyksXG4gICAgICAgICAgICAgICAgICAgIG91dHB1dDogYXdhaXQgaW1wbCh0aGlzLl9sb2NhbFN0cmVhbSwgJ3ZpZGVvX291dHB1dCcpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgLy8gRm9yIGNvbnNpc3RlbmN5J3Mgc2FrZSwgY29hbGVzY2UgcnR0TWlsbGlzZWNvbmRzIGludG8gdGhlIG91dHB1dCBmb3IgYXVkaW8gYW5kIHZpZGVvLlxuICAgICAgICAgICAgdmFyIHJ0dFJlZHVjZXIgPSAoYWNjLCBzdGF0cykgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChzdGF0cy5ydHRNaWxsaXNlY29uZHMgIT09IG51bGwgJiYgKGFjYyA9PT0gbnVsbCB8fCBzdGF0cy5ydHRNaWxsaXNlY29uZHMgPiBhY2MpKSB7XG4gICAgICAgICAgICAgICAgICAgIGFjYyA9IHN0YXRzLnJ0dE1pbGxpc2Vjb25kcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc3RhdHMuX3J0dE1pbGxpc2Vjb25kcyA9IG51bGw7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBhdWRpb0lucHV0UnR0TWlsbGlzZWNvbmRzID0gc3RhdHNSZXN1bHQuYXVkaW8uaW5wdXQucmVkdWNlKHJ0dFJlZHVjZXIsIG51bGwpO1xuICAgICAgICAgICAgdmFyIHZpZGVvSW5wdXRSdHRNaWxsaXNlY29uZHMgPSBzdGF0c1Jlc3VsdC52aWRlby5pbnB1dC5yZWR1Y2UocnR0UmVkdWNlciwgbnVsbCk7XG5cbiAgICAgICAgICAgIGlmIChhdWRpb0lucHV0UnR0TWlsbGlzZWNvbmRzICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgc3RhdHNSZXN1bHQuYXVkaW8ub3V0cHV0LmZvckVhY2goKHN0YXRzKSA9PiB7IHN0YXRzLl9ydHRNaWxsaXNlY29uZHMgPSBhdWRpb0lucHV0UnR0TWlsbGlzZWNvbmRzOyB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHZpZGVvSW5wdXRSdHRNaWxsaXNlY29uZHMgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBzdGF0c1Jlc3VsdC52aWRlby5vdXRwdXQuZm9yRWFjaCgoc3RhdHMpID0+IHsgc3RhdHMuX3J0dE1pbGxpc2Vjb25kcyA9IHZpZGVvSW5wdXRSdHRNaWxsaXNlY29uZHM7IH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gc3RhdHNSZXN1bHQ7XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgSWxsZWdhbFN0YXRlKCkpO1xuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgYSBwcm9taXNlIG9mIE1lZGlhUnRwU3RhdHMgb2JqZWN0IGZvciByZW1vdGUgYXVkaW8gKGZyb20gQW1hem9uIENvbm5lY3QgdG8gY2xpZW50KS5cbiAgICAgKiBAcmV0dXJuIFJlamVjdGVkIHByb21pc2UgaWYgZmFpbGVkIHRvIGdldCBNZWRpYVJ0cFN0YXRzLiBUaGUgcHJvbWlzZSBpcyBuZXZlciByZXNvbHZlZCB3aXRoIG51bGwgdmFsdWUuXG4gICAgICogQGRlcHJlY2F0ZWQgaW4gZmF2b3Igb2YgZ2V0U3RhdHMoKVxuICAgICAqL1xuICAgIGdldFJlbW90ZUF1ZGlvU3RhdHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFN0YXRzKCkudGhlbihmdW5jdGlvbihzdGF0cykge1xuICAgICAgICAgICAgaWYgKHN0YXRzLmF1ZGlvLm91dHB1dC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0YXRzLmF1ZGlvLm91dHB1dFswXTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBJbGxlZ2FsU3RhdGUoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBhIHByb21pc2Ugb2YgTWVkaWFSdHBTdGF0cyBvYmplY3QgZm9yIHVzZXIgYXVkaW8gKGZyb20gY2xpZW50IHRvIEFtYXpvbiBDb25uZWN0KS5cbiAgICAgKiBAcmV0dXJuIFJlamVjdGVkIHByb21pc2UgaWYgZmFpbGVkIHRvIGdldCBNZWRpYVJ0cFN0YXRzLiBUaGUgcHJvbWlzZSBpcyBuZXZlciByZXNvbHZlZCB3aXRoIG51bGwgdmFsdWUuXG4gICAgICogQGRlcHJlY2F0ZWQgaW4gZmF2b3Igb2YgZ2V0U3RhdHMoKVxuICAgICAqL1xuICAgIGdldFVzZXJBdWRpb1N0YXRzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRTdGF0cygpLnRoZW4oZnVuY3Rpb24oc3RhdHMpIHtcbiAgICAgICAgICAgIGlmIChzdGF0cy5hdWRpby5pbnB1dC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN0YXRzLmF1ZGlvLmlucHV0WzBdO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IElsbGVnYWxTdGF0ZSgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGEgcHJvbWlzZSBvZiBNZWRpYVJ0cFN0YXRzIG9iamVjdCBmb3IgdXNlciB2aWRlbyAoZnJvbSBjbGllbnQgdG8gQW1hem9uIENvbm5lY3QpLlxuICAgICAqIEByZXR1cm4gUmVqZWN0ZWQgcHJvbWlzZSBpZiBmYWlsZWQgdG8gZ2V0IE1lZGlhUnRwU3RhdHMuIFRoZSBwcm9taXNlIGlzIG5ldmVyIHJlc29sdmVkIHdpdGggbnVsbCB2YWx1ZS5cbiAgICAgKiBAZGVwcmVjYXRlZCBpbiBmYXZvciBvZiBnZXRTdGF0cygpXG4gICAgICovXG4gICAgZ2V0UmVtb3RlVmlkZW9TdGF0cygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0U3RhdHMoKS50aGVuKGZ1bmN0aW9uKHN0YXRzKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHMudmlkZW8ub3V0cHV0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RhdHMudmlkZW8ub3V0cHV0WzBdO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IElsbGVnYWxTdGF0ZSgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGEgcHJvbWlzZSBvZiBNZWRpYVJ0cFN0YXRzIG9iamVjdCBmb3IgdXNlciB2aWRlbyAoZnJvbSBjbGllbnQgdG8gQW1hem9uIENvbm5lY3QpLlxuICAgICAqIEByZXR1cm4gUmVqZWN0ZWQgcHJvbWlzZSBpZiBmYWlsZWQgdG8gZ2V0IE1lZGlhUnRwU3RhdHMuIFRoZSBwcm9taXNlIGlzIG5ldmVyIHJlc29sdmVkIHdpdGggbnVsbCB2YWx1ZS5cbiAgICAgKiBAZGVwcmVjYXRlZCBpbiBmYXZvciBvZiBnZXRTdGF0cygpXG4gICAgICovXG4gICAgZ2V0VXNlclZpZGVvU3RhdHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFN0YXRzKCkudGhlbihmdW5jdGlvbihzdGF0cykge1xuICAgICAgICAgICAgaWYgKHN0YXRzLnZpZGVvLmlucHV0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3RhdHMudmlkZW8uaW5wdXRbMF07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgSWxsZWdhbFN0YXRlKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBfb25JY2VDYW5kaWRhdGUoZXZ0KSB7XG4gICAgICAgIHRoaXMuX3N0YXRlLm9uSWNlQ2FuZGlkYXRlKGV2dCk7XG4gICAgfVxuXG4gICAgX29uUGVlckNvbm5lY3Rpb25TdGF0ZUNoYW5nZSgpIHtcbiAgICAgICAgdGhpcy5fc3RhdGUub25QZWVyQ29ubmVjdGlvblN0YXRlQ2hhbmdlKCk7XG4gICAgfVxuXG4gICAgX29uSWNlU3RhdGVDaGFuZ2UoZXZ0KSB7XG4gICAgICAgIHRoaXMuX3N0YXRlLm9uSWNlU3RhdGVDaGFuZ2UoZXZ0KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBdHRhY2ggcmVtb3RlIG1lZGlhIHN0cmVhbSB0byB3ZWIgZWxlbWVudC5cbiAgICAgKi9cbiAgICBfb250cmFjayhldnQpIHtcbiAgICAgICAgdGhpcy5fc3RyYXRlZ3kuX29udHJhY2sodGhpcywgZXZ0KTtcbiAgICAgICAgdGhpcy5fb25SZW1vdGVTdHJlYW1BZGRlZCh0aGlzLCBldnQuc3RyZWFtc1swXSk7XG4gICAgfVxuICAgIF9kZXRhY2hNZWRpYSgpIHtcbiAgICAgICAgaWYgKHRoaXMuX3JlbW90ZVZpZGVvRWxlbWVudCkge1xuICAgICAgICAgICAgdGhpcy5fcmVtb3RlVmlkZW9FbGVtZW50LnNyY09iamVjdCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX3JlbW90ZUF1ZGlvRWxlbWVudCkge1xuICAgICAgICAgICAgdGhpcy5fcmVtb3RlQXVkaW9FbGVtZW50LnNyY09iamVjdCA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLl9yZW1vdGVBdWRpb1N0cmVhbSA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgX3N0b3BTZXNzaW9uKCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2xvY2FsU3RyZWFtICYmICF0aGlzLl9pc1VzZXJQcm92aWRlZFN0cmVhbSkge1xuICAgICAgICAgICAgICAgIGNsb3NlU3RyZWFtKHRoaXMuX2xvY2FsU3RyZWFtKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9sb2NhbFN0cmVhbSA9IG51bGw7XG4gICAgICAgICAgICAgICAgdGhpcy5faXNVc2VyUHJvdmlkZWRTdHJlYW0gPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3BjKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3BjLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIC8vIGVhdCBleGNlcHRpb25cbiAgICAgICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGMgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgX2J1aWxkTWVkaWFDb25zdHJhaW50cygpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICB2YXIgbWVkaWFDb25zdHJhaW50cyA9IHt9O1xuXG4gICAgICAgIHNlbGYuX3N0cmF0ZWd5Ll9idWlsZE1lZGlhQ29uc3RyYWludHMoc2VsZiwgbWVkaWFDb25zdHJhaW50cyk7XG5cbiAgICAgICAgaWYgKHNlbGYuX2VuYWJsZVZpZGVvKSB7XG4gICAgICAgICAgICB2YXIgdmlkZW9Db25zdHJhaW50cyA9IHt9O1xuICAgICAgICAgICAgdmFyIHdpZHRoQ29uc3RyYWludHMgPSB7fTtcbiAgICAgICAgICAgIHZhciBoZWlnaHRDb25zdHJhaW50cyA9IHt9O1xuICAgICAgICAgICAgdmFyIGZyYW1lUmF0ZUNvbnN0cmFpbnRzID0ge307XG5cbiAgICAgICAgICAgIC8vYnVpbGQgdmlkZW8gd2lkdGggY29uc3RyYWludHNcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygc2VsZi5faWRlYWxWaWRlb1dpZHRoICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIHdpZHRoQ29uc3RyYWludHMuaWRlYWwgPSBzZWxmLl9pZGVhbFZpZGVvV2lkdGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHlwZW9mIHNlbGYuX21heFZpZGVvV2lkdGggIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgd2lkdGhDb25zdHJhaW50cy5tYXggPSBzZWxmLl9tYXhWaWRlb1dpZHRoO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBzZWxmLl9taW5WaWRlb1dpZHRoICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIHdpZHRoQ29uc3RyYWludHMubWluID0gc2VsZi5fbWluVmlkZW9XaWR0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGJ1aWxkIHZpZGVvIGhlaWdodCBjb25zdHJhaW50c1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBzZWxmLl9pZGVhbFZpZGVvSGVpZ2h0ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIGhlaWdodENvbnN0cmFpbnRzLmlkZWFsID0gc2VsZi5faWRlYWxWaWRlb0hlaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0eXBlb2Ygc2VsZi5fbWF4VmlkZW9IZWlnaHQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgaGVpZ2h0Q29uc3RyYWludHMubWF4ID0gc2VsZi5fbWF4VmlkZW9IZWlnaHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHlwZW9mIHNlbGYuX21pblZpZGVvSGVpZ2h0ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIGhlaWdodENvbnN0cmFpbnRzLm1pbiA9IHNlbGYuX21pblZpZGVvSGVpZ2h0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoT2JqZWN0LmtleXMod2lkdGhDb25zdHJhaW50cykubGVuZ3RoID4gMCAmJiBPYmplY3Qua2V5cyhoZWlnaHRDb25zdHJhaW50cykubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHZpZGVvQ29uc3RyYWludHMud2lkdGggPSB3aWR0aENvbnN0cmFpbnRzO1xuICAgICAgICAgICAgICAgIHZpZGVvQ29uc3RyYWludHMuaGVpZ2h0ID0gaGVpZ2h0Q29uc3RyYWludHM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBidWlsZCBmcmFtZSByYXRlIGNvbnN0cmFpbnRzXG4gICAgICAgICAgICBpZiAodHlwZW9mIHNlbGYuX3ZpZGVvRnJhbWVSYXRlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIGZyYW1lUmF0ZUNvbnN0cmFpbnRzLmlkZWFsID0gc2VsZi5fdmlkZW9GcmFtZVJhdGU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHlwZW9mIHNlbGYuX21pblZpZGVvRnJhbWVSYXRlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIGZyYW1lUmF0ZUNvbnN0cmFpbnRzLm1pbiA9IHNlbGYuX21pblZpZGVvRnJhbWVSYXRlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBzZWxmLl9tYXhWaWRlb0ZyYW1lUmF0ZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBmcmFtZVJhdGVDb25zdHJhaW50cy5tYXggPSBzZWxmLl9tYXhWaWRlb0ZyYW1lUmF0ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKE9iamVjdC5rZXlzKGZyYW1lUmF0ZUNvbnN0cmFpbnRzKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdmlkZW9Db25zdHJhaW50cy5mcmFtZVJhdGUgPSBmcmFtZVJhdGVDb25zdHJhaW50cztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gYnVpbGQgZmFjaW5nIG1vZGUgY29uc3RyYWludHNcbiAgICAgICAgICAgIGlmKHNlbGYuX2ZhY2luZ01vZGUgIT09ICd1c2VyJyAmJiBzZWxmLl9mYWNpbmdNb2RlICE9PSBcImVudmlyb25tZW50XCIpIHtcbiAgICAgICAgICAgICAgICBzZWxmLl9mYWNpbmdNb2RlID0gJ3VzZXInO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmlkZW9Db25zdHJhaW50cy5mYWNpbmdNb2RlID0gc2VsZi5fZmFjaW5nTW9kZTtcblxuICAgICAgICAgICAgLy8gc2V0IHZpZGVvIGNvbnN0cmFpbnRzXG4gICAgICAgICAgICBpZiAoT2JqZWN0LmtleXModmlkZW9Db25zdHJhaW50cykubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIG1lZGlhQ29uc3RyYWludHMudmlkZW8gPSB2aWRlb0NvbnN0cmFpbnRzO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBtZWRpYUNvbnN0cmFpbnRzLnZpZGVvID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBtZWRpYUNvbnN0cmFpbnRzO1xuICAgIH1cbn1cbiIsIi8qKlxuICogRXh0cmFjdCBydHAgc3RhdHMgb2Ygc3BlY2lmaWVkIHN0cmVhbSBmcm9tIFJUQ1N0YXRzUmVwb3J0XG4gKiBDaHJvbWUgcmVwb3J0cyBhbGwgc3RyZWFtIHN0YXRzIGluIHN0YXRzUmVwb3J0cyB3aGVyZWFzIGZpcmVmb3ggcmVwb3J0cyBvbmx5IHNpbmdsZSBzdHJlYW0gc3RhdHMgaW4gcmVwb3J0XG4gKiBTdHJlYW1UeXBlIGlzIHBhc3NlZCBvbmx5IHRvIHB1bGwgcmlnaHQgc3RyZWFtIHN0YXRzIGF1ZGlvX2lucHV0IG9yIGF1ZGlvX291dHB1dC5cbiAqL1xuXG5pbXBvcnQgeyBpc19kZWZpbmVkLCB3aGVuX2RlZmluZWQgfSBmcm9tICcuL3V0aWxzJztcbmV4cG9ydCBmdW5jdGlvbiBleHRyYWN0TWVkaWFTdGF0c0Zyb21TdGF0cyh0aW1lc3RhbXAsIHN0YXRzLCBzdHJlYW1UeXBlKSB7XG4gICAgdmFyIGV4dHJhY3RlZFN0YXRzID0gbnVsbDtcbiAgICB2YXIgcmVwb3J0VHlwZSA9IG51bGw7XG5cbiAgICBzdGF0cy5mb3JFYWNoKHN0YXRzUmVwb3J0ID0+IHtcbiAgICAgICAgaWYgKHN0YXRzUmVwb3J0KSB7XG4gICAgICAgICAgICBpZiAoc3RhdHNSZXBvcnQudHlwZSA9PT0gJ2luYm91bmQtcnRwJyAmJiBzdHJlYW1UeXBlID09PSAnYXVkaW9faW5wdXQnKSB7XG4gICAgICAgICAgICAgICAgLy8gaW5ib3VuZC1ydHA6IFN0YXRzIGZvciBzdHJlYW0gZnJvbSBTZXJ2ZXIgdG8gQ0NQLCBhcyBzZWVuIG9uIHRoZSBicm93c2VyXG4gICAgICAgICAgICAgICAgcmVwb3J0VHlwZSA9IHN0YXRzUmVwb3J0LnR5cGU7XG4gICAgICAgICAgICAgICAgZXh0cmFjdGVkU3RhdHMgPSB7XG4gICAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogdGltZXN0YW1wLFxuICAgICAgICAgICAgICAgICAgICBwYWNrZXRzTG9zdDogc3RhdHNSZXBvcnQucGFja2V0c0xvc3QsXG4gICAgICAgICAgICAgICAgICAgIC8vIHBhY2tldHNDb3VudDogbnVtYmVyIG9mIHBhY2tldCByZWNlaXZlZCBieSBDQ1AsIGFzIHNlZW4gb24gdGhlIGJyb3dzZXJcbiAgICAgICAgICAgICAgICAgICAgcGFja2V0c0NvdW50OiBzdGF0c1JlcG9ydC5wYWNrZXRzUmVjZWl2ZWQsXG4gICAgICAgICAgICAgICAgICAgIGpiTWlsbGlzZWNvbmRzOiBNYXRoLmZsb29yKHdoZW5fZGVmaW5lZChzdGF0c1JlcG9ydC5qaXR0ZXIsIDApICogMTAwMCksXG4gICAgICAgICAgICAgICAgICAgIC8vIE11bHRpcGx5aW5nIGF1ZGlvTGV2ZWwgYnkgMzI3NjggYWxpZ25zIGl0cyB2YWx1ZSB3aXRoIHRoZSBsZWdhY3kgZ2V0U3RhdHMgQVBJLlxuICAgICAgICAgICAgICAgICAgICBhdWRpb0xldmVsOiBpc19kZWZpbmVkKHN0YXRzUmVwb3J0LmF1ZGlvTGV2ZWwpID8gTWF0aC5mbG9vcihzdGF0c1JlcG9ydC5hdWRpb0xldmVsICogMzI3NjgpIDogbnVsbFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXRzUmVwb3J0LnR5cGUgPT09ICdvdXRib3VuZC1ydHAnICYmIHN0cmVhbVR5cGUgPT09ICdhdWRpb19vdXRwdXQnKSB7XG4gICAgICAgICAgICAgICAgLy8gb3V0Ym91bmQtcnRwOiBTdGF0cyBmb3Igc3RyZWFtIGZyb20gQ0NQIHRvIFNlcnZlciwgYXMgc2VlbiBvbiB0aGUgYnJvd3NlclxuICAgICAgICAgICAgICAgIGV4dHJhY3RlZFN0YXRzID0gZXh0cmFjdGVkU3RhdHMgfHwge307XG4gICAgICAgICAgICAgICAgLy8gcGFja2V0c0NvdW50OiBudW1iZXIgb2YgcGFja2V0IHNlbnQgYnkgQ0NQLCBhcyBzZWVuIG9uIHRoZSBicm93c2VyXG4gICAgICAgICAgICAgICAgZXh0cmFjdGVkU3RhdHMucGFja2V0c0NvdW50ID0gc3RhdHNSZXBvcnQucGFja2V0c1NlbnQ7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXRzUmVwb3J0LnR5cGUgPT09ICdtZWRpYS1zb3VyY2UnICYmIHN0cmVhbVR5cGUgPT09ICdhdWRpb19vdXRwdXQnKSB7XG4gICAgICAgICAgICAgICAgZXh0cmFjdGVkU3RhdHMgPSBleHRyYWN0ZWRTdGF0cyB8fCB7fTtcbiAgICAgICAgICAgICAgICAvLyBNdWx0aXBseWluZyBhdWRpb0xldmVsIGJ5IDMyNzY4IGFsaWducyBpdHMgdmFsdWUgd2l0aCB0aGUgbGVnYWN5IGdldFN0YXRzIEFQSS5cbiAgICAgICAgICAgICAgICBleHRyYWN0ZWRTdGF0cy5hdWRpb0xldmVsID0gaXNfZGVmaW5lZChzdGF0c1JlcG9ydC5hdWRpb0xldmVsKSA/IE1hdGguZmxvb3Ioc3RhdHNSZXBvcnQuYXVkaW9MZXZlbCAqIDMyNzY4KSA6IG51bGw7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXRzUmVwb3J0LnR5cGUgPT09ICdyZW1vdGUtaW5ib3VuZC1ydHAnICYmIHN0cmVhbVR5cGUgPT09ICdhdWRpb19vdXRwdXQnKSB7XG4gICAgICAgICAgICAgICAgLy8gcmVtb3RlLWluYm91bmQtcnRwOiBTdGF0cyBmb3Igc3RyZWFtIGZyb20gQ0NQIHRvIFNlcnZlciwgYXMgc2VlbiBvbiBTZXJ2ZXIgc2lkZVxuICAgICAgICAgICAgICAgIHJlcG9ydFR5cGUgPSBzdGF0c1JlcG9ydC50eXBlO1xuICAgICAgICAgICAgICAgIGV4dHJhY3RlZFN0YXRzID0gZXh0cmFjdGVkU3RhdHMgfHwge307XG4gICAgICAgICAgICAgICAgZXh0cmFjdGVkU3RhdHMudGltZXN0YW1wID0gdGltZXN0YW1wO1xuICAgICAgICAgICAgICAgIGV4dHJhY3RlZFN0YXRzLnBhY2tldHNMb3N0ID0gc3RhdHNSZXBvcnQucGFja2V0c0xvc3Q7XG4gICAgICAgICAgICAgICAgZXh0cmFjdGVkU3RhdHMucnR0TWlsbGlzZWNvbmRzID0gaXNfZGVmaW5lZChzdGF0c1JlcG9ydC5yb3VuZFRyaXBUaW1lKSA/IE1hdGguZmxvb3Ioc3RhdHNSZXBvcnQucm91bmRUcmlwVGltZSAqIDEwMDApIDogbnVsbDtcbiAgICAgICAgICAgICAgICBleHRyYWN0ZWRTdGF0cy5qYk1pbGxpc2Vjb25kcyA9IE1hdGguZmxvb3Iod2hlbl9kZWZpbmVkKHN0YXRzUmVwb3J0LmppdHRlciwgMCkgKiAxMDAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGV4dHJhY3RlZFN0YXRzID8gbmV3IE1lZGlhUnRwU3RhdHMoZXh0cmFjdGVkU3RhdHMsIHJlcG9ydFR5cGUsIHN0cmVhbVR5cGUpIDogbnVsbDtcbn1cblxuLyoqXG4gKiBCYXNpYyBSVFAgc3RhdGlzdGljcyBvYmplY3QsIHJlcHJlc2VudHMgc3RhdGlzdGljcyBvZiBhbiBhdWRpbyBvciB2aWRlbyBzdHJlYW0uXG4gKi9cbmNsYXNzIE1lZGlhUnRwU3RhdHMge1xuICAgIGNvbnN0cnVjdG9yKHBhcmFtc0luLCBzdGF0c1JlcG9ydFR5cGUsIHN0cmVhbVR5cGUpIHtcbiAgICAgICAgdmFyIHBhcmFtcyA9IHBhcmFtc0luIHx8IHt9O1xuXG4gICAgICAgIHRoaXMuX3RpbWVzdGFtcCAgICAgICAgID0gcGFyYW1zLnRpbWVzdGFtcCB8fCBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgICAgdGhpcy5fcGFja2V0c0xvc3QgICAgICAgPSB3aGVuX2RlZmluZWQocGFyYW1zLnBhY2tldHNMb3N0KTtcbiAgICAgICAgdGhpcy5fcGFja2V0c0NvdW50ICAgICAgPSB3aGVuX2RlZmluZWQocGFyYW1zLnBhY2tldHNDb3VudCk7XG4gICAgICAgIHRoaXMuX2F1ZGlvTGV2ZWwgICAgICAgID0gd2hlbl9kZWZpbmVkKHBhcmFtcy5hdWRpb0xldmVsKTtcbiAgICAgICAgdGhpcy5fcHJvY01pbGxpc2Vjb25kcyAgPSB3aGVuX2RlZmluZWQocGFyYW1zLnByb2NNaWxsaXNlY29uZHMpO1xuICAgICAgICB0aGlzLl9ydHRNaWxsaXNlY29uZHMgICA9IHdoZW5fZGVmaW5lZChwYXJhbXMucnR0TWlsbGlzZWNvbmRzKTtcbiAgICAgICAgdGhpcy5famJNaWxsaXNlY29uZHMgICAgPSB3aGVuX2RlZmluZWQocGFyYW1zLmpiTWlsbGlzZWNvbmRzKTtcbiAgICAgICAgdGhpcy5fYnl0ZXNTZW50ICAgICAgICAgPSB3aGVuX2RlZmluZWQocGFyYW1zLmJ5dGVzU2VudCk7XG4gICAgICAgIHRoaXMuX2J5dGVzUmVjZWl2ZWQgICAgID0gd2hlbl9kZWZpbmVkKHBhcmFtcy5ieXRlc1JlY2VpdmVkKTtcbiAgICAgICAgdGhpcy5fZnJhbWVzRW5jb2RlZCAgICAgPSB3aGVuX2RlZmluZWQocGFyYW1zLmZyYW1lc0VuY29kZWQpO1xuICAgICAgICB0aGlzLl9mcmFtZXNEZWNvZGVkICAgICA9IHdoZW5fZGVmaW5lZChwYXJhbXMuZnJhbWVzRGVjb2RlZCk7XG4gICAgICAgIHRoaXMuX2ZyYW1lUmF0ZVNlbnQgICAgID0gd2hlbl9kZWZpbmVkKHBhcmFtcy5mcmFtZVJhdGVTZW50KTtcbiAgICAgICAgdGhpcy5fZnJhbWVSYXRlUmVjZWl2ZWQgPSB3aGVuX2RlZmluZWQocGFyYW1zLmZyYW1lUmF0ZVJlY2VpdmVkKTtcbiAgICAgICAgdGhpcy5fc3RhdHNSZXBvcnRUeXBlICAgPSBzdGF0c1JlcG9ydFR5cGUgfHwgcGFyYW1zLl9zdGF0c1JlcG9ydFR5cGUgfHwgXCJ1bmtub3duXCI7XG4gICAgICAgIHRoaXMuX3N0cmVhbVR5cGUgICAgICAgID0gc3RyZWFtVHlwZSB8fCBwYXJhbXMuc3RyZWFtVHlwZSB8fCBcInVua25vd25cIjtcbiAgICB9XG5cbiAgICAvKioge251bWJlcn0gbnVtYmVyIG9mIHBhY2tldHMgc2VudCB0byB0aGUgY2hhbm5lbCAqL1xuICAgIGdldCBwYWNrZXRzQ291bnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9wYWNrZXRzQ291bnQ7XG4gICAgfVxuICAgIC8qKiB7bnVtYmVyfSBudW1iZXIgb2YgcGFja2V0cyBsb3N0IGFmdGVyIHRyYXZlbGxpbmcgdGhyb3VnaCB0aGUgY2hhbm5lbCAqL1xuICAgIGdldCBwYWNrZXRzTG9zdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3BhY2tldHNMb3N0O1xuICAgIH1cbiAgICAvKioge251bWJlcn0gbnVtYmVyIG9mIHBhY2tldHMgbG9zdCBhZnRlciB0cmF2ZWxsaW5nIHRocm91Z2ggdGhlIGNoYW5uZWwgKi9cbiAgICBnZXQgcGFja2V0TG9zc1BlcmNlbnRhZ2UoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9wYWNrZXRzQ291bnQgPiAwID8gdGhpcy5fcGFja2V0c0xvc3QgLyB0aGlzLl9wYWNrZXRzQ291bnQgOiAwO1xuICAgIH1cbiAgICAvKiogQXVkaW8gdm9sdW1lIGxldmVsXG4gICAgICogQ3VycmVudGx5IGZpcmVmb3ggZG9lc24ndCBwcm92aWRlIGF1ZGlvIGxldmVsIGluIHJ0cCBzdGF0cy5cbiAgICAgKi9cbiAgICBnZXQgYXVkaW9MZXZlbCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2F1ZGlvTGV2ZWw7XG4gICAgfVxuICAgIC8qKiBUaW1lc3RhbXAgd2hlbiBzdGF0cyBhcmUgY29sbGVjdGVkLiAqL1xuICAgIGdldCB0aW1lc3RhbXAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90aW1lc3RhbXA7XG4gICAgfVxuICAgIC8qKiB7bnVtYmVyfSBQcm9jZXNzaW5nIGRlbGF5IGNhbGN1bGF0ZWQgYnkgdGltZSB0byBwcm9jZXNzIHBhY2tldCBoZWFkZXIgKi9cbiAgICBnZXQgcHJvY01pbGxpc2Vjb25kcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Byb2NNaWxsaXNlY29uZHNcbiAgICB9XG4gICAgLyoqIHtudW1iZXJ9IFJvdW5kIHRyaXAgdGltZSBjYWxjdWxhdGVkIHdpdGggUlRDUCByZXBvcnRzICovXG4gICAgZ2V0IHJ0dE1pbGxpc2Vjb25kcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3J0dE1pbGxpc2Vjb25kcztcbiAgICB9XG4gICAgLyoqIHtudW1iZXJ9IFN0YXRpc3RpY2FsIHZhcmlhbmNlIG9mIFJUUCBkYXRhIHBhY2tldCBpbnRlci1hcnJpdmFsIHRpbWUgKi9cbiAgICBnZXQgamJNaWxsaXNlY29uZHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9qYk1pbGxpc2Vjb25kcztcbiAgICB9XG4gICAgLyoqIHtudW1iZXJ9IG51bWJlciBvZiBieXRlcyBzZW50IHRvIHRoZSBjaGFubmVsKi9cbiAgICBnZXQgYnl0ZXNTZW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYnl0ZXNTZW50O1xuICAgIH1cbiAgICAvKioge251bWJlcn0gbnVtYmVyIG9mIGJ5dGVzIHJlY2VpdmVkIGZyb20gdGhlIGNoYW5uZWwqL1xuICAgIGdldCBieXRlc1JlY2VpdmVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYnl0ZXNSZWNlaXZlZDtcbiAgICB9XG4gICAgLyoqIHtudW1iZXJ9IG51bWJlciBvZiB2aWRlbyBmcmFtZXMgZW5jb2RlZCovXG4gICAgZ2V0IGZyYW1lc0VuY29kZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9mcmFtZXNFbmNvZGVkO1xuICAgIH1cbiAgICAvKioge251bWJlcn0gbnVtYmVyIG9mIHZpZGVvIGZyYW1lcyBkZWNvZGVkKi9cbiAgICBnZXQgZnJhbWVzRGVjb2RlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ZyYW1lc0RlY29kZWQ7XG4gICAgfVxuICAgIC8qKiB7bnVtYmVyfSBmcmFtZXMgcGVyIHNlY29uZCBzZW50IHRvIHRoZSBjaGFubmVsKi9cbiAgICBnZXQgZnJhbWVSYXRlU2VudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ZyYW1lUmF0ZVNlbnQ7XG4gICAgfVxuICAgIC8qKiB7bnVtYmVyfSBmcmFtZXMgcGVyIHNlY29uZCByZWNlaXZlZCBmcm9tIHRoZSBjaGFubmVsKi9cbiAgICBnZXQgZnJhbWVSYXRlUmVjZWl2ZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9mcmFtZVJhdGVSZWNlaXZlZDtcbiAgICB9XG4gICAgLyoqIHtzdHJpbmd9IHRoZSB0eXBlIG9mIHRoZSBzdGF0cyByZXBvcnQgKi9cbiAgICBnZXQgc3RhdHNSZXBvcnRUeXBlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc3RhdHNSZXBvcnRUeXBlO1xuICAgIH1cbiAgICAvKioge3N0cmluZ30gdGhlIHR5cGUgb2YgdGhlIHN0cmVhbSAqL1xuICAgIGdldCBzdHJlYW1UeXBlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc3RyZWFtVHlwZTtcbiAgICB9XG59XG4iLCIvKipcbiAqIENvcHlyaWdodCAyMDE3IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG5leHBvcnQgY2xhc3MgU2Vzc2lvblJlcG9ydCB7XG4gICAgLyoqXG4gICAgICogQGNsYXNzIFByb3RvdHlwZSBmb3IgdHJhY2tpbmcgdmFyaW91cyBSVEMgc2Vzc2lvbiByZXBvcnRcbiAgICAgKiBAY29uc3RydWN0c1xuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLl9zZXNzaW9uU3RhcnRUaW1lID0gbnVsbDtcbiAgICAgICAgdGhpcy5fc2Vzc2lvbkVuZFRpbWUgPSBudWxsO1xuICAgICAgICB0aGlzLl9ndW1UaW1lTWlsbGlzID0gbnVsbDtcbiAgICAgICAgdGhpcy5faW5pdGlhbGl6YXRpb25UaW1lTWlsbGlzID0gbnVsbDtcbiAgICAgICAgdGhpcy5faWNlQ29sbGVjdGlvblRpbWVNaWxsaXMgPSBudWxsO1xuICAgICAgICB0aGlzLl9zaWduYWxsaW5nQ29ubmVjdFRpbWVNaWxsaXMgPSBudWxsO1xuICAgICAgICB0aGlzLl9oYW5kc2hha2luZ1RpbWVNaWxsaXMgPSBudWxsO1xuICAgICAgICB0aGlzLl9wcmVUYWxraW5nVGltZU1pbGxpcyA9IG51bGw7XG4gICAgICAgIHRoaXMuX3RhbGtpbmdUaW1lTWlsbGlzID0gbnVsbDtcbiAgICAgICAgdGhpcy5faWNlQ29ubmVjdGlvbnNMb3N0ID0gMDtcbiAgICAgICAgdGhpcy5faWNlQ29ubmVjdGlvbnNGYWlsZWQgPSBudWxsO1xuICAgICAgICB0aGlzLl9wZWVyQ29ubmVjdGlvbkZhaWxlZCA9IG51bGw7XG4gICAgICAgIHRoaXMuX2NsZWFudXBUaW1lTWlsbGlzID0gbnVsbDtcbiAgICAgICAgdGhpcy5faWNlQ29sbGVjdGlvbkZhaWx1cmUgPSBudWxsO1xuICAgICAgICB0aGlzLl9zaWduYWxsaW5nQ29ubmVjdGlvbkZhaWx1cmUgPSBudWxsO1xuICAgICAgICB0aGlzLl9oYW5kc2hha2luZ0ZhaWx1cmUgPSBudWxsO1xuICAgICAgICB0aGlzLl9ndW1PdGhlckZhaWx1cmUgPSBudWxsO1xuICAgICAgICB0aGlzLl9ndW1UaW1lb3V0RmFpbHVyZSA9IG51bGw7XG4gICAgICAgIHRoaXMuX2NyZWF0ZU9mZmVyRmFpbHVyZSA9IG51bGw7XG4gICAgICAgIHRoaXMuX3NldExvY2FsRGVzY3JpcHRpb25GYWlsdXJlID0gbnVsbDtcbiAgICAgICAgdGhpcy5fdXNlckJ1c3lGYWlsdXJlID0gbnVsbDtcbiAgICAgICAgdGhpcy5faW52YWxpZFJlbW90ZVNEUEZhaWx1cmUgPSBudWxsO1xuICAgICAgICB0aGlzLl9ub1JlbW90ZUljZUNhbmRpZGF0ZUZhaWx1cmUgPSBudWxsO1xuICAgICAgICB0aGlzLl9zZXRSZW1vdGVEZXNjcmlwdGlvbkZhaWx1cmUgPSBudWxsO1xuICAgICAgICB0aGlzLl9zdHJlYW1TdGF0cyA9IFtdO1xuICAgICAgICB0aGlzLl9ydGNKc1ZlcnNpb24gPSBcIkBAUlRDX0pTX1ZFUlNJT05cIlxuICAgIH1cbiAgICAvKipcbiAgICAgKlRpbWVzdGFtcCB3aGVuIFJUQ1Nlc3Npb24gc3RhcnRlZC5cbiAgICAgKi9cbiAgICBnZXQgc2Vzc2lvblN0YXJ0VGltZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Nlc3Npb25TdGFydFRpbWU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRpbWVzdGFtcCB3aGVuIFJUQ1Nlc3Npb24gZW5kZWQuXG4gICAgICovXG4gICAgZ2V0IHNlc3Npb25FbmRUaW1lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2Vzc2lvbkVuZFRpbWU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRpbWUgdGFrZW4gZm9yIGdyYWJiaW5nIHVzZXIgbWljcm9waG9uZSBhdCB0aGUgdGltZSBvZiBjb25uZWN0aW5nIFJUQ1Nlc3Npb24uXG4gICAgICovXG4gICAgZ2V0IGd1bVRpbWVNaWxsaXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9ndW1UaW1lTWlsbGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaW1lIHRha2VuIGZvciBzZXNzaW9uIGluaXRpYWxpemF0aW9uIGluIG1pbGxpcy4gSW5jbHVkZXMgdGltZSBzcGVudCBpbiBHcmFiTG9jYWxNZWRpYSwgU2V0TG9jYWxTRFAgc3RhdGVzLlxuICAgICAqL1xuICAgIGdldCBpbml0aWFsaXphdGlvblRpbWVNaWxsaXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9pbml0aWFsaXphdGlvblRpbWVNaWxsaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRpbWUgc3BlbnQgb24gSUNFQ29sbGVjdGlvbiBpbiBtaWxsaXMuXG4gICAgICovXG4gICAgZ2V0IGljZUNvbGxlY3Rpb25UaW1lTWlsbGlzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faWNlQ29sbGVjdGlvblRpbWVNaWxsaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRpbWUgdGFrZW4gZm9yIGNvbm5lY3RpbmcgdGhlIHNpZ25hbGxpbmcgaW4gbWlsbGlzLlxuICAgICAqL1xuICAgIGdldCBzaWduYWxsaW5nQ29ubmVjdFRpbWVNaWxsaXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zaWduYWxsaW5nQ29ubmVjdFRpbWVNaWxsaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRpbWVzIHNwZW50IGZyb20gUlRDU2Vzc2lvbiBjb25uZWN0aW9uIHVudGlsIGVudGVyaW5nIFRhbGtpbmcgc3RhdGUgaW4gbWlsbGlzLlxuICAgICAqL1xuICAgIGdldCBwcmVUYWxraW5nVGltZU1pbGxpcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ByZVRhbGtpbmdUaW1lTWlsbGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiAgVGltZXMgc3BlbnQgaW4gY29tcGxldGluZyBoYW5kc2hha2luZyBwcm9jZXNzIG9mIHRoZSBSVENTZXNzaW9uIGluIG1pbGxpcy5cbiAgICAgKi9cbiAgICBnZXQgaGFuZHNoYWtpbmdUaW1lTWlsbGlzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faGFuZHNoYWtpbmdUaW1lTWlsbGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiAgVGltZXMgc3BlbnQgaW4gVGFsa2luZyBzdGF0ZSBpbiBtaWxsaXMuXG4gICAgICovXG4gICAgZ2V0IHRhbGtpbmdUaW1lTWlsbGlzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdGFsa2luZ1RpbWVNaWxsaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEhvdyBtYW55IHRpbWVzIHRoZSBSVENTZXNzaW9uIGhhcyBsb3N0IElDRSBjb25uZWN0aW9uIGluIHRhbGtpbmcgc3RhdGUuXG4gICAgICovXG4gICAgZ2V0IGljZUNvbm5lY3Rpb25zTG9zdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ljZUNvbm5lY3Rpb25zTG9zdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGVsbHMgaWYgdGhlIFJUQ1Nlc3Npb24gaGFzIGZhaWxlZCBSVENQZWVyQ29ubmVjdGlvbi5pY2VDb25uZWN0aW9uU3RhdGVcbiAgICAgKi9cbiAgICBnZXQgaWNlQ29ubmVjdGlvbnNGYWlsZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9pY2VDb25uZWN0aW9uc0ZhaWxlZDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGVsbHMgaWYgdGhlIFJUQ1Nlc3Npb24gaGFzIGZhaWxlZCBSVENQZWVyQ29ubmVjdGlvbi5jb25uZWN0aW9uU3RhdGVcbiAgICAgKi9cbiAgICBnZXQgcGVlckNvbm5lY3Rpb25GYWlsZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9wZWVyQ29ubmVjdGlvbkZhaWxlZDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGltZXMgc3BlbnQgaW4gQ2xlYW51cCBzdGF0ZSBpbiBtaWxsaXNcbiAgICAgKi9cbiAgICBnZXQgY2xlYW51cFRpbWVNaWxsaXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jbGVhbnVwVGltZU1pbGxpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGVsbHMgaWYgdGhlIFJUQ1Nlc3Npb24gZmFpbHMgaW4gSUNFQ29sbGVjdGlvbi5cbiAgICAgKi9cbiAgICBnZXQgaWNlQ29sbGVjdGlvbkZhaWx1cmUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9pY2VDb2xsZWN0aW9uRmFpbHVyZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGVsbHMgaWYgdGhlIFJUQ1Nlc3Npb24gZmFpbGVkIGluIHNpZ25hbGxpbmcgY29ubmVjdCBzdGFnZS5cbiAgICAgKi9cbiAgICBnZXQgc2lnbmFsbGluZ0Nvbm5lY3Rpb25GYWlsdXJlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2lnbmFsbGluZ0Nvbm5lY3Rpb25GYWlsdXJlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBIYW5kc2hha2luZyBmYWlsdXJlIG9mIHRoZSBSVENTZXNzaW9uXG4gICAgICovXG4gICAgZ2V0IGhhbmRzaGFraW5nRmFpbHVyZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2hhbmRzaGFraW5nRmFpbHVyZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR3VtIGZhaWxlZCBkdWUgdG8gdGltZW91dCBhdCB0aGUgdGltZSBvZiBuZXcgUlRDU2Vzc2lvbiBjb25uZWN0aW9uXG4gICAgICovXG4gICAgZ2V0IGd1bVRpbWVvdXRGYWlsdXJlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZ3VtVGltZW91dEZhaWx1cmU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEd1bSBmYWlsZWQgZHVlIHRvIG90aGVyIHJlYXNvbnMgKG90aGVyIHRoYW4gVGltZW91dClcbiAgICAgKi9cbiAgICBnZXQgZ3VtT3RoZXJGYWlsdXJlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZ3VtT3RoZXJGYWlsdXJlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSVEMgU2Vzc2lvbiBmYWlsZWQgaW4gY3JlYXRlIE9mZmVyIHN0YXRlLlxuICAgICAqL1xuICAgIGdldCBjcmVhdGVPZmZlckZhaWx1cmUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jcmVhdGVPZmZlckZhaWx1cmU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRlbGxzIGlmIHNldExvY2FsRGVzY3JpcHRpb24gZmFpbGVkIGZvciB0aGUgUlRDIFNlc3Npb24uXG4gICAgICovXG4gICAgZ2V0IHNldExvY2FsRGVzY3JpcHRpb25GYWlsdXJlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2V0TG9jYWxEZXNjcmlwdGlvbkZhaWx1cmU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRlbGxzIGlmIGhhbmRzaGFraW5nIGZhaWxlZCBkdWUgdG8gdXNlciBidXN5IGNhc2UsXG4gICAgICogaGFwcGVucyB3aGVuIG11bHRpcGxlIHNvZnRwaG9uZSBjYWxscyBhcmUgaW5pdGlhdGVkIGF0IHNhbWUgdGltZS5cbiAgICAgKi9cbiAgICBnZXQgdXNlckJ1c3lGYWlsdXJlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdXNlckJ1c3lGYWlsdXJlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUZWxscyBpdCByZW1vdGUgU0RQIGlzIGludmFsaWQuXG4gICAgICovXG4gICAgZ2V0IGludmFsaWRSZW1vdGVTRFBGYWlsdXJlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faW52YWxpZFJlbW90ZVNEUEZhaWx1cmU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRlbGxzIGlmIHRoZSBzZXRSZW1vdGVEZXNjcmlwdGlvbiBmYWlsZWQgZm9yIHRoZSBSVEMgU2Vzc2lvbi5cbiAgICAgKi9cbiAgICBnZXQgc2V0UmVtb3RlRGVzY3JpcHRpb25GYWlsdXJlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2V0UmVtb3RlRGVzY3JpcHRpb25GYWlsdXJlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBIGZhaWx1cmUgY2FzZSB3aGVuIHRoZXJlIGlzIG5vIFJlbW90ZUljZUNhbmRpZGF0ZS5cbiAgICAgKi9cbiAgICBnZXQgbm9SZW1vdGVJY2VDYW5kaWRhdGVGYWlsdXJlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbm9SZW1vdGVJY2VDYW5kaWRhdGVGYWlsdXJlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTdGF0aXN0aWNzIGZvciBlYWNoIHN0cmVhbShhdWRpby1pbiwgYXVkaW8tb3V0LCB2aWRlby1pbiwgdmlkZW8tb3V0KSBvZiB0aGUgUlRDU2Vzc2lvbi5cbiAgICAgKi9cbiAgICBnZXQgc3RyZWFtU3RhdHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zdHJlYW1TdGF0cztcbiAgICB9XG4gICAgLyoqXG4gICAgICogZ2V0IGN1cnJlbnQgY29ubmVjdC1ydGMtanMgdmVyc2lvblxuICAgICAqL1xuICAgIGdldCBydGNKc1ZlcnNpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9ydGNKc1ZlcnNpb247XG4gICAgfVxuXG4gICAgc2V0IHNlc3Npb25TdGFydFRpbWUodmFsdWUpIHtcbiAgICAgICAgdGhpcy5fc2Vzc2lvblN0YXJ0VGltZSA9IHZhbHVlO1xuICAgIH1cbiAgICBzZXQgc2Vzc2lvbkVuZFRpbWUodmFsdWUpIHtcbiAgICAgICAgdGhpcy5fc2Vzc2lvbkVuZFRpbWUgPSB2YWx1ZTtcbiAgICB9XG4gICAgc2V0IGd1bVRpbWVNaWxsaXModmFsdWUpIHtcbiAgICAgICAgdGhpcy5fZ3VtVGltZU1pbGxpcyA9IHZhbHVlO1xuICAgIH1cbiAgICBzZXQgaW5pdGlhbGl6YXRpb25UaW1lTWlsbGlzKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX2luaXRpYWxpemF0aW9uVGltZU1pbGxpcyA9IHZhbHVlO1xuICAgIH1cbiAgICBzZXQgaWNlQ29sbGVjdGlvblRpbWVNaWxsaXModmFsdWUpIHtcbiAgICAgICAgdGhpcy5faWNlQ29sbGVjdGlvblRpbWVNaWxsaXMgPSB2YWx1ZTtcbiAgICB9XG4gICAgc2V0IHNpZ25hbGxpbmdDb25uZWN0VGltZU1pbGxpcyh2YWx1ZSkge1xuICAgICAgICB0aGlzLl9zaWduYWxsaW5nQ29ubmVjdFRpbWVNaWxsaXMgPSB2YWx1ZTtcbiAgICB9XG4gICAgc2V0IHByZVRhbGtpbmdUaW1lTWlsbGlzKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX3ByZVRhbGtpbmdUaW1lTWlsbGlzID0gdmFsdWU7XG4gICAgfVxuICAgIHNldCBoYW5kc2hha2luZ1RpbWVNaWxsaXModmFsdWUpIHtcbiAgICAgICAgdGhpcy5faGFuZHNoYWtpbmdUaW1lTWlsbGlzID0gdmFsdWU7XG4gICAgfVxuICAgIHNldCB0YWxraW5nVGltZU1pbGxpcyh2YWx1ZSkge1xuICAgICAgICB0aGlzLl90YWxraW5nVGltZU1pbGxpcyA9IHZhbHVlO1xuICAgIH1cbiAgICBzZXQgaWNlQ29ubmVjdGlvbnNMb3N0KHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX2ljZUNvbm5lY3Rpb25zTG9zdCA9IHZhbHVlO1xuICAgIH1cbiAgICBzZXQgaWNlQ29ubmVjdGlvbnNGYWlsZWQodmFsdWUpIHtcbiAgICAgICAgdGhpcy5faWNlQ29ubmVjdGlvbnNGYWlsZWQgPSB2YWx1ZTtcbiAgICB9XG4gICAgc2V0IHBlZXJDb25uZWN0aW9uRmFpbGVkKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX3BlZXJDb25uZWN0aW9uRmFpbGVkID0gdmFsdWU7XG4gICAgfVxuICAgIHNldCBjbGVhbnVwVGltZU1pbGxpcyh2YWx1ZSkge1xuICAgICAgICB0aGlzLl9jbGVhbnVwVGltZU1pbGxpcyA9IHZhbHVlO1xuICAgIH1cbiAgICBzZXQgaWNlQ29sbGVjdGlvbkZhaWx1cmUodmFsdWUpIHtcbiAgICAgICAgdGhpcy5faWNlQ29sbGVjdGlvbkZhaWx1cmUgPSB2YWx1ZTtcbiAgICB9XG4gICAgc2V0IHNpZ25hbGxpbmdDb25uZWN0aW9uRmFpbHVyZSh2YWx1ZSkge1xuICAgICAgICB0aGlzLl9zaWduYWxsaW5nQ29ubmVjdGlvbkZhaWx1cmUgPSB2YWx1ZTtcbiAgICB9XG4gICAgc2V0IGhhbmRzaGFraW5nRmFpbHVyZSh2YWx1ZSkge1xuICAgICAgICB0aGlzLl9oYW5kc2hha2luZ0ZhaWx1cmUgPSB2YWx1ZTtcbiAgICB9XG4gICAgc2V0IGd1bVRpbWVvdXRGYWlsdXJlKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX2d1bVRpbWVvdXRGYWlsdXJlID0gdmFsdWU7XG4gICAgfVxuICAgIHNldCBndW1PdGhlckZhaWx1cmUodmFsdWUpIHtcbiAgICAgICAgdGhpcy5fZ3VtT3RoZXJGYWlsdXJlID0gdmFsdWU7XG4gICAgfVxuICAgIHNldCBjcmVhdGVPZmZlckZhaWx1cmUodmFsdWUpIHtcbiAgICAgICAgdGhpcy5fY3JlYXRlT2ZmZXJGYWlsdXJlID0gdmFsdWU7XG4gICAgfVxuICAgIHNldCBzZXRMb2NhbERlc2NyaXB0aW9uRmFpbHVyZSh2YWx1ZSkge1xuICAgICAgICB0aGlzLl9zZXRMb2NhbERlc2NyaXB0aW9uRmFpbHVyZSA9IHZhbHVlO1xuICAgIH1cbiAgICBzZXQgdXNlckJ1c3lGYWlsdXJlKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX3VzZXJCdXN5RmFpbHVyZSA9IHZhbHVlO1xuICAgIH1cbiAgICBzZXQgaW52YWxpZFJlbW90ZVNEUEZhaWx1cmUodmFsdWUpIHtcbiAgICAgICAgdGhpcy5faW52YWxpZFJlbW90ZVNEUEZhaWx1cmUgPSB2YWx1ZTtcbiAgICB9XG4gICAgc2V0IG5vUmVtb3RlSWNlQ2FuZGlkYXRlRmFpbHVyZSh2YWx1ZSkge1xuICAgICAgICB0aGlzLl9ub1JlbW90ZUljZUNhbmRpZGF0ZUZhaWx1cmUgPSB2YWx1ZTtcbiAgICB9XG4gICAgc2V0IHNldFJlbW90ZURlc2NyaXB0aW9uRmFpbHVyZSh2YWx1ZSkge1xuICAgICAgICB0aGlzLl9zZXRSZW1vdGVEZXNjcmlwdGlvbkZhaWx1cmUgPSB2YWx1ZTtcbiAgICB9XG4gICAgc2V0IHN0cmVhbVN0YXRzKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX3N0cmVhbVN0YXRzID0gdmFsdWU7XG4gICAgfVxuICAgIHNldCBydGNKc1ZlcnNpb24odmFsdWUpIHtcbiAgICAgICAgdGhpcy5fcnRjSnNWZXJzaW9uID0gdmFsdWU7XG4gICAgfVxufVxuIiwiLyoqXG4gKiBDb3B5cmlnaHQgMjAxNyBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuaW1wb3J0IHsgZ2V0UmVkYWN0ZWRTZHAsIGhpdGNoLCB3cmFwTG9nZ2VyfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCB7IE1BWF9JTlZJVEVfREVMQVlfTVMsIE1BWF9BQ0NFUFRfQllFX0RFTEFZX01TLCBERUZBVUxUX0NPTk5FQ1RfVElNRU9VVF9NUywgSU5WSVRFX01FVEhPRF9OQU1FLCBBQ0NFUFRfTUVUSE9EX05BTUUsIEJZRV9NRVRIT0RfTkFNRSB9IGZyb20gJy4vcnRjX2NvbnN0JztcbmltcG9ydCB7IFVuc3VwcG9ydGVkT3BlcmF0aW9uLCBUaW1lb3V0LCBCdXN5RXhjZXB0aW9uLCBDYWxsTm90Rm91bmRFeGNlcHRpb24sIFVua25vd25TaWduYWxpbmdFcnJvciB9IGZyb20gJy4vZXhjZXB0aW9ucyc7XG5pbXBvcnQgdXVpZCBmcm9tICd1dWlkL3Y0JztcbmltcG9ydCBWaXJ0dWFsV3NzQ29ubmVjdGlvbk1hbmFnZXIgZnJvbSBcIi4vdmlydHVhbF93c3NfY29ubmVjdGlvbl9tYW5hZ2VyXCI7XG5cbnZhciBDT05ORUNUX01BWF9SRVRSSUVTID0gMztcblxuLyoqXG4gKiBBYnN0cmFjdCBzaWduYWxpbmcgc3RhdGUgY2xhc3MuXG4gKi9cbmV4cG9ydCBjbGFzcyBTaWduYWxpbmdTdGF0ZSB7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtBbXpuUnRjU2lnbmFsaW5nfSBzaWduYWxpbmcgU2lnbmFsaW5nIG9iamVjdC5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihzaWduYWxpbmcpIHtcbiAgICAgICAgdGhpcy5fc2lnbmFsaW5nID0gc2lnbmFsaW5nO1xuICAgICAgICB0aGlzLl9jcmVhdGVUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgfVxuICAgIHNldFN0YXRlVGltZW91dCh0aW1lb3V0TXMpIHtcbiAgICAgICAgc2V0VGltZW91dChoaXRjaCh0aGlzLCB0aGlzLl9vblRpbWVvdXRDaGVja2VkKSwgdGltZW91dE1zKTtcbiAgICB9XG4gICAgZ2V0IGlzQ3VycmVudFN0YXRlKCkge1xuICAgICAgICByZXR1cm4gdGhpcyA9PT0gdGhpcy5fc2lnbmFsaW5nLnN0YXRlO1xuICAgIH1cbiAgICBvbkVudGVyKCkge31cbiAgICBfb25UaW1lb3V0Q2hlY2tlZCgpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNDdXJyZW50U3RhdGUpIHtcbiAgICAgICAgICAgIHRoaXMub25UaW1lb3V0KCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgb25UaW1lb3V0KCkge1xuICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb24oKTtcbiAgICB9XG4gICAgdHJhbnNpdChuZXdTdGF0ZSkge1xuICAgICAgICB0aGlzLl9zaWduYWxpbmcudHJhbnNpdChuZXdTdGF0ZSk7XG4gICAgfVxuICAgIG9uRXhpdCgpIHt9XG4gICAgb25PcGVuKCkge1xuICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb24oJ29uT3BlbiBub3Qgc3VwcG9ydGVkIGJ5ICcgKyB0aGlzLm5hbWUpO1xuICAgIH1cbiAgICBvbkVycm9yKCkge1xuICAgICAgICB0aGlzLmNoYW5uZWxEb3duKCk7XG4gICAgfVxuICAgIG9uQ2xvc2UoKSB7XG4gICAgICAgIHRoaXMuY2hhbm5lbERvd24oKTtcbiAgICB9XG4gICAgY2hhbm5lbERvd24oKSB7XG4gICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbignY2hhbm5lbERvd24gbm90IHN1cHBvcnRlZCBieSAnICsgdGhpcy5uYW1lKTtcbiAgICB9XG4gICAgb25ScGNNc2cocnBjTXNnKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW51c2VkLXZhcnNcbiAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uKCdvblJwY01zZyBub3Qgc3VwcG9ydGVkIGJ5ICcgKyB0aGlzLm5hbWUpO1xuICAgIH1cbiAgICBpbnZpdGUoc2RwLCBpY2VDYW5kaWRhdGVzKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW51c2VkLXZhcnNcbiAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uKCdpbnZpdGUgbm90IHN1cHBvcnRlZCBieSAnICsgdGhpcy5uYW1lKTtcbiAgICB9XG4gICAgYWNjZXB0KCkge1xuICAgICAgICB0aHJvdyBuZXcgVW5zdXBwb3J0ZWRPcGVyYXRpb24oJ2FjY2VwdCBub3Qgc3VwcG9ydGVkIGJ5ICcgKyB0aGlzLm5hbWUpO1xuICAgIH1cbiAgICBoYW5ndXAoKSB7XG4gICAgICAgIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbignaGFuZ3VwIG5vdCBzdXBwb3J0ZWQgYnkgJyArIHRoaXMubmFtZSk7XG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gXCJTaWduYWxpbmdTdGF0ZVwiO1xuICAgIH1cbiAgICBnZXQgbG9nZ2VyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2lnbmFsaW5nLl9sb2dnZXI7XG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIEZhaWxPblRpbWVvdXRTdGF0ZSBleHRlbmRzIFNpZ25hbGluZ1N0YXRlIHtcbiAgICBjb25zdHJ1Y3RvcihzaWduYWxpbmcsIHRpbWVvdXRNcykge1xuICAgICAgICBzdXBlcihzaWduYWxpbmcpO1xuICAgICAgICB0aGlzLl90aW1lb3V0TXMgPSB0aW1lb3V0TXM7XG4gICAgfVxuICAgIG9uRW50ZXIoKSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGVUaW1lb3V0KHRoaXMuX3RpbWVvdXRNcyk7XG4gICAgfVxuICAgIG9uVGltZW91dCgpIHtcbiAgICAgICAgdGhpcy50cmFuc2l0KG5ldyBGYWlsZWRTdGF0ZSh0aGlzLl9zaWduYWxpbmcsIG5ldyBUaW1lb3V0KCkpKTtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiBcIkZhaWxPblRpbWVvdXRTdGF0ZVwiO1xuICAgIH1cbn1cbmV4cG9ydCBjbGFzcyBQZW5kaW5nQ29ubmVjdFN0YXRlIGV4dGVuZHMgRmFpbE9uVGltZW91dFN0YXRlIHtcbiAgICBjb25zdHJ1Y3RvcihzaWduYWxpbmcsIHRpbWVvdXRNcywgaW5pdGlhbFN0YXJ0VGltZUluLCByZXRyaWVzSW4pIHtcbiAgICAgICAgc3VwZXIoc2lnbmFsaW5nLCB0aW1lb3V0TXMpO1xuICAgICAgICB0aGlzLl9pbml0aWFsU3RhcnRUaW1lID0gaW5pdGlhbFN0YXJ0VGltZUluIHx8IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICB0aGlzLl9yZXRyaWVzID0gcmV0cmllc0luIHx8IDA7XG4gICAgfVxuICAgIG9uT3BlbigpIHtcbiAgICAgICAgdGhpcy50cmFuc2l0KG5ldyBQZW5kaW5nSW52aXRlU3RhdGUodGhpcy5fc2lnbmFsaW5nKSk7XG4gICAgfVxuICAgIGNoYW5uZWxEb3duKCkge1xuICAgICAgICB2YXIgbm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgIHZhciB1bnRpbFRpbWVvdXRNcyA9ICh0aGlzLl9pbml0aWFsU3RhcnRUaW1lICsgdGhpcy5fdGltZW91dE1zKSAtIG5vdztcbiAgICAgICAgaWYgKHVudGlsVGltZW91dE1zID4gMCAmJiArK3RoaXMuX3JldHJpZXMgPCBDT05ORUNUX01BWF9SRVRSSUVTKSB7XG4gICAgICAgICAgICB0aGlzLl9zaWduYWxpbmcuX2Nvbm5lY3QoKTtcbiAgICAgICAgICAgIHRoaXMudHJhbnNpdChuZXcgUGVuZGluZ0Nvbm5lY3RTdGF0ZSh0aGlzLl9zaWduYWxpbmcsIHVudGlsVGltZW91dE1zLCB0aGlzLl9pbml0aWFsU3RhcnRUaW1lLCB0aGlzLl9yZXRyaWVzKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnRyYW5zaXQobmV3IEZhaWxlZFN0YXRlKHRoaXMuX3NpZ25hbGluZywgbmV3IEVycm9yKCdjaGFubmVsRG93bicpKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiBcIlBlbmRpbmdDb25uZWN0U3RhdGVcIjtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgUGVuZGluZ0ludml0ZVN0YXRlIGV4dGVuZHMgU2lnbmFsaW5nU3RhdGUge1xuICAgIG9uRW50ZXIoKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgbmV3IFByb21pc2UoZnVuY3Rpb24gbm90aWZ5Q29ubmVjdGVkKHJlc29sdmUpIHtcbiAgICAgICAgICAgIHNlbGYuX3NpZ25hbGluZy5fY29ubmVjdGVkSGFuZGxlcigpO1xuICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgaW52aXRlKHNkcCwgaWNlQ2FuZGlkYXRlcykge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHZhciBpbnZpdGVJZCA9IHV1aWQoKTtcblxuICAgICAgICB2YXIgaW52aXRlUGFyYW1zID0ge1xuICAgICAgICAgICAgc2RwOiBzZHAsXG4gICAgICAgICAgICBjYW5kaWRhdGVzOiBpY2VDYW5kaWRhdGVzLFxuICAgICAgICAgICAgY2FsbENvbnRleHRUb2tlbiA6IHNlbGYuX3NpZ25hbGluZy5fY29udGFjdFRva2VuXG4gICAgICAgIH07XG4gICAgICAgIHNlbGYubG9nZ2VyLmxvZygnU2VuZGluZyBTRFAnLCBnZXRSZWRhY3RlZFNkcChzZHApKTtcbiAgICAgICAgc2VsZi5fc2lnbmFsaW5nLl93c3Muc2VuZChKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICBqc29ucnBjOiAnMi4wJyxcbiAgICAgICAgICAgIG1ldGhvZDogSU5WSVRFX01FVEhPRF9OQU1FLFxuICAgICAgICAgICAgcGFyYW1zOiBpbnZpdGVQYXJhbXMsXG4gICAgICAgICAgICBpZDogaW52aXRlSWRcbiAgICAgICAgfSkpO1xuICAgICAgICBzZWxmLnRyYW5zaXQobmV3IFBlbmRpbmdBbnN3ZXJTdGF0ZShzZWxmLl9zaWduYWxpbmcsIGludml0ZUlkKSk7XG4gICAgfVxuICAgIGNoYW5uZWxEb3duKCkge1xuICAgICAgICB0aGlzLnRyYW5zaXQobmV3IEZhaWxlZFN0YXRlKHRoaXMuX3NpZ25hbGluZykpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuIFwiUGVuZGluZ0ludml0ZVN0YXRlXCI7XG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIFBlbmRpbmdBbnN3ZXJTdGF0ZSBleHRlbmRzIEZhaWxPblRpbWVvdXRTdGF0ZSB7XG4gICAgY29uc3RydWN0b3Ioc2lnbmFsaW5nLCBpbnZpdGVJZCkge1xuICAgICAgICBzdXBlcihzaWduYWxpbmcsIE1BWF9JTlZJVEVfREVMQVlfTVMpO1xuICAgICAgICB0aGlzLl9pbnZpdGVJZCA9IGludml0ZUlkO1xuICAgIH1cbiAgICBvblJwY01zZyhtc2cpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICBpZiAobXNnLmlkID09PSB0aGlzLl9pbnZpdGVJZCkge1xuICAgICAgICAgICAgaWYgKG1zZy5lcnJvciB8fCAhbXNnLnJlc3VsdCkge1xuICAgICAgICAgICAgICAgIHRoaXMudHJhbnNpdChuZXcgRmFpbGVkU3RhdGUodGhpcy5fc2lnbmFsaW5nLCBzZWxmLnRyYW5zbGF0ZUludml0ZUVycm9yKG1zZykpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbmV3IFByb21pc2UoZnVuY3Rpb24gbm90aWZ5QW5zd2VyZWQocmVzb2x2ZSkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coJ1JlY2VpdmVkIFNEUCcsIGdldFJlZGFjdGVkU2RwKG1zZy5yZXN1bHQuc2RwKSk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuX3NpZ25hbGluZy5fYW5zd2VyZWRIYW5kbGVyKG1zZy5yZXN1bHQuc2RwLCBtc2cucmVzdWx0LmNhbmRpZGF0ZXMpO1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy50cmFuc2l0KG5ldyBQZW5kaW5nQWNjZXB0U3RhdGUodGhpcy5fc2lnbmFsaW5nLCB0aGlzLl9zaWduYWxpbmcuX2F1dG9BbnN3ZXIpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICB0cmFuc2xhdGVJbnZpdGVFcnJvcihtc2cpIHtcbiAgICAgICAgaWYgKG1zZy5lcnJvciAmJiBtc2cuZXJyb3IuY29kZSA9PSA0ODYpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQnVzeUV4Y2VwdGlvbihtc2cuZXJyb3IubWVzc2FnZSk7XG4gICAgICAgIH0gZWxzZSBpZiAobXNnLmVycm9yICYmIG1zZy5lcnJvci5jb2RlID09IDQwNCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBDYWxsTm90Rm91bmRFeGNlcHRpb24obXNnLmVycm9yLm1lc3NhZ2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBVbmtub3duU2lnbmFsaW5nRXJyb3IoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gXCJQZW5kaW5nQW5zd2VyU3RhdGVcIjtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgUGVuZGluZ0FjY2VwdFN0YXRlIGV4dGVuZHMgU2lnbmFsaW5nU3RhdGUge1xuICAgIGNvbnN0cnVjdG9yKHNpZ25hbGluZywgYXV0b0Fuc3dlcikge1xuICAgICAgICBzdXBlcihzaWduYWxpbmcpO1xuICAgICAgICB0aGlzLl9hdXRvQW5zd2VyID0gYXV0b0Fuc3dlcjtcbiAgICB9XG4gICAgb25FbnRlcigpIHtcbiAgICAgICAgaWYgKHRoaXMuX2F1dG9BbnN3ZXIpIHtcbiAgICAgICAgICAgIHRoaXMuYWNjZXB0KCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYWNjZXB0KCkge1xuICAgICAgICB0aGlzLnNlbmRBY2NlcHRSZXF1ZXN0KCk7XG4gICAgICAgIHRoaXMudHJhbnNpdChuZXcgVGFsa2luZ1N0YXRlKHRoaXMuX3NpZ25hbGluZykpO1xuICAgIH1cbiAgICBjaGFubmVsRG93bigpIHtcbiAgICAgICAgdGhpcy50cmFuc2l0KG5ldyBGYWlsZWRTdGF0ZSh0aGlzLl9zaWduYWxpbmcpKTtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiBcIlBlbmRpbmdBY2NlcHRTdGF0ZVwiO1xuICAgIH1cbiAgICBhc3luYyBzZW5kQWNjZXB0UmVxdWVzdCgpIHtcbiAgICAgICAgdmFyIGFjY2VwdElkID0gdXVpZCgpO1xuICAgICAgICB0aGlzLl9zaWduYWxpbmcuX3dzcy5zZW5kKEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgIGpzb25ycGM6ICcyLjAnLFxuICAgICAgICAgICAgbWV0aG9kOiBBQ0NFUFRfTUVUSE9EX05BTUUsXG4gICAgICAgICAgICBwYXJhbXM6IHt9LFxuICAgICAgICAgICAgaWQ6IGFjY2VwdElkXG4gICAgICAgIH0pKTtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgUGVuZGluZ0FjY2VwdEFja1N0YXRlIGV4dGVuZHMgRmFpbE9uVGltZW91dFN0YXRlIHtcbiAgICBjb25zdHJ1Y3RvcihzaWduYWxpbmcsIGFjY2VwdElkKSB7XG4gICAgICAgIHN1cGVyKHNpZ25hbGluZywgTUFYX0FDQ0VQVF9CWUVfREVMQVlfTVMpO1xuICAgICAgICB0aGlzLl9hY2NlcHRJZCA9IGFjY2VwdElkO1xuICAgIH1cbiAgICBvblJwY01zZyhtc2cpIHtcbiAgICAgICAgaWYgKG1zZy5pZCA9PT0gdGhpcy5fYWNjZXB0SWQpIHtcbiAgICAgICAgICAgIGlmIChtc2cuZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zaXQobmV3IEZhaWxlZFN0YXRlKHRoaXMuX3NpZ25hbGluZykpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zaWduYWxpbmcuX2NsaWVudFRva2VuID0gbXNnLnJlc3VsdC5jbGllbnRUb2tlbjtcbiAgICAgICAgICAgICAgICB0aGlzLnRyYW5zaXQobmV3IFRhbGtpbmdTdGF0ZSh0aGlzLl9zaWduYWxpbmcpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuIFwiUGVuZGluZ0FjY2VwdEFja1N0YXRlXCI7XG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIFRhbGtpbmdTdGF0ZSBleHRlbmRzIFNpZ25hbGluZ1N0YXRlIHtcbiAgICBvbkVudGVyKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIG5ldyBQcm9taXNlKGZ1bmN0aW9uIG5vdGlmeUhhbmRzaGFrZWQocmVzb2x2ZSkge1xuICAgICAgICAgICAgc2VsZi5fc2lnbmFsaW5nLl9oYW5kc2hha2VkSGFuZGxlcigpO1xuICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgaGFuZ3VwKCkge1xuICAgICAgICB2YXIgYnllSWQgPSB1dWlkKCk7XG4gICAgICAgIHRoaXMuX3NpZ25hbGluZy5fd3NzLnNlbmQoSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAganNvbnJwYzogJzIuMCcsXG4gICAgICAgICAgICBtZXRob2Q6IEJZRV9NRVRIT0RfTkFNRSxcbiAgICAgICAgICAgIHBhcmFtczoge2NhbGxDb250ZXh0VG9rZW46IHRoaXMuX3NpZ25hbGluZy5fY29udGFjdFRva2VufSxcbiAgICAgICAgICAgIGlkOiBieWVJZFxuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMudHJhbnNpdChuZXcgUGVuZGluZ1JlbW90ZUhhbmd1cFN0YXRlKHRoaXMuX3NpZ25hbGluZywgYnllSWQpKTtcbiAgICB9XG4gICAgb25ScGNNc2cobXNnKSB7XG4gICAgICAgIGlmIChtc2cubWV0aG9kID09PSBCWUVfTUVUSE9EX05BTUUpIHtcbiAgICAgICAgICAgIHRoaXMudHJhbnNpdChuZXcgUGVuZGluZ0xvY2FsSGFuZ3VwU3RhdGUodGhpcy5fc2lnbmFsaW5nLCBtc2cuaWQpKTtcbiAgICAgICAgfSBlbHNlIGlmIChtc2cubWV0aG9kID09PSAncmVuZXdDbGllbnRUb2tlbicpIHtcbiAgICAgICAgICAgIHRoaXMuX3NpZ25hbGluZy5fY2xpZW50VG9rZW4gPSBtc2cucGFyYW1zLmNsaWVudFRva2VuO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNoYW5uZWxEb3duKCkge1xuICAgICAgICB0aGlzLl9zaWduYWxpbmcuX3JlY29ubmVjdCgpO1xuICAgICAgICB0aGlzLl9zaWduYWxpbmcudHJhbnNpdChuZXcgUGVuZGluZ1JlY29ubmVjdFN0YXRlKHRoaXMuX3NpZ25hbGluZykpO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuIFwiVGFsa2luZ1N0YXRlXCI7XG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIFBlbmRpbmdSZWNvbm5lY3RTdGF0ZSBleHRlbmRzIEZhaWxPblRpbWVvdXRTdGF0ZSB7XG4gICAgY29uc3RydWN0b3Ioc2lnbmFsaW5nKSB7XG4gICAgICAgIHN1cGVyKHNpZ25hbGluZywgREVGQVVMVF9DT05ORUNUX1RJTUVPVVRfTVMpO1xuICAgIH1cbiAgICBvbk9wZW4oKSB7XG4gICAgICAgIHRoaXMudHJhbnNpdChuZXcgVGFsa2luZ1N0YXRlKHRoaXMuX3NpZ25hbGluZykpO1xuICAgIH1cbiAgICBjaGFubmVsRG93bigpIHtcbiAgICAgICAgdGhpcy50cmFuc2l0KG5ldyBGYWlsZWRTdGF0ZSh0aGlzLl9zaWduYWxpbmcpKTtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiBcIlBlbmRpbmdSZWNvbm5lY3RTdGF0ZVwiO1xuICAgIH1cbn1cbmV4cG9ydCBjbGFzcyBQZW5kaW5nUmVtb3RlSGFuZ3VwU3RhdGUgZXh0ZW5kcyBGYWlsT25UaW1lb3V0U3RhdGUge1xuICAgIGNvbnN0cnVjdG9yKHNpZ25hbGluZywgYnllSWQpIHtcbiAgICAgICAgc3VwZXIoc2lnbmFsaW5nLCBNQVhfQUNDRVBUX0JZRV9ERUxBWV9NUyk7XG4gICAgICAgIHRoaXMuX2J5ZUlkID0gYnllSWQ7XG4gICAgfVxuICAgIG9uUnBjTXNnKG1zZykge1xuICAgICAgICBpZiAobXNnLmlkID09PSB0aGlzLl9ieWVJZCB8fCBtc2cubWV0aG9kID09PSBCWUVfTUVUSE9EX05BTUUpIHtcbiAgICAgICAgICAgIHRoaXMudHJhbnNpdChuZXcgRGlzY29ubmVjdGVkU3RhdGUodGhpcy5fc2lnbmFsaW5nKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiBcIlBlbmRpbmdSZW1vdGVIYW5ndXBTdGF0ZVwiO1xuICAgIH1cbn1cbmV4cG9ydCBjbGFzcyBQZW5kaW5nTG9jYWxIYW5ndXBTdGF0ZSBleHRlbmRzIFNpZ25hbGluZ1N0YXRlIHtcbiAgICBjb25zdHJ1Y3RvcihzaWduYWxpbmcsIGJ5ZUlkKSB7XG4gICAgICAgIHN1cGVyKHNpZ25hbGluZyk7XG4gICAgICAgIHRoaXMuX2J5ZUlkID0gYnllSWQ7XG4gICAgfVxuICAgIG9uRW50ZXIoKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgbmV3IFByb21pc2UoZnVuY3Rpb24gbm90aWZ5UmVtb3RlSHVuZ3VwKHJlc29sdmUpIHtcbiAgICAgICAgICAgIHNlbGYuX3NpZ25hbGluZy5fcmVtb3RlSHVuZ3VwSGFuZGxlcigpO1xuICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgaGFuZ3VwKCkge1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHNlbGYuX3NpZ25hbGluZy5fd3NzLnNlbmQoSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAganNvbnJwYzogJzIuMCcsXG4gICAgICAgICAgICByZXN1bHQ6IHt9LFxuICAgICAgICAgICAgaWQ6IHNlbGYuX2J5ZUlkXG4gICAgICAgIH0pKTtcbiAgICAgICAgc2VsZi50cmFuc2l0KG5ldyBEaXNjb25uZWN0ZWRTdGF0ZShzZWxmLl9zaWduYWxpbmcpKTtcbiAgICB9XG4gICAgb25ScGNNc2coKSB7XG4gICAgICAgIC8vRG8gbm90aGluZ1xuICAgIH1cbiAgICBjaGFubmVsRG93bigpIHtcbiAgICAgICAgdGhpcy50cmFuc2l0KG5ldyBEaXNjb25uZWN0ZWRTdGF0ZSh0aGlzLl9zaWduYWxpbmcpKTtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiBcIlBlbmRpbmdMb2NhbEhhbmd1cFN0YXRlXCI7XG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIERpc2Nvbm5lY3RlZFN0YXRlIGV4dGVuZHMgU2lnbmFsaW5nU3RhdGUge1xuICAgIG9uRW50ZXIoKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgbmV3IFByb21pc2UoZnVuY3Rpb24gbm90aWZ5RGlzY29ubmVjdGVkKHJlc29sdmUpIHtcbiAgICAgICAgICAgIHNlbGYuX3NpZ25hbGluZy5fZGlzY29ubmVjdGVkSGFuZGxlcigpO1xuICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5fc2lnbmFsaW5nLl93c3MuY2xvc2UoKTtcbiAgICB9XG4gICAgY2hhbm5lbERvd24oKSB7XG4gICAgICAgIC8vRG8gbm90aGluZ1xuICAgIH1cbiAgICBvblJwY01zZygpIHtcbiAgICAgICAgLy9EbyBub3RoaW5nXG4gICAgfVxuICAgIGdldCBuYW1lKCkge1xuICAgICAgICByZXR1cm4gXCJEaXNjb25uZWN0ZWRTdGF0ZVwiO1xuICAgIH1cbn1cbmV4cG9ydCBjbGFzcyBGYWlsZWRTdGF0ZSBleHRlbmRzIFNpZ25hbGluZ1N0YXRlIHtcbiAgICBjb25zdHJ1Y3RvcihzaWduYWxpbmcsIGV4Y2VwdGlvbikge1xuICAgICAgICBzdXBlcihzaWduYWxpbmcpO1xuICAgICAgICB0aGlzLl9leGNlcHRpb24gPSBleGNlcHRpb247XG4gICAgfVxuICAgIG9uRW50ZXIoKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgbmV3IFByb21pc2UoZnVuY3Rpb24gbm90aWZ5RmFpbGVkKHJlc29sdmUpIHtcbiAgICAgICAgICAgIHNlbGYuX3NpZ25hbGluZy5fZmFpbGVkSGFuZGxlcihzZWxmLl9leGNlcHRpb24pO1xuICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5fc2lnbmFsaW5nLl93c3MuY2xvc2UoKTtcbiAgICB9XG4gICAgY2hhbm5lbERvd24oKSB7XG4gICAgICAgIC8vRG8gbm90aGluZ1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuIFwiRmFpbGVkU3RhdGVcIjtcbiAgICB9XG4gICAgZ2V0IGV4Y2VwdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2V4Y2VwdGlvbjtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFtem5SdGNTaWduYWxpbmcge1xuICAgIGNvbnN0cnVjdG9yKGNhbGxJZCwgc2lnbmFsaW5nVXJpLCBjb250YWN0VG9rZW4sIGxvZ2dlciwgY29ubmVjdFRpbWVvdXRNcywgY29ubmVjdGlvbklkLCB3c3NNYW5hZ2VyKSB7XG4gICAgICAgIHRoaXMuX2NhbGxJZCA9IGNhbGxJZDtcbiAgICAgICAgdGhpcy5fY29ubmVjdFRpbWVvdXRNcyA9IGNvbm5lY3RUaW1lb3V0TXMgfHwgREVGQVVMVF9DT05ORUNUX1RJTUVPVVRfTVM7XG4gICAgICAgIHRoaXMuX2F1dG9BbnN3ZXIgPSB0cnVlO1xuICAgICAgICB0aGlzLl9zaWduYWxpbmdVcmkgPSBzaWduYWxpbmdVcmk7XG4gICAgICAgIHRoaXMuX2NvbnRhY3RUb2tlbiA9IGNvbnRhY3RUb2tlbjtcbiAgICAgICAgdGhpcy5fbG9nZ2VyID0gd3JhcExvZ2dlcihsb2dnZXIsIGNhbGxJZCwgJ1NJR05BTElORycpO1xuICAgICAgICB0aGlzLl9jb25uZWN0aW9uSWQgPSBjb25uZWN0aW9uSWQ7XG4gICAgICAgIHRoaXMuX3dzc01hbmFnZXIgPSB3c3NNYW5hZ2VyO1xuXG4gICAgICAgIC8vZW1wdHkgZXZlbnQgaGFuZGxlcnNcbiAgICAgICAgdGhpcy5fY29ubmVjdGVkSGFuZGxlciA9XG4gICAgICAgIHRoaXMuX2Fuc3dlcmVkSGFuZGxlciA9XG4gICAgICAgIHRoaXMuX2hhbmRzaGFrZWRIYW5kbGVyID1cbiAgICAgICAgdGhpcy5fcmVjb25uZWN0ZWRIYW5kbGVyID1cbiAgICAgICAgdGhpcy5fcmVtb3RlSHVuZ3VwSGFuZGxlciA9XG4gICAgICAgIHRoaXMuX2Rpc2Nvbm5lY3RlZEhhbmRsZXIgPVxuICAgICAgICB0aGlzLl9mYWlsZWRIYW5kbGVyID0gZnVuY3Rpb24gbm9PcCgpIHt9O1xuICAgIH1cbiAgICBnZXQgY2FsbElkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY2FsbElkO1xuICAgIH1cbiAgICBzZXQgb25Db25uZWN0ZWQoY29ubmVjdGVkSGFuZGxlcikge1xuICAgICAgICB0aGlzLl9jb25uZWN0ZWRIYW5kbGVyID0gY29ubmVjdGVkSGFuZGxlcjtcbiAgICB9XG4gICAgc2V0IG9uQW5zd2VyZWQoYW5zd2VyZWRIYW5kbGVyKSB7XG4gICAgICAgIHRoaXMuX2Fuc3dlcmVkSGFuZGxlciA9IGFuc3dlcmVkSGFuZGxlcjtcbiAgICB9XG4gICAgc2V0IG9uSGFuZHNoYWtlZChoYW5kc2hha2VkSGFuZGxlcikge1xuICAgICAgICB0aGlzLl9oYW5kc2hha2VkSGFuZGxlciA9IGhhbmRzaGFrZWRIYW5kbGVyO1xuICAgIH1cbiAgICBzZXQgb25SZWNvbm5lY3RlZChyZWNvbm5lY3RlZEhhbmRsZXIpIHtcbiAgICAgICAgdGhpcy5fcmVjb25uZWN0ZWRIYW5kbGVyID0gcmVjb25uZWN0ZWRIYW5kbGVyO1xuICAgIH1cbiAgICBzZXQgb25SZW1vdGVIdW5ndXAocmVtb3RlSHVuZ3VwSGFuZGxlcikge1xuICAgICAgICB0aGlzLl9yZW1vdGVIdW5ndXBIYW5kbGVyID0gcmVtb3RlSHVuZ3VwSGFuZGxlcjtcbiAgICB9XG4gICAgc2V0IG9uRGlzY29ubmVjdGVkKGRpc2Nvbm5lY3RlZEhhbmRsZXIpIHtcbiAgICAgICAgdGhpcy5fZGlzY29ubmVjdGVkSGFuZGxlciA9IGRpc2Nvbm5lY3RlZEhhbmRsZXI7XG4gICAgfVxuICAgIHNldCBvbkZhaWxlZChmYWlsZWRIYW5kbGVyKSB7XG4gICAgICAgIHRoaXMuX2ZhaWxlZEhhbmRsZXIgPSBmYWlsZWRIYW5kbGVyO1xuICAgIH1cbiAgICBnZXQgc3RhdGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zdGF0ZTtcbiAgICB9XG5cbiAgICBjb25uZWN0KCkge1xuICAgICAgICB0aGlzLl9jb25uZWN0KCk7XG4gICAgICAgIHRoaXMudHJhbnNpdChuZXcgUGVuZGluZ0Nvbm5lY3RTdGF0ZSh0aGlzLCB0aGlzLl9jb25uZWN0VGltZW91dE1zKSk7XG4gICAgfVxuXG4gICAgX2Nvbm5lY3QoKSB7XG4gICAgICAgIHRoaXMuX3dzcyA9IHRoaXMuX2Nvbm5lY3RXZWJTb2NrZXQodGhpcy5fYnVpbGRJbnZpdGVVcmkoKSk7XG4gICAgfVxuICAgIHRyYW5zaXQobmV4dFN0YXRlKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB0aGlzLl9sb2dnZXIuaW5mbygodGhpcy5fc3RhdGUgPyB0aGlzLl9zdGF0ZS5uYW1lIDogJ251bGwnKSArICcgPT4gJyArIG5leHRTdGF0ZS5uYW1lKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnN0YXRlICYmIHRoaXMuc3RhdGUub25FeGl0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGF0ZS5vbkV4aXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlID0gbmV4dFN0YXRlO1xuICAgICAgICAgICAgaWYgKHRoaXMuX3N0YXRlLm9uRW50ZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zdGF0ZS5vbkVudGVyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgX2Nvbm5lY3RXZWJTb2NrZXQodXJpKSB7XG4gICAgICAgIGxldCB3c0Nvbm5lY3Rpb247XG4gICAgICAgIGlmICh0aGlzLl93c3NNYW5hZ2VyKSB7XG4gICAgICAgICAgICB3c0Nvbm5lY3Rpb24gPSBuZXcgVmlydHVhbFdzc0Nvbm5lY3Rpb25NYW5hZ2VyKHRoaXMuX2xvZ2dlciwgdGhpcy5fY29ubmVjdGlvbklkLCB0aGlzLl93c3NNYW5hZ2VyKTtcbiAgICAgICAgfWVsc2Uge1xuICAgICAgICAgICAgd3NDb25uZWN0aW9uID0gbmV3IFdlYlNvY2tldCh1cmkpO1xuICAgICAgICB9XG4gICAgICAgIHdzQ29ubmVjdGlvbi5vbm9wZW4gPSBoaXRjaCh0aGlzLCB0aGlzLl9vbk9wZW4pO1xuICAgICAgICB3c0Nvbm5lY3Rpb24ub25tZXNzYWdlID0gaGl0Y2godGhpcywgdGhpcy5fb25NZXNzYWdlKTtcbiAgICAgICAgd3NDb25uZWN0aW9uLm9uZXJyb3IgPSBoaXRjaCh0aGlzLCB0aGlzLl9vbkVycm9yKTtcbiAgICAgICAgd3NDb25uZWN0aW9uLm9uY2xvc2UgPSBoaXRjaCh0aGlzLCB0aGlzLl9vbkNsb3NlKTtcbiAgICAgICAgcmV0dXJuIHdzQ29ubmVjdGlvbjtcbiAgICB9XG4gICAgX2J1aWxkSW52aXRlVXJpKCkge1xuICAgICAgICBpZiAodGhpcy5fY29udGFjdFRva2VuKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fYnVpbGRVcmlCYXNlKCkgKyAnJmNvbnRhY3RDdHg9JyArIGVuY29kZVVSSUNvbXBvbmVudCh0aGlzLl9jb250YWN0VG9rZW4pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2J1aWxkVXJpQmFzZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIF9idWlsZFJlY29ubmVjdFVyaSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2J1aWxkVXJpQmFzZSgpICsgJyZjbGllbnRUb2tlbj0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuX2NsaWVudFRva2VuKTtcbiAgICB9XG4gICAgX2J1aWxkVXJpQmFzZSgpIHtcbiAgICAgICAgdmFyIHNlcGFyYXRvciA9ICc/JztcbiAgICAgICAgaWYgKHRoaXMuX3NpZ25hbGluZ1VyaS5pbmRleE9mKHNlcGFyYXRvcikgPiAtMSkge1xuICAgICAgICAgICAgc2VwYXJhdG9yID0gJyYnO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9zaWduYWxpbmdVcmkgKyBzZXBhcmF0b3IgKyAnY2FsbElkPScgKyBlbmNvZGVVUklDb21wb25lbnQodGhpcy5fY2FsbElkKTtcbiAgICB9XG4gICAgX29uTWVzc2FnZShldnQpIHtcbiAgICAgICAgdGhpcy5zdGF0ZS5vblJwY01zZyhKU09OLnBhcnNlKGV2dC5kYXRhKSk7XG4gICAgfVxuICAgIF9vbk9wZW4oZXZ0KSB7XG4gICAgICAgIHRoaXMuc3RhdGUub25PcGVuKGV2dCk7XG4gICAgfVxuICAgIF9vbkVycm9yKGV2dCkge1xuICAgICAgICB0aGlzLnN0YXRlLm9uRXJyb3IoZXZ0KTtcbiAgICB9XG4gICAgX29uQ2xvc2UoZXZ0KSB7XG4gICAgICAgIHRoaXMuX2xvZ2dlci5sb2coJ1dlYlNvY2tldCBvbmNsb3NlIGNvZGU9JyArIGV2dC5jb2RlICsgJywgcmVhc29uPScgKyBldnQucmVhc29uKTtcbiAgICAgICAgdGhpcy5zdGF0ZS5vbkNsb3NlKGV2dCk7XG4gICAgfVxuICAgIF9yZWNvbm5lY3QoKSB7XG4gICAgICAgIHRoaXMuX3dzcyA9IHRoaXMuX2Nvbm5lY3RXZWJTb2NrZXQodGhpcy5fYnVpbGRSZWNvbm5lY3RVcmkoKSk7XG4gICAgfVxuICAgIGludml0ZShzZHAsIGljZUNhbmRpZGF0ZXMpIHtcbiAgICAgICAgdGhpcy5zdGF0ZS5pbnZpdGUoc2RwLCBpY2VDYW5kaWRhdGVzKTtcbiAgICB9XG4gICAgYWNjZXB0KCkge1xuICAgICAgICB0aGlzLnN0YXRlLmFjY2VwdCgpO1xuICAgIH1cbiAgICBoYW5ndXAoKSB7XG4gICAgICAgIHRoaXMuc3RhdGUuaGFuZ3VwKCk7XG4gICAgfVxufSIsIlxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ0NQSW5pdGlhdGlvblN0cmF0ZWd5SW50ZXJmYWNlIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJDQ1BJbml0aWF0aW9uU3RyYXRlZ3lJbnRlcmZhY2UgaW5pdGlhbGl6ZWRcIik7XG4gICAgfVxuXG4gICAgZ2V0TmFtZSgpe31cblxuICAgIC8vIHRoZSBmb2xsb3dpbmcgZnVuY3Rpb25zIGFyZSBydGNfcGVlcl9jb25uZWN0aW9uX2ZhY3RvcnkgcmVsYXRlZCBmdW5jdGlvbnNcbiAgICAvLyBjaGVjayBpZiB0aGUgYnJvd3NlciBzdXBwb3J0cyBlYXJseSBtZWRpYSBjb25uZWN0aW9uXG4gICAgX2lzQnJvd3NlclN1cHBvcnRlZCgpe31cblxuICAgIF9jcmVhdGVSdGNQZWVyQ29ubmVjdGlvbigpIHt9XG5cbiAgICAvLyB0aGUgZm9sbG93aW5nIGZ1bmN0aW9ucyBhcmUgcnRjX3Nlc3Npb24gcmVsYXRlZCBmdW5jdGlvbnNcbiAgICBfZ3VNKCkge31cblxuICAgIGNyZWF0ZU9mZmVyU3RhdGVPbkVudGVyKCkge1xuXG4gICAgfVxuXG4gICAgYWNjZXB0U3RhdGVPbkVudGVyKCkge31cblxuICAgIG9uSWNlU3RhdGVDaGFuZ2UoKSB7fVxuXG4gICAgb25QZWVyQ29ubmVjdGlvblN0YXRlQ2hhbmdlKCkge31cblxuICAgIF9jcmVhdGVQZWVyQ29ubmVjdGlvbigpIHt9XG5cbiAgICBjb25uZWN0KCkge31cblxuICAgIF9vbnRyYWNrKCkge31cblxuICAgIF9idWlsZE1lZGlhQ29uc3RyYWludHMoKSB7fVxufVxuIiwiaW1wb3J0IENDUEluaXRpYXRpb25TdHJhdGVneUludGVyZmFjZSBmcm9tIFwiLi9DQ1BJbml0aWF0aW9uU3RyYXRlZ3lJbnRlcmZhY2VcIjtcbmltcG9ydCB7aGl0Y2gsIGlzQ2l0cml4V2ViUlRDU3VwcG9ydGVkfSBmcm9tIFwiLi4vdXRpbHNcIjtcbmltcG9ydCB7RmFpbGVkU3RhdGV9IGZyb20gXCIuLi9ydGNfc2Vzc2lvblwiO1xuaW1wb3J0IHtSVENfRVJST1JTfSBmcm9tIFwiLi4vcnRjX2NvbnN0XCI7XG5pbXBvcnQgXCJAY2l0cml4L3Vjc2RrL0NpdHJpeFdlYlJUQ1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDaXRyaXhWRElTdHJhdGVneSBleHRlbmRzIENDUEluaXRpYXRpb25TdHJhdGVneUludGVyZmFjZSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIGlmICghaXNDaXRyaXhXZWJSVENTdXBwb3J0ZWQoKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDaXRyaXggV2ViUlRDIHJlZGlyZWN0aW9uIGZlYXR1cmUgaXMgTk9UIHN1cHBvcnRlZCEnKTtcbiAgICAgICAgfVxuICAgICAgICB3aW5kb3cuZ2V0Q2l0cml4V2VicnRjUmVkaXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlZ2lzdHJ5VmFsdWUgPSBQcm9taXNlLnJlc29sdmUoMSk7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgLy9yZXRyaWV2ZSByZWdpc3RyeSB2YWx1ZSBpbnRlcm5hbGx5XG4gICAgICAgICAgICAgICAgcmVnaXN0cnlWYWx1ZS50aGVuKCh2KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUodik7IH0pLmNhdGNoKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KCk7IH0pXG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICAgIHdpbmRvdy5DaXRyaXhXZWJSVEMuaW5pdExvZyhnbG9iYWwuY29ubmVjdC5nZXRMb2coKSk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiQ2l0cml4VkRJU3RyYXRlZ3kgaW5pdGlhbGl6ZWRcIik7XG4gICAgfVxuXG4gICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbnMgYXJlIHJ0Y19wZWVyX2Nvbm5lY3Rpb25fZmFjdG9yeSByZWxhdGVkIGZ1bmN0aW9uc1xuICAgIC8vIGNoZWNrIGlmIHRoZSBicm93c2VyIHN1cHBvcnRzIGVhcmx5IG1lZGlhIGNvbm5lY3Rpb25cbiAgICBfaXNCcm93c2VyU3VwcG9ydGVkKCl7XG4gICAgICAgIC8vIENpdHJpeCBXZWJSVEMgU0RLIGRvZXNuJ3Qgc3VwcG9ydCBlYXJseSBtZWRpYSBjb25uZWN0aW9uXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBfY3JlYXRlUnRjUGVlckNvbm5lY3Rpb24ocnRjUGVlckNvbm5lY3Rpb25Db25maWcsIHJ0Y1BlZXJDb25uZWN0aW9uT3B0aW9uYWxDb25maWcpIHtcbiAgICAgICAgcmV0dXJuIG5ldyB3aW5kb3cuQ2l0cml4V2ViUlRDLkNpdHJpeFBlZXJDb25uZWN0aW9uKHJ0Y1BlZXJDb25uZWN0aW9uQ29uZmlnLCBydGNQZWVyQ29ubmVjdGlvbk9wdGlvbmFsQ29uZmlnKTtcbiAgICB9XG5cbiAgICAvLyB0aGUgZm9sbG93aW5nIGZ1bmN0aW9ucyBhcmUgcnRjX3Nlc3Npb24gcmVsYXRlZCBmdW5jdGlvbnNcbiAgICBfZ1VNKGNvbnN0cmFpbnRzKSB7XG4gICAgICAgIHJldHVybiB3aW5kb3cuQ2l0cml4V2ViUlRDLmdldFVzZXJNZWRpYShjb25zdHJhaW50cyk7XG4gICAgfVxuXG4gICAgY3JlYXRlT2ZmZXJTdGF0ZU9uRW50ZXIoX3BjLCBzdHJlYW0pIHtcbiAgICAgICAgc3RyZWFtLmdldFRyYWNrcygpLmZvckVhY2godHJhY2sgPT4ge1xuICAgICAgICAgICAgX3BjLmFkZFRyYW5zY2VpdmVyKHRyYWNrLCB7fSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGFjY2VwdFN0YXRlT25FbnRlcihzZWxmLCBydGNTZXNzaW9uKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBDb25uZWN0UlRDIC0gcnRjX3Nlc3Npb24gLSBBY2NlcHRTdGF0ZSAtIHJ0Y1Nlc3Npb24uX3BjLnNldFJlbW90ZURlc2NyaXB0aW9uYCk7XG5cbiAgICAgICAgY29uc3QgYW5zd2VyU2Vzc2lvbkRlc2NyaXB0aW9uID0gc2VsZi5fY3JlYXRlU2Vzc2lvbkRlc2NyaXB0aW9uKHsgdHlwZTogJ2Fuc3dlcicsIHNkcDogc2VsZi5fc2RwIH0pO1xuICAgICAgICBjb25zb2xlLmxvZyhgQ29ubmVjdFJUQyAtIHJ0Y19zZXNzaW9uIC0gQWNjZXB0U3RhdGUgLSBhbnN3ZXJTZXNzaW9uRGVzY3JpcHRpb246IGAsIGFuc3dlclNlc3Npb25EZXNjcmlwdGlvbik7XG5cbiAgICAgICAgcnRjU2Vzc2lvbi5fcGMuc2V0UmVtb3RlRGVzY3JpcHRpb24oYW5zd2VyU2Vzc2lvbkRlc2NyaXB0aW9uLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgQ29ubmVjdFJUQyAtIHJ0Y19zZXNzaW9uIC0gQWNjZXB0U3RhdGUgLSBydGNTZXNzaW9uLl9wYy5zZXRSZW1vdGVEZXNjcmlwdGlvbiAtIHN1Y2Nlc3NgKTtcbiAgICAgICAgICAgIHZhciByZW1vdGVDYW5kaWRhdGVQcm9taXNlcyA9IFByb21pc2UuYWxsKHNlbGYuX2NhbmRpZGF0ZXMubWFwKGZ1bmN0aW9uIChjYW5kaWRhdGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmVtb3RlQ2FuZGlkYXRlID0gc2VsZi5fY3JlYXRlUmVtb3RlQ2FuZGlkYXRlKGNhbmRpZGF0ZSk7XG4gICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbygnQWRkaW5nIHJlbW90ZSBjYW5kaWRhdGUnLCByZW1vdGVDYW5kaWRhdGUpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGBDb25uZWN0UlRDIC0gcnRjX3Nlc3Npb24gLSBBY2NlcHRTdGF0ZSAtIHJ0Y1Nlc3Npb24uX3BjLnNldFJlbW90ZURlc2NyaXB0aW9uIC0gQWRkaW5nIHJlbW90ZSBjYW5kaWRhdGUgLSByZW1vdGVDYW5kaWRhdGVgLCByZW1vdGVDYW5kaWRhdGUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBydGNTZXNzaW9uLl9wYy5hZGRJY2VDYW5kaWRhdGUocmVtb3RlQ2FuZGlkYXRlKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIHJlbW90ZUNhbmRpZGF0ZVByb21pc2VzLmNhdGNoKHJlYXNvbiA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYENvbm5lY3RSVEMgLSBydGNfc2Vzc2lvbiAtIEFjY2VwdFN0YXRlIC0gcnRjU2Vzc2lvbi5fcGMuc2V0UmVtb3RlRGVzY3JpcHRpb24gLSBBZGRpbmcgcmVtb3RlIGNhbmRpZGF0ZSAtIGZhaWxlZGAsIHJlYXNvbik7XG4gICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIud2FybignRXJyb3IgYWRkaW5nIHJlbW90ZSBjYW5kaWRhdGUnLCByZWFzb24pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBydGNTZXNzaW9uLl9zZXNzaW9uUmVwb3J0LnNldFJlbW90ZURlc2NyaXB0aW9uRmFpbHVyZSA9IGZhbHNlO1xuICAgICAgICAgICAgc2VsZi5fcmVtb3RlRGVzY3JpcHRpb25TZXQgPSB0cnVlO1xuICAgICAgICAgICAgc2VsZi5fY2hlY2tBbmRUcmFuc2l0KCk7XG4gICAgICAgIH0sIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihgQ29ubmVjdFJUQyAtIHJ0Y19zZXNzaW9uIC0gQWNjZXB0U3RhdGUgLSBzZXRSZW1vdGVEZXNjcmlwdGlvbiAtIGVycm9yOmAsIGVycm9yKTtcbiAgICAgICAgICAgIHJ0Y1Nlc3Npb24uX3N0b3BTZXNzaW9uKCk7XG4gICAgICAgICAgICBydGNTZXNzaW9uLl9zZXNzaW9uUmVwb3J0LnNldFJlbW90ZURlc2NyaXB0aW9uRmFpbHVyZSA9IHRydWU7XG4gICAgICAgICAgICBzZWxmLnRyYW5zaXQobmV3IEZhaWxlZFN0YXRlKHJ0Y1Nlc3Npb24sIFJUQ19FUlJPUlMuU0VUX1JFTU9URV9ERVNDUklQVElPTl9GQUlMVVJFKSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIG9uSWNlU3RhdGVDaGFuZ2UoZXZ0LCBfcGMpIHtcbiAgICAgICAgcmV0dXJuIF9wYy5pY2VDb25uZWN0aW9uU3RhdGU7XG4gICAgfVxuXG4gICAgb25QZWVyQ29ubmVjdGlvblN0YXRlQ2hhbmdlKF9wYykge1xuICAgICAgICByZXR1cm4gX3BjLmNvbm5lY3Rpb25TdGF0ZV87XG4gICAgfVxuXG4gICAgX2NyZWF0ZVBlZXJDb25uZWN0aW9uKGNvbmZpZ3VyYXRpb24sIG9wdGlvbmFsQ29uZmlndXJhdGlvbikge1xuICAgICAgICByZXR1cm4gbmV3IHdpbmRvdy5DaXRyaXhXZWJSVEMuQ2l0cml4UGVlckNvbm5lY3Rpb24oY29uZmlndXJhdGlvbiwgb3B0aW9uYWxDb25maWd1cmF0aW9uKTtcbiAgICB9XG5cbiAgICBjb25uZWN0KHNlbGYpIHtcbiAgICAgICAgc2VsZi5fcGMub25hZGRzdHJlYW0gPSBoaXRjaChzZWxmLCBzZWxmLl9vbnRyYWNrKTtcbiAgICB9XG5cbiAgICBfb250cmFjayhzZWxmLCBldnQpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ0Nvbm5lY3RSVEMgLSBydGNfc2Vzc2lvbiAtIFJ0Y1Nlc3Npb24gLSBfb25hZGRzdHJlYW06JywgZXZ0KTtcblxuICAgICAgICBjb25zdCByZW1vdGVTdHJlYW0gPSBldnQuc3RyZWFtLmNsb25lKCk7XG5cbiAgICAgICAgY29uc3QgYXVkaW9UcmFja3MgPSBldnQuc3RyZWFtLmdldEF1ZGlvVHJhY2tzKCk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdDb25uZWN0UlRDIC0gcnRjX3Nlc3Npb24gLSBSdGNTZXNzaW9uIC0gX29uYWRkc3RyZWFtIC0gYXVkaW9UcmFja3M6JywgYXVkaW9UcmFja3MpO1xuXG4gICAgICAgIGlmIChhdWRpb1RyYWNrcyAhPT0gdW5kZWZpbmVkICYmIGF1ZGlvVHJhY2tzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQ29ubmVjdFJUQyAtIHJ0Y19zZXNzaW9uIC0gUnRjU2Vzc2lvbiAtIF9vbmFkZHN0cmVhbSAtIHJlbW90ZVN0cmVhbSBcIiArIHJlbW90ZVN0cmVhbSk7XG4gICAgICAgICAgICBzZWxmLl9yZW1vdGVBdWRpb1N0cmVhbSA9IHJlbW90ZVN0cmVhbTtcbiAgICAgICAgICAgIHNlbGYuX3JlbW90ZUF1ZGlvRWxlbWVudC5zcmNPYmplY3QgPSByZW1vdGVTdHJlYW07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfYnVpbGRNZWRpYUNvbnN0cmFpbnRzKHNlbGYsIG1lZGlhQ29uc3RyYWludHMpIHtcbiAgICAgICAgaWYgKHNlbGYuX2VuYWJsZUF1ZGlvKSB7XG4gICAgICAgICAgICB2YXIgYXVkaW9Db25zdHJhaW50cyA9IHt9O1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBzZWxmLl9lY2hvQ2FuY2VsbGF0aW9uICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIGF1ZGlvQ29uc3RyYWludHMuZWNob0NhbmNlbGxhdGlvbiA9ICEhc2VsZi5fZWNob0NhbmNlbGxhdGlvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQ29ubmVjdFJUQyAtIEdVTSAtIGJ1aWxkTWVkaWFDb25zdHJhaW50cyAtIHdpbmRvdy5hdWRpb19pbnB1dDogXCIgKyB3aW5kb3cuYXVkaW9faW5wdXQpO1xuICAgICAgICAgICAgaWYgKHdpbmRvdy5hdWRpb19pbnB1dCkge1xuICAgICAgICAgICAgICAgIGF1ZGlvQ29uc3RyYWludHMuZGV2aWNlSWQgPSB3aW5kb3cuYXVkaW9faW5wdXQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoYXVkaW9Db25zdHJhaW50cykubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIG1lZGlhQ29uc3RyYWludHMuYXVkaW8gPSBhdWRpb0NvbnN0cmFpbnRzO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBtZWRpYUNvbnN0cmFpbnRzLmF1ZGlvID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG1lZGlhQ29uc3RyYWludHMuYXVkaW8gPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdldE5hbWUoKSB7XG4gICAgICAgIHJldHVybiAnQ2l0cml4VkRJU3RyYXRlZ3knO1xuICAgIH1cbn0iLCJpbXBvcnQgQ0NQSW5pdGlhdGlvblN0cmF0ZWd5SW50ZXJmYWNlIGZyb20gXCIuL0NDUEluaXRpYXRpb25TdHJhdGVneUludGVyZmFjZVwiO1xuaW1wb3J0IHtDSFJPTUVfU1VQUE9SVEVEX1ZFUlNJT04sIFJUQ19FUlJPUlN9IGZyb20gXCIuLi9ydGNfY29uc3RcIjtcbmltcG9ydCB7Z2V0Q2hyb21lQnJvd3NlclZlcnNpb24sIGhpdGNoLCBpc0Nocm9tZUJyb3dzZXJ9IGZyb20gXCIuLi91dGlsc1wiO1xuaW1wb3J0IHtGYWlsZWRTdGF0ZX0gZnJvbSBcIi4uL3J0Y19zZXNzaW9uXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFN0YW5kYXJkU3RyYXRlZ3kgZXh0ZW5kcyBDQ1BJbml0aWF0aW9uU3RyYXRlZ3lJbnRlcmZhY2Uge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICBjb25zb2xlLmxvZyhcIlN0YW5kYXJkU3RyYXRlZ3kgaW5pdGlhbGl6ZWRcIik7XG4gICAgfVxuXG4gICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbnMgYXJlIHJ0Y19wZWVyX2Nvbm5lY3Rpb25fZmFjdG9yeSByZWxhdGVkIGZ1bmN0aW9uc1xuICAgIC8vIGNoZWNrIGlmIHRoZSBicm93c2VyIHN1cHBvcnRzIGVhcmx5IG1lZGlhIGNvbm5lY3Rpb25cbiAgICBfaXNCcm93c2VyU3VwcG9ydGVkKCl7XG4gICAgICAgIHJldHVybiBpc0Nocm9tZUJyb3dzZXIoKSAmJiBnZXRDaHJvbWVCcm93c2VyVmVyc2lvbigpID49IENIUk9NRV9TVVBQT1JURURfVkVSU0lPTjtcbiAgICB9XG5cbiAgICBfY3JlYXRlUnRjUGVlckNvbm5lY3Rpb24ocnRjUGVlckNvbm5lY3Rpb25Db25maWcsIHJ0Y1BlZXJDb25uZWN0aW9uT3B0aW9uYWxDb25maWcpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSVENQZWVyQ29ubmVjdGlvbihydGNQZWVyQ29ubmVjdGlvbkNvbmZpZywgcnRjUGVlckNvbm5lY3Rpb25PcHRpb25hbENvbmZpZyk7XG4gICAgfVxuXG4gICAgLy8gdGhlIGZvbGxvd2luZyBmdW5jdGlvbnMgYXJlIHJ0Y19zZXNzaW9uIHJlbGF0ZWQgZnVuY3Rpb25zXG4gICAgX2dVTShjb25zdHJhaW50cykge1xuICAgICAgICByZXR1cm4gbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoY29uc3RyYWludHMpO1xuICAgIH1cblxuICAgIGNyZWF0ZU9mZmVyU3RhdGVPbkVudGVyKF9wYywgc3RyZWFtKSB7XG4gICAgICAgIF9wYy5hZGRTdHJlYW0oc3RyZWFtKTtcbiAgICB9XG5cbiAgICBhY2NlcHRTdGF0ZU9uRW50ZXIoc2VsZiwgcnRjU2Vzc2lvbikge1xuICAgICAgICB2YXIgc2V0UmVtb3RlRGVzY3JpcHRpb25Qcm9taXNlID0gcnRjU2Vzc2lvbi5fcGMuc2V0UmVtb3RlRGVzY3JpcHRpb24oc2VsZi5fY3JlYXRlU2Vzc2lvbkRlc2NyaXB0aW9uKHtcbiAgICAgICAgICAgIHR5cGU6ICdhbnN3ZXInLFxuICAgICAgICAgICAgc2RwOiBzZWxmLl9zZHBcbiAgICAgICAgfSkpO1xuICAgICAgICBzZXRSZW1vdGVEZXNjcmlwdGlvblByb21pc2UuY2F0Y2goZSA9PiB7XG4gICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcignU2V0UmVtb3RlRGVzY3JpcHRpb24gZmFpbGVkJywgZSk7XG4gICAgICAgIH0pO1xuICAgICAgICBzZXRSZW1vdGVEZXNjcmlwdGlvblByb21pc2UudGhlbigoKSA9PiB7XG4gICAgICAgICAgICB2YXIgcmVtb3RlQ2FuZGlkYXRlUHJvbWlzZXMgPSBQcm9taXNlLmFsbChzZWxmLl9jYW5kaWRhdGVzLm1hcChmdW5jdGlvbiAoY2FuZGlkYXRlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlbW90ZUNhbmRpZGF0ZSA9IHNlbGYuX2NyZWF0ZVJlbW90ZUNhbmRpZGF0ZShjYW5kaWRhdGUpO1xuICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmluZm8oJ0FkZGluZyByZW1vdGUgY2FuZGlkYXRlJywgcmVtb3RlQ2FuZGlkYXRlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcnRjU2Vzc2lvbi5fcGMuYWRkSWNlQ2FuZGlkYXRlKHJlbW90ZUNhbmRpZGF0ZSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICByZW1vdGVDYW5kaWRhdGVQcm9taXNlcy5jYXRjaChyZWFzb24gPT4ge1xuICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLndhcm4oJ0Vycm9yIGFkZGluZyByZW1vdGUgY2FuZGlkYXRlJywgcmVhc29uKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHJlbW90ZUNhbmRpZGF0ZVByb21pc2VzO1xuICAgICAgICB9KS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHJ0Y1Nlc3Npb24uX3Nlc3Npb25SZXBvcnQuc2V0UmVtb3RlRGVzY3JpcHRpb25GYWlsdXJlID0gZmFsc2U7XG4gICAgICAgICAgICBzZWxmLl9yZW1vdGVEZXNjcmlwdGlvblNldCA9IHRydWU7XG4gICAgICAgICAgICBzZWxmLl9jaGVja0FuZFRyYW5zaXQoKTtcbiAgICAgICAgfSkuY2F0Y2goKCkgPT4ge1xuICAgICAgICAgICAgcnRjU2Vzc2lvbi5fc3RvcFNlc3Npb24oKTtcbiAgICAgICAgICAgIHJ0Y1Nlc3Npb24uX3Nlc3Npb25SZXBvcnQuc2V0UmVtb3RlRGVzY3JpcHRpb25GYWlsdXJlID0gdHJ1ZTtcbiAgICAgICAgICAgIHNlbGYudHJhbnNpdChuZXcgRmFpbGVkU3RhdGUocnRjU2Vzc2lvbiwgUlRDX0VSUk9SUy5TRVRfUkVNT1RFX0RFU0NSSVBUSU9OX0ZBSUxVUkUpKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgb25JY2VTdGF0ZUNoYW5nZShldnQsIF9wYykgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXVudXNlZC12YXJzXG4gICAgICAgIHJldHVybiBldnQuY3VycmVudFRhcmdldC5pY2VDb25uZWN0aW9uU3RhdGU7XG4gICAgfVxuXG4gICAgb25QZWVyQ29ubmVjdGlvblN0YXRlQ2hhbmdlKF9wYykge1xuICAgICAgICByZXR1cm4gX3BjLmNvbm5lY3Rpb25TdGF0ZTtcbiAgICB9XG5cbiAgICBfY3JlYXRlUGVlckNvbm5lY3Rpb24oY29uZmlndXJhdGlvbiwgb3B0aW9uYWxDb25maWd1cmF0aW9uKSB7XG4gICAgICAgIHJldHVybiBuZXcgUlRDUGVlckNvbm5lY3Rpb24oY29uZmlndXJhdGlvbiwgb3B0aW9uYWxDb25maWd1cmF0aW9uKTtcbiAgICB9XG5cbiAgICBjb25uZWN0KHNlbGYpIHtcbiAgICAgICAgc2VsZi5fcGMub250cmFjayA9IGhpdGNoKHNlbGYsIHNlbGYuX29udHJhY2spO1xuICAgIH1cblxuICAgIF9vbnRyYWNrKHNlbGYsIGV2dCkge1xuICAgICAgICBpZiAoZXZ0LnN0cmVhbXMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgc2VsZi5fbG9nZ2VyLndhcm4oJ0ZvdW5kIG1vcmUgdGhhbiAxIHN0cmVhbXMgZm9yICcgKyBldnQudHJhY2sua2luZCArICcgdHJhY2sgJyArIGV2dC50cmFjay5pZCArICcgOiAnICtcbiAgICAgICAgICAgICAgICBldnQuc3RyZWFtcy5tYXAoc3RyZWFtID0+IHN0cmVhbS5pZCkuam9pbignLCcpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZXZ0LnRyYWNrLmtpbmQgPT09ICd2aWRlbycgJiYgc2VsZi5fcmVtb3RlVmlkZW9FbGVtZW50KSB7XG4gICAgICAgICAgICBzZWxmLl9yZW1vdGVWaWRlb0VsZW1lbnQuc3JjT2JqZWN0ID0gZXZ0LnN0cmVhbXNbMF07XG4gICAgICAgICAgICBzZWxmLl9yZW1vdGVWaWRlb1N0cmVhbSA9IGV2dC5zdHJlYW1zWzBdO1xuICAgICAgICB9IGVsc2UgaWYgKGV2dC50cmFjay5raW5kID09PSAnYXVkaW8nICYmIHNlbGYuX3JlbW90ZUF1ZGlvRWxlbWVudCkge1xuICAgICAgICAgICAgc2VsZi5fcmVtb3RlQXVkaW9FbGVtZW50LnNyY09iamVjdCA9IGV2dC5zdHJlYW1zWzBdO1xuICAgICAgICAgICAgc2VsZi5fcmVtb3RlQXVkaW9TdHJlYW0gPSBldnQuc3RyZWFtc1swXTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIF9idWlsZE1lZGlhQ29uc3RyYWludHMoc2VsZiwgbWVkaWFDb25zdHJhaW50cykge1xuICAgICAgICBpZiAoc2VsZi5fZW5hYmxlQXVkaW8pIHtcbiAgICAgICAgICAgIHZhciBhdWRpb0NvbnN0cmFpbnRzID0ge307XG4gICAgICAgICAgICBpZiAodHlwZW9mIHNlbGYuX2VjaG9DYW5jZWxsYXRpb24gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgYXVkaW9Db25zdHJhaW50cy5lY2hvQ2FuY2VsbGF0aW9uID0gISFzZWxmLl9lY2hvQ2FuY2VsbGF0aW9uO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKGF1ZGlvQ29uc3RyYWludHMpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBtZWRpYUNvbnN0cmFpbnRzLmF1ZGlvID0gYXVkaW9Db25zdHJhaW50cztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbWVkaWFDb25zdHJhaW50cy5hdWRpbyA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBtZWRpYUNvbnN0cmFpbnRzLmF1ZGlvID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXROYW1lKCkge1xuICAgICAgICByZXR1cm4gJ1N0YW5kYXJkU3RyYXRlZ3knO1xuICAgIH1cbn0iLCIvKipcbiAqIENvcHlyaWdodCAyMDE3IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG5pbXBvcnQge0lsbGVnYWxQYXJhbWV0ZXJzfSBmcm9tICcuL2V4Y2VwdGlvbnMnO1xuaW1wb3J0IHtnZXRLaW5kLCBwYXJzZVJ0cE1hcCwgcGFyc2VSdHBQYXJhbWV0ZXJzLCBzcGxpdExpbmVzLCBzcGxpdFNlY3Rpb25zLCB3cml0ZUZtdHB9IGZyb20gJ3NkcCc7XG5cbi8qKlxuICogQWxsIGxvZ2dpbmcgbWV0aG9kcyB1c2VkIGJ5IGNvbm5lY3QtcnRjLlxuICovXG52YXIgbG9nTWV0aG9kcyA9IFsnbG9nJywgJ2luZm8nLCAnd2FybicsICdlcnJvciddO1xuXG4vKipcbiAqIEJpbmRzIHRoZSBnaXZlbiBpbnN0YW5jZSBvYmplY3QgYXMgdGhlIGNvbnRleHQgZm9yXG4gKiB0aGUgbWV0aG9kIHByb3ZpZGVkLlxuICpcbiAqIEBwYXJhbSBzY29wZSBUaGUgaW5zdGFuY2Ugb2JqZWN0IHRvIGJlIHNldCBhcyB0aGUgc2NvcGVcbiAqICAgIG9mIHRoZSBmdW5jdGlvbi5cbiAqIEBwYXJhbSBtZXRob2QgVGhlIG1ldGhvZCB0byBiZSBlbmNhcHN1bGF0ZWQuXG4gKlxuICogQWxsIG90aGVyIGFyZ3VtZW50cywgaWYgYW55LCBhcmUgYm91bmQgdG8gdGhlIG1ldGhvZFxuICogaW52b2NhdGlvbiBpbnNpZGUgdGhlIGNsb3N1cmUuXG4gKlxuICogQHJldHVybiBBIGNsb3N1cmUgZW5jYXBzdWxhdGluZyB0aGUgaW52b2NhdGlvbiBvZiB0aGVcbiAqICAgIG1ldGhvZCBwcm92aWRlZCBpbiBjb250ZXh0IG9mIHRoZSBnaXZlbiBpbnN0YW5jZS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGhpdGNoKCkge1xuICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcbiAgICB2YXIgc2NvcGUgPSBhcmdzLnNoaWZ0KCk7XG4gICAgdmFyIG1ldGhvZCA9IGFyZ3Muc2hpZnQoKTtcblxuICAgIGlmICghc2NvcGUpIHtcbiAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxQYXJhbWV0ZXJzKCd1dGlscy5oaXRjaCgpOiBzY29wZSBpcyByZXF1aXJlZCEnKTtcbiAgICB9XG5cbiAgICBpZiAoIW1ldGhvZCkge1xuICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFBhcmFtZXRlcnMoJ3V0aWxzLmhpdGNoKCk6IG1ldGhvZCBpcyByZXF1aXJlZCEnKTtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIG1ldGhvZCAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFBhcmFtZXRlcnMoJ3V0aWxzLmhpdGNoKCk6IG1ldGhvZCBpcyBub3QgYSBmdW5jdGlvbiEnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZnVuY3Rpb24gX2hpdGNoZWRGdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGNsb3N1cmVBcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcbiAgICAgICAgcmV0dXJuIG1ldGhvZC5hcHBseShzY29wZSwgYXJncy5jb25jYXQoY2xvc3VyZUFyZ3MpKTtcbiAgICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gd3JhcExvZ2dlcihsb2dnZXIsIGNhbGxJZCwgbG9nQ2F0ZWdvcnkpIHtcbiAgICB2YXIgX2xvZ2dlciA9IHt9O1xuICAgIGxvZ01ldGhvZHMuZm9yRWFjaChmdW5jdGlvbiAobG9nTWV0aG9kKSB7XG4gICAgICAgIGlmICghbG9nZ2VyW2xvZ01ldGhvZF0pIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTG9nZ2luZyBtZXRob2QgJyArIGxvZ01ldGhvZCArICcgcmVxdWlyZWQnKTtcbiAgICAgICAgfVxuICAgICAgICBfbG9nZ2VyW2xvZ01ldGhvZF0gPSBoaXRjaChsb2dnZXIsIGxvZ2dlcltsb2dNZXRob2RdLCBjYWxsSWQsIGxvZ0NhdGVnb3J5KTtcbiAgICB9KTtcbiAgICByZXR1cm4gX2xvZ2dlcjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNsb3NlU3RyZWFtKHN0cmVhbSkge1xuICAgIGlmIChzdHJlYW0pIHtcbiAgICAgICAgdmFyIHRyYWNrcyA9IHN0cmVhbS5nZXRUcmFja3MoKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0cmFja3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciB0cmFjayA9IHRyYWNrc1tpXTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdHJhY2suc3RvcCgpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIC8vIGVhdCBleGNlcHRpb25cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBBIHBhcmFtZXRlciBvZiB0cmFuc2Zvcm1TZHAuXG4gKiBUaGlzIGRlZmluZXMgYWxsIHRoZSBTRFAgb3B0aW9ucyBjb25uZWN0LXJ0Yy1qcyBzdXBwb3J0cy5cbiAqL1xuZXhwb3J0IGNsYXNzIFNkcE9wdGlvbnMge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLl9mb3JjZUNvZGVjID0ge307XG4gICAgfVxuXG4gICAgZ2V0IGVuYWJsZU9wdXNEdHgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVPcHVzRHR4O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEJ5IGRlZmF1bHQgdHJhbnNmb3JtU2RwIGRpc2FibGVzIGR0eCBmb3IgT1BVUyBjb2RlYy5cbiAgICAgKiBTZXR0aW5nIHRoaXMgdG8gdHJ1ZSB3b3VsZCBmb3JjZSBpdCB0byB0dXJuIG9uIERUWC5cbiAgICAgKi9cbiAgICBzZXQgZW5hYmxlT3B1c0R0eChmbGFnKSB7XG4gICAgICAgIHRoaXMuX2VuYWJsZU9wdXNEdHggPSBmbGFnO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEEgbWFwIGZyb20gbWVkaWEgdHlwZSAoYXVkaW8vdmlkZW8pIHRvIGNvZGVjIChjYXNlIGluc2Vuc2l0aXZlKS5cbiAgICAgKiBBZGQgZW50cnkgZm9yIGZvcmNlIGNvbm5lY3QtcnRjLWpzIHRvIHVzZSBzcGVjaWZpZWQgY29kZWMgZm9yIGNlcnRhaW4gbWVkaWEgdHlwZS5cbiAgICAgKiBGb3IgZXhhbXBsZTogc2RwT3B0aW9ucy5mb3JjZUNvZGVjWydhdWRpbyddID0gJ29wdXMnO1xuICAgICAqL1xuICAgIGdldCBmb3JjZUNvZGVjKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZm9yY2VDb2RlYztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBUZXN0IGlmIGdpdmVuIGNvZGVjIHNob3VsZCBiZSByZW1vdmVkIGZyb20gU0RQLlxuICAgICAqIEBwYXJhbSBtZWRpYVR5cGUgYXVkaW98dmlkZW9cbiAgICAgKiBAcGFyYW0gY29kZWNOYW1lIGNhc2UgaW5zZW5zaXRpdmVcbiAgICAgKiBAcmV0dXJuIFRSVUUgLSBzaG91bGQgcmVtb3ZlXG4gICAgICovXG4gICAgX3Nob3VsZERlbGV0ZUNvZGVjKG1lZGlhVHlwZSwgY29kZWNOYW1lKSB7XG4gICAgICAgIHZhciB1cHBlckNhc2VDb2RlY05hbWUgPSBjb2RlY05hbWUudG9VcHBlckNhc2UoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ZvcmNlQ29kZWNbbWVkaWFUeXBlXSAmJiB1cHBlckNhc2VDb2RlY05hbWUgIT09IHRoaXMuX2ZvcmNlQ29kZWNbbWVkaWFUeXBlXS50b1VwcGVyQ2FzZSgpICYmIHVwcGVyQ2FzZUNvZGVjTmFtZSAhPT0gJ1RFTEVQSE9ORS1FVkVOVCc7XG4gICAgfVxufVxuXG4vKipcbiAqIE1vZGlmaWVzIGlucHV0IFNEUCBhY2NvcmRpbmcgdG8gc2RwT3B0aW9ucy5cbiAqIFNlZSBTZHBPcHRpb25zIGZvciBhdmFpbGFibGUgb3B0aW9ucy5cbiAqIEBwYXJhbSBzZHAgb3JpZ2luYWwgU0RQXG4gKiBAcGFyYW0gc2RwT3B0aW9ucyBkZWZpbmVzIGNoYW5nZXMgdG8gYmUgYXBwbGllZCB0byBTRFBcbiAqIEByZXR1cm5zIGEgbWFwIHdpdGggJ3NkcCcgY29udGFpbmluZyB0aGUgdHJhbnNmb3JtZWQgU0RQIGFuZCAnbUxpbmVzJyBjb250YWluaW5nIHRoZSBudW1iZXIgb2YgbSBsaW5lcyBpbiBTRFBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHRyYW5zZm9ybVNkcChzZHAsIHNkcE9wdGlvbnMpIHtcbiAgICB2YXIgc2VjdGlvbnMgPSBzcGxpdFNlY3Rpb25zKHNkcCk7XG4gICAgZm9yICh2YXIgaSA9IDE7IGkgPCBzZWN0aW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgbWVkaWFUeXBlID0gZ2V0S2luZChzZWN0aW9uc1tpXSk7XG4gICAgICAgIHZhciBydHBQYXJhbXMgPSBwYXJzZVJ0cFBhcmFtZXRlcnMoc2VjdGlvbnNbaV0pO1xuICAgICAgICAvLyBhIG1hcCBmcm9tIHBheWxvYWQgdHlwZSAoc3RyaW5nKSB0byBjb2RlYyBvYmplY3RcbiAgICAgICAgdmFyIGNvZGVjTWFwID0gcnRwUGFyYW1zLmNvZGVjcy5yZWR1Y2UoKG1hcCwgY29kZWMpID0+IHtcbiAgICAgICAgICAgIG1hcFsnJyArIGNvZGVjLnBheWxvYWRUeXBlXSA9IGNvZGVjO1xuICAgICAgICAgICAgcmV0dXJuIG1hcDtcbiAgICAgICAgfSwge30pO1xuICAgICAgICBzZWN0aW9uc1tpXSA9IHNwbGl0TGluZXMoc2VjdGlvbnNbaV0pLm1hcChsaW5lID0+IHtcbiAgICAgICAgICAgIGlmIChsaW5lLnN0YXJ0c1dpdGgoJ209JykpIHtcbiAgICAgICAgICAgICAgICAvLyBtb2RpZnkgbT0gbGluZSBpZiBTZHBPcHRpb25zI2ZvcmNlQ29kZWMgc3BlY2lmaWVzIGNvZGVjIGZvciBjdXJyZW50IG1lZGlhIHR5cGVcbiAgICAgICAgICAgICAgICBpZiAoc2RwT3B0aW9ucy5mb3JjZUNvZGVjW21lZGlhVHlwZV0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRhcmdldENvZGVjUHRzID0gT2JqZWN0LmtleXMoY29kZWNNYXApLmZpbHRlcihwdCA9PiAhc2RwT3B0aW9ucy5fc2hvdWxkRGVsZXRlQ29kZWMobWVkaWFUeXBlLCBjb2RlY01hcFtwdF0ubmFtZSkpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gLy4qUlRQXFwvUz9BVlBGPyAvLmV4ZWMobGluZSkgKyB0YXJnZXRDb2RlY1B0cy5qb2luKCcgJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxpbmU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChsaW5lLnN0YXJ0c1dpdGgoJ2E9cnRwbWFwOicpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJ0cE1hcCA9IHBhcnNlUnRwTWFwKGxpbmUpO1xuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50Q29kZWMgPSBjb2RlY01hcFtydHBNYXAucGF5bG9hZFR5cGVdO1xuXG4gICAgICAgICAgICAgICAgLy8gcmVtb3ZlIHRoaXMgY29kZWMgaWYgU2RwT3B0aW9ucyNmb3JjZUNvZGVjIHNwZWNpZmllcyBhIGRpZmZlcmVudCBjb2RlYyBmb3IgY3VycmVudCBtZWRpYSB0eXBlXG4gICAgICAgICAgICAgICAgaWYgKGlzX2RlZmluZWQoY3VycmVudENvZGVjKSAmJiBzZHBPcHRpb25zLl9zaG91bGREZWxldGVDb2RlYyhtZWRpYVR5cGUsIGN1cnJlbnRDb2RlYy5uYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBhcHBlbmQgYT1mbXRwIGxpbmUgaW1tZWRpYXRlbHkgaWYgY3VycmVudCBjb2RlYyBpcyBPUFVTICh0byBleHBsaWNpdGx5IHNwZWNpZnkgT1BVUyBwYXJhbWV0ZXJzKVxuICAgICAgICAgICAgICAgIGlmIChpc19kZWZpbmVkKGN1cnJlbnRDb2RlYykgJiYgY3VycmVudENvZGVjLm5hbWUudG9VcHBlckNhc2UoKSA9PT0gJ09QVVMnKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRDb2RlYy5wYXJhbWV0ZXJzLnVzZWR0eCA9IHNkcE9wdGlvbnMuZW5hYmxlT3B1c0R0eCA/IFwiMVwiIDogXCIwXCI7XG4gICAgICAgICAgICAgICAgICAgIC8vIGdlbmVyYXRlIGZtdHAgbGluZSBpbW1lZGlhdGVseSBhZnRlciBydHBtYXAgbGluZSwgYW5kIHJlbW92ZSBvcmlnaW5hbCBmbXRwIGxpbmUgb25jZSB3ZSBzZWUgaXRcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChsaW5lICsgXCJcXHJcXG5cIiArIHdyaXRlRm10cChjdXJyZW50Q29kZWMpKS50cmltKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxpbmU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChsaW5lLnN0YXJ0c1dpdGgoJ2E9Zm10cDonKSkge1xuICAgICAgICAgICAgICAgIHZhciBwdCA9IGxpbmUuc3Vic3RyaW5nKCdhPWZtdHA6Jy5sZW5ndGgsIGxpbmUuaW5kZXhPZignICcpKTtcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudENvZGVjID0gY29kZWNNYXBbcHRdOy8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcmVkZWNsYXJlXG5cbiAgICAgICAgICAgICAgICAvLyByZW1vdmUgdGhpcyBjb2RlYyBpZiBTZHBPcHRpb25zI2ZvcmNlQ29kZWMgc3BlY2lmaWVzIGEgZGlmZmVyZW50IGNvZGVjIGZvciBjdXJyZW50IG1lZGlhIHR5cGVcbiAgICAgICAgICAgICAgICBpZiAoaXNfZGVmaW5lZChjdXJyZW50Q29kZWMpICYmIHNkcE9wdGlvbnMuX3Nob3VsZERlbGV0ZUNvZGVjKG1lZGlhVHlwZSwgY3VycmVudENvZGVjLm5hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChpc19kZWZpbmVkKGN1cnJlbnRDb2RlYykgJiYgY3VycmVudENvZGVjLm5hbWUudG9VcHBlckNhc2UoKSA9PT0gJ09QVVMnKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgaXMgYSBsaW5lIGZvciBPUFVTLCByZW1vdmUgaXQgYmVjYXVzZSBGTVRQIGxpbmUgaXMgYWxyZWFkeSBnZW5lcmF0ZWQgd2hlbiBydHBtYXAgbGluZSBpcyBwcm9jZXNzZWRcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxpbmU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChsaW5lLnN0YXJ0c1dpdGgoJ2E9cnRjcC1mYjonKSkge1xuICAgICAgICAgICAgICAgIHZhciBwdCA9IGxpbmUuc3Vic3RyaW5nKGxpbmUuaW5kZXhPZignOicpICsgMSwgbGluZS5pbmRleE9mKCcgJykpOy8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcmVkZWNsYXJlXG4gICAgICAgICAgICAgICAgaWYgKHB0ID09PSAnKicpIHsgLy9hbHdheXMgYWxsb3cgd2lsZGNhcmQgaW4gcnRjLWZiXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBsaW5lO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50Q29kZWMgPSBjb2RlY01hcFtwdF07Ly8gZXNsaW50LWRpc2FibGUtbGluZSBuby1yZWRlY2xhcmVcblxuICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmUgdGhpcyBjb2RlYyBpZiBTZHBPcHRpb25zI2ZvcmNlQ29kZWMgc3BlY2lmaWVzIGEgZGlmZmVyZW50IGNvZGVjIGZvciBjdXJyZW50IG1lZGlhIHR5cGVcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzX2RlZmluZWQoY3VycmVudENvZGVjKSAmJiBzZHBPcHRpb25zLl9zaG91bGREZWxldGVDb2RlYyhtZWRpYVR5cGUsIGN1cnJlbnRDb2RlYy5uYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbGluZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxpbmU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLmZpbHRlcihsaW5lID0+IGxpbmUgIT09IG51bGwpLmpvaW4oJ1xcclxcbicpO1xuXG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIHNkcDogc2VjdGlvbnMubWFwKHNlY3Rpb24gPT4gc2VjdGlvbi50cmltKCkpLmpvaW4oJ1xcclxcbicpICsgJ1xcclxcbicsXG4gICAgICAgIG1MaW5lczogc2VjdGlvbnMubGVuZ3RoIC0gMSAvLyBmaXJzdCBzZWN0aW9uIGlzIHNlc3Npb24gZGVzY3JpcHRpb24sIHRoZSByZXN0IGFyZSBtZWRpYSBkZXNjcmlwdGlvbnNcbiAgICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNfZGVmaW5lZCh2KSB7XG4gICAgcmV0dXJuIHR5cGVvZiB2ICE9PSAndW5kZWZpbmVkJztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHdoZW5fZGVmaW5lZCh2LCBhbHRlcm5hdGl2ZUluKSB7XG4gICAgdmFyIGFsdGVybmF0aXZlID0gaXNfZGVmaW5lZChhbHRlcm5hdGl2ZUluKSA/IGFsdGVybmF0aXZlSW4gOiBudWxsO1xuICAgIHJldHVybiBpc19kZWZpbmVkKHYpID8gdiA6IGFsdGVybmF0aXZlO1xufVxuXG4vKipcbiAqIENoZWNrIGlmIHRoZSBnZXRTdGF0cyBBUEkgZm9yIHJldHJpZXZpbmcgbGVnYWN5IHN0YXRzIHJlcG9ydCBpcyBzdXBwb3J0ZWRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzTGVnYWN5U3RhdHNSZXBvcnRTdXBwb3J0ZWQocGMpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSkge1xuICAgICAgICBwYy5nZXRTdGF0cyhmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XG4gICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy8gRXhjZXB0aW9uIHRocm93biBpZiBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgbGVnYWN5IHN0YXRzIHJlcG9ydFxuICAgICAgICAgICAgcmVzb2x2ZShmYWxzZSk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuXG4vKipcbiAqIERldGVybWluZSBpZiB0aGUgZ2l2ZW4gdmFsdWUgaXMgYSBjYWxsYWJsZSBmdW5jdGlvbiB0eXBlLlxuICogQm9ycm93ZWQgZnJvbSBVbmRlcnNjb3JlLmpzLlxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNGdW5jdGlvbihvYmopIHtcbiAgICByZXR1cm4gISEob2JqICYmIG9iai5jb25zdHJ1Y3RvciAmJiBvYmouY2FsbCAmJiBvYmouYXBwbHkpO1xufVxuXG4vKipcbiAqIEFzc2VydHMgdGhhdCBhIHByZW1pc2UgaXMgdHJ1ZS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFzc2VydFRydWUocHJlbWlzZSwgbWVzc2FnZSkge1xuICAgIGlmICghcHJlbWlzZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7XG4gICAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNDaHJvbWVCcm93c2VyKCl7XG4gICAgcmV0dXJuIG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIkNocm9tZVwiKSAhPT0gLTE7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDaHJvbWVCcm93c2VyVmVyc2lvbigpe1xuICAgIHZhciB1c2VyQWdlbnQgPSBuYXZpZ2F0b3IudXNlckFnZW50O1xuICAgIHZhciBjaHJvbWVWZXJzaW9uID0gdXNlckFnZW50LnN1YnN0cmluZyh1c2VyQWdlbnQuaW5kZXhPZihcIkNocm9tZVwiKSs3KTtcbiAgICBpZiAoY2hyb21lVmVyc2lvbikge1xuICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChjaHJvbWVWZXJzaW9uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gLTE7XG4gICAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNDaXRyaXhXZWJSVENTdXBwb3J0ZWQoKSB7XG4gICAgcmV0dXJuIHdpbmRvdy5DaXRyaXhXZWJSVEMuaXNGZWF0dXJlT24oXCJ3ZWJydGMxLjBcIik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRSZWRhY3RlZFNkcChzZHApIHtcbiAgICAvLyBwYXR0ZXJuIHRvIGZpbmQgYW5kIHJlZGFjdCB0aGUgdmFsdWUgYWZ0ZXIgJ2E9aWNlLXB3ZDonXG4gICAgdmFyIHBhdHRlcm4gPSAvYT1pY2UtcHdkOlteXFxyXFxuXSovO1xuXG4gICAgLy8gVXNlIHRoZSByZXBsYWNlIG1ldGhvZCB0byByZWRhY3QgdGhlIHZhbHVlIHdpdGggJ1tyZWRhY3RlZF0nXG4gICAgcmV0dXJuIHNkcC5yZXBsYWNlKHBhdHRlcm4sICdhPWljZS1wd2Q6W3JlZGFjdGVkXScpO1xufVxuIiwiaW1wb3J0IHtoaXRjaH0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQge1NPRlRQSE9ORV9ST1VURV9LRVl9IGZyb20gJy4vcnRjX2NvbnN0J1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBWaXJ0dWFsV3NzQ29ubmVjdGlvbk1hbmFnZXIge1xuICAgIGNvbnN0cnVjdG9yKGxvZ2dlciwgY29ubmVjdGlvbklkLCB3c3NNYW5hZ2VyKSB7XG4gICAgICAgIHRoaXMuX2xvZ2dlciA9IGxvZ2dlcjtcbiAgICAgICAgdGhpcy5fY29ubmVjdGlvbklkID0gY29ubmVjdGlvbklkO1xuICAgICAgICB0aGlzLl93c3NNYW5hZ2VyID0gd3NzTWFuYWdlclxuICAgICAgICB0aGlzLl9pbml0aWFsaXplV2ViU29ja2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICB9XG5cbiAgICBfaW5pdGlhbGl6ZVdlYlNvY2tldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgICAgICB0aGlzLl93c3NNYW5hZ2VyLnN1YnNjcmliZVRvcGljcyhbU09GVFBIT05FX1JPVVRFX0tFWV0pO1xuICAgICAgICB0aGlzLl91blN1YnNjcmliZSA9IHRoaXMuX3dzc01hbmFnZXIub25NZXNzYWdlKFNPRlRQSE9ORV9ST1VURV9LRVksIGhpdGNoKHRoaXMsIHRoaXMuX3dlYlNvY2tldE1hbmFnZXJPbk1lc3NhZ2UpKTtcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLl9vbk9wZW4oKTtcbiAgICAgICAgfSwgMCk7XG4gICAgfVxuXG4gICAgX3dlYlNvY2tldE1hbmFnZXJPbk1lc3NhZ2UoZXZlbnQpIHtcbiAgICAgICAgbGV0IGNvbnRlbnQ7XG4gICAgICAgIGlmIChldmVudC5jb250ZW50KSB7XG4gICAgICAgICAgICBjb250ZW50ID0gSlNPTi5wYXJzZShldmVudC5jb250ZW50KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fb25NZXNzYWdlICYmIGNvbnRlbnQgJiYgdGhpcy5fY29ubmVjdGlvbklkID09PSBjb250ZW50LmNvbm5lY3Rpb25JZCkge1xuICAgICAgICAgICAgdGhpcy5fb25NZXNzYWdlKHtkYXRhOiBKU09OLnN0cmluZ2lmeShjb250ZW50Lmpzb25ScGNNc2cpfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzZXQgb25tZXNzYWdlKGNhbGxCYWNrKSB7XG4gICAgICAgIHRoaXMuX29uTWVzc2FnZSA9IGNhbGxCYWNrO1xuICAgIH1cblxuICAgIHNldCBvbm9wZW4oY2FsbEJhY2spIHtcbiAgICAgICAgdGhpcy5fb25PcGVuID0gY2FsbEJhY2s7XG4gICAgfVxuXG4gICAgc2VuZCh3ZWJTb2NrZXRQYXlsb2FkKSB7XG4gICAgICAgIGNvbnN0IHBheWxvYWQgPSB7fTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHBheWxvYWQudG9waWMgPSBTT0ZUUEhPTkVfUk9VVEVfS0VZO1xuICAgICAgICAgICAgcGF5bG9hZC5jb25uZWN0aW9uSWQgPSB0aGlzLl9jb25uZWN0aW9uSWQ7XG4gICAgICAgICAgICBwYXlsb2FkLmpzb25ScGNNc2cgPSBKU09OLnBhcnNlKHdlYlNvY2tldFBheWxvYWQpO1xuICAgICAgICAgICAgdGhpcy5fd3NzTWFuYWdlci5zZW5kTWVzc2FnZShwYXlsb2FkKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHRoaXMuX2xvZ2dlci5lcnJvcihcIkVycm9yIGluIHNlbmRNZXNzYWdlIFwiLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjbG9zZSgpIHtcbiAgICAgICAgdGhpcy5fbG9nZ2VyLmluZm8oXCJjbG9zaW5nIHZpcnR1YWwgY29ubmVjdGlvblwiKTtcbiAgICAgICAgdGhpcy5fdW5TdWJzY3JpYmUoKTtcbiAgICB9XG59Il19
